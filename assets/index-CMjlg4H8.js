var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{p as i,g as s,c as n,a as o}from"./phaser-CoK54M-t.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const r={},a={width:1280,height:720},l={width:960,height:540};let h=!1,c=!1,d=!1;d=!0;let u=!0;const p=localStorage.getItem("chrono-sleuth-prod");let y;null!==p&&(u="true"===p);let g=u;g=!0;let f=!1;u&&(f=!1);const{width:m,height:b}=l;u&&(h=!1,d=!1,u=!0,y=void 0,c=!1);const v={debug:h,phaserInspector:c,prod:u,bootDialog:y,useShader:!0,width:m,height:b,cameraOffset:b/3,zoomed:!0,dayMinutes:.25,rewindEnabled:!1,fastMode:d,perfTest:f};var w=(e=>(e[e.Backgrounds=-1]="Backgrounds",e[e.Warpers=0]="Warpers",e[e.Npcs=1]="Npcs",e[e.Items=2]="Items",e[e.Player=3]="Player",e[e.Shader=4]="Shader",e[e.Ui=5]="Ui",e[e.Ui2=6]="Ui2",e[e.Debug=7]="Debug",e[e.Overlay=8]="Overlay",e))(w||{}),x=(e=>(e[e.None=0]="None",e[e.Teleported=1]="Teleported",e[e.Talked=2]="Talked",e[e.Item=3]="Item",e[e.Prop=4]="Prop",e))(x||{}),S=(e=>(e[e.Underground=0]="Underground",e[e.Town=1]="Town",e[e.TownEast=2]="TownEast",e[e.Forest=3]="Forest",e[e.ForestEast=4]="ForestEast",e[e.Lake=5]="Lake",e[e.TownNorth=6]="TownNorth",e[e.ClockSquare=7]="ClockSquare",e[e.ClockSquareNorth=8]="ClockSquareNorth",e[e.ClockEntrance=9]="ClockEntrance",e[e.ClockStairs=10]="ClockStairs",e[e.ClockTop=11]="ClockTop",e[e.TownWest=12]="TownWest",e[e.MansionGrounds=13]="MansionGrounds",e[e.MansionEntrance=14]="MansionEntrance",e[e.Mansion=15]="Mansion",e[e.LabHatch=16]="LabHatch",e[e.Lab=17]="Lab",e[e.LibraryEntrance=18]="LibraryEntrance",e[e.Library=19]="Library",e))(S||{}),k=(e=>(e[e.Wrench=0]="Wrench",e[e.Gear1=1]="Gear1",e[e.Key=2]="Key",e[e.HerbRed=3]="HerbRed",e[e.HerbGreen=4]="HerbGreen",e[e.HerbBlue=5]="HerbBlue",e[e.Potion=6]="Potion",e[e.Gear2=7]="Gear2",e))(k||{}),I=(e=>(e[e.ForestGear=0]="ForestGear",e[e.SphinxRiddle=1]="SphinxRiddle",e[e.InvestigateTownWest=2]="InvestigateTownWest",e[e.ExploreLab=3]="ExploreLab",e[e.FindPotionIngredients=4]="FindPotionIngredients",e))(I||{}),T=(e=>(e[e.Inventor=0]="Inventor",e[e.Stranger=1]="Stranger",e[e.Sphinx=2]="Sphinx",e[e.Mayor=3]="Mayor",e[e.ClockTower=4]="ClockTower",e))(T||{}),P=(e=>(e[e.Sphinx=0]="Sphinx",e))(P||{}),C=(e=>(e[e.FixTheClock=0]="FixTheClock",e[e.MetTheMayor=1]="MetTheMayor",e[e.ClockFirstGear=2]="ClockFirstGear",e[e.AlchemyLabFound=3]="AlchemyLabFound",e[e.AlchemySetFixed=4]="AlchemySetFixed",e[e.ExtraPotionInformation=5]="ExtraPotionInformation",e[e.SafeDiscovered=6]="SafeDiscovered",e[e.ClockSecondGear=7]="ClockSecondGear",e))(C||{}),j=(e=>(e[e.Chest=0]="Chest",e[e.LabHatch=1]="LabHatch",e[e.LabBook=2]="LabBook",e[e.AlchemySet=3]="AlchemySet",e[e.LabBookshelf1=4]="LabBookshelf1",e[e.LabBookshelf2=5]="LabBookshelf2",e[e.LabBookshelf3=6]="LabBookshelf3",e[e.LabPotionShelf1=7]="LabPotionShelf1",e[e.MansionPicture=8]="MansionPicture",e[e.MansionHole=9]="MansionHole",e))(j||{}),A=(e=>(e[e.LabStairs=0]="LabStairs",e))(A||{});const O={[T.Inventor]:{x:550,y:635,scale:.75,image:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[T.Stranger]:{x:750,y:865,scale:1.35,image:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[T.Sphinx]:{x:3520,y:790,scale:1,image:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:e=>Dh(e.scene,e.scene.player.gameState.data.sphinxMoved,!0),light:1.85,initializeOnStart:!0},[T.Mayor]:{x:1065,y:-340,scale:.9,image:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[T.ClockTower]:{x:880,y:-2090,scale:.5,image:"warp",portrait:"clock_portrait",name:"Clock Tower",particles:{texture:"warp",scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]},onCreate:e=>{e.setOffset(150,-40)}}},E="fcfee9",M="e6c99d",D="303646",z="1c1831",F="993333",L="339933",B="ffccaa",G="335588",W="111111",R="ddaaee";function H(e){return i.Display.Color.HexStringToColor(e).color}function N(e){return H(i.Display.Color.RGBToString(255*e.r,255*e.g,255*e.b))}function _(e){const t=i.Display.Color.ColorToRGBA(e);return new i.Display.Color(t.r,t.g,t.b,t.a)}function U(e,t,s,n,o){const r=.3*(o.duration||100);return e.tweens.addCounter({from:0,to:r,onUpdate:e=>{const o=i.Display.Color.Interpolate.ColorWithColor(t,s,r,e.getValue());var a;n((a=o,H(i.Display.Color.RGBToString(a.r,a.g,a.b))))},...o})}const V=1200;let $=!1;function q(e){return N(e.lights.ambientColor)===H(E)}function X(e,t=!0){$||(K(e,E,t),t?e.time.delayedCall(V,(()=>Y(e,.5))):Y(e,.5),e.lights.lights.forEach((i=>{const s=i.intensity;t?e.tweens.add({targets:i,duration:V,intensity:0,onComplete:()=>{i.setVisible(!1),i.setIntensity(s)}}):i.setVisible(!1)})))}function K(e,t,s){if(!s)return void e.lights.setAmbientColor(H(t));$=!0;const n=N(e.lights.ambientColor),o=i.Display.Color.ValueToColor(n),r=i.Display.Color.ValueToColor(t);U(e,o,r,(t=>e.lights.setAmbientColor(t)),{duration:V,onComplete:()=>{$=!1}})}function Y(e,t){e.children.getAll("name","DebugLightGraphics").forEach((e=>e.setAlpha(t)))}const Q=_(H(W));function J(e,t,i){e.cameras.main.fadeIn(t,Q.red,Q.green,Q.blue,((e,t)=>{t>=1&&i&&i()}))}function Z(e,t,i){e.cameras.main.fadeOut(t,Q.red,Q.green,Q.blue,((e,t)=>{t>=1&&i&&i()}))}function ee(e,t,s){return!!(t.inventory.initialized&&t.quests.initialized&&t.journal.initialized)&&i.Math.Distance.BetweenPointsSquared(e,t)<(s||1e3)**2}function te(e,t,i){var s,n;null==(s=e.gamepad)||s.setAlpha(0),null==(n=e.gamepad)||n.resetButtons(),e.scene.pause(),e.scene.launch(t,{player:e.player,...i})}function ie(e,t,i){return t&&Object.values(t).includes(e)?`${i}.${Object.keys(t).find((i=>t[i]===e))}`:e}function se(e){return e.replace(/([A-Z]+|[0-9]+)/g," $1").trim()}let ne;const oe=document.documentElement;class re extends i.GameObjects.GameObject{constructor(e,i,s,n,o,r){super(e,"DebugLight"),t(this,"x"),t(this,"y"),t(this,"light"),t(this,"debug"),e.add.existing(this),this.light=e.lights.addLight(i,s,n,o,r),this.debug=e.add.graphics({x:i,y:s}).setDepth(w.Debug),this.debug.lineStyle(3,65280),this.debug.name="DebugLightGraphics",this.x=i,this.y=s,v.debug&&this.debug.strokeCircle(0,0,n)}setPosition(e,t){this.light.setPosition(e,t),this.debug.setPosition(e,t),this.x=e,this.y=t}destroy(e){var t,i;super.destroy(e),this.debug.destroy(),null==(i=null==(t=this.scene)?void 0:t.lights)||i.removeLight(this.light)}}const ae=2*Math.PI;class le extends i.GameObjects.Graphics{constructor(e,i){super(e),t(this,"player"),t(this,"angle1",0),t(this,"angle2",1),t(this,"angle3",4),t(this,"update1",!1),t(this,"update2",!1),t(this,"update3",!1),this.name="ClockHands",e.add.existing(this),this.player=i,this.setPosition(842,-2107),this.setDepth(w.Npcs),this.updateHands()}update(e){if(this.scene.cameras.main.worldView.contains(this.x,this.y))this.setVisible(!1);else{this.setVisible(!0),this.update1&&(this.angle1=ae*(e/6e4)*35),this.update2&&(this.angle2=ae*(e/36e5)*35),this.update3&&(this.angle3=ae*(e/432e5)*35),this.clear(),this.fillStyle(H("#224477")),this.fillCircle(0,0,6),[8,6].forEach((e=>{this.lineStyle(e,H(6===e?"#224477":z)),this.lineBetween(0,0,50*Math.cos(this.angle1),50*Math.sin(this.angle1)),this.lineBetween(0,0,40*Math.cos(this.angle2),40*Math.sin(this.angle2)),this.lineBetween(0,0,25*Math.cos(this.angle3),25*Math.sin(this.angle3))})),this.lineStyle(5,H(z));for(let e=0;e<12;e++){const t=ae*(e/12),i=50*Math.cos(t),s=50*Math.sin(t);this.lineBetween(i,s,1.5*i,1.5*s)}}}updateHands(){Pe(this.player,C.ClockFirstGear)&&(this.update1=!0),Pe(this.player,C.ClockSecondGear)&&(this.update2=!0)}}var he=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e[e.Continue=4]="Continue",e[e.Back=5]="Back",e[e.Shift=6]="Shift",e))(he||{});class ce{constructor(e){t(this,"scene"),t(this,"keys",Object.keys(he).map(Number).reduce(((e,t)=>({...e,[t]:!1})),{})),this.scene=e,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W"),this.listener(2,"A"),this.listener(1,"S"),this.listener(3,"D"),this.listener(4,"SPACE"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE"),this.listener(6,"SHIFT")}listener(e,t){var i,s;null==(i=this.scene.input.keyboard)||i.on(`keydown-${t}`,(()=>this.keys[e]=!0)),null==(s=this.scene.input.keyboard)||s.on(`keyup-${t}`,(()=>this.keys[e]=!1))}resetKeys(){Object.entries(this.keys).forEach((([e,t])=>this.keys[Number(e)]=!1))}}class de extends i.Physics.Arcade.Image{constructor(e,s,n){const{x:o,y:r,image:a}=O[s];super(e,o,r,a),t(this,"npcType"),t(this,"player"),t(this,"light"),t(this,"particles"),t(this,"lastPos",new i.Math.Vector2),t(this,"clock"),t(this,"disabled",!1),t(this,"initialized",!1),this.name=`NPC-${s}`,this.npcType=s,this.player=n,this.setDepth(w.Npcs),"warp"===a&&this.setAlpha(0),Me(this,O[s])}lazyInit(e){if(!e&&(this.initialized||!ee(this,this.player)))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),v.debug&&this.setInteractive({draggable:!0});const{x:t,y:i,light:s,particles:n,onCreate:o}=O[this.npcType],r=s||1,a=!q(this.scene);v.debug?(this.light=new re(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,r),this.light.light.setVisible(a)):(this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,r),this.light.setVisible(a)),n&&(this.particles=this.scene.add.particles(t,i,"",n).setName(`NPC-${this.npcType}-Particles`)),this.npcType===T.ClockTower&&(this.clock=new le(this.scene,this.player)),o&&o(this),this.initialized=!0}update(e,t){this.lazyInit(),!this.light||this.x===this.lastPos.x&&this.y===this.lastPos.y||this.light.setPosition(this.x,this.y),this.lastPos.set(this.x,this.y),this.clock&&this.clock.update(e)}onInteract(e){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return x.None;if(e[he.Continue]){const e=Eh(jh[this.npcType],this.player,this);if(e&&(null==e?void 0:e.messages.length)>0){const t=O[this.npcType].portrait.length>0;return this.player.message.setDialog(e,t?this:void 0),x.Talked}}return x.None}getButtonPrompt(){return this.npcType===T.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${O[this.npcType].name}`,"Press [CONTINUE]"]}}const ue={[j.Chest]:{x:5110,y:915,image:"chest",scale:{x:4.5,y:3}},[j.LabHatch]:{x:-1910,y:640},[j.LabBook]:{x:-700,y:1630,image:"book"},[j.AlchemySet]:{x:-2650,y:1600,image:"alchemy_empty",initializeOnStart:!0,skipLighting:!0,particles:{scale:{min:.05,max:.15},speed:{min:30,max:120},alpha:{values:[0,.5,0]},gravityY:100,lifespan:{min:250,max:500},emitting:!1,stopAfter:60}},[j.LabBookshelf1]:{x:-2025,y:1700},[j.LabBookshelf2]:{x:-1290,y:1700},[j.LabBookshelf3]:{x:-1115,y:1700},[j.LabPotionShelf1]:{x:-1790,y:1700},[j.MansionPicture]:{x:-1233,y:-580,scale:1.2,angle:5,image:"picture",origin:{x:0,y:0},initializeOnStart:!0,skipLighting:!0},[j.MansionHole]:{x:-1870,y:-490}};class pe extends i.Physics.Arcade.Image{constructor(e,i,s){const{x:n,y:o,image:r}=ue[i];super(e,n,o,r||""),t(this,"propType"),t(this,"player"),t(this,"particles"),t(this,"initialized",!1),t(this,"disabled",!1),this.name=`Prop-${i}`,this.propType=i,this.player=s,this.setScale(r?.35:2).setDepth(w.Items),r||v.debug||this.setAlpha(0),Me(this,ue[i]),i===j.MansionPicture&&this.resetPostPipeline()}lazyInit(e){if(!e&&(this.initialized||!ee(this,this.player)))return;if(this.checkDestroyed())return;this.scene.add.existing(this),this.scene.physics.add.existing(this),v.debug&&this.setInteractive({draggable:!0});const t=ue[this.propType].particles;t&&(this.particles=this.scene.add.particles(this.x,this.y,"warp",t).setDepth(w.Items).setName(`Prop-${this.propType}-Particles`)),this.propType===j.MansionPicture&&this.scene.add.image(this.x,this.y,"safe").setOrigin(0,0).setScale(.9).setName("Prop-Safe"),this.initialized=!0}onInteract(e){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return x.None;if(e[he.Continue]){const e=Eh(Oh[this.propType]||[],this.player,this);if(e&&(null==e?void 0:e.messages.length)>0)return this.player.message.setDialog(e,this,ue[this.propType].portrait||"player_portrait"),x.Prop}return x.None}checkDestroyed(){let e=!1;return this.propType===j.LabHatch&&Pe(this.player,C.AlchemyLabFound)&&(e=!0),this.propType===j.Chest&&xe(this.player,k.Gear1)&&(e=!0),e&&this.destroy(),e}getButtonPrompt(){const e=Eh(Oh[this.propType]||[],this.player,this);let t=j[this.propType];return t=se(t),this.propType===j.MansionPicture&&Pe(this.player,C.SafeDiscovered)&&(t="Safe"),e&&(null==e?void 0:e.messages.length)>0?[`Inspect ${t}`,"Press [CONTINUE]"]:""}update(){this.lazyInit()}}const ye={[C.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[C.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:S.ClockSquareNorth},[C.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[C.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:S.LabHatch},[C.AlchemySetFixed]:{description:"With the alchemy set fixed, I can now attempt to create the brew mentioned in the old journal."},[C.ExtraPotionInformation]:{description:'I found an extra journal entry with more information on the potion. It stated the name of the potion was the "Exlixir of Sight". This potion must be the key to finding a gear.'},[C.SafeDiscovered]:{description:"I discovered a safe in the abandonded mansion. I wonder what secrets it holds."},[C.ClockSecondGear]:{description:"I found the second gear for the clock tower inside a safe, which was located within the abandoned mansion. I still need one more gear to fix it."}},ge={[I.ForestGear]:{description:"Find the gear in the forest",warpAdd:S.TownEast,warpComplete:S.TownNorth},[I.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[I.InvestigateTownWest]:{description:"Investigate the west side of town",warpAdd:S.TownWest},[I.ExploreLab]:{description:"Explore the hidden alchemy lab"},[I.FindPotionIngredients]:{description:"Find the 3 potion ingredients"}};var fe=(e=>(e[e.Ladder=0]="Ladder",e[e.Warp=1]="Warp",e[e.Invisible=2]="Invisible",e[e.WarpHidden=3]="WarpHidden",e[e.InvisibleHidden=4]="InvisibleHidden",e))(fe||{});const me={[S.Town]:{x:300,y:650,key:he.Down,warpTo:S.Underground,visual:0},[S.Underground]:{x:301,y:875,key:he.Up,warpTo:S.Town,visual:0},[S.TownEast]:{x:1720,y:650,key:he.Right,warpTo:S.Forest,visual:3},[S.Forest]:{x:2650,y:815,key:he.Left,warpTo:S.TownEast,visual:1},[S.TownNorth]:{x:775,y:650,key:he.Up,warpTo:S.ClockSquare,visual:3},[S.ClockSquare]:{x:610,y:-330,key:he.Left,warpTo:S.TownNorth,visual:1},[S.ClockSquareNorth]:{x:915,y:-330,key:he.Up,warpTo:S.ClockEntrance,visual:3},[S.ClockEntrance]:{x:690,y:-1320,range:15,key:he.Left,warpTo:S.ClockSquareNorth,visual:1,skipLighting:!0},[S.ClockStairs]:{x:910,y:-1400,range:20,key:he.Right,warpTo:S.ClockTop,visual:2},[S.ClockTop]:{x:780,y:-1970,range:10,key:he.Left,warpTo:S.ClockStairs,visual:2},[S.ForestEast]:{x:3590,y:815,key:he.Right,warpTo:S.Lake,visual:3,initializeOnStart:!0},[S.Lake]:{x:4625,y:915,key:he.Left,warpTo:S.ForestEast,visual:1},[S.TownWest]:{x:90,y:650,key:he.Left,warpTo:S.MansionGrounds,visual:3},[S.MansionGrounds]:{x:-620,y:640,key:he.Right,warpTo:S.TownWest,visual:1},[S.MansionEntrance]:{x:-1290,y:640,key:he.Up,warpTo:S.Mansion,visual:1},[S.Mansion]:{x:-1405,y:-420,key:he.Down,warpTo:S.MansionEntrance,visual:2},[S.LabHatch]:{x:-1920,y:640,key:he.Down,warpTo:S.Lab,visual:4},[S.Lab]:{x:-1380,y:1545,key:he.Right,warpTo:S.LabHatch,visual:2,range:15,skipLighting:!0},[S.LibraryEntrance]:{x:1420,y:650,key:he.Up,warpTo:S.Library,visual:3},[S.Library]:{x:1730,y:-120,key:he.Left,warpTo:S.LibraryEntrance,visual:1}},be=[];Object.values(ge).forEach((e=>{e.warpAdd&&be.push(e.warpAdd),e.warpComplete&&be.push(e.warpComplete)})),Object.values(ye).forEach((e=>{e.warpAdd&&be.push(e.warpAdd)}));class ve extends i.Physics.Arcade.Image{constructor(e,i,s){const{x:n,y:o,visual:r,range:a}=me[i];super(e,n,o,r===fe.Ladder?"ladder":"warp"),t(this,"warpType"),t(this,"player"),t(this,"graphics"),t(this,"portal1"),t(this,"portal2"),t(this,"range"),t(this,"initialized",!1),this.name=`Warp-${i}`,this.warpType=i,this.player=s,this.range=a||30,this.setScale(.6).setDepth(w.Warpers),r!==fe.Warp&&r!==fe.WarpHidden||(this.setScale(.6,1),this.setPosition(n,o-12)),v.debug||(r!==fe.WarpHidden&&r!==fe.InvisibleHidden||this.setVisible(!1),r!==fe.Invisible&&r!==fe.InvisibleHidden||this.setAlpha(0)),Me(this,me[i]),be.includes(i)&&e.add.existing(this)}lazyInit(e){(e||!this.initialized&&ee(this,this.player))&&(be.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createParticles(),this.createDebug(),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),this.setVisible(this.visible),this.warpType===S.Underground&&(this.scene.add.image(this.x,this.y-60,"ladder").setScale(.6).setDepth(w.Warpers).setPipeline("Light2D").setPostPipeline("XRayPipeline").setName("Ladder1"),this.scene.add.image(this.x,this.y-105,"ladder").setScale(.6).setDepth(w.Warpers).setPipeline("Light2D").setPostPipeline("XRayPipeline").setName("Ladder2")),this.initialized=!0)}createParticles(){const{visual:e,skipLighting:t}=me[this.warpType];e!==fe.Warp&&e!==fe.WarpHidden||(this.setAlpha(.1),this.scene.anims.exists("portal")||this.scene.anims.create({key:"portal",frames:this.scene.anims.generateFrameNumbers("portal",{start:0,end:63}),frameRate:10,repeat:-1}),this.portal1=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.45,1).setAlpha(.9).play("portal").setName(`${this.name}-1`),this.portal1.postFX.addPixelate(1),this.portal1.postFX.addShadow(0,0,.1,1,3355562,6,.5),this.portal2=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.35,1).setAlpha(.65).setFlipX(!0).setName(`${this.name}-2`),this.portal2.postFX.addPixelate(1),this.portal2.play("portal"),this.portal2.setFrame(Math.floor(30*Math.random())),t||(this.portal1.setPipeline("Light2D"),this.portal2.setPipeline("Light2D")),this.portal1.setPostPipeline("XRayPipeline"),this.portal2.setPostPipeline("XRayPipeline"))}createDebug(){if(v.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const e=this.body;this.graphics.lineBetween(-this.range,-e.halfHeight,-this.range,e.halfHeight),this.graphics.lineBetween(this.range,-e.halfHeight,this.range,e.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:e,key:t}=me[this.warpType];return!(e!==fe.Warp&&e!==fe.WarpHidden&&e!==fe.Invisible||t!==he.Left&&t!==he.Right)}onInteract(e){const t=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,i=e[me[this.warpType].key]&&t;return!i||this.warpType!==S.TownEast||this.player.gameState.data.mazeSolved||v.debug?i?(we(me[this.warpType].warpTo,this.player),x.Teleported):x.None:(te(this.scene,"MazeDialog"),x.None)}getButtonPrompt(){const e=me[this.warpType].key;let t;e===he.Continue&&(t="[CONTINUE]"),e===he.Up&&(t="[Up]"),e===he.Down&&(t="[Down]"),e===he.Left&&(t="[Left]"),e===he.Right&&(t="[Right]");let i=S[me[this.warpType].warpTo];return i=se(i),[`Travel to ${i}`,"Press "+t]}setPosition(e,t,i,s){var n,o,r;return super.setPosition(e,t,i,s),null==(n=this.portal1)||n.setPosition(e,t),null==(o=this.portal2)||o.setPosition(e,t),null==(r=this.graphics)||r.setPosition(e,t),this}setVisible(e){var t,i;return super.setVisible(e),null==(t=this.portal1)||t.setVisible(e),null==(i=this.portal2)||i.setVisible(e),this}update(e,t){this.lazyInit()}destroy(e){var t,i;null==(t=this.portal1)||t.destroy(e),null==(i=this.portal2)||i.destroy(e),super.destroy(e)}}function we(e,t,s){let{x:n,y:o,onWarp:r}=me[e];s&&(n+=s.x,o+=s.y);const a=t.scene,l=n-a.cameras.main.width/2,h=o-a.cameras.main.height/2;r&&r(t),a.cameras.main.fadeOut(200,0,0,0,((e,t)=>{t>=1&&a.cameras.main.fadeIn(1e3,0,0,0)})),a.cameras.main.stopFollow(),a.tweens.add({targets:a.cameras.main,scrollX:l,scrollY:h-v.cameraOffset,duration:600,delay:100,ease:"Power1",onComplete:()=>{a.cameras.main.startFollow(t,!0),a.cameras.main.setFollowOffset(0,v.cameraOffset)}}),t.setActive(!1),t.buttonPrompt.setVisible(!1),a.tweens.add({targets:t,alpha:0,duration:500,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{t.setPosition(n,o),t.previousPosition.set(n,o)},onComplete:()=>{t.alpha=1,t.setActive(!0)}}),a.tweens.add({targets:t.light,intensity:0,duration:50,hold:600,yoyo:!0,repeat:0});const c=t.light instanceof i.GameObjects.Light?t.light:t.light.light;a.tweens.add({targets:c,x:n,y:o,duration:400,ease:"Power1"})}function xe(e,t){return void 0!==e.inventory.inventory.find((e=>e.type===t))}function Se(e,t){return void 0!==e.inventory.inventory.find((e=>e.type===t&&!e.used))}function ke(e,t){return void 0!==e.inventory.inventory.find((e=>e.type===t&&e.used))}function Ie(e,t){return e.quests.quests.some((e=>e.id===t&&!e.completed))}function Te(e,t){return e.quests.quests.some((e=>e.id===t&&e.completed))}function Pe(e,t){return e.journal.journal.includes(t)}function Ce(e,t){return e.children.getAll().filter((e=>e instanceof t))}function je(e,t,i){const s=function(e,t){return Ce(e,ve).find((e=>e.warpType===t))}(e,t);s&&s.setVisible(i)}function Ae(e,t){return Ce(e,de).find((e=>e.npcType===t))}function Oe(e,t){return Ce(e,Mh).find((e=>e.itemType===t))}function Ee(e,t){return Ce(e,pe).find((e=>e.propType===t))}function Me(e,t){const{scale:i,alpha:s,angle:n,depth:o,skipLighting:r,origin:a,initializeOnStart:l}=t;i&&("object"==typeof i?e.setScale(i.x,i.y):e.setScale(i)),s&&e.setAlpha(s),n&&e.setAngle(n),o&&e.setDepth(o),a&&e.setOrigin(a.x,a.y),r||e.setPipeline("Light2D"),e.setPostPipeline("XRayPipeline"),l&&e.lazyInit(!0)}var De,ze,Fe=Object.prototype.toString,Le=function(e){var t=Fe.call(e),i="[object Arguments]"===t;return i||(i="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===Fe.call(e.callee)),i},Be=Array.prototype.slice,Ge=Le,We=Object.keys,Re=We?function(e){return We(e)}:function(){if(ze)return De;var e;if(ze=1,!Object.keys){var t=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=Le,n=Object.prototype.propertyIsEnumerable,o=!n.call({toString:null},"toString"),r=n.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(e){var t=e.constructor;return t&&t.prototype===e},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!h["$"+e]&&t.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{l(window[e])}catch(i){return!0}}catch(i){return!0}return!1}();e=function(e){var n=null!==e&&"object"==typeof e,h="[object Function]"===i.call(e),d=s(e),u=n&&"[object String]"===i.call(e),p=[];if(!n&&!h&&!d)throw new TypeError("Object.keys called on a non-object");var y=r&&h;if(u&&e.length>0&&!t.call(e,0))for(var g=0;g<e.length;++g)p.push(String(g));if(d&&e.length>0)for(var f=0;f<e.length;++f)p.push(String(f));else for(var m in e)y&&"prototype"===m||!t.call(e,m)||p.push(String(m));if(o)for(var b=function(e){if("undefined"==typeof window||!c)return l(e);try{return l(e)}catch(t){return!1}}(e),v=0;v<a.length;++v)b&&"constructor"===a[v]||!t.call(e,a[v])||p.push(a[v]);return p}}return De=e}(),He=Object.keys;Re.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return Ge(e)?He(Be.call(e)):He(e)})}else Object.keys=Re;return Object.keys||Re};var Ne,_e=Re,Ue=Error,Ve=EvalError,$e=RangeError,qe=ReferenceError,Xe=SyntaxError,Ke=TypeError,Ye=URIError,Qe=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var s=Object.getOwnPropertySymbols(e);if(1!==s.length||s[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(e,t);if(42!==n.value||!0!==n.enumerable)return!1}return!0},Je="undefined"!=typeof Symbol&&Symbol,Ze=Qe,et=function(){return"function"==typeof Je&&"function"==typeof Symbol&&"symbol"==typeof Je("foo")&&"symbol"==typeof Symbol("bar")&&Ze()},tt={__proto__:null,foo:{}},it=Object,st=Object.prototype.toString,nt=Math.max,ot=function(e,t){for(var i=[],s=0;s<e.length;s+=1)i[s]=e[s];for(var n=0;n<t.length;n+=1)i[n+e.length]=t[n];return i},rt=Function.prototype.bind||function(e){var t=this;if("function"!=typeof t||"[object Function]"!==st.apply(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var i,s=function(e){for(var t=[],i=1,s=0;i<e.length;i+=1,s+=1)t[s]=e[i];return t}(arguments),n=nt(0,t.length-s.length),o=[],r=0;r<n;r++)o[r]="$"+r;if(i=Function("binder","return function ("+function(e){for(var t="",i=0;i<e.length;i+=1)t+=e[i],i+1<e.length&&(t+=",");return t}(o)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=t.apply(this,ot(s,arguments));return Object(n)===n?n:this}return t.apply(e,ot(s,arguments))})),t.prototype){var a=function(){};a.prototype=t.prototype,i.prototype=new a,a.prototype=null}return i},at=Function.prototype.call,lt=Object.prototype.hasOwnProperty,ht=rt.call(at,lt),ct=Ue,dt=Ve,ut=$e,pt=qe,yt=Xe,gt=Ke,ft=Ye,mt=Function,bt=function(e){try{return mt('"use strict"; return ('+e+").constructor;")()}catch(t){}},vt=Object.getOwnPropertyDescriptor;if(vt)try{vt({},"")}catch(xc){vt=null}var wt=function(){throw new gt},xt=vt?function(){try{return wt}catch(e){try{return vt(arguments,"callee").get}catch(t){return wt}}}():wt,St=et(),kt={__proto__:tt}.foo===tt.foo&&!(tt instanceof it),It=Object.getPrototypeOf||(kt?function(e){return e.__proto__}:null),Tt={},Pt="undefined"!=typeof Uint8Array&&It?It(Uint8Array):Ne,Ct={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?Ne:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?Ne:ArrayBuffer,"%ArrayIteratorPrototype%":St&&It?It([][Symbol.iterator]()):Ne,"%AsyncFromSyncIteratorPrototype%":Ne,"%AsyncFunction%":Tt,"%AsyncGenerator%":Tt,"%AsyncGeneratorFunction%":Tt,"%AsyncIteratorPrototype%":Tt,"%Atomics%":"undefined"==typeof Atomics?Ne:Atomics,"%BigInt%":"undefined"==typeof BigInt?Ne:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?Ne:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?Ne:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?Ne:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":ct,"%eval%":eval,"%EvalError%":dt,"%Float32Array%":"undefined"==typeof Float32Array?Ne:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?Ne:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?Ne:FinalizationRegistry,"%Function%":mt,"%GeneratorFunction%":Tt,"%Int8Array%":"undefined"==typeof Int8Array?Ne:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?Ne:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?Ne:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":St&&It?It(It([][Symbol.iterator]())):Ne,"%JSON%":"object"==typeof JSON?JSON:Ne,"%Map%":"undefined"==typeof Map?Ne:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&St&&It?It((new Map)[Symbol.iterator]()):Ne,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?Ne:Promise,"%Proxy%":"undefined"==typeof Proxy?Ne:Proxy,"%RangeError%":ut,"%ReferenceError%":pt,"%Reflect%":"undefined"==typeof Reflect?Ne:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?Ne:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&St&&It?It((new Set)[Symbol.iterator]()):Ne,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?Ne:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":St&&It?It(""[Symbol.iterator]()):Ne,"%Symbol%":St?Symbol:Ne,"%SyntaxError%":yt,"%ThrowTypeError%":xt,"%TypedArray%":Pt,"%TypeError%":gt,"%Uint8Array%":"undefined"==typeof Uint8Array?Ne:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?Ne:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?Ne:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?Ne:Uint32Array,"%URIError%":ft,"%WeakMap%":"undefined"==typeof WeakMap?Ne:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?Ne:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?Ne:WeakSet};if(It)try{null.error}catch(xc){var jt=It(It(xc));Ct["%Error.prototype%"]=jt}var At=function e(t){var i;if("%AsyncFunction%"===t)i=bt("async function () {}");else if("%GeneratorFunction%"===t)i=bt("function* () {}");else if("%AsyncGeneratorFunction%"===t)i=bt("async function* () {}");else if("%AsyncGenerator%"===t){var s=e("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if("%AsyncIteratorPrototype%"===t){var n=e("%AsyncGenerator%");n&&It&&(i=It(n.prototype))}return Ct[t]=i,i},Ot={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Et=rt,Mt=ht,Dt=Et.call(Function.call,Array.prototype.concat),zt=Et.call(Function.apply,Array.prototype.splice),Ft=Et.call(Function.call,String.prototype.replace),Lt=Et.call(Function.call,String.prototype.slice),Bt=Et.call(Function.call,RegExp.prototype.exec),Gt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Wt=/\\(\\)?/g,Rt=function(e,t){var i,s=e;if(Mt(Ot,s)&&(s="%"+(i=Ot[s])[0]+"%"),Mt(Ct,s)){var n=Ct[s];if(n===Tt&&(n=At(s)),void 0===n&&!t)throw new gt("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:n}}throw new yt("intrinsic "+e+" does not exist!")},Ht=function(e,t){if("string"!=typeof e||0===e.length)throw new gt("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new gt('"allowMissing" argument must be a boolean');if(null===Bt(/^%?[^%]*%?$/,e))throw new yt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(e){var t=Lt(e,0,1),i=Lt(e,-1);if("%"===t&&"%"!==i)throw new yt("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new yt("invalid intrinsic syntax, expected opening `%`");var s=[];return Ft(e,Gt,(function(e,t,i,n){s[s.length]=i?Ft(n,Wt,"$1"):t||e})),s}(e),s=i.length>0?i[0]:"",n=Rt("%"+s+"%",t),o=n.name,r=n.value,a=!1,l=n.alias;l&&(s=l[0],zt(i,Dt([0,1],l)));for(var h=1,c=!0;h<i.length;h+=1){var d=i[h],u=Lt(d,0,1),p=Lt(d,-1);if(('"'===u||"'"===u||"`"===u||'"'===p||"'"===p||"`"===p)&&u!==p)throw new yt("property names with quotes must have matching quotes");if("constructor"!==d&&c||(a=!0),Mt(Ct,o="%"+(s+="."+d)+"%"))r=Ct[o];else if(null!=r){if(!(d in r)){if(!t)throw new gt("base intrinsic for "+e+" exists, but the property is not available.");return}if(vt&&h+1>=i.length){var y=vt(r,d);r=(c=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:r[d]}else c=Mt(r,d),r=r[d];c&&!a&&(Ct[o]=r)}}return r},Nt=Ht("%Object.defineProperty%",!0)||!1;if(Nt)try{Nt({},"a",{value:1})}catch(xc){Nt=!1}var _t=Nt,Ut=Ht("%Object.getOwnPropertyDescriptor%",!0);if(Ut)try{Ut([],"length")}catch(xc){Ut=null}var Vt=Ut,$t=_t,qt=Xe,Xt=Ke,Kt=Vt,Yt=function(e,t,i){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new Xt("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new Xt("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Xt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Xt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Xt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Xt("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,r=arguments.length>6&&arguments[6],a=!!Kt&&Kt(e,t);if($t)$t(e,t,{configurable:null===o&&a?a.configurable:!o,enumerable:null===s&&a?a.enumerable:!s,value:i,writable:null===n&&a?a.writable:!n});else{if(!r&&(s||n||o))throw new qt("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=i}},Qt=_t,Jt=function(){return!!Qt};Jt.hasArrayLengthDefineBug=function(){if(!Qt)return null;try{return 1!==Qt([],"length",{value:1}).length}catch(xc){return!0}};var Zt=Jt,ei=_e,ti="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),ii=Object.prototype.toString,si=Array.prototype.concat,ni=Yt,oi=Zt(),ri=function(e,t,i,s){if(t in e)if(!0===s){if(e[t]===i)return}else if("function"!=typeof(n=s)||"[object Function]"!==ii.call(n)||!s())return;var n;oi?ni(e,t,i,!0):ni(e,t,i)},ai=function(e,t){var i=arguments.length>2?arguments[2]:{},s=ei(t);ti&&(s=si.call(s,Object.getOwnPropertySymbols(t)));for(var n=0;n<s.length;n+=1)ri(e,s[n],t[s[n]],i[s[n]])};ai.supportsDescriptors=!!oi;var li=ai,hi={exports:{}},ci=Ht,di=Yt,ui=Zt(),pi=Vt,yi=Ke,gi=ci("%Math.floor%"),fi=function(e,t){if("function"!=typeof e)throw new yi("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||gi(t)!==t)throw new yi("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in e&&pi){var o=pi(e,"length");o&&!o.configurable&&(s=!1),o&&!o.writable&&(n=!1)}return(s||n||!i)&&(ui?di(e,"length",t,!0,!0):di(e,"length",t)),e};!function(e){var t=rt,i=Ht,s=fi,n=Ke,o=i("%Function.prototype.apply%"),r=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||t.call(r,o),l=_t,h=i("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new n("a function is required");var i=a(t,r,arguments);return s(i,1+h(0,e.length-(arguments.length-1)),!0)};var c=function(){return a(t,o,arguments)};l?l(e.exports,"apply",{value:c}):e.exports.apply=c}(hi);var mi=hi.exports,bi=Ht,vi=mi,wi=vi(bi("String.prototype.indexOf")),xi=function(e,t){var i=bi(e,!!t);return"function"==typeof i&&wi(e,".prototype.")>-1?vi(i):i},Si=_e,ki=Qe(),Ii=xi,Ti=Object,Pi=Ii("Array.prototype.push"),Ci=Ii("Object.prototype.propertyIsEnumerable"),ji=ki?Object.getOwnPropertySymbols:null,Ai=function(e,t){if(null==e)throw new TypeError("target must be an object");var i=Ti(e);if(1===arguments.length)return i;for(var s=1;s<arguments.length;++s){var n=Ti(arguments[s]),o=Si(n),r=ki&&(Object.getOwnPropertySymbols||ji);if(r)for(var a=r(n),l=0;l<a.length;++l){var h=a[l];Ci(n,h)&&Pi(o,h)}for(var c=0;c<o.length;++c){var d=o[c];if(Ci(n,d)){var u=n[d];i[d]=u}}}return i},Oi=Ai,Ei=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),i={},s=0;s<t.length;++s)i[t[s]]=t[s];var n=Object.assign({},i),o="";for(var r in n)o+=r;return e!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(xc){return"y"===e[1]}return!1}()?Oi:Object.assign:Oi},Mi=li,Di=Ei,zi=li,Fi=Ai,Li=Ei,Bi=mi.apply(Li()),Gi=function(e,t){return Bi(Object,arguments)};zi(Gi,{getPolyfill:Li,implementation:Fi,shim:function(){var e=Di();return Mi(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e}});var Wi=Gi,Ri=function(){return"string"==typeof function(){}.name},Hi=Object.getOwnPropertyDescriptor;if(Hi)try{Hi([],"length")}catch(xc){Hi=null}Ri.functionsHaveConfigurableNames=function(){if(!Ri()||!Hi)return!1;var e=Hi((function(){}),"name");return!!e&&!!e.configurable};var Ni=Function.prototype.bind;Ri.boundFunctionsHaveNames=function(){return Ri()&&"function"==typeof Ni&&""!==function(){}.bind().name};var _i=Ri,Ui=Yt,Vi=Zt(),$i=_i.functionsHaveConfigurableNames(),qi=Ke,Xi=Ke,Ki=Object,Yi=function(e,t){if("function"!=typeof e)throw new qi("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!$i||(Vi?Ui(e,"name",t,!0,!0):Ui(e,"name",t)),e}((function(){if(null==this||this!==Ki(this))throw new Xi("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e}),"get flags",!0),Qi=Yi,Ji=li.supportsDescriptors,Zi=Object.getOwnPropertyDescriptor,es=function(){if(Ji&&"gim"===/a/gim.flags){var e=Zi(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var t="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(i,"sticky",{get:function(){t+="y"}}),e.get.call(i),"dy"===t)return e.get}}return Qi},ts=li.supportsDescriptors,is=es,ss=Object.getOwnPropertyDescriptor,ns=Object.defineProperty,os=TypeError,rs=Object.getPrototypeOf,as=/a/,ls=li,hs=Yi,cs=es,ds=mi(cs());ls(ds,{getPolyfill:cs,implementation:hs,shim:function(){if(!ts||!rs)throw new os("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=is(),t=rs(as),i=ss(t,"flags");return i&&i.get===e||ns(t,"flags",{configurable:!0,enumerable:!1,get:e}),e}});var us=ds,ps={exports:{}},ys=Qe,gs=function(){return ys()&&!!Symbol.toStringTag},fs=gs(),ms=xi("Object.prototype.toString"),bs=function(e){return!(fs&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===ms(e)},vs=function(e){return!!bs(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==ms(e)&&"[object Function]"===ms(e.callee)},ws=function(){return bs(arguments)}();bs.isLegacyArguments=vs;var xs=ws?bs:vs;const Ss=s(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var ks="function"==typeof Map&&Map.prototype,Is=Object.getOwnPropertyDescriptor&&ks?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ts=ks&&Is&&"function"==typeof Is.get?Is.get:null,Ps=ks&&Map.prototype.forEach,Cs="function"==typeof Set&&Set.prototype,js=Object.getOwnPropertyDescriptor&&Cs?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,As=Cs&&js&&"function"==typeof js.get?js.get:null,Os=Cs&&Set.prototype.forEach,Es="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,Ms="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,Ds="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,zs=Boolean.prototype.valueOf,Fs=Object.prototype.toString,Ls=Function.prototype.toString,Bs=String.prototype.match,Gs=String.prototype.slice,Ws=String.prototype.replace,Rs=String.prototype.toUpperCase,Hs=String.prototype.toLowerCase,Ns=RegExp.prototype.test,_s=Array.prototype.concat,Us=Array.prototype.join,Vs=Array.prototype.slice,$s=Math.floor,qs="function"==typeof BigInt?BigInt.prototype.valueOf:null,Xs=Object.getOwnPropertySymbols,Ks="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Ys="function"==typeof Symbol&&"object"==typeof Symbol.iterator,Qs="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,Js=Object.prototype.propertyIsEnumerable,Zs=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function en(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||Ns.call(/e/,t))return t;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var s=e<0?-$s(-e):$s(e);if(s!==e){var n=String(s),o=Gs.call(t,n.length+1);return Ws.call(n,i,"$&_")+"."+Ws.call(Ws.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ws.call(t,i,"$&_")}var tn=Ss,sn=tn.custom,nn=dn(sn)?sn:null,on={__proto__:null,double:'"',single:"'"},rn={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function an(e,t,i){var s=i.quoteStyle||t,n=on[s];return n+e+n}function ln(e){return Ws.call(String(e),/"/g,"&quot;")}function hn(e){return!("[object Array]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}function cn(e){return!("[object RegExp]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}function dn(e){if(Ys)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!Ks)return!1;try{return Ks.call(e),!0}catch(xc){}return!1}var un=Object.prototype.hasOwnProperty||function(e){return e in this};function pn(e,t){return un.call(e,t)}function yn(e){return Fs.call(e)}function gn(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1}function fn(e,t){if(e.length>t.maxStringLength){var i=e.length-t.maxStringLength,s="... "+i+" more character"+(i>1?"s":"");return fn(Gs.call(e,0,t.maxStringLength),t)+s}var n=rn[t.quoteStyle||"single"];return n.lastIndex=0,an(Ws.call(Ws.call(e,n,"\\$1"),/[\x00-\x1f]/g,mn),"single",t)}function mn(e){var t=e.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return i?"\\"+i:"\\x"+(t<16?"0":"")+Rs.call(t.toString(16))}function bn(e){return"Object("+e+")"}function vn(e){return e+" { ? }"}function wn(e,t,i,s){return e+" ("+t+") {"+(s?xn(i,s):Us.call(i,", "))+"}"}function xn(e,t){if(0===e.length)return"";var i="\n"+t.prev+t.base;return i+Us.call(e,","+i)+"\n"+t.prev}function Sn(e,t){var i=hn(e),s=[];if(i){s.length=e.length;for(var n=0;n<e.length;n++)s[n]=pn(e,n)?t(e[n],e):""}var o,r="function"==typeof Xs?Xs(e):[];if(Ys){o={};for(var a=0;a<r.length;a++)o["$"+r[a]]=r[a]}for(var l in e)pn(e,l)&&(i&&String(Number(l))===l&&l<e.length||Ys&&o["$"+l]instanceof Symbol||(Ns.call(/[^\w$]/,l)?s.push(t(l,e)+": "+t(e[l],e)):s.push(l+": "+t(e[l],e))));if("function"==typeof Xs)for(var h=0;h<r.length;h++)Js.call(e,r[h])&&s.push("["+t(r[h])+"]: "+t(e[r[h]],e));return s}var kn=Ht,In=xi,Tn=function e(t,i,s,o){var r=i||{};if(pn(r,"quoteStyle")&&!pn(on,r.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(pn(r,"maxStringLength")&&("number"==typeof r.maxStringLength?r.maxStringLength<0&&r.maxStringLength!==1/0:null!==r.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!pn(r,"customInspect")||r.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(pn(r,"indent")&&null!==r.indent&&"\t"!==r.indent&&!(parseInt(r.indent,10)===r.indent&&r.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(pn(r,"numericSeparator")&&"boolean"!=typeof r.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=r.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return fn(t,r);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var h=String(t);return l?en(t,h):h}if("bigint"==typeof t){var c=String(t)+"n";return l?en(t,c):c}var d=void 0===r.depth?5:r.depth;if(void 0===s&&(s=0),s>=d&&d>0&&"object"==typeof t)return hn(t)?"[Array]":"[Object]";var u,p=function(e,t){var i;if("\t"===e.indent)i="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;i=Us.call(Array(e.indent+1)," ")}return{base:i,prev:Us.call(Array(t+1),i)}}(r,s);if(void 0===o)o=[];else if(gn(o,t)>=0)return"[Circular]";function y(t,i,n){if(i&&(o=Vs.call(o)).push(i),n){var a={depth:r.depth};return pn(r,"quoteStyle")&&(a.quoteStyle=r.quoteStyle),e(t,a,s+1,o)}return e(t,r,s+1,o)}if("function"==typeof t&&!cn(t)){var g=function(e){if(e.name)return e.name;var t=Bs.call(Ls.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),f=Sn(t,y);return"[Function"+(g?": "+g:" (anonymous)")+"]"+(f.length>0?" { "+Us.call(f,", ")+" }":"")}if(dn(t)){var m=Ys?Ws.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ks.call(t);return"object"!=typeof t||Ys?m:bn(m)}if((u=t)&&"object"==typeof u&&("undefined"!=typeof HTMLElement&&u instanceof HTMLElement||"string"==typeof u.nodeName&&"function"==typeof u.getAttribute)){for(var b="<"+Hs.call(String(t.nodeName)),v=t.attributes||[],w=0;w<v.length;w++)b+=" "+v[w].name+"="+an(ln(v[w].value),"double",r);return b+=">",t.childNodes&&t.childNodes.length&&(b+="..."),b+"</"+Hs.call(String(t.nodeName))+">"}if(hn(t)){if(0===t.length)return"[]";var x=Sn(t,y);return p&&!function(e){for(var t=0;t<e.length;t++)if(gn(e[t],"\n")>=0)return!1;return!0}(x)?"["+xn(x,p)+"]":"[ "+Us.call(x,", ")+" ]"}if(function(e){return!("[object Error]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}(t)){var S=Sn(t,y);return"cause"in Error.prototype||!("cause"in t)||Js.call(t,"cause")?0===S.length?"["+String(t)+"]":"{ ["+String(t)+"] "+Us.call(S,", ")+" }":"{ ["+String(t)+"] "+Us.call(_s.call("[cause]: "+y(t.cause),S),", ")+" }"}if("object"==typeof t&&a){if(nn&&"function"==typeof t[nn]&&tn)return tn(t,{depth:d-s});if("symbol"!==a&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!Ts||!e||"object"!=typeof e)return!1;try{Ts.call(e);try{As.call(e)}catch(b){return!0}return e instanceof Map}catch(xc){}return!1}(t)){var k=[];return Ps&&Ps.call(t,(function(e,i){k.push(y(i,t,!0)+" => "+y(e,t))})),wn("Map",Ts.call(t),k,p)}if(function(e){if(!As||!e||"object"!=typeof e)return!1;try{As.call(e);try{Ts.call(e)}catch(t){return!0}return e instanceof Set}catch(xc){}return!1}(t)){var I=[];return Os&&Os.call(t,(function(e){I.push(y(e,t))})),wn("Set",As.call(t),I,p)}if(function(e){if(!Es||!e||"object"!=typeof e)return!1;try{Es.call(e,Es);try{Ms.call(e,Ms)}catch(b){return!0}return e instanceof WeakMap}catch(xc){}return!1}(t))return vn("WeakMap");if(function(e){if(!Ms||!e||"object"!=typeof e)return!1;try{Ms.call(e,Ms);try{Es.call(e,Es)}catch(b){return!0}return e instanceof WeakSet}catch(xc){}return!1}(t))return vn("WeakSet");if(function(e){if(!Ds||!e||"object"!=typeof e)return!1;try{return Ds.call(e),!0}catch(xc){}return!1}(t))return vn("WeakRef");if(function(e){return!("[object Number]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}(t))return bn(y(Number(t)));if(function(e){if(!e||"object"!=typeof e||!qs)return!1;try{return qs.call(e),!0}catch(xc){}return!1}(t))return bn(y(qs.call(t)));if(function(e){return!("[object Boolean]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}(t))return bn(zs.call(t));if(function(e){return!("[object String]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}(t))return bn(y(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&t===globalThis||void 0!==n&&t===n)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==yn(e)||Qs&&"object"==typeof e&&Qs in e)}(t)&&!cn(t)){var T=Sn(t,y),P=Zs?Zs(t)===Object.prototype:t instanceof Object||t.constructor===Object,C=t instanceof Object?"":"null prototype",j=!P&&Qs&&Object(t)===t&&Qs in t?Gs.call(yn(t),8,-1):C?"Object":"",A=(P||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(j||C?"["+Us.call(_s.call([],j||[],C||[]),": ")+"] ":"");return 0===T.length?A+"{}":p?A+"{"+xn(T,p)+"}":A+"{ "+Us.call(T,", ")+" }"}return String(t)},Pn=Ke,Cn=kn("%WeakMap%",!0),jn=kn("%Map%",!0),An=In("WeakMap.prototype.get",!0),On=In("WeakMap.prototype.set",!0),En=In("WeakMap.prototype.has",!0),Mn=In("Map.prototype.get",!0),Dn=In("Map.prototype.set",!0),zn=In("Map.prototype.has",!0),Fn=function(e,t){for(var i,s=e;null!==(i=s.next);s=i)if(i.key===t)return s.next=i.next,i.next=e.next,e.next=i,i},Ln=function(){var e,t,i,s={assert:function(e){if(!s.has(e))throw new Pn("Side channel does not contain "+Tn(e))},get:function(s){if(Cn&&s&&("object"==typeof s||"function"==typeof s)){if(e)return An(e,s)}else if(jn){if(t)return Mn(t,s)}else if(i)return function(e,t){var i=Fn(e,t);return i&&i.value}(i,s)},has:function(s){if(Cn&&s&&("object"==typeof s||"function"==typeof s)){if(e)return En(e,s)}else if(jn){if(t)return zn(t,s)}else if(i)return function(e,t){return!!Fn(e,t)}(i,s);return!1},set:function(s,n){Cn&&s&&("object"==typeof s||"function"==typeof s)?(e||(e=new Cn),On(e,s,n)):jn?(t||(t=new jn),Dn(t,s,n)):(i||(i={key:{},next:null}),function(e,t,i){var s=Fn(e,t);s?s.value=i:e.next={key:t,next:e.next,value:i}}(i,s,n))}};return s},Bn=ht,Gn=Ln(),Wn=Ke,Rn={assert:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new Wn("`O` is not an object");if("string"!=typeof t)throw new Wn("`slot` must be a string");if(Gn.assert(e),!Rn.has(e,t))throw new Wn("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new Wn("`O` is not an object");if("string"!=typeof t)throw new Wn("`slot` must be a string");var i=Gn.get(e);return i&&i["$"+t]},has:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new Wn("`O` is not an object");if("string"!=typeof t)throw new Wn("`slot` must be a string");var i=Gn.get(e);return!!i&&Bn(i,"$"+t)},set:function(e,t,i){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new Wn("`O` is not an object");if("string"!=typeof t)throw new Wn("`slot` must be a string");var s=Gn.get(e);s||(s={},Gn.set(e,s)),s["$"+t]=i}};Object.freeze&&Object.freeze(Rn);var Hn,Nn=Rn,_n=SyntaxError,Un="object"==typeof StopIteration?StopIteration:null,Vn={}.toString,$n=Array.isArray||function(e){return"[object Array]"==Vn.call(e)},qn=String.prototype.valueOf,Xn=Object.prototype.toString,Kn=gs(),Yn=function(e){return"string"==typeof e||"object"==typeof e&&(Kn?function(e){try{return qn.call(e),!0}catch(xc){return!1}}(e):"[object String]"===Xn.call(e))},Qn="function"==typeof Map&&Map.prototype?Map:null,Jn="function"==typeof Set&&Set.prototype?Set:null;Qn||(Hn=function(e){return!1});var Zn=Qn?Map.prototype.has:null,eo=Jn?Set.prototype.has:null;Hn||Zn||(Hn=function(e){return!1});var to,io=Hn||function(e){if(!e||"object"!=typeof e)return!1;try{if(Zn.call(e),eo)try{eo.call(e)}catch(xc){return!0}return e instanceof Qn}catch(xc){}return!1},so="function"==typeof Map&&Map.prototype?Map:null,no="function"==typeof Set&&Set.prototype?Set:null;no||(to=function(e){return!1});var oo=so?Map.prototype.has:null,ro=no?Set.prototype.has:null;to||ro||(to=function(e){return!1});var ao=to||function(e){if(!e||"object"!=typeof e)return!1;try{if(ro.call(e),oo)try{oo.call(e)}catch(xc){return!0}return e instanceof no}catch(xc){}return!1},lo=xs,ho=function(e){if(!Un)throw new _n("this environment lacks StopIteration");Nn.set(e,"[[Done]]",!1);var t={next:function(){var e=Nn.get(this,"[[Iterator]]"),t=Nn.get(e,"[[Done]]");try{return{done:t,value:t?void 0:e.next()}}catch(xc){if(Nn.set(e,"[[Done]]",!0),xc!==Un)throw xc;return{done:!0,value:void 0}}}};return Nn.set(t,"[[Iterator]]",e),t};if(et()||Qe()){var co=Symbol.iterator;ps.exports=function(e){return null!=e&&void 0!==e[co]?e[co]():lo(e)?Array.prototype[co].call(e):void 0}}else{var uo=$n,po=Yn,yo=Ht,go=yo("%Map%",!0),fo=yo("%Set%",!0),mo=xi,bo=mo("Array.prototype.push"),vo=mo("String.prototype.charCodeAt"),wo=mo("String.prototype.slice"),xo=function(e){var t=0;return{next:function(){var i,s=t>=e.length;return s||(i=e[t],t+=1),{done:s,value:i}}}},So=function(e,t){if(uo(e)||lo(e))return xo(e);if(po(e)){var i=0;return{next:function(){var t=function(e,t){if(t+1>=e.length)return t+1;var i=vo(e,t);if(i<55296||i>56319)return t+1;var s=vo(e,t+1);return s<56320||s>57343?t+1:t+2}(e,i),s=wo(e,i,t);return i=t,{done:t>e.length,value:s}}}}return t&&void 0!==e["_es6-shim iterator_"]?e["_es6-shim iterator_"]():void 0};if(go||fo){var ko=io,Io=ao,To=mo("Map.prototype.forEach",!0),Po=mo("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var Co=mo("Map.prototype.iterator",!0),jo=mo("Set.prototype.iterator",!0);var Ao=mo("Map.prototype.@@iterator",!0)||mo("Map.prototype._es6-shim iterator_",!0),Oo=mo("Set.prototype.@@iterator",!0)||mo("Set.prototype._es6-shim iterator_",!0);ps.exports=function(e){return function(e){if(ko(e)){if(Co)return ho(Co(e));if(Ao)return Ao(e);if(To){var t=[];return To(e,(function(e,i){bo(t,[i,e])})),xo(t)}}if(Io(e)){if(jo)return ho(jo(e));if(Oo)return Oo(e);if(Po){var i=[];return Po(e,(function(e){bo(i,e)})),xo(i)}}}(e)||So(e)}}else ps.exports=function(e){if(null!=e)return So(e,!0)}}var Eo=ps.exports,Mo=function(e){return e!=e},Do=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!Mo(e)||!Mo(t))},zo=Do,Fo=function(){return"function"==typeof Object.is?Object.is:zo},Lo=Fo,Bo=li,Go=li,Wo=Do,Ro=Fo,Ho=mi(Ro(),Object);Go(Ho,{getPolyfill:Ro,implementation:Wo,shim:function(){var e=Lo();return Bo(Object,{is:e},{is:function(){return Object.is!==e}}),e}});var No,_o,Uo,Vo,$o=Ho,qo=mi,Xo=xi,Ko=Ht("%ArrayBuffer%",!0),Yo=Xo("ArrayBuffer.prototype.byteLength",!0),Qo=Xo("Object.prototype.toString"),Jo=!!Ko&&!Yo&&new Ko(0).slice,Zo=!!Jo&&qo(Jo),er=Yo||Zo?function(e){if(!e||"object"!=typeof e)return!1;try{return Yo?Yo(e):Zo(e,0),!0}catch(xc){return!1}}:Ko?function(e){return"[object ArrayBuffer]"===Qo(e)}:function(e){return!1},tr=Date.prototype.getDay,ir=Object.prototype.toString,sr=gs(),nr=xi,or=gs();if(or){No=nr("Object.prototype.hasOwnProperty"),_o=nr("RegExp.prototype.exec"),Uo={};var rr=function(){throw Uo};Vo={toString:rr,valueOf:rr},"symbol"==typeof Symbol.toPrimitive&&(Vo[Symbol.toPrimitive]=rr)}var ar=nr("Object.prototype.toString"),lr=Object.getOwnPropertyDescriptor,hr=or?function(e){if(!e||"object"!=typeof e)return!1;var t=lr(e,"lastIndex");if(!t||!No(t,"value"))return!1;try{_o(e,Vo)}catch(xc){return xc===Uo}}:function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&"[object RegExp]"===ar(e)},cr=xi("SharedArrayBuffer.prototype.byteLength",!0),dr=cr?function(e){if(!e||"object"!=typeof e)return!1;try{return cr(e),!0}catch(xc){return!1}}:function(e){return!1},ur=Number.prototype.toString,pr=Object.prototype.toString,yr=gs(),gr=xi,fr=gr("Boolean.prototype.toString"),mr=gr("Object.prototype.toString"),br=gs(),vr={exports:{}},wr=Object.prototype.toString;if(et()){var xr=Symbol.prototype.toString,Sr=/^Symbol\(.*\)$/;vr.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==wr.call(e))return!1;try{return function(e){return"symbol"==typeof e.valueOf()&&Sr.test(xr.call(e))}(e)}catch(xc){return!1}}}else vr.exports=function(e){return!1};var kr=vr.exports,Ir={exports:{}},Tr="undefined"!=typeof BigInt&&BigInt;if("function"==typeof Tr&&"function"==typeof BigInt&&"bigint"==typeof Tr(42)&&"bigint"==typeof BigInt(42)){var Pr=BigInt.prototype.valueOf;Ir.exports=function(e){return null!=e&&"boolean"!=typeof e&&"string"!=typeof e&&"number"!=typeof e&&"symbol"!=typeof e&&"function"!=typeof e&&("bigint"==typeof e||function(e){try{return Pr.call(e),!0}catch(xc){}return!1}(e))}}else Ir.exports=function(e){return!1};var Cr,jr=Ir.exports,Ar=Yn,Or=kr,Er=jr,Mr="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,Dr="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;Mr||(Cr=function(e){return!1});var zr=Mr?Mr.prototype.has:null,Fr=Dr?Dr.prototype.has:null;Cr||zr||(Cr=function(e){return!1});var Lr=Cr||function(e){if(!e||"object"!=typeof e)return!1;try{if(zr.call(e,zr),Fr)try{Fr.call(e,Fr)}catch(xc){return!0}return e instanceof Mr}catch(xc){}return!1},Br={exports:{}},Gr=xi,Wr=Ht("%WeakSet%",!0),Rr=Gr("WeakSet.prototype.has",!0);if(Rr){var Hr=Gr("WeakMap.prototype.has",!0);Br.exports=function(e){if(!e||"object"!=typeof e)return!1;try{if(Rr(e,Rr),Hr)try{Hr(e,Hr)}catch(xc){return!0}return e instanceof Wr}catch(xc){}return!1}}else Br.exports=function(e){return!1};var Nr,_r,Ur=Br.exports,Vr=io,$r=ao,qr=Lr,Xr=Ur,Kr=Function.prototype.toString,Yr="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof Yr&&"function"==typeof Object.defineProperty)try{Nr=Object.defineProperty({},"length",{get:function(){throw _r}}),_r={},Yr((function(){throw 42}),null,Nr)}catch(Sc){Sc!==_r&&(Yr=null)}else Yr=null;var Qr=/^\s*class\b/,Jr=function(e){try{var t=Kr.call(e);return Qr.test(t)}catch(xc){return!1}},Zr=function(e){try{return!Jr(e)&&(Kr.call(e),!0)}catch(xc){return!1}},ea=Object.prototype.toString,ta="function"==typeof Symbol&&!!Symbol.toStringTag,ia=!(0 in[,]),sa=function(){return!1};if("object"==typeof document){var na=document.all;ea.call(na)===ea.call(document.all)&&(sa=function(e){if((ia||!e)&&(void 0===e||"object"==typeof e))try{var t=ea.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(xc){}return!1})}var oa=Yr?function(e){if(sa(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{Yr(e,null,Nr)}catch(xc){if(xc!==_r)return!1}return!Jr(e)&&Zr(e)}:function(e){if(sa(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(ta)return Zr(e);if(Jr(e))return!1;var t=ea.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&Zr(e)},ra=Object.prototype.toString,aa=Object.prototype.hasOwnProperty,la=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],ha="undefined"==typeof globalThis?n:globalThis,ca=function(e,t,i){if(!oa(t))throw new TypeError("iterator must be a function");var s;arguments.length>=3&&(s=i),"[object Array]"===ra.call(e)?function(e,t,i){for(var s=0,n=e.length;s<n;s++)aa.call(e,s)&&(null==i?t(e[s],s,e):t.call(i,e[s],s,e))}(e,t,s):"string"==typeof e?function(e,t,i){for(var s=0,n=e.length;s<n;s++)null==i?t(e.charAt(s),s,e):t.call(i,e.charAt(s),s,e)}(e,t,s):function(e,t,i){for(var s in e)aa.call(e,s)&&(null==i?t(e[s],s,e):t.call(i,e[s],s,e))}(e,t,s)},da=mi,ua=xi,pa=Vt,ya=ua("Object.prototype.toString"),ga=gs(),fa="undefined"==typeof globalThis?n:globalThis,ma=function(){for(var e=[],t=0;t<la.length;t++)"function"==typeof ha[la[t]]&&(e[e.length]=la[t]);return e}(),ba=ua("String.prototype.slice"),va=Object.getPrototypeOf,wa=ua("Array.prototype.indexOf",!0)||function(e,t){for(var i=0;i<e.length;i+=1)if(e[i]===t)return i;return-1},xa={__proto__:null};ca(ma,ga&&pa&&va?function(e){var t=new fa[e];if(Symbol.toStringTag in t){var i=va(t),s=pa(i,Symbol.toStringTag);if(!s){var n=va(i);s=pa(n,Symbol.toStringTag)}xa["$"+e]=da(s.get)}}:function(e){var t=new fa[e],i=t.slice||t.set;i&&(xa["$"+e]=da(i))});var Sa=xi("ArrayBuffer.prototype.byteLength",!0),ka=er,Ia=Wi,Ta=xi,Pa=us,Ca=Ht,ja=Eo,Aa=Ln,Oa=$o,Ea=xs,Ma=$n,Da=er,za=function(e){return"object"==typeof e&&null!==e&&(sr?function(e){try{return tr.call(e),!0}catch(xc){return!1}}(e):"[object Date]"===ir.call(e))},Fa=hr,La=dr,Ba=_e,Ga=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e?null:Ar(e)?"String":function(e){return"number"==typeof e||"object"==typeof e&&(yr?function(e){try{return ur.call(e),!0}catch(xc){return!1}}(e):"[object Number]"===pr.call(e))}(e)?"Number":function(e){return"boolean"==typeof e||null!==e&&"object"==typeof e&&(br&&Symbol.toStringTag in e?function(e){try{return fr(e),!0}catch(xc){return!1}}(e):"[object Boolean]"===mr(e))}(e)?"Boolean":Or(e)?"Symbol":Er(e)?"BigInt":void 0},Wa=function(e){if(e&&"object"==typeof e){if(Vr(e))return"Map";if($r(e))return"Set";if(qr(e))return"WeakMap";if(Xr(e))return"WeakSet"}return!1},Ra=function(e){if(!e||"object"!=typeof e)return!1;if(!ga){var t=ba(ya(e),8,-1);return wa(ma,t)>-1?t:"Object"===t&&function(e){var t=!1;return ca(xa,(function(i,s){if(!t)try{i(e),t=ba(s,1)}catch(xc){}})),t}(e)}return pa?function(e){var t=!1;return ca(xa,(function(i,s){if(!t)try{"$"+i(e)===s&&(t=ba(s,1))}catch(xc){}})),t}(e):null},Ha=function(e){return ka(e)?Sa?Sa(e):e.byteLength:NaN},Na=Ta("SharedArrayBuffer.prototype.byteLength",!0),_a=Ta("Date.prototype.getTime"),Ua=Object.getPrototypeOf,Va=Ta("Object.prototype.toString"),$a=Ca("%Set%",!0),qa=Ta("Map.prototype.has",!0),Xa=Ta("Map.prototype.get",!0),Ka=Ta("Map.prototype.size",!0),Ya=Ta("Set.prototype.add",!0),Qa=Ta("Set.prototype.delete",!0),Ja=Ta("Set.prototype.has",!0),Za=Ta("Set.prototype.size",!0);function el(e,t,i,s){for(var n,o=ja(e);(n=o.next())&&!n.done;)if(ol(t,n.value,i,s))return Qa(e,n.value),!0;return!1}function tl(e){return void 0===e?null:"object"!=typeof e?"symbol"!=typeof e&&("string"!=typeof e&&"number"!=typeof e||+e==+e):void 0}function il(e,t,i,s,n,o){var r=tl(i);if(null!=r)return r;var a=Xa(t,r),l=Ia({},n,{strict:!1});return!(void 0===a&&!qa(t,r)||!ol(s,a,l,o))&&!qa(e,r)&&ol(s,a,l,o)}function sl(e,t,i){var s=tl(i);return null!=s?s:Ja(t,s)&&!Ja(e,s)}function nl(e,t,i,s,n,o){for(var r,a,l=ja(e);(r=l.next())&&!r.done;)if(ol(i,a=r.value,n,o)&&ol(s,Xa(t,a),n,o))return Qa(e,a),!0;return!1}function ol(e,t,i,s){var n=i||{};if(n.strict?Oa(e,t):e===t)return!0;if(Ga(e)!==Ga(t))return!1;if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return n.strict?Oa(e,t):e==t;var o,r=s.has(e),a=s.has(t);if(r&&a){if(s.get(e)===s.get(t))return!0}else o={};return r||s.set(e,o),a||s.set(t,o),function(e,t,i,s){var n,o;if(typeof e!=typeof t)return!1;if(null==e||null==t)return!1;if(Va(e)!==Va(t))return!1;if(Ea(e)!==Ea(t))return!1;if(Ma(e)!==Ma(t))return!1;var r=e instanceof Error,a=t instanceof Error;if(r!==a)return!1;if((r||a)&&(e.name!==t.name||e.message!==t.message))return!1;var l=Fa(e),h=Fa(t);if(l!==h)return!1;if((l||h)&&(e.source!==t.source||Pa(e)!==Pa(t)))return!1;var c=za(e),d=za(t);if(c!==d)return!1;if((c||d)&&_a(e)!==_a(t))return!1;if(i.strict&&Ua&&Ua(e)!==Ua(t))return!1;var u=Ra(e),p=Ra(t);if(u!==p)return!1;if(u||p){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var y=rl(e),g=rl(t);if(y!==g)return!1;if(y||g){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var f=Da(e),m=Da(t);if(f!==m)return!1;if(f||m)return Ha(e)===Ha(t)&&"function"==typeof Uint8Array&&ol(new Uint8Array(e),new Uint8Array(t),i,s);var b=La(e),v=La(t);if(b!==v)return!1;if(b||v)return Na(e)===Na(t)&&"function"==typeof Uint8Array&&ol(new Uint8Array(e),new Uint8Array(t),i,s);if(typeof e!=typeof t)return!1;var w=Ba(e),x=Ba(t);if(w.length!==x.length)return!1;for(w.sort(),x.sort(),n=w.length-1;n>=0;n--)if(w[n]!=x[n])return!1;for(n=w.length-1;n>=0;n--)if(!ol(e[o=w[n]],t[o],i,s))return!1;var S=Wa(e),k=Wa(t);return S===k&&("Set"===S||"Set"===k?function(e,t,i,s){if(Za(e)!==Za(t))return!1;for(var n,o,r,a=ja(e),l=ja(t);(n=a.next())&&!n.done;)if(n.value&&"object"==typeof n.value)r||(r=new $a),Ya(r,n.value);else if(!Ja(t,n.value)){if(i.strict)return!1;if(!sl(e,t,n.value))return!1;r||(r=new $a),Ya(r,n.value)}if(r){for(;(o=l.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!el(r,o.value,i.strict,s))return!1}else if(!i.strict&&!Ja(e,o.value)&&!el(r,o.value,i.strict,s))return!1;return 0===Za(r)}return!0}(e,t,i,s):"Map"!==S||function(e,t,i,s){if(Ka(e)!==Ka(t))return!1;for(var n,o,r,a,l,h,c=ja(e),d=ja(t);(n=c.next())&&!n.done;)if(a=n.value[0],l=n.value[1],a&&"object"==typeof a)r||(r=new $a),Ya(r,a);else if(void 0===(h=Xa(t,a))&&!qa(t,a)||!ol(l,h,i,s)){if(i.strict)return!1;if(!il(e,t,a,l,i,s))return!1;r||(r=new $a),Ya(r,a)}if(r){for(;(o=d.next())&&!o.done;)if(a=o.value[0],h=o.value[1],a&&"object"==typeof a){if(!nl(r,e,a,h,i,s))return!1}else if(!(i.strict||e.has(a)&&ol(Xa(e,a),h,i,s)||nl(r,e,a,h,Ia({},i,{strict:!1}),s)))return!1;return 0===Za(r)}return!0}(e,t,i,s))}(e,t,n,s)}function rl(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||e.length>0&&"number"!=typeof e[0]||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}const al=o((function(e,t,i){return ol(e,t,i,Aa())})),ll={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${E}`};class hl extends i.GameObjects.Text{constructor(e,t,i=3500,s=D){const n=Ce(e,hl).reduce(((e,t)=>Math.max(e,t.y-20)),0)+65;super(e,20,n,t,{...ll,backgroundColor:"#"+s,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(w.Overlay).setScrollFactor(0),e.add.existing(this),e.add.tween({targets:this,alpha:1,scale:1.05,y:n+10,duration:350,hold:i,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}let cl=1;class dl extends Phaser.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(e){super({game:e,renderTarget:!0,fragShader:"\nprecision mediump float;\n\nuniform float     uAlpha;\nuniform sampler2D uMainSampler;\n\nvarying vec2 outTexCoord;\n\n// slight modifications made to original shader\n// use alpha channel for fragColor + changed uniform names\n\n// original shader from: https://www.shadertoy.com/view/WsVSzV\n// tips for chromatic aberration: https://lettier.github.io/3d-game-shaders-for-beginners/chromatic-aberration.html\n\nfloat warp = 0.35;     // simulate curvature of CRT monitor (larger number = more curvature)\nfloat scan = 0.75;    // simulate darkness between scanlines\nfloat scanSize = 0.75; // size of scanlines [0.0 - 2.0] (smaller number = taller scanlines)\n\nfloat chromaticAberration = 0.25 * uAlpha;\nfloat redOffset   =  0.006 * chromaticAberration;\nfloat greenOffset =  0.003 * chromaticAberration;\nfloat blueOffset  = -0.003 * chromaticAberration;\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord)\n{\n  if (uAlpha <= 0.0) {\n    fragColor = texture2D(uMainSampler, outTexCoord);\n    return;\n  }\n\n  // squared distance from center\n  vec2 uv = outTexCoord;\n  vec2 dc = abs(0.5-uv);\n  dc *= dc;\n\n  // warp the fragment coordinates\n  uv.x -= 0.5; uv.x *= 1.0+(dc.y*(0.3*warp)); uv.x += 0.5;\n  uv.y -= 0.5; uv.y *= 1.0+(dc.x*(0.4*warp)); uv.y += 0.5;\n\n  vec2 chromaticOffset = vec2((abs(0.5-uv) + 0.5) * 2.);\n\n  vec4 color;\n  color.r = texture2D(uMainSampler,uv + vec2(redOffset * chromaticOffset)).r;\n  color.g = texture2D(uMainSampler,uv + vec2(greenOffset * chromaticOffset)).g;\n  color.b = texture2D(uMainSampler,uv + vec2(blueOffset * chromaticOffset)).b;\n  color.a = texture2D(uMainSampler,uv).a;\n\n  // sample inside boundaries, otherwise set to black\n  if (uv.y > 1.0 || uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0) {\n      fragColor = vec4(0.0);\n  } else {\n    // determine if we are drawing in a scanline\n    float apply = abs(sin(fragCoord.y * scanSize)*0.5*scan);\n\n    apply = uAlpha * apply;\n\n    // sample the texture\n    fragColor = vec4(mix(color.rgb,vec3(0.0), apply), color.a);\n  }\n}\n\nvoid main(void)\n{\n  mainImage(gl_FragColor, gl_FragCoord.xy);\n}\n"})}onPreRender(){this.set1f("uAlpha",cl)}}class ul extends Phaser.Plugins.ScenePlugin{boot(){var e;null==(e=this.systems)||e.events.on("start",this.applyPipeline,this);const{save:t}=bl();pl(t.settings.useShader)}applyPipeline(){var e,t;null==(e=this.scene)||e.cameras.main.setPostPipeline("CRTPipeline"),(null==(t=this.scene)?void 0:t.cameras.main.getPostPipeline(dl)).bootFX()}}function pl(e){v.useShader=void 0!==e?e:!v.useShader,cl=v.useShader?1:0}let yl=0;class gl extends Phaser.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(e){super({game:e,fragShader:"\nprecision mediump float;\n\nuniform float     uAlpha;\nuniform sampler2D uMainSampler;\n\nvarying vec2 outTexCoord;\n\nvoid main(void)\n{\n  vec4 baseColor = vec4(texture2D(uMainSampler, outTexCoord).rgba);\n  vec4 newColor = baseColor;\n  newColor.g *= 1.25;\n  newColor.r *= 2.5;\n  newColor.b *= 3.;\n\n  gl_FragColor = mix(baseColor, newColor, uAlpha);\n}\n"})}onPreRender(){this.set1f("uAlpha",yl)}}function fl(e,t){yl!==(t?.85:0)&&e.tweens.addCounter({from:yl,to:t?.85:0,onUpdate:e=>{yl=e.getValue()},duration:2500,ease:"Bounce"})}function ml(e){return{player:{x:e.player.x,y:e.player.y,flip:e.player.flipX},journal:e.player.journal.journal.sort(),inventory:e.player.inventory.inventory.sort(((e,t)=>e.type-t.type)),quests:e.player.quests.quests.sort(((e,t)=>e.id-t.id)),gameState:e.player.gameState.data,settings:{gamepad:e.gamepad.visible,debug:v.debug,zoomed:v.zoomed,useShader:v.useShader,time:Date.now(),muted:e.sound.mute}}}function bl(){const e=localStorage.getItem(Wh);let t,i;try{e&&(t=JSON.parse(e))}catch(s){console.error(s),i=s}return{save:t||_h[Rh.New],error:i,newGame:!t}}const vl={journal:{enumObj:C,enumName:"JournalEntry"},inventory:{enumObj:k,enumName:"ItemType"},type:{enumObj:k,enumName:"ItemType"},quests:{enumObj:I,enumName:"QuestType"},id:{enumObj:I,enumName:"QuestType"}};function wl(e,t){const i={...v};return v.debug=e.settings.debug,v.zoomed=e.settings.zoomed,v.useShader=e.settings.useShader,pl(v.useShader),fl(t,!1),v.zoomed!==i.zoomed?(function(e,t){const i=t?l:a;v.zoomed=t,v.width=i.width,v.height=i.height,v.cameraOffset=i.height/3,e.scale.setGameSize(i.width,i.height),e.scene.restart()}(t,v.zoomed),!0):v.debug!==i.debug&&(t.scene.restart(),!0)}function xl(e){const{save:t,error:i,newGame:s}=bl();i&&new hl(e,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4);try{wl(t,e),e.sound.mute=t.settings.muted,e.player.setX(t.player.x),e.player.setY(t.player.y),e.player.setFlipX(t.player.flip),e.time.delayedCall(50,(()=>{try{e.player.inventory.createUI(),e.player.quests.createUI(),e.player.journal.createUI(),s&&function(e){e.player.message.setDialog({messages:["Now that I have arrived in town, I should talk to the townsfolk about the strange occurrences.","Maybe someone has seen something that could help me start my investigation."]},void 0,"player_portrait")}(e),t.inventory.sort(((e,t)=>e.type-t.type)).forEach((t=>e.player.inventory.addItem(t,!0))),t.journal.sort().reverse().forEach((t=>e.player.journal.addEntry(t,!0))),t.quests.sort(((e,t)=>e.id-t.id)).forEach((t=>e.player.quests.addQuest(t,!0))),e.player.gameState.updateData(t.gameState,!0)}catch(i){console.error(i),new hl(e,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4,F),Sl(e,_h[Rh.New]),xl(e)}})),e.gamepad.setVisible(t.settings.gamepad);const i=al(t,_h[Rh.New])?"[New]":"[Storage]";v.prod||e.time.delayedCall(200,(()=>{new hl(e,`Game Loaded ${v.prod?"":i}`)})),al(t,_h[Rh.New])&&Sl(e,void 0,!0)}catch(n){console.error(n),new hl(e,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4,F),Sl(e,_h[Rh.New]),xl(e)}}function Sl(e,t,i){const s=ml(e);localStorage.setItem(Wh,JSON.stringify(t||s)),i||e.tweens.add({targets:e.saveIcon,alpha:.7,scale:.6,duration:500,hold:250,yoyo:!0})}function kl(e){v.prod&&Sl(e)}class Il extends i.GameObjects.Container{constructor(e,i){var s;super(e,0,0),t(this,"text"),t(this,"rect"),t(this,"player"),t(this,"activeElement"),t(this,"outline"),t(this,"scene"),t(this,"dayNight",!1),this.scene=e,this.player=i,e.physics.world.drawDebug=v.debug,v.debug?e.physics.world.createDebugGraphic():null==(s=e.physics.world.debugGraphic)||s.clear(),this.createEventListeners(),v.debug&&(this.setScrollFactor(0).setDepth(w.Debug).setAlpha(.8),this.scene.add.existing(this),this.rect=e.add.rectangle(0,0,0,0,H(z)).setOrigin(0).setDepth(w.Debug),this.add(this.rect),this.text=e.add.bitmapText(20,90,"m6x11-24",""),this.add(this.text),this.outline=e.add.rectangle(0,0,0,0).setStrokeStyle(2,65280).setScale(1.1).setDepth(w.Debug))}createEventListeners(){var e,t,i,s,n,o,r,a,l;null==(e=this.scene.input.keyboard)||e.on("keydown-K",(()=>{Sl(this.scene)})),null==(t=this.scene.input.keyboard)||t.on("keydown-L",(()=>{this.scene.scene.restart()})),null==(i=this.scene.input.keyboard)||i.on("keydown-M",(()=>{Sl(this.scene,_h[Rh.Act2]),this.scene.scene.restart()})),null==(s=this.scene.input.keyboard)||s.on("keydown-N",(()=>{localStorage.removeItem(Wh),this.scene.scene.start("Preloader")})),null==(n=this.scene.input.keyboard)||n.on("keydown-Z",(()=>{v.debug=!v.debug,Sl(this.scene),this.scene.scene.restart()})),null==(o=this.scene.input.keyboard)||o.on("keydown-FORWARD_SLASH",(()=>{var e;q(e=this.scene)?function(e,t=!0){$||(K(e,G,t),Y(e,1),e.lights.lights.forEach((i=>{const s=i.intensity;i.setVisible(!0),t&&(i.setIntensity(0),e.tweens.add({targets:i,duration:V,intensity:s}))})))}(e):X(e)})),null==(r=this.scene.input.keyboard)||r.on("keydown-CLOSED_BRACKET",(()=>{te(this.scene,"DebugTool")})),v.debug&&(null==(a=this.scene.input.keyboard)||a.on("keydown-COMMA",(()=>{const e=this.scene.lights.lights;console.table(e,["x","y"])})),null==(l=this.scene.input.keyboard)||l.on("keydown-PERIOD",(()=>{const e=this.scene.input.activePointer;new re(this.scene,e.worldX,e.worldY,100,H(B),1)})),this.scene.input.on("gameobjectdown",((e,t)=>{1===e.buttons&&(t!==this.activeElement?this.activeElement=t:this.activeElement=void 0)})),this.scene.input.on("drag",((e,t)=>{this.activeElement===t&&t.setPosition(e.worldX,e.worldY)})),this.scene.input.on("wheel",((e,t,i,s,n)=>{this.scene.cameras.main.zoom=Math.max(.01,this.scene.cameras.main.zoom+5e-4*s)})),this.scene.input.on("pointerup",(e=>{1===e.button&&(this.scene.cameras.main.zoom=1)})))}update(){if(!v.debug)return;const e=this.scene.input.activePointer,t=[`FPS: ${this.scene.game.loop.actualFps.toFixed(1)}`,`Frame Time: ${this.scene.game.loop.delta.toFixed(2)}`,`Zoom: ${this.scene.cameras.main.zoom.toFixed(2)}`,"",`Player x: ${this.player.x.toFixed(1)}`,`Player y: ${this.player.y.toFixed(1)}`,"",`Mouse x: ${e.worldX.toFixed(1)}`,`Mouse y: ${e.worldY.toFixed(1)}`];if(this.activeElement&&(t.push(""),t.push(`Active x: ${this.activeElement.x.toFixed(1)}`),t.push(`Active y: ${this.activeElement.y.toFixed(1)}`)),this.text.setText(t),this.rect.setPosition(this.text.x-10,this.text.y-10).setSize(this.text.displayWidth+20,this.text.displayHeight+20),this.activeElement){this.outline.setPosition(this.activeElement.x,this.activeElement.y),this.outline.setSize(this.activeElement.displayWidth,this.activeElement.displayHeight),this.outline.setOrigin(this.activeElement.originX,this.activeElement.originY);const e=this.activeElement.body;(e&&e instanceof i.Physics.Arcade.Body||e instanceof i.Physics.Arcade.StaticBody)&&e.updateFromGameObject()}else this.outline.setSize(0,0)}}class Tl extends i.Physics.Arcade.Image{constructor(e,s,n){var o;const{x:r,y:a,image:l,scale:h}=s;super(e,r,a,l),t(this,"player"),t(this,"initialized",!1),t(this,"info"),t(this,"center"),this.name=`Background-${s.image}`,this.info=s,this.player=n,this.setOrigin(0).setDepth(w.Backgrounds),Me(this,s);const c=null==(o=e.textures.get(l))?void 0:o.getSourceImage();this.center=new i.Math.Vector2(r+c.width*(h||1)/2,a+c.height*((h||1)/2)),v.debug&&e.add.rectangle(this.center.x,this.center.y,c.width,c.height).setStrokeStyle(10,26214).setOrigin(.5)}lazyInit(e){(e||!this.initialized&&ee(this.center,this.player,2e3))&&(this.scene.add.existing(this),this.scene.physics.add.existing(this),v.debug&&this.setInteractive({draggable:!0}),this.initialized=!0)}update(){this.lazyInit()}}function Pl(){return Math.random()-.5}v.dayMinutes,i.GameObjects.Container;const Cl=[3200,600],jl=[5350,690],Al=[500,200,100,50,10];class Ol extends i.GameObjects.GameObject{constructor(e,s,n,o=40,r=[1400,600]){super(e,"fireflies"),t(this,"scene"),t(this,"center",new i.Math.Vector2(0,0)),t(this,"lights",[]),t(this,"count"),t(this,"centers",[]),t(this,"bounds",[1e3,400]),t(this,"biases",[]),t(this,"initialized",!1),t(this,"debug"),e.add.existing(this),this.scene=e,this.count=o,this.bounds=r,this.setPosition(s,n)}setPosition(e,t){this.center.set(e,t),this.centers=[];for(let s=0;s<this.count;s++)this.centers.push(new i.Math.Vector2(e+Math.random()*this.bounds[0]-this.bounds[0]/2,t+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(e-this.bounds[0]/2,t-this.bounds[1]/2)}lazyInit(e){if(e||!this.initialized&&ee(this.center,this.scene.player)){for(let e=0;e<this.count;e++){const e=new i.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),t=this.scene.lights.addPointLight(0,0,e.color,7*Math.random()+3,.15,.045+.02*Pl());this.lights.push(t);const s=[];for(let i=0;i<2*Al.length;i++)s.push(Pl()*Al[i%Al.length]);s.push(10*Pl()),this.biases.push(s)}v.debug&&(this.debug=this.scene.add.graphics().fillStyle(16711680,.5).lineStyle(2,16711680,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])),this.setPosition(this.center.x,this.center.y),this.initialized=!0}}update(e,t){if(this.lazyInit(),!(Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0]))return void this.lights.forEach((e=>e.visible=!1));const i=e/1e3*.025,s=Math.cos(i),n=Math.sin(i);this.lights.forEach(((e,t)=>{const o=this.biases[t],r=Math.cos(70*i+o[10]);e.visible=!0,e.intensity=Math.min(.05+Math.abs(o[4]*r+o[3]*s+o[4]*s)/50,.4),e.x=s*o[0]+n*o[1]+s*o[2]+n*o[3]+s*o[4]+this.centers[t].x,e.y=n*o[5]+s*o[6]+n*o[7]+s*o[8]+n*o[9]+this.centers[t].y}))}}const El={[A.LabStairs]:{x:-1670,y:1730,size:{x:80,y:80},text:"Press [UP] to go upstairs"}};class Ml extends i.GameObjects.Image{constructor(e,i,s){const{x:n,y:o}=El[i];super(e,n,o,""),t(this,"player"),t(this,"disabled",!1),t(this,"initialized",!1),this.name=`HelperText-${i}`,this.player=s}lazyInit(e){if(!e&&(this.initialized||!ee(this,this.player)))return;const{size:t}=El[A.LabStairs];this.setDepth(w.Items),this.setDisplaySize(t.x,t.y),v.debug||this.setAlpha(0),this.scene.add.existing(this),this.scene.physics.add.existing(this),v.debug&&this.setInteractive({draggable:!0}),this.initialized=!0}getButtonPrompt(){return El[A.LabStairs].text}onInteract(e){return x.None}update(){this.lazyInit()}}class Dl extends i.GameObjects.Text{constructor(e){super(e,v.width/2,v.height-50,"",ll),this.setOrigin(.5).setBackgroundColor("#"+z).setPadding(10,5).setAlign("center").setAlpha(.8).setScrollFactor(0).setDepth(w.Overlay).setVisible(!1),e.add.existing(this)}}const zl={octave:3.5,speed:1,volume:1,type:"sine"},Fl={[T.Inventor]:{octave:3.3,speed:1,volume:1.8},[T.Stranger]:{octave:2.8,speed:1.1,volume:2.6},[T.Sphinx]:{octave:2.5,speed:2,volume:2,type:"triangle"},[T.Mayor]:{octave:3.9,speed:.8,volume:.8},[T.ClockTower]:{octave:2.1,speed:1.5,volume:1.5,type:"sawtooth"},player:{octave:3.7,speed:.75,volume:.9}},Ll=["C","C#","D","Eb","E","F","F#","G","G#","A","Bb","B"];function Bl(e,t){var i=Ll.indexOf(e);return 440*Math.pow(2,(12*t+i-57)/12)}function Gl(e,t,i){const{speed:s,octave:n,volume:o,type:r}=t;if(0===i)return{promise:Promise.resolve()};const a=new AudioContext,l=a.createOscillator(),h=a.createGain();l.type=r||"sine",l.connect(h),h.connect(a.destination);const c=1e-7;h.gain.value=c,l.start();const d=function(e){const t=e;let i=0;for(let s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s),i|=0;return Math.abs(i)}(e),u=function(e){return function(){return((e=(1664525*e+1013904223)%4294967296)>>>0)/4294967296}}(d);let p=a.currentTime,y=0;const g=Math.floor(1/s*e.length);for(console.log(e,e.length);y<g;){const t=y,r=1+Math.floor(3*u());y+=r;const a=2+Math.floor(15*u());y+=a;const d=e.substring(t,y).match(/[,.!?]/),f=y>=g||u()>.05&&!d,m=(.005+.01*u())*s,b=0===y?.05:.005,v=(.05+.035*u()*r)*s,w=y>=g?.2:.005,x=Bl(Ll[Math.floor(12*u())],n);l.frequency.setValueAtTime(x,p+m);const S=(f?1:0)*i*(.6+.2*u())*(o||1);h.gain.setValueAtTime(c,p+m),h.gain.linearRampToValueAtTime(S,p+m+b),h.gain.setValueAtTime(S,p+m+b+v),h.gain.linearRampToValueAtTime(c,p+m+b+v+w),p+=m+b+v+w,p+=.01*a*s}let f=!1;const m=()=>{if(f)return;f=!0;let e=0;if(a.currentTime<p){const t=.25;h.gain.cancelScheduledValues(a.currentTime),h.gain.linearRampToValueAtTime(c,a.currentTime+t),e=1e3*t}setTimeout((()=>{l.stop(),a.close()}),e+50)};return{promise:new Promise((e=>{setTimeout((()=>{m(),e()}),1e3*(p-a.currentTime))})),stop:m}}class Wl extends i.GameObjects.Text{constructor(e,i,s,n,o,r){super(e,i,s,n,{...ll,fontSize:48,backgroundColor:`#${D}`,padding:{x:15,y:10},...r}),t(this,"onClick"),t(this,"disabled"),t(this,"selected"),this.setOrigin(.5),e.add.existing(this),this.onClick=o,this.disabled=!1,this.selected=!1,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>{this.disabled||(this.setSelected(!1),o(this))})),this.on("pointerover",(()=>{this.disabled||this.selected||this.setTint(12303291)})),this.on("pointerout",(()=>{this.disabled||this.selected||this.setTint(16777215)}))}disable(){this.disabled=!0,this.selected=!1,this.disableInteractive(),this.setTint(6710886)}enable(){this.disabled=!1,this.selected=!1,this.setInteractive(),this.setTint(16777215)}setSelected(e){this.selected=e,this.setTint(e?H(R):16777215)}}class Rl extends Wl{constructor(e,t,i,s,n,o,r,a){super(e,t,i,s,n,{fontSize:32,align:"center",...o}),this.setOrigin((null==a?void 0:a.x)||0,(null==a?void 0:a.y)||0),null!==r&&this.setFixedSize((null==r?void 0:r.x)||250,(null==r?void 0:r.y)||50)}}class Hl extends i.GameObjects.Container{constructor(e,i,s){var n,o,r;super(e,i,s),t(this,"buttons",[]),t(this,"activeIndex",-1),e.add.existing(this).setScrollFactor(0),null==(n=e.input.keyboard)||n.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(o=e.input.keyboard)||o.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(r=e.input.keyboard)||r.on("keydown-ENTER",(()=>{var e;null==(e=this.buttons[this.activeIndex])||e.onClick(this.buttons[this.activeIndex])}))}addButton(e){this.add(e),this.buttons.push(e),1===this.buttons.length&&this.setActiveButton(0),e.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(e){var t,i;null==(t=this.buttons[this.activeIndex])||t.setSelected(!1),this.activeIndex=e,null==(i=this.buttons[this.activeIndex])||i.setSelected(!0)}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const Nl=20;class _l extends i.GameObjects.Container{constructor(e,i){var s,n;super(e),t(this,"textWidth"),t(this,"textHeight"),t(this,"player"),t(this,"target"),t(this,"npcName"),t(this,"text"),t(this,"portrait"),t(this,"options"),t(this,"optionsContainer"),t(this,"dialog"),t(this,"messageIndex"),t(this,"interactionTimeout"),t(this,"gamepadVisible",!1),t(this,"initialized",!1),t(this,"animating",!1),t(this,"stopAnimation"),t(this,"stopAudio");const{width:o,height:r}=v;this.textWidth=o-135-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(Nl,r-Nl-170),this.setDepth(w.Overlay),this.setAlpha(0),this.setVisible(!1),i&&(this.player=i),null==(s=this.scene.input.keyboard)||s.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(n=this.scene.input.keyboard)||n.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}createUI(){this.scene.add.existing(this),this.npcName=new i.GameObjects.Text(this.scene,170,15,"",{...ll,color:"#"+M}),this.text=this.scene.add.text(170,60,"",ll),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(5),this.portrait=this.scene.add.image(Nl,Nl,"").setOrigin(0).setScale(1.5);const e=this.scene.add.rectangle(0,0,v.width-40,170,H(z),.8).setStrokeStyle(2,H(M),1).setOrigin(0,0).setScrollFactor(0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.options||this.updateDialog()}));this.optionsContainer=new Hl(this.scene).setDepth(w.Overlay);const t=this.scene.add.image(v.width-40-20,154,"chevron-down").setScale(.5);this.scene.tweens.add({targets:t,y:148,scale:.4,duration:1e3,ease:"Sine.easeInOut",yoyo:!0,repeat:-1}),this.add([e,this.npcName,this.text,this.portrait,t])}setDialog(e,t,i){var s,n;if(this.npcName||this.createUI(),this.gamepadVisible=(null==(s=this.scene.gamepad)?void 0:s.visible)||!1,this.setVisible(!0),this.scene.tweens.add({targets:this,alpha:void 0!==e?1:0,duration:125,onComplete:()=>this.setVisible(void 0!==e)}),this.target=t,this.messageIndex=0,this.dialog=e,this.interactionTimeout=Date.now()+350,null==(n=this.scene.gamepad)||n.setVisible(void 0===this.dialog&&this.gamepadVisible),!e)return;const o=i||(t instanceof de?O[t.npcType].portrait:void 0);this.npcName.setVisible(!1),o?(this.portrait.setVisible(!0),this.portrait.setTexture(o),this.text.setPosition(170,Nl+(t instanceof de?40:0)).setWordWrapWidth(this.textWidth,!0).setFixedSize(this.textWidth,this.textHeight),t instanceof de&&(this.npcName.setVisible(!0),this.npcName.setText(O[t.npcType].name))):(this.portrait.setVisible(!1),this.text.setPosition(Nl,Nl).setWordWrapWidth(170+this.textWidth,!0).setFixedSize(170+this.textWidth,this.textHeight)),this.showMessage()}showMessage(){var e;const t=this.getMessages(),i=t&&t[this.messageIndex];if(i){this.text.setText(i);const t=this.target instanceof de?this.target.npcType:void 0;let s="player_portrait"===(null==(e=this.portrait)?void 0:e.texture.key)?Fl.player:t?Fl[t]:zl;const{promise:n,stop:o}=Gl(i,s,this.scene.sound.mute?0:this.scene.sound.volume),{promise:r,stop:a}=function(e,t=15){const i=e.text,s=i.replace(/[^ ]/g,"");e.text="";let n="";const o=e.scene.time.addEvent({delay:t,loop:!0});return{promise:new Promise((t=>{o.callback=()=>{if(e.text===i)return o.destroy(),t();n+=i[n.length];const r=s.substring(n.length);e.text=n+r}})),stop:()=>{o.destroy(),e.text=i}}}(this.text);this.animating=!0,this.stopAudio=o,this.stopAnimation=a,Promise.all([n,r]).then((()=>{this.animating=!1,this.stopAudio=void 0,this.stopAnimation=void 0})),this.text.getWrappedText().length>5&&console.error("Message too long!",i)}this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;const e=!v.zoomed;this.options.forEach(((t,i)=>{const s=new Wl(this.scene,v.width/2,v.height/(e?9:14)+i*(30+v.height/(e?16:22)),t,(()=>this.onSelectOption(t)),{fontSize:24,backgroundColor:"#"+z,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(w.Overlay);this.optionsContainer.addButton(s)}))}onSelectOption(e){var t;(null==(t=this.dialog)?void 0:t.onSelected)&&(this.dialog.onSelected(e,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){var e,t,i,s;if(Date.now()<this.interactionTimeout)return;const n=this.getMessages();if(this.dialog&&n){if(this.animating)return null==(e=this.stopAudio)||e.call(this),null==(t=this.stopAnimation)||t.call(this),void(this.animating=!1);this.messageIndex++,this.messageIndex>=n.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.text.setText(""),this.scene.tweens.add({targets:this,alpha:0,duration:125,onComplete:()=>this.setVisible(!1)}),null==(i=this.scene.gamepad)||i.resetButtons()):this.showMessage(),null==(s=this.scene.gamepad)||s.setVisible(void 0===this.dialog&&this.gamepadVisible),this.interactionTimeout=Date.now()+350}}getMessages(){var e;let t=null==(e=this.dialog)?void 0:e.messages;return"function"==typeof t&&(t=t(this.player)),t}getOptions(){var e;let t=null==(e=this.dialog)?void 0:e.options;return"function"==typeof t&&(t=t(this.player)),t}}const Ul={[k.Wrench]:{x:0,y:0,image:"wrench",name:"Old Wrench"},[k.Gear1]:{x:0,y:0,image:"gear",name:"Shiny Gear"},[k.Key]:{x:0,y:0,image:"key",name:"Rusty Key",skipLighting:!0},[k.HerbRed]:{x:-200,y:1730,image:"herb_red",name:"Crimson Starbloom"},[k.HerbGreen]:{x:5295,y:985,image:"herb_green",name:"Green Writhewood"},[k.HerbBlue]:{x:1535,y:875,image:"herb_blue",name:"Blue Plumed Frond"},[k.Potion]:{x:0,y:0,image:"potion",name:"Strange Potion"},[k.Gear2]:{x:0,y:0,image:"gear2",name:"Old Gear"}};class Vl extends i.GameObjects.Container{constructor(e){super(e,0,0),t(this,"inventory",[]),t(this,"text"),t(this,"rect"),t(this,"initialized",!1),this.setScrollFactor(0).setDepth(w.Ui).setVisible(!1)}createUI(){this.initialized||(this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,H(D)).setStrokeStyle(2,H(E)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...ll,fontSize:32}),this.add(this.text),this.initialized=!0)}addItem(e,t){if(this.initialized||this.createUI(),this.inventory.push(e),!e.used){const t=this.scene.add.image(0,0,Ul[e.type].image).setScale(.35);e.type===k.Key&&t.setAngle(45),this.add(t)}this.updateItems();const i=Oe(this.scene,e.type);null==i||i.destroy(),t||(new hl(this.scene,`New item added: ${Ul[e.type].name}`),kl(this.scene))}removeItem(e){var t;this.initialized||this.createUI();const i=this.inventory.find((t=>t.type===e));i&&(i.used=!0,null==(t=this.getAll().find((t=>{var i;return(null==(i=t.texture)?void 0:i.key)===Ul[e].image})))||t.destroy()),this.updateItems()}updateItems(){var e;this.initialized||this.createUI();let t=0;this.getAll().forEach((e=>{if(e instanceof i.GameObjects.Image){const i=32+50*t;e.setPosition(i,68),t++}})),this.setVisible(this.inventory.length>0);const s=Math.max((null==(e=this.text)?void 0:e.displayWidth)+18,50*t+12);this.setPosition(v.width-s-20,20),this.rect.setSize(s,102)}}class $l extends i.GameObjects.Image{constructor(e,i){super(e,v.width-50,v.height-55,"journal"),t(this,"player"),t(this,"journal",[]),t(this,"unread"),t(this,"initialized",!1),this.player=i}createUI(){var e;this.initialized||(this.setScrollFactor(0).setDepth(w.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(v.width-21,v.height-89,20,20,11141120).setStrokeStyle(2,H(z)).setScrollFactor(0).setDepth(w.Ui2).setVisible(!1),null==(e=this.scene.input.keyboard)||e.on("keydown-J",(()=>{this.openJournal()})),this.initialized=!0)}addEntry(e,t){this.initialized||this.createUI(),this.journal.includes(e)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(e),t||(this.unread.setVisible(!0),new hl(this.scene,"New journal entry added!")),this.handleSideEffects(e,t||!1))}openJournal(){this.initialized||this.createUI(),0!==this.journal.length&&te(this.scene,"JournalDialog")}handleSideEffects(e,t){const{warpAdd:i}=ye[e];if(i&&je(this.scene,i,!0),e===C.ClockFirstGear||e===C.ClockSecondGear){const e=Ae(this.scene,T.ClockTower);(null==e?void 0:e.clock)&&e.clock.updateHands()}e!==C.ExtraPotionInformation||this.journal.includes(C.SafeDiscovered)||fl(this.scene,!0),e===C.SafeDiscovered&&function(e,t){const i=Ee(e.scene,j.MansionPicture);t||e.setActive(!1),null==i||i.scene.tweens.add({targets:i,angle:97,duration:t?0:1500,onComplete:()=>{t||(e.setActive(!0),e.message.setDialog({messages:["A sturdy looking safe was hidden behind the picture.","It looks like it requires a special key to open."]},void 0,"player_portrait"))}})}(this.player,t),t||kl(this.scene)}}class ql extends i.GameObjects.Container{constructor(e,i){super(e,v.width-330-20,120),t(this,"player"),t(this,"quests",[]),t(this,"questRectangle"),t(this,"initialized",!1),this.player=i}createUI(){if(this.initialized)return;this.scene.add.existing(this),this.setScrollFactor(0).setDepth(w.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,330,60,H(D)).setStrokeStyle(2,H(E)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const e=this.scene.add.text(10,4,"Quests",{...ll,fontSize:32});this.add(e),this.initialized=!0}addQuest(e,t){this.initialized||this.createUI(),this.quests.find((t=>t.id===e.id))||(this.quests.push(e),this.add(this.scene.add.text(0,0,ge[e.id].description,{...ll,fontSize:20})),this.updateQuests(),t||new hl(this.scene,`New quest added: ${ge[e.id].description}`),this.handleSideEffects(e.id,e.completed,t))}updateExistingQuest(e,t){this.initialized||this.createUI();const i=this.quests.find((t=>t.id===e));i?(!i.completed&&t&&new hl(this.scene,`Quest completed: ${ge[i.id].description}`),i.completed=t,this.updateQuests(),this.handleSideEffects(e,t)):console.error(`Quest ${e} not found in player quests`)}updateQuests(){this.initialized||this.createUI();const e=this.quests.filter((e=>!e.completed));let t=1,s=0;this.getAll().forEach((n=>{if(n instanceof i.GameObjects.Text)if(e.find((e=>n.text===ge[e.id].description))||"Quests"===n.text){if("Quests"!==n.text){const e=14+30*t;n.setPosition(10,e),t++,s=Math.max(s,n.width)}}else n.destroy()}));const n=s+20;this.setX(v.width-20-n),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(e.length>0),this.questRectangle.setSize(n,50+30*e.length)}handleSideEffects(e,t,i){const{warpAdd:s,warpComplete:n}=ge[e];if(s&&je(this.scene,s,!0),t&&n&&je(this.scene,n,!0),e===I.FindPotionIngredients&&!t){const e=this.player.scene;e.interactiveObjects.add(new Mh(e,k.HerbGreen,this.player)),e.interactiveObjects.add(new Mh(e,k.HerbBlue,this.player))}e!==I.ExploreLab||t||Lh(this.player),i||kl(this.scene)}reset(){this.quests=[],this.updateQuests()}}const Xl=1.35*(v.fastMode?350:175),Kl=new i.Math.Vector2(400,650);class Yl extends i.Physics.Arcade.Sprite{constructor(e){var s;super(e,Kl.x,Kl.y,"character",0),t(this,"scene"),t(this,"keys"),t(this,"light"),t(this,"debug"),t(this,"buttonPrompt"),t(this,"interactive"),t(this,"interactionTimeout",0),t(this,"message"),t(this,"inventory"),t(this,"quests"),t(this,"journal"),t(this,"gameState"),t(this,"previousPosition",new i.Math.Vector2),t(this,"counter",0),t(this,"history",[]),t(this,"rewinding",!1),this.name="Player",this.scene=e,e.add.existing(this),e.physics.add.existing(this),v.debug&&this.setInteractive(),this.setBodySize(48,70).setOffset(40,10).setOrigin(.5,.65).setDepth(w.Player).setScale(1.35).setPipeline("Light2D").setPostPipeline("XRayPipeline"),v.debug?(this.light=new re(e,this.x,this.y,200,16768443,1),this.debug=e.add.circle(this.x,this.y,3,16711935).setDepth(w.Debug)):this.light=e.lights.addLight(this.x,this.y,200,16768443,1),(s=this).anims.create({key:"walk",frames:s.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:v.prod?6:9,repeat:-1}),s.anims.play("walk"),this.keys=new ce(e),this.message=new _l(e,this),this.inventory=new Vl(e),this.quests=new ql(e,this),this.journal=new $l(e,this),this.gameState=new Gh(e,this),v.perfTest&&e.time.delayedCall(1e3,(()=>{this.setVelocityX(Xl),e.time.addEvent({delay:1e3,callback:()=>this.setVelocityX(this.body?-this.body.velocity.x:0),loop:!0})}))}update(e,t){var i,s,n;v.debug&&(this.setTint(this.interactive?16755370:16777215),this.debug.setPosition(this.x,this.y));const o=this.interactive&&!this.message.visible&&(null==(s=null==(i=this.buttonPrompt)?void 0:i.text)?void 0:s.length)>0||!1;o&&!this.buttonPrompt&&(this.buttonPrompt=new Dl(this.scene)),null==(n=this.buttonPrompt)||n.setVisible(o),v.perfTest||(this.setVelocity(0),this.rewinding?this.counter+t>31.25?(this.rewind(),this.counter=0):this.counter+=t:this.checkInteraction()||this.message.visible||this.updateVelocity()),this.light.setPosition(this.x,this.y-20),function(e){const t=e.x-e.previousPosition.x,i=e.y-e.previousPosition.y,s=t<0;Math.abs(t)>.01||Math.abs(i)>.01?e.anims.resume():e.anims.pause(),Math.abs(t)>0&&(e.flipX=e.rewinding?!s:s),e.setAngle(e.flipX?-5:5)}(this),this.previousPosition.set(this.x,this.y)}checkInteraction(){var e;let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys.keys),t!==x.None&&(this.interactionTimeout=Date.now()+((null==(e=this.interactive)?void 0:e.interactionTimeout)||500),this.keys.resetKeys(),t===x.Teleported&&(this.interactive=void 0))),t}updateVelocity(){const e=this.keys.keys;let t=1;!v.prod&&e[he.Shift]&&(t=2),this.anims.timeScale=t;const i=Xl*t;e[he.Left]&&this.setVelocityX(-i),e[he.Right]&&this.setVelocityX(i),v.debug&&!this.interactive&&(e[he.Up]&&this.setVelocityY(-i),e[he.Down]&&this.setVelocityY(i)),e[he.Left]&&e[he.Right]&&this.setVelocityX(0)}record(){var e;this.history.length<1e3?this.history.push(new i.Math.Vector3(this.x,this.y,(null==(e=this.body)?void 0:e.velocity.x)||0)):console.warn("Max history reached")}rewind(){const e=this.history.pop();e&&(this.x=e.x,this.y=e.y,this.setVelocityX(-e.z))}setRewind(e){this.rewinding=e,this.counter=0}reset(){this.quests.reset(),this.setPosition(Kl.x,Kl.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(e){var t,i;this.interactive=e,(null==e?void 0:e.onCollided)&&e.onCollided();const s=null==(t=null==e?void 0:e.getButtonPrompt)?void 0:t.call(e);s&&!this.buttonPrompt&&(this.buttonPrompt=new Dl(this.scene)),null==(i=this.buttonPrompt)||i.setText(s)}}class Ql extends i.Physics.Arcade.Image{constructor(e,i,s,n=100,o=100,r=!1,a=!1){super(e,i,s,""),t(this,"scene"),t(this,"width"),t(this,"height"),t(this,"flipped"),t(this,"upwards"),t(this,"graphics"),t(this,"initialized",!1),this.name=`Slope-${i}-${s}`,this.scene=e,this.width=n,this.height=o,this.flipped=r,this.upwards=a}lazyInit(e){if(e||!this.initialized&&ee(this,this.scene.player)){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0).setDepth(w.Debug).setVisible(v.debug).setSize(this.width,1.5*this.height),v.debug){this.setInteractive({draggable:!0});const e=this.scene.add.graphics().setDepth(w.Debug);this.graphics=e,e.lineStyle(2,65280,1);const t=this.width/2,s=new i.Math.Vector2(0,this.flipped?0:0+this.height),n=new i.Math.Vector2(0+this.width,this.flipped?0+this.height:0);e.lineBetween(s.x,s.y,n.x,n.y),e.lineBetween(s.x-t,s.y,s.x,s.y),e.lineBetween(n.x,n.y,n.x+t,n.y),e.strokeCircle(s.x,s.y,2),e.strokeCircle(n.x,n.y,2)}this.initialized=!0}}update(e,t){if(this.lazyInit(),!this.initialized)return;v.debug&&this.graphics&&this.graphics.setPosition(this.x,this.y);const s=this.scene.player,n=s.keys.keys;if(this.body&&this.scene.physics.world.intersects(this.body,s.body)){let e=i.Math.Clamp(1-(this.x+this.width-s.x)/this.width,0,1);this.flipped&&(e=1-e);const t=this.y+this.height,o=(1-s.originY)*s.displayHeight,r=t-this.height*e-o;if(this.upwards&&n[he.Up]&&Math.abs(s.y-r)<70)return s.setVelocityX(this.flipped?-Xl:Xl),void s.setY(r);if(this.upwards&&(n[he.Right]||n[he.Left]&&this.flipped)&&s.y<t-70)return void s.setY(r);if(this.upwards&&r<s.y)return;s.setY(r)}}}const Jl=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3630,y:760,id:P.Sphinx},{x:4575,y:850},{x:5835,y:900},{x:-565,y:575},{x:-2075,y:575},{x:-1930,y:-480},{x:-1050,y:-510},{x:-3075,y:1630},{x:-1350,y:1510},{x:-730,y:1560}];class Zl extends i.Physics.Arcade.StaticGroup{constructor(e,i){super(e.physics.world,e),t(this,"player"),t(this,"initialized",[]),this.player=i,Jl.forEach(((e,t)=>{void 0!==e.id&&this.createWall(e,t)}))}createWall(e,t){const i=this.scene.add.rectangle(e.x,e.y,6,100).setOrigin(0).setVisible(v.debug);i.name=`Wall-${e.id||t}-${e.x}-${e.y}`,void 0!==e.id&&i.setData("WallType",e.id),v.debug&&i.setInteractive({draggable:!0}),this.add(i),this.initialized.push(t)}update(){for(let e=0;e<Jl.length;e++){if(this.initialized.includes(e))continue;const t=Jl[e];i.Math.Distance.BetweenPointsSquared(t,this.player)<1e6&&this.createWall(t,e)}}}const eh=.8,th=.1;class ih extends i.GameObjects.Container{constructor(e,i){super(e,100,v.height-100),t(this,"buttons",[]),t(this,"lastXAxisKey"),t(this,"lastYAxisKey"),t(this,"minimal"),this.minimal=i,this.setScrollFactor(0).setDepth(w.Overlay),e.add.group(this,{runChildUpdate:!0}),e.add.existing(this),this.createControllerListeners()}createUI(){this.createDPad(),this.minimal||this.createButtons()}setVisible(e){return super.setVisible(e),e&&0===this.buttons.length&&this.createUI(),this}update(e,t){var i,s,n,o,r,a,l,h,c,d,u;const p=null==(i=this.scene.input.gamepad)?void 0:i.pad1;if(!p)return;const y=p.axes[0].getValue(),g=p.axes[1].getValue();if(Math.abs(y)<=th&&this.lastXAxisKey)return null==(s=this.scene.input.keyboard)||s.emit("keyup-"+this.lastXAxisKey),void(this.lastXAxisKey=void 0);if(y>th){if("RIGHT"===this.lastXAxisKey)return;"LEFT"===this.lastXAxisKey&&(null==(n=this.scene.input.keyboard)||n.emit("keyup-LEFT")),null==(o=this.scene.input.keyboard)||o.emit("keydown-RIGHT"),this.lastXAxisKey="RIGHT"}if(y<-.1){if("LEFT"===this.lastXAxisKey)return;"RIGHT"===this.lastXAxisKey&&(null==(r=this.scene.input.keyboard)||r.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastXAxisKey="LEFT"}if(Math.abs(g)<=th&&this.lastYAxisKey)return null==(l=this.scene.input.keyboard)||l.emit("keyup-"+this.lastYAxisKey),void(this.lastYAxisKey=void 0);if(g>th){if("DOWN"===this.lastYAxisKey)return;"UP"===this.lastYAxisKey&&(null==(h=this.scene.input.keyboard)||h.emit("keyup-UP")),null==(c=this.scene.input.keyboard)||c.emit("keydown-DOWN"),this.lastYAxisKey="DOWN"}if(g<-.1){if("UP"===this.lastYAxisKey)return;"DOWN"===this.lastYAxisKey&&(null==(d=this.scene.input.keyboard)||d.emit("keyup-DOWN")),null==(u=this.scene.input.keyboard)||u.emit("keydown-UP"),this.lastYAxisKey="UP"}}createDPad(){console.log("createDPad");const e=this.scene.add.container(10,-10);this.add(e);const t=this.scene.add.circle(0,0,60,H(D),.45).setStrokeStyle(3,H(z));e.add(t),this.button(-57,0,"LEFT",e),this.button(57,0,"RIGHT",e),this.button(0,-57,"UP",e),this.button(0,57,"DOWN",e)}createButtons(){const e=this.scene.add.container(v.width-300,0);this.add(e);const t=this.scene.add.circle(40,0,65,H(D),.45).setStrokeStyle(3,H(z)).setScale(1,.6).setAngle(-30);e.add(t),this.button(80,-20,"ENTER",e),this.button(0,20,"BACKSPACE",e)}createControllerListeners(){var e,t,i,s;null==(e=this.scene.input.gamepad)||e.on("connected",(e=>{new hl(this.scene,"Gamepad connected")})),null==(t=this.scene.input.gamepad)||t.on("disconnected",(e=>{new hl(this.scene,"Gamepad disconnected")})),null==(i=this.scene.input.gamepad)||i.on("down",((e,t)=>{var i;const s=this.getKeyFromButton(t);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keydown-${s}`))})),null==(s=this.scene.input.gamepad)||s.on("up",((e,t)=>{var i;const s=this.getKeyFromButton(t);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keyup-${s}`))}))}getKeyFromButton(e){const t=e.pad.id.toLowerCase().includes("nintendo");let i;switch(e.index){case 0:i=t?"BACKSPACE":"ENTER";break;case 1:i=t?"ENTER":"BACKSPACE";break;case 2:i=t?"SHIFT":"BACK_SLASH";break;case 3:i=t?"BACK_SLASH":"SHIFT";break;case 8:i="J";break;case 9:i="ESC";break;case 12:i="UP";break;case 13:i="DOWN";break;case 14:i="LEFT";break;case 15:i="RIGHT"}return i}button(e,t,i,s){const n="ENTER"===i||"ESCAPE"===i?35:38,o=this.scene.add.circle(e,t,n,H(E),eh).setStrokeStyle(3,H(z));o.setInteractive({useHandCursor:!0}).setScrollFactor(0),s.add(o),o.on("pointerdown",(()=>{var e;null==(e=this.scene.input.keyboard)||e.emit(`keydown-${i}`),o.setFillStyle(H(D),Math.min(1,1.05))})),o.on("pointerup",(()=>{var e;null==(e=this.scene.input.keyboard)||e.emit(`keyup-${i}`),o.setFillStyle(H(E),eh)})),o.on("pointerout",(()=>{var e;null==(e=this.scene.input.keyboard)||e.emit(`keyup-${i}`),o.setFillStyle(H(E),eh)})),this.buttons.push(o)}resetButtons(){this.buttons.forEach((e=>e.setFillStyle(H(E),eh)))}}class sh extends i.GameObjects.Container{constructor(e,i,s,n,o){super(e,i,s),t(this,"onClick"),t(this,"img"),t(this,"rect"),t(this,"selected"),e.add.existing(this),this.setScrollFactor(0).setDepth(w.Ui),this.rect=e.add.rectangle(0,0,42,42,H(D)).setScrollFactor(0).setStrokeStyle(2,H(z)),this.img=e.add.image(-1,1,n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>o(this))),this.onClick=o,this.selected=!1,this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}setTint(e){this.img.setTint(e)}setSelected(e){this.selected=e,this.setTint(e?H(R):16777215)}setIcon(e){this.img.setTexture(e).setDisplaySize(32,32)}}var nh=(e=>(e.Horizontal="H",e.Vertical="V",e.Corner="C",e.T="T",e.Cross="X",e.Empty=" ",e))(nh||{});const oh={H:[[0,0,0],[1,1,1],[0,0,0]],V:[[0,1,0],[0,1,0],[0,1,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},rh=[[" "," "," ","V"," "," ","V"," "," ","V"," "," "," ","V"," "," "],[" "," ","C","C"," "," ","V"," "," ","V"," "," ","C","T","H","H"],["H","H","X","T","T","T","T","T","T","C"," "," ","V"," "," "," "],[" "," ","V","C","X","C"," ","C","X","H","T","H","X","H","C"," "],[" "," ","C","T","X","H","C"," ","V"," ","V"," ","V"," ","T","H"],["H","T","H","T","V"," ","T","H","X","H","T","H","T"," ","V"," "],[" ","V"," ","C","X","H","C"," ","T","C"," "," ","C","C","C","H"],[" ","V"," "," ","V"," "," "," ","V","V"," "," "," ","V"," "," "]].map((e=>e.map((e=>e))));function ah(e,t){if(!e||!t)return!1;const i=lh(e),s=lh(t),n=t.x-e.x,o=t.y-e.y;return 1===n&&0===o?i.right&&s.left:-1===n&&0===o?i.left&&s.right:0===n&&1===o?i.bottom&&s.top:0===n&&-1===o&&i.top&&s.bottom}function lh(e){const t=function(e){let t=oh[e.type];const i=Math.floor(e.rotation/90);for(let s=0;s<i;s++)t=hh(t);return t}(e);return{left:t.some((e=>1===e[0])),right:t.some((e=>1===e[e.length-1])),top:t[0].some((e=>1===e)),bottom:t[t.length-1].some((e=>1===e))}}function hh(e){return e[0].map(((t,i)=>e.map((e=>e[i])).reverse()))}const ch=Object.keys(k).map((e=>k[e])).filter((e=>"number"==typeof e)),dh=Object.keys(C).map((e=>C[e])).filter((e=>"number"==typeof e)),uh=Object.keys(T).map((e=>T[e])).filter((e=>"number"==typeof e)),ph=Object.keys(j).map((e=>j[e])).filter((e=>"number"==typeof e)),yh=Object.keys(I).map((e=>I[e])).filter((e=>"number"==typeof e)),gh=Object.keys(S).map((e=>S[e])).filter((e=>"number"==typeof e)),fh=Object.keys(A).map((e=>A[e])).filter((e=>"number"==typeof e)),mh=Object.values(nh).filter((e=>"number"!=typeof e)),bh=["MainMenu","MazeDialog","PipesDialog","TumblerDialog","MemoryDialog","SliderDialog"],vh=[{x:0,y:0,image:"town"},{x:500,y:-1100,image:"clock_outside"},{x:500,y:-2400,image:"clock_inner",skipLighting:!0},{x:2300,y:0,image:"forest"},{x:4400,y:100,image:"lake"},{x:-2200,y:-170,image:"mansion_outside"},{x:-2e3,y:-1320,image:"mansion_inside",skipLighting:!0},{x:-3200,y:1300,image:"alchemy_lab",scale:.9,skipLighting:!0},{x:1600,y:-700,image:"library",skipLighting:!0}],wh=[{x:135,y:462,radius:150,color:H(M),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:887,y:200,radius:150},{x:1561,y:460},{x:791,y:472,intensity:.5},{x:962,y:469,intensity:.5},{x:162,y:814,intensity:2},{x:635,y:772},{x:1638,y:788,intensity:2},{x:5300,y:530,intensity:2},{x:5315,y:730,intensity:.75,radius:75}],xh=[{x:740,y:-1370,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5150,y:953,width:100,height:60,flip:!0},{x:-1300,y:-415,width:90,height:35},{x:-1710,y:1577,width:280,height:190,upwards:!0},{x:-1020,y:1697,width:200,height:70},{x:-2570,y:1728,width:200,height:40,flip:!0}];class Sh extends i.Scene{constructor(){super("Game"),t(this,"player"),t(this,"interactiveObjects"),t(this,"clock"),t(this,"gamepad"),t(this,"saveIcon"),t(this,"shouldInit",!0),t(this,"cullingCache",[]),t(this,"cullingTimer",0)}init(){const e=function(e){const{save:t}=bl();try{return wl(t,e)}catch(i){console.error(i)}return!1}(this);this.shouldInit=!e}create(){if(!this.shouldInit)return;const e=performance.now();J(this,v.bootDialog?150:500),this.player=new Yl(this);const t=this.createBackgrounds(),i=new Zl(this,this.player),s=this.createWarpers(),n=this.createSlopes(),o=this.createHelperText(),r=this.createNpcs(),a=this.createItems(),l=this.createProps(),h=new Ol(this,Cl[0],Cl[1]),c=new Ol(this,jl[0],jl[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...s,...r,...a,...l,...o],{runChildUpdate:!0});const d=this.add.group([this.player,h,c,...n,i,...t],{runChildUpdate:!0});this.clock&&d.add(this.clock),this.physics.add.collider(this.player,i),this.createEventListeners();const u=this.cameras.main;u.startFollow(this.player,!0),u.setFollowOffset(0,v.cameraOffset),xl(this);const p=performance.now()-e,y=`Game.create() took ${p.toFixed(1)}ms to initialize`;v.prod||(v.debug&&p>300||!v.debug&&p>150?new hl(this,y,void 0,F):new hl(this,y))}update(){this.player&&(this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((e,t)=>{const i=e;let s=!0;return i.disabled&&(s=!1),void 0!==i.visible&&(s=s&&i.visible),s}),this.player)||this.player.setInteractiveObject(void 0)),this.frustumCullObjects(this.children.list)}frustumCullObjects(e){(0===this.cullingCache.length||this.cullingTimer>60)&&(this.cullingCache=e.filter((e=>(e instanceof i.GameObjects.Image||e instanceof i.GameObjects.Sprite||e instanceof i.GameObjects.Particles.ParticleEmitter||e instanceof i.GameObjects.Graphics)&&!(e instanceof Ql||e instanceof ve||e.depth>=w.Ui||void 0===e.name))),this.cullingTimer=0);const t=this.cameras.main;for(const s of this.cullingCache)void 0!==s.getBounds&&(s.visible=i.Geom.Intersects.RectangleToRectangle(s.getBounds(),t.worldView));this.cullingTimer++}createBackgrounds(){return vh.map((e=>new Tl(this,e,this.player)))}createWarpers(){return gh.map((e=>new ve(this,e,this.player)))}createNpcs(){return uh.map((e=>new de(this,e,this.player)))}createItems(){return[].map((e=>new Mh(this,e,this.player)))}createSlopes(){return xh.map((e=>new Ql(this,e.x,e.y,e.width,e.height,e.flip,e.upwards)))}createProps(){return ph.map((e=>new pe(this,e,this.player)))}createHelperText(){return fh.map((e=>new Ml(this,e,this.player)))}createUI(){this.time.delayedCall(50,(()=>{let e=30;new sh(this,e,30,"settings",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),v.prod||new sh(this,e+=50,30,"terminal",(()=>{te(this,"DebugTool")})),this.saveIcon=this.add.image(30,v.height-30,"save").setScale(.4).setDepth(w.Ui).setScrollFactor(0).setAlpha(0),this.saveIcon.postFX.addGlow(0,2)})),this.gamepad=new ih(this),v.prod||(this.time.delayedCall(500,(()=>{const e=new Il(this,this.player);this.add.group(e,{runChildUpdate:!0})})),v.bootDialog&&this.time.delayedCall(150,(()=>te(this,v.bootDialog))))}createLights(){this.lights.enable().setAmbientColor(H(E)),wh.forEach((e=>{v.debug?new re(this,e.x,e.y,e.radius||100,e.color||H(B),e.intensity||1):this.lights.addLight(e.x,e.y,e.radius||100,e.color||H(B),e.intensity||1)})),X(this,!1)}createEventListeners(){var e;null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),this.events.on("resume",(()=>{this.player.keys.resetKeys()}))}}const kh=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[T.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[T.Stranger]:["The sphinxs riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[T.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[T.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[T.Inventor]:["The sphinxs riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[T.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, dont they?","They move, disappear, and seem to fly without wings."]}}];function Ih(e){return e instanceof Sh&&Ie(e.player,I.FindPotionIngredients)?1:0}function Th(e,t){const i=Ih(e);return kh[i].hints[t]}const Ph={messages:e=>function(e){const t=Ih(e);return[kh[t].question]}(e.scene),options:e=>function(e){const t=Ih(e),i=[...kh[t].options].sort((()=>Math.random()-.5));return i.push("I dont know"),i}(e.scene),onSelected:function(e,t,i){e===function(e){const t=Ih(e);return kh[t].answer}(t.scene)?t.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:e=>{e.quests.updateExistingQuest(I.SphinxRiddle,!0),e.gameState.updateData({sphinxMoved:!0,sphinxFail:!1})}},i):"I dont know"===e?t.message.setDialog({messages:["Come back when you have an answer for me."]},i):t.message.setDialog({messages:["That is not correct. You will not remember how to get back to me."],onCompleted:e=>{e.gameState.updateData({mazeSolved:!1,mazeSeed:e.gameState.data.mazeSeed+1,sphinxFail:!0}),we(S.TownEast,e,{x:-100,y:0})}},i)}},Ch={messages:["There. It looks like the alchemy set has been properly fit back together."],onCompleted:e=>{e.journal.addEntry(C.AlchemySetFixed)}},jh={[T.Inventor]:[{messages:["There is still one more gear missing.","Something tells me there is a great evil near the lake."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["Ah, the second gear. You should take it to the clock tower."],conditions:{hasItem:k.Gear2}},{messages:["You found a secret safe in the mansion?","Very interesting. There may be a hint about opening it nearby."],conditions:{journalEntry:C.SafeDiscovered}},{messages:["Blue Plumed Frond? I have not heard of such a plant.","The stranger may know. Many secrets lie under this town."],conditions:{activeQuest:I.FindPotionIngredients}},{messages:["There are rumors of an abandoned mansion west of the town.","Some say it is haunted and dark magic lurks within."],conditions:{activeQuest:I.InvestigateTownWest}},{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:k.Gear1},onCompleted:e=>{e.quests.updateExistingQuest(I.ForestGear,!0)}},{messages:e=>Th(e.scene,T.Inventor),conditions:{activeQuest:I.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. Youll need three gears to do it."],conditions:{hasItem:k.Wrench}},{messages:["The clock tower is the heart of our town, but its been broken for ages. Ive got a wrench, but youll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:e=>{e.journal.addEntry(C.FixTheClock),e.inventory.addItem({type:k.Wrench,used:!1})}}],[T.Stranger]:[{messages:["I am worried about the secrets hidden near the lake.","Long ago I saw a great evil lurking there."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["Another gear? The mayor probably wants that put back in the clock tower."],conditions:{hasItem:k.Gear2}},{messages:["The lock on that safe is no ordinary lock. It requires something special to open it."],conditions:{journalEntry:C.SafeDiscovered,hasUnusedItem:k.Potion}},{messages:["Hmm a potion, I wonder what it does.","The alchemist was no ordinary person and built magical safeguards against intruders."],conditions:{hasUnusedItem:k.Potion}},{messages:["Green Writhewood? Hm, there might be some near the forest or lake."],conditions:{activeQuest:I.FindPotionIngredients}},{messages:["You heard of the mansion to the west? It was abandoned many years ago.","There is a rumor of an alchemy lab hidden somewhere nearby, but I have been searching for years and have found not even a single potion."],conditions:{activeQuest:I.InvestigateTownWest}},{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:k.Gear1}},{messages:e=>Th(e.scene,T.Stranger),conditions:{activeQuest:I.SphinxRiddle}},{messages:["Ive heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forests creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:k.Wrench},onCompleted:e=>{e.quests.addQuest({id:I.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[T.Sphinx]:[{messages:e=>e.gameState.data.sphinxFail?["You have returned. I am surprised you were able to find your way back.","Try again."]:Ie(e,I.FindPotionIngredients)?["I see you are back again. You may find what you are looking for ahead, but must first answer my riddle."]:["Ponder this riddle. Answer wisely."],conditions:{activeQuest:I.SphinxRiddle,completedQuest:I.SphinxRiddle,or:!0},onCompleted:(e,t)=>{e.scene.time.delayedCall(50,(()=>{e.message.setDialog({...Ph},t)}))}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:e=>{e.quests.addQuest({id:I.SphinxRiddle,completed:!1})}}],[T.Mayor]:[{messages:["Ive been hearing strange reports from the townsfolk. Its as if time is slipping. Have you felt it?","The clock is still missing a gear. It must be somewhere nearby."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["The second gear has been found? Thats incredible news!"],conditions:{completedQuest:I.InvestigateTownWest}},{messages:["Herbs? I havent the faintest idea where to being looking. Start at the source - there are bound to be a few ingredients in the lab you found."],conditions:{activeQuest:I.FindPotionIngredients}},{messages:["The minute hand on the clock is spinning again.","It looks like its missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:C.ClockFirstGear},onCompleted:e=>{e.quests.addQuest({id:I.InvestigateTownWest,completed:!1})}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:C.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:e=>{e.journal.addEntry(C.MetTheMayor)}}],[T.ClockTower]:[{messages:["With two of the gears in place, the clocks hands are moving again."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["Slowly, you align and tighten the second gear into place.","[CREAKING NOISE]","Now two of the hands of the clock are moving again."],conditions:{hasItem:k.Gear2},onCompleted:e=>{e.inventory.removeItem(k.Gear2),e.journal.addEntry(C.ClockSecondGear)}},{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:C.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Lets see what happens when we add the first gear. You tighten the gear into place.","[CREAKING NOISE]","The clock tower is starting to partially move again. It looks like its missing two more gears."],conditions:{hasItem:k.Gear1},onCompleted:e=>{e.inventory.removeItem(k.Gear1),e.journal.addEntry(C.ClockFirstGear)}}]},Ah={[k.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}],[k.Gear2]:[{messages:["Finally! I found the second gear to the clock tower.","I should take this and put it back."],onCompleted:e=>{e.quests.updateExistingQuest(I.InvestigateTownWest,!0)}}]},Oh={[j.Chest]:[{messages:["The chest seems to be locked.","It appears to have many symbols above the latch"],conditions:{custom:e=>!xe(e,k.Gear1)&&void 0===Oe(e.scene,k.Gear1)},onCompleted:e=>{te(e.scene,"MemoryDialog")}}],[j.LabHatch]:[{messages:["Let me see if I can open this hatch.","Wow, the rusty key fits!","[CREAKING NOISE]","Alright, lets see what is down there!"],conditions:{hasItem:k.Key},onCompleted:(e,t)=>{null==t||t.destroy(),e.inventory.removeItem(k.Key),e.journal.addEntry(C.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[j.LabBook]:[{messages:[],conditions:{journalEntry:C.ClockSecondGear}},{messages:['How could I have missed this? The potion is called the "Elixir of Sight".',"This must be related to one of the gears in the clock tower.","Well, bottoms up, I suppose!"],conditions:{hasItem:k.Potion},onCompleted:e=>{e.journal.addEntry(C.ExtraPotionInformation),e.inventory.removeItem(k.Potion),e.scene.time.delayedCall(3500,(()=>{e.message.setDialog({messages:["I feel... different.","I should retrace my steps to see if there is anything new in the area."]})}))}},{messages:["With the alchemy set fixed, I should be able to recreate the experiment.","I will need to find three ingredients according to this - Crimson Starbloom, Green Writhewood, and a Blue Plumed Frond.","Maybe I can find them in the lab or the forest. The villagers should know more."],conditions:{journalEntry:C.AlchemySetFixed},onCompleted:e=>{e.quests.addQuest({id:I.FindPotionIngredients,completed:!1}),e.gameState.updateData({mazeSolved:!1,mazeSeed:e.gameState.data.mazeSeed+1,sphinxMoved:!1})}},{messages:["Maybe I can find more information in the lab."],conditions:{activeQuest:I.ExploreLab}},{messages:["This lab journal contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:e=>{e.quests.addQuest({id:I.ExploreLab,completed:!1})}}],[j.AlchemySet]:[{messages:["Theres nothing more that I can do here."],conditions:{hasItem:k.Potion}},{messages:["Now we have all of the ingredients.","Now I should be able to recreate the experiment.","According to the book..."],conditions:{hasUsedItem:k.HerbBlue},onCompleted:(e,t)=>{!function(e,t){const i=e.scene;e.inventory.removeItem(k.HerbBlue),e.setActive(!1),Z(i,500,(()=>{i.time.delayedCall(700,(()=>{var s;null==t||t.setTexture("alchemy_full"),null==(s=null==t?void 0:t.particles)||s.setConfig({...ue[j.AlchemySet].particles,tint:[6684791],x:30,delay:200,stopAfter:120}).start(),J(i,1500,(()=>{e.message.setDialog({messages:["I have created the potion mentioned in the old journal.","I should bring it to the mysterious stranger to see if they know how to use it."],onCompleted:(e,t)=>{e.inventory.addItem({type:k.Potion,used:!1}),e.quests.updateExistingQuest(I.ExploreLab,!0),null==t||t.setTexture("alchemy_empty"),e.setActive(!0)}},t,"player_portrait")}))}))}))}(e,t)}},{messages:["The Blue Plumed Frond is last."],conditions:{hasItem:k.HerbBlue,hasUsedItem:k.HerbRed},onCompleted:(e,t)=>{Fh(e,t,k.HerbBlue),e.quests.updateExistingQuest(I.FindPotionIngredients,!0)}},{messages:["The Crimson Starbloom comes next."],conditions:{hasItem:k.HerbRed,hasUsedItem:k.HerbGreen},onCompleted:(e,t)=>Fh(e,t,k.HerbRed)},{messages:["The Green Writhewood goes in first."],conditions:{hasItem:k.HerbGreen},onCompleted:(e,t)=>Fh(e,t,k.HerbGreen)},{messages:["Maybe the journal has more information about using this alchemy set."],conditions:{journalEntry:C.AlchemySetFixed}},{messages:["This alchemy set looks like the one in the journal.","If I can figure out how the set connects together, I might be able to recreate the experiment."],conditions:{activeQuest:I.ExploreLab},onCompleted:e=>{te(e.scene,"PipesDialog")}},{messages:["A series of pipes and tubes. I shouldnt touch this without knowing what it does."]}],[j.LabBookshelf1]:[{messages:['[Secrets of the Silver Transmutation]\n"Silver, the mirror of the soul, can be yielded from common materials. Begin with a lead base, cleanse it with the tears of a willow, and chant thrice under a new moon. Such processes, though fraught with danger, promise immense reward. Meticulous preparation of the material is crucial."','"Among these pages lie safeguards against volatile spirits and the precise lunar phases essential for success. Here are protective circles and counter-spells to be used should spirits prove malevolent. This knowledge has been passed down and refined for safety."'],conditions:{activeQuest:I.ExploreLab}}],[j.LabBookshelf2]:[{messages:['[Whispering Woods: A Compendium]\n"The sentient trees of Eldergrove are not myths; their trunks groan with ancient wisdom. To engage them, perform the Ritual of Leaves, using moonlit water and rare herbs, along with whispered incantations passed down by forest guardians."','"Notes on the rare Blue Moonflower, whose petals glow ghostly and unlock forest languages, are also included. Its bloom is brief, and harvesting must be timed at midnight to retain its properties. The chapter concludes with a discussion on plant symbiosis with Eldertrees."'],conditions:{activeQuest:I.ExploreLab}}],[j.LabBookshelf3]:[{messages:['[The Essence of Fire: Ignite and Control]\n"Mastering fire requires strength of will and profound respect for its power. Here, summoning circles and incantations to call forth fire spirits are detailed. Each summoning demands a tribute of phoenix ash. The endeavor is perilous, as spirits may lash out if provoked."','"The tome also discusses methods to quell flames should they rise against the summoner. Included are the chant of suppression and a dousing mixture from elemental waters and frost-bitten herbs. These countermeasures are vital for maintaining control over summoned entities."'],conditions:{activeQuest:I.ExploreLab}}],[j.LabPotionShelf1]:[{messages:["Nightshade, wolfsbane, starvine, frost ferns... No, those are not the right ingedients.","Oh, a Crimson Starbloom! Yes, this should work!"],conditions:{activeQuest:I.FindPotionIngredients,custom:e=>!xe(e,k.HerbRed)},onCompleted(e){e.inventory.addItem({type:k.HerbRed,used:!1})}},{messages:['Hm, this is an interesting collection. Whats this "Elixir of Luminescence"? Could light up some dark corners. And "Brew of Bravery"... might make me bold enough to face a dragon, or foolish enough to try. What about "Draught of the Depths"sounds like it could show me treasures or drown me in visions. Better not risk it; these might just burn me to a crisp!'],conditions:{activeQuest:I.ExploreLab}}],[j.MansionPicture]:[{messages:[],conditions:{hasItem:k.Gear2}},{messages:["A sturdy looking safe was hidden behind the picture.","There are large rusty rings to the side, as if it they were meant to be moved."],conditions:{journalEntry:C.SafeDiscovered},onCompleted:e=>{te(e.scene,"TumblerDialog")}},{messages:["An abstract picture of blocks.","Wait a moment, something is behind this picture","[CREAK]"],onCompleted:e=>{e.journal.addEntry(C.SafeDiscovered)},conditions:{hasUsedItem:k.Potion}},{messages:["An abstract picture of blocks."]}],[j.MansionHole]:[{messages:["Literally a hole in the wall.","Huh, there is something here. It's a key!"],conditions:{hasItem:k.Key,invert:!0},onCompleted:e=>{e.inventory.addItem({type:k.Key,used:!1})}},{messages:["Literally a hole in the wall."]}]};function Eh(e,t,i){for(const s of e){const{conditions:e}=s,n=[];if(void 0!==(null==e?void 0:e.hasItem)&&n.push(xe(t,e.hasItem)),void 0!==(null==e?void 0:e.hasUnusedItem)&&n.push(Se(t,e.hasUnusedItem)),void 0!==(null==e?void 0:e.hasUsedItem)&&n.push(ke(t,e.hasUsedItem)),void 0!==(null==e?void 0:e.completedQuest)&&n.push(Te(t,e.completedQuest)),void 0!==(null==e?void 0:e.activeQuest)&&n.push(Ie(t,e.activeQuest)),void 0!==(null==e?void 0:e.journalEntry)&&n.push(Pe(t,e.journalEntry)),(null==e?void 0:e.custom)&&n.push(e.custom(t,i)),null==e?void 0:e.invert){if(null==e?void 0:e.or){if(n.some((e=>!e)))return s}else if(n.every((e=>!e)))return s;return}if(null==e?void 0:e.or){if(n.some((e=>e)))return s}else if(n.every((e=>e)))return s}}class Mh extends i.Physics.Arcade.Image{constructor(e,i,s){const{x:n,y:o,image:r}=Ul[i];super(e,n,o,r),t(this,"itemType"),t(this,"player"),t(this,"particles"),t(this,"light"),t(this,"disabled",!1),t(this,"initialized",!1),this.name=`Item-${i}`,this.itemType=i,this.player=s,this.setScale(.35).setDepth(w.Items),Me(this,Ul[i])}lazyInit(e){(e||!this.initialized&&ee(this,this.player))&&(xe(this.player,this.itemType)?this.destroy():(this.scene.add.existing(this),this.scene.physics.add.existing(this),v.debug&&this.setInteractive({draggable:!0}),this.particles=this.scene.add.particles(this.x,this.y,"warp",{scale:{start:0,end:.9},alpha:{start:.7,end:0},delay:500,lifespan:1500,maxAliveParticles:1}).setDepth(w.Items).setName(`Item-${this.itemType}-Particles`),v.debug?this.light=new re(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2),this.initialized=!0))}onInteract(e){return e[he.Continue]?(this.scene.time.delayedCall(0,(()=>{this.player.inventory.addItem({type:this.itemType,used:!1});const e=Eh(Ah[this.itemType]||[],this.player,this);e&&(null==e?void 0:e.messages.length)>0&&this.player.message.setDialog(e,this,"player_portrait")})),this.destroy(),x.Item):x.None}destroy(e){var t,i,s;null==(t=this.particles)||t.destroy(),this.light instanceof re?this.light.destroy():null==(s=null==(i=this.scene)?void 0:i.lights)||s.removeLight(this.light),super.destroy(e)}getButtonPrompt(){return[`Pick Up ${Ul[this.itemType].name}`,"Press [CONTINUE]"]}update(){var e,t;this.lazyInit(),null==(e=this.particles)||e.setPosition(this.x,this.y),null==(t=this.light)||t.setPosition(this.x,this.y)}}function Dh(e,t,s){var n,o;const r=Ae(e,T.Sphinx);if(!r)return void console.error("Sphinx not found");const a=function(e,t){return Ce(e,i.GameObjects.Rectangle).find((e=>e.getData("WallType")===t))}(e,P.Sphinx);if(a){const e=(null==(n=Jl.find((e=>e.id===P.Sphinx)))?void 0:n.x)||0;t?a.setX(e||0):a.setX(e-150),null==(o=a.body)||o.updateFromGameObject()}je(e,S.ForestEast,t||!1);const{x:l,y:h}=O[T.Sphinx],c=t?l+200:l,d=t?h-90:h;e.tweens.add({targets:r,alpha:0,duration:!t||s?0:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{r.setPosition(c,d)},onComplete:()=>{r.alpha=1,r.disabled=t||!1}}),e.tweens.add({targets:r.light,x:c,y:d,duration:!t||s?0:450,ease:"Power1"})}const zh={[k.HerbRed]:{texture:"alchemy_red",tint:11141120,x:-20},[k.HerbGreen]:{texture:"alchemy_green",tint:43520,x:-35},[k.HerbBlue]:{texture:"alchemy_blue",tint:170,x:-5}};function Fh(e,t,i){e.inventory.removeItem(i),e.setActive(!1),t&&t.particles&&(Lh(e),t.disabled=!0,t.particles.setConfig({...ue[j.AlchemySet].particles,tint:zh[i].tint,x:zh[i].x}).start().on("complete",(()=>{t.disabled=!1,e.setActive(!0)})))}function Lh(e){const t=Ee(e.scene,j.AlchemySet);t&&(t.setTexture("alchemy_empty"),ke(e,k.HerbBlue)?t.setTexture(zh[k.HerbBlue].texture):ke(e,k.HerbRed)?t.setTexture(zh[k.HerbRed].texture):ke(e,k.HerbGreen)&&t.setTexture(zh[k.HerbGreen].texture))}const Bh={mazeSolved:!1,mazeSeed:0,sphinxFail:!1,sphinxMoved:!1};class Gh{constructor(e,i){t(this,"scene"),t(this,"player"),t(this,"data"),this.scene=e,this.player=i,this.data={...Bh}}updateData(e,t){this.data={...this.data,...e},Object.entries(e).forEach((([e,i])=>{this.handleSideEffects(e,i,t)}))}handleSideEffects(e,t,i){"sphinxMoved"===e&&Dh(this.scene,t,i)}}const Wh="chrono-sleuth-save";var Rh=(e=>(e[e.New=0]="New",e[e.Act1=1]="Act1",e[e.Act2=2]="Act2",e[e.LabItems=3]="LabItems",e[e.Act3=4]="Act3",e))(Rh||{});const Hh={player:{x:Kl.x,y:Kl.y,flip:!1},journal:[],inventory:[],quests:[],gameState:{...Bh},settings:{gamepad:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((e=>navigator.userAgent.match(e))),debug:!1,zoomed:!0,useShader:!0,time:Date.now(),muted:!0}},Nh={...Hh.settings,gamepad:!1},_h={0:Hh,1:{player:{x:Kl.x,y:Kl.y,flip:!1},journal:[C.FixTheClock],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!1}],quests:[{id:I.ForestGear,completed:!1},{id:I.SphinxRiddle,completed:!0}],gameState:{...Bh,mazeSolved:!0,sphinxMoved:!0},settings:{...Nh}},2:{player:{x:-770,y:Kl.y,flip:!0},journal:[C.FixTheClock,C.MetTheMayor,C.ClockFirstGear],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!0}],quests:[{id:I.ForestGear,completed:!0},{id:I.SphinxRiddle,completed:!0},{id:I.InvestigateTownWest,completed:!1}],gameState:{...Bh,mazeSolved:!0,sphinxMoved:!0},settings:{...Nh}},3:{player:{x:-1500,y:1729,flip:!0},journal:[C.FixTheClock,C.MetTheMayor,C.ClockFirstGear,C.AlchemyLabFound,C.AlchemySetFixed],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!0},{type:k.Key,used:!0}],quests:[{id:I.ForestGear,completed:!0},{id:I.SphinxRiddle,completed:!0},{id:I.InvestigateTownWest,completed:!1},{id:I.ExploreLab,completed:!1},{id:I.FindPotionIngredients,completed:!1}],gameState:{...Bh},settings:{...Nh}},4:{player:{x:5073.875,y:915,flip:!1},journal:[C.FixTheClock,C.MetTheMayor,C.ClockFirstGear,C.AlchemyLabFound,C.AlchemySetFixed,C.SafeDiscovered,C.ExtraPotionInformation,C.ClockSecondGear],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!0},{type:k.Key,used:!0},{type:k.HerbRed,used:!0},{type:k.HerbGreen,used:!0},{type:k.HerbBlue,used:!0},{type:k.Potion,used:!0},{type:k.Gear2,used:!0}],quests:[{id:I.ForestGear,completed:!0},{id:I.SphinxRiddle,completed:!0},{id:I.InvestigateTownWest,completed:!0},{id:I.ExploreLab,completed:!0},{id:I.FindPotionIngredients,completed:!0}],gameState:{...Bh,mazeSolved:!0,sphinxMoved:!0},settings:{...Nh}}};class Uh extends i.Scene{constructor(){super({key:"Boot",pack:{files:[{type:"image",key:"splash",url:"assets/splash.jpg"}]}})}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(v.width,v.height)}preload(){this.load.setPath("assets"),this.load.image("logo","logo.jpg"),this.load.font("m6x11","../m6x11.ttf","truetype"),this.load.bitmapFont("m6x11-24","fonts/m6x11-24.png","fonts/m6x11-24.xml"),this.load.svg("maximize","icons/maximize.svg",{width:64,height:64}),this.load.svg("minimize","icons/minimize.svg",{width:64,height:64}),this.load.svg("settings","icons/settings.svg",{width:64,height:64}),this.load.json("build",`../build.json?cacheBust=${Date.now()}`),v.phaserInspector&&(this.load.scripts("inspector",["https://cdn.jsdelivr.net/npm/tweakpane@3.1.10/dist/tweakpane.js","https://cdn.jsdelivr.net/npm/phaser-plugin-inspector@2.5.0/dist/phaser-plugin-inspector.umd.js"]),this.load.once("complete",(()=>{PhaserPluginInspector.Install(this.plugins)})))}create(){var e;try{const t=null==(e=this.cache.json.get("build"))?void 0:e.buildTime;if(t&&"2024-11-27T20:43:58.785Z"!==t)return this.add.text(v.width/2,v.height/2,"New version available!\nUpdating Game...",{...ll,align:"center",fontSize:48}).setOrigin(.5).postFX.addGlow(0,10),void setTimeout((()=>window.location.reload()),15e3)}catch(xc){console.error(xc)}v.prod&&localStorage.getItem(Wh)?this.scene.start("MainMenu"):this.scene.start("Preloader")}}function Vh(e){e.load.setPath("assets"),e.load.image("train","maps/intro/train.png"),e.load.image("layer1","maps/intro/layer1.png"),e.load.image("layer2","maps/intro/layer2.png"),e.load.image("layer3","maps/intro/layer3.png"),e.load.image("layer4","maps/intro/layer4.png"),e.load.image("layer5","maps/intro/layer5.png"),e.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),e.load.image("player_portrait","characters/player_portrait.png"),e.load.svg("chevron-down","icons/chevron-down.svg",{width:64,height:64})}class $h extends i.Scene{constructor(){super("Intro"),t(this,"player"),t(this,"playerProgess",0),t(this,"direction",1),t(this,"pauseDuration",0)}preload(){Vh(this)}init(){var e,t;this.sound.mute=_h[Rh.New].settings.muted,v.prod||(null==(e=this.input.keyboard)||e.on("keydown-BACK_SLASH",(()=>{Z(this,500,(()=>{this.textures.exists("warp")?this.scene.start("Game"):this.scene.start("Preloader")}))})),null==(t=this.input.keyboard)||t.on("keydown-R",(()=>{this.scene.restart()})))}create(){var e;const t=v.zoomed?.75:1;J(this,350),this.add.image(v.width,v.height,"layer5").setScale(5*t);const i=this.add.image(0,v.height,"layer4").setScale(5*t),s=this.add.image(0,v.height,"layer4").setScale(5*t),n=this.add.image(0,350*t,"layer3").setScale(2*t),o=this.add.image(0,.7*v.height,"layer2").setScale(5*t),r=v.width;this.tweens.add({targets:[i],x:{from:2.5*-r,to:0},duration:12e4,repeat:-1}),this.tweens.add({targets:[s],x:{from:0,to:2.5*r},duration:12e4,repeat:-1}),this.tweens.add({targets:n,x:{from:2*-r,to:2.75*r},duration:6e4,hold:9e4,repeat:-1}),this.tweens.add({targets:[o],x:{from:-r,to:1.5*r},duration:15e3,hold:45e3,repeat:-1});const a=this.add.container(0,v.zoomed?-35:0);this.player=this.add.sprite(560*t,v.height-250*t,"character",0).setScale(2.5*t),this.player.anims.create({key:"walk",frames:this.player.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:5,repeat:-1}),this.player.anims.play("walk"),this.player.anims.pause(),a.add(this.player),this.cameras.main.startFollow(this.player,!0,.1,.1,0,120);const l=this.add.image(v.width/2,v.height/2,"train").setScale(2*t);a.add(l),this.tweens.add({targets:a,x:a.x+1,y:a.y+5,duration:300,hold:300,ease:"Bounce",repeat:-1}),null==(e=this.add.rectangle(-v.width/2,v.height-(v.zoomed?60:35),2*v.width,35,4472896).setOrigin(0).postFX)||e.addShadow(0,0,.5,1),function(e,t){const i=v.zoomed?.75:1,s=new _l(e);t.setAngle(5);const n=e.add.timeline([{at:1500,tween:{targets:t,x:850*i,duration:2500,onComplete:()=>t.anims.pause()},run:()=>t.anims.resume()},{at:6e3,run:()=>{Z(e,500,(()=>{e.textures.exists("warp")?e.scene.start("Game"):e.scene.start("Preloader")}))}}]),o=e.add.timeline([{at:1500,tween:{targets:t,x:1200*i,duration:2500,onComplete:()=>t.anims.pause()},run:()=>t.anims.resume()},{at:5500,run:()=>{t.setFlipX(!0),t.setAngle(-5)}},{at:6500,run:()=>{s.setDialog({messages:["No doubt about it, this will be a strange journey.","Whatever awaits me in this town, its certain that nothing will ever be the same again."],onCompleted:()=>n.play()},void 0,"player_portrait")}}]);e.add.timeline([{at:2500,tween:{targets:t,x:850*i,duration:3e3,onComplete:()=>t.anims.pause()},run:()=>t.anims.resume()},{at:7e3,run:()=>{t.setFlipX(!0),t.setAngle(-5)}},{at:8e3,run:()=>{t.setFlipX(!1),t.setAngle(5)}},{at:9e3,run:()=>{s.setDialog({messages:["What a beautiful mountain-scape. I almost forgot where I am headed.","Its been three days since the letter arrived... It has been many years since I last visited that sleepy old town.","Rumors swirl of strange occurrences. People disappearing, clocks that never strike the hour, and a darkness that lingers beneath the surface."],onCompleted:()=>o.play()},void 0,"player_portrait")}}]).play()}(this,this.player)}}class qh extends sh{constructor(e,t,i){super(e,t,i,e.scale.isFullscreen?"minimize":"maximize",(()=>{e.scale.isFullscreen?e.scale.stopFullscreen():e.scale.startFullscreen()})),e.scale.on(Phaser.Scale.Events.ENTER_FULLSCREEN,(()=>{this.img.scene=e,this.img.setTexture("minimize")})),e.scale.on(Phaser.Scale.Events.LEAVE_FULLSCREEN,(()=>{this.img.scene=e,this.img.setTexture("maximize")}))}}class Xh extends i.Scene{constructor(){super("MainMenu")}create(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(v.width,v.height);const e=this.add.container(0,0);e.setAlpha(0),this.tweens.add({targets:e,alpha:1,duration:150}),e.add(this.add.image(35,v.height-30,"logo").setOrigin(0,1).setScale(.4)),new ih(this,!0).setVisible(!1);const t=new Hl(this);e.add(t);const i=new qh(this,v.width-30,30);t.addButton(i),localStorage.getItem(Wh)&&t.addButton(new Wl(this,v.width-120,v.height-145,"Continue",(()=>this.scene.start("Preloader")),{align:"center"}).setFixedSize(200,70)),t.addButton(new Wl(this,v.width-120,v.height-60,"New Game",(()=>{localStorage.removeItem(Wh),this.scene.start("Preloader")}),{align:"center"}).setFixedSize(200,70)),t.setActiveButton(1)}}class Kh extends i.Scene{constructor(){super("Preloader"),t(this,"container")}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(v.width,v.height),this.add.image(35,v.height-30,"logo").setOrigin(0,1).setScale(.4);const e=.66*v.width,t=.05*v.height,i=this.add.container(.24*v.width,.86*v.height);this.container=i;const s=this.add.rectangle(0,0,e,t).setStrokeStyle(1,16777215,.85).setOrigin(0);i.add(s);const n=this.add.rectangle(3,3,0,t-6,16777215,.85).setOrigin(0);i.add(n),this.load.on("progress",(t=>{const i=v.prod?.6*t:t;n.width=(e-6)*i})),v.prod&&this.load.on("complete",(()=>{this.tweens.add({targets:n,width:e-6,duration:2e3})}));const o=this.add.image(v.width-50,v.height-60,"settings").setScale(.75);this.tweens.add({targets:o,angle:360,duration:2e3,delay:100,repeat:-1})}preload(){this.load.setPath("assets"),this.load.svg("sun","icons/sun.svg",{width:64,height:64}),this.load.svg("moon","icons/moon.svg",{width:64,height:64}),this.load.svg("zoom-in","icons/zoom-in.svg",{width:64,height:64}),this.load.svg("zoom-out","icons/zoom-out.svg",{width:64,height:64}),this.load.svg("terminal","icons/terminal.svg",{width:64,height:64}),this.load.svg("award","icons/award.svg",{width:64,height:64}),this.load.svg("tv","icons/tv.svg",{width:64,height:64}),this.load.svg("save","icons/save.svg",{width:64,height:64}),this.load.svg("chevron-down","icons/chevron-down.svg",{width:64,height:64}),this.load.svg("volume","icons/volume-2.svg",{width:64,height:64}),this.load.svg("volume-mute","icons/volume-x.svg",{width:64,height:64}),this.load.svg("gamepad","icons/gamepad-solid.svg",{width:64,height:64}),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("mansion_outside","maps/mansion_outside_hatch.jpg"),this.load.image("mansion_inside","maps/mansion_inside.jpg"),this.load.image("alchemy_lab","maps/alchemy_lab.jpg"),this.load.image("library","maps/library.jpg"),this.load.image("watch","items/watch.png"),this.load.image("ladder","props/ladder.png"),this.load.image("warp","props/warp.png"),this.load.spritesheet("portal","props/portal.png",{frameWidth:140,frameHeight:120}),this.load.image("gear","items/gear.png"),this.load.image("gear2","items/gear2.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.image("key","items/key.png"),this.load.image("herb_red","items/herb_red.png"),this.load.image("herb_green","items/herb_green.png"),this.load.image("herb_blue","items/herb_blue.png"),this.load.image("potion","items/potion.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),this.load.image("player_portrait","characters/player_portrait.png"),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png"),this.load.image("clock_portrait","characters/clock_portrait.png"),this.load.image("chest","props/chest.png"),this.load.image("chest_open","props/chest_open.png"),this.load.image("book","props/book.png"),this.load.image("picture","props/picture.png"),this.load.image("safe","props/safe.png"),this.load.image("alchemy_empty","props/alchemy/alchemy_empty.png"),this.load.image("alchemy_green","props/alchemy/alchemy_green.png"),this.load.image("alchemy_red","props/alchemy/alchemy_red.png"),this.load.image("alchemy_blue","props/alchemy/alchemy_blue.png"),this.load.image("alchemy_full","props/alchemy/alchemy_full.png"),this.load.image("arrow","puzzles/arrow.png"),localStorage.getItem(Wh)||Vh(this)}create(){this.time.delayedCall(v.prod?2500:0,(()=>{Z(this,300,(()=>{localStorage.getItem(Wh)?this.scene.start("Game"):this.scene.start("Intro")}))}))}}class Yh extends i.GameObjects.Container{constructor(e,s,n){var o,r,a,l,h;super(e,s,n),t(this,"buttons",[]),t(this,"activeIndex",new i.Math.Vector2),t(this,"cursor"),e.add.existing(this).setScrollFactor(0),this.activeIndex.set(-1,-1),null==(o=e.input.keyboard)||o.on("keydown-UP",(()=>{this.setActiveButton({x:0,y:-1})})),null==(r=e.input.keyboard)||r.on("keydown-DOWN",(()=>{this.setActiveButton({x:0,y:1})})),null==(a=e.input.keyboard)||a.on("keydown-LEFT",(()=>{this.setActiveButton({x:-1,y:0})})),null==(l=e.input.keyboard)||l.on("keydown-RIGHT",(()=>{this.setActiveButton({x:1,y:0})})),null==(h=e.input.keyboard)||h.on("keydown-ENTER",(()=>{const e=this.getActiveButton();e&&e.onClick(e)})),e.input.on("pointermove",(()=>{this.cursor.setVisible(!1)}))}setButtons(e){this.buttons=e,this.activeIndex.set(-1,-1),this.removeAll(!0),this.cursor=this.scene.add.rectangle(0,0,60,80).setStrokeStyle(2,H(M),.75).setVisible(!1).setDepth(1),this.add(this.cursor);for(const t of e)for(const e of t)void 0!==e&&this.add(e)}getActiveButton(){var e;return null==(e=this.buttons[this.activeIndex.y])?void 0:e[this.activeIndex.x]}setActiveButton(e){var t,s,n,o,r,a,l;let{x:h,y:c}=this.activeIndex;if(!1===this.cursor.visible){const e=null==(t=this.buttons[c])?void 0:t[h];return void(e&&(this.updateButtonSize(e),this.cursor.setPosition(e.x,e.y).setVisible(!0),this.cursor.setVisible(!0)))}const d=this.buttons.length;if(c=i.Math.Clamp(c,0,d-1),h=i.Math.Clamp(h,0,((null==(s=this.buttons[c])?void 0:s.length)||0)-1),0===e.x){let t;if(-1!==this.activeIndex.y){for(;c>=0&&c<d&&void 0===t;)c+=e.y,t=null==(n=this.buttons[c])?void 0:n[h];if(!t)return}h=i.Math.Clamp(h,0,(null==(o=this.buttons[c])?void 0:o.length)-1)}if(0===e.y&&-1!==this.activeIndex.x){let t;for(;h>=0&&h<(null==(r=this.buttons[c])?void 0:r.length)&&void 0===t;)h+=e.x,t=null==(a=this.buttons[c])?void 0:a[h];if(!t)return}const u=null==(l=this.buttons[c])?void 0:l[h];u&&(this.updateButtonSize(u),this.cursor.setPosition(u.x,u.y).setVisible(!0),this.activeIndex.set(h,c))}updateButtonSize(e){const t=1.2;e instanceof Wl&&this.cursor.setSize(e.displayWidth*t,e.displayHeight*t),e instanceof sh&&this.cursor.setSize(e.rect.displayWidth*t,e.rect.displayHeight*t)}}const Qh=[[1,1,1,0,1],[1,0,1,0,1],[1,1,1,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],Jh=[["0","1","2"],["3"," ","4"],["5","6","7"]];class Zh extends i.Scene{constructor(){super("UITest"),t(this,"selected"),t(this,"cursor"),t(this,"grid"),this.selected=void 0}create(){var e;const t=[];for(let i=0;i<Qh.length;i++){const e=[];for(let t=0;t<Qh[i].length;t++)Qh[i][t]?e.push(this.btn(t,i)):e.push(void 0);t.push(e)}this.grid=new Yh(this),this.grid.setButtons(t),null==(e=this.input.keyboard)||e.on("keydown-BACK_SLASH",(()=>{t[0][0].text="0",t[0][1].text="1",t[0][2].text="2",t[1][0].text="3",t[1][2].text="4",t[2][0].text="5",t[2][1].text="6",t[0][4].text=" ",t[1][4].text=" ",t[2][4].text=" ",t[3][4].text=" ",t[4][4].text=" ",t[5][4].text=" ",t[6][4].text=" "}))}btn(e,t){return new Wl(this,50+60*e,50+85*t,e<3?" ":t.toString(),(e=>this.selectButton(e)))}selectButton(e){if(void 0===this.selected)this.selected=e,e.setSelected(!0);else{const t=this.selected.text;this.selected.setSelected(!1),this.selected.text=e.text,e.text=t,this.selected=void 0,this.checkValid()&&console.log("You Won!")}}checkValid(){var e;let t=!0;for(let i=0;i<Jh.length;i++)for(let s=0;s<Jh[0].length;s++){const n=null==(e=this.grid.buttons[i])?void 0:e[s];n&&n.text!==Jh[i][s]&&(t=!1)}return t}}class ec extends i.GameObjects.Container{constructor(e,s,n,o,r,a){var l,h;super(e,s,n),t(this,"textObject"),t(this,"maskGraphics"),t(this,"scrollbar"),t(this,"scrollY"),t(this,"boxHeight"),e.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new i.GameObjects.Text(e,0,0,o,{...ll,padding:{x:10,y:10},...r}),this.textObject.setOrigin(0).setScrollFactor(0),a&&this.textObject.setInteractive({useHandCursor:!0}),this.add(this.textObject),e.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),this.textObject.on("pointerdown",((e,t,i)=>{const s=this.textObject.getWrappedText().length,n=i/this.textObject.height,o=Math.floor(n*s);a&&a(o)})),null==(l=e.input.keyboard)||l.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(h=e.input.keyboard)||h.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=e.add.graphics().setPosition(s,n).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=e.add.rectangle(0,0,4,0,5592405).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(e,t){this.boxHeight=t,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,e,t);const i=this.maskGraphics.createGeometryMask();return this.textObject.setMask(i),this.textObject.setWordWrapWidth(e-8),this.textObject.setFixedSize(e-8,0),this.updateTextPosition(),this}setText(e){return this.textObject.setText(e),this.updateTextPosition(),this}handleDrag(e){e.isDown&&(this.scrollY-=e.velocity.y,this.updateTextPosition())}handleScroll(e,t,i,s,n){this.scrollY+=.5*s,this.updateTextPosition()}updateTextPosition(){const e=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=i.Math.Clamp(this.scrollY,0,e),this.textObject.y=-this.scrollY;const t=this.scrollY/e,s=this.boxHeight/this.textObject.height;this.scrollbar.height=s*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+4,t*(this.boxHeight-s*this.boxHeight))}}class tc extends i.Scene{constructor(e){super(e.key),t(this,"dialogData"),t(this,"container"),t(this,"keys"),t(this,"title"),t(this,"additionalUI"),t(this,"closing"),this.dialogData=e}create(){var e,t,i;this.additionalUI=[],this.closing=!1,this.container=this.add.container(v.width/2,v.height/2),this.container.add(this.add.rectangle(0,0,.95*v.width,.95*v.height,0,.75).setStrokeStyle(4,H(M))),this.container.add(new Wl(this,.44*v.width,-.4*v.height,"X",(()=>this.close(!1)),{backgroundColor:`#${F}`})),v.prod||this.dialogData.hideCloseSuccess||this.container.add(new sh(this,.38*v.width,-.4*v.height,"award",(()=>this.startClose(!0)))),this.title=this.add.text(0,-.4*v.height,this.dialogData.title,{...ll,fontSize:48}).setOrigin(.5),this.container.add(this.title),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.startClose(!1)})),null==(t=this.input.keyboard)||t.on("keydown-BACKSPACE",(()=>{this.startClose(!1)})),v.prod||null==(i=this.input.keyboard)||i.on("keydown-BACK_SLASH",(()=>{this.startClose(!0)})),this.keys=new ce(this),new ih(this,!0).setVisible(this.dialogData.gamepadVisible),this.container.setAlpha(0),this.dialogData.childScene?(this.scene.launch(this.dialogData.childScene,{parent:this}),this.scene.get(this.dialogData.childScene).events.on("create",(()=>this.fadeIn()))):this.fadeIn()}fadeIn(){this.tweens.add({targets:this.getTargets(),alpha:{start:0,to:1},delay:100,duration:500})}fadeOut(e){this.tweens.add({targets:this.getTargets(),alpha:{start:1,to:0},duration:250,hold:250,onComplete:e})}addTarget(e){e.setAlpha(0),this.additionalUI.push(e)}getTargets(){return[this.container,...this.additionalUI]}startClose(e){this.closing||(this.closing=!0,this.close(e))}close(e){this.fadeOut((()=>{var t,i,s,n;this.scene.stop(),this.dialogData.childScene&&this.scene.stop(this.dialogData.childScene),this.scene.resume("Game"),null==(i=null==(t=this.scene.get("Game"))?void 0:t.gamepad)||i.setAlpha(1),null==(n=null==(s=this.scene.get("Game"))?void 0:s.gamepad)||n.resetButtons(),this.handleSuccess(e)}))}}const ic="chrono-sleuth-debug-tab";function sc(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function nc(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?sc(Object(i),!0).forEach((function(t){oc(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sc(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function oc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function rc(e){return e.slice(0,-1)}function ac(e,t=0){return t?Array.from(Array(t-e).keys()).map((t=>t+e)):Array.from(Array(e).keys())}function lc(e){return[...new Set(e)]}function hc(e,t){const i=lc(e.map((e=>e.set))).filter(Boolean),s=(n=ac(1,e.length+1),o=i,[n,o].reduce(((e,t)=>e.filter((e=>!t.includes(e)))))).sort((()=>.5-t()));var n,o;e.filter((e=>!e.set)).forEach(((e,t)=>e.set=s[t]))}function cc(e,t,i=.5){rc(e).forEach(((s,n)=>{const o=e[n+1],r=s.set!==o.set,a=t()<=i;var l,h,c;r&&a&&(l=e,h=o.set,c=s.set,l.forEach((e=>{e.set===h&&(e.set=c)})),s.right=!1,o.left=!1)}))}const dc=48;class uc extends i.Scene{constructor(){super("Maze"),t(this,"parent"),t(this,"graphics"),t(this,"keys"),t(this,"maze"),t(this,"mazePlayer"),t(this,"nextUpdate")}init(e){this.parent=e.parent}create(){this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,.8*dc,.8*dc,5601177).setSmoothness(32).setOrigin(-.13),this.cameras.main.startFollow(this.mazePlayer),this.keys=this.parent.keys,this.parent.addTarget(this.graphics),this.parent.addTarget(this.mazePlayer)}getMazeSeed(){return this.parent.player.gameState.data.mazeSeed||0}createMaze(){const e=this.getMazeSeed();this.maze=function(e=8,t=e,i=!0,s=1){const n=function(e){return function(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}(s),o=[],r=ac(e);for(let h=0;h<t;h+=1){const s=r.map((s=>({x:s,y:h,top:i||h>0,left:i||s>0,bottom:i||h<t-1,right:i||s<e-1})));o.push(s)}rc(o).forEach(((e,t)=>{hc(e,n),cc(e,n),function(e,t,i){const s=Object.values(function(e){let t=lc(e.map((e=>e.set))).reduce(((e,t)=>nc(nc({},e),{},{[t]:[]})),{});return e.forEach((e=>t[e.set].push(e))),t}(e)),{ceil:n}=Math;s.forEach((e=>{(function(e,t,i){t=null==t?1:t;const s=null==e?0:e.length;if(!s||t<1)return[];t=t>s?s:t;let n=-1;const o=s-1,r=[...e];for(;++n<t;){const e=n+Math.floor(i()*(o-n+1)),t=r[e];r[e]=r[n],r[n]=t}return r.slice(0,t)})(e,n(i()*e.length),i).forEach((e=>{if(e){const i=t[e.x];e.bottom=!1,i.top=!1,i.set=e.set}}))}))}(e,o[t+1],n)}));const a=(l=o)[l.length-1];var l;return hc(a,n),cc(a,n,1),o}(24,24,!0,e),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,dc,dc),this.graphics.lineStyle(3,3385907),this.maze.forEach((e=>{e.forEach((e=>{if(e.top){const t=new i.Geom.Line(e.x*dc,e.y*dc,e.x*dc+dc,e.y*dc);this.graphics.strokeLineShape(t)}if(e.bottom){const t=new i.Geom.Line(e.x*dc,e.y*dc+dc,e.x*dc+dc,e.y*dc+dc);this.graphics.strokeLineShape(t)}if(e.left){const t=new i.Geom.Line(e.x*dc,e.y*dc,e.x*dc,e.y*dc+dc);this.graphics.strokeLineShape(t)}if(e.right){const t=new i.Geom.Line(e.x*dc+dc,e.y*dc,e.x*dc+dc,e.y*dc+dc);this.graphics.strokeLineShape(t)}}))})),this.cameras.main.setViewport(50,130,v.width-100,v.height-170)}update(e,t){if(e<this.nextUpdate)return;const s=this.keys.keys,n=new i.Math.Vector2(0,0);s[he.Left]?n.x=-48:s[he.Right]?n.x=dc:s[he.Up]?n.y=-48:s[he.Down]&&(n.y=dc);const o=new i.Math.Vector2(this.mazePlayer.x+n.x,this.mazePlayer.y+n.y);if((this.mazePlayer.x!==o.x||this.mazePlayer.y!==o.y)&&this.canMove(o)){this.mazePlayer.setPosition(o.x,o.y);const e=new i.Math.Vector2(1104,1104);this.parent.setAngle(i.Math.Angle.BetweenPoints(o,e)),this.mazePlayer.x===e.x&&this.mazePlayer.y===e.y&&this.parent.close(!0)}this.nextUpdate=e+140}canMove(e){const t=e.x,s=e.y,n=i.Math.FloorTo(t/dc),o=i.Math.FloorTo(s/dc);if(n<0||o<0||n>=24||o>=24)return!1;const r=i.Math.FloorTo(this.mazePlayer.x/dc),a=i.Math.FloorTo(this.mazePlayer.y/dc),l=this.maze[a][r];return!(l.top&&s<this.mazePlayer.y||l.bottom&&s>this.mazePlayer.y||l.left&&t<this.mazePlayer.x||l.right&&t>this.mazePlayer.x)}}class pc extends i.GameObjects.Rectangle{constructor(e,s,n){super(e,0,0,s.size,s.size),t(this,"keys"),t(this,"cursorData"),t(this,"nextUpdate",0),t(this,"position",new i.Math.Vector2(-1,-1)),e.add.group(this,{runChildUpdate:!0}),this.setStrokeStyle(2,H(M),.75),this.setVisible(!1),this.cursorData=s,this.keys=n,e.input.on("pointerdown",(e=>{this.setVisible(!1)}))}update(e,t){var s;if(e<this.nextUpdate)return;let n=!0;const o=null==(s=this.cursorData.regions[0])?void 0:s.length,r=this.cursorData.regions.length,a=this.keys.keys;a[he.Continue]?this.cursorData.keyHandler(this.position):a[he.Left]?this.position.x--:a[he.Right]?this.position.x++:a[he.Up]?this.position.y--:a[he.Down]?this.position.y++:n=!1,n&&(this.position.x=i.Math.Clamp(this.position.x,0,o-1),this.position.y=i.Math.Clamp(this.position.y,0,r-1),this.nextUpdate=e+170,this.setVisible(!0),this.setPosition(this.cursorData.regions[this.position.y][this.position.x].x,this.cursorData.regions[this.position.y][this.position.x].y))}}"function"==typeof SuppressedError&&SuppressedError;class yc extends i.Scene{constructor(){super("Paused"),t(this,"parent"),t(this,"debugCount"),t(this,"container")}init(e){this.parent=e.game}create(){var e;const{width:t,height:i}=v;this.container=this.add.container(0,0),this.container.add(this.add.rectangle(t/2,i/2,t,i,0,.75).setInteractive().on("pointerdown",(()=>this.resume()))),this.container.add(this.add.text(t/2,v.height/2-100,"Game Paused",{...ll,fontSize:72}).setOrigin(.5)),this.debugCount=0,this.container.add(this.add.text(t-20,i-20,`Build Time: ${new Date("2024-11-27T20:43:58.785Z").toLocaleString()}\n${v.prod?"":"Debug Mode"}`,{...ll,fontSize:16,align:"right",padding:{x:20,y:20}}).setOrigin(1,1).setInteractive({useHandCursor:!1}).on("pointerdown",(()=>{this.debugCount++,this.debugCount>10&&(localStorage.setItem("chrono-sleuth-prod",v.prod?"false":"true"),window.location.reload())})));const s=v.zoomed?36:48,n=new Yh(this);this.container.add(n);const o=new sh(this,v.width-210,30,"tv",(()=>{pl()})),r=new sh(this,v.width-150,30,"gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)})),a=new sh(this,v.width-90,30,this.parent.sound.mute?"volume-mute":"volume",(()=>{const e=this.parent.sound.mute;this.parent.sound.mute=!e,a.setIcon(e?"volume":"volume-mute")})),l=new qh(this,v.width-30,30),h=new Wl(this,t/2,v.height/2,"Resume",(()=>this.resume()),{fontSize:s});let c;v.prod||(c=new sh(this,30,30,"terminal",(()=>{this.resume(),this.parent.time.delayedCall(200,(()=>{te(this.parent,"DebugTool")}))}))),n.setButtons([[c,o,r,a,l],[void 0,h,void 0,void 0,void 0],[void 0,void 0,void 0,void 0,void 0]]),n.activeIndex.set(1,1),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>this.resume())),new ih(this).setVisible(!1),this.tweens.add({targets:this.container,alpha:{start:0,to:1},duration:250})}resume(){this.tweens.add({targets:this.container,alpha:{start:1,to:0},duration:250,onComplete:()=>{this.scene.stop(),this.scene.resume("Game")}})}}class gc extends i.Scene{constructor(){super("Pipes"),t(this,"parent"),t(this,"keys"),t(this,"pipes",[]),t(this,"totalPipes",0),t(this,"images",[]),t(this,"container"),t(this,"blockSize"),t(this,"pipeSize"),t(this,"initialized",!1)}init(e){this.parent=e.parent,this.blockSize=v.zoomed?13:17,this.pipeSize=3.75*this.blockSize}preload(){this.prerenderPipes()}prerenderPipes(){for(const e of mh){const t=oh[e],i=`pipe_${e}`;this.textures.exists(i)&&this.textures.remove(i);const s=this.textures.createCanvas(i,3*this.blockSize,3*this.blockSize);if(s){const e=s.context;e.fillStyle="#ffffff";for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++)1===t[i][s]&&e.fillRect(s*this.blockSize,i*this.blockSize,this.blockSize,this.blockSize);s.refresh()}}}create(){this.keys=this.parent.keys,this.container=this.add.container(),this.createPipes();const e=[];for(let i=0;i<6;i++){e.push([]);for(let t=0;t<14;t++)e[i].push({x:(t+1)*this.pipeSize,y:(i+1)*this.pipeSize})}const t=new pc(this,{regions:e,size:this.pipeSize,keyHandler:e=>{const t=this.pipes[e.y+1][e.x+1];t.interactive&&(t.rotation=(t.rotation+90)%360,this.updatePipes())}},this.keys);this.container.add(t)}createPipes(){this.pipes=[],this.container=this.add.container().setPosition(v.width/2-16*this.pipeSize/2+this.pipeSize/2,v.height/4),this.totalPipes=0;for(let e=0;e<8;e++){this.pipes[e]||(this.pipes[e]=[]);for(let t=0;t<16;t++){let s=rh[e][t];const n=0===t||0===e||15===t||7===e,o=15===t&&7===e,r=!n;this.pipes[e][t]={x:t,y:e,type:s,rotation:n?0:90*i.Math.Between(0,3),interactive:r},s!==nh.Empty&&this.totalPipes++;const a=t+e*rh[0].length;this.time.delayedCall(50+5*a,(()=>{const i=`pipe_${s}`,n=this.add.image(t*this.pipeSize,e*this.pipeSize,i).on("pointerdown",(()=>{this.initialized&&(this.pipes[e][t].rotation=(this.pipes[e][t].rotation+90)%360,this.updatePipes())}));n.setAlpha(0).setScale(.5).setAngle(this.pipes[e][t].rotation),this.tweens.add({targets:n,alpha:1,scale:1,duration:300,onComplete:o?()=>{this.initialized=!0,this.updatePipes()}:void 0}),r?n.setInteractive():n.setTint(6710886),this.container.add(n),this.images.push(n)}))}}this.parent.addTarget(this.container)}updatePipes(){const e=function(e){const t=[],i=new Set,s=e.length,n=e[0].length;return function o(r,a){const l=`${r},${a}`;i.add(l),t.push(e[a][r]),r+1<n&&!i.has(`${r+1},${a}`)&&ah(e[a][r],e[a][r+1])&&o(r+1,a),r-1>=0&&!i.has(`${r-1},${a}`)&&ah(e[a][r],e[a][r-1])&&o(r-1,a),a+1<s&&!i.has(`${r},${a+1}`)&&ah(e[a][r],e[a+1][r])&&o(r,a+1),a-1>=0&&!i.has(`${r},${a-1}`)&&ah(e[a][r],e[a-1][r])&&o(r,a-1)}(0,2),t}(this.pipes);this.pipes.forEach((e=>{e.forEach((e=>{this.images[e.x+e.y*rh[0].length].setAngle(e.rotation)}))})),e.length===this.totalPipes&&this.parent.close(!0)}completed(e){const t=this.images.length,s=new i.Display.Color(255,255,255),n=_(H(D));for(let i=0;i<t;i++){const o=this.images[i];U(this,s,n,(e=>o.setTint(e)),{duration:500,delay:10*i,hold:1e3,onComplete:i===t-1?e:void 0})}}}const fc=v.height/(v.zoomed?4:5.5),mc=[[1,0,1,1,0],[0,1,0,0,0],[0,0,1,0,1],[0,0,1,1,0],[1,1,0,0,1]],bc=2*Math.PI/16;!function(e={}){const{immediate:t=!1,onNeedRefresh:i,onOfflineReady:s,onRegistered:n,onRegisteredSW:o,onRegisterError:a}=e;let l,h;h=async function(){if("serviceWorker"in navigator){if(l=await function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),o=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=Promise.allSettled(t.map((t=>{if(t=function(e,t){return new URL(e,t).href}(t,i),t in r)return;r[t]=!0;const s=t.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(i)for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.href===t&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${t}"]${n}`))return;const a=document.createElement("link");return a.rel=s?"stylesheet":"modulepreload",s||(a.as="script"),a.crossOrigin="",a.href=t,o&&a.setAttribute("nonce",o),document.head.appendChild(a),s?new Promise(((e,i)=>{a.addEventListener("load",e),a.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)}))}((async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-BXNXHyjv.js");return{Workbox:e}}),[],import.meta.url).then((({Workbox:e})=>new e("./sw.js",{scope:"./",type:"classic"}))).catch((e=>{null==a||a(e)})),!l)return;l.addEventListener("activated",(e=>{(e.isUpdate||e.isExternal)&&window.location.reload()})),l.addEventListener("installed",(e=>{e.isUpdate||null==s||s()})),l.register({immediate:t}).then((e=>{o?o("./sw.js",e):null==n||n(e)})).catch((e=>{null==a||a(e)}))}}()}({immediate:!0});const vc={type:Phaser.WEBGL,width:v.width,height:v.height,parent:"game-container",backgroundColor:H(W),scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},loader:{imageLoadType:"HTMLImageElement"},scene:[Uh,Xh,Kh,$h,Sh,yc,class extends tc{constructor(){super({key:"JournalDialog",title:"Journal",gamepadVisible:!1,hideCloseSuccess:!0}),t(this,"player")}init(e){this.player=e.player}create(){var e;super.create(),this.player.journal.unread.setVisible(!1);const t=this.player.journal.journal.map((e=>`- ${ye[e].description}\n`)).reverse(),i=new ec(this,.08*v.width,.25*v.height,t,{fontSize:32});i.setBoxSize(.84*v.width,.62*v.height),this.addTarget(i),this.fadeIn(),null==(e=this.input.keyboard)||e.on("keydown-J",(()=>{this.close()}))}handleSuccess(){}},class extends tc{constructor(){super({key:"DebugTool",title:"Debug Tool",gamepadVisible:!1,hideCloseSuccess:!0}),t(this,"player"),t(this,"tabs",[]),t(this,"tab",0),t(this,"mainContainer"),t(this,"textBox"),t(this,"helperText"),t(this,"stateContainer"),t(this,"saveContainer"),t(this,"miscContainer"),t(this,"testVoice",{octave:3.5,speed:1,volume:1,type:"sine"});const e=localStorage.getItem(ic);e&&(this.tab=Number(e))}init(e){this.player=e.player}create(){var e;super.create(),this.mainContainer=this.add.container(-v.width/2,-v.height/2),this.container.add(this.mainContainer),this.mainContainer.add(this.add.rectangle(300,100,.65*v.width,.75*v.height,H("#112233")).setOrigin(0));const t=this.makeTab("Items",0),i=this.makeTab("Journal",1),s=this.makeTab("Quests",2),n=this.makeTab("State",3),o=this.makeTab("Warp",4),r=this.makeTab("Saves",5),a=this.makeTab("Misc",6);this.textBox=new ec(this,300,100,"",{fontSize:32},(e=>this.handleLineClick(e))).setBoxSize(.38*v.width,.75*v.height),this.mainContainer.add(this.textBox),this.helperText=this.add.text(v.zoomed?.94*v.width:.87*v.width,110,"",{...ll,fontSize:24}).setOrigin(1,0).setDepth(1),this.mainContainer.add(this.helperText),this.tabs=[t,i,s,n,o,r,a],this.container.add(this.tabs),this.createStateContainer(),this.createSaveContainer(),this.createMiscContainer(),this.updateTabs(),null==(e=this.input.keyboard)||e.on("keydown-CLOSED_BRACKET",(()=>{this.close()}))}createStateContainer(){this.stateContainer=this.add.container(310,100),this.mainContainer.add(this.stateContainer);const e=this.player.gameState.data;Object.entries(e).forEach(((t,i)=>{const[s,n]=t,o=this.add.text(0,20+40*i,`${s}: ${n}`,{...ll,fontSize:32}).setOrigin(0);switch(this.stateContainer.add(o),typeof n){case"boolean":o.setText(`${n?"[x]":"[ ]"} ${s}`),o.setInteractive().on("pointerdown",(()=>{e[s]=!e[s],o.setText(`${e[s]?"[x]":"[ ]"} ${s}`)}));break;case"number":const t=this.smallButton(o.width+20,22+40*i,"-",(()=>{e[s]--,o.setText(`${s}: ${e[s]}`)})),r=this.smallButton(o.width+55,22+40*i,"+",(()=>{e[s]++,o.setText(`${s}: ${e[s]}`)}));this.stateContainer.add([t,r])}}))}smallButton(e,t,i,s){return new Rl(this,e,t,i,s,{fontSize:36,backgroundColor:"#111",padding:{x:6,y:-4}},null)}createSaveContainer(){this.saveContainer=this.add.container(310,100),this.mainContainer.add(this.saveContainer),Object.entries(_h).forEach(((e,t)=>{const[i,s]=e,n=new Rl(this,0,10+60*t,Rh[Number(i)],(()=>{Number(i)===Rh.New?(localStorage.removeItem(Wh),window.location.reload()):(Sl(this.player.scene,s),this.close(!0))}),{backgroundColor:"#111"});this.saveContainer.add(n)}));const e=new Rl(this,350,10,"Dump Save",(()=>{const e=(t=ml(this.player.scene),JSON.stringify(t,((e,t)=>{const i=vl[e];return Array.isArray(t)&&i?t.map((e=>ie(e,i.enumObj,i.enumName))):i?ie(t,i.enumObj,i.enumName):t}),2).replace(/"(\w+\.\w+)"/g,"$1"));var t;navigator.clipboard.writeText(e).catch((e=>console.error(e))),console.warn("save copied to clipboard!"),console.log(e)}),{backgroundColor:"#111"});this.saveContainer.add(e)}createMiscContainer(){this.miscContainer=this.add.container(310,100),this.mainContainer.add(this.miscContainer);const e=new Rl(this,350,10,"Debug Mode",(()=>{v.debug=!v.debug,this.close()}),{backgroundColor:"#111"});this.miscContainer.add(e);const t=new Rl(this,350,320,"Play",(()=>Gl(function(){const e=Math.floor(41*Math.random())+50;let t=Array.from({length:e},(()=>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random())))).join("");const i=Math.floor(3*Math.random())+1;for(let n=0;n<i;n++){const e=Math.floor(Math.random()*t.length);t=t.substring(0,e)+","+t.substring(e)}const s=Math.floor(Math.random()*(e/10));for(let n=0;n<s;n++){const e=Math.floor(Math.random()*(t.length-2))+1;t=t.substring(0,e)+" "+t.substring(e)}return t}(),this.testVoice,1))).setDepth(1),i=new Rl(this,350,130,`Type: ${this.testVoice.type}`,(()=>{const e=["sine","square","triangle","sawtooth"],t=e.indexOf(this.testVoice.type);this.testVoice.type=e[(t+1)%4],i.text=`Type: ${this.testVoice.type}`})),s=this.rangeInput(350,200,(()=>this.testVoice.speed),(e=>this.testVoice.speed=e),"Speed"),n=this.rangeInput(350,240,(()=>this.testVoice.octave),(e=>this.testVoice.octave=e),"Octave"),o=this.rangeInput(350,280,(()=>this.testVoice.volume),(e=>this.testVoice.volume=e),"Volume");this.miscContainer.add([t,i,...s,...n,...o])}makeTab(e,t){return new Rl(this,40-this.container.x,100-this.container.y+60*t,e,(()=>{this.tab=t,localStorage.setItem(ic,String(t)),this.updateTabs()}))}rangeInput(e,t,i,s,n){const o=this.add.text(e,t,`${n}: ${i().toFixed(1)}`,{...ll}),r=this.smallButton(e+130,t,"-",(()=>{s(i()-.1),o.text=`${n}: ${i().toFixed(1)}`})),a=this.smallButton(e+170,t,"+",(()=>{s(i()+.1),o.text=`${n}: ${i().toFixed(1)}`}));return[o,r,a]}handleLineClick(e){var t,i;switch(this.tab){case 0:const s=ch[e],n=this.player.inventory.inventory,o=n.find((e=>e.type===s));o?o.used?n.splice(n.indexOf(o),1):o.used=!o.used:this.player.inventory.addItem({type:s,used:!1},!0);break;case 1:const r=dh[e],a=this.player.journal.journal;Pe(this.player,r)?a.splice(a.indexOf(r),1):this.player.journal.addEntry(r,!0);break;case 2:const l=yh[e],h=this.player.quests.quests,c=h.find((e=>e.id===l));c?c.completed?h.splice(h.indexOf(c),1):c.completed=!c.completed:this.player.quests.addQuest({id:l,completed:!1},!0);break;case 4:const d=gh[e],u=me[d];this.player.setPosition(u.x,u.y),this.close();break;case 6:if(e>1){const s=bh[e-2];"MainMenu"===s?(this.scene.sendToBack("Game"),this.scene.start(s)):(this.scene.stop(this),this.scene.resume("Game"),null==(i=null==(t=this.scene.get("Game"))?void 0:t.gamepad)||i.setAlpha(1),te(this.player.scene,s))}}this.updateTabs()}updateTabs(){var e,t,i;this.tabs.forEach(((e,t)=>{e.setBackgroundColor(t===this.tab?"#123":"#151515")}));const s=0===this.tab||1===this.tab||2===this.tab||4===this.tab||6===this.tab,n=0===this.tab||2===this.tab;null==(e=this.stateContainer)||e.setVisible(3===this.tab),null==(t=this.saveContainer)||t.setVisible(5===this.tab),null==(i=this.miscContainer)||i.setVisible(6===this.tab),this.textBox.setVisible(s),this.helperText.setVisible(n);let o="";switch(this.tab){case 0:o=ch.map((e=>`[${Se(this.player,e)?"-":ke(this.player,e)?"x":" "}] ${k[e]}`)).join("\n"),this.helperText.setText("[-] item held\n[x] item used");break;case 1:o=dh.map((e=>`[${Pe(this.player,e)?"x":" "}] ${C[e]}`)).join("\n");break;case 2:o=yh.map((e=>`[${Ie(this.player,e)?"-":Te(this.player,e)?"x":" "}] ${I[e]}`)).join("\n"),this.helperText.setText("[-] quest active\n[x] quest complete");break;case 4:o=gh.map((e=>S[e])).join("\n");break;case 6:o=["Scenes","-----------------",...bh].join("\n")}this.textBox.setText(o)}handleSuccess(e){e||Sl(this.player.scene),this.player.scene.scene.restart()}},class extends tc{constructor(){super({key:"MazeDialog",title:"Find your way through the forest",childScene:"Maze",gamepadVisible:!0}),t(this,"player"),t(this,"arrow")}init(e){var t,i;this.player=e.player,this.dialogData.gamepadVisible=null==(i=null==(t=e.player.scene)?void 0:t.gamepad)?void 0:i.visible}create(){super.create(),this.arrow=this.add.image(.4*-v.width,.4*-v.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow)}setAngle(e){this.arrow.setRotation(e+Math.PI/2)}handleSuccess(e){e?(we(S.Forest,this.player),this.player.gameState.updateData({mazeSolved:!0,mazeSeed:this.player.gameState.data.mazeSeed+1},!1)):this.player.setPosition(me[S.TownEast].x-100,me[S.TownEast].y)}},uc,class extends tc{constructor(){super({key:"PipesDialog",title:"Attach all of the pipes to fix the alchemy set.\n[CONTINUE/CLICK] to rotate",gamepadVisible:!1,childScene:"Pipes"}),t(this,"player")}init(e){this.player=e.player}create(){super.create(),this.title.setFontSize(36).setAlign("center").setY(this.title.y+10)}close(e){const t=this.scene.get("Pipes");e&&t?t.completed((()=>super.close(e))):super.close(e)}handleSuccess(e){e&&this.player.message.setDialog(Ch,Ee(this.player.scene,j.AlchemySet),"player_portrait")}},gc,class extends tc{constructor(){super({key:"TumblerDialog",title:"Open the lock by aligning all rings",gamepadVisible:!1}),t(this,"player"),t(this,"angles"),t(this,"rings"),t(this,"line"),t(this,"fx"),t(this,"active"),t(this,"nextUpdate"),t(this,"disabled")}init(e){this.player=e.player}preload(){this.load.setPath("assets");for(let e=1;e<=5;e++)this.load.image(`ring_${e}`,`puzzles/tumbler/ring${e}.png`)}create(){super.create(),this.angles=[],this.rings=[],this.fx=[],this.active=-1,this.nextUpdate=0,this.disabled=!1,this.line=this.add.line(0,30,27,0,216,0,H(G)).setOrigin(0,0).setLineWidth(5),this.container.add(this.line),this.container.add(this.add.text(.45*-v.width,.2*v.height,"Use [Left]/[Right]\nto select a ring\n\nUse [Up]/[Down]\nto rotate a ring",{...ll}));for(let e=0;e<mc.length;e++){let t=Math.floor(Math.random()*Math.PI*2);t=i.Math.Snap.To(t,bc),t=e/5*Math.PI*2,this.angles.push(t),this.circle(e)}this.updateMarkers()}circle(e){const t={x:v.width/2,y:v.height/2},s=this.add.image(0,30,`ring_${e+1}`).setScale(.8).setInteractive({draggable:!0,useHandCursor:!0,pixelPerfect:!0}).on("drag",(s=>{if(this.active=-1,s.isDown){this.active=e;const n=i.Math.Angle.Between(t.x,t.y,s.x,s.y);this.handleMove(e,n)}})).on("dragstart",(s=>{if(this.active=-1,s.isDown){this.active=e;const n=i.Math.Angle.Between(t.x,t.y,s.x,s.y);this.handleMove(e,n)}})).on("dragend",(()=>{this.active=-1,this.updateMarkers(!0)}));this.fx.push(s.postFX.addGlow(H(G),2,0)),this.input.enableDebug(s),this.container.add(s),this.rings.push(s)}handleMove(e,t,i){var s;if(this.disabled)return;const n=this.angles[e]-t;this.angles[e]=t%(2*Math.PI),null==(s=mc[e])||s.forEach(((t,i)=>{i!==e&&(this.angles[i]=(this.angles[i]+t*n)%(2*Math.PI))})),this.updateMarkers(i)}updateMarkers(e){let t=!0;this.angles.forEach(((e,s)=>{var n;const o=i.Math.Snap.To(e,bc);Math.abs(o-0)<.6*bc||Math.abs(o-2*Math.PI)<.6*bc||(t=!1),null==(n=this.rings[s])||n.setAngle(i.Math.RadToDeg(o))})),t&&e&&this.close(!0)}completed(e){this.tweens.add({targets:this.rings,rotation:0,duration:500,onComplete:()=>{this.angles=[0,0,0,0,0],this.updateMarkers(),this.disabled=!0,this.active=-1,this.tweens.add({targets:[...this.rings,this.line],rotation:2*Math.PI,delay:500,duration:1500,hold:1e3,onComplete:e})}})}update(e,t){var s;if(!(e<this.nextUpdate)){if(this.nextUpdate=e+100,!this.disabled){const t=this.keys.keys;t[he.Left]?(this.nextUpdate=e+300,this.active=i.Math.Clamp(this.active-1,0,this.angles.length-1)):t[he.Right]?(this.nextUpdate=e+300,this.active=i.Math.Clamp(this.active+1,0,this.angles.length-1)):t[he.Up]?this.handleMove(this.active,this.angles[this.active]-bc,!0):t[he.Down]&&this.handleMove(this.active,this.angles[this.active]+bc,!0)}for(let e=0;e<5;e++)null==(s=this.rings[e])||s.setTint(this.active===e?H("C49B7C"):void 0),this.fx[e].color=H(this.active===e?"C49B7C":G)}}close(e){e?this.completed((()=>super.close(e))):super.close(e)}handleSuccess(e){e&&function(e){e.inventory.removeItem(k.Potion);const t=e.scene,i=new Mh(e.scene,k.Gear2,e);t.interactiveObjects.add(i);const s=Ee(t,j.MansionPicture);s&&(i.disabled=!0,i.setPosition(s.x,s.y+20),t.tweens.add({targets:i,x:s.x-10,y:s.y+120,duration:1e3,onComplete:()=>{e.message.setDialog({messages:["Wow, that was a trip","I should be more careful next time","At least I found the gear!"],onCompleted:()=>{fl(t,!1),t.time.delayedCall(1e3,(()=>i.disabled=!1))}},s,"player_portrait")},ease:"Bounce.easeOut"}))}(this.player)}},class extends tc{constructor(){super({key:"MemoryDialog",title:"Figure out the secret code",gamepadVisible:!1}),t(this,"sequence"),t(this,"pressed"),t(this,"buttons"),t(this,"player")}init(e){this.player=e.player}preload(){this.load.setPath("assets");for(let e=1;e<=12;e++)this.load.image(`rune_${e}`,`puzzles/runes/Stone${e}.png`)}create(){for(super.create(),this.sequence=[],this.pressed=[];this.sequence.length<6;){const e=i.Math.RND.between(0,11);this.sequence.includes(e)||this.sequence.push(e)}v.prod||this.container.add(this.add.text(0,.43*v.height,`[ ${this.sequence.map((e=>e+1)).join(", ")} ]`,{fontSize:18,align:"center"}).setOrigin(.5)),this.buttons=new Hl(this),this.container.add(this.buttons);const e=v.width/13*1.2,t=[];for(let i=0;i<12;i++){const s=i%3*e-e,n=1.2*-e+Math.floor(i/3)*e,o=Math.floor(i/3);void 0===t[o]&&t.push([]),t[o].push({x:s,y:n});const r=this.add.image(s,n,`rune_${i+1}`).setInteractive({useHandCursor:!0});r.on("pointerdown",(()=>this.onButtonPress(r,i))),this.buttons.add(r)}const s=new pc(this,{regions:t,size:e,keyHandler:e=>{const t=3*e.y+e.x,i=this.buttons.getAt(t);this.onButtonPress(i,t)}},this.keys);this.container.add(s)}onButtonPress(e,t){const s=this.pressed.length;this.sequence[s]===t?(this.pressed.push(t),e.disableInteractive(),U(this,new i.Display.Color(255,255,255),_(H(L)),(t=>e.setTint(t)),{duration:250,onComplete:()=>{U(this,_(H(L)),_(3355443),(t=>e.setTint(t)),{duration:250,onComplete:()=>{this.sequence.length===this.pressed.length&&this.close(!0)}})}})):(e.disableInteractive(),U(this,new i.Display.Color(255,255,255),_(H(F)),(t=>e.setTint(t)),{duration:250,yoyo:!0,onComplete:()=>{this.buttons.each((e=>{e.setInteractive(),e.setTint(16777215)}))}}),this.pressed=[])}close(e){e?this.completed((()=>super.close(e))):super.close()}completed(e){this.time.delayedCall(300,(()=>{this.buttons.getAll().forEach(((t,i)=>{const s=11===i,n=t.tint,o=_(n),r=_(H(L));t.disableInteractive(),t.setTint(n),U(this,o,r,(e=>t.setTint(e)),{duration:200,delay:70*i,hold:500,onComplete:s?e:void 0})}))}))}handleSuccess(e){e&&function(e){const t=e.scene,i=new Mh(t,k.Gear1,e);t.interactiveObjects.add(i);const s=Ee(t,j.Chest);s&&(e.setX(s.x-100),s.setTexture("chest_open"),s.disabled=!0,i.disabled=!0,i.setPosition(s.x,s.y-20),i.setScale(.15),t.tweens.add({targets:i,scale:.35,y:s.y+20,duration:700,onComplete:()=>{s.disabled=!1,i.disabled=!1},ease:"Bounce.easeOut"}))}(this.player)}},class extends tc{constructor(){super({key:"SliderDialog",title:"Arrange the tiles to be in order.",gamepadVisible:!1}),t(this,"solution",[]),t(this,"layout",[]),t(this,"tiles",[])}preload(){this.load.setPath("assets");const e=Math.floor(1024/3);this.load.spritesheet("puzzle","puzzles/puzzle.png",{frameWidth:e,frameHeight:e})}create(){super.create();const e=[];this.solution=Array.from({length:9},((e,t)=>t)),this.layout=[...this.solution],this.tiles=[];for(let i=this.layout.length-1;i>0;i--){const e=Math.floor(Math.random()*(i+1));[this.layout[i],this.layout[e]]=[this.layout[e],this.layout[i]]}this.layout.forEach(((t,i)=>{const s=i%3,n=Math.floor(i/3),o=(s-1)*fc,r=(n-1)*fc+30;void 0===e[n]&&(e[n]=[]),e[n].push({x:o,y:r});const a=this.add.image(o,r,"puzzle",i).setOrigin(.5).setDisplaySize(.95*fc,.95*fc);this.container.add(a),a.setInteractive({useHandCursor:!0}),a.on("pointerdown",(()=>{this.moveTile(i)})),this.tiles.push(a)}));const t=new pc(this,{regions:e,size:1.1*fc,keyHandler:e=>{const t=3*e.y+e.x;this.moveTile(t)}},this.keys);this.container.add(t),this.updateLayout()}moveTile(e){const t=this.layout.indexOf(8),i=t%3,s=Math.floor(t/3),n=e%3,o=Math.floor(e/3);Math.abs(i-n)+Math.abs(s-o)===1&&(this.layout[t]=this.layout[e],this.layout[e]=8,this.updateLayout()),this.layout.join("")===this.solution.join("")&&this.handleSuccess(!0)}updateLayout(){this.layout.forEach(((e,t)=>{this.tiles[t].setFrame(e),this.tiles[t].setVisible(8!=e)}))}completed(e){for(let t=0;t<this.layout.length+1;t++)this.time.delayedCall(150*t,(()=>{t<this.layout.length&&(this.tiles[t].setFrame(t),this.tiles[t].setVisible(8!=t)),t>0&&this.tiles[t-1].setTint(6710886)}));this.time.delayedCall(2e3,e)}close(e){e?this.completed((()=>super.close(e))):super.close(e)}handleSuccess(e){e&&this.time.delayedCall(750,(()=>{this.close(!0)}))}},Zh],pipeline:{CRTPipeline:dl,XRayPipeline:gl},input:{gamepad:!0},disableContextMenu:v.prod,physics:{default:"arcade"},fps:{limit:60},render:{pixelArt:!0,antialias:!1},dom:{createContainer:!0},plugins:{scene:[{key:"PipelinePlugin",plugin:ul,mapping:"pipelinePlugin"}]}};oe.style.cursor="none",oe.addEventListener("mousemove",(function(){oe.style.cursor="default",clearTimeout(ne),ne=setTimeout((()=>{oe.style.cursor="none"}),2500)}));const wc=document.querySelector("#initial-loader");null==wc||wc.remove(),new i.Game(vc);
