var t=Object.defineProperty,e=(e,i,n)=>(((e,i,n)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n})(e,"symbol"!=typeof i?i+"":i,n),n);import{p as i,g as n,c as r,a as o}from"./phaser-pZmLa9DQ.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const s={},a={width:1280,height:720},h={width:960,height:540};let l=!1,c=!1;c=!0;const{width:p,height:u}=a;l=!1,c=!1;const y={debug:!1,width:p,height:u,cameraOffset:u/3,zoomed:!1,dayMinutes:.25,rewindEnabled:!1,fastMode:!1};class d extends i.Scene{constructor(){super("Boot")}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("splash","splash.png")}create(){this.scene.start("Preloader")}}var f=(t=>(t[t.Backgrounds=0]="Backgrounds",t[t.Warpers=1]="Warpers",t[t.Npcs=2]="Npcs",t[t.Items=3]="Items",t[t.Player=4]="Player",t[t.Shader=5]="Shader",t[t.Ui=6]="Ui",t[t.Ui2=7]="Ui2",t[t.Debug=8]="Debug",t[t.Overlay=9]="Overlay",t))(f||{});class g extends i.GameObjects.GameObject{constructor(t,i,n,r,o,s){super(t,"Light"),e(this,"x"),e(this,"y"),e(this,"light"),e(this,"debug"),t.add.existing(this),this.light=t.lights.addLight(i,n,r,o,s),this.debug=t.add.graphics({x:i,y:n}).setDepth(f.Debug),this.debug.lineStyle(3,65280),this.x=i,this.y=n,y.debug&&this.debug.strokeCircle(0,0,r)}setPosition(t,e){this.debug.setVisible(this.light.visible),this.light.setPosition(t,e),this.debug.setPosition(t,e),this.x=t,this.y=e}destroy(t){var e,i;super.destroy(t),this.debug.destroy(),null==(i=null==(e=this.scene)?void 0:e.lights)||i.removeLight(this.light)}}const m={White:"fcfee9",Tan:"e6c99d",Peach:"d07151",Brown:"473946",Teal:"303646",Black:"1c1831",Lights:"ffccaa",Night:"335588",Background:"111111"};function b(t){return i.Display.Color.HexStringToColor(t).color}function v(t){return b(i.Display.Color.RGBToString(255*t.r,255*t.g,255*t.b))}const w={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${m.White}`},x=1200;let S=!1;function k(t){return v(t.lights.ambientColor)===b(m.White)}function j(t,e=!0){S||(O(t,m.White,e),t.lights.lights.forEach((i=>{const n=i.intensity;e?t.tweens.add({targets:i,duration:x,intensity:0,onComplete:()=>{i.setVisible(!1),i.setIntensity(n)}}):i.setVisible(!1)})))}function O(t,e,n){if(!n)return void t.lights.setAmbientColor(b(e));S=!0;const r=v(t.lights.ambientColor),o=i.Display.Color.ValueToColor(r),s=i.Display.Color.ValueToColor(e);t.tweens.addCounter({from:0,to:100,duration:x,onUpdate:e=>{const n=i.Display.Color.Interpolate.ColorWithColor(o,s,100,e.getValue());var r;t.lights.setAmbientColor((r=n,b(i.Display.Color.RGBToString(r.r,r.g,r.b))))},onComplete:()=>{S=!1}})}var P,T,I=Object.prototype.toString,A=function(t){var e=I.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===I.call(t.callee)),i},E=Array.prototype.slice,C=A,M=Object.keys,L=M?function(t){return M(t)}:function(){if(T)return P;var t;if(T=1,!Object.keys){var e=Object.prototype.hasOwnProperty,i=Object.prototype.toString,n=A,r=Object.prototype.propertyIsEnumerable,o=!r.call({toString:null},"toString"),s=r.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(t){var e=t.constructor;return e&&e.prototype===t},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!l["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{h(window[t])}catch(i){return!0}}catch(i){return!0}return!1}();t=function(t){var r=null!==t&&"object"==typeof t,l="[object Function]"===i.call(t),p=n(t),u=r&&"[object String]"===i.call(t),y=[];if(!r&&!l&&!p)throw new TypeError("Object.keys called on a non-object");var d=s&&l;if(u&&t.length>0&&!e.call(t,0))for(var f=0;f<t.length;++f)y.push(String(f));if(p&&t.length>0)for(var g=0;g<t.length;++g)y.push(String(g));else for(var m in t)d&&"prototype"===m||!e.call(t,m)||y.push(String(m));if(o)for(var b=function(t){if("undefined"==typeof window||!c)return h(t);try{return h(t)}catch(e){return!1}}(t),v=0;v<a.length;++v)b&&"constructor"===a[v]||!e.call(t,a[v])||y.push(a[v]);return y}}return P=t}(),z=Object.keys;L.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return C(t)?z(E.call(t)):z(t)})}else Object.keys=L;return Object.keys||L};var F,B=L,D=Error,R=EvalError,W=RangeError,U=ReferenceError,G=SyntaxError,_=TypeError,N=URIError,$=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0},V="undefined"!=typeof Symbol&&Symbol,q=$,H=function(){return"function"==typeof V&&"function"==typeof Symbol&&"symbol"==typeof V("foo")&&"symbol"==typeof Symbol("bar")&&q()},K={__proto__:null,foo:{}},X=Object,Y=Object.prototype.toString,Q=Math.max,J=function(t,e){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var r=0;r<e.length;r+=1)i[r+t.length]=e[r];return i},Z=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||"[object Function]"!==Y.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var i,n=function(t,e){for(var i=[],n=1,r=0;n<t.length;n+=1,r+=1)i[r]=t[n];return i}(arguments),r=Q(0,e.length-n.length),o=[],s=0;s<r;s++)o[s]="$"+s;if(i=Function("binder","return function ("+function(t,e){for(var i="",n=0;n<t.length;n+=1)i+=t[n],n+1<t.length&&(i+=",");return i}(o)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var r=e.apply(this,J(n,arguments));return Object(r)===r?r:this}return e.apply(t,J(n,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,i.prototype=new a,a.prototype=null}return i},tt=Function.prototype.call,et=Object.prototype.hasOwnProperty,it=Z.call(tt,et),nt=D,rt=R,ot=W,st=U,at=G,ht=_,lt=N,ct=Function,pt=function(t){try{return ct('"use strict"; return ('+t+").constructor;")()}catch(e){}},ut=Object.getOwnPropertyDescriptor;if(ut)try{ut({},"")}catch(Yh){ut=null}var yt=function(){throw new ht},dt=ut?function(){try{return yt}catch(t){try{return ut(arguments,"callee").get}catch(e){return yt}}}():yt,ft=H(),gt={__proto__:K}.foo===K.foo&&!(K instanceof X),mt=Object.getPrototypeOf||(gt?function(t){return t.__proto__}:null),bt={},vt="undefined"!=typeof Uint8Array&&mt?mt(Uint8Array):F,wt={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?F:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?F:ArrayBuffer,"%ArrayIteratorPrototype%":ft&&mt?mt([][Symbol.iterator]()):F,"%AsyncFromSyncIteratorPrototype%":F,"%AsyncFunction%":bt,"%AsyncGenerator%":bt,"%AsyncGeneratorFunction%":bt,"%AsyncIteratorPrototype%":bt,"%Atomics%":"undefined"==typeof Atomics?F:Atomics,"%BigInt%":"undefined"==typeof BigInt?F:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?F:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?F:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?F:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":nt,"%eval%":eval,"%EvalError%":rt,"%Float32Array%":"undefined"==typeof Float32Array?F:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?F:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?F:FinalizationRegistry,"%Function%":ct,"%GeneratorFunction%":bt,"%Int8Array%":"undefined"==typeof Int8Array?F:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?F:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?F:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ft&&mt?mt(mt([][Symbol.iterator]())):F,"%JSON%":"object"==typeof JSON?JSON:F,"%Map%":"undefined"==typeof Map?F:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&ft&&mt?mt((new Map)[Symbol.iterator]()):F,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?F:Promise,"%Proxy%":"undefined"==typeof Proxy?F:Proxy,"%RangeError%":ot,"%ReferenceError%":st,"%Reflect%":"undefined"==typeof Reflect?F:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?F:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&ft&&mt?mt((new Set)[Symbol.iterator]()):F,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?F:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ft&&mt?mt(""[Symbol.iterator]()):F,"%Symbol%":ft?Symbol:F,"%SyntaxError%":at,"%ThrowTypeError%":dt,"%TypedArray%":vt,"%TypeError%":ht,"%Uint8Array%":"undefined"==typeof Uint8Array?F:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?F:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?F:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?F:Uint32Array,"%URIError%":lt,"%WeakMap%":"undefined"==typeof WeakMap?F:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?F:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?F:WeakSet};if(mt)try{null.error}catch(Yh){var xt=mt(mt(Yh));wt["%Error.prototype%"]=xt}var St=function t(e){var i;if("%AsyncFunction%"===e)i=pt("async function () {}");else if("%GeneratorFunction%"===e)i=pt("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=pt("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&mt&&(i=mt(r.prototype))}return wt[e]=i,i},kt={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},jt=Z,Ot=it,Pt=jt.call(Function.call,Array.prototype.concat),Tt=jt.call(Function.apply,Array.prototype.splice),It=jt.call(Function.call,String.prototype.replace),At=jt.call(Function.call,String.prototype.slice),Et=jt.call(Function.call,RegExp.prototype.exec),Ct=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Mt=/\\(\\)?/g,Lt=function(t,e){var i,n=t;if(Ot(kt,n)&&(n="%"+(i=kt[n])[0]+"%"),Ot(wt,n)){var r=wt[n];if(r===bt&&(r=St(n)),void 0===r&&!e)throw new ht("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new at("intrinsic "+t+" does not exist!")},zt=function(t,e){if("string"!=typeof t||0===t.length)throw new ht("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new ht('"allowMissing" argument must be a boolean');if(null===Et(/^%?[^%]*%?$/,t))throw new at("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=At(t,0,1),i=At(t,-1);if("%"===e&&"%"!==i)throw new at("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new at("invalid intrinsic syntax, expected opening `%`");var n=[];return It(t,Ct,(function(t,e,i,r){n[n.length]=i?It(r,Mt,"$1"):e||t})),n}(t),n=i.length>0?i[0]:"",r=Lt("%"+n+"%",e),o=r.name,s=r.value,a=!1,h=r.alias;h&&(n=h[0],Tt(i,Pt([0,1],h)));for(var l=1,c=!0;l<i.length;l+=1){var p=i[l],u=At(p,0,1),y=At(p,-1);if(('"'===u||"'"===u||"`"===u||'"'===y||"'"===y||"`"===y)&&u!==y)throw new at("property names with quotes must have matching quotes");if("constructor"!==p&&c||(a=!0),Ot(wt,o="%"+(n+="."+p)+"%"))s=wt[o];else if(null!=s){if(!(p in s)){if(!e)throw new ht("base intrinsic for "+t+" exists, but the property is not available.");return}if(ut&&l+1>=i.length){var d=ut(s,p);s=(c=!!d)&&"get"in d&&!("originalValue"in d.get)?d.get:s[p]}else c=Ot(s,p),s=s[p];c&&!a&&(wt[o]=s)}}return s},Ft=zt("%Object.defineProperty%",!0)||!1;if(Ft)try{Ft({},"a",{value:1})}catch(Yh){Ft=!1}var Bt=Ft,Dt=zt("%Object.getOwnPropertyDescriptor%",!0);if(Dt)try{Dt([],"length")}catch(Yh){Dt=null}var Rt=Dt,Wt=Bt,Ut=G,Gt=_,_t=Rt,Nt=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Gt("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new Gt("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Gt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Gt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Gt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Gt("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,r=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,s=arguments.length>6&&arguments[6],a=!!_t&&_t(t,e);if(Wt)Wt(t,e,{configurable:null===o&&a?a.configurable:!o,enumerable:null===n&&a?a.enumerable:!n,value:i,writable:null===r&&a?a.writable:!r});else{if(!s&&(n||r||o))throw new Ut("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}},$t=Bt,Vt=function(){return!!$t};Vt.hasArrayLengthDefineBug=function(){if(!$t)return null;try{return 1!==$t([],"length",{value:1}).length}catch(Yh){return!0}};var qt=Vt,Ht=B,Kt="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Xt=Object.prototype.toString,Yt=Array.prototype.concat,Qt=Nt,Jt=qt(),Zt=function(t,e,i,n){if(e in t)if(!0===n){if(t[e]===i)return}else if("function"!=typeof(r=n)||"[object Function]"!==Xt.call(r)||!n())return;var r;Jt?Qt(t,e,i,!0):Qt(t,e,i)},te=function(t,e){var i=arguments.length>2?arguments[2]:{},n=Ht(e);Kt&&(n=Yt.call(n,Object.getOwnPropertySymbols(e)));for(var r=0;r<n.length;r+=1)Zt(t,n[r],e[n[r]],i[n[r]])};te.supportsDescriptors=!!Jt;var ee=te,ie={exports:{}},ne=zt,re=Nt,oe=qt(),se=Rt,ae=_,he=ne("%Math.floor%"),le=function(t,e){if("function"!=typeof t)throw new ae("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||he(e)!==e)throw new ae("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,r=!0;if("length"in t&&se){var o=se(t,"length");o&&!o.configurable&&(n=!1),o&&!o.writable&&(r=!1)}return(n||r||!i)&&(oe?re(t,"length",e,!0,!0):re(t,"length",e)),t};!function(t){var e=Z,i=zt,n=le,r=_,o=i("%Function.prototype.apply%"),s=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||e.call(s,o),h=Bt,l=i("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new r("a function is required");var i=a(e,s,arguments);return n(i,1+l(0,t.length-(arguments.length-1)),!0)};var c=function(){return a(e,o,arguments)};h?h(t.exports,"apply",{value:c}):t.exports.apply=c}(ie);var ce=ie.exports,pe=zt,ue=ce,ye=ue(pe("String.prototype.indexOf")),de=function(t,e){var i=pe(t,!!e);return"function"==typeof i&&ye(t,".prototype.")>-1?ue(i):i},fe=B,ge=$(),me=de,be=Object,ve=me("Array.prototype.push"),we=me("Object.prototype.propertyIsEnumerable"),xe=ge?Object.getOwnPropertySymbols:null,Se=function(t,e){if(null==t)throw new TypeError("target must be an object");var i=be(t);if(1===arguments.length)return i;for(var n=1;n<arguments.length;++n){var r=be(arguments[n]),o=fe(r),s=ge&&(Object.getOwnPropertySymbols||xe);if(s)for(var a=s(r),h=0;h<a.length;++h){var l=a[h];we(r,l)&&ve(o,l)}for(var c=0;c<o.length;++c){var p=o[c];if(we(r,p)){var u=r[p];i[p]=u}}}return i},ke=Se,je=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},n=0;n<e.length;++n)i[e[n]]=e[n];var r=Object.assign({},i),o="";for(var s in r)o+=s;return t!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(Yh){return"y"===t[1]}return!1}()?ke:Object.assign:ke},Oe=ee,Pe=je,Te=ee,Ie=Se,Ae=je,Ee=ce.apply(Ae()),Ce=function(t,e){return Ee(Object,arguments)};Te(Ce,{getPolyfill:Ae,implementation:Ie,shim:function(){var t=Pe();return Oe(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var Me=Ce,Le=function(){return"string"==typeof function(){}.name},ze=Object.getOwnPropertyDescriptor;if(ze)try{ze([],"length")}catch(Yh){ze=null}Le.functionsHaveConfigurableNames=function(){if(!Le()||!ze)return!1;var t=ze((function(){}),"name");return!!t&&!!t.configurable};var Fe=Function.prototype.bind;Le.boundFunctionsHaveNames=function(){return Le()&&"function"==typeof Fe&&""!==function(){}.bind().name};var Be=Le,De=Nt,Re=qt(),We=Be.functionsHaveConfigurableNames(),Ue=_,Ge=_,_e=Object,Ne=function(t,e){if("function"!=typeof t)throw new Ue("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!We||(Re?De(t,"name",e,!0,!0):De(t,"name",e)),t}((function(){if(null==this||this!==_e(this))throw new Ge("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0),$e=Ne,Ve=ee.supportsDescriptors,qe=Object.getOwnPropertyDescriptor,He=function(){if(Ve&&"gim"===/a/gim.flags){var t=qe(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return $e},Ke=ee.supportsDescriptors,Xe=He,Ye=Object.getOwnPropertyDescriptor,Qe=Object.defineProperty,Je=TypeError,Ze=Object.getPrototypeOf,ti=/a/,ei=ee,ii=Ne,ni=He,ri=ce(ni());ei(ri,{getPolyfill:ni,implementation:ii,shim:function(){if(!Ke||!Ze)throw new Je("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Xe(),e=Ze(ti),i=Ye(e,"flags");return i&&i.get===t||Qe(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var oi=ri,si={exports:{}},ai=$,hi=function(){return ai()&&!!Symbol.toStringTag},li=hi(),ci=de("Object.prototype.toString"),pi=function(t){return!(li&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===ci(t)},ui=function(t){return!!pi(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==ci(t)&&"[object Function]"===ci(t.callee)},yi=function(){return pi(arguments)}();pi.isLegacyArguments=ui;var di=yi?pi:ui;const fi=n(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var gi="function"==typeof Map&&Map.prototype,mi=Object.getOwnPropertyDescriptor&&gi?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,bi=gi&&mi&&"function"==typeof mi.get?mi.get:null,vi=gi&&Map.prototype.forEach,wi="function"==typeof Set&&Set.prototype,xi=Object.getOwnPropertyDescriptor&&wi?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Si=wi&&xi&&"function"==typeof xi.get?xi.get:null,ki=wi&&Set.prototype.forEach,ji="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,Oi="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,Pi="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,Ti=Boolean.prototype.valueOf,Ii=Object.prototype.toString,Ai=Function.prototype.toString,Ei=String.prototype.match,Ci=String.prototype.slice,Mi=String.prototype.replace,Li=String.prototype.toUpperCase,zi=String.prototype.toLowerCase,Fi=RegExp.prototype.test,Bi=Array.prototype.concat,Di=Array.prototype.join,Ri=Array.prototype.slice,Wi=Math.floor,Ui="function"==typeof BigInt?BigInt.prototype.valueOf:null,Gi=Object.getOwnPropertySymbols,_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Ni="function"==typeof Symbol&&"object"==typeof Symbol.iterator,$i="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,Vi=Object.prototype.propertyIsEnumerable,qi=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Hi(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||Fi.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-Wi(-t):Wi(t);if(n!==t){var r=String(n),o=Ci.call(e,r.length+1);return Mi.call(r,i,"$&_")+"."+Mi.call(Mi.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Mi.call(e,i,"$&_")}var Ki=fi,Xi=Ki.custom,Yi=en(Xi)?Xi:null;function Qi(t,e,i){var n="double"===(i.quoteStyle||e)?'"':"'";return n+t+n}function Ji(t){return Mi.call(String(t),/"/g,"&quot;")}function Zi(t){return!("[object Array]"!==on(t)||$i&&"object"==typeof t&&$i in t)}function tn(t){return!("[object RegExp]"!==on(t)||$i&&"object"==typeof t&&$i in t)}function en(t){if(Ni)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!_i)return!1;try{return _i.call(t),!0}catch(Yh){}return!1}var nn=Object.prototype.hasOwnProperty||function(t){return t in this};function rn(t,e){return nn.call(t,e)}function on(t){return Ii.call(t)}function sn(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}function an(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,n="... "+i+" more character"+(i>1?"s":"");return an(Ci.call(t,0,e.maxStringLength),e)+n}return Qi(Mi.call(Mi.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,hn),"single",e)}function hn(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+Li.call(e.toString(16))}function ln(t){return"Object("+t+")"}function cn(t){return t+" { ? }"}function pn(t,e,i,n){return t+" ("+e+") {"+(n?un(i,n):Di.call(i,", "))+"}"}function un(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+Di.call(t,","+i)+"\n"+e.prev}function yn(t,e){var i=Zi(t),n=[];if(i){n.length=t.length;for(var r=0;r<t.length;r++)n[r]=rn(t,r)?e(t[r],t):""}var o,s="function"==typeof Gi?Gi(t):[];if(Ni){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var h in t)rn(t,h)&&(i&&String(Number(h))===h&&h<t.length||Ni&&o["$"+h]instanceof Symbol||(Fi.call(/[^\w$]/,h)?n.push(e(h,t)+": "+e(t[h],t)):n.push(h+": "+e(t[h],t))));if("function"==typeof Gi)for(var l=0;l<s.length;l++)Vi.call(t,s[l])&&n.push("["+e(s[l])+"]: "+e(t[s[l]],t));return n}var dn=zt,fn=de,gn=function t(e,i,n,o){var s=i||{};if(rn(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(rn(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!rn(s,"customInspect")||s.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(rn(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(rn(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=s.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return an(e,s);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var l=String(e);return h?Hi(e,l):l}if("bigint"==typeof e){var c=String(e)+"n";return h?Hi(e,c):c}var p=void 0===s.depth?5:s.depth;if(void 0===n&&(n=0),n>=p&&p>0&&"object"==typeof e)return Zi(e)?"[Array]":"[Object]";var u,y=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=Di.call(Array(t.indent+1)," ")}return{base:i,prev:Di.call(Array(e+1),i)}}(s,n);if(void 0===o)o=[];else if(sn(o,e)>=0)return"[Circular]";function d(e,i,r){if(i&&(o=Ri.call(o)).push(i),r){var a={depth:s.depth};return rn(s,"quoteStyle")&&(a.quoteStyle=s.quoteStyle),t(e,a,n+1,o)}return t(e,s,n+1,o)}if("function"==typeof e&&!tn(e)){var f=function(t){if(t.name)return t.name;var e=Ei.call(Ai.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),g=yn(e,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(g.length>0?" { "+Di.call(g,", ")+" }":"")}if(en(e)){var m=Ni?Mi.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):_i.call(e);return"object"!=typeof e||Ni?m:ln(m)}if((u=e)&&"object"==typeof u&&("undefined"!=typeof HTMLElement&&u instanceof HTMLElement||"string"==typeof u.nodeName&&"function"==typeof u.getAttribute)){for(var b="<"+zi.call(String(e.nodeName)),v=e.attributes||[],w=0;w<v.length;w++)b+=" "+v[w].name+"="+Qi(Ji(v[w].value),"double",s);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+"</"+zi.call(String(e.nodeName))+">"}if(Zi(e)){if(0===e.length)return"[]";var x=yn(e,d);return y&&!function(t){for(var e=0;e<t.length;e++)if(sn(t[e],"\n")>=0)return!1;return!0}(x)?"["+un(x,y)+"]":"[ "+Di.call(x,", ")+" ]"}if(function(t){return!("[object Error]"!==on(t)||$i&&"object"==typeof t&&$i in t)}(e)){var S=yn(e,d);return"cause"in Error.prototype||!("cause"in e)||Vi.call(e,"cause")?0===S.length?"["+String(e)+"]":"{ ["+String(e)+"] "+Di.call(S,", ")+" }":"{ ["+String(e)+"] "+Di.call(Bi.call("[cause]: "+d(e.cause),S),", ")+" }"}if("object"==typeof e&&a){if(Yi&&"function"==typeof e[Yi]&&Ki)return Ki(e,{depth:p-n});if("symbol"!==a&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!bi||!t||"object"!=typeof t)return!1;try{bi.call(t);try{Si.call(t)}catch(b){return!0}return t instanceof Map}catch(Yh){}return!1}(e)){var k=[];return vi&&vi.call(e,(function(t,i){k.push(d(i,e,!0)+" => "+d(t,e))})),pn("Map",bi.call(e),k,y)}if(function(t){if(!Si||!t||"object"!=typeof t)return!1;try{Si.call(t);try{bi.call(t)}catch(e){return!0}return t instanceof Set}catch(Yh){}return!1}(e)){var j=[];return ki&&ki.call(e,(function(t){j.push(d(t,e))})),pn("Set",Si.call(e),j,y)}if(function(t){if(!ji||!t||"object"!=typeof t)return!1;try{ji.call(t,ji);try{Oi.call(t,Oi)}catch(b){return!0}return t instanceof WeakMap}catch(Yh){}return!1}(e))return cn("WeakMap");if(function(t){if(!Oi||!t||"object"!=typeof t)return!1;try{Oi.call(t,Oi);try{ji.call(t,ji)}catch(b){return!0}return t instanceof WeakSet}catch(Yh){}return!1}(e))return cn("WeakSet");if(function(t){if(!Pi||!t||"object"!=typeof t)return!1;try{return Pi.call(t),!0}catch(Yh){}return!1}(e))return cn("WeakRef");if(function(t){return!("[object Number]"!==on(t)||$i&&"object"==typeof t&&$i in t)}(e))return ln(d(Number(e)));if(function(t){if(!t||"object"!=typeof t||!Ui)return!1;try{return Ui.call(t),!0}catch(Yh){}return!1}(e))return ln(d(Ui.call(e)));if(function(t){return!("[object Boolean]"!==on(t)||$i&&"object"==typeof t&&$i in t)}(e))return ln(Ti.call(e));if(function(t){return!("[object String]"!==on(t)||$i&&"object"==typeof t&&$i in t)}(e))return ln(d(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==r&&e===r)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==on(t)||$i&&"object"==typeof t&&$i in t)}(e)&&!tn(e)){var O=yn(e,d),P=qi?qi(e)===Object.prototype:e instanceof Object||e.constructor===Object,T=e instanceof Object?"":"null prototype",I=!P&&$i&&Object(e)===e&&$i in e?Ci.call(on(e),8,-1):T?"Object":"",A=(P||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(I||T?"["+Di.call(Bi.call([],I||[],T||[]),": ")+"] ":"");return 0===O.length?A+"{}":y?A+"{"+un(O,y)+"}":A+"{ "+Di.call(O,", ")+" }"}return String(e)},mn=_,bn=dn("%WeakMap%",!0),vn=dn("%Map%",!0),wn=fn("WeakMap.prototype.get",!0),xn=fn("WeakMap.prototype.set",!0),Sn=fn("WeakMap.prototype.has",!0),kn=fn("Map.prototype.get",!0),jn=fn("Map.prototype.set",!0),On=fn("Map.prototype.has",!0),Pn=function(t,e){for(var i,n=t;null!==(i=n.next);n=i)if(i.key===e)return n.next=i.next,i.next=t.next,t.next=i,i},Tn=function(){var t,e,i,n={assert:function(t){if(!n.has(t))throw new mn("Side channel does not contain "+gn(t))},get:function(n){if(bn&&n&&("object"==typeof n||"function"==typeof n)){if(t)return wn(t,n)}else if(vn){if(e)return kn(e,n)}else if(i)return function(t,e){var i=Pn(t,e);return i&&i.value}(i,n)},has:function(n){if(bn&&n&&("object"==typeof n||"function"==typeof n)){if(t)return Sn(t,n)}else if(vn){if(e)return On(e,n)}else if(i)return function(t,e){return!!Pn(t,e)}(i,n);return!1},set:function(n,r){bn&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new bn),xn(t,n,r)):vn?(e||(e=new vn),jn(e,n,r)):(i||(i={key:{},next:null}),function(t,e,i){var n=Pn(t,e);n?n.value=i:t.next={key:e,next:t.next,value:i}}(i,n,r))}};return n},In=it,An=Tn(),En=_,Cn={assert:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");if(An.assert(t),!Cn.has(t,e))throw new En("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");var i=An.get(t);return i&&i["$"+e]},has:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");var i=An.get(t);return!!i&&In(i,"$"+e)},set:function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");var n=An.get(t);n||(n={},An.set(t,n)),n["$"+e]=i}};Object.freeze&&Object.freeze(Cn);var Mn,Ln=Cn,zn=SyntaxError,Fn="object"==typeof StopIteration?StopIteration:null,Bn={}.toString,Dn=Array.isArray||function(t){return"[object Array]"==Bn.call(t)},Rn=String.prototype.valueOf,Wn=Object.prototype.toString,Un=hi(),Gn=function(t){return"string"==typeof t||"object"==typeof t&&(Un?function(t){try{return Rn.call(t),!0}catch(Yh){return!1}}(t):"[object String]"===Wn.call(t))},_n="function"==typeof Map&&Map.prototype?Map:null,Nn="function"==typeof Set&&Set.prototype?Set:null;_n||(Mn=function(t){return!1});var $n=_n?Map.prototype.has:null,Vn=Nn?Set.prototype.has:null;Mn||$n||(Mn=function(t){return!1});var qn,Hn=Mn||function(t){if(!t||"object"!=typeof t)return!1;try{if($n.call(t),Vn)try{Vn.call(t)}catch(Yh){return!0}return t instanceof _n}catch(Yh){}return!1},Kn="function"==typeof Map&&Map.prototype?Map:null,Xn="function"==typeof Set&&Set.prototype?Set:null;Xn||(qn=function(t){return!1});var Yn=Kn?Map.prototype.has:null,Qn=Xn?Set.prototype.has:null;qn||Qn||(qn=function(t){return!1});var Jn=qn||function(t){if(!t||"object"!=typeof t)return!1;try{if(Qn.call(t),Yn)try{Yn.call(t)}catch(Yh){return!0}return t instanceof Xn}catch(Yh){}return!1},Zn=di,tr=function(t){if(!Fn)throw new zn("this environment lacks StopIteration");Ln.set(t,"[[Done]]",!1);var e={next:function(){var t=Ln.get(this,"[[Iterator]]"),e=Ln.get(t,"[[Done]]");try{return{done:e,value:e?void 0:t.next()}}catch(Yh){if(Ln.set(t,"[[Done]]",!0),Yh!==Fn)throw Yh;return{done:!0,value:void 0}}}};return Ln.set(e,"[[Iterator]]",t),e};if(H()||$()){var er=Symbol.iterator;si.exports=function(t){return null!=t&&void 0!==t[er]?t[er]():Zn(t)?Array.prototype[er].call(t):void 0}}else{var ir=Dn,nr=Gn,rr=zt,or=rr("%Map%",!0),sr=rr("%Set%",!0),ar=de,hr=ar("Array.prototype.push"),lr=ar("String.prototype.charCodeAt"),cr=ar("String.prototype.slice"),pr=function(t){var e=0;return{next:function(){var i,n=e>=t.length;return n||(i=t[e],e+=1),{done:n,value:i}}}},ur=function(t,e){if(ir(t)||Zn(t))return pr(t);if(nr(t)){var i=0;return{next:function(){var e=function(t,e){if(e+1>=t.length)return e+1;var i=lr(t,e);if(i<55296||i>56319)return e+1;var n=lr(t,e+1);return n<56320||n>57343?e+1:e+2}(t,i),n=cr(t,i,e);return i=e,{done:e>t.length,value:n}}}}return e&&void 0!==t["_es6-shim iterator_"]?t["_es6-shim iterator_"]():void 0};if(or||sr){var yr=Hn,dr=Jn,fr=ar("Map.prototype.forEach",!0),gr=ar("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var mr=ar("Map.prototype.iterator",!0),br=ar("Set.prototype.iterator",!0);var vr=ar("Map.prototype.@@iterator",!0)||ar("Map.prototype._es6-shim iterator_",!0),wr=ar("Set.prototype.@@iterator",!0)||ar("Set.prototype._es6-shim iterator_",!0);si.exports=function(t){return function(t){if(yr(t)){if(mr)return tr(mr(t));if(vr)return vr(t);if(fr){var e=[];return fr(t,(function(t,i){hr(e,[i,t])})),pr(e)}}if(dr(t)){if(br)return tr(br(t));if(wr)return wr(t);if(gr){var i=[];return gr(t,(function(t){hr(i,t)})),pr(i)}}}(t)||ur(t)}}else si.exports=function(t){if(null!=t)return ur(t,!0)}}var xr=si.exports,Sr=function(t){return t!=t},kr=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!Sr(t)||!Sr(e))},jr=kr,Or=function(){return"function"==typeof Object.is?Object.is:jr},Pr=Or,Tr=ee,Ir=ee,Ar=kr,Er=Or,Cr=ce(Er(),Object);Ir(Cr,{getPolyfill:Er,implementation:Ar,shim:function(){var t=Pr();return Tr(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var Mr,Lr,zr,Fr,Br=Cr,Dr=ce,Rr=de,Wr=zt("%ArrayBuffer%",!0),Ur=Rr("ArrayBuffer.prototype.byteLength",!0),Gr=Rr("Object.prototype.toString"),_r=!!Wr&&!Ur&&new Wr(0).slice,Nr=!!_r&&Dr(_r),$r=Ur||Nr?function(t){if(!t||"object"!=typeof t)return!1;try{return Ur?Ur(t):Nr(t,0),!0}catch(Yh){return!1}}:Wr?function(t){return"[object ArrayBuffer]"===Gr(t)}:function(t){return!1},Vr=Date.prototype.getDay,qr=Object.prototype.toString,Hr=hi(),Kr=de,Xr=hi();if(Xr){Mr=Kr("Object.prototype.hasOwnProperty"),Lr=Kr("RegExp.prototype.exec"),zr={};var Yr=function(){throw zr};Fr={toString:Yr,valueOf:Yr},"symbol"==typeof Symbol.toPrimitive&&(Fr[Symbol.toPrimitive]=Yr)}var Qr=Kr("Object.prototype.toString"),Jr=Object.getOwnPropertyDescriptor,Zr=Xr?function(t){if(!t||"object"!=typeof t)return!1;var e=Jr(t,"lastIndex");if(!e||!Mr(e,"value"))return!1;try{Lr(t,Fr)}catch(Yh){return Yh===zr}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===Qr(t)},to=de("SharedArrayBuffer.prototype.byteLength",!0),eo=to?function(t){if(!t||"object"!=typeof t)return!1;try{return to(t),!0}catch(Yh){return!1}}:function(t){return!1},io=Number.prototype.toString,no=Object.prototype.toString,ro=hi(),oo=de,so=oo("Boolean.prototype.toString"),ao=oo("Object.prototype.toString"),ho=hi(),lo={exports:{}},co=Object.prototype.toString;if(H()){var po=Symbol.prototype.toString,uo=/^Symbol\(.*\)$/;lo.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==co.call(t))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&uo.test(po.call(t))}(t)}catch(Yh){return!1}}}else lo.exports=function(t){return!1};var yo=lo.exports,fo={exports:{}},go="undefined"!=typeof BigInt&&BigInt;if("function"==typeof go&&"function"==typeof BigInt&&"bigint"==typeof go(42)&&"bigint"==typeof BigInt(42)){var mo=BigInt.prototype.valueOf;fo.exports=function(t){return null!=t&&"boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t&&"symbol"!=typeof t&&"function"!=typeof t&&("bigint"==typeof t||function(t){try{return mo.call(t),!0}catch(Yh){}return!1}(t))}}else fo.exports=function(t){return!1};var bo,vo=fo.exports,wo=Gn,xo=yo,So=vo,ko="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,jo="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;ko||(bo=function(t){return!1});var Oo=ko?ko.prototype.has:null,Po=jo?jo.prototype.has:null;bo||Oo||(bo=function(t){return!1});var To=bo||function(t){if(!t||"object"!=typeof t)return!1;try{if(Oo.call(t,Oo),Po)try{Po.call(t,Po)}catch(Yh){return!0}return t instanceof ko}catch(Yh){}return!1},Io={exports:{}},Ao=de,Eo=zt("%WeakSet%",!0),Co=Ao("WeakSet.prototype.has",!0);if(Co){var Mo=Ao("WeakMap.prototype.has",!0);Io.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(Co(t,Co),Mo)try{Mo(t,Mo)}catch(Yh){return!0}return t instanceof Eo}catch(Yh){}return!1}}else Io.exports=function(t){return!1};var Lo,zo,Fo=Io.exports,Bo=Hn,Do=Jn,Ro=To,Wo=Fo,Uo=Function.prototype.toString,Go="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof Go&&"function"==typeof Object.defineProperty)try{Lo=Object.defineProperty({},"length",{get:function(){throw zo}}),zo={},Go((function(){throw 42}),null,Lo)}catch(Qh){Qh!==zo&&(Go=null)}else Go=null;var _o=/^\s*class\b/,No=function(t){try{var e=Uo.call(t);return _o.test(e)}catch(Yh){return!1}},$o=function(t){try{return!No(t)&&(Uo.call(t),!0)}catch(Yh){return!1}},Vo=Object.prototype.toString,qo="function"==typeof Symbol&&!!Symbol.toStringTag,Ho=!(0 in[,]),Ko=function(){return!1};if("object"==typeof document){var Xo=document.all;Vo.call(Xo)===Vo.call(document.all)&&(Ko=function(t){if((Ho||!t)&&(void 0===t||"object"==typeof t))try{var e=Vo.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(Yh){}return!1})}var Yo=Go?function(t){if(Ko(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{Go(t,null,Lo)}catch(Yh){if(Yh!==zo)return!1}return!No(t)&&$o(t)}:function(t){if(Ko(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(qo)return $o(t);if(No(t))return!1;var e=Vo.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&$o(t)},Qo=Object.prototype.toString,Jo=Object.prototype.hasOwnProperty,Zo=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],ts="undefined"==typeof globalThis?r:globalThis,es=function(t,e,i){if(!Yo(e))throw new TypeError("iterator must be a function");var n;arguments.length>=3&&(n=i),"[object Array]"===Qo.call(t)?function(t,e,i){for(var n=0,r=t.length;n<r;n++)Jo.call(t,n)&&(null==i?e(t[n],n,t):e.call(i,t[n],n,t))}(t,e,n):"string"==typeof t?function(t,e,i){for(var n=0,r=t.length;n<r;n++)null==i?e(t.charAt(n),n,t):e.call(i,t.charAt(n),n,t)}(t,e,n):function(t,e,i){for(var n in t)Jo.call(t,n)&&(null==i?e(t[n],n,t):e.call(i,t[n],n,t))}(t,e,n)},is=ce,ns=de,rs=Rt,os=ns("Object.prototype.toString"),ss=hi(),as="undefined"==typeof globalThis?r:globalThis,hs=function(){for(var t=[],e=0;e<Zo.length;e++)"function"==typeof ts[Zo[e]]&&(t[t.length]=Zo[e]);return t}(),ls=ns("String.prototype.slice"),cs=Object.getPrototypeOf,ps=ns("Array.prototype.indexOf",!0)||function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return i;return-1},us={__proto__:null};es(hs,ss&&rs&&cs?function(t){var e=new as[t];if(Symbol.toStringTag in e){var i=cs(e),n=rs(i,Symbol.toStringTag);if(!n){var r=cs(i);n=rs(r,Symbol.toStringTag)}us["$"+t]=is(n.get)}}:function(t){var e=new as[t],i=e.slice||e.set;i&&(us["$"+t]=is(i))});var ys=de("ArrayBuffer.prototype.byteLength",!0),ds=$r,fs=Me,gs=de,ms=oi,bs=zt,vs=xr,ws=Tn,xs=Br,Ss=di,ks=Dn,js=$r,Os=function(t){return"object"==typeof t&&null!==t&&(Hr?function(t){try{return Vr.call(t),!0}catch(Yh){return!1}}(t):"[object Date]"===qr.call(t))},Ps=Zr,Ts=eo,Is=B,As=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t?null:wo(t)?"String":function(t){return"number"==typeof t||"object"==typeof t&&(ro?function(t){try{return io.call(t),!0}catch(Yh){return!1}}(t):"[object Number]"===no.call(t))}(t)?"Number":function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(ho&&Symbol.toStringTag in t?function(t){try{return so(t),!0}catch(Yh){return!1}}(t):"[object Boolean]"===ao(t))}(t)?"Boolean":xo(t)?"Symbol":So(t)?"BigInt":void 0},Es=function(t){if(t&&"object"==typeof t){if(Bo(t))return"Map";if(Do(t))return"Set";if(Ro(t))return"WeakMap";if(Wo(t))return"WeakSet"}return!1},Cs=function(t){if(!t||"object"!=typeof t)return!1;if(!ss){var e=ls(os(t),8,-1);return ps(hs,e)>-1?e:"Object"===e&&function(t){var e=!1;return es(us,(function(i,n){if(!e)try{i(t),e=ls(n,1)}catch(Yh){}})),e}(t)}return rs?function(t){var e=!1;return es(us,(function(i,n){if(!e)try{"$"+i(t)===n&&(e=ls(n,1))}catch(Yh){}})),e}(t):null},Ms=function(t){return ds(t)?ys?ys(t):t.byteLength:NaN},Ls=gs("SharedArrayBuffer.prototype.byteLength",!0),zs=gs("Date.prototype.getTime"),Fs=Object.getPrototypeOf,Bs=gs("Object.prototype.toString"),Ds=bs("%Set%",!0),Rs=gs("Map.prototype.has",!0),Ws=gs("Map.prototype.get",!0),Us=gs("Map.prototype.size",!0),Gs=gs("Set.prototype.add",!0),_s=gs("Set.prototype.delete",!0),Ns=gs("Set.prototype.has",!0),$s=gs("Set.prototype.size",!0);function Vs(t,e,i,n){for(var r,o=vs(t);(r=o.next())&&!r.done;)if(Ys(e,r.value,i,n))return _s(t,r.value),!0;return!1}function qs(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function Hs(t,e,i,n,r,o){var s=qs(i);if(null!=s)return s;var a=Ws(e,s),h=fs({},r,{strict:!1});return!(void 0===a&&!Rs(e,s)||!Ys(n,a,h,o))&&!Rs(t,s)&&Ys(n,a,h,o)}function Ks(t,e,i){var n=qs(i);return null!=n?n:Ns(e,n)&&!Ns(t,n)}function Xs(t,e,i,n,r,o){for(var s,a,h=vs(t);(s=h.next())&&!s.done;)if(Ys(i,a=s.value,r,o)&&Ys(n,Ws(e,a),r,o))return _s(t,a),!0;return!1}function Ys(t,e,i,n){var r=i||{};if(r.strict?xs(t,e):t===e)return!0;if(As(t)!==As(e))return!1;if(!t||!e||"object"!=typeof t&&"object"!=typeof e)return r.strict?xs(t,e):t==e;var o,s=n.has(t),a=n.has(e);if(s&&a){if(n.get(t)===n.get(e))return!0}else o={};return s||n.set(t,o),a||n.set(e,o),function(t,e,i,n){var r,o;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Bs(t)!==Bs(e))return!1;if(Ss(t)!==Ss(e))return!1;if(ks(t)!==ks(e))return!1;var s=t instanceof Error,a=e instanceof Error;if(s!==a)return!1;if((s||a)&&(t.name!==e.name||t.message!==e.message))return!1;var h=Ps(t),l=Ps(e);if(h!==l)return!1;if((h||l)&&(t.source!==e.source||ms(t)!==ms(e)))return!1;var c=Os(t),p=Os(e);if(c!==p)return!1;if((c||p)&&zs(t)!==zs(e))return!1;if(i.strict&&Fs&&Fs(t)!==Fs(e))return!1;var u=Cs(t),y=Cs(e);if(u!==y)return!1;if(u||y){if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var d=Qs(t),f=Qs(e);if(d!==f)return!1;if(d||f){if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var g=js(t),m=js(e);if(g!==m)return!1;if(g||m)return Ms(t)===Ms(e)&&"function"==typeof Uint8Array&&Ys(new Uint8Array(t),new Uint8Array(e),i,n);var b=Ts(t),v=Ts(e);if(b!==v)return!1;if(b||v)return Ls(t)===Ls(e)&&"function"==typeof Uint8Array&&Ys(new Uint8Array(t),new Uint8Array(e),i,n);if(typeof t!=typeof e)return!1;var w=Is(t),x=Is(e);if(w.length!==x.length)return!1;for(w.sort(),x.sort(),r=w.length-1;r>=0;r--)if(w[r]!=x[r])return!1;for(r=w.length-1;r>=0;r--)if(!Ys(t[o=w[r]],e[o],i,n))return!1;var S=Es(t),k=Es(e);return S===k&&("Set"===S||"Set"===k?function(t,e,i,n){if($s(t)!==$s(e))return!1;for(var r,o,s,a=vs(t),h=vs(e);(r=a.next())&&!r.done;)if(r.value&&"object"==typeof r.value)s||(s=new Ds),Gs(s,r.value);else if(!Ns(e,r.value)){if(i.strict)return!1;if(!Ks(t,e,r.value))return!1;s||(s=new Ds),Gs(s,r.value)}if(s){for(;(o=h.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!Vs(s,o.value,i.strict,n))return!1}else if(!i.strict&&!Ns(t,o.value)&&!Vs(s,o.value,i.strict,n))return!1;return 0===$s(s)}return!0}(t,e,i,n):"Map"!==S||function(t,e,i,n){if(Us(t)!==Us(e))return!1;for(var r,o,s,a,h,l,c=vs(t),p=vs(e);(r=c.next())&&!r.done;)if(a=r.value[0],h=r.value[1],a&&"object"==typeof a)s||(s=new Ds),Gs(s,a);else if(void 0===(l=Ws(e,a))&&!Rs(e,a)||!Ys(h,l,i,n)){if(i.strict)return!1;if(!Hs(t,e,a,h,i,n))return!1;s||(s=new Ds),Gs(s,a)}if(s){for(;(o=p.next())&&!o.done;)if(a=o.value[0],l=o.value[1],a&&"object"==typeof a){if(!Xs(s,t,a,l,i,n))return!1}else if(!(i.strict||t.has(a)&&Ys(Ws(t,a),l,i,n)||Xs(s,t,a,l,fs({},i,{strict:!1}),n)))return!1;return 0===$s(s)}return!0}(t,e,i,n))}(t,e,r,n)}function Qs(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0]||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))}const Js=o((function(t,e,i){return Ys(t,e,i,ws())}));var Zs=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t[t.Prop=4]="Prop",t))(Zs||{}),ta=(t=>(t[t.Underground=0]="Underground",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.LakeEast=6]="LakeEast",t[t.TownNorth=7]="TownNorth",t[t.ClockSquare=8]="ClockSquare",t[t.ClockSquareNorth=9]="ClockSquareNorth",t[t.ClockEntrance=10]="ClockEntrance",t[t.ClockStairs=11]="ClockStairs",t[t.ClockTop=12]="ClockTop",t[t.TownWest=13]="TownWest",t[t.MansionOutside=14]="MansionOutside",t[t.MansionEntrance=15]="MansionEntrance",t[t.MansionExit=16]="MansionExit",t[t.LabEntrance=17]="LabEntrance",t[t.LabExit=18]="LabExit",t))(ta||{}),ea=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t[t.Key=2]="Key",t))(ea||{}),ia=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t[t.ExploreLab=2]="ExploreLab",t))(ia||{}),na=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.ClockTower=4]="ClockTower",t))(na||{}),ra=(t=>(t[t.Sphinx=0]="Sphinx",t))(ra||{}),oa=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.ForestMazeSolved=1]="ForestMazeSolved",t[t.SphinxRiddleSolved=2]="SphinxRiddleSolved",t[t.MetTheMayor=3]="MetTheMayor",t[t.ClockFirstGear=4]="ClockFirstGear",t[t.AlchemyLabFound=5]="AlchemyLabFound",t))(oa||{}),sa=(t=>(t[t.LabHatch=0]="LabHatch",t[t.LabBook=1]="LabBook",t[t.AlchemySet=2]="AlchemySet",t))(sa||{});y.dayMinutes,i.GameObjects.Container;class aa extends i.GameObjects.Text{constructor(t){super(t,y.width/2,y.height-50,"",w),this.setOrigin(.5).setBackgroundColor("#"+m.Black).setPadding(10,5).setAlign("center").setAlpha(.9).setScrollFactor(0).setDepth(f.Overlay).setVisible(!1),t.add.existing(this)}}var ha=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t))(ha||{});class la{constructor(t){e(this,"scene"),e(this,"keys",{0:!1,1:!1,2:!1,3:!1,4:!1,5:!1}),this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W"),this.listener(2,"A"),this.listener(1,"S"),this.listener(3,"D"),this.listener(4,"SPACE"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE")}listener(t,e){var i,n;null==(i=this.scene.input.keyboard)||i.on(`keydown-${e}`,(()=>this.keys[t]=!0)),null==(n=this.scene.input.keyboard)||n.on(`keyup-${e}`,(()=>this.keys[t]=!1))}resetKeys(){this.keys[0]=!1,this.keys[1]=!1,this.keys[2]=!1,this.keys[3]=!1,this.keys[4]=!1,this.keys[5]=!1}}const ca=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[na.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[na.Stranger]:["The sphinx’s riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[na.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[na.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[na.Inventor]:["The sphinx’s riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[na.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, don’t they?","They move, disappear, and seem to fly without wings."]}}];function pa(t){return t instanceof jh?_a(t)%ca.length:0}function ua(t,e){const i=pa(t);return ca[i].hints[e]}const ya={[na.Inventor]:[{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:ea.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(ia.ForestGear,!0)}},{messages:t=>ua(t.scene,na.Inventor),conditions:{activeQuest:ia.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:ea.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench, but you’ll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(oa.FixTheClock),t.inventory.addItem({type:ea.Wrench,used:!1})}}],[na.Stranger]:[{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:ea.Gear1}},{messages:t=>ua(t.scene,na.Stranger),conditions:{activeQuest:ia.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:ea.Wrench},onCompleted:t=>{t.quests.addQuest({id:ia.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[na.Sphinx]:[{messages:t=>function(t){const e=pa(t);return[ca[e].question]}(t.scene),options:t=>function(t){const e=pa(t),i=[...ca[e].options].sort((()=>Math.random()-.5));return i.push("I don’t know"),i}(t.scene),conditions:{activeQuest:ia.SphinxRiddle},onSelected:(t,e,i)=>{t===function(t){const e=pa(t);return ca[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(ia.SphinxRiddle,!0),t.journal.addEntry(oa.SphinxRiddleSolved)}},i):"I don’t know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},i):e.message.setDialog({messages:["That is not correct. Do not return."]},i)}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:ia.SphinxRiddle,completed:!1})}}],[na.Mayor]:[{messages:["The minute hand on the clock is spinning again.","It looks like it’s missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:oa.ClockFirstGear}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:oa.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(oa.MetTheMayor)}}],[na.ClockTower]:[{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:oa.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Let’s see what happens when we add the first gear.","[CREAKING NOISE]","The clock tower is starting to partially move again. It looks like it’s missing two more gears."],conditions:{hasItem:ea.Gear1},onCompleted:t=>{t.inventory.removeItem(ea.Gear1),t.journal.addEntry(oa.ClockFirstGear)}}]},da={[ea.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}]},fa={[sa.LabHatch]:[{messages:["Let me see if I can open this hatch."],conditions:{hasItem:ea.Key},onCompleted:(t,e)=>{null==e||e.destroy(),console.log(e),t.inventory.removeItem(ea.Key),t.journal.addEntry(oa.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[sa.LabBook]:[{messages:["This book contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:t=>{t.quests.addQuest({id:ia.ExploreLab,completed:!1})}}]};function ga(t,e){for(const i of t){const{conditions:t}=i,n=[];if(void 0!==(null==t?void 0:t.hasItem)&&n.push(Fa(e.inventory.inventory,t.hasItem)),void 0!==(null==t?void 0:t.completedQuest)&&n.push(Da(e.quests.quests,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&n.push(Ba(e.quests.quests,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&n.push(Ra(e.journal.journal,t.journalEntry)),null==t?void 0:t.invert){if(null==t?void 0:t.or){if(n.some((t=>!t)))return i}else if(n.every((t=>!t)))return i;return}if(null==t?void 0:t.or){if(n.some((t=>t)))return i}else if(n.every((t=>t)))return i}}const ma={[ea.Wrench]:{x:150,y:650,image:"wrench",name:"Wrench"},[ea.Gear1]:{x:5120,y:915,image:"gear",name:"Gear"},[ea.Key]:{x:-1575,y:630,image:"key",name:"Key"}};function ba(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t)))}const va=function(t){const e=i.Display.Color.ColorToRGBA(t);return new i.Display.Color(e.r,e.g,e.b,e.a)}(b(m.Background));function wa(t,e,i){t.cameras.main.fadeIn(e,va.red,va.green,va.blue,((t,e)=>{}))}function xa(t,e,n){return i.Math.Distance.BetweenPointsSquared(t,e)<(n||1e3)**2}class Sa extends i.Physics.Arcade.Image{constructor(t,i,n){const{x:r,y:o,image:s}=ma[i];super(t,r,o,s),e(this,"itemType"),e(this,"player"),e(this,"particles"),e(this,"light"),e(this,"initialized",!1),this.itemType=i,this.player=n}lazyInit(t){if(!t&&(this.initialized||!xa(this,this.player)))return;if(this.player.inventory.inventory.find((t=>t.type===this.itemType)))return void this.destroy();const{x:e,y:i}=ma[this.itemType];this.scene.add.existing(this),this.scene.physics.add.existing(this),y.debug&&this.setInteractive({draggable:!0}),this.setScale(.35).setDepth(f.Items).setPipeline("Light2D"),this.particles=this.scene.add.particles(e,i,"warp",{scale:{start:0,end:.9},alpha:{start:.8,end:0},delay:500,lifespan:1500,maxAliveParticles:1}),y.debug?this.light=new g(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2),this.initialized=!0,console.log("creating item",ea[this.itemType])}onInteract(t){if(t[ha.Continue]){this.player.inventory.addItem({type:this.itemType,used:!1}),this.destroy();const t=ga(da[this.itemType]||[],this.player);return t&&this.player.message.setDialog(t,this,"player_portrait"),Zs.Item}return Zs.None}destroy(t){var e,i,n;null==(e=this.particles)||e.destroy(),this.light instanceof g?this.light.destroy():null==(n=null==(i=this.scene)?void 0:i.lights)||n.removeLight(this.light),super.destroy(t)}getButtonPrompt(){return[`Pick Up ${ea[this.itemType]}`,"Press [CONTINUE]"]}update(){this.lazyInit()}}const ka=2*Math.PI;class ja extends i.GameObjects.Graphics{constructor(t){super(t),e(this,"angle1",0),e(this,"angle2",1),e(this,"angle3",4),e(this,"update1",!1),e(this,"update2",!1),e(this,"update3",!1),t.add.existing(this),this.setPosition(842,-2107),this.setDepth(f.Npcs)}update(t){this.update1&&(this.angle1=ka*(t/6e4)*20),this.update2&&(this.angle2=ka*(t/36e5)*20),this.update3&&(this.angle3=ka*(t/432e5)*20),this.clear(),this.lineStyle(6,b(m.Night)),this.lineBetween(0,0,50*Math.cos(this.angle1),50*Math.sin(this.angle1)),this.lineBetween(0,0,40*Math.cos(this.angle2),40*Math.sin(this.angle2)),this.lineBetween(0,0,25*Math.cos(this.angle3),25*Math.sin(this.angle3)),this.lineStyle(4,b(m.Black));for(let e=0;e<12;e++){const t=ka*(e/12),i=50*Math.cos(t),n=50*Math.sin(t);this.lineBetween(i,n,1.5*i,1.5*n)}}}class Oa extends i.Physics.Arcade.Image{constructor(t,n,r){const{x:o,y:s,img:a,scale:h,initOnStart:l}=Na[n];super(t,o,s,a),e(this,"npcType"),e(this,"player"),e(this,"light"),e(this,"particles"),e(this,"lastPos",new i.Math.Vector2),e(this,"clock"),e(this,"initialized",!1),this.setScale(h).setDepth(f.Npcs).setPipeline("Light2D"),this.npcType=n,this.player=r,"warp"===a&&this.setAlpha(0),l&&this.lazyInit(!0)}lazyInit(t){if(!t&&(this.initialized||!xa(this,this.player)))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),y.debug&&this.setInteractive({draggable:!0});const{x:e,y:i,light:n,particles:r,onCreate:o}=Na[this.npcType];y.debug?this.light=new g(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,n||1):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,n||1),r&&(this.particles=this.scene.add.particles(e,i,"",r)),this.npcType===na.ClockTower&&(this.clock=new ja(this.scene)),o&&o(this),this.initialized=!0}update(t,e){this.lazyInit(),!this.light||this.x===this.lastPos.x&&this.y===this.lastPos.y||this.light.setPosition(this.x,this.y),this.lastPos.set(this.x,this.y),this.clock&&this.clock.update(t)}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Zs.None;if(t[ha.Continue]){const t=ga(ya[this.npcType],this.player);if(t){const e=Na[this.npcType].portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),Zs.Talked}}return Zs.None}getButtonPrompt(){return this.npcType===na.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${Na[this.npcType].name}`,"Press [CONTINUE]"]}}const Pa={[oa.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[oa.ForestMazeSolved]:{description:"I finally got through the forest maze. Next time should be much easier."},[oa.SphinxRiddleSolved]:{description:"I solved the sphinx’s riddle. Now I can pass through the forest.",warpAdd:ta.ForestEast},[oa.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:ta.ClockSquareNorth},[oa.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[oa.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:ta.LabEntrance}},Ta={[ia.ForestGear]:{description:"Find the gear in the forest",warpAdd:ta.TownEast,warpComplete:ta.TownNorth},[ia.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[ia.ExploreLab]:{description:"Explore the hidden alchemy lab"}};var Ia=(t=>(t[t.Ladder=0]="Ladder",t[t.Warp=1]="Warp",t[t.WarpHidden=2]="WarpHidden",t[t.Invisible=3]="Invisible",t))(Ia||{});const Aa={[ta.Town]:{x:300,y:650,key:ha.Down,warpTo:ta.Underground,visual:0},[ta.Underground]:{x:301,y:875,key:ha.Up,warpTo:ta.Town,visual:0},[ta.TownEast]:{x:1720,y:650,key:ha.Right,warpTo:ta.Forest,visual:2},[ta.Forest]:{x:2650,y:815,key:ha.Left,warpTo:ta.TownEast,visual:1},[ta.TownNorth]:{x:775,y:650,key:ha.Up,warpTo:ta.ClockSquare,visual:2},[ta.ClockSquare]:{x:610,y:-330,key:ha.Left,warpTo:ta.TownNorth,visual:1},[ta.ClockSquareNorth]:{x:915,y:-330,key:ha.Up,warpTo:ta.ClockEntrance,visual:2},[ta.ClockEntrance]:{x:690,y:-1320,range:15,key:ha.Left,warpTo:ta.ClockSquareNorth,visual:1,skipLighting:!0},[ta.ClockStairs]:{x:910,y:-1400,range:20,key:ha.Right,warpTo:ta.ClockTop,visual:3},[ta.ClockTop]:{x:780,y:-1970,range:10,key:ha.Left,warpTo:ta.ClockStairs,visual:3},[ta.ForestEast]:{x:3590,y:815,key:ha.Right,warpTo:ta.Lake,visual:2},[ta.Lake]:{x:4625,y:915,key:ha.Left,warpTo:ta.ForestEast,visual:1},[ta.LakeEast]:{x:6121,y:760,key:ha.Right,warpTo:ta.Lake,visual:1},[ta.TownWest]:{x:90,y:650,key:ha.Left,warpTo:ta.MansionOutside,visual:1},[ta.MansionOutside]:{x:-620,y:640,key:ha.Right,warpTo:ta.TownWest,visual:1},[ta.MansionEntrance]:{x:-1290,y:640,key:ha.Up,warpTo:ta.MansionExit,visual:1},[ta.MansionExit]:{x:-1770,y:-450,key:ha.Left,warpTo:ta.MansionEntrance,visual:1,skipLighting:!0},[ta.LabEntrance]:{x:-1920,y:640,key:ha.Down,warpTo:ta.LabExit,visual:3},[ta.LabExit]:{x:-380,y:1545,key:ha.Right,warpTo:ta.LabEntrance,visual:3,range:15,skipLighting:!0}},Ea=[];Object.values(Ta).forEach((t=>{t.warpAdd&&Ea.push(t.warpAdd),t.warpComplete&&Ea.push(t.warpComplete)})),Object.values(Pa).forEach((t=>{t.warpAdd&&Ea.push(t.warpAdd)}));class Ca extends i.Physics.Arcade.Image{constructor(t,i,n){const{x:r,y:o,visual:s,range:a,skipLighting:h}=Aa[i];super(t,r,o,s===Ia.Ladder?"ladder":"warp"),e(this,"warpType"),e(this,"player"),e(this,"particles1"),e(this,"particles2"),e(this,"graphics"),e(this,"range"),e(this,"initialized",!1),e(this,"unlocked",!0),this.warpType=i,this.player=n,this.setScale(.6).setDepth(f.Warpers),this.range=a||30,s!==Ia.Warp&&s!==Ia.WarpHidden||(this.setScale(.6,1),this.setPosition(r,o-12)),h||this.setPipeline("Light2D");const l=s===Ia.WarpHidden||s===Ia.Invisible;l&&(this.unlocked=!1),y.debug||this.setVisible(!l),Ea.includes(i)&&t.add.existing(this)}lazyInit(t){(t||!this.initialized&&xa(this,this.player))&&(Ea.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createParticles(),this.createDebug(),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),this.setVisible(this.visible),this.warpType===ta.Underground&&(this.scene.add.image(this.x,this.y-60,"ladder").setScale(.6).setPipeline("Light2D"),this.scene.add.image(this.x,this.y-105,"ladder").setScale(.6).setPipeline("Light2D")),this.initialized=!0)}createParticles(){const{visual:t,skipLighting:e}=Aa[this.warpType];t!==Ia.Warp&&t!==Ia.WarpHidden||(this.particles1=this.scene.add.particles(this.x,this.y-12,"warp",{x:{min:-3,max:3},y:{min:-3,max:3},speed:{random:[-40,40]},scale:{min:.35,max:.5},alpha:{start:.2,end:0},angle:{min:0,max:360},color:[b(m.Teal),b(m.White),b(m.Tan)],colorEase:"Linear",radial:!0,blendMode:i.BlendModes.OVERLAY}).setScale(1,2).setDepth(f.Warpers),this.particles1.viewBounds=this.particles1.getBounds(30,500),this.particles2=this.scene.add.particles(this.x,this.y-12,"warp",{x:{min:-30,max:30},y:{min:-50,max:50},speed:{random:[-5,5]},scale:{min:.05,max:.15},alpha:{values:[0,.2,0]},angle:{min:0,max:360},lifespan:{min:1e3,max:1400},color:[b(m.Peach),b(m.White),b(m.Tan)],colorEase:"Linear",radial:!0,maxAliveParticles:20}).setDepth(f.Warpers),this.particles2.viewBounds=this.particles2.getBounds(30,500),e||(this.particles1.setPipeline("Light2D"),this.particles2.setPipeline("Light2D")))}createDebug(){if(y.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const t=this.body;this.graphics.lineBetween(-this.range,-t.halfHeight,-this.range,t.halfHeight),this.graphics.lineBetween(this.range,-t.halfHeight,this.range,t.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:t,key:e}=Aa[this.warpType];return!(t!==Ia.Warp&&t!==Ia.WarpHidden&&t!==Ia.Invisible||e!==ha.Left&&e!==ha.Right)}onInteract(t){const e=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,i=t[Aa[this.warpType].key]&&e;return!i||this.warpType!==ta.TownEast||Ra(this.player.journal.journal,oa.ForestMazeSolved)||y.debug?i?(Ma(Aa[this.warpType].warpTo,this.player),Zs.Teleported):Zs.None:(this.scene.scene.pause(),this.scene.scene.launch("MazeDialog",{player:this.player}),Zs.None)}getButtonPrompt(){const t=Aa[this.warpType].key;let e;return t===ha.Continue&&(e="[CONTINUE]"),t===ha.Up&&(e="[Up]"),t===ha.Down&&(e="[Down]"),t===ha.Left&&(e="[Left]"),t===ha.Right&&(e="[Right]"),[`Travel to ${ta[Aa[this.warpType].warpTo]}`,"Press "+e]}setPosition(t,e,i,n){return super.setPosition(t,e,i,n),this.particles1&&this.particles2&&(this.particles1.setPosition(t,(e||0)-12),this.particles2.setPosition(t,(e||0)-12)),this.graphics&&this.graphics.setPosition(t,e),this}setVisible(t){return super.setVisible(t),this.particles1&&this.particles2&&(t&&this.unlocked?(this.particles1.start(),this.particles2.start()):(this.particles1.stop(),this.particles1.killAll(),this.particles2.stop(),this.particles2.killAll())),this}update(t,e){this.lazyInit()}destroy(t){this.particles1&&this.particles2&&(this.particles1.destroy(),this.particles2.destroy()),super.destroy(t)}}function Ma(t,e){const{x:n,y:r,onWarp:o}=Aa[t],s=e.scene,a=n-s.cameras.main.width/2,h=r-s.cameras.main.height/2;o&&o(e),s.cameras.main.fadeOut(200,0,0,0,((t,e)=>{e>=1&&s.cameras.main.fadeIn(1e3,0,0,0)})),s.cameras.main.stopFollow(),s.tweens.add({targets:s.cameras.main,scrollX:a,scrollY:h-y.cameraOffset,duration:600,delay:100,ease:"Power1",onComplete:()=>{s.cameras.main.startFollow(e),s.cameras.main.setFollowOffset(0,y.cameraOffset)}}),e.setActive(!1),s.tweens.add({targets:e,alpha:0,duration:500,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e.setPosition(n,r)},onComplete:()=>{e.alpha=1,e.setActive(!0)}});const l=e.light instanceof i.GameObjects.Light?e.light:e.light.light;s.tweens.add({targets:l,x:n,y:r,duration:400,ease:"Power1"})}const La=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3630,y:760,id:ra.Sphinx},{x:4575,y:850},{x:6160,y:690},{x:-565,y:575},{x:-2075,y:575},{x:-2075,y:1630},{x:-350,y:1510},{x:270,y:1560}];function za(t,e,n){var r,o;const s=Ga(t,na.Sphinx);if(!s)return void console.error("Sphinx not found");const a=function(t,e){return Wa(t,i.GameObjects.Rectangle).find((t=>t.getData("WallType")===e))}(t,ra.Sphinx);a&&(e?a.setX((null==(r=La.find((t=>t.id===ra.Sphinx)))?void 0:r.x)||0):a.setX(a.x-150),null==(o=a.body)||o.updateFromGameObject());const{x:h,y:l}=Na[na.Sphinx],c=e?h+200:h,p=e?l-90:l;t.tweens.add({targets:s,alpha:0,duration:!e||n?0:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{s.setPosition(c,p)},onComplete:()=>{s.alpha=1}}),t.tweens.add({targets:s.light,x:c,y:p,duration:!e||n?0:450,ease:"Power1"})}function Fa(t,e){return void 0!==t.find((t=>t.type===e))}function Ba(t,e){return t.some((t=>t.id===e&&!t.completed))}function Da(t,e){return t.some((t=>t.id===e&&t.completed))}function Ra(t,e){return t.includes(e)}function Wa(t,e){return t.children.getAll().filter((t=>t instanceof e))}function Ua(t,e,i){const n=function(t,e){return Wa(t,Ca).find((t=>t.warpType===e))}(t,e);n&&(i&&(n.unlocked=!0),n.setVisible(i))}function Ga(t,e){return Wa(t,Oa).find((t=>t.npcType===e))}function _a(t){var e;return(null==(e=t.scene.get("Game").clock)?void 0:e.rewindCount)||0}const Na={[na.Inventor]:{x:550,y:635,scale:.75,img:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[na.Stranger]:{x:750,y:865,scale:1.35,img:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[na.Sphinx]:{x:3520,y:790,scale:1,img:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:t=>za(t.scene,!1),light:1.85,initOnStart:!0},[na.Mayor]:{x:1065,y:-340,scale:.9,img:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[na.ClockTower]:{x:880,y:-2090,scale:.5,img:"warp",portrait:"clock_portrait",name:"Clock Tower",particles:{texture:"warp",scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]},onCreate:t=>{t.setOffset(150,-40)}}};class $a extends i.GameObjects.Text{constructor(t,i,n,r,o,s){super(t,i,n,r,{...w,fontSize:48,backgroundColor:`#${m.Teal}`,padding:{x:15,y:10},...s}),e(this,"onClick"),this.setOrigin(.5),t.add.existing(this),this.onClick=o,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>o())),this.on("pointerover",(()=>this.setTint(12303291))),this.on("pointerout",(()=>this.setTint(16777215)))}}class Va extends i.GameObjects.Container{constructor(t){var i,n,r;super(t),e(this,"buttons",[]),e(this,"activeIndex",-1),t.add.existing(this).setScrollFactor(0),null==(i=t.input.keyboard)||i.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(n=t.input.keyboard)||n.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(r=t.input.keyboard)||r.on("keydown-ENTER",(()=>{var t;null==(t=this.buttons[this.activeIndex])||t.onClick()}))}addButton(t){this.add(t),this.buttons.push(t),1===this.buttons.length&&this.setActiveButton(0),t.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(t){var e,i;null==(e=this.buttons[this.activeIndex])||e.setTint(16777215),this.activeIndex=t,null==(i=this.buttons[this.activeIndex])||i.setTint(b(m.Tan))}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const qa=20;class Ha extends i.GameObjects.Container{constructor(t,i){var n,r;super(t),e(this,"textWidth"),e(this,"textHeight"),e(this,"player"),e(this,"target"),e(this,"npcName"),e(this,"text"),e(this,"box"),e(this,"portrait"),e(this,"options"),e(this,"optionsContainer"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),e(this,"initialized",!1);const{width:o,height:s}=y;this.textWidth=o-130-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(qa,s-qa-170),this.setDepth(f.Overlay),this.setVisible(!1),this.player=i,null==(n=this.scene.input.keyboard)||n.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(r=this.scene.input.keyboard)||r.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}createUI(){this.scene.add.existing(this),this.npcName=new i.GameObjects.Text(this.scene,170,15,"",{...w,color:"#"+m.Tan}),this.text=new i.GameObjects.Text(this.scene,170,60,"",w),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(3),this.portrait=new i.GameObjects.Image(this.scene,qa,qa,"").setOrigin(0).setScale(1.5),this.box=new i.GameObjects.Rectangle(this.scene,0,0,y.width-40,170,b(m.Black),.8),this.box.setStrokeStyle(2,b(m.Tan),1),this.box.setOrigin(0,0),this.optionsContainer=new Va(this.scene).setDepth(f.Overlay),this.add([this.box,this.npcName,this.text,this.portrait])}setDialog(t,e,i){this.npcName||this.createUI(),this.setVisible(void 0!==t),this.target=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,this.scene.gamepad.offsetButtons(void 0!==this.dialog),t&&(this.npcName.setVisible(!1),e||i?(this.portrait.setVisible(!0),e instanceof Oa?(this.npcName.setVisible(!0),this.npcName.setText(Na[e.npcType].name),this.portrait.setTexture(Na[e.npcType].portrait)):i&&this.portrait.setTexture(i),this.text.setPosition(170,qa+(e?40:0)).setWordWrapWidth(this.textWidth,!0).setFixedSize(this.textWidth,this.textHeight)):(this.portrait.setVisible(!1),this.text.setPosition(qa,qa).setWordWrapWidth(170+this.textWidth,!0).setFixedSize(170+this.textWidth,this.textHeight)),this.showMessage())}showMessage(){const t=this.getMessages(),e=t&&t[this.messageIndex];e&&(this.text.setText(e),this.text.getWrappedText().length>3&&console.error("Message too long!",e)),this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;const t=!y.zoomed;this.options.forEach(((e,i)=>{const n=new $a(this.scene,y.width/2,y.height/(t?9:14)+i*(30+y.height/(t?16:22)),e,(()=>this.onSelectOption(e)),{fontSize:24,backgroundColor:"#"+m.Black,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(f.Overlay);this.optionsContainer.addButton(n)}))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){if(Date.now()<this.interactionTimeout)return;const t=this.getMessages();this.dialog&&t&&(this.messageIndex++,this.messageIndex>=t.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.setVisible(!1)):this.showMessage(),this.scene.gamepad.offsetButtons(void 0!==this.dialog),this.interactionTimeout=Date.now()+350)}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}}class Ka extends i.GameObjects.Text{constructor(t,e,i=3500){const n=Wa(t,Ka).reduce(((t,e)=>Math.max(t,e.y-20)),0)+65;super(t,20,n,e,{...w,backgroundColor:"#"+m.Teal,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(f.Overlay).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:n+10,duration:350,hold:i,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}class Xa extends i.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),this.setScrollFactor(0).setDepth(f.Ui).setVisible(!1)}createUI(){this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,b(m.Teal)).setStrokeStyle(2,b(m.White)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...w,fontSize:32}),this.add(this.text)}addItem(t,e){if(this.text||this.createUI(),this.inventory.push(t),!t.used){const e=this.scene.add.image(0,0,ma[t.type].image).setScale(.35);t.type===ea.Key&&e.setAngle(45),this.add(e)}this.updateItems();const i=function(t,e){return Wa(t,Sa).find((t=>t.itemType===e))}(this.scene,t.type);null==i||i.destroy(),e||new Ka(this.scene,`New item added: ${ma[t.type].name}`)}removeItem(t){var e;const i=this.inventory.find((e=>e.type===t));i&&(i.used=!0,null==(e=this.getAll().find((e=>{var i;return(null==(i=e.texture)?void 0:i.key)===ma[t].image})))||e.destroy()),this.updateItems()}updateItems(){var t;this.text||this.createUI();let e=0;this.getAll().forEach((t=>{if(t instanceof i.GameObjects.Image){const i=32+50*e;t.setPosition(i,68),e++}})),this.setVisible(this.inventory.length>0);const n=Math.max((null==(t=this.text)?void 0:t.displayWidth)+18,50*e+12);this.setPosition(y.width-n-20,20),this.rect.setSize(n,102)}}class Ya extends i.GameObjects.Image{constructor(t,i){super(t,y.width-50,y.height-55,"journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),this.player=i}createUI(){this.setScrollFactor(0).setDepth(f.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(y.width-21,y.height-89,20,20,11141120).setStrokeStyle(2,b(m.Black)).setScrollFactor(0).setDepth(f.Ui2).setVisible(!1)}addEntry(t,e){this.unread||this.createUI(),this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new Ka(this.scene,"New journal entry added!")),this.handleSideEffects(t,e||!1))}openJournal(){0!==this.journal.length&&(this.unread.setVisible(!1),this.scene.scene.pause(),this.scene.scene.launch("JournalDialog",{player:this.player}))}handleSideEffects(t,e){const{warpAdd:i}=Pa[t];if(i&&Ua(this.scene,i,!0),t===oa.SphinxRiddleSolved&&za(this.scene,!0,e),t===oa.ClockFirstGear){const t=Ga(this.scene,na.ClockTower);(null==t?void 0:t.clock)&&(t.clock.update1=!0)}}}class Qa extends i.GameObjects.Container{constructor(t){super(t,y.width-330-20,120),e(this,"quests",[]),e(this,"questRectangle")}createUI(){this.scene.add.existing(this),this.setScrollFactor(0).setDepth(f.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,330,60,b(m.Teal)).setStrokeStyle(2,b(m.White)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const t=this.scene.add.text(10,4,"Quests",{...w,fontSize:32});this.add(t)}addQuest(t,e){if(this.quests.find((e=>e.id===t.id)))return;this.questRectangle||this.createUI(),this.quests.push(t),this.add(this.scene.add.text(0,0,Ta[t.id].description,{...w,fontSize:20})),this.updateQuests();const{warpAdd:i,warpComplete:n}=Ta[t.id];i&&Ua(this.scene,i,!0),t.completed&&n&&Ua(this.scene,n,!0),e||new Ka(this.scene,`New quest added: ${Ta[t.id].description}`)}updateExistingQuest(t,e){const i=this.quests.find((e=>e.id===t));i&&(!i.completed&&e&&new Ka(this.scene,`Quest completed: ${Ta[i.id].description}`),i.completed=e);const{warpComplete:n}=Ta[t];n&&Ua(this.scene,n,e),this.updateQuests()}updateQuests(){this.questRectangle||this.createUI();const t=this.quests.filter((t=>!t.completed));let e=1,n=0;this.getAll().forEach((r=>{if(r instanceof i.GameObjects.Text)if(t.find((t=>r.text===Ta[t.id].description))||"Quests"===r.text){if("Quests"!==r.text){const t=14+30*e;r.setPosition(10,t),e++,n=Math.max(n,r.width)}}else r.destroy()}));const r=n+20;this.setX(y.width-20-r),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(r,50+30*t.length)}reset(){this.quests=[],this.updateQuests()}}const Ja=1.35*(y.fastMode?350:120),Za=new i.Math.Vector2(400,650);class th extends i.Physics.Arcade.Sprite{constructor(t){var i;super(t,Za.x,Za.y,"character",0),e(this,"scene"),e(this,"keys"),e(this,"light"),e(this,"debug"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),this.scene=t,t.add.existing(this),t.physics.add.existing(this),y.debug&&this.setInteractive(),this.setBodySize(48,70).setOffset(40,10).setOrigin(.5,.65).setDepth(f.Player).setScale(1.35).setPipeline("Light2D"),y.debug?(this.light=new g(t,this.x,this.y,200,16768443,1.2),this.debug=t.add.circle(this.x,this.y,3,16711935).setDepth(f.Debug)):this.light=t.lights.addLight(this.x,this.y,200,16768443,1.2),(i=this).anims.create({key:"walk",frames:i.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:4,repeat:-1}),i.anims.play("walk"),this.keys=new la(t),this.message=new Ha(t,this),this.inventory=new Xa(t),this.quests=new Qa(t),this.journal=new Ya(t,this)}update(t,e){var i;y.debug&&(this.setTint(this.interactive?16755370:16777215),this.debug.setPosition(this.x,this.y));const n=this.interactive&&!this.message.visible&&this.buttonPrompt.text.length>0||!1;n&&!this.buttonPrompt&&(this.buttonPrompt=new aa(this.scene)),null==(i=this.buttonPrompt)||i.setVisible(n),this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity(),this.light.setPosition(this.x,this.y),function(t){var e;const i=(null==(e=t.body)?void 0:e.velocity.x)||0,n=i<0;Math.abs(i)>0?(t.anims.resume(),t.flipX=t.rewinding?!n:n):t.anims.pause(),t.setAngle(t.flipX?-5:5)}(this)}checkInteraction(){let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys.keys),t!==Zs.None&&(this.interactionTimeout=Date.now()+(this.interactive.interactionTimeout||500),this.keys.resetKeys(),t===Zs.Teleported&&(this.interactive=void 0))),t}updateVelocity(){let t=Ja;const e=this.keys.keys;e[ha.Left]&&this.setVelocityX(-t),e[ha.Right]&&this.setVelocityX(t),y.debug&&!this.interactive&&(e[ha.Up]&&this.setVelocityY(-t),e[ha.Down]&&this.setVelocityY(t)),e[ha.Left]&&e[ha.Right]&&this.setVelocityX(0)}record(){var t;this.history.length<1e3?this.history.push(new i.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(Za.x,Za.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e,i;this.interactive=t;const n=(null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t))||"";n&&!this.buttonPrompt&&(this.buttonPrompt=new aa(this.scene)),null==(i=this.buttonPrompt)||i.setText(n)}}const eh="chrono-sleuth-save",ih={player:{x:Za.x,y:Za.y,flip:!1},journal:[],inventory:[],quests:[],settings:{gamepad:ba(),debug:!1,zoomed:ba()}},nh={player:{x:Za.x-200,y:Za.y,flip:!1},journal:[oa.FixTheClock,oa.SphinxRiddleSolved,oa.MetTheMayor],inventory:[{type:ea.Wrench,used:!1},{type:ea.Gear1,used:!1}],quests:[{id:ia.ForestGear,completed:!0},{id:ia.SphinxRiddle,completed:!0}],settings:{gamepad:!1,debug:!1,zoomed:!0}};function rh(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal,inventory:t.player.inventory.inventory,quests:t.player.quests.quests,settings:{gamepad:t.gamepad.visible,debug:y.debug,zoomed:y.zoomed}}}function oh(){const t=localStorage.getItem(eh);let e,i;try{t&&(e=JSON.parse(t))}catch(n){console.error(n),i=n}return{save:e||ih,error:i}}function sh(t,e){const i={...y};return y.debug=t.settings.debug,y.zoomed=t.settings.zoomed,y.zoomed!==i.zoomed?(function(t,e){console.log("setZoomed",e);const i=e?h:a;y.zoomed=e,y.width=i.width,y.height=i.height,y.cameraOffset=i.height/3,t.scale.setGameSize(i.width,i.height),t.scene.restart()}(e,y.zoomed),!0):y.debug!==i.debug&&(e.scene.restart(),!0)}function ah(t){const{save:e,error:i}=oh();i&&new Ka(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4);try{sh(e,t),t.player.setX(e.player.x),t.player.setY(e.player.y),t.player.setFlipX(e.player.flip),e.journal.forEach((e=>t.player.journal.addEntry(e,!0))),e.inventory.forEach((e=>t.player.inventory.addItem(e,!0))),e.quests.forEach((e=>t.player.quests.addQuest(e,!0))),t.gamepad.setVisible(e.settings.gamepad),Js(e,ih)||Js(e,nh),t.time.delayedCall(150,(()=>new Ka(t,"Game Loaded "))),Js(e,ih)&&hh(t)}catch(n){console.error(n),new Ka(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4),hh(t,ih),ah(t)}}function hh(t,e){const i=rh(t);localStorage.setItem(eh,JSON.stringify(e||i)),new Ka(t,"Game Saved")}i.GameObjects.Container;class lh extends i.Physics.Arcade.Image{constructor(t,n,r){var o;const{x:s,y:a,image:h,scale:l}=n;super(t,s,a,h),e(this,"player"),e(this,"initialized",!1),e(this,"info"),e(this,"center"),this.info=n,this.player=r,this.setOrigin(0).setDepth(f.Backgrounds);const c=null==(o=t.textures.get(h))?void 0:o.getSourceImage();this.center=new i.Math.Vector2(s+c.width*(l||1)/2,a+c.height*((l||1)/2))}lazyInit(t){(t||!this.initialized&&xa(this.center,this.player,2e3))&&(this.scene.add.existing(this),this.scene.physics.add.existing(this),y.debug&&this.setInteractive({draggable:!0}),this.info.skipLighting||this.setPipeline("Light2D"),this.info.scale&&this.setScale(this.info.scale),this.initialized=!0)}update(){this.lazyInit()}}function ch(){return Math.random()-.5}const ph=[3200,600],uh=[5350,690],yh=[500,200,100,50,10];class dh extends i.GameObjects.GameObject{constructor(t,n,r,o=40,s=[1400,600]){super(t,"fireflies"),e(this,"scene"),e(this,"center"),e(this,"lights",[]),e(this,"count"),e(this,"centers",[]),e(this,"bounds",[1e3,400]),e(this,"biases",[]),e(this,"initialized",!1),e(this,"debug"),t.add.existing(this),this.scene=t,this.count=o,this.bounds=s,this.center=new i.Math.Vector2(n,r),this.setPosition(n,r)}setPosition(t,e){this.centers=[];for(let n=0;n<this.count;n++)this.centers.push(new i.Math.Vector2(t+Math.random()*this.bounds[0]-this.bounds[0]/2,e+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(t-this.bounds[0]/2,e-this.bounds[1]/2)}lazyInit(t){if(t||!this.initialized&&xa(this.center,this.scene.player)){for(let t=0;t<this.count;t++){const t=new i.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),e=this.scene.lights.addPointLight(0,0,t.color,7*Math.random()+3,.15,.045+.02*ch());this.lights.push(e);const n=[];for(let i=0;i<2*yh.length;i++)n.push(ch()*yh[i%yh.length]);n.push(10*ch()),this.biases.push(n)}this.setPosition(this.center.x,this.center.y),y.debug&&(this.debug=this.scene.add.graphics().fillStyle(16711680,.5).lineStyle(2,16711680,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])),this.initialized=!0}}update(t,e){if(this.lazyInit(),!(Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0]))return;const i=t/1e3*.025,n=Math.cos(i),r=Math.sin(i);this.lights.forEach(((t,e)=>{const o=this.biases[e],s=Math.cos(70*i+o[10]);t.intensity=Math.min(.05+Math.abs(o[4]*s+o[3]*n+o[4]*n)/50,.4),t.x=n*o[0]+r*o[1]+n*o[2]+r*o[3]+n*o[4]+this.centers[e].x,t.y=r*o[5]+n*o[6]+r*o[7]+n*o[8]+r*o[9]+this.centers[e].y}))}}const fh={[sa.LabHatch]:{x:-1910,y:640},[sa.LabBook]:{x:300,y:1630,image:"book"},[sa.AlchemySet]:{x:-1e3,y:1630,image:"alchemy_empty"}};class gh extends i.Physics.Arcade.Image{constructor(t,i,n){const{x:r,y:o,image:s}=fh[i];super(t,r,o,s||""),e(this,"propType"),e(this,"player"),e(this,"initialized",!1),s||this.setAlpha(0),this.propType=i,this.player=n}lazyInit(t){(t||!this.initialized&&xa(this,this.player))&&(this.player.journal.journal.includes(oa.AlchemyLabFound)&&this.propType===sa.LabHatch?this.destroy():(this.scene.add.existing(this),this.scene.physics.add.existing(this),y.debug&&this.setInteractive({draggable:!0}),this.setScale(.35).setDepth(f.Items).setPipeline("Light2D"),this.initialized=!0))}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Zs.None;if(t[ha.Continue]){const t=ga(fa[this.propType]||[],this.player);if(t)return this.player.message.setDialog(t,this,fh[this.propType].portrait||"player_portrait"),Zs.Prop}return Zs.None}getButtonPrompt(){return[`Inspect ${sa[this.propType]}`,"Press [CONTINUE]"]}update(){this.lazyInit()}}class mh extends i.Physics.Arcade.Image{constructor(t,i,n,r=100,o=100,s=!1,a=!1){super(t,i,n,""),e(this,"scene"),e(this,"width"),e(this,"height"),e(this,"flipped"),e(this,"upwards"),e(this,"graphics"),e(this,"initialized",!1),this.scene=t,this.width=r,this.height=o,this.flipped=s,this.upwards=a}lazyInit(t){if(t||!this.initialized&&xa(this,this.scene.player)){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0),y.debug||this.setVisible(!1),this.setSize(this.width,1.5*this.height),y.debug){this.setInteractive({draggable:!0});const t=this.scene.add.graphics();this.graphics=t,t.lineStyle(2,65280,1);const e=this.width/2,n=new i.Math.Vector2(0,this.flipped?0:0+this.height),r=new i.Math.Vector2(0+this.width,this.flipped?0+this.height:0);t.lineBetween(n.x,n.y,r.x,r.y),t.lineBetween(n.x-e,n.y,n.x,n.y),t.lineBetween(r.x,r.y,r.x+e,r.y),t.strokeCircle(n.x,n.y,2),t.strokeCircle(r.x,r.y,2)}this.initialized=!0}}update(t,e){if(this.lazyInit(),!this.initialized)return;y.debug&&this.graphics&&this.graphics.setPosition(this.x,this.y);const n=this.scene.player,r=n.keys.keys;if(this.body&&this.scene.physics.world.intersects(this.body,n.body)){let t=i.Math.Clamp(1-(this.x+this.width-n.x)/this.width,0,1);this.flipped&&(t=1-t);const e=this.y+this.height,o=(1-n.originY)*n.displayHeight,s=e-this.height*t-o;if(this.upwards&&r[ha.Up]&&Math.abs(n.y-s)<70)return n.setVelocityX(this.flipped?-Ja:Ja),n.setFlipX(this.flipped),void n.setY(s);if(this.upwards&&(r[ha.Right]||r[ha.Left]&&this.flipped)&&n.y<e-70)return void n.setY(s);if(this.upwards&&s<n.y)return;n.setY(s)}}}class bh extends i.Physics.Arcade.StaticGroup{constructor(t,i){super(t.physics.world,t),e(this,"player"),e(this,"initialized",[]),this.player=i,La.forEach(((t,e)=>{void 0!==t.id&&this.createWall(t,e)}))}createWall(t,e){const i=this.scene.add.rectangle(t.x,t.y,6,100).setOrigin(0).setVisible(y.debug);t.id&&i.setData("WallType",t.id),y.debug&&i.setInteractive({draggable:!0}),this.add(i),this.initialized.push(e)}update(){La.forEach(((t,e)=>{this.initialized.includes(e)||i.Math.Distance.BetweenPointsSquared(t,this.player)<1e6&&this.createWall(t,e)}))}}class vh extends i.GameObjects.Container{constructor(t,i){super(t,100,y.height-100),e(this,"buttons",[]),e(this,"lastAxisKey"),e(this,"minimal"),this.minimal=i,this.setScrollFactor(0).setDepth(f.Overlay)}createUI(){this.scene.add.existing(this),this.createDPad(),this.minimal||this.createButtons(),this.createControllerListeners()}setVisible(t){return super.setVisible(t),t&&0===this.buttons.length&&this.createUI(),this}update(t,e){var i,n,r,o,s,a;const h=null==(i=this.scene.input.gamepad)?void 0:i.pad1;if(!h)return;const l=h.axes[0].getValue();if(Math.abs(l)<=.1&&this.lastAxisKey)return null==(n=this.scene.input.keyboard)||n.emit("keyup-"+this.lastAxisKey),void(this.lastAxisKey=void 0);if(l>.1){if("RIGHT"===this.lastAxisKey)return;"LEFT"===this.lastAxisKey&&(null==(r=this.scene.input.keyboard)||r.emit("keyup-LEFT")),null==(o=this.scene.input.keyboard)||o.emit("keydown-RIGHT"),this.lastAxisKey="RIGHT"}if(l<-.1){if("LEFT"===this.lastAxisKey)return;"RIGHT"===this.lastAxisKey&&(null==(s=this.scene.input.keyboard)||s.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastAxisKey="LEFT"}}createDPad(){const t=this.scene.add.container(10,-10);this.add(t);const e=this.scene.add.circle(0,0,60,b(m.Teal),.45).setStrokeStyle(3,b(m.Black));t.add(e),this.button(-57,0,"LEFT",t),this.button(57,0,"RIGHT",t),this.button(0,-57,"UP",t),this.button(0,57,"DOWN",t)}createButtons(){const t=this.scene.add.container(y.width-300,0);this.add(t);const e=this.scene.add.circle(40,0,65,b(m.Teal),.45).setStrokeStyle(3,b(m.Black)).setScale(1,.6).setAngle(-30);t.add(e),this.button(80,-20,"ENTER",t),this.button(0,20,"BACKSPACE",t)}createControllerListeners(){var t,e,i,n;null==(t=this.scene.input.gamepad)||t.on("connected",(t=>{new Ka(this.scene,"Gamepad connected")})),null==(e=this.scene.input.gamepad)||e.on("disconnected",(t=>{new Ka(this.scene,"Gamepad disconnected")})),null==(i=this.scene.input.gamepad)||i.on("down",((t,e)=>{var i;const n=this.getKeyFromButton(e);n&&(null==(i=this.scene.input.keyboard)||i.emit(`keydown-${n}`)),console.log("down",e)})),null==(n=this.scene.input.gamepad)||n.on("up",((t,e)=>{var i;const n=this.getKeyFromButton(e);n&&(null==(i=this.scene.input.keyboard)||i.emit(`keyup-${n}`)),console.log("up",e)}))}getKeyFromButton(t){let e;switch(t.index){case 0:e=t.pad.id.toLowerCase().includes("nintendo")?"BACKSPACE":"ENTER";break;case 1:e=t.pad.id.toLowerCase().includes("nintendo")?"ENTER":"BACKSPACE";break;case 9:e="ESC";break;case 12:e="UP";break;case 13:e="DOWN";break;case 14:e="LEFT";break;case 15:e="RIGHT"}return e}button(t,e,i,n){const r="ENTER"===i||"ESCAPE"===i?35:38,o=this.scene.add.circle(t,e,r,b(m.White),.8).setStrokeStyle(3,b(m.Black));o.setInteractive({useHandCursor:!0}).setScrollFactor(0),n.add(o),o.on("pointerdown",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keydown-${i}`),o.setFillStyle(b(m.Teal),Math.min(1,1.05))})),o.on("pointerup",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),o.setFillStyle(b(m.White),.8)})),o.on("pointerout",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),o.setFillStyle(b(m.White),.8)})),this.buttons.push(o)}offsetButtons(t){t?this.setPosition(100,y.height-300):this.setPosition(100,y.height-100)}}class wh extends i.GameObjects.Container{constructor(t,i,n,r,o){super(t,i,n),e(this,"img"),e(this,"rect"),t.add.existing(this),this.setScrollFactor(0).setDepth(f.Ui),this.rect=t.add.rectangle(0,0,42,42,b(m.Teal)).setScrollFactor(0).setStrokeStyle(2,b(m.Black)),this.img=t.add.image(-1,1,r).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>o(this))),this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}}const xh=[{x:0,y:0,image:"town"},{x:500,y:-1100,image:"clock_outside"},{x:500,y:-2400,image:"clock_inner",skipLighting:!0},{x:2300,y:0,image:"forest"},{x:4400,y:100,image:"lake"},{x:-2200,y:-170,image:"mansion_outside"},{x:-2e3,y:-1320,image:"mansion_inside",skipLighting:!0},{x:-2200,y:1300,image:"alchemy_lab",scale:.9,skipLighting:!0}],Sh=[{x:135,y:462,radius:150,color:b(m.Tan),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:887,y:200,radius:150},{x:1561,y:460},{x:791,y:472,intensity:.5},{x:962,y:469,intensity:.5},{x:162,y:814,intensity:2},{x:635,y:772},{x:1638,y:788,intensity:2},{x:5300,y:530,intensity:2},{x:5315,y:730,intensity:.75,radius:75}],kh=[{x:740,y:-1370,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5150,y:953,width:100,height:60,flip:!0},{x:5820,y:795,width:220,height:220},{x:-710,y:1577,width:280,height:190,upwards:!0},{x:-20,y:1695,width:200,height:70},{x:-1570,y:1728,width:200,height:40,flip:!0}];class jh extends i.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock"),e(this,"gamepad"),e(this,"shouldInit",!0)}init(){const t=function(t){const{save:e}=oh();try{return sh(e,t)}catch(i){console.error(i)}return!1}(this);this.shouldInit=!t}create(){if(!this.shouldInit)return;const t=performance.now();wa(this,500),this.player=new th(this);const e=this.createBackgrounds(),i=new bh(this,this.player),n=this.createWarpers(),r=this.createNpcs(),o=this.createItems(),s=this.createSlopes(),a=this.createProps(),h=new dh(this,ph[0],ph[1]),l=new dh(this,uh[0],uh[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...n,...r,...o,...a],{runChildUpdate:!0});const c=this.add.group([this.player,this.gamepad,h,l,...s,i,...e],{runChildUpdate:!0});this.clock&&c.add(this.clock),this.physics.add.collider(this.player,i),this.createEventListeners();const p=this.cameras.main;p.startFollow(this.player,!0),p.setFollowOffset(0,y.cameraOffset),ah(this);const u=performance.now()-t;console.log(`Game.create() took ${u.toFixed(1)}ms to initialize`)}update(){this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>void 0===t.visible||t.visible),this.player)||this.player.setInteractiveObject(void 0)}createBackgrounds(){return xh.map((t=>new lh(this,t,this.player)))}createWarpers(){const t=[];for(const e in ta)isNaN(Number(e))&&t.push(new Ca(this,ta[e],this.player));return t}createNpcs(){return Object.values(na).filter((t=>"number"==typeof t)).map((t=>new Oa(this,t,this.player)))}createItems(){return[ea.Gear1,ea.Key].map((t=>new Sa(this,t,this.player)))}createSlopes(){return kh.map((t=>new mh(this,t.x,t.y,t.width,t.height,t.flip,t.upwards)))}createProps(){return Object.values(sa).filter((t=>"number"==typeof t)).map((t=>new gh(this,t,this.player)))}createUI(){return this.time.delayedCall(300,(()=>{[new wh(this,31,30,"settings",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),new wh(this,81,30,k(this)?"moon":"sun",(t=>{const e=k(this);var i;k(i=this)?function(t,e=!0){S||(O(t,m.Night,e),t.lights.lights.forEach((i=>{const n=i.intensity;i.setVisible(!0),e&&(i.setIntensity(0),t.tweens.add({targets:i,duration:x,intensity:n}))})))}(i):j(i),t.img.setTexture(e?"sun":"moon")})),new wh(this,131,30,y.zoomed?"zoom-out":"zoom-in",(()=>{const t=rh(this);hh(this,{...t,settings:{...t.settings,zoomed:!y.zoomed}}),this.scene.restart()}))].forEach((t=>{t.setAlpha(0),this.tweens.add({targets:t,alpha:1,duration:250})}))})),this.gamepad=new vh(this),{debugUI:void 0}}createLights(){this.lights.enable().setAmbientColor(b(m.White)),Sh.forEach((t=>{y.debug?new g(this,t.x,t.y,t.radius||100,t.color||b(m.Lights),t.intensity||1):this.lights.addLight(t.x,t.y,t.radius||100,t.color||b(m.Lights),t.intensity||1)})),j(this,!1)}createEventListeners(){var t,e;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),null==(e=this.input.keyboard)||e.on("keydown-J",(()=>{this.player.journal.openJournal()})),this.events.on("resume",(()=>{this.player.keys.resetKeys()}))}}class Oh extends i.GameObjects.Container{constructor(t,n,r,o,s){var a,h;super(t,n,r),e(this,"textObject"),e(this,"maskGraphics"),e(this,"scrollbar"),e(this,"scrollY"),e(this,"boxHeight"),t.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new i.GameObjects.Text(t,0,0,o,{...w,padding:{x:10,y:10},...s}),this.textObject.setOrigin(0).setScrollFactor(0).setInteractive(),this.add(this.textObject),t.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),null==(a=t.input.keyboard)||a.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(h=t.input.keyboard)||h.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=t.add.graphics().setPosition(n,r).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=t.add.rectangle(0,0,4,0,5592405).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(t,e){this.boxHeight=e,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,t,e);const i=this.maskGraphics.createGeometryMask();this.textObject.setMask(i),this.textObject.setWordWrapWidth(t-8),this.textObject.setFixedSize(t-8,0),this.updateTextPosition()}handleDrag(t){t.isDown&&(this.scrollY-=t.velocity.y,this.updateTextPosition())}handleScroll(t,e,i,n,r){this.scrollY+=.5*n,this.updateTextPosition()}updateTextPosition(){const t=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=i.Math.Clamp(this.scrollY,0,t),this.textObject.y=-this.scrollY;const e=this.scrollY/t,n=this.boxHeight/this.textObject.height;this.scrollbar.height=n*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+4,e*(this.boxHeight-n*this.boxHeight))}}class Ph extends i.Scene{constructor(){super("JournalDialog"),e(this,"player")}init(t){this.player=t.player}create(){var t,e,i;const n=this.add.container(y.width/2,y.height/2);n.add(this.add.rectangle(0,0,.8*y.width,.8*y.height,0,.75).setStrokeStyle(4,b(m.Tan))),n.add(new $a(this,.35*y.width,-.33*y.height,"X",(()=>this.close()))),n.add(this.add.text(0,-.33*y.height,"Journal",{...w,fontSize:48}).setOrigin(.5));const r=this.player.journal.journal.map((t=>`- ${Pa[t].description}\n`)).reverse();new Oh(this,.13*y.width,.25*y.height,r,{fontSize:32}).setBoxSize(.74*y.width,.62*y.height),new vh(this).setVisible(!1),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()})),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.close()})),null==(i=this.input.keyboard)||i.on("keydown-BACKSPACE",(()=>{this.close()}))}close(){this.scene.stop(),this.scene.resume("Game")}}function Th(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Ih(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Th(Object(i),!0).forEach((function(e){Ah(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Th(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ah(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Eh(t){return t.slice(0,-1)}function Ch(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function Mh(t){return[...new Set(t)]}function Lh(t,e){const i=Mh(t.map((t=>t.set))).filter(Boolean),n=(r=Ch(1,t.length+1),o=i,[r,o].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var r,o;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=n[e]))}function zh(t,e,i=.5){Eh(t).forEach(((n,r)=>{const o=t[r+1],s=n.set!==o.set,a=e()<=i;var h,l,c;s&&a&&(h=t,l=o.set,c=n.set,h.forEach((t=>{t.set===l&&(t.set=c)})),n.right=!1,o.left=!1)}))}const Fh=48;class Bh extends i.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"nextUpdate")}init(t){this.parent=t.parent}create(){this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,.8*Fh,.8*Fh,5601177).setSmoothness(32).setOrigin(-.13),this.cameras.main.startFollow(this.mazePlayer),this.keys=this.parent.keys}createMaze(){const t=_a(this.parent.player.scene);this.maze=function(t=8,e=t,i=!0,n=1){const r=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(n),o=[],s=Ch(t);for(let l=0;l<e;l+=1){const n=s.map((n=>({x:n,y:l,top:i||l>0,left:i||n>0,bottom:i||l<e-1,right:i||n<t-1})));o.push(n)}Eh(o).forEach(((t,e)=>{Lh(t,r),zh(t,r),function(t,e,i){const n=Object.values(function(t,e){let i=Mh(t.map((t=>t.set))).reduce(((t,e)=>Ih(Ih({},t),{},{[e]:[]})),{});return t.forEach((t=>i[t.set].push(t))),i}(t)),{ceil:r}=Math;n.forEach((t=>{(function(t,e,i){e=null==e?1:e;const n=null==t?0:t.length;if(!n||e<1)return[];e=e>n?n:e;let r=-1;const o=n-1,s=[...t];for(;++r<e;){const t=r+Math.floor(i()*(o-r+1)),e=s[t];s[t]=s[r],s[r]=e}return s.slice(0,e)})(t,r(i()*t.length),i).forEach((t=>{if(t){const i=e[t.x];t.bottom=!1,i.top=!1,i.set=t.set}}))}))}(t,o[e+1],r)}));const a=(h=o)[h.length-1];var h;return Lh(a,r),zh(a,r,1),o}(24,24,!0,t),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,Fh,Fh),this.graphics.lineStyle(3,3385907),this.maze.forEach((t=>{t.forEach((t=>{if(t.top){const e=new i.Geom.Line(t.x*Fh,t.y*Fh,t.x*Fh+Fh,t.y*Fh);this.graphics.strokeLineShape(e)}if(t.bottom){const e=new i.Geom.Line(t.x*Fh,t.y*Fh+Fh,t.x*Fh+Fh,t.y*Fh+Fh);this.graphics.strokeLineShape(e)}if(t.left){const e=new i.Geom.Line(t.x*Fh,t.y*Fh,t.x*Fh,t.y*Fh+Fh);this.graphics.strokeLineShape(e)}if(t.right){const e=new i.Geom.Line(t.x*Fh+Fh,t.y*Fh,t.x*Fh+Fh,t.y*Fh+Fh);this.graphics.strokeLineShape(e)}}))})),this.cameras.main.setViewport(50,130,y.width-100,y.height-170)}update(t,e){if(t<this.nextUpdate)return;const n=this.keys.keys;n[ha.Continue];const r=new i.Math.Vector2(0,0);n[ha.Left]?r.x=-48:n[ha.Right]?r.x=Fh:n[ha.Up]?r.y=-48:n[ha.Down]&&(r.y=Fh);const o=new i.Math.Vector2(this.mazePlayer.x+r.x,this.mazePlayer.y+r.y);if((this.mazePlayer.x!==o.x||this.mazePlayer.y!==o.y)&&this.canMove(o)){this.mazePlayer.setPosition(o.x,o.y);const t=new i.Math.Vector2(1104,1104);this.parent.setAngle(i.Math.Angle.BetweenPoints(o,t)),this.mazePlayer.x===t.x&&this.mazePlayer.y===t.y&&this.parent.close(!0)}this.nextUpdate=t+140}canMove(t){const e=t.x,n=t.y,r=i.Math.FloorTo(e/Fh),o=i.Math.FloorTo(n/Fh);if(r<0||o<0||r>=24||o>=24)return!1;const s=i.Math.FloorTo(this.mazePlayer.x/Fh),a=i.Math.FloorTo(this.mazePlayer.y/Fh),h=this.maze[a][s];return!(h.top&&n<this.mazePlayer.y||h.bottom&&n>this.mazePlayer.y||h.left&&e<this.mazePlayer.x||h.right&&e>this.mazePlayer.x)}}class Dh extends i.Scene{constructor(){super("MazeDialog"),e(this,"player"),e(this,"container"),e(this,"arrow"),e(this,"keys")}init(t){this.player=t.player}create(){var t,e;this.container=this.add.container(y.width/2,y.height/2),this.container.add(this.add.rectangle(0,0,.95*y.width,.95*y.height,0,.9).setStrokeStyle(4,b(m.Tan))),this.container.add(new $a(this,.44*y.width,-.4*y.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*y.height,"Find your way through the forest",{...w,fontSize:48}).setOrigin(.5)),this.arrow=this.add.image(.4*-y.width,.4*-y.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new vh(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new la(this),this.scene.launch("Maze",{parent:this})}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}close(t){this.scene.stop(),this.scene.stop("Maze"),this.scene.resume("Game"),t?(Ma(ta.Forest,this.player),this.player.journal.addEntry(oa.ForestMazeSolved)):this.player.setPosition(Aa[ta.TownEast].x-40,Aa[ta.TownEast].y)}}class Rh extends i.Scene{constructor(){super("Paused"),e(this,"parent")}init(t){this.parent=t.game}create(){var t;const{width:e,height:i}=y;this.add.rectangle(e/2,i/2,e,i,0,.75).setInteractive().on("pointerdown",(()=>this.resume())),this.add.text(e/2,100,"Game Paused",{...w,fontSize:72}).setOrigin(.5),this.add.text(e-20,20,`Build Time: ${new Date("2024-08-05T08:25:38.432Z").toLocaleString()}`,{...w,fontSize:16}).setOrigin(1,0);const n=!y.zoomed,r=n?100:88,o=i/2-(n?100:70),s=new Va(this);s.addButton(new $a(this,e/2,o,"Resume",(()=>this.resume()))),s.addButton(new $a(this,e/2,o+r,"Save",(()=>{this.resume(),hh(this.parent)}))),s.addButton(new $a(this,e/2,o+2*r,"Load",(()=>{this.resume(),this.parent.scene.restart()}))),s.addButton(new $a(this,e/2,o+3*r,"Toggle Gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}))),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume())),new vh(this).setVisible(!1)}resume(){this.scene.stop(),this.scene.resume("Game")}}var Wh=(t=>(t.Straight="S",t.Corner="C",t.T="T",t.Cross="X",t.Empty=" ",t))(Wh||{}),Uh=(t=>(t[t.Up=0]="Up",t[t.Right=90]="Right",t[t.Down=180]="Down",t[t.Left=270]="Left",t))(Uh||{});const Gh={S:[[0,0,0],[1,1,1],[0,0,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},_h=[["C"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "],["T","C"," "," "," ","C","C"," ","C","S","T","X"," "," "," "," "],[" ","S"," "," "," ","T","S"," ","X"," "," ","S"," "," "," "," "],[" ","X","S","T"," ","S","S"," ","X"," "," ","X","X","T"," "," "],[" "," "," ","C","X","T","T","X","S"," "," ","T","C","S"," "," "],[" "," "," "," "," "," "," ","X","T"," "," "," "," ","S"," "," "],[" "," "," "," "," "," "," ","S","T"," "," "," "," ","T","S","C"],[" "," "," "," "," "," "," ","C","C"," "," "," "," "," "," ","C"]].map((t=>t.map((t=>t))));function Nh(t,e){if(!t||!e)return!1;const i=$h(t),n=$h(e),r=e.x-t.x,o=e.y-t.y;return 1===r&&0===o?i.right&&n.left:-1===r&&0===o?i.left&&n.right:0===r&&1===o?i.bottom&&n.top:0===r&&-1===o&&i.top&&n.bottom}function $h(t){const e=function(t){let e=Gh[t.type];const i=Math.floor(t.rotation/90);for(let n=0;n<i;n++)e=Vh(e);return e}(t);return{left:e.some((t=>1===t[0])),right:e.some((t=>1===t[t.length-1])),top:e[0].some((t=>1===t)),bottom:e[e.length-1].some((t=>1===t))}}function Vh(t){return t[0].map(((e,i)=>t.map((t=>t[i])).reverse()))}class qh extends i.Scene{constructor(){super("Pipes"),e(this,"parent"),e(this,"graphics"),e(this,"cursor"),e(this,"position"),e(this,"keys"),e(this,"pipes",[]),e(this,"images"),e(this,"blockSize"),e(this,"pipeSize"),e(this,"nextUpdate",0)}init(t){this.parent=t.parent,this.blockSize=y.zoomed?13:17,this.pipeSize=3.75*this.blockSize}preload(){this.prerenderPipes()}prerenderPipes(){for(const t of Object.values(Wh).filter((t=>"number"!=typeof t))){const e=Gh[t],i=`pipe_${t}`;this.textures.exists(i)&&this.textures.remove(i);const n=this.textures.createCanvas(i,3*this.blockSize,3*this.blockSize);if(n){const t=n.context;t.fillStyle="#ffffff";for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++)1===e[i][n]&&t.fillRect(n*this.blockSize,i*this.blockSize,this.blockSize,this.blockSize);n.refresh()}}}create(){this.graphics=this.add.graphics(),this.keys=this.parent.keys,this.cursor=this.add.rectangle(100,100,this.pipeSize,this.pipeSize,0,0).setStrokeStyle(2,b(m.Tan),.75).setVisible(!1),this.position=new i.Math.Vector2(0,0),this.createPipes(),this.updatePipes()}createPipes(){this.pipes=[],this.images=this.add.container().setPosition(y.width/2-16*this.pipeSize/2+this.pipeSize/2,y.height/4);for(let e=0;e<8;e++){this.pipes[e]||(this.pipes[e]=[]);for(let n=0;n<16;n++){let r=_h[e][n];const o=0===n&&0===e,s=15===n&&7===e;let a=!o&&!s;r===Wh.Empty&&Math.random()<.9&&(r=(t=Object.values(Wh).filter((t=>"number"!=typeof t)))[Math.floor(Math.random()*t.length)],r===Wh.Cross&&Math.random()<.5&&(r=Wh.T),Math.random()<.25&&(a=!1)),this.pipes[e][n]={x:n,y:e,type:r,rotation:90*i.Math.Between(0,3),interactive:a},o&&(this.pipes[e][n].rotation=Uh.Up),s&&(this.pipes[e][n].rotation=Uh.Down);const h=`pipe_${r}`,l=this.add.image(n*this.pipeSize,e*this.pipeSize,h).on("pointerdown",(()=>{this.cursor.setVisible(!1),this.pipes[e][n].rotation=(this.pipes[e][n].rotation+90)%360,this.updatePipes()}));a&&l.setInteractive(),this.images.add(l)}}var t}updatePipes(){const t=function(t,e,i){const n=[],r=new Set,o=t.length,s=t[0].length;return function e(i,a){const h=`${i},${a}`;r.add(h),n.push(t[a][i]),i+1<s&&!r.has(`${i+1},${a}`)&&Nh(t[a][i],t[a][i+1])&&e(i+1,a),i-1>=0&&!r.has(`${i-1},${a}`)&&Nh(t[a][i],t[a][i-1])&&e(i-1,a),a+1<o&&!r.has(`${i},${a+1}`)&&Nh(t[a][i],t[a+1][i])&&e(i,a+1),a-1>=0&&!r.has(`${i},${a-1}`)&&Nh(t[a][i],t[a-1][i])&&e(i,a-1)}(0,0),n}(this.pipes);this.pipes.forEach((e=>{e.forEach((e=>{const i=this.images.getAt(e.x+e.y*_h[0].length);i.setAngle(e.rotation),t.includes(e)?(e.interactive?i.setTint(3364249):i.setTint(8789),e.x===_h[0].length-1&&e.y===_h.length-1&&this.parent.time.delayedCall(500,(()=>{this.parent.close(!0)}))):e.interactive?i.setTint(16777215):i.setTint(6710886)}))}))}update(t,e){if(t<this.nextUpdate)return;let i=!0;const n=this.keys.keys;if(n[ha.Continue]){const t=this.pipes[this.position.y][this.position.x];t.rotation=(t.rotation+90)%360,this.updatePipes()}else n[ha.Left]?this.position.x=Math.max(0,this.position.x-1):n[ha.Right]?this.position.x=Math.min(16,this.position.x+1):n[ha.Up]?this.position.y=Math.max(0,this.position.y-1):n[ha.Down]?this.position.y=Math.min(8,this.position.y+1):i=!1;i&&(this.nextUpdate=t+200,this.cursor.setVisible(!0),this.cursor.setPosition(this.images.x+this.position.x*this.pipeSize,this.images.y+this.position.y*this.pipeSize))}}class Hh extends i.Scene{constructor(){super("PipesDialog"),e(this,"player"),e(this,"container"),e(this,"keys"),e(this,"level")}init(t){this.player=t.player,this.level=t.level}create(){var t,e;this.container=this.add.container(y.width/2,y.height/2),this.container.add(this.add.rectangle(0,0,.95*y.width,.95*y.height,0,.9).setStrokeStyle(4,b(m.Tan))),this.container.add(new $a(this,.44*y.width,-.4*y.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*y.height,"Rotate the pipes to fix the alchemy equipment",{...w,fontSize:48}).setOrigin(.5)),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new vh(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new la(this),this.scene.launch("Pipes",{parent:this})}close(t){this.scene.stop(),this.scene.stop("Pipes"),this.scene.resume("Game"),t&&0===this.level&&this.player.journal.addEntry(oa.ForestMazeSolved)}}class Kh extends i.Scene{constructor(){super("Preloader"),e(this,"container")}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(y.width,y.height),this.add.image(30,y.height-15,"logo").setOrigin(0,1).setScale(.25);const t=.68*y.width,e=this.add.container(.23*y.width,.91*y.height);this.container=e;const i=this.add.rectangle(0,0,t,26).setStrokeStyle(1,16777215,.85).setOrigin(0);e.add(i);const n=this.add.rectangle(3,3,0,20,16777215,.85).setOrigin(0);e.add(n),this.load.on("progress",(e=>{const i=.6*e;n.width=(t-6)*i})),this.load.on("complete",(()=>{this.tweens.add({targets:n,width:t-6,duration:2400})}));const r=document.createElement("img");r.src="assets/icons/settings.svg",r.id="loading",this.add.dom(0,0,r),wa(this,300)}preload(){this.load.setPath("assets"),this.load.svg("sun","icons/sun.svg",{width:64,height:64}),this.load.svg("moon","icons/moon.svg",{width:64,height:64}),this.load.svg("settings","icons/settings.svg",{width:64,height:64}),this.load.svg("zoom-in","icons/zoom-in.svg",{width:64,height:64}),this.load.svg("zoom-out","icons/zoom-out.svg",{width:64,height:64}),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("mansion_outside","maps/mansion_outside_hatch.jpg"),this.load.image("mansion_inside","maps/mansion_inside.jpg"),this.load.image("alchemy_lab","maps/alchemy_lab.jpg"),this.load.image("ladder","ladder.png"),this.load.image("warp","warp.png"),this.load.image("watch","watch.png"),this.load.image("arrow","arrow.png"),this.load.image("gear","items/gear.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.image("key","items/key.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),this.load.image("player_portrait","characters/player_portrait.png"),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png"),this.load.image("clock_portrait","characters/clock_portrait.png"),this.load.image("book","props/book.png"),this.load.image("alchemy_empty","props/alchemy/alchemy_empty.png"),this.load.image("alchemy_blue","props/alchemy/alchemy_blue.png"),this.load.image("alchemy_full","props/alchemy/alchemy_full.png"),this.load.image("alchemy_green","props/alchemy/alchemy_green.png"),this.load.image("alchemy_red","props/alchemy/alchemy_red.png")}create(){this.time.delayedCall(3e3,(()=>{var t;t=()=>{this.scene.stop(this),this.scene.start("Game")},this.cameras.main.fadeOut(300,va.red,va.green,va.blue,((e,i)=>{i>=1&&t&&t()}))}))}}!function(t={}){const{immediate:e=!1,onNeedRefresh:i,onOfflineReady:n,onRegistered:r,onRegisteredSW:o,onRegisterError:a}=t;let h,l;l=async function(){if("serviceWorker"in navigator){if(h=await function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){const t=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),o=(null==r?void 0:r.nonce)||(null==r?void 0:r.getAttribute("nonce"));n=Promise.all(e.map((e=>{if(e=function(t,e){return new URL(t,e).href}(e,i),e in s)return;s[e]=!0;const n=e.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(i)for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.href===e&&(!n||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=n?"stylesheet":"modulepreload",n||(a.as="script",a.crossOrigin=""),a.href=e,o&&a.setAttribute("nonce",o),document.head.appendChild(a),n?new Promise(((t,i)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}return n.then((()=>t())).catch((t=>{const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}))}((()=>import("./workbox-window.prod.es5-B8JjyKVo.js")),[],import.meta.url).then((({Workbox:t})=>new t("./sw.js",{scope:"./",type:"classic"}))).catch((t=>{null==a||a(t)})),!h)return;h.addEventListener("activated",(t=>{(t.isUpdate||t.isExternal)&&window.location.reload()})),h.addEventListener("installed",(t=>{t.isUpdate||null==n||n()})),h.register({immediate:e}).then((t=>{o?o("./sw.js",t):null==r||r(t)})).catch((t=>{null==a||a(t)}))}}()}({immediate:!0});const Xh={type:Phaser.AUTO,width:y.width,height:y.height,parent:"game-container",backgroundColor:b(m.Background),scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[d,Kh,jh,Rh,Ph,Dh,Bh,Hh,qh],input:{gamepad:!0},physics:{default:"arcade"},render:{pixelArt:!0,antialias:!1},dom:{createContainer:!0}};("m6x11","./m6x11.ttf",new FontFace("m6x11","url(./m6x11.ttf)").load().then((function(t){document.fonts.add(t)})).catch((function(t){return t}))).then((()=>{new i.Game(Xh)}));
