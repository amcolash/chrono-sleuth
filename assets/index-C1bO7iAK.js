var t=Object.defineProperty,e=(e,i,n)=>(((e,i,n)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n})(e,"symbol"!=typeof i?i+"":i,n),n);import{p as i,g as n,c as r,a as s}from"./phaser-pZmLa9DQ.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const o={},a={width:1280,height:720},l={width:960,height:540};let h=!1,c=!1;c=!0;const{width:p,height:u}=a;h=!1,c=!1;const d={debug:!1,width:p,height:u,cameraOffset:u/3,zoomed:!1,dayMinutes:.25,rewindEnabled:!1,fastMode:!1};class y extends i.Scene{constructor(){super("Boot")}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("splash","splash.png")}create(){this.scene.start("Preloader")}}var f=(t=>(t[t.Backgrounds=-1]="Backgrounds",t[t.Warpers=0]="Warpers",t[t.Npcs=1]="Npcs",t[t.Items=2]="Items",t[t.Player=3]="Player",t[t.Shader=4]="Shader",t[t.Ui=5]="Ui",t[t.Ui2=6]="Ui2",t[t.Debug=7]="Debug",t[t.Overlay=8]="Overlay",t))(f||{});class g extends i.GameObjects.GameObject{constructor(t,i,n,r,s,o){super(t,"Light"),e(this,"x"),e(this,"y"),e(this,"light"),e(this,"debug"),t.add.existing(this),this.light=t.lights.addLight(i,n,r,s,o),this.debug=t.add.graphics({x:i,y:n}).setDepth(f.Debug),this.debug.lineStyle(3,65280),this.x=i,this.y=n,d.debug&&this.debug.strokeCircle(0,0,r)}setPosition(t,e){this.debug.setVisible(this.light.visible),this.light.setPosition(t,e),this.debug.setPosition(t,e),this.x=t,this.y=e}destroy(t){var e,i;super.destroy(t),this.debug.destroy(),null==(i=null==(e=this.scene)?void 0:e.lights)||i.removeLight(this.light)}}const m={White:"fcfee9",Tan:"e6c99d",Peach:"d07151",Brown:"473946",Teal:"303646",Black:"1c1831",Warning:"993333",Lights:"ffccaa",Night:"335588",Background:"111111"};function b(t){return i.Display.Color.HexStringToColor(t).color}function v(t){return b(i.Display.Color.RGBToString(255*t.r,255*t.g,255*t.b))}const w={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${m.White}`},x=1200;let S=!1;function k(t){return v(t.lights.ambientColor)===b(m.White)}function j(t,e=!0){S||(T(t,m.White,e),t.lights.lights.forEach((i=>{const n=i.intensity;e?t.tweens.add({targets:i,duration:x,intensity:0,onComplete:()=>{i.setVisible(!1),i.setIntensity(n)}}):i.setVisible(!1)})))}function T(t,e,n){if(!n)return void t.lights.setAmbientColor(b(e));S=!0;const r=v(t.lights.ambientColor),s=i.Display.Color.ValueToColor(r),o=i.Display.Color.ValueToColor(e);t.tweens.addCounter({from:0,to:100,duration:x,onUpdate:e=>{const n=i.Display.Color.Interpolate.ColorWithColor(s,o,100,e.getValue());var r;t.lights.setAmbientColor((r=n,b(i.Display.Color.RGBToString(r.r,r.g,r.b))))},onComplete:()=>{S=!1}})}var I,O,P=Object.prototype.toString,A=function(t){var e=P.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===P.call(t.callee)),i},E=Array.prototype.slice,C=A,M=Object.keys,z=M?function(t){return M(t)}:function(){if(O)return I;var t;if(O=1,!Object.keys){var e=Object.prototype.hasOwnProperty,i=Object.prototype.toString,n=A,r=Object.prototype.propertyIsEnumerable,s=!r.call({toString:null},"toString"),o=r.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var e=t.constructor;return e&&e.prototype===t},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!h["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(i){return!0}}catch(i){return!0}return!1}();t=function(t){var r=null!==t&&"object"==typeof t,h="[object Function]"===i.call(t),p=n(t),u=r&&"[object String]"===i.call(t),d=[];if(!r&&!h&&!p)throw new TypeError("Object.keys called on a non-object");var y=o&&h;if(u&&t.length>0&&!e.call(t,0))for(var f=0;f<t.length;++f)d.push(String(f));if(p&&t.length>0)for(var g=0;g<t.length;++g)d.push(String(g));else for(var m in t)y&&"prototype"===m||!e.call(t,m)||d.push(String(m));if(s)for(var b=function(t){if("undefined"==typeof window||!c)return l(t);try{return l(t)}catch(e){return!1}}(t),v=0;v<a.length;++v)b&&"constructor"===a[v]||!e.call(t,a[v])||d.push(a[v]);return d}}return I=t}(),L=Object.keys;z.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return C(t)?L(E.call(t)):L(t)})}else Object.keys=z;return Object.keys||z};var B,F=z,W=Error,D=EvalError,R=RangeError,_=ReferenceError,U=SyntaxError,G=TypeError,N=URIError,H=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0},$="undefined"!=typeof Symbol&&Symbol,V=H,q=function(){return"function"==typeof $&&"function"==typeof Symbol&&"symbol"==typeof $("foo")&&"symbol"==typeof Symbol("bar")&&V()},K={__proto__:null,foo:{}},Q=Object,X=Object.prototype.toString,Y=Math.max,J=function(t,e){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var r=0;r<e.length;r+=1)i[r+t.length]=e[r];return i},Z=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||"[object Function]"!==X.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var i,n=function(t,e){for(var i=[],n=1,r=0;n<t.length;n+=1,r+=1)i[r]=t[n];return i}(arguments),r=Y(0,e.length-n.length),s=[],o=0;o<r;o++)s[o]="$"+o;if(i=Function("binder","return function ("+function(t,e){for(var i="",n=0;n<t.length;n+=1)i+=t[n],n+1<t.length&&(i+=",");return i}(s)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var r=e.apply(this,J(n,arguments));return Object(r)===r?r:this}return e.apply(t,J(n,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,i.prototype=new a,a.prototype=null}return i},tt=Function.prototype.call,et=Object.prototype.hasOwnProperty,it=Z.call(tt,et),nt=W,rt=D,st=R,ot=_,at=U,lt=G,ht=N,ct=Function,pt=function(t){try{return ct('"use strict"; return ('+t+").constructor;")()}catch(e){}},ut=Object.getOwnPropertyDescriptor;if(ut)try{ut({},"")}catch(Zl){ut=null}var dt=function(){throw new lt},yt=ut?function(){try{return dt}catch(t){try{return ut(arguments,"callee").get}catch(e){return dt}}}():dt,ft=q(),gt={__proto__:K}.foo===K.foo&&!(K instanceof Q),mt=Object.getPrototypeOf||(gt?function(t){return t.__proto__}:null),bt={},vt="undefined"!=typeof Uint8Array&&mt?mt(Uint8Array):B,wt={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?B:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?B:ArrayBuffer,"%ArrayIteratorPrototype%":ft&&mt?mt([][Symbol.iterator]()):B,"%AsyncFromSyncIteratorPrototype%":B,"%AsyncFunction%":bt,"%AsyncGenerator%":bt,"%AsyncGeneratorFunction%":bt,"%AsyncIteratorPrototype%":bt,"%Atomics%":"undefined"==typeof Atomics?B:Atomics,"%BigInt%":"undefined"==typeof BigInt?B:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?B:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?B:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?B:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":nt,"%eval%":eval,"%EvalError%":rt,"%Float32Array%":"undefined"==typeof Float32Array?B:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?B:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?B:FinalizationRegistry,"%Function%":ct,"%GeneratorFunction%":bt,"%Int8Array%":"undefined"==typeof Int8Array?B:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?B:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?B:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ft&&mt?mt(mt([][Symbol.iterator]())):B,"%JSON%":"object"==typeof JSON?JSON:B,"%Map%":"undefined"==typeof Map?B:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&ft&&mt?mt((new Map)[Symbol.iterator]()):B,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?B:Promise,"%Proxy%":"undefined"==typeof Proxy?B:Proxy,"%RangeError%":st,"%ReferenceError%":ot,"%Reflect%":"undefined"==typeof Reflect?B:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?B:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&ft&&mt?mt((new Set)[Symbol.iterator]()):B,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?B:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ft&&mt?mt(""[Symbol.iterator]()):B,"%Symbol%":ft?Symbol:B,"%SyntaxError%":at,"%ThrowTypeError%":yt,"%TypedArray%":vt,"%TypeError%":lt,"%Uint8Array%":"undefined"==typeof Uint8Array?B:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?B:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?B:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?B:Uint32Array,"%URIError%":ht,"%WeakMap%":"undefined"==typeof WeakMap?B:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?B:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?B:WeakSet};if(mt)try{null.error}catch(Zl){var xt=mt(mt(Zl));wt["%Error.prototype%"]=xt}var St=function t(e){var i;if("%AsyncFunction%"===e)i=pt("async function () {}");else if("%GeneratorFunction%"===e)i=pt("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=pt("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&mt&&(i=mt(r.prototype))}return wt[e]=i,i},kt={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},jt=Z,Tt=it,It=jt.call(Function.call,Array.prototype.concat),Ot=jt.call(Function.apply,Array.prototype.splice),Pt=jt.call(Function.call,String.prototype.replace),At=jt.call(Function.call,String.prototype.slice),Et=jt.call(Function.call,RegExp.prototype.exec),Ct=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Mt=/\\(\\)?/g,zt=function(t,e){var i,n=t;if(Tt(kt,n)&&(n="%"+(i=kt[n])[0]+"%"),Tt(wt,n)){var r=wt[n];if(r===bt&&(r=St(n)),void 0===r&&!e)throw new lt("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new at("intrinsic "+t+" does not exist!")},Lt=function(t,e){if("string"!=typeof t||0===t.length)throw new lt("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new lt('"allowMissing" argument must be a boolean');if(null===Et(/^%?[^%]*%?$/,t))throw new at("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=At(t,0,1),i=At(t,-1);if("%"===e&&"%"!==i)throw new at("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new at("invalid intrinsic syntax, expected opening `%`");var n=[];return Pt(t,Ct,(function(t,e,i,r){n[n.length]=i?Pt(r,Mt,"$1"):e||t})),n}(t),n=i.length>0?i[0]:"",r=zt("%"+n+"%",e),s=r.name,o=r.value,a=!1,l=r.alias;l&&(n=l[0],Ot(i,It([0,1],l)));for(var h=1,c=!0;h<i.length;h+=1){var p=i[h],u=At(p,0,1),d=At(p,-1);if(('"'===u||"'"===u||"`"===u||'"'===d||"'"===d||"`"===d)&&u!==d)throw new at("property names with quotes must have matching quotes");if("constructor"!==p&&c||(a=!0),Tt(wt,s="%"+(n+="."+p)+"%"))o=wt[s];else if(null!=o){if(!(p in o)){if(!e)throw new lt("base intrinsic for "+t+" exists, but the property is not available.");return}if(ut&&h+1>=i.length){var y=ut(o,p);o=(c=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:o[p]}else c=Tt(o,p),o=o[p];c&&!a&&(wt[s]=o)}}return o},Bt=Lt("%Object.defineProperty%",!0)||!1;if(Bt)try{Bt({},"a",{value:1})}catch(Zl){Bt=!1}var Ft=Bt,Wt=Lt("%Object.getOwnPropertyDescriptor%",!0);if(Wt)try{Wt([],"length")}catch(Zl){Wt=null}var Dt=Wt,Rt=Ft,_t=U,Ut=G,Gt=Dt,Nt=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Ut("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new Ut("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Ut("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Ut("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Ut("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Ut("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,r=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,o=arguments.length>6&&arguments[6],a=!!Gt&&Gt(t,e);if(Rt)Rt(t,e,{configurable:null===s&&a?a.configurable:!s,enumerable:null===n&&a?a.enumerable:!n,value:i,writable:null===r&&a?a.writable:!r});else{if(!o&&(n||r||s))throw new _t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}},Ht=Ft,$t=function(){return!!Ht};$t.hasArrayLengthDefineBug=function(){if(!Ht)return null;try{return 1!==Ht([],"length",{value:1}).length}catch(Zl){return!0}};var Vt=$t,qt=F,Kt="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Qt=Object.prototype.toString,Xt=Array.prototype.concat,Yt=Nt,Jt=Vt(),Zt=function(t,e,i,n){if(e in t)if(!0===n){if(t[e]===i)return}else if("function"!=typeof(r=n)||"[object Function]"!==Qt.call(r)||!n())return;var r;Jt?Yt(t,e,i,!0):Yt(t,e,i)},te=function(t,e){var i=arguments.length>2?arguments[2]:{},n=qt(e);Kt&&(n=Xt.call(n,Object.getOwnPropertySymbols(e)));for(var r=0;r<n.length;r+=1)Zt(t,n[r],e[n[r]],i[n[r]])};te.supportsDescriptors=!!Jt;var ee=te,ie={exports:{}},ne=Lt,re=Nt,se=Vt(),oe=Dt,ae=G,le=ne("%Math.floor%"),he=function(t,e){if("function"!=typeof t)throw new ae("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||le(e)!==e)throw new ae("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,r=!0;if("length"in t&&oe){var s=oe(t,"length");s&&!s.configurable&&(n=!1),s&&!s.writable&&(r=!1)}return(n||r||!i)&&(se?re(t,"length",e,!0,!0):re(t,"length",e)),t};!function(t){var e=Z,i=Lt,n=he,r=G,s=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||e.call(o,s),l=Ft,h=i("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new r("a function is required");var i=a(e,o,arguments);return n(i,1+h(0,t.length-(arguments.length-1)),!0)};var c=function(){return a(e,s,arguments)};l?l(t.exports,"apply",{value:c}):t.exports.apply=c}(ie);var ce=ie.exports,pe=Lt,ue=ce,de=ue(pe("String.prototype.indexOf")),ye=function(t,e){var i=pe(t,!!e);return"function"==typeof i&&de(t,".prototype.")>-1?ue(i):i},fe=F,ge=H(),me=ye,be=Object,ve=me("Array.prototype.push"),we=me("Object.prototype.propertyIsEnumerable"),xe=ge?Object.getOwnPropertySymbols:null,Se=function(t,e){if(null==t)throw new TypeError("target must be an object");var i=be(t);if(1===arguments.length)return i;for(var n=1;n<arguments.length;++n){var r=be(arguments[n]),s=fe(r),o=ge&&(Object.getOwnPropertySymbols||xe);if(o)for(var a=o(r),l=0;l<a.length;++l){var h=a[l];we(r,h)&&ve(s,h)}for(var c=0;c<s.length;++c){var p=s[c];if(we(r,p)){var u=r[p];i[p]=u}}}return i},ke=Se,je=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},n=0;n<e.length;++n)i[e[n]]=e[n];var r=Object.assign({},i),s="";for(var o in r)s+=o;return t!==s}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(Zl){return"y"===t[1]}return!1}()?ke:Object.assign:ke},Te=ee,Ie=je,Oe=ee,Pe=Se,Ae=je,Ee=ce.apply(Ae()),Ce=function(t,e){return Ee(Object,arguments)};Oe(Ce,{getPolyfill:Ae,implementation:Pe,shim:function(){var t=Ie();return Te(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var Me=Ce,ze=function(){return"string"==typeof function(){}.name},Le=Object.getOwnPropertyDescriptor;if(Le)try{Le([],"length")}catch(Zl){Le=null}ze.functionsHaveConfigurableNames=function(){if(!ze()||!Le)return!1;var t=Le((function(){}),"name");return!!t&&!!t.configurable};var Be=Function.prototype.bind;ze.boundFunctionsHaveNames=function(){return ze()&&"function"==typeof Be&&""!==function(){}.bind().name};var Fe=ze,We=Nt,De=Vt(),Re=Fe.functionsHaveConfigurableNames(),_e=G,Ue=G,Ge=Object,Ne=function(t,e){if("function"!=typeof t)throw new _e("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!Re||(De?We(t,"name",e,!0,!0):We(t,"name",e)),t}((function(){if(null==this||this!==Ge(this))throw new Ue("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0),He=Ne,$e=ee.supportsDescriptors,Ve=Object.getOwnPropertyDescriptor,qe=function(){if($e&&"gim"===/a/gim.flags){var t=Ve(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return He},Ke=ee.supportsDescriptors,Qe=qe,Xe=Object.getOwnPropertyDescriptor,Ye=Object.defineProperty,Je=TypeError,Ze=Object.getPrototypeOf,ti=/a/,ei=ee,ii=Ne,ni=qe,ri=ce(ni());ei(ri,{getPolyfill:ni,implementation:ii,shim:function(){if(!Ke||!Ze)throw new Je("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Qe(),e=Ze(ti),i=Xe(e,"flags");return i&&i.get===t||Ye(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var si=ri,oi={exports:{}},ai=H,li=function(){return ai()&&!!Symbol.toStringTag},hi=li(),ci=ye("Object.prototype.toString"),pi=function(t){return!(hi&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===ci(t)},ui=function(t){return!!pi(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==ci(t)&&"[object Function]"===ci(t.callee)},di=function(){return pi(arguments)}();pi.isLegacyArguments=ui;var yi=di?pi:ui;const fi=n(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var gi="function"==typeof Map&&Map.prototype,mi=Object.getOwnPropertyDescriptor&&gi?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,bi=gi&&mi&&"function"==typeof mi.get?mi.get:null,vi=gi&&Map.prototype.forEach,wi="function"==typeof Set&&Set.prototype,xi=Object.getOwnPropertyDescriptor&&wi?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Si=wi&&xi&&"function"==typeof xi.get?xi.get:null,ki=wi&&Set.prototype.forEach,ji="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,Ti="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,Ii="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,Oi=Boolean.prototype.valueOf,Pi=Object.prototype.toString,Ai=Function.prototype.toString,Ei=String.prototype.match,Ci=String.prototype.slice,Mi=String.prototype.replace,zi=String.prototype.toUpperCase,Li=String.prototype.toLowerCase,Bi=RegExp.prototype.test,Fi=Array.prototype.concat,Wi=Array.prototype.join,Di=Array.prototype.slice,Ri=Math.floor,_i="function"==typeof BigInt?BigInt.prototype.valueOf:null,Ui=Object.getOwnPropertySymbols,Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Ni="function"==typeof Symbol&&"object"==typeof Symbol.iterator,Hi="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,$i=Object.prototype.propertyIsEnumerable,Vi=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function qi(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||Bi.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-Ri(-t):Ri(t);if(n!==t){var r=String(n),s=Ci.call(e,r.length+1);return Mi.call(r,i,"$&_")+"."+Mi.call(Mi.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Mi.call(e,i,"$&_")}var Ki=fi,Qi=Ki.custom,Xi=en(Qi)?Qi:null;function Yi(t,e,i){var n="double"===(i.quoteStyle||e)?'"':"'";return n+t+n}function Ji(t){return Mi.call(String(t),/"/g,"&quot;")}function Zi(t){return!("[object Array]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}function tn(t){return!("[object RegExp]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}function en(t){if(Ni)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!Gi)return!1;try{return Gi.call(t),!0}catch(Zl){}return!1}var nn=Object.prototype.hasOwnProperty||function(t){return t in this};function rn(t,e){return nn.call(t,e)}function sn(t){return Pi.call(t)}function on(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}function an(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,n="... "+i+" more character"+(i>1?"s":"");return an(Ci.call(t,0,e.maxStringLength),e)+n}return Yi(Mi.call(Mi.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,ln),"single",e)}function ln(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+zi.call(e.toString(16))}function hn(t){return"Object("+t+")"}function cn(t){return t+" { ? }"}function pn(t,e,i,n){return t+" ("+e+") {"+(n?un(i,n):Wi.call(i,", "))+"}"}function un(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+Wi.call(t,","+i)+"\n"+e.prev}function dn(t,e){var i=Zi(t),n=[];if(i){n.length=t.length;for(var r=0;r<t.length;r++)n[r]=rn(t,r)?e(t[r],t):""}var s,o="function"==typeof Ui?Ui(t):[];if(Ni){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in t)rn(t,l)&&(i&&String(Number(l))===l&&l<t.length||Ni&&s["$"+l]instanceof Symbol||(Bi.call(/[^\w$]/,l)?n.push(e(l,t)+": "+e(t[l],t)):n.push(l+": "+e(t[l],t))));if("function"==typeof Ui)for(var h=0;h<o.length;h++)$i.call(t,o[h])&&n.push("["+e(o[h])+"]: "+e(t[o[h]],t));return n}var yn=Lt,fn=ye,gn=function t(e,i,n,s){var o=i||{};if(rn(o,"quoteStyle")&&"single"!==o.quoteStyle&&"double"!==o.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(rn(o,"maxStringLength")&&("number"==typeof o.maxStringLength?o.maxStringLength<0&&o.maxStringLength!==1/0:null!==o.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!rn(o,"customInspect")||o.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(rn(o,"indent")&&null!==o.indent&&"\t"!==o.indent&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(rn(o,"numericSeparator")&&"boolean"!=typeof o.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=o.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return an(e,o);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var h=String(e);return l?qi(e,h):h}if("bigint"==typeof e){var c=String(e)+"n";return l?qi(e,c):c}var p=void 0===o.depth?5:o.depth;if(void 0===n&&(n=0),n>=p&&p>0&&"object"==typeof e)return Zi(e)?"[Array]":"[Object]";var u,d=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=Wi.call(Array(t.indent+1)," ")}return{base:i,prev:Wi.call(Array(e+1),i)}}(o,n);if(void 0===s)s=[];else if(on(s,e)>=0)return"[Circular]";function y(e,i,r){if(i&&(s=Di.call(s)).push(i),r){var a={depth:o.depth};return rn(o,"quoteStyle")&&(a.quoteStyle=o.quoteStyle),t(e,a,n+1,s)}return t(e,o,n+1,s)}if("function"==typeof e&&!tn(e)){var f=function(t){if(t.name)return t.name;var e=Ei.call(Ai.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),g=dn(e,y);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(g.length>0?" { "+Wi.call(g,", ")+" }":"")}if(en(e)){var m=Ni?Mi.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Gi.call(e);return"object"!=typeof e||Ni?m:hn(m)}if((u=e)&&"object"==typeof u&&("undefined"!=typeof HTMLElement&&u instanceof HTMLElement||"string"==typeof u.nodeName&&"function"==typeof u.getAttribute)){for(var b="<"+Li.call(String(e.nodeName)),v=e.attributes||[],w=0;w<v.length;w++)b+=" "+v[w].name+"="+Yi(Ji(v[w].value),"double",o);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+"</"+Li.call(String(e.nodeName))+">"}if(Zi(e)){if(0===e.length)return"[]";var x=dn(e,y);return d&&!function(t){for(var e=0;e<t.length;e++)if(on(t[e],"\n")>=0)return!1;return!0}(x)?"["+un(x,d)+"]":"[ "+Wi.call(x,", ")+" ]"}if(function(t){return!("[object Error]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}(e)){var S=dn(e,y);return"cause"in Error.prototype||!("cause"in e)||$i.call(e,"cause")?0===S.length?"["+String(e)+"]":"{ ["+String(e)+"] "+Wi.call(S,", ")+" }":"{ ["+String(e)+"] "+Wi.call(Fi.call("[cause]: "+y(e.cause),S),", ")+" }"}if("object"==typeof e&&a){if(Xi&&"function"==typeof e[Xi]&&Ki)return Ki(e,{depth:p-n});if("symbol"!==a&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!bi||!t||"object"!=typeof t)return!1;try{bi.call(t);try{Si.call(t)}catch(b){return!0}return t instanceof Map}catch(Zl){}return!1}(e)){var k=[];return vi&&vi.call(e,(function(t,i){k.push(y(i,e,!0)+" => "+y(t,e))})),pn("Map",bi.call(e),k,d)}if(function(t){if(!Si||!t||"object"!=typeof t)return!1;try{Si.call(t);try{bi.call(t)}catch(e){return!0}return t instanceof Set}catch(Zl){}return!1}(e)){var j=[];return ki&&ki.call(e,(function(t){j.push(y(t,e))})),pn("Set",Si.call(e),j,d)}if(function(t){if(!ji||!t||"object"!=typeof t)return!1;try{ji.call(t,ji);try{Ti.call(t,Ti)}catch(b){return!0}return t instanceof WeakMap}catch(Zl){}return!1}(e))return cn("WeakMap");if(function(t){if(!Ti||!t||"object"!=typeof t)return!1;try{Ti.call(t,Ti);try{ji.call(t,ji)}catch(b){return!0}return t instanceof WeakSet}catch(Zl){}return!1}(e))return cn("WeakSet");if(function(t){if(!Ii||!t||"object"!=typeof t)return!1;try{return Ii.call(t),!0}catch(Zl){}return!1}(e))return cn("WeakRef");if(function(t){return!("[object Number]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}(e))return hn(y(Number(e)));if(function(t){if(!t||"object"!=typeof t||!_i)return!1;try{return _i.call(t),!0}catch(Zl){}return!1}(e))return hn(y(_i.call(e)));if(function(t){return!("[object Boolean]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}(e))return hn(Oi.call(e));if(function(t){return!("[object String]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}(e))return hn(y(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==r&&e===r)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==sn(t)||Hi&&"object"==typeof t&&Hi in t)}(e)&&!tn(e)){var T=dn(e,y),I=Vi?Vi(e)===Object.prototype:e instanceof Object||e.constructor===Object,O=e instanceof Object?"":"null prototype",P=!I&&Hi&&Object(e)===e&&Hi in e?Ci.call(sn(e),8,-1):O?"Object":"",A=(I||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(P||O?"["+Wi.call(Fi.call([],P||[],O||[]),": ")+"] ":"");return 0===T.length?A+"{}":d?A+"{"+un(T,d)+"}":A+"{ "+Wi.call(T,", ")+" }"}return String(e)},mn=G,bn=yn("%WeakMap%",!0),vn=yn("%Map%",!0),wn=fn("WeakMap.prototype.get",!0),xn=fn("WeakMap.prototype.set",!0),Sn=fn("WeakMap.prototype.has",!0),kn=fn("Map.prototype.get",!0),jn=fn("Map.prototype.set",!0),Tn=fn("Map.prototype.has",!0),In=function(t,e){for(var i,n=t;null!==(i=n.next);n=i)if(i.key===e)return n.next=i.next,i.next=t.next,t.next=i,i},On=function(){var t,e,i,n={assert:function(t){if(!n.has(t))throw new mn("Side channel does not contain "+gn(t))},get:function(n){if(bn&&n&&("object"==typeof n||"function"==typeof n)){if(t)return wn(t,n)}else if(vn){if(e)return kn(e,n)}else if(i)return function(t,e){var i=In(t,e);return i&&i.value}(i,n)},has:function(n){if(bn&&n&&("object"==typeof n||"function"==typeof n)){if(t)return Sn(t,n)}else if(vn){if(e)return Tn(e,n)}else if(i)return function(t,e){return!!In(t,e)}(i,n);return!1},set:function(n,r){bn&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new bn),xn(t,n,r)):vn?(e||(e=new vn),jn(e,n,r)):(i||(i={key:{},next:null}),function(t,e,i){var n=In(t,e);n?n.value=i:t.next={key:e,next:t.next,value:i}}(i,n,r))}};return n},Pn=it,An=On(),En=G,Cn={assert:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");if(An.assert(t),!Cn.has(t,e))throw new En("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");var i=An.get(t);return i&&i["$"+e]},has:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");var i=An.get(t);return!!i&&Pn(i,"$"+e)},set:function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new En("`O` is not an object");if("string"!=typeof e)throw new En("`slot` must be a string");var n=An.get(t);n||(n={},An.set(t,n)),n["$"+e]=i}};Object.freeze&&Object.freeze(Cn);var Mn,zn=Cn,Ln=SyntaxError,Bn="object"==typeof StopIteration?StopIteration:null,Fn={}.toString,Wn=Array.isArray||function(t){return"[object Array]"==Fn.call(t)},Dn=String.prototype.valueOf,Rn=Object.prototype.toString,_n=li(),Un=function(t){return"string"==typeof t||"object"==typeof t&&(_n?function(t){try{return Dn.call(t),!0}catch(Zl){return!1}}(t):"[object String]"===Rn.call(t))},Gn="function"==typeof Map&&Map.prototype?Map:null,Nn="function"==typeof Set&&Set.prototype?Set:null;Gn||(Mn=function(t){return!1});var Hn=Gn?Map.prototype.has:null,$n=Nn?Set.prototype.has:null;Mn||Hn||(Mn=function(t){return!1});var Vn,qn=Mn||function(t){if(!t||"object"!=typeof t)return!1;try{if(Hn.call(t),$n)try{$n.call(t)}catch(Zl){return!0}return t instanceof Gn}catch(Zl){}return!1},Kn="function"==typeof Map&&Map.prototype?Map:null,Qn="function"==typeof Set&&Set.prototype?Set:null;Qn||(Vn=function(t){return!1});var Xn=Kn?Map.prototype.has:null,Yn=Qn?Set.prototype.has:null;Vn||Yn||(Vn=function(t){return!1});var Jn=Vn||function(t){if(!t||"object"!=typeof t)return!1;try{if(Yn.call(t),Xn)try{Xn.call(t)}catch(Zl){return!0}return t instanceof Qn}catch(Zl){}return!1},Zn=yi,tr=function(t){if(!Bn)throw new Ln("this environment lacks StopIteration");zn.set(t,"[[Done]]",!1);var e={next:function(){var t=zn.get(this,"[[Iterator]]"),e=zn.get(t,"[[Done]]");try{return{done:e,value:e?void 0:t.next()}}catch(Zl){if(zn.set(t,"[[Done]]",!0),Zl!==Bn)throw Zl;return{done:!0,value:void 0}}}};return zn.set(e,"[[Iterator]]",t),e};if(q()||H()){var er=Symbol.iterator;oi.exports=function(t){return null!=t&&void 0!==t[er]?t[er]():Zn(t)?Array.prototype[er].call(t):void 0}}else{var ir=Wn,nr=Un,rr=Lt,sr=rr("%Map%",!0),or=rr("%Set%",!0),ar=ye,lr=ar("Array.prototype.push"),hr=ar("String.prototype.charCodeAt"),cr=ar("String.prototype.slice"),pr=function(t){var e=0;return{next:function(){var i,n=e>=t.length;return n||(i=t[e],e+=1),{done:n,value:i}}}},ur=function(t,e){if(ir(t)||Zn(t))return pr(t);if(nr(t)){var i=0;return{next:function(){var e=function(t,e){if(e+1>=t.length)return e+1;var i=hr(t,e);if(i<55296||i>56319)return e+1;var n=hr(t,e+1);return n<56320||n>57343?e+1:e+2}(t,i),n=cr(t,i,e);return i=e,{done:e>t.length,value:n}}}}return e&&void 0!==t["_es6-shim iterator_"]?t["_es6-shim iterator_"]():void 0};if(sr||or){var dr=qn,yr=Jn,fr=ar("Map.prototype.forEach",!0),gr=ar("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var mr=ar("Map.prototype.iterator",!0),br=ar("Set.prototype.iterator",!0);var vr=ar("Map.prototype.@@iterator",!0)||ar("Map.prototype._es6-shim iterator_",!0),wr=ar("Set.prototype.@@iterator",!0)||ar("Set.prototype._es6-shim iterator_",!0);oi.exports=function(t){return function(t){if(dr(t)){if(mr)return tr(mr(t));if(vr)return vr(t);if(fr){var e=[];return fr(t,(function(t,i){lr(e,[i,t])})),pr(e)}}if(yr(t)){if(br)return tr(br(t));if(wr)return wr(t);if(gr){var i=[];return gr(t,(function(t){lr(i,t)})),pr(i)}}}(t)||ur(t)}}else oi.exports=function(t){if(null!=t)return ur(t,!0)}}var xr=oi.exports,Sr=function(t){return t!=t},kr=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!Sr(t)||!Sr(e))},jr=kr,Tr=function(){return"function"==typeof Object.is?Object.is:jr},Ir=Tr,Or=ee,Pr=ee,Ar=kr,Er=Tr,Cr=ce(Er(),Object);Pr(Cr,{getPolyfill:Er,implementation:Ar,shim:function(){var t=Ir();return Or(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var Mr,zr,Lr,Br,Fr=Cr,Wr=ce,Dr=ye,Rr=Lt("%ArrayBuffer%",!0),_r=Dr("ArrayBuffer.prototype.byteLength",!0),Ur=Dr("Object.prototype.toString"),Gr=!!Rr&&!_r&&new Rr(0).slice,Nr=!!Gr&&Wr(Gr),Hr=_r||Nr?function(t){if(!t||"object"!=typeof t)return!1;try{return _r?_r(t):Nr(t,0),!0}catch(Zl){return!1}}:Rr?function(t){return"[object ArrayBuffer]"===Ur(t)}:function(t){return!1},$r=Date.prototype.getDay,Vr=Object.prototype.toString,qr=li(),Kr=ye,Qr=li();if(Qr){Mr=Kr("Object.prototype.hasOwnProperty"),zr=Kr("RegExp.prototype.exec"),Lr={};var Xr=function(){throw Lr};Br={toString:Xr,valueOf:Xr},"symbol"==typeof Symbol.toPrimitive&&(Br[Symbol.toPrimitive]=Xr)}var Yr=Kr("Object.prototype.toString"),Jr=Object.getOwnPropertyDescriptor,Zr=Qr?function(t){if(!t||"object"!=typeof t)return!1;var e=Jr(t,"lastIndex");if(!e||!Mr(e,"value"))return!1;try{zr(t,Br)}catch(Zl){return Zl===Lr}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===Yr(t)},ts=ye("SharedArrayBuffer.prototype.byteLength",!0),es=ts?function(t){if(!t||"object"!=typeof t)return!1;try{return ts(t),!0}catch(Zl){return!1}}:function(t){return!1},is=Number.prototype.toString,ns=Object.prototype.toString,rs=li(),ss=ye,os=ss("Boolean.prototype.toString"),as=ss("Object.prototype.toString"),ls=li(),hs={exports:{}},cs=Object.prototype.toString;if(q()){var ps=Symbol.prototype.toString,us=/^Symbol\(.*\)$/;hs.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==cs.call(t))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&us.test(ps.call(t))}(t)}catch(Zl){return!1}}}else hs.exports=function(t){return!1};var ds=hs.exports,ys={exports:{}},fs="undefined"!=typeof BigInt&&BigInt;if("function"==typeof fs&&"function"==typeof BigInt&&"bigint"==typeof fs(42)&&"bigint"==typeof BigInt(42)){var gs=BigInt.prototype.valueOf;ys.exports=function(t){return null!=t&&"boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t&&"symbol"!=typeof t&&"function"!=typeof t&&("bigint"==typeof t||function(t){try{return gs.call(t),!0}catch(Zl){}return!1}(t))}}else ys.exports=function(t){return!1};var ms,bs=ys.exports,vs=Un,ws=ds,xs=bs,Ss="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,ks="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;Ss||(ms=function(t){return!1});var js=Ss?Ss.prototype.has:null,Ts=ks?ks.prototype.has:null;ms||js||(ms=function(t){return!1});var Is=ms||function(t){if(!t||"object"!=typeof t)return!1;try{if(js.call(t,js),Ts)try{Ts.call(t,Ts)}catch(Zl){return!0}return t instanceof Ss}catch(Zl){}return!1},Os={exports:{}},Ps=ye,As=Lt("%WeakSet%",!0),Es=Ps("WeakSet.prototype.has",!0);if(Es){var Cs=Ps("WeakMap.prototype.has",!0);Os.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(Es(t,Es),Cs)try{Cs(t,Cs)}catch(Zl){return!0}return t instanceof As}catch(Zl){}return!1}}else Os.exports=function(t){return!1};var Ms,zs,Ls=Os.exports,Bs=qn,Fs=Jn,Ws=Is,Ds=Ls,Rs=Function.prototype.toString,_s="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof _s&&"function"==typeof Object.defineProperty)try{Ms=Object.defineProperty({},"length",{get:function(){throw zs}}),zs={},_s((function(){throw 42}),null,Ms)}catch(th){th!==zs&&(_s=null)}else _s=null;var Us=/^\s*class\b/,Gs=function(t){try{var e=Rs.call(t);return Us.test(e)}catch(Zl){return!1}},Ns=function(t){try{return!Gs(t)&&(Rs.call(t),!0)}catch(Zl){return!1}},Hs=Object.prototype.toString,$s="function"==typeof Symbol&&!!Symbol.toStringTag,Vs=!(0 in[,]),qs=function(){return!1};if("object"==typeof document){var Ks=document.all;Hs.call(Ks)===Hs.call(document.all)&&(qs=function(t){if((Vs||!t)&&(void 0===t||"object"==typeof t))try{var e=Hs.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(Zl){}return!1})}var Qs=_s?function(t){if(qs(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{_s(t,null,Ms)}catch(Zl){if(Zl!==zs)return!1}return!Gs(t)&&Ns(t)}:function(t){if(qs(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if($s)return Ns(t);if(Gs(t))return!1;var e=Hs.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&Ns(t)},Xs=Object.prototype.toString,Ys=Object.prototype.hasOwnProperty,Js=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Zs="undefined"==typeof globalThis?r:globalThis,to=function(t,e,i){if(!Qs(e))throw new TypeError("iterator must be a function");var n;arguments.length>=3&&(n=i),"[object Array]"===Xs.call(t)?function(t,e,i){for(var n=0,r=t.length;n<r;n++)Ys.call(t,n)&&(null==i?e(t[n],n,t):e.call(i,t[n],n,t))}(t,e,n):"string"==typeof t?function(t,e,i){for(var n=0,r=t.length;n<r;n++)null==i?e(t.charAt(n),n,t):e.call(i,t.charAt(n),n,t)}(t,e,n):function(t,e,i){for(var n in t)Ys.call(t,n)&&(null==i?e(t[n],n,t):e.call(i,t[n],n,t))}(t,e,n)},eo=ce,io=ye,no=Dt,ro=io("Object.prototype.toString"),so=li(),oo="undefined"==typeof globalThis?r:globalThis,ao=function(){for(var t=[],e=0;e<Js.length;e++)"function"==typeof Zs[Js[e]]&&(t[t.length]=Js[e]);return t}(),lo=io("String.prototype.slice"),ho=Object.getPrototypeOf,co=io("Array.prototype.indexOf",!0)||function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return i;return-1},po={__proto__:null};to(ao,so&&no&&ho?function(t){var e=new oo[t];if(Symbol.toStringTag in e){var i=ho(e),n=no(i,Symbol.toStringTag);if(!n){var r=ho(i);n=no(r,Symbol.toStringTag)}po["$"+t]=eo(n.get)}}:function(t){var e=new oo[t],i=e.slice||e.set;i&&(po["$"+t]=eo(i))});var uo=ye("ArrayBuffer.prototype.byteLength",!0),yo=Hr,fo=Me,go=ye,mo=si,bo=Lt,vo=xr,wo=On,xo=Fr,So=yi,ko=Wn,jo=Hr,To=function(t){return"object"==typeof t&&null!==t&&(qr?function(t){try{return $r.call(t),!0}catch(Zl){return!1}}(t):"[object Date]"===Vr.call(t))},Io=Zr,Oo=es,Po=F,Ao=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t?null:vs(t)?"String":function(t){return"number"==typeof t||"object"==typeof t&&(rs?function(t){try{return is.call(t),!0}catch(Zl){return!1}}(t):"[object Number]"===ns.call(t))}(t)?"Number":function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(ls&&Symbol.toStringTag in t?function(t){try{return os(t),!0}catch(Zl){return!1}}(t):"[object Boolean]"===as(t))}(t)?"Boolean":ws(t)?"Symbol":xs(t)?"BigInt":void 0},Eo=function(t){if(t&&"object"==typeof t){if(Bs(t))return"Map";if(Fs(t))return"Set";if(Ws(t))return"WeakMap";if(Ds(t))return"WeakSet"}return!1},Co=function(t){if(!t||"object"!=typeof t)return!1;if(!so){var e=lo(ro(t),8,-1);return co(ao,e)>-1?e:"Object"===e&&function(t){var e=!1;return to(po,(function(i,n){if(!e)try{i(t),e=lo(n,1)}catch(Zl){}})),e}(t)}return no?function(t){var e=!1;return to(po,(function(i,n){if(!e)try{"$"+i(t)===n&&(e=lo(n,1))}catch(Zl){}})),e}(t):null},Mo=function(t){return yo(t)?uo?uo(t):t.byteLength:NaN},zo=go("SharedArrayBuffer.prototype.byteLength",!0),Lo=go("Date.prototype.getTime"),Bo=Object.getPrototypeOf,Fo=go("Object.prototype.toString"),Wo=bo("%Set%",!0),Do=go("Map.prototype.has",!0),Ro=go("Map.prototype.get",!0),_o=go("Map.prototype.size",!0),Uo=go("Set.prototype.add",!0),Go=go("Set.prototype.delete",!0),No=go("Set.prototype.has",!0),Ho=go("Set.prototype.size",!0);function $o(t,e,i,n){for(var r,s=vo(t);(r=s.next())&&!r.done;)if(Xo(e,r.value,i,n))return Go(t,r.value),!0;return!1}function Vo(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function qo(t,e,i,n,r,s){var o=Vo(i);if(null!=o)return o;var a=Ro(e,o),l=fo({},r,{strict:!1});return!(void 0===a&&!Do(e,o)||!Xo(n,a,l,s))&&!Do(t,o)&&Xo(n,a,l,s)}function Ko(t,e,i){var n=Vo(i);return null!=n?n:No(e,n)&&!No(t,n)}function Qo(t,e,i,n,r,s){for(var o,a,l=vo(t);(o=l.next())&&!o.done;)if(Xo(i,a=o.value,r,s)&&Xo(n,Ro(e,a),r,s))return Go(t,a),!0;return!1}function Xo(t,e,i,n){var r=i||{};if(r.strict?xo(t,e):t===e)return!0;if(Ao(t)!==Ao(e))return!1;if(!t||!e||"object"!=typeof t&&"object"!=typeof e)return r.strict?xo(t,e):t==e;var s,o=n.has(t),a=n.has(e);if(o&&a){if(n.get(t)===n.get(e))return!0}else s={};return o||n.set(t,s),a||n.set(e,s),function(t,e,i,n){var r,s;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Fo(t)!==Fo(e))return!1;if(So(t)!==So(e))return!1;if(ko(t)!==ko(e))return!1;var o=t instanceof Error,a=e instanceof Error;if(o!==a)return!1;if((o||a)&&(t.name!==e.name||t.message!==e.message))return!1;var l=Io(t),h=Io(e);if(l!==h)return!1;if((l||h)&&(t.source!==e.source||mo(t)!==mo(e)))return!1;var c=To(t),p=To(e);if(c!==p)return!1;if((c||p)&&Lo(t)!==Lo(e))return!1;if(i.strict&&Bo&&Bo(t)!==Bo(e))return!1;var u=Co(t),d=Co(e);if(u!==d)return!1;if(u||d){if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var y=Yo(t),f=Yo(e);if(y!==f)return!1;if(y||f){if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var g=jo(t),m=jo(e);if(g!==m)return!1;if(g||m)return Mo(t)===Mo(e)&&"function"==typeof Uint8Array&&Xo(new Uint8Array(t),new Uint8Array(e),i,n);var b=Oo(t),v=Oo(e);if(b!==v)return!1;if(b||v)return zo(t)===zo(e)&&"function"==typeof Uint8Array&&Xo(new Uint8Array(t),new Uint8Array(e),i,n);if(typeof t!=typeof e)return!1;var w=Po(t),x=Po(e);if(w.length!==x.length)return!1;for(w.sort(),x.sort(),r=w.length-1;r>=0;r--)if(w[r]!=x[r])return!1;for(r=w.length-1;r>=0;r--)if(!Xo(t[s=w[r]],e[s],i,n))return!1;var S=Eo(t),k=Eo(e);return S===k&&("Set"===S||"Set"===k?function(t,e,i,n){if(Ho(t)!==Ho(e))return!1;for(var r,s,o,a=vo(t),l=vo(e);(r=a.next())&&!r.done;)if(r.value&&"object"==typeof r.value)o||(o=new Wo),Uo(o,r.value);else if(!No(e,r.value)){if(i.strict)return!1;if(!Ko(t,e,r.value))return!1;o||(o=new Wo),Uo(o,r.value)}if(o){for(;(s=l.next())&&!s.done;)if(s.value&&"object"==typeof s.value){if(!$o(o,s.value,i.strict,n))return!1}else if(!i.strict&&!No(t,s.value)&&!$o(o,s.value,i.strict,n))return!1;return 0===Ho(o)}return!0}(t,e,i,n):"Map"!==S||function(t,e,i,n){if(_o(t)!==_o(e))return!1;for(var r,s,o,a,l,h,c=vo(t),p=vo(e);(r=c.next())&&!r.done;)if(a=r.value[0],l=r.value[1],a&&"object"==typeof a)o||(o=new Wo),Uo(o,a);else if(void 0===(h=Ro(e,a))&&!Do(e,a)||!Xo(l,h,i,n)){if(i.strict)return!1;if(!qo(t,e,a,l,i,n))return!1;o||(o=new Wo),Uo(o,a)}if(o){for(;(s=p.next())&&!s.done;)if(a=s.value[0],h=s.value[1],a&&"object"==typeof a){if(!Qo(o,t,a,h,i,n))return!1}else if(!(i.strict||t.has(a)&&Xo(Ro(t,a),h,i,n)||Qo(o,t,a,h,fo({},i,{strict:!1}),n)))return!1;return 0===Ho(o)}return!0}(t,e,i,n))}(t,e,r,n)}function Yo(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0]||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))}const Jo=s((function(t,e,i){return Xo(t,e,i,wo())}));var Zo=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t[t.Prop=4]="Prop",t))(Zo||{}),ta=(t=>(t[t.Underground=0]="Underground",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.LakeEast=6]="LakeEast",t[t.TownNorth=7]="TownNorth",t[t.ClockSquare=8]="ClockSquare",t[t.ClockSquareNorth=9]="ClockSquareNorth",t[t.ClockEntrance=10]="ClockEntrance",t[t.ClockStairs=11]="ClockStairs",t[t.ClockTop=12]="ClockTop",t[t.TownWest=13]="TownWest",t[t.MansionOutside=14]="MansionOutside",t[t.MansionEntrance=15]="MansionEntrance",t[t.MansionExit=16]="MansionExit",t[t.LabEntrance=17]="LabEntrance",t[t.LabExit=18]="LabExit",t))(ta||{}),ea=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t[t.Key=2]="Key",t[t.HerbRed=3]="HerbRed",t[t.HerbGreen=4]="HerbGreen",t[t.HerbBlue=5]="HerbBlue",t[t.Potion=6]="Potion",t))(ea||{}),ia=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t[t.InvestigateTownWest=2]="InvestigateTownWest",t[t.ExploreLab=3]="ExploreLab",t))(ia||{}),na=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.ClockTower=4]="ClockTower",t))(na||{}),ra=(t=>(t[t.Sphinx=0]="Sphinx",t))(ra||{}),sa=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.ForestMazeSolved=1]="ForestMazeSolved",t[t.SphinxRiddleSolved=2]="SphinxRiddleSolved",t[t.MetTheMayor=3]="MetTheMayor",t[t.ClockFirstGear=4]="ClockFirstGear",t[t.AlchemyLabFound=5]="AlchemyLabFound",t[t.AlchemySetFixed=6]="AlchemySetFixed",t))(sa||{}),oa=(t=>(t[t.LabHatch=0]="LabHatch",t[t.LabBook=1]="LabBook",t[t.AlchemySet=2]="AlchemySet",t[t.LabBookshelf1=3]="LabBookshelf1",t[t.LabBookshelf2=4]="LabBookshelf2",t[t.LabBookshelf3=5]="LabBookshelf3",t[t.LabPotionShelf1=6]="LabPotionShelf1",t[t.MansionPicture=7]="MansionPicture",t[t.MansionHole=8]="MansionHole",t))(oa||{});d.dayMinutes,i.GameObjects.Container;class aa extends i.GameObjects.Text{constructor(t){super(t,d.width/2,d.height-50,"",w),this.setOrigin(.5).setBackgroundColor("#"+m.Black).setPadding(10,5).setAlign("center").setAlpha(.9).setScrollFactor(0).setDepth(f.Overlay).setVisible(!1),t.add.existing(this)}}var la=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t))(la||{});class ha{constructor(t){e(this,"scene"),e(this,"keys",{0:!1,1:!1,2:!1,3:!1,4:!1,5:!1}),this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W"),this.listener(2,"A"),this.listener(1,"S"),this.listener(3,"D"),this.listener(4,"SPACE"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE")}listener(t,e){var i,n;null==(i=this.scene.input.keyboard)||i.on(`keydown-${e}`,(()=>this.keys[t]=!0)),null==(n=this.scene.input.keyboard)||n.on(`keyup-${e}`,(()=>this.keys[t]=!1))}resetKeys(){this.keys[0]=!1,this.keys[1]=!1,this.keys[2]=!1,this.keys[3]=!1,this.keys[4]=!1,this.keys[5]=!1}}const ca=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[na.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[na.Stranger]:["The sphinx’s riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[na.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[na.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[na.Inventor]:["The sphinx’s riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[na.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, don’t they?","They move, disappear, and seem to fly without wings."]}}];function pa(t){return t instanceof Il?Na(t)%ca.length:0}function ua(t,e){const i=pa(t);return ca[i].hints[e]}const da={[oa.LabHatch]:{x:-1910,y:640},[oa.LabBook]:{x:300,y:1630,image:"book"},[oa.AlchemySet]:{x:-1650,y:1600,image:"alchemy_empty",skipLighting:!0,particles:{scale:{min:.05,max:.15},speed:{min:30,max:120},alpha:{values:[0,.5,0]},gravityY:100,lifespan:{min:250,max:500},emitting:!1,stopAfter:60}},[oa.LabBookshelf1]:{x:-1025,y:1700},[oa.LabBookshelf2]:{x:-290,y:1700},[oa.LabBookshelf3]:{x:-115,y:1700},[oa.LabPotionShelf1]:{x:-790,y:1700},[oa.MansionPicture]:{x:-1233,y:-580,scale:1.2,angle:5,image:"picture",origin:{x:0,y:0}},[oa.MansionHole]:{x:-1870,y:-490}},ya={[na.Inventor]:[{messages:["There are rumors of an abandoned mansion west of the town.","Some say it is haunted and dark magic lurks within."],conditions:{activeQuest:ia.InvestigateTownWest}},{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:ea.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(ia.ForestGear,!0)}},{messages:t=>ua(t.scene,na.Inventor),conditions:{activeQuest:ia.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:ea.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench, but you’ll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(sa.FixTheClock),t.inventory.addItem({type:ea.Wrench,used:!1})}}],[na.Stranger]:[{messages:["You heard of the mansion to the west? It was abandoned many years ago.","There is a rumor of an alchemy lab hidden somewhere nearby, but I have been searching for years and have found not even a single potion."],conditions:{activeQuest:ia.InvestigateTownWest}},{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:ea.Gear1}},{messages:t=>ua(t.scene,na.Stranger),conditions:{activeQuest:ia.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:ea.Wrench},onCompleted:t=>{t.quests.addQuest({id:ia.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[na.Sphinx]:[{messages:t=>function(t){const e=pa(t);return[ca[e].question]}(t.scene),options:t=>function(t){const e=pa(t),i=[...ca[e].options].sort((()=>Math.random()-.5));return i.push("I don’t know"),i}(t.scene),conditions:{activeQuest:ia.SphinxRiddle},onSelected:function(t,e,i){t===function(t){const e=pa(t);return ca[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(ia.SphinxRiddle,!0),t.journal.addEntry(sa.SphinxRiddleSolved)}},i):"I don’t know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},i):e.message.setDialog({messages:["That is not correct. Do not return."]},i)}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:ia.SphinxRiddle,completed:!1})}}],[na.Mayor]:[{messages:["The minute hand on the clock is spinning again.","It looks like it’s missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:sa.ClockFirstGear},onCompleted:t=>{t.quests.addQuest({id:ia.InvestigateTownWest,completed:!1})}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:sa.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(sa.MetTheMayor)}}],[na.ClockTower]:[{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:sa.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Let’s see what happens when we add the first gear. You tighten the gear into place.","[CREAKING NOISE]","The clock tower is starting to partially move again. It looks like it’s missing two more gears."],conditions:{hasItem:ea.Gear1},onCompleted:t=>{t.inventory.removeItem(ea.Gear1),t.journal.addEntry(sa.ClockFirstGear)}}]},fa={[ea.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}]},ga={[oa.LabHatch]:[{messages:["Let me see if I can open this hatch.","The rusty key fits!","[CREAKING NOISE]","Alright, let’s see what is down there!"],conditions:{hasItem:ea.Key},onCompleted:(t,e)=>{null==e||e.destroy(),console.log(e),t.inventory.removeItem(ea.Key),t.journal.addEntry(sa.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[oa.LabBook]:[{messages:["I should speak to the mysterious stranger about this lab and the potion I brewed."],conditions:{hasItem:ea.Potion}},{messages:["With the alchemy set fixed, I should be able to recreate the experiment.","I will need to find three ingredients according to this.","I need to find a red herb, a green herb, and a blue herb."],conditions:{journalEntry:sa.AlchemySetFixed},onCompleted:t=>{const e=t.scene;e.interactiveObjects.add(new ka(e,ea.HerbRed,t)),e.interactiveObjects.add(new ka(e,ea.HerbGreen,t)),e.interactiveObjects.add(new ka(e,ea.HerbBlue,t))}},{messages:["Maybe I can find more information in the lab."],conditions:{activeQuest:ia.ExploreLab}},{messages:["This lab journal contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:t=>{t.quests.addQuest({id:ia.ExploreLab,completed:!1})}}],[oa.AlchemySet]:[{messages:["There’s nothing more that I can do here."],conditions:{hasItem:ea.Potion}},{messages:["Now we have all of the ingredients.","Now I should be able to recreate the experiment.","According to the book..."],conditions:{hasUsedItem:ea.HerbBlue},onCompleted:function(t,e){const i=t.scene;t.inventory.removeItem(ea.HerbBlue),t.active=!1,xa(i,500,(()=>{i.time.delayedCall(700,(()=>{var n;null==e||e.setTexture("alchemy_full"),null==(n=null==e?void 0:e.particles)||n.setConfig({...da[oa.AlchemySet].particles,tint:[6684791],x:30}).start(),wa(i,1500,(()=>{t.message.setDialog({messages:["I have created the potion mentioned in the old journal.","I should bring it to the mysterious stranger to see if they know how to use it."],onCompleted:(t,e)=>{t.inventory.addItem({type:ea.Potion,used:!1}),t.quests.updateExistingQuest(ia.ExploreLab,!0),null==e||e.setTexture("alchemy_empty"),t.active=!0}},e,"player_portrait")}))}))}))}},{messages:["The Blue Plumed Frond is last."],conditions:{hasItem:ea.HerbBlue,hasUsedItem:ea.HerbRed},onCompleted:(t,e)=>{var i;t.inventory.removeItem(ea.HerbBlue),null==e||e.setTexture("alchemy_blue"),null==(i=null==e?void 0:e.particles)||i.setConfig({...da[oa.AlchemySet].particles,tint:[170],x:-5}).start()}},{messages:["The Crimson Starbloom comes next."],conditions:{hasItem:ea.HerbRed,hasUsedItem:ea.HerbGreen},onCompleted:(t,e)=>{var i;t.inventory.removeItem(ea.HerbRed),null==e||e.setTexture("alchemy_red"),null==(i=null==e?void 0:e.particles)||i.setConfig({...da[oa.AlchemySet].particles,tint:[11141120],x:-20}).start()}},{messages:["The Green Writhewood goes in first."],conditions:{hasItem:ea.HerbGreen},onCompleted:(t,e)=>{var i;t.inventory.removeItem(ea.HerbGreen),null==e||e.setTexture("alchemy_green"),null==(i=null==e?void 0:e.particles)||i.setConfig({...da[oa.AlchemySet].particles,tint:[43520],x:-35}).start()}},{messages:["Maybe the journal has more information about using this alchemy set."],conditions:{journalEntry:sa.AlchemySetFixed}},{messages:["This alchemy set looks like the one in the journal.","If I can figure out how the set connects together, I might be able to recreate the experiment."],conditions:{activeQuest:ia.ExploreLab},onCompleted:t=>{const e=t.scene;e.gamepad.setVisible(!1),e.scene.pause(),e.scene.launch("PipesDialog",{player:t})}},{messages:["I shouldn’t touch this without knowing what it does."]}],[oa.LabBookshelf1]:[{messages:['[Secrets of the Silver Transmutation]\n"Silver, the mirror of the soul, can be yielded from common materials. Begin with a lead base, cleanse it with the tears of a willow, and chant thrice under a new moon. Such processes, though fraught with danger, promise immense reward. Meticulous preparation of the material is crucial."','"Among these pages lie safeguards against volatile spirits and the precise lunar phases essential for success. Here are protective circles and counter-spells to be used should spirits prove malevolent. This knowledge has been passed down and refined for safety."'],conditions:{activeQuest:ia.ExploreLab}}],[oa.LabBookshelf2]:[{messages:['[Whispering Woods: A Compendium]\n"The sentient trees of Eldergrove are not myths; their trunks groan with ancient wisdom. To engage them, perform the Ritual of Leaves, using moonlit water and rare herbs, along with whispered incantations passed down by forest guardians."','"Notes on the rare Blue Moonflower, whose petals glow ghostly and unlock forest languages, are also included. Its bloom is brief, and harvesting must be timed at midnight to retain its properties. The chapter concludes with a discussion on plant symbiosis with Eldertrees."'],conditions:{activeQuest:ia.ExploreLab}}],[oa.LabBookshelf3]:[{messages:['[The Essence of Fire: Ignite and Control]\n"Mastering fire requires strength of will and profound respect for its power. Here, summoning circles and incantations to call forth fire spirits are detailed. Each summoning demands a tribute of phoenix ash. The endeavor is perilous, as spirits may lash out if provoked."','"The tome also discusses methods to quell flames should they rise against the summoner. Included are the chant of suppression and a dousing mixture from elemental waters and frost-bitten herbs. These countermeasures are vital for maintaining control over summoned entities."'],conditions:{activeQuest:ia.ExploreLab}}],[oa.LabPotionShelf1]:[{messages:['Hm, this is an interesting collection. What’s this "Elixir of Luminescence"? Could light up some dark corners. And "Brew of Bravery"... might make me bold enough to face a dragon, or foolish enough to try. What about "Draught of the Depths"—sounds like it could show me treasures or drown me in visions. Better not risk it; these might just burn me to a crisp!'],conditions:{activeQuest:ia.ExploreLab}}],[oa.MansionPicture]:[{messages:["An abstract picture of blocks.","Wait a moment, something is behind this picture","[CREAK]"],onCompleted:(t,e)=>{null==e||e.scene.tweens.add({targets:e,angle:97,duration:1500})},conditions:{hasItem:ea.Potion}},{messages:["An abstract picture of blocks."]}],[oa.MansionHole]:[{messages:["Literally a hole in the wall."]}]};function ma(t,e,i){for(const n of t){const{conditions:t}=n,r=[];if(void 0!==(null==t?void 0:t.hasItem)&&r.push(Ba(e.inventory.inventory,t.hasItem)),void 0!==(null==t?void 0:t.hasUsedItem)&&r.push(Fa(e.inventory.inventory,t.hasUsedItem)),void 0!==(null==t?void 0:t.completedQuest)&&r.push(Da(e.quests.quests,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&r.push(Wa(e.quests.quests,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&r.push(Ra(e.journal.journal,t.journalEntry)),(null==t?void 0:t.custom)&&r.push(t.custom(e,i)),null==t?void 0:t.invert){if(null==t?void 0:t.or){if(r.some((t=>!t)))return n}else if(r.every((t=>!t)))return n;return}if(null==t?void 0:t.or){if(r.some((t=>t)))return n}else if(r.every((t=>t)))return n}}const ba={[ea.Wrench]:{x:0,y:0,image:"wrench",name:"Old Wrench"},[ea.Gear1]:{x:5120,y:915,image:"gear",name:"Shiny Gear"},[ea.Key]:{x:-1750,y:-420,image:"key",name:"Rusty Key"},[ea.HerbRed]:{x:-200,y:1730,image:"herb_red",name:"Blue Plumed Frond"},[ea.HerbGreen]:{x:-260,y:1730,image:"herb_green",name:"Green Writhewood"},[ea.HerbBlue]:{x:-320,y:1730,image:"herb_blue",name:"Crimson Starbloom"},[ea.Potion]:{x:0,y:0,image:"potion",name:"Strange Potion"}},va=function(t){const e=i.Display.Color.ColorToRGBA(t);return new i.Display.Color(e.r,e.g,e.b,e.a)}(b(m.Background));function wa(t,e,i){t.cameras.main.fadeIn(e,va.red,va.green,va.blue,((t,e)=>{e>=1&&i&&i()}))}function xa(t,e,i){t.cameras.main.fadeOut(e,va.red,va.green,va.blue,((t,e)=>{e>=1&&i&&i()}))}function Sa(t,e,n){return!!(e.inventory.initialized&&e.quests.initialized&&e.journal.initialized)&&i.Math.Distance.BetweenPointsSquared(t,e)<(n||1e3)**2}class ka extends i.Physics.Arcade.Image{constructor(t,i,n){const{x:r,y:s,image:o}=ba[i];super(t,r,s,o),e(this,"itemType"),e(this,"player"),e(this,"particles"),e(this,"light"),e(this,"initialized",!1),this.itemType=i,this.player=n,this.setScale(.35).setDepth(f.Items),Ha(this,ba[i])}lazyInit(t){(t||!this.initialized&&Sa(this,this.player))&&(this.player.inventory.inventory.find((t=>t.type===this.itemType))?this.destroy():(this.scene.add.existing(this),this.scene.physics.add.existing(this),d.debug&&this.setInteractive({draggable:!0}),this.particles=this.scene.add.particles(this.x,this.y,"warp",{scale:{start:0,end:.9},alpha:{start:.8,end:0},delay:500,lifespan:1500,maxAliveParticles:1}),d.debug?this.light=new g(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2),this.initialized=!0))}onInteract(t){if(t[la.Continue]){this.player.inventory.addItem({type:this.itemType,used:!1}),this.destroy();const t=ma(fa[this.itemType]||[],this.player,this);return t&&this.player.message.setDialog(t,this,"player_portrait"),Zo.Item}return Zo.None}destroy(t){var e,i,n;null==(e=this.particles)||e.destroy(),this.light instanceof g?this.light.destroy():null==(n=null==(i=this.scene)?void 0:i.lights)||n.removeLight(this.light),super.destroy(t)}getButtonPrompt(){return[`Pick Up ${ba[this.itemType].name}`,"Press [CONTINUE]"]}update(){this.lazyInit()}}const ja=2*Math.PI;class Ta extends i.GameObjects.Graphics{constructor(t){super(t),e(this,"angle1",0),e(this,"angle2",1),e(this,"angle3",4),e(this,"update1",!1),e(this,"update2",!1),e(this,"update3",!1),t.add.existing(this),this.setPosition(842,-2107),this.setDepth(f.Npcs)}update(t){this.update1&&(this.angle1=ja*(t/6e4)*20),this.update2&&(this.angle2=ja*(t/36e5)*20),this.update3&&(this.angle3=ja*(t/432e5)*20),this.clear(),this.lineStyle(6,b(m.Night)),this.lineBetween(0,0,50*Math.cos(this.angle1),50*Math.sin(this.angle1)),this.lineBetween(0,0,40*Math.cos(this.angle2),40*Math.sin(this.angle2)),this.lineBetween(0,0,25*Math.cos(this.angle3),25*Math.sin(this.angle3)),this.lineStyle(4,b(m.Black));for(let e=0;e<12;e++){const t=ja*(e/12),i=50*Math.cos(t),n=50*Math.sin(t);this.lineBetween(i,n,1.5*i,1.5*n)}}}class Ia extends i.Physics.Arcade.Image{constructor(t,n,r){const{x:s,y:o,image:a,initOnStart:l}=qa[n];super(t,s,o,a),e(this,"npcType"),e(this,"player"),e(this,"light"),e(this,"particles"),e(this,"lastPos",new i.Math.Vector2),e(this,"clock"),e(this,"initialized",!1),this.npcType=n,this.player=r,this.setDepth(f.Npcs),"warp"===a&&this.setAlpha(0),Ha(this,qa[n]),l&&this.lazyInit(!0)}lazyInit(t){if(!t&&(this.initialized||!Sa(this,this.player)))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),d.debug&&this.setInteractive({draggable:!0});const{x:e,y:i,light:n,particles:r,onCreate:s}=qa[this.npcType];d.debug?this.light=new g(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,n||1):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,n||1),r&&(this.particles=this.scene.add.particles(e,i,"",r)),this.npcType===na.ClockTower&&(this.clock=new Ta(this.scene),this.player.journal.journal.find((t=>t===sa.ClockFirstGear))&&this.player.journal.handleSideEffects(sa.ClockFirstGear,!0)),s&&s(this),this.initialized=!0}update(t,e){this.lazyInit(),!this.light||this.x===this.lastPos.x&&this.y===this.lastPos.y||this.light.setPosition(this.x,this.y),this.lastPos.set(this.x,this.y),this.clock&&this.clock.update(t)}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Zo.None;if(t[la.Continue]){const t=ma(ya[this.npcType],this.player,this);if(t){const e=qa[this.npcType].portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),Zo.Talked}}return Zo.None}getButtonPrompt(){return this.npcType===na.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${qa[this.npcType].name}`,"Press [CONTINUE]"]}}class Oa extends i.Physics.Arcade.Image{constructor(t,i,n){const{x:r,y:s,image:o}=da[i];super(t,r,s,o||""),e(this,"propType"),e(this,"player"),e(this,"initialized",!1),e(this,"particles"),this.propType=i,this.player=n,this.setScale(o?.35:2).setDepth(f.Items),o||d.debug||this.setAlpha(0),Ha(this,da[i])}lazyInit(t){if(!t&&(this.initialized||!Sa(this,this.player)))return;if(this.player.journal.journal.includes(sa.AlchemyLabFound)&&this.propType===oa.LabHatch)return void this.destroy();this.scene.add.existing(this),this.scene.physics.add.existing(this),d.debug&&this.setInteractive({draggable:!0});const e=da[this.propType].particles;e&&(this.particles=this.scene.add.particles(this.x,this.y,"warp",e).setDepth(f.Items)),this.initialized=!0}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Zo.None;if(t[la.Continue]){const t=ma(ga[this.propType]||[],this.player,this);if(t)return this.player.message.setDialog(t,this,da[this.propType].portrait||"player_portrait"),Zo.Prop}return Zo.None}getButtonPrompt(){return ma(ga[this.propType]||[],this.player,this)?[`Inspect ${oa[this.propType]}`,"Press [CONTINUE]"]:""}update(){this.lazyInit()}}const Pa={[sa.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[sa.ForestMazeSolved]:{description:"I finally got through the forest maze. Next time should be much easier."},[sa.SphinxRiddleSolved]:{description:"I solved the sphinx’s riddle. Now I can pass through the forest.",warpAdd:ta.ForestEast},[sa.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:ta.ClockSquareNorth},[sa.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[sa.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:ta.LabEntrance},[sa.AlchemySetFixed]:{description:"With the alchemy set fixed, I can now attempt to create the brew mentioned in the old journal."}},Aa={[ia.ForestGear]:{description:"Find the gear in the forest",warpAdd:ta.TownEast,warpComplete:ta.TownNorth},[ia.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[ia.InvestigateTownWest]:{description:"Investigate the west side of town",warpAdd:ta.TownWest},[ia.ExploreLab]:{description:"Explore the hidden alchemy lab"}};var Ea=(t=>(t[t.Ladder=0]="Ladder",t[t.Warp=1]="Warp",t[t.Invisible=2]="Invisible",t[t.WarpHidden=3]="WarpHidden",t[t.InvisibleHidden=4]="InvisibleHidden",t))(Ea||{});const Ca={[ta.Town]:{x:300,y:650,key:la.Down,warpTo:ta.Underground,visual:0},[ta.Underground]:{x:301,y:875,key:la.Up,warpTo:ta.Town,visual:0},[ta.TownEast]:{x:1720,y:650,key:la.Right,warpTo:ta.Forest,visual:3},[ta.Forest]:{x:2650,y:815,key:la.Left,warpTo:ta.TownEast,visual:1},[ta.TownNorth]:{x:775,y:650,key:la.Up,warpTo:ta.ClockSquare,visual:3},[ta.ClockSquare]:{x:610,y:-330,key:la.Left,warpTo:ta.TownNorth,visual:1},[ta.ClockSquareNorth]:{x:915,y:-330,key:la.Up,warpTo:ta.ClockEntrance,visual:3},[ta.ClockEntrance]:{x:690,y:-1320,range:15,key:la.Left,warpTo:ta.ClockSquareNorth,visual:1,skipLighting:!0},[ta.ClockStairs]:{x:910,y:-1400,range:20,key:la.Right,warpTo:ta.ClockTop,visual:2},[ta.ClockTop]:{x:780,y:-1970,range:10,key:la.Left,warpTo:ta.ClockStairs,visual:2},[ta.ForestEast]:{x:3590,y:815,key:la.Right,warpTo:ta.Lake,visual:3},[ta.Lake]:{x:4625,y:915,key:la.Left,warpTo:ta.ForestEast,visual:1},[ta.LakeEast]:{x:6121,y:760,key:la.Right,warpTo:ta.Lake,visual:1},[ta.TownWest]:{x:90,y:650,key:la.Left,warpTo:ta.MansionOutside,visual:3},[ta.MansionOutside]:{x:-620,y:640,key:la.Right,warpTo:ta.TownWest,visual:1},[ta.MansionEntrance]:{x:-1290,y:640,key:la.Up,warpTo:ta.MansionExit,visual:1},[ta.MansionExit]:{x:-1405,y:-420,key:la.Down,warpTo:ta.MansionEntrance,visual:2},[ta.LabEntrance]:{x:-1920,y:640,key:la.Down,warpTo:ta.LabExit,visual:4},[ta.LabExit]:{x:-380,y:1545,key:la.Right,warpTo:ta.LabEntrance,visual:2,range:15,skipLighting:!0}},Ma=[];Object.values(Aa).forEach((t=>{t.warpAdd&&Ma.push(t.warpAdd),t.warpComplete&&Ma.push(t.warpComplete)})),Object.values(Pa).forEach((t=>{t.warpAdd&&Ma.push(t.warpAdd)}));class za extends i.Physics.Arcade.Image{constructor(t,i,n){const{x:r,y:s,visual:o,range:a}=Ca[i];super(t,r,s,o===Ea.Ladder?"ladder":"warp"),e(this,"warpType"),e(this,"player"),e(this,"particles1"),e(this,"particles2"),e(this,"graphics"),e(this,"range"),e(this,"initialized",!1),this.warpType=i,this.player=n,this.range=a||30,this.setScale(.6).setDepth(f.Warpers),o!==Ea.Warp&&o!==Ea.WarpHidden||(this.setScale(.6,1),this.setPosition(r,s-12)),d.debug||(o!==Ea.WarpHidden&&o!==Ea.InvisibleHidden||this.setVisible(!1),o!==Ea.Invisible&&o!==Ea.InvisibleHidden||this.setAlpha(0)),Ha(this,Ca[i]),Ma.includes(i)&&t.add.existing(this)}lazyInit(t){(t||!this.initialized&&Sa(this,this.player))&&(Ma.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createParticles(),this.createDebug(),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),this.setVisible(this.visible),this.warpType===ta.Underground&&(this.scene.add.image(this.x,this.y-60,"ladder").setScale(.6).setDepth(f.Warpers).setPipeline("Light2D"),this.scene.add.image(this.x,this.y-105,"ladder").setScale(.6).setDepth(f.Warpers).setPipeline("Light2D")),this.initialized=!0)}createParticles(){const{visual:t,skipLighting:e}=Ca[this.warpType];t!==Ea.Warp&&t!==Ea.WarpHidden||(this.particles1=this.scene.add.particles(this.x,this.y-12,"warp",{x:{min:-3,max:3},y:{min:-3,max:3},speed:{random:[-40,40]},scale:{min:.35,max:.5},alpha:{start:.2,end:0},angle:{min:0,max:360},color:[b(m.Teal),b(m.White),b(m.Tan)],colorEase:"Linear",radial:!0,blendMode:i.BlendModes.OVERLAY}).setScale(1,2).setDepth(f.Warpers),this.particles1.viewBounds=this.particles1.getBounds(30,500),this.particles2=this.scene.add.particles(this.x,this.y-12,"warp",{x:{min:-30,max:30},y:{min:-50,max:50},speed:{random:[-5,5]},scale:{min:.05,max:.15},alpha:{values:[0,.2,0]},angle:{min:0,max:360},lifespan:{min:1e3,max:1400},color:[b(m.Peach),b(m.White),b(m.Tan)],colorEase:"Linear",radial:!0,maxAliveParticles:20}).setDepth(f.Warpers),this.particles2.viewBounds=this.particles2.getBounds(30,500),e||(this.particles1.setPipeline("Light2D"),this.particles2.setPipeline("Light2D")))}createDebug(){if(d.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const t=this.body;this.graphics.lineBetween(-this.range,-t.halfHeight,-this.range,t.halfHeight),this.graphics.lineBetween(this.range,-t.halfHeight,this.range,t.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:t,key:e}=Ca[this.warpType];return!(t!==Ea.Warp&&t!==Ea.WarpHidden&&t!==Ea.Invisible||e!==la.Left&&e!==la.Right)}onInteract(t){const e=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,i=t[Ca[this.warpType].key]&&e;return!i||this.warpType!==ta.TownEast||Ra(this.player.journal.journal,sa.ForestMazeSolved)||d.debug?i?(La(Ca[this.warpType].warpTo,this.player),Zo.Teleported):Zo.None:(this.scene.scene.pause(),this.scene.scene.launch("MazeDialog",{player:this.player}),Zo.None)}getButtonPrompt(){const t=Ca[this.warpType].key;let e;return t===la.Continue&&(e="[CONTINUE]"),t===la.Up&&(e="[Up]"),t===la.Down&&(e="[Down]"),t===la.Left&&(e="[Left]"),t===la.Right&&(e="[Right]"),[`Travel to ${ta[Ca[this.warpType].warpTo]}`,"Press "+e]}setPosition(t,e,i,n){return super.setPosition(t,e,i,n),this.particles1&&this.particles2&&(this.particles1.setPosition(t,(e||0)-12),this.particles2.setPosition(t,(e||0)-12)),this.graphics&&this.graphics.setPosition(t,e),this}setVisible(t){return super.setVisible(t),this.particles1&&this.particles2&&(t?(this.particles1.start(),this.particles2.start()):(this.particles1.stop(),this.particles1.killAll(),this.particles2.stop(),this.particles2.killAll())),this}update(t,e){this.lazyInit()}destroy(t){this.particles1&&this.particles2&&(this.particles1.destroy(),this.particles2.destroy()),super.destroy(t)}}function La(t,e){const{x:n,y:r,onWarp:s}=Ca[t],o=e.scene,a=n-o.cameras.main.width/2,l=r-o.cameras.main.height/2;s&&s(e),o.cameras.main.fadeOut(200,0,0,0,((t,e)=>{e>=1&&o.cameras.main.fadeIn(1e3,0,0,0)})),o.cameras.main.stopFollow(),o.tweens.add({targets:o.cameras.main,scrollX:a,scrollY:l-d.cameraOffset,duration:600,delay:100,ease:"Power1",onComplete:()=>{o.cameras.main.startFollow(e),o.cameras.main.setFollowOffset(0,d.cameraOffset)}}),e.setActive(!1),o.tweens.add({targets:e,alpha:0,duration:500,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e.setPosition(n,r)},onComplete:()=>{e.alpha=1,e.setActive(!0)}});const h=e.light instanceof i.GameObjects.Light?e.light:e.light.light;o.tweens.add({targets:h,x:n,y:r,duration:400,ease:"Power1"})}function Ba(t,e){return void 0!==t.find((t=>t.type===e))}function Fa(t,e){return void 0!==t.find((t=>t.type===e&&t.used))}function Wa(t,e){return t.some((t=>t.id===e&&!t.completed))}function Da(t,e){return t.some((t=>t.id===e&&t.completed))}function Ra(t,e){return t.includes(e)}function _a(t,e){return t.children.getAll().filter((t=>t instanceof e))}function Ua(t,e,i){const n=function(t,e){return _a(t,za).find((t=>t.warpType===e))}(t,e);n&&n.setVisible(i)}function Ga(t,e){return _a(t,Ia).find((t=>t.npcType===e))}function Na(t){var e;return(null==(e=t.scene.get("Game").clock)?void 0:e.rewindCount)||0}function Ha(t,e){const{scale:i,alpha:n,angle:r,depth:s,skipLighting:o,origin:a}=e;i&&t.setScale(i),n&&t.setAlpha(n),r&&t.setAngle(r),s&&t.setDepth(s),o||t.setPipeline("Light2D"),a&&t.setOrigin(a.x,a.y)}const $a=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3630,y:760,id:ra.Sphinx},{x:4575,y:850},{x:6160,y:690},{x:-565,y:575},{x:-2075,y:575},{x:-1930,y:-480},{x:-1050,y:-510},{x:-2075,y:1630},{x:-350,y:1510},{x:270,y:1560}];function Va(t,e,n){var r,s;const o=Ga(t,na.Sphinx);if(!o)return void console.error("Sphinx not found");const a=function(t,e){return _a(t,i.GameObjects.Rectangle).find((t=>t.getData("WallType")===e))}(t,ra.Sphinx);a&&(e?a.setX((null==(r=$a.find((t=>t.id===ra.Sphinx)))?void 0:r.x)||0):a.setX(a.x-150),null==(s=a.body)||s.updateFromGameObject());const{x:l,y:h}=qa[na.Sphinx],c=e?l+200:l,p=e?h-90:h;t.tweens.add({targets:o,alpha:0,duration:!e||n?0:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{o.setPosition(c,p)},onComplete:()=>{o.alpha=1}}),t.tweens.add({targets:o.light,x:c,y:p,duration:!e||n?0:450,ease:"Power1"})}const qa={[na.Inventor]:{x:550,y:635,scale:.75,image:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[na.Stranger]:{x:750,y:865,scale:1.35,image:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[na.Sphinx]:{x:3520,y:790,scale:1,image:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:t=>Va(t.scene,!1),light:1.85,initOnStart:!0},[na.Mayor]:{x:1065,y:-340,scale:.9,image:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[na.ClockTower]:{x:880,y:-2090,scale:.5,image:"warp",portrait:"clock_portrait",name:"Clock Tower",particles:{texture:"warp",scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]},onCreate:t=>{t.setOffset(150,-40)}}};class Ka extends i.GameObjects.Text{constructor(t,i,n,r,s,o){super(t,i,n,r,{...w,fontSize:48,backgroundColor:`#${m.Teal}`,padding:{x:15,y:10},...o}),e(this,"onClick"),this.setOrigin(.5),t.add.existing(this),this.onClick=s,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>s())),this.on("pointerover",(()=>this.setTint(12303291))),this.on("pointerout",(()=>this.setTint(16777215)))}}class Qa extends i.GameObjects.Container{constructor(t){var i,n,r;super(t),e(this,"buttons",[]),e(this,"activeIndex",-1),t.add.existing(this).setScrollFactor(0),null==(i=t.input.keyboard)||i.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(n=t.input.keyboard)||n.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(r=t.input.keyboard)||r.on("keydown-ENTER",(()=>{var t;null==(t=this.buttons[this.activeIndex])||t.onClick()}))}addButton(t){this.add(t),this.buttons.push(t),1===this.buttons.length&&this.setActiveButton(0),t.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(t){var e,i;null==(e=this.buttons[this.activeIndex])||e.setTint(16777215),this.activeIndex=t,null==(i=this.buttons[this.activeIndex])||i.setTint(b(m.Tan))}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const Xa=20;class Ya extends i.GameObjects.Container{constructor(t,i){var n,r;super(t),e(this,"textWidth"),e(this,"textHeight"),e(this,"player"),e(this,"target"),e(this,"npcName"),e(this,"text"),e(this,"box"),e(this,"portrait"),e(this,"options"),e(this,"optionsContainer"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),e(this,"initialized",!1);const{width:s,height:o}=d;this.textWidth=s-135-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(Xa,o-Xa-170),this.setDepth(f.Overlay),this.setVisible(!1),this.player=i,null==(n=this.scene.input.keyboard)||n.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(r=this.scene.input.keyboard)||r.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}createUI(){this.scene.add.existing(this),this.npcName=new i.GameObjects.Text(this.scene,170,15,"",{...w,color:"#"+m.Tan}),this.text=new i.GameObjects.Text(this.scene,170,60,"",w),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(5),this.portrait=new i.GameObjects.Image(this.scene,Xa,Xa,"").setOrigin(0).setScale(1.5),this.box=new i.GameObjects.Rectangle(this.scene,0,0,d.width-40,170,b(m.Black),.8),this.box.setStrokeStyle(2,b(m.Tan),1),this.box.setOrigin(0,0),this.optionsContainer=new Qa(this.scene).setDepth(f.Overlay),this.add([this.box,this.npcName,this.text,this.portrait])}setDialog(t,e,i){if(this.npcName||this.createUI(),this.setVisible(void 0!==t),this.target=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,this.scene.gamepad.offsetButtons(void 0!==this.dialog),!t)return;const n=i||(e instanceof Ia?qa[e.npcType].portrait:void 0);this.npcName.setVisible(!1),n?(this.portrait.setVisible(!0),this.portrait.setTexture(n),this.text.setPosition(170,Xa+(e instanceof Ia?40:0)).setWordWrapWidth(this.textWidth,!0).setFixedSize(this.textWidth,this.textHeight),e instanceof Ia&&(this.npcName.setVisible(!0),this.npcName.setText(qa[e.npcType].name))):(this.portrait.setVisible(!1),this.text.setPosition(Xa,Xa).setWordWrapWidth(170+this.textWidth,!0).setFixedSize(170+this.textWidth,this.textHeight)),this.showMessage()}showMessage(){const t=this.getMessages(),e=t&&t[this.messageIndex];e&&(this.text.setText(e),this.text.getWrappedText().length>5&&console.error("Message too long!",e)),this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;const t=!d.zoomed;this.options.forEach(((e,i)=>{const n=new Ka(this.scene,d.width/2,d.height/(t?9:14)+i*(30+d.height/(t?16:22)),e,(()=>this.onSelectOption(e)),{fontSize:24,backgroundColor:"#"+m.Black,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(f.Overlay);this.optionsContainer.addButton(n)}))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){if(Date.now()<this.interactionTimeout)return;const t=this.getMessages();this.dialog&&t&&(this.messageIndex++,this.messageIndex>=t.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.setVisible(!1)):this.showMessage(),this.scene.gamepad.offsetButtons(void 0!==this.dialog),this.interactionTimeout=Date.now()+350)}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}}class Ja extends i.GameObjects.Text{constructor(t,e,i=3500,n=m.Teal){const r=_a(t,Ja).reduce(((t,e)=>Math.max(t,e.y-20)),0)+65;super(t,20,r,e,{...w,backgroundColor:"#"+n,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(f.Overlay).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:r+10,duration:350,hold:i,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}class Za extends i.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),e(this,"initialized",!1),this.setScrollFactor(0).setDepth(f.Ui).setVisible(!1)}createUI(){this.initialized||(this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,b(m.Teal)).setStrokeStyle(2,b(m.White)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...w,fontSize:32}),this.add(this.text),this.initialized=!0)}addItem(t,e){if(this.initialized||this.createUI(),this.inventory.push(t),!t.used){const e=this.scene.add.image(0,0,ba[t.type].image).setScale(.35);t.type===ea.Key&&e.setAngle(45),this.add(e)}this.updateItems();const i=function(t,e){return _a(t,ka).find((t=>t.itemType===e))}(this.scene,t.type);null==i||i.destroy(),e||new Ja(this.scene,`New item added: ${ba[t.type].name}`)}removeItem(t){var e;this.initialized||this.createUI();const i=this.inventory.find((e=>e.type===t));i&&(i.used=!0,null==(e=this.getAll().find((e=>{var i;return(null==(i=e.texture)?void 0:i.key)===ba[t].image})))||e.destroy()),this.updateItems()}updateItems(){var t;this.initialized||this.createUI();let e=0;this.getAll().forEach((t=>{if(t instanceof i.GameObjects.Image){const i=32+50*e;t.setPosition(i,68),e++}})),this.setVisible(this.inventory.length>0);const n=Math.max((null==(t=this.text)?void 0:t.displayWidth)+18,50*e+12);this.setPosition(d.width-n-20,20),this.rect.setSize(n,102)}}class tl extends i.GameObjects.Image{constructor(t,i){super(t,d.width-50,d.height-55,"journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),e(this,"initialized",!1),this.player=i}createUI(){this.initialized||(this.setScrollFactor(0).setDepth(f.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(d.width-21,d.height-89,20,20,11141120).setStrokeStyle(2,b(m.Black)).setScrollFactor(0).setDepth(f.Ui2).setVisible(!1),this.initialized=!0)}addEntry(t,e){this.initialized||this.createUI(),this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new Ja(this.scene,"New journal entry added!")),this.handleSideEffects(t,e||!1))}openJournal(){this.initialized||this.createUI(),0!==this.journal.length&&(this.unread.setVisible(!1),this.scene.scene.pause(),this.scene.scene.launch("JournalDialog",{player:this.player}))}handleSideEffects(t,e){const{warpAdd:i}=Pa[t];if(i&&Ua(this.scene,i,!0),t===sa.SphinxRiddleSolved&&Va(this.scene,!0,e),t===sa.ClockFirstGear){const t=Ga(this.scene,na.ClockTower);(null==t?void 0:t.clock)&&(t.clock.update1=!0)}}}class el extends i.GameObjects.Container{constructor(t){super(t,d.width-330-20,120),e(this,"quests",[]),e(this,"questRectangle"),e(this,"initialized",!1)}createUI(){if(this.initialized)return;this.scene.add.existing(this),this.setScrollFactor(0).setDepth(f.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,330,60,b(m.Teal)).setStrokeStyle(2,b(m.White)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const t=this.scene.add.text(10,4,"Quests",{...w,fontSize:32});this.add(t),this.initialized=!0}addQuest(t,e){if(this.initialized||this.createUI(),this.quests.find((e=>e.id===t.id)))return;this.quests.push(t),this.add(this.scene.add.text(0,0,Aa[t.id].description,{...w,fontSize:20})),this.updateQuests();const{warpAdd:i,warpComplete:n}=Aa[t.id];i&&Ua(this.scene,i,!0),t.completed&&n&&Ua(this.scene,n,!0),e||new Ja(this.scene,`New quest added: ${Aa[t.id].description}`)}updateExistingQuest(t,e){this.initialized||this.createUI();const i=this.quests.find((e=>e.id===t));i&&(!i.completed&&e&&new Ja(this.scene,`Quest completed: ${Aa[i.id].description}`),i.completed=e);const{warpComplete:n}=Aa[t];n&&Ua(this.scene,n,e),this.updateQuests()}updateQuests(){this.initialized||this.createUI();const t=this.quests.filter((t=>!t.completed));let e=1,n=0;this.getAll().forEach((r=>{if(r instanceof i.GameObjects.Text)if(t.find((t=>r.text===Aa[t.id].description))||"Quests"===r.text){if("Quests"!==r.text){const t=14+30*e;r.setPosition(10,t),e++,n=Math.max(n,r.width)}}else r.destroy()}));const r=n+20;this.setX(d.width-20-r),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(r,50+30*t.length)}reset(){this.quests=[],this.updateQuests()}}const il=1.35*(d.fastMode?350:120),nl=new i.Math.Vector2(400,650);class rl extends i.Physics.Arcade.Sprite{constructor(t){var i;super(t,nl.x,nl.y,"character",0),e(this,"scene"),e(this,"keys"),e(this,"light"),e(this,"debug"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),this.scene=t,t.add.existing(this),t.physics.add.existing(this),d.debug&&this.setInteractive(),this.setBodySize(48,70).setOffset(40,10).setOrigin(.5,.65).setDepth(f.Player).setScale(1.35).setPipeline("Light2D"),d.debug?(this.light=new g(t,this.x,this.y,200,16768443,1.2),this.debug=t.add.circle(this.x,this.y,3,16711935).setDepth(f.Debug)):this.light=t.lights.addLight(this.x,this.y,200,16768443,1.2),(i=this).anims.create({key:"walk",frames:i.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:4,repeat:-1}),i.anims.play("walk"),this.keys=new ha(t),this.message=new Ya(t,this),this.inventory=new Za(t),this.quests=new el(t),this.journal=new tl(t,this)}update(t,e){var i,n,r;d.debug&&(this.setTint(this.interactive?16755370:16777215),this.debug.setPosition(this.x,this.y));const s=this.interactive&&!this.message.visible&&(null==(n=null==(i=this.buttonPrompt)?void 0:i.text)?void 0:n.length)>0||!1;s&&!this.buttonPrompt&&(this.buttonPrompt=new aa(this.scene)),null==(r=this.buttonPrompt)||r.setVisible(s),this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity(),this.light.setPosition(this.x,this.y),function(t){var e;const i=(null==(e=t.body)?void 0:e.velocity.x)||0,n=i<0;Math.abs(i)>0?(t.anims.resume(),t.flipX=t.rewinding?!n:n):t.anims.pause(),t.setAngle(t.flipX?-5:5)}(this)}checkInteraction(){let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys.keys),t!==Zo.None&&(this.interactionTimeout=Date.now()+(this.interactive.interactionTimeout||500),this.keys.resetKeys(),t===Zo.Teleported&&(this.interactive=void 0))),t}updateVelocity(){let t=il;const e=this.keys.keys;e[la.Left]&&this.setVelocityX(-t),e[la.Right]&&this.setVelocityX(t),d.debug&&!this.interactive&&(e[la.Up]&&this.setVelocityY(-t),e[la.Down]&&this.setVelocityY(t)),e[la.Left]&&e[la.Right]&&this.setVelocityX(0)}record(){var t;this.history.length<1e3?this.history.push(new i.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(nl.x,nl.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e,i;this.interactive=t,(null==t?void 0:t.onCollided)&&t.onCollided();const n=null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t);n&&!this.buttonPrompt&&(this.buttonPrompt=new aa(this.scene)),null==(i=this.buttonPrompt)||i.setText(n)}}const sl="chrono-sleuth-save",ol={player:{x:nl.x,y:nl.y,flip:!1},journal:[],inventory:[],quests:[],settings:{gamepad:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t))),debug:!1,zoomed:!0}},al={player:{x:-770,y:nl.y,flip:!0},journal:[sa.FixTheClock,sa.ForestMazeSolved,sa.SphinxRiddleSolved,sa.MetTheMayor,sa.ClockFirstGear],inventory:[{type:ea.Wrench,used:!1},{type:ea.Gear1,used:!0}],quests:[{id:ia.ForestGear,completed:!0},{id:ia.SphinxRiddle,completed:!0},{id:ia.InvestigateTownWest,completed:!1}],settings:{gamepad:!1,debug:!1,zoomed:!0}};function ll(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal,inventory:t.player.inventory.inventory,quests:t.player.quests.quests,settings:{gamepad:t.gamepad.visible,debug:d.debug,zoomed:d.zoomed}}}function hl(){const t=localStorage.getItem(sl);let e,i;try{t&&(e=JSON.parse(t))}catch(n){console.error(n),i=n}return{save:e||ol,error:i}}function cl(t,e){const i={...d};return d.debug=t.settings.debug,d.zoomed=t.settings.zoomed,d.zoomed!==i.zoomed?(function(t,e){const i=e?l:a;d.zoomed=e,d.width=i.width,d.height=i.height,d.cameraOffset=i.height/3,t.scale.setGameSize(i.width,i.height),t.scene.restart()}(e,d.zoomed),!0):d.debug!==i.debug&&(e.scene.restart(),!0)}function pl(t){const{save:e,error:i}=hl();i&&new Ja(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4);try{cl(e,t),t.player.setX(e.player.x),t.player.setY(e.player.y),t.player.setFlipX(e.player.flip),t.time.delayedCall(50,(()=>{e.journal.forEach((e=>t.player.journal.addEntry(e,!0))),e.inventory.forEach((e=>t.player.inventory.addItem(e,!0))),e.quests.forEach((e=>t.player.quests.addQuest(e,!0)))})),t.gamepad.setVisible(e.settings.gamepad),Jo(e,ol)||Jo(e,al),t.time.delayedCall(200,(()=>{new Ja(t,"Game Loaded ")})),Jo(e,ol)&&ul(t,void 0,!0)}catch(n){console.error(n),new Ja(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4),ul(t,ol),pl(t)}}function ul(t,e,i){const n=ll(t);localStorage.setItem(sl,JSON.stringify(e||n)),i||new Ja(t,"Game Saved")}i.GameObjects.Container;class dl extends i.Physics.Arcade.Image{constructor(t,n,r){var s;const{x:o,y:a,image:l,scale:h}=n;super(t,o,a,l),e(this,"player"),e(this,"initialized",!1),e(this,"info"),e(this,"center"),this.info=n,this.player=r,this.setOrigin(0).setDepth(f.Backgrounds),Ha(this,n);const c=null==(s=t.textures.get(l))?void 0:s.getSourceImage();this.center=new i.Math.Vector2(o+c.width*(h||1)/2,a+c.height*((h||1)/2))}lazyInit(t){(t||!this.initialized&&Sa(this.center,this.player,2e3))&&(this.scene.add.existing(this),this.scene.physics.add.existing(this),d.debug&&this.setInteractive({draggable:!0}),this.initialized=!0)}update(){this.lazyInit()}}function yl(){return Math.random()-.5}const fl=[3200,600],gl=[5350,690],ml=[500,200,100,50,10];class bl extends i.GameObjects.GameObject{constructor(t,n,r,s=40,o=[1400,600]){super(t,"fireflies"),e(this,"scene"),e(this,"center"),e(this,"lights",[]),e(this,"count"),e(this,"centers",[]),e(this,"bounds",[1e3,400]),e(this,"biases",[]),e(this,"initialized",!1),e(this,"debug"),t.add.existing(this),this.scene=t,this.count=s,this.bounds=o,this.center=new i.Math.Vector2(n,r),this.setPosition(n,r)}setPosition(t,e){this.centers=[];for(let n=0;n<this.count;n++)this.centers.push(new i.Math.Vector2(t+Math.random()*this.bounds[0]-this.bounds[0]/2,e+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(t-this.bounds[0]/2,e-this.bounds[1]/2)}lazyInit(t){if(t||!this.initialized&&Sa(this.center,this.scene.player)){for(let t=0;t<this.count;t++){const t=new i.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),e=this.scene.lights.addPointLight(0,0,t.color,7*Math.random()+3,.15,.045+.02*yl());this.lights.push(e);const n=[];for(let i=0;i<2*ml.length;i++)n.push(yl()*ml[i%ml.length]);n.push(10*yl()),this.biases.push(n)}this.setPosition(this.center.x,this.center.y),d.debug&&(this.debug=this.scene.add.graphics().fillStyle(16711680,.5).lineStyle(2,16711680,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])),this.initialized=!0}}update(t,e){if(this.lazyInit(),!(Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0]))return;const i=t/1e3*.025,n=Math.cos(i),r=Math.sin(i);this.lights.forEach(((t,e)=>{const s=this.biases[e],o=Math.cos(70*i+s[10]);t.intensity=Math.min(.05+Math.abs(s[4]*o+s[3]*n+s[4]*n)/50,.4),t.x=n*s[0]+r*s[1]+n*s[2]+r*s[3]+n*s[4]+this.centers[e].x,t.y=r*s[5]+n*s[6]+r*s[7]+n*s[8]+r*s[9]+this.centers[e].y}))}}class vl extends i.Physics.Arcade.Image{constructor(t,i,n,r=100,s=100,o=!1,a=!1){super(t,i,n,""),e(this,"scene"),e(this,"width"),e(this,"height"),e(this,"flipped"),e(this,"upwards"),e(this,"graphics"),e(this,"initialized",!1),this.scene=t,this.width=r,this.height=s,this.flipped=o,this.upwards=a}lazyInit(t){if(t||!this.initialized&&Sa(this,this.scene.player)){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0).setDepth(f.Debug),d.debug||this.setVisible(!1),this.setSize(this.width,1.5*this.height),d.debug){this.setInteractive({draggable:!0});const t=this.scene.add.graphics().setDepth(f.Debug);this.graphics=t,t.lineStyle(2,65280,1);const e=this.width/2,n=new i.Math.Vector2(0,this.flipped?0:0+this.height),r=new i.Math.Vector2(0+this.width,this.flipped?0+this.height:0);t.lineBetween(n.x,n.y,r.x,r.y),t.lineBetween(n.x-e,n.y,n.x,n.y),t.lineBetween(r.x,r.y,r.x+e,r.y),t.strokeCircle(n.x,n.y,2),t.strokeCircle(r.x,r.y,2)}this.initialized=!0}}update(t,e){if(this.lazyInit(),!this.initialized)return;d.debug&&this.graphics&&this.graphics.setPosition(this.x,this.y);const n=this.scene.player,r=n.keys.keys;if(this.body&&this.scene.physics.world.intersects(this.body,n.body)){let t=i.Math.Clamp(1-(this.x+this.width-n.x)/this.width,0,1);this.flipped&&(t=1-t);const e=this.y+this.height,s=(1-n.originY)*n.displayHeight,o=e-this.height*t-s;if(this.upwards&&r[la.Up]&&Math.abs(n.y-o)<70)return n.setVelocityX(this.flipped?-il:il),n.setFlipX(this.flipped),void n.setY(o);if(this.upwards&&(r[la.Right]||r[la.Left]&&this.flipped)&&n.y<e-70)return void n.setY(o);if(this.upwards&&o<n.y)return;n.setY(o)}}}class wl extends i.Physics.Arcade.StaticGroup{constructor(t,i){super(t.physics.world,t),e(this,"player"),e(this,"initialized",[]),this.player=i,$a.forEach(((t,e)=>{void 0!==t.id&&this.createWall(t,e)}))}createWall(t,e){const i=this.scene.add.rectangle(t.x,t.y,6,100).setOrigin(0).setVisible(d.debug);t.id&&i.setData("WallType",t.id),d.debug&&i.setInteractive({draggable:!0}),this.add(i),this.initialized.push(e)}update(){$a.forEach(((t,e)=>{this.initialized.includes(e)||i.Math.Distance.BetweenPointsSquared(t,this.player)<1e6&&this.createWall(t,e)}))}}class xl extends i.GameObjects.Container{constructor(t,i){super(t,100,d.height-100),e(this,"buttons",[]),e(this,"lastAxisKey"),e(this,"minimal"),this.minimal=i,this.setScrollFactor(0).setDepth(f.Overlay)}createUI(){this.scene.add.existing(this),this.createDPad(),this.minimal||this.createButtons(),this.createControllerListeners()}setVisible(t){return super.setVisible(t),t&&0===this.buttons.length&&this.createUI(),this}update(t,e){var i,n,r,s,o,a;const l=null==(i=this.scene.input.gamepad)?void 0:i.pad1;if(!l)return;const h=l.axes[0].getValue();if(Math.abs(h)<=.1&&this.lastAxisKey)return null==(n=this.scene.input.keyboard)||n.emit("keyup-"+this.lastAxisKey),void(this.lastAxisKey=void 0);if(h>.1){if("RIGHT"===this.lastAxisKey)return;"LEFT"===this.lastAxisKey&&(null==(r=this.scene.input.keyboard)||r.emit("keyup-LEFT")),null==(s=this.scene.input.keyboard)||s.emit("keydown-RIGHT"),this.lastAxisKey="RIGHT"}if(h<-.1){if("LEFT"===this.lastAxisKey)return;"RIGHT"===this.lastAxisKey&&(null==(o=this.scene.input.keyboard)||o.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastAxisKey="LEFT"}}createDPad(){const t=this.scene.add.container(10,-10);this.add(t);const e=this.scene.add.circle(0,0,60,b(m.Teal),.45).setStrokeStyle(3,b(m.Black));t.add(e),this.button(-57,0,"LEFT",t),this.button(57,0,"RIGHT",t),this.button(0,-57,"UP",t),this.button(0,57,"DOWN",t)}createButtons(){const t=this.scene.add.container(d.width-300,0);this.add(t);const e=this.scene.add.circle(40,0,65,b(m.Teal),.45).setStrokeStyle(3,b(m.Black)).setScale(1,.6).setAngle(-30);t.add(e),this.button(80,-20,"ENTER",t),this.button(0,20,"BACKSPACE",t)}createControllerListeners(){var t,e,i,n;null==(t=this.scene.input.gamepad)||t.on("connected",(t=>{new Ja(this.scene,"Gamepad connected")})),null==(e=this.scene.input.gamepad)||e.on("disconnected",(t=>{new Ja(this.scene,"Gamepad disconnected")})),null==(i=this.scene.input.gamepad)||i.on("down",((t,e)=>{var i;const n=this.getKeyFromButton(e);n&&(null==(i=this.scene.input.keyboard)||i.emit(`keydown-${n}`)),console.log("down",e)})),null==(n=this.scene.input.gamepad)||n.on("up",((t,e)=>{var i;const n=this.getKeyFromButton(e);n&&(null==(i=this.scene.input.keyboard)||i.emit(`keyup-${n}`)),console.log("up",e)}))}getKeyFromButton(t){let e;switch(t.index){case 0:e=t.pad.id.toLowerCase().includes("nintendo")?"BACKSPACE":"ENTER";break;case 1:e=t.pad.id.toLowerCase().includes("nintendo")?"ENTER":"BACKSPACE";break;case 9:e="ESC";break;case 12:e="UP";break;case 13:e="DOWN";break;case 14:e="LEFT";break;case 15:e="RIGHT"}return e}button(t,e,i,n){const r="ENTER"===i||"ESCAPE"===i?35:38,s=this.scene.add.circle(t,e,r,b(m.White),.8).setStrokeStyle(3,b(m.Black));s.setInteractive({useHandCursor:!0}).setScrollFactor(0),n.add(s),s.on("pointerdown",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keydown-${i}`),s.setFillStyle(b(m.Teal),Math.min(1,1.05))})),s.on("pointerup",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),s.setFillStyle(b(m.White),.8)})),s.on("pointerout",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),s.setFillStyle(b(m.White),.8)})),this.buttons.push(s)}offsetButtons(t){t?this.setPosition(100,d.height-300):this.setPosition(100,d.height-100)}}class Sl extends i.GameObjects.Container{constructor(t,i,n,r,s){super(t,i,n),e(this,"img"),e(this,"rect"),t.add.existing(this),this.setScrollFactor(0).setDepth(f.Ui),this.rect=t.add.rectangle(0,0,42,42,b(m.Teal)).setScrollFactor(0).setStrokeStyle(2,b(m.Black)),this.img=t.add.image(-1,1,r).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>s(this))),this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}}const kl=[{x:0,y:0,image:"town"},{x:500,y:-1100,image:"clock_outside"},{x:500,y:-2400,image:"clock_inner",skipLighting:!0},{x:2300,y:0,image:"forest"},{x:4400,y:100,image:"lake"},{x:-2200,y:-170,image:"mansion_outside"},{x:-2e3,y:-1320,image:"mansion_inside",skipLighting:!0},{x:-2200,y:1300,image:"alchemy_lab",scale:.9,skipLighting:!0}],jl=[{x:135,y:462,radius:150,color:b(m.Tan),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:887,y:200,radius:150},{x:1561,y:460},{x:791,y:472,intensity:.5},{x:962,y:469,intensity:.5},{x:162,y:814,intensity:2},{x:635,y:772},{x:1638,y:788,intensity:2},{x:5300,y:530,intensity:2},{x:5315,y:730,intensity:.75,radius:75}],Tl=[{x:740,y:-1370,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5150,y:953,width:100,height:60,flip:!0},{x:5820,y:795,width:220,height:220},{x:-1300,y:-415,width:90,height:35},{x:-710,y:1577,width:280,height:190,upwards:!0},{x:-20,y:1697,width:200,height:70},{x:-1570,y:1728,width:200,height:40,flip:!0}];class Il extends i.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock"),e(this,"gamepad"),e(this,"shouldInit",!0)}init(){const t=function(t){const{save:e}=hl();try{return cl(e,t)}catch(i){console.error(i)}return!1}(this);this.shouldInit=!t}create(){if(!this.shouldInit)return;const t=performance.now();wa(this,500),this.player=new rl(this);const e=this.createBackgrounds(),i=new wl(this,this.player),n=this.createWarpers(),r=this.createNpcs(),s=this.createItems(),o=this.createSlopes(),a=this.createProps(),l=new bl(this,fl[0],fl[1]),h=new bl(this,gl[0],gl[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...n,...r,...s,...a],{runChildUpdate:!0});const c=this.add.group([this.player,this.gamepad,l,h,...o,i,...e],{runChildUpdate:!0});this.clock&&c.add(this.clock),this.physics.add.collider(this.player,i),this.createEventListeners();const p=this.cameras.main;p.startFollow(this.player,!0),p.setFollowOffset(0,d.cameraOffset),pl(this),(performance.now()-t).toFixed(1)}update(){this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>{const i=t;let n=!0;return i.canInteract&&(n=i.canInteract()),void 0!==i.visible&&(n=n&&i.visible),n}),this.player)||this.player.setInteractiveObject(void 0)}createBackgrounds(){return kl.map((t=>new dl(this,t,this.player)))}createWarpers(){const t=[];for(const e in ta)isNaN(Number(e))&&t.push(new za(this,ta[e],this.player));return t}createNpcs(){return Object.values(na).filter((t=>"number"==typeof t)).map((t=>new Ia(this,t,this.player)))}createItems(){return[ea.Gear1,ea.Key].map((t=>new ka(this,t,this.player)))}createSlopes(){return Tl.map((t=>new vl(this,t.x,t.y,t.width,t.height,t.flip,t.upwards)))}createProps(){return Object.values(oa).filter((t=>"number"==typeof t)).map((t=>new Oa(this,t,this.player)))}createUI(){this.time.delayedCall(50,(()=>{new Sl(this,31,30,"settings",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),new Sl(this,81,30,k(this)?"moon":"sun",(t=>{const e=k(this);var i;k(i=this)?function(t,e=!0){S||(T(t,m.Night,e),t.lights.lights.forEach((i=>{const n=i.intensity;i.setVisible(!0),e&&(i.setIntensity(0),t.tweens.add({targets:i,duration:x,intensity:n}))})))}(i):j(i),t.img.setTexture(e?"sun":"moon")})),new Sl(this,131,30,d.zoomed?"zoom-out":"zoom-in",(()=>{const t=ll(this);ul(this,{...t,settings:{...t.settings,zoomed:!d.zoomed}}),this.scene.restart()}))})),this.gamepad=new xl(this)}createLights(){this.lights.enable().setAmbientColor(b(m.White)),jl.forEach((t=>{d.debug?new g(this,t.x,t.y,t.radius||100,t.color||b(m.Lights),t.intensity||1):this.lights.addLight(t.x,t.y,t.radius||100,t.color||b(m.Lights),t.intensity||1)})),j(this,!1)}createEventListeners(){var t,e;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),null==(e=this.input.keyboard)||e.on("keydown-J",(()=>{this.player.journal.openJournal()})),this.events.on("resume",(()=>{this.player.keys.resetKeys()}))}}class Ol extends i.GameObjects.Container{constructor(t,n,r,s,o){var a,l;super(t,n,r),e(this,"textObject"),e(this,"maskGraphics"),e(this,"scrollbar"),e(this,"scrollY"),e(this,"boxHeight"),t.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new i.GameObjects.Text(t,0,0,s,{...w,padding:{x:10,y:10},...o}),this.textObject.setOrigin(0).setScrollFactor(0).setInteractive(),this.add(this.textObject),t.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),null==(a=t.input.keyboard)||a.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(l=t.input.keyboard)||l.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=t.add.graphics().setPosition(n,r).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=t.add.rectangle(0,0,4,0,5592405).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(t,e){this.boxHeight=e,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,t,e);const i=this.maskGraphics.createGeometryMask();this.textObject.setMask(i),this.textObject.setWordWrapWidth(t-8),this.textObject.setFixedSize(t-8,0),this.updateTextPosition()}handleDrag(t){t.isDown&&(this.scrollY-=t.velocity.y,this.updateTextPosition())}handleScroll(t,e,i,n,r){this.scrollY+=.5*n,this.updateTextPosition()}updateTextPosition(){const t=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=i.Math.Clamp(this.scrollY,0,t),this.textObject.y=-this.scrollY;const e=this.scrollY/t,n=this.boxHeight/this.textObject.height;this.scrollbar.height=n*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+4,e*(this.boxHeight-n*this.boxHeight))}}class Pl extends i.Scene{constructor(){super("JournalDialog"),e(this,"player")}init(t){this.player=t.player}create(){var t,e,i;const n=this.add.container(d.width/2,d.height/2);n.add(this.add.rectangle(0,0,.8*d.width,.8*d.height,0,.75).setStrokeStyle(4,b(m.Tan))),n.add(new Ka(this,.37*d.width,-.33*d.height,"X",(()=>this.close()),{backgroundColor:`#${m.Warning}`})),n.add(this.add.text(0,-.33*d.height,"Journal",{...w,fontSize:48}).setOrigin(.5));const r=this.player.journal.journal.map((t=>`- ${Pa[t].description}\n`)).reverse();new Ol(this,.13*d.width,.25*d.height,r,{fontSize:32}).setBoxSize(.74*d.width,.62*d.height),new xl(this).setVisible(!1),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()})),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.close()})),null==(i=this.input.keyboard)||i.on("keydown-BACKSPACE",(()=>{this.close()}))}close(){this.scene.stop(),this.scene.resume("Game")}}function Al(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function El(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Al(Object(i),!0).forEach((function(e){Cl(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Al(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Cl(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Ml(t){return t.slice(0,-1)}function zl(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function Ll(t){return[...new Set(t)]}function Bl(t,e){const i=Ll(t.map((t=>t.set))).filter(Boolean),n=(r=zl(1,t.length+1),s=i,[r,s].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var r,s;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=n[e]))}function Fl(t,e,i=.5){Ml(t).forEach(((n,r)=>{const s=t[r+1],o=n.set!==s.set,a=e()<=i;var l,h,c;o&&a&&(l=t,h=s.set,c=n.set,l.forEach((t=>{t.set===h&&(t.set=c)})),n.right=!1,s.left=!1)}))}const Wl=48;class Dl extends i.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"nextUpdate")}init(t){this.parent=t.parent}create(){this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,.8*Wl,.8*Wl,5601177).setSmoothness(32).setOrigin(-.13),this.cameras.main.startFollow(this.mazePlayer),this.keys=this.parent.keys}createMaze(){const t=Na(this.parent.player.scene);this.maze=function(t=8,e=t,i=!0,n=1){const r=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(n),s=[],o=zl(t);for(let h=0;h<e;h+=1){const n=o.map((n=>({x:n,y:h,top:i||h>0,left:i||n>0,bottom:i||h<e-1,right:i||n<t-1})));s.push(n)}Ml(s).forEach(((t,e)=>{Bl(t,r),Fl(t,r),function(t,e,i){const n=Object.values(function(t,e){let i=Ll(t.map((t=>t.set))).reduce(((t,e)=>El(El({},t),{},{[e]:[]})),{});return t.forEach((t=>i[t.set].push(t))),i}(t)),{ceil:r}=Math;n.forEach((t=>{(function(t,e,i){e=null==e?1:e;const n=null==t?0:t.length;if(!n||e<1)return[];e=e>n?n:e;let r=-1;const s=n-1,o=[...t];for(;++r<e;){const t=r+Math.floor(i()*(s-r+1)),e=o[t];o[t]=o[r],o[r]=e}return o.slice(0,e)})(t,r(i()*t.length),i).forEach((t=>{if(t){const i=e[t.x];t.bottom=!1,i.top=!1,i.set=t.set}}))}))}(t,s[e+1],r)}));const a=(l=s)[l.length-1];var l;return Bl(a,r),Fl(a,r,1),s}(24,24,!0,t),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,Wl,Wl),this.graphics.lineStyle(3,3385907),this.maze.forEach((t=>{t.forEach((t=>{if(t.top){const e=new i.Geom.Line(t.x*Wl,t.y*Wl,t.x*Wl+Wl,t.y*Wl);this.graphics.strokeLineShape(e)}if(t.bottom){const e=new i.Geom.Line(t.x*Wl,t.y*Wl+Wl,t.x*Wl+Wl,t.y*Wl+Wl);this.graphics.strokeLineShape(e)}if(t.left){const e=new i.Geom.Line(t.x*Wl,t.y*Wl,t.x*Wl,t.y*Wl+Wl);this.graphics.strokeLineShape(e)}if(t.right){const e=new i.Geom.Line(t.x*Wl+Wl,t.y*Wl,t.x*Wl+Wl,t.y*Wl+Wl);this.graphics.strokeLineShape(e)}}))})),this.cameras.main.setViewport(50,130,d.width-100,d.height-170)}update(t,e){if(t<this.nextUpdate)return;const n=this.keys.keys;n[la.Continue];const r=new i.Math.Vector2(0,0);n[la.Left]?r.x=-48:n[la.Right]?r.x=Wl:n[la.Up]?r.y=-48:n[la.Down]&&(r.y=Wl);const s=new i.Math.Vector2(this.mazePlayer.x+r.x,this.mazePlayer.y+r.y);if((this.mazePlayer.x!==s.x||this.mazePlayer.y!==s.y)&&this.canMove(s)){this.mazePlayer.setPosition(s.x,s.y);const t=new i.Math.Vector2(1104,1104);this.parent.setAngle(i.Math.Angle.BetweenPoints(s,t)),this.mazePlayer.x===t.x&&this.mazePlayer.y===t.y&&this.parent.close(!0)}this.nextUpdate=t+140}canMove(t){const e=t.x,n=t.y,r=i.Math.FloorTo(e/Wl),s=i.Math.FloorTo(n/Wl);if(r<0||s<0||r>=24||s>=24)return!1;const o=i.Math.FloorTo(this.mazePlayer.x/Wl),a=i.Math.FloorTo(this.mazePlayer.y/Wl),l=this.maze[a][o];return!(l.top&&n<this.mazePlayer.y||l.bottom&&n>this.mazePlayer.y||l.left&&e<this.mazePlayer.x||l.right&&e>this.mazePlayer.x)}}class Rl extends i.Scene{constructor(){super("MazeDialog"),e(this,"player"),e(this,"container"),e(this,"arrow"),e(this,"keys")}init(t){this.player=t.player}create(){var t,e;this.container=this.add.container(d.width/2,d.height/2),this.container.add(this.add.rectangle(0,0,.95*d.width,.95*d.height,0,.9).setStrokeStyle(4,b(m.Tan))),this.container.add(new Ka(this,.44*d.width,-.4*d.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*d.height,"Find your way through the forest",{...w,fontSize:48}).setOrigin(.5)),this.arrow=this.add.image(.4*-d.width,.4*-d.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new xl(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new ha(this),this.scene.launch("Maze",{parent:this})}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}close(t){this.scene.stop(),this.scene.stop("Maze"),this.scene.resume("Game"),t?(La(ta.Forest,this.player),this.player.journal.addEntry(sa.ForestMazeSolved)):this.player.setPosition(Ca[ta.TownEast].x-40,Ca[ta.TownEast].y)}}class _l extends i.Scene{constructor(){super("Paused"),e(this,"parent")}init(t){this.parent=t.game}create(){var t;const{width:e,height:i}=d;this.add.rectangle(e/2,i/2,e,i,0,.75).setInteractive().on("pointerdown",(()=>this.resume())),this.add.text(e/2,100,"Game Paused",{...w,fontSize:72}).setOrigin(.5),this.add.text(e-20,20,`Build Time: ${new Date("2024-08-09T07:37:19.494Z").toLocaleString()}`,{...w,fontSize:16}).setOrigin(1,0);const n=!d.zoomed,r=n?100:80,s=n?48:36,o=n?220:180,a=new Qa(this);a.addButton(new Ka(this,e/2,o,"Resume",(()=>this.resume()),{fontSize:s})),a.addButton(new Ka(this,e/2,o+r,"Save",(()=>{this.resume(),ul(this.parent)}),{fontSize:s})),a.addButton(new Ka(this,e/2,o+2*r,"Load",(()=>{this.resume(),this.parent.scene.restart()}),{fontSize:s})),a.addButton(new Ka(this,e/2,o+3*r,"Toggle Gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}),{fontSize:s})),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume())),new xl(this).setVisible(!1)}resume(){this.scene.stop(),this.scene.resume("Game")}}var Ul=(t=>(t.Straight="S",t.Corner="C",t.T="T",t.Cross="X",t.Empty=" ",t))(Ul||{}),Gl=(t=>(t[t.Up=0]="Up",t[t.Right=90]="Right",t[t.Down=180]="Down",t[t.Left=270]="Left",t))(Gl||{});const Nl={S:[[0,0,0],[1,1,1],[0,0,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},Hl=[["C"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "],["T","C"," "," "," ","C","C"," ","C","S","T","X"," "," "," "," "],[" ","S"," "," "," ","T","S"," ","X"," "," ","S"," "," "," "," "],[" ","X","S","T"," ","S","S"," ","X"," "," ","X","X","T"," "," "],[" "," "," ","C","X","T","T","X","S"," "," ","T","C","S"," "," "],[" "," "," "," "," "," "," ","X","T"," "," "," "," ","S"," "," "],[" "," "," "," "," "," "," ","S","T"," "," "," "," ","T","S","C"],[" "," "," "," "," "," "," ","C","C"," "," "," "," "," "," ","C"]].map((t=>t.map((t=>t))));function $l(t,e,i){const n=[],r=new Set,s=t.length,o=t[0].length;return function e(i,a){const l=`${i},${a}`;r.add(l),n.push(t[a][i]),i+1<o&&!r.has(`${i+1},${a}`)&&Vl(t[a][i],t[a][i+1])&&e(i+1,a),i-1>=0&&!r.has(`${i-1},${a}`)&&Vl(t[a][i],t[a][i-1])&&e(i-1,a),a+1<s&&!r.has(`${i},${a+1}`)&&Vl(t[a][i],t[a+1][i])&&e(i,a+1),a-1>=0&&!r.has(`${i},${a-1}`)&&Vl(t[a][i],t[a-1][i])&&e(i,a-1)}(e,i),n}function Vl(t,e){if(!t||!e)return!1;const i=ql(t),n=ql(e),r=e.x-t.x,s=e.y-t.y;return 1===r&&0===s?i.right&&n.left:-1===r&&0===s?i.left&&n.right:0===r&&1===s?i.bottom&&n.top:0===r&&-1===s&&i.top&&n.bottom}function ql(t){const e=function(t){let e=Nl[t.type];const i=Math.floor(t.rotation/90);for(let n=0;n<i;n++)e=Kl(e);return e}(t);return{left:e.some((t=>1===t[0])),right:e.some((t=>1===t[t.length-1])),top:e[0].some((t=>1===t)),bottom:e[e.length-1].some((t=>1===t))}}function Kl(t){return t[0].map(((e,i)=>t.map((t=>t[i])).reverse()))}class Ql extends i.Scene{constructor(){super("Pipes"),e(this,"parent"),e(this,"graphics"),e(this,"cursor"),e(this,"position"),e(this,"keys"),e(this,"pipes",[]),e(this,"images"),e(this,"blockSize"),e(this,"pipeSize"),e(this,"nextUpdate",0),e(this,"initialized",!1)}init(t){this.parent=t.parent,this.blockSize=d.zoomed?13:17,this.pipeSize=3.75*this.blockSize}preload(){this.prerenderPipes()}prerenderPipes(){for(const t of Object.values(Ul).filter((t=>"number"!=typeof t))){const e=Nl[t],i=`pipe_${t}`;this.textures.exists(i)&&this.textures.remove(i);const n=this.textures.createCanvas(i,3*this.blockSize,3*this.blockSize);if(n){const t=n.context;t.fillStyle="#ffffff";for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++)1===e[i][n]&&t.fillRect(n*this.blockSize,i*this.blockSize,this.blockSize,this.blockSize);n.refresh()}}}create(){this.graphics=this.add.graphics(),this.keys=this.parent.keys,this.cursor=this.add.rectangle(100,100,this.pipeSize,this.pipeSize,0,0).setStrokeStyle(2,b(m.Tan),.75).setVisible(!1),this.position=new i.Math.Vector2(0,0),this.createPipes()}createPipes(){this.pipes=[],this.images=this.add.container().setPosition(d.width/2-16*this.pipeSize/2+this.pipeSize/2,d.height/4);for(let n=0;n<8;n++){this.pipes[n]||(this.pipes[n]=[]);for(let e=0;e<16;e++){let r=Hl[n][e];const s=0===e&&0===n,o=15===e&&7===n;let a=!s&&!o;r===Ul.Empty&&Math.random()<.9&&(r=(t=Object.values(Ul).filter((t=>"number"!=typeof t)))[Math.floor(Math.random()*t.length)],r===Ul.Cross&&Math.random()<.5&&(r=Ul.T),Math.random()<.25&&(a=!1)),this.pipes[n][e]={x:e,y:n,type:r,rotation:90*i.Math.Between(0,3),interactive:a},s&&(this.pipes[n][e].rotation=Gl.Up),o&&(this.pipes[n][e].rotation=Gl.Down)}}var t;const e=$l(this.pipes,0,0);for(let i=0;i<8;i++)for(let t=0;t<16;t++){const n=t+i*Hl[0].length,r=this.pipes[i][t];this.time.delayedCall(50+5*n,(()=>{const n=`pipe_${r.type}`,s=this.add.image(t*this.pipeSize,i*this.pipeSize,n).on("pointerdown",(()=>{this.initialized&&(this.cursor.setVisible(!1),this.pipes[i][t].rotation=(this.pipes[i][t].rotation+90)%360,this.updatePipes())})),o=15===t&&7===i;s.setAlpha(0).setScale(.5).setAngle(this.pipes[i][t].rotation),this.tweens.add({targets:s,alpha:1,scale:1,duration:300,onComplete:o?()=>{this.initialized=!0,this.updatePipes()}:void 0}),r.interactive?s.setInteractive():s.setTint(6710886),e.includes(r)&&(r.interactive?s.setTint(3364249):s.setTint(8789)),this.images.add(s)}))}}updatePipes(){const t=$l(this.pipes,0,0);this.pipes.forEach((e=>{e.forEach((e=>{const i=this.images.getAt(e.x+e.y*Hl[0].length);i.setAngle(e.rotation),t.includes(e)?(e.interactive?i.setTint(3364249):i.setTint(8789),e.x===Hl[0].length-1&&e.y===Hl.length-1&&this.parent.time.delayedCall(500,(()=>{this.parent.close(!0)}))):e.interactive?i.setTint(16777215):i.setTint(6710886)}))}))}update(t,e){if(this.initialized&&t<this.nextUpdate)return;let i=!0;const n=this.keys.keys;if(n[la.Continue]){const t=this.pipes[this.position.y][this.position.x];t.interactive&&(t.rotation=(t.rotation+90)%360,this.updatePipes())}else n[la.Left]?this.position.x=Math.max(0,this.position.x-1):n[la.Right]?this.position.x=Math.min(15,this.position.x+1):n[la.Up]?this.position.y=Math.max(0,this.position.y-1):n[la.Down]?this.position.y=Math.min(7,this.position.y+1):i=!1;i&&(this.nextUpdate=t+170,this.cursor.setVisible(!0),this.cursor.setPosition(this.images.x+this.position.x*this.pipeSize,this.images.y+this.position.y*this.pipeSize))}}class Xl extends i.Scene{constructor(){super("PipesDialog"),e(this,"player"),e(this,"container"),e(this,"keys")}init(t){this.player=t.player}create(){var t,e,i;this.container=this.add.container(d.width/2,d.height/2),this.container.add(this.add.rectangle(0,0,.95*d.width,.95*d.height,0,.9).setStrokeStyle(4,b(m.Tan))),this.container.add(new Ka(this,.44*d.width,-.4*d.height,"X",(()=>this.close(!1)),{backgroundColor:`#${m.Warning}`})),this.container.add(this.add.text(0,-.4*d.height,"Rotate the pipes to fix the equipment",{...w,fontSize:48}).setOrigin(.5)),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),null==(i=this.input.keyboard)||i.on("keydown-BACK_SLASH",(()=>{this.close(!0)})),new xl(this).setVisible(!1),this.keys=new ha(this),this.scene.launch("Pipes",{parent:this})}close(t){var e,i;this.scene.stop(),this.scene.stop("Pipes"),this.scene.resume("Game"),t&&(this.player.message.setDialog({messages:["There. It looks like the alchemy set is properly fit back together."]},(e=this.player.scene,i=oa.AlchemySet,_a(e,Oa).find((t=>t.propType===i))),"player_portrait"),this.player.journal.addEntry(sa.AlchemySetFixed))}}class Yl extends i.Scene{constructor(){super("Preloader"),e(this,"container")}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(d.width,d.height),this.add.image(30,d.height-15,"logo").setOrigin(0,1).setScale(.25);const t=.68*d.width,e=this.add.container(.23*d.width,.91*d.height);this.container=e;const i=this.add.rectangle(0,0,t,26).setStrokeStyle(1,16777215,.85).setOrigin(0);e.add(i);const n=this.add.rectangle(3,3,0,20,16777215,.85).setOrigin(0);e.add(n),this.load.on("progress",(e=>{const i=.6*e;n.width=(t-6)*i})),this.load.on("complete",(()=>{this.tweens.add({targets:n,width:t-6,duration:2400})}));const r=document.createElement("img");r.src="assets/icons/settings.svg",r.id="loading",this.add.dom(0,0,r),wa(this,300)}preload(){this.load.setPath("assets"),this.load.svg("sun","icons/sun.svg",{width:64,height:64}),this.load.svg("moon","icons/moon.svg",{width:64,height:64}),this.load.svg("settings","icons/settings.svg",{width:64,height:64}),this.load.svg("zoom-in","icons/zoom-in.svg",{width:64,height:64}),this.load.svg("zoom-out","icons/zoom-out.svg",{width:64,height:64}),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("mansion_outside","maps/mansion_outside_hatch.jpg"),this.load.image("mansion_inside","maps/mansion_inside.jpg"),this.load.image("alchemy_lab","maps/alchemy_lab.jpg"),this.load.image("ladder","ladder.png"),this.load.image("warp","warp.png"),this.load.image("watch","watch.png"),this.load.image("arrow","arrow.png"),this.load.image("gear","items/gear.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.image("key","items/key.png"),this.load.image("herb_red","items/herb_red.png"),this.load.image("herb_green","items/herb_green.png"),this.load.image("herb_blue","items/herb_blue.png"),this.load.image("potion","items/potion.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),this.load.image("player_portrait","characters/player_portrait.png"),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png"),this.load.image("clock_portrait","characters/clock_portrait.png"),this.load.image("book","props/book.png"),this.load.image("picture","props/picture.png"),this.load.image("alchemy_empty","props/alchemy/alchemy_empty.png"),this.load.image("alchemy_green","props/alchemy/alchemy_green.png"),this.load.image("alchemy_red","props/alchemy/alchemy_red.png"),this.load.image("alchemy_blue","props/alchemy/alchemy_blue.png"),this.load.image("alchemy_full","props/alchemy/alchemy_full.png")}create(){this.time.delayedCall(3e3,(()=>{xa(this,300,(()=>{this.scene.stop(this),this.scene.start("Game")}))}))}}!function(t={}){const{immediate:e=!1,onNeedRefresh:i,onOfflineReady:n,onRegistered:r,onRegisteredSW:s,onRegisterError:a}=t;let l,h;h=async function(){if("serviceWorker"in navigator){if(l=await function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){const t=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),s=(null==r?void 0:r.nonce)||(null==r?void 0:r.getAttribute("nonce"));n=Promise.all(e.map((e=>{if(e=function(t,e){return new URL(t,e).href}(e,i),e in o)return;o[e]=!0;const n=e.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(i)for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.href===e&&(!n||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=n?"stylesheet":"modulepreload",n||(a.as="script",a.crossOrigin=""),a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),n?new Promise(((t,i)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}return n.then((()=>t())).catch((t=>{const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}))}((()=>import("./workbox-window.prod.es5-B8JjyKVo.js")),[],import.meta.url).then((({Workbox:t})=>new t("./sw.js",{scope:"./",type:"classic"}))).catch((t=>{null==a||a(t)})),!l)return;l.addEventListener("activated",(t=>{(t.isUpdate||t.isExternal)&&window.location.reload()})),l.addEventListener("installed",(t=>{t.isUpdate||null==n||n()})),l.register({immediate:e}).then((t=>{s?s("./sw.js",t):null==r||r(t)})).catch((t=>{null==a||a(t)}))}}()}({immediate:!0});const Jl={type:Phaser.AUTO,width:d.width,height:d.height,parent:"game-container",backgroundColor:b(m.Background),scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[y,Yl,Il,_l,Pl,Rl,Dl,Xl,Ql],input:{gamepad:!0},physics:{default:"arcade"},render:{pixelArt:!0,antialias:!1},dom:{createContainer:!0}};("m6x11","./m6x11.ttf",new FontFace("m6x11","url(./m6x11.ttf)").load().then((function(t){document.fonts.add(t)})).catch((function(t){return t}))).then((()=>{new i.Game(Jl)}));
