var t=Object.defineProperty,e=(e,r,n)=>(((e,r,n)=>{r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n})(e,"symbol"!=typeof r?r+"":r,n),n);import{p as r,g as n,c as o,a as i}from"./phaser-pZmLa9DQ.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const r of t)if("childList"===r.type)for(const t of r.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();let a=!1;a=!0;let s=!1;a=!1,s=!1;const c={debug:!1,width:1024,height:768,cameraOffset:256,dayMinutes:.25,rewindEnabled:!1,fastMode:!1};class l extends r.Scene{constructor(){super("Boot")}preload(){}create(){this.scene.start("Preloader")}}const p="fcfee9",u="e6c99d",h="303646",y="1c1831";function f(t){return Phaser.Display.Color.HexStringToColor(t).color}const d={fontFamily:"m5x7, sans-serif",fontSize:48,color:`#${p}`};class g extends r.GameObjects.Container{constructor(t,r,n){super(t,40,c.height-60),e(this,"currentTime",0),e(this,"rewindCount",0),e(this,"player"),e(this,"rewindable"),e(this,"rewinding",!1),e(this,"counter",0),e(this,"bar"),e(this,"hand"),e(this,"timeText"),e(this,"dayOver"),this.setVisible(c.rewindEnabled).setDepth(1).setScrollFactor(0),this.scene.add.existing(this),this.rewindable=r,this.player=n,this.add(t.add.sprite(0,0,"watch").setScale(.25)),this.hand=t.add.rectangle(0,10,3,14,f(y)).setOrigin(0,0),this.add(this.hand),this.timeText=t.add.text(15,10,"",d).setScrollFactor(0),this.bar=t.add.rectangle(0,c.height-6,0,6,13412864).setScrollFactor(0)}update(t,e){}}var m=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t))(m||{}),b=(t=>(t[t.Underground=0]="Underground",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.TownNorth=6]="TownNorth",t[t.ClockSquare=7]="ClockSquare",t[t.ClockSquareNorth=8]="ClockSquareNorth",t[t.ClockEntrance=9]="ClockEntrance",t[t.ClockStairs=10]="ClockStairs",t[t.ClockTop=11]="ClockTop",t))(b||{}),v=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t))(v||{}),w=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t))(w||{}),S=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.ClockTower=4]="ClockTower",t))(S||{}),x=(t=>(t[t.Sphinx=0]="Sphinx",t))(x||{}),j=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.SphinxRiddleSolved=1]="SphinxRiddleSolved",t[t.MeetTheMayor=2]="MeetTheMayor",t))(j||{});const O={[v.Wrench]:{x:0,y:0,image:"wrench"},[v.Gear1]:{x:5120,y:915,image:"gear"}};class P extends Phaser.Physics.Arcade.Sprite{constructor(t,r,n){const{x:o,y:i,image:a}=O[r];super(t,o,i,a),e(this,"itemType"),e(this,"player"),e(this,"particles"),this.itemType=r,this.player=n,this.scale=.35,t.add.existing(this),t.physics.add.existing(this),c.debug&&this.setInteractive({draggable:!0}),this.particles=t.add.particles(o,i,"warp",{speed:{min:2,max:10},scale:{start:.1,end:.9},alpha:{start:.8,end:0},lifespan:500,frequency:1e3})}onInteract(t){return t.SPACE.isDown||t.ENTER.isDown?(this.player.inventory.addItem(this.itemType),this.destroy(),m.Item):m.None}destroy(t){super.destroy(t),this.particles.destroy()}getButtonPrompt(){return[`Pick Up ${v[this.itemType]}`,"Press [CONTINUE]"]}}const k=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:1020,y:-1380},{x:750,y:-2075},{x:900,y:-2075},{x:2600,y:760},{x:3600,y:760,id:x.Sphinx},{x:4575,y:870},{x:5150,y:870}];class T extends r.Physics.Arcade.StaticGroup{constructor(t){super(t.physics.world,t),k.forEach((e=>{const r=t.add.rectangle(e.x,e.y,6,100).setOrigin(0).setVisible(c.debug);r.setData("WallType",e.id),c.debug&&r.setInteractive({draggable:!0}),this.add(r)}))}}const I={[b.Town]:{x:300,y:650,key:[Phaser.Input.Keyboard.KeyCodes.DOWN],warpTo:b.Underground,visual:0},[b.Underground]:{x:301,y:875,key:[Phaser.Input.Keyboard.KeyCodes.UP],warpTo:b.Town,visual:0},[b.TownEast]:{x:1720,y:650,key:[Phaser.Input.Keyboard.KeyCodes.RIGHT,Phaser.Input.Keyboard.KeyCodes.D],warpTo:b.Forest,visual:2},[b.Forest]:{x:2650,y:810,key:[Phaser.Input.Keyboard.KeyCodes.LEFT,Phaser.Input.Keyboard.KeyCodes.A],warpTo:b.TownEast,visual:1},[b.TownNorth]:{x:775,y:650,key:[Phaser.Input.Keyboard.KeyCodes.UP],warpTo:b.ClockSquare,visual:2},[b.ClockSquare]:{x:720,y:-330,key:[Phaser.Input.Keyboard.KeyCodes.DOWN],warpTo:b.TownNorth,visual:1},[b.ClockSquareNorth]:{x:915,y:-330,key:[Phaser.Input.Keyboard.KeyCodes.UP],warpTo:b.ClockEntrance,visual:2},[b.ClockEntrance]:{x:900,y:-1320,key:[Phaser.Input.Keyboard.KeyCodes.DOWN],warpTo:b.ClockSquareNorth,visual:1},[b.ClockStairs]:{x:735,y:-1320,key:[Phaser.Input.Keyboard.KeyCodes.UP],warpTo:b.ClockTop,visual:1},[b.ClockTop]:{x:790,y:-2005,key:[Phaser.Input.Keyboard.KeyCodes.DOWN],warpTo:b.ClockStairs,visual:1},[b.ForestEast]:{x:3590,y:810,key:[Phaser.Input.Keyboard.KeyCodes.RIGHT,Phaser.Input.Keyboard.KeyCodes.D],warpTo:b.Lake,visual:2},[b.Lake]:{x:4625,y:915,key:[Phaser.Input.Keyboard.KeyCodes.LEFT,Phaser.Input.Keyboard.KeyCodes.A],warpTo:b.ForestEast,visual:1}};class A extends r.Physics.Arcade.Sprite{constructor(t,n,o){const{x:i,y:a,visual:s,warpTo:l}=I[n];if(super(t,i,a,0===s?"ladder":"warp"),e(this,"warpType"),e(this,"player"),e(this,"particles1"),e(this,"particles2"),this.warpType=n,this.player=o,this.scale=.5,t.add.existing(this),t.physics.add.existing(this),c.debug){this.setInteractive({draggable:!0});const e=I[l],r=t.add.graphics(),o=n%2==0?16776960:65535;r.fillStyle(o),r.lineStyle(3,o);let s=-this.displayWidth/2,c=-this.displayHeight/2;e.x>i&&(s*=-1),e.y>a&&(c*=-1);const p=new Phaser.Geom.Line(i+s,a+c,e.x+s,e.y+c);r.strokeLineShape(p),r.fillRect(i+s-7,a+c-7,14,14)}0!==s&&(this.particles1=t.add.particles(i,a,"warp",{x:{min:-3,max:3},y:{min:-3,max:3},speed:{random:[-40,40]},scale:{min:.35,max:.5},alpha:{start:.2,end:0},angle:{min:0,max:360},color:[f(h),f(p),f(u)],colorEase:"Linear",radial:!0,blendMode:r.BlendModes.OVERLAY}).setScale(1,1.75),this.particles2=t.add.particles(i,a,"warp",{x:{min:-30,max:30},y:{min:-50,max:50},speed:{random:[-5,5]},scale:{min:.05,max:.15},alpha:{values:[0,.2,0]},angle:{min:0,max:360},lifespan:{min:1e3,max:1400},color:[f("d07151"),f(p),f(u)],colorEase:"Linear",radial:!0,maxAliveParticles:20})),n===b.Underground&&(t.add.sprite(i,a-60,"ladder").setScale(.5),t.add.sprite(i,a-105,"ladder").setScale(.5)),this.setVisible(2!==s)}onInteract(t){let e=!1;const r=I[this.warpType].key;return Object.values(t).forEach((t=>{t.isDown&&r.includes(t.keyCode)&&(e=!0)})),e&&this.warpType===b.TownEast&&!c.debug?(this.scene.scene.pause(),this.scene.scene.launch("MazeDialog",{player:this.player}),m.None):e?(E(I[this.warpType].warpTo,this.player),m.Teleported):m.None}getButtonPrompt(){const t=I[this.warpType].key.map((t=>t===Phaser.Input.Keyboard.KeyCodes.ENTER||t===Phaser.Input.Keyboard.KeyCodes.SPACE?"[CONTINUE]":t===Phaser.Input.Keyboard.KeyCodes.UP||t===Phaser.Input.Keyboard.KeyCodes.W?"[UP]":t===Phaser.Input.Keyboard.KeyCodes.DOWN||t===Phaser.Input.Keyboard.KeyCodes.S?"[DOWN]":t===Phaser.Input.Keyboard.KeyCodes.LEFT||t===Phaser.Input.Keyboard.KeyCodes.A?"[LEFT]":t===Phaser.Input.Keyboard.KeyCodes.RIGHT||t===Phaser.Input.Keyboard.KeyCodes.D?"[RIGHT]":"[UNKNOWN]")),e=[...new Set(t)];return[`Travel to ${b[I[this.warpType].warpTo]}`,"Press "+e.join(" or ")]}setVisible(t){return super.setVisible(t),this.particles1&&this.particles2&&(t?(this.particles1.start(),this.particles2.start()):(this.particles1.stop(),this.particles1.killAll(),this.particles2.stop(),this.particles2.killAll())),this}destroy(t){this.particles1&&this.particles2&&(this.particles1.destroy(),this.particles2.destroy()),super.destroy(t)}}function E(t,e){const{x:r,y:n}=I[t],o=e.scene,i=r-o.cameras.main.width/2,a=n-o.cameras.main.height/2;o.cameras.main.stopFollow(),e.setActive(!1),o.tweens.add({targets:o.cameras.main,scrollX:i,scrollY:a-c.cameraOffset,duration:400,ease:"Power1",onComplete:()=>{o.cameras.main.startFollow(e),o.cameras.main.setFollowOffset(0,c.cameraOffset),e.setActive(!0)}}),o.tweens.add({targets:e,alpha:0,duration:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e.setPosition(r,n)},onComplete:()=>{e.alpha=1}})}function C(t,e){var n,o;const i=function(t,e){return M(t,q).find((t=>t.npcType===e))}(t,S.Sphinx);F(t,b.ForestEast,!0===e);const a=function(t,e){return M(t,r.GameObjects.Rectangle).find((t=>t.getData("wallType")===e))}(t,x.Sphinx);if(a&&(e?a.setX((null==(n=k.find((t=>t.id===x.Sphinx)))?void 0:n.x)||0):a.setX(a.x-150),null==(o=a.body)||o.updateFromGameObject()),!i)return;const{x:s,y:c}=B[S.Sphinx];t.tweens.add({targets:i,alpha:0,duration:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e?i.setPosition(s+200,c-90):i.setPosition(s,c)},onComplete:()=>{i.alpha=1}})}function M(t,e){return t.children.getAll().filter((t=>t instanceof e))}function F(t,e,r){const n=function(t,e){return M(t,A).find((t=>t.warpType===e))}(t,e);n&&n.setVisible(r)}function D(t){return t.scene.get("Game").clock.rewindCount||0}const N=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[S.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[S.Stranger]:["The sphinx’s riddles are always a bit tricky. I think this one is","about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[S.Inventor]:["Think of something that represents the world, showing cities","and mountains but not in a literal way."],[S.Stranger]:["Imagine something that can fit in your hand or hang on a wall,","showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[S.Inventor]:["The sphinx’s riddles can be tricky. Think about things that move","or change without the usual parts, like wings or eyes."],[S.Stranger]:["Look at your surroundings. Shadows often behave in strange ways,","don’t they? They move, disappear, and seem to fly without wings."]}}];function R(t){return D(t)%N.length}function W(t,e){const r=R(t);return N[r].hints[e]}const _={[S.Inventor]:[{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:v.Gear1}},{messages:t=>W(t.scene,S.Inventor),conditions:{activeQuest:w.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:v.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench, but","you’ll need three special gears to fix it. You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(j.FixTheClock),t.inventory.addItem(v.Wrench)}}],[S.Stranger]:[{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:v.Gear1}},{messages:t=>W(t.scene,S.Stranger),conditions:{activeQuest:w.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s","creatures and traps. One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:v.Wrench},onCompleted:t=>{t.quests.addQuest({id:w.ForestGear,completed:!1}),F(t.scene,b.TownEast,!0)}},{messages:["Who am I?","Eventually, you will learn."]}],[S.Sphinx]:[{messages:t=>function(t){const e=R(t);return[N[e].question]}(t.scene),options:t=>function(t){const e=R(t),r=[...N[e].options].sort((()=>Math.random()-.5));return r.push("I don’t know"),r}(t.scene),conditions:{activeQuest:w.SphinxRiddle},onSelected:(t,e,r)=>{t===function(t){const e=R(t);return N[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(w.SphinxRiddle,!0),t.journal.addEntry(j.SphinxRiddleSolved)}},r):"I don’t know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},r):e.message.setDialog({messages:["That is not correct. Do not return."]},r)}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:w.SphinxRiddle,completed:!1})}}],[S.Mayor]:[{messages:["Hello, traveler. I am the mayor of this town.","The clock tower has been broken for years."]}],[S.ClockTower]:[{messages:["This dusty clock tower hasn't told the correct time in many years.","It appears to be missing some gears."]}]};function U(t,e){return t.some((t=>t.id===e&&!t.completed))}function G(t,e){return t.some((t=>t.id===e&&t.completed))}const B={[S.Inventor]:{x:550,y:635,scale:.75,img:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[S.Stranger]:{x:750,y:865,scale:1.35,img:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[S.Sphinx]:{x:3520,y:780,scale:1,img:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:t=>C(t.scene,!1)},[S.Mayor]:{x:1065,y:-340,scale:.9,img:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[S.ClockTower]:{x:880,y:-2090,scale:.7,img:"warp",portrait:"",name:"Clock Tower"}};class q extends Phaser.Physics.Arcade.Sprite{constructor(t,r,n){const{x:o,y:i,img:a,scale:s,onCreate:l}=B[r];super(t,o,i,a),e(this,"npcType"),e(this,"player"),this.npcType=r,this.player=n,this.scale=s,t.add.existing(this),t.physics.add.existing(this),c.debug&&this.setInteractive({draggable:!0}),l&&l(this)}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return m.None;if(t.SPACE.isDown||t.ENTER.isDown){const t=function(t,e){const r=_[t]||[];for(const s of r){const{conditions:t}=s,r=[];if(void 0!==(null==t?void 0:t.hasItem)&&r.push((i=e.inventory.inventory,a=t.hasItem,i.includes(a))),void 0!==(null==t?void 0:t.completedQuest)&&r.push(G(e.quests.quests,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&r.push(U(e.quests.quests,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&r.push((n=e.journal.journal,o=t.journalEntry,n.includes(o))),null==t?void 0:t.invert)if(null==t?void 0:t.or){if(r.every((t=>!t)))return s}else if(r.every((t=>!t)))return s;if(null==t?void 0:t.or){if(r.some((t=>t)))return s}else if(r.every((t=>t)))return s}var n,o,i,a}(this.npcType,this.player);if(!t)return m.None;const e=B[this.npcType].portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),m.Talked}return m.None}getButtonPrompt(){return this.npcType===S.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${B[this.npcType].name}`,"Press [CONTINUE]"]}}class L extends r.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),this.setScrollFactor(0).setDepth(1).setVisible(!1),t.add.existing(this),this.rect=t.add.rectangle(0,0,0,0,f(h)).setStrokeStyle(2,f(p)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=t.add.text(10,0,"Inventory",d),this.add(this.text)}addItem(t){this.inventory.push(t),this.add(this.scene.add.sprite(0,0,O[t].image).setScale(.35)),this.updateItems();const e=function(t,e){return M(t,P).find((t=>t.itemType===e))}(this.scene,t);e&&e.destroy()}removeItem(t){var e;const r=this.inventory.indexOf(t);r>-1&&(this.inventory.splice(r,1),null==(e=this.getAll().find((e=>{var r;return(null==(r=e.texture)?void 0:r.key)===O[t].image})))||e.destroy()),this.updateItems()}updateItems(){let t=0;this.getAll().forEach((e=>{if(e instanceof r.GameObjects.Sprite){const r=32+50*t;e.setPosition(r,72),t++}})),this.setVisible(this.inventory.length>0);const e=Math.max(this.text.displayWidth+18,50*t+12);this.setPosition(c.width-e-20,20),this.rect.setSize(e,104)}}class K extends r.GameObjects.Text{constructor(t,e){super(t,20,30,e,{...d,backgroundColor:"#"+h,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(2).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,duration:350,hold:3500,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}class $ extends r.GameObjects.Sprite{constructor(t,r){super(t,c.width-50,c.height-55,"journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),this.setScrollFactor(0).setDepth(1).setScale(.5).setAlpha(0).setInteractive().setActive(!1),this.on("pointerdown",this.openJournal),t.add.existing(this),this.player=r,this.unread=t.add.ellipse(c.width-20,c.height-90,20,20,11141120).setStrokeStyle(2,f(y)).setScrollFactor(0).setDepth(2).setVisible(!1)}addEntry(t,e){this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new K(this.scene,"New joural entry added!")),this.handleSideEffects(t))}openJournal(){0!==this.journal.length&&(this.unread.setVisible(!1),this.scene.scene.pause(),this.scene.scene.launch("JournalDialog",{player:this.player}))}handleSideEffects(t){t===j.SphinxRiddleSolved&&C(this.scene,!0)}}const z={[w.ForestGear]:"Find the gear in the forest",[w.SphinxRiddle]:"Solve the Sphinx riddle"};class V extends r.GameObjects.Container{constructor(t){super(t,c.width-330-20,120),e(this,"quests",[]),e(this,"questRectangle"),t.add.existing(this),this.setScrollFactor(0).setDepth(1).setVisible(!1),this.questRectangle=t.add.rectangle(0,0,330,60,f(h)).setStrokeStyle(2,f(p)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle),this.add(t.add.text(10,0,"Quests",d))}addQuest(t){this.quests.find((e=>e.id===t.id))||(this.quests.push(t),this.add(this.scene.add.text(0,0,z[t.id],{...d,fontSize:32})),this.updateQuests())}updateExistingQuest(t,e){const r=this.quests.find((e=>e.id===t));r&&(r.completed=e),this.updateQuests()}updateQuests(){const t=this.quests.filter((t=>!t.completed));let e=1,n=0;this.getAll().forEach((o=>{if(o instanceof r.GameObjects.Text)if(t.find((t=>o.text===z[t.id]))||"Quests"===o.text){if("Quests"!==o.text){const t=10+30*e;o.setPosition(10,t),e++,n=Math.max(n,o.width)}}else o.destroy()}));const o=n+20;this.setX(c.width-20-o),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(o,50+30*t.length)}reset(){this.quests=[],this.updateQuests()}}class H extends r.GameObjects.Text{constructor(t){super(t,c.width/2,c.height-50,"",d),this.setOrigin(.5).setBackgroundColor("#"+y).setPadding(10,5).setAlign("center").setAlpha(.9).setScrollFactor(0).setDepth(2).setVisible(!1),t.add.existing(this)}show(t){this.setText(t).setVisible(!0)}hide(){this.setVisible(!1)}}const Q=20,{width:J,height:X}=c,Y=J-120-80;class Z extends r.GameObjects.Container{constructor(t,n){var o,i,a,s;super(t),e(this,"player"),e(this,"npc"),e(this,"npcName"),e(this,"text"),e(this,"box"),e(this,"image"),e(this,"options"),e(this,"optionsContainer"),e(this,"optionIndex"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),t.add.existing(this),this.setScrollFactor(0),this.setPosition(Q,X-Q-170),this.setDepth(3),this.setVisible(!1),this.player=n,this.npcName=new r.GameObjects.Text(t,170,15,"",{...d,color:"#"+u}),this.text=new r.GameObjects.Text(t,170,60,"",d),this.text.width=Y,this.text.height=130,this.text.setOrigin(0).setWordWrapWidth(Y,!0).setFixedSize(Y,130),this.image=new r.GameObjects.Image(t,Q,Q,"").setOrigin(0).setScale(1.5),this.box=new r.GameObjects.Rectangle(t,0,0,J-40,170,f(y),.8),this.box.setStrokeStyle(2,f(u),1),this.box.setOrigin(0,0),this.optionsContainer=t.add.container().setScrollFactor(0),this.add([this.box,this.npcName,this.text,this.image]),null==(o=this.scene.input.keyboard)||o.on("keydown-DOWN",(()=>{this.setOptionIndex(1)})),null==(i=this.scene.input.keyboard)||i.on("keydown-UP",(()=>{this.setOptionIndex(-1)})),null==(a=this.scene.input.keyboard)||a.on("keydown-ENTER",(()=>{this.options?this.onSelectOption(this.options[this.optionIndex]):this.updateDialog()})),null==(s=this.scene.input.keyboard)||s.on("keydown-SPACE",(()=>{this.options?this.onSelectOption(this.options[this.optionIndex]):this.updateDialog()}))}setDialog(t,e){this.setVisible(void 0!==t),this.npc=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,t&&(void 0===e?(this.npcName.setVisible(!1),this.image.setVisible(!1),this.text.setPosition(Q,Q)):(this.npcName.setVisible(!0),this.npcName.setText(B[e.npcType].name),this.image.setVisible(!0),this.image.setTexture(B[e.npcType].portrait),this.text.setPosition(170,60)),this.showMessage())}showMessage(){const t=this.getMessages(),e=t&&t[this.messageIndex];e&&(this.text.setText(e),this.text.getWrappedText().length>2&&console.error("Message too long!",e)),this.updateOptions()}updateOptions(){this.optionIndex=0,this.options=this.getOptions(),this.options&&(this.optionsContainer.removeAll(!0),this.options.forEach(((t,e)=>{const n=new r.GameObjects.Text(this.scene,c.width/2,120+74*e,t,{...d,backgroundColor:"#"+y,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5);0===e&&n.setTint(f(u)),n.setInteractive().on("pointerdown",(()=>{this.onSelectOption(t)})),this.optionsContainer.add(n)})))}setOptionIndex(t){this.options&&(this.optionIndex=r.Math.Clamp(this.optionIndex+t,0,this.options.length-1),this.optionsContainer.getAll().forEach(((t,e)=>{t.setTint(e===this.optionIndex?f(u):16777215)})))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.npc),this.optionsContainer.removeAll(!0))}updateDialog(){if(Date.now()<this.interactionTimeout)return;const t=this.getMessages();this.dialog&&t&&(this.messageIndex++,this.messageIndex>=t.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.npc),this.dialog=void 0,this.setVisible(!1)):this.showMessage(),this.interactionTimeout=Date.now()+350)}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}}const tt=2.5*(c.fastMode?350:120),et=new r.Math.Vector2(400,650);class rt extends Phaser.Physics.Arcade.Sprite{constructor(t){var r,n;super(t,et.x,et.y,"character",0),e(this,"keys"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),this.keys=null==(r=t.input.keyboard)?void 0:r.addKeys("W,A,S,D,UP,DOWN,LEFT,RIGHT,ENTER,SPACE"),t.add.existing(this),t.physics.add.existing(this),c.debug&&this.setInteractive(),this.setBodySize(24,36),this.setOffset(0,0),this.depth=1,this.scale=2.5,(n=this).anims.create({key:"walk",frames:n.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:4,repeat:-1}),n.anims.play("walk"),this.buttonPrompt=new H(t),this.message=new Z(t,this),this.inventory=new L(t),this.quests=new V(t),this.journal=new $(t,this)}update(t,e){c.debug&&this.setTint(this.interactive?16755370:16777215),this.buttonPrompt.setVisible(this.interactive&&!this.message.visible&&this.buttonPrompt.text.length>0||!1);let r=this.quests.shifted;this.quests.shifted=this.inventory.visible,r!==this.quests.shifted&&this.quests.updateQuests(),this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity(),function(t){var e;const r=(null==(e=t.body)?void 0:e.velocity.x)||0,n=r<0;Math.abs(r)>0?(t.anims.resume(),t.flipX=t.rewinding?!n:n):t.anims.pause()}(this)}checkInteraction(){let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys),t!==m.None&&(this.interactionTimeout=Date.now()+(this.interactive.interactionTimeout||500),t===m.Teleported&&(this.interactive=void 0))),t}updateVelocity(){const t=this.keys.LEFT.isDown||this.keys.A.isDown,e=this.keys.RIGHT.isDown||this.keys.D.isDown,r=this.keys.UP.isDown||this.keys.W.isDown,n=this.keys.DOWN.isDown||this.keys.S.isDown;let o=tt;t&&this.setVelocityX(-o),e&&this.setVelocityX(o),c.debug&&!this.interactive&&(r&&this.setVelocityY(-o),n&&this.setVelocityY(o)),t&&e&&this.setVelocityX(0)}record(){var t;this.history.length<1e3?this.history.push(new Phaser.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(et.x,et.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e;this.interactive=t,this.buttonPrompt.setText((null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t))||"")}}r.GameObjects.Container;var nt,ot,it=Object.prototype.toString,at=function(t){var e=it.call(t),r="[object Arguments]"===e;return r||(r="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===it.call(t.callee)),r},st=Array.prototype.slice,ct=at,lt=Object.keys,pt=lt?function(t){return lt(t)}:function(){if(ot)return nt;var t;if(ot=1,!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=at,o=Object.prototype.propertyIsEnumerable,i=!o.call({toString:null},"toString"),a=o.call((function(){}),"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(t){var e=t.constructor;return e&&e.prototype===t},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!l["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{c(window[t])}catch(r){return!0}}catch(r){return!0}return!1}();t=function(t){var o=null!==t&&"object"==typeof t,l="[object Function]"===r.call(t),u=n(t),h=o&&"[object String]"===r.call(t),y=[];if(!o&&!l&&!u)throw new TypeError("Object.keys called on a non-object");var f=a&&l;if(h&&t.length>0&&!e.call(t,0))for(var d=0;d<t.length;++d)y.push(String(d));if(u&&t.length>0)for(var g=0;g<t.length;++g)y.push(String(g));else for(var m in t)f&&"prototype"===m||!e.call(t,m)||y.push(String(m));if(i)for(var b=function(t){if("undefined"==typeof window||!p)return c(t);try{return c(t)}catch(e){return!1}}(t),v=0;v<s.length;++v)b&&"constructor"===s[v]||!e.call(t,s[v])||y.push(s[v]);return y}}return nt=t}(),ut=Object.keys;pt.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return ct(t)?ut(st.call(t)):ut(t)})}else Object.keys=pt;return Object.keys||pt};var ht,yt=pt,ft=Error,dt=EvalError,gt=RangeError,mt=ReferenceError,bt=SyntaxError,vt=TypeError,wt=URIError,St=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(t,e);if(42!==o.value||!0!==o.enumerable)return!1}return!0},xt="undefined"!=typeof Symbol&&Symbol,jt=St,Ot=function(){return"function"==typeof xt&&"function"==typeof Symbol&&"symbol"==typeof xt("foo")&&"symbol"==typeof Symbol("bar")&&jt()},Pt={__proto__:null,foo:{}},kt=Object,Tt=Object.prototype.toString,It=Math.max,At=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var o=0;o<e.length;o+=1)r[o+t.length]=e[o];return r},Et=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||"[object Function]"!==Tt.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var r,n=function(t,e){for(var r=[],n=1,o=0;n<t.length;n+=1,o+=1)r[o]=t[n];return r}(arguments),o=It(0,e.length-n.length),i=[],a=0;a<o;a++)i[a]="$"+a;if(r=Function("binder","return function ("+function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=",");return r}(i)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof r){var o=e.apply(this,At(n,arguments));return Object(o)===o?o:this}return e.apply(t,At(n,arguments))})),e.prototype){var s=function(){};s.prototype=e.prototype,r.prototype=new s,s.prototype=null}return r},Ct=Function.prototype.call,Mt=Object.prototype.hasOwnProperty,Ft=Et.call(Ct,Mt),Dt=ft,Nt=dt,Rt=gt,Wt=mt,_t=bt,Ut=vt,Gt=wt,Bt=Function,qt=function(t){try{return Bt('"use strict"; return ('+t+").constructor;")()}catch(e){}},Lt=Object.getOwnPropertyDescriptor;if(Lt)try{Lt({},"")}catch(Xs){Lt=null}var Kt=function(){throw new Ut},$t=Lt?function(){try{return Kt}catch(t){try{return Lt(arguments,"callee").get}catch(e){return Kt}}}():Kt,zt=Ot(),Vt={__proto__:Pt}.foo===Pt.foo&&!(Pt instanceof kt),Ht=Object.getPrototypeOf||(Vt?function(t){return t.__proto__}:null),Qt={},Jt="undefined"!=typeof Uint8Array&&Ht?Ht(Uint8Array):ht,Xt={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?ht:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?ht:ArrayBuffer,"%ArrayIteratorPrototype%":zt&&Ht?Ht([][Symbol.iterator]()):ht,"%AsyncFromSyncIteratorPrototype%":ht,"%AsyncFunction%":Qt,"%AsyncGenerator%":Qt,"%AsyncGeneratorFunction%":Qt,"%AsyncIteratorPrototype%":Qt,"%Atomics%":"undefined"==typeof Atomics?ht:Atomics,"%BigInt%":"undefined"==typeof BigInt?ht:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?ht:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?ht:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?ht:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Dt,"%eval%":eval,"%EvalError%":Nt,"%Float32Array%":"undefined"==typeof Float32Array?ht:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?ht:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?ht:FinalizationRegistry,"%Function%":Bt,"%GeneratorFunction%":Qt,"%Int8Array%":"undefined"==typeof Int8Array?ht:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?ht:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?ht:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":zt&&Ht?Ht(Ht([][Symbol.iterator]())):ht,"%JSON%":"object"==typeof JSON?JSON:ht,"%Map%":"undefined"==typeof Map?ht:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&zt&&Ht?Ht((new Map)[Symbol.iterator]()):ht,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?ht:Promise,"%Proxy%":"undefined"==typeof Proxy?ht:Proxy,"%RangeError%":Rt,"%ReferenceError%":Wt,"%Reflect%":"undefined"==typeof Reflect?ht:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?ht:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&zt&&Ht?Ht((new Set)[Symbol.iterator]()):ht,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?ht:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":zt&&Ht?Ht(""[Symbol.iterator]()):ht,"%Symbol%":zt?Symbol:ht,"%SyntaxError%":_t,"%ThrowTypeError%":$t,"%TypedArray%":Jt,"%TypeError%":Ut,"%Uint8Array%":"undefined"==typeof Uint8Array?ht:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?ht:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?ht:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?ht:Uint32Array,"%URIError%":Gt,"%WeakMap%":"undefined"==typeof WeakMap?ht:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?ht:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?ht:WeakSet};if(Ht)try{null.error}catch(Xs){var Yt=Ht(Ht(Xs));Xt["%Error.prototype%"]=Yt}var Zt=function t(e){var r;if("%AsyncFunction%"===e)r=qt("async function () {}");else if("%GeneratorFunction%"===e)r=qt("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=qt("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var o=t("%AsyncGenerator%");o&&Ht&&(r=Ht(o.prototype))}return Xt[e]=r,r},te={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ee=Et,re=Ft,ne=ee.call(Function.call,Array.prototype.concat),oe=ee.call(Function.apply,Array.prototype.splice),ie=ee.call(Function.call,String.prototype.replace),ae=ee.call(Function.call,String.prototype.slice),se=ee.call(Function.call,RegExp.prototype.exec),ce=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,le=/\\(\\)?/g,pe=function(t,e){var r,n=t;if(re(te,n)&&(n="%"+(r=te[n])[0]+"%"),re(Xt,n)){var o=Xt[n];if(o===Qt&&(o=Zt(n)),void 0===o&&!e)throw new Ut("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new _t("intrinsic "+t+" does not exist!")},ue=function(t,e){if("string"!=typeof t||0===t.length)throw new Ut("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new Ut('"allowMissing" argument must be a boolean');if(null===se(/^%?[^%]*%?$/,t))throw new _t("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=ae(t,0,1),r=ae(t,-1);if("%"===e&&"%"!==r)throw new _t("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new _t("invalid intrinsic syntax, expected opening `%`");var n=[];return ie(t,ce,(function(t,e,r,o){n[n.length]=r?ie(o,le,"$1"):e||t})),n}(t),n=r.length>0?r[0]:"",o=pe("%"+n+"%",e),i=o.name,a=o.value,s=!1,c=o.alias;c&&(n=c[0],oe(r,ne([0,1],c)));for(var l=1,p=!0;l<r.length;l+=1){var u=r[l],h=ae(u,0,1),y=ae(u,-1);if(('"'===h||"'"===h||"`"===h||'"'===y||"'"===y||"`"===y)&&h!==y)throw new _t("property names with quotes must have matching quotes");if("constructor"!==u&&p||(s=!0),re(Xt,i="%"+(n+="."+u)+"%"))a=Xt[i];else if(null!=a){if(!(u in a)){if(!e)throw new Ut("base intrinsic for "+t+" exists, but the property is not available.");return}if(Lt&&l+1>=r.length){var f=Lt(a,u);a=(p=!!f)&&"get"in f&&!("originalValue"in f.get)?f.get:a[u]}else p=re(a,u),a=a[u];p&&!s&&(Xt[i]=a)}}return a},he=ue("%Object.defineProperty%",!0)||!1;if(he)try{he({},"a",{value:1})}catch(Xs){he=!1}var ye=he,fe=ue("%Object.getOwnPropertyDescriptor%",!0);if(fe)try{fe([],"length")}catch(Xs){fe=null}var de=fe,ge=ye,me=bt,be=vt,ve=de,we=function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new be("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new be("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new be("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new be("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new be("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new be("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,a=arguments.length>6&&arguments[6],s=!!ve&&ve(t,e);if(ge)ge(t,e,{configurable:null===i&&s?s.configurable:!i,enumerable:null===n&&s?s.enumerable:!n,value:r,writable:null===o&&s?s.writable:!o});else{if(!a&&(n||o||i))throw new me("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=r}},Se=ye,xe=function(){return!!Se};xe.hasArrayLengthDefineBug=function(){if(!Se)return null;try{return 1!==Se([],"length",{value:1}).length}catch(Xs){return!0}};var je=xe,Oe=yt,Pe="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),ke=Object.prototype.toString,Te=Array.prototype.concat,Ie=we,Ae=je(),Ee=function(t,e,r,n){if(e in t)if(!0===n){if(t[e]===r)return}else if("function"!=typeof(o=n)||"[object Function]"!==ke.call(o)||!n())return;var o;Ae?Ie(t,e,r,!0):Ie(t,e,r)},Ce=function(t,e){var r=arguments.length>2?arguments[2]:{},n=Oe(e);Pe&&(n=Te.call(n,Object.getOwnPropertySymbols(e)));for(var o=0;o<n.length;o+=1)Ee(t,n[o],e[n[o]],r[n[o]])};Ce.supportsDescriptors=!!Ae;var Me=Ce,Fe={exports:{}},De=ue,Ne=we,Re=je(),We=de,_e=vt,Ue=De("%Math.floor%"),Ge=function(t,e){if("function"!=typeof t)throw new _e("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||Ue(e)!==e)throw new _e("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,o=!0;if("length"in t&&We){var i=We(t,"length");i&&!i.configurable&&(n=!1),i&&!i.writable&&(o=!1)}return(n||o||!r)&&(Re?Ne(t,"length",e,!0,!0):Ne(t,"length",e)),t};!function(t){var e=Et,r=ue,n=Ge,o=vt,i=r("%Function.prototype.apply%"),a=r("%Function.prototype.call%"),s=r("%Reflect.apply%",!0)||e.call(a,i),c=ye,l=r("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new o("a function is required");var r=s(e,a,arguments);return n(r,1+l(0,t.length-(arguments.length-1)),!0)};var p=function(){return s(e,i,arguments)};c?c(t.exports,"apply",{value:p}):t.exports.apply=p}(Fe);var Be=Fe.exports,qe=ue,Le=Be,Ke=Le(qe("String.prototype.indexOf")),$e=function(t,e){var r=qe(t,!!e);return"function"==typeof r&&Ke(t,".prototype.")>-1?Le(r):r},ze=yt,Ve=St(),He=$e,Qe=Object,Je=He("Array.prototype.push"),Xe=He("Object.prototype.propertyIsEnumerable"),Ye=Ve?Object.getOwnPropertySymbols:null,Ze=function(t,e){if(null==t)throw new TypeError("target must be an object");var r=Qe(t);if(1===arguments.length)return r;for(var n=1;n<arguments.length;++n){var o=Qe(arguments[n]),i=ze(o),a=Ve&&(Object.getOwnPropertySymbols||Ye);if(a)for(var s=a(o),c=0;c<s.length;++c){var l=s[c];Xe(o,l)&&Je(i,l)}for(var p=0;p<i.length;++p){var u=i[p];if(Xe(o,u)){var h=o[u];r[u]=h}}}return r},tr=Ze,er=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),r={},n=0;n<e.length;++n)r[e[n]]=e[n];var o=Object.assign({},r),i="";for(var a in o)i+=a;return t!==i}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(Xs){return"y"===t[1]}return!1}()?tr:Object.assign:tr},rr=Me,nr=er,or=Me,ir=Ze,ar=er,sr=Be.apply(ar()),cr=function(t,e){return sr(Object,arguments)};or(cr,{getPolyfill:ar,implementation:ir,shim:function(){var t=nr();return rr(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var lr=cr,pr=function(){return"string"==typeof function(){}.name},ur=Object.getOwnPropertyDescriptor;if(ur)try{ur([],"length")}catch(Xs){ur=null}pr.functionsHaveConfigurableNames=function(){if(!pr()||!ur)return!1;var t=ur((function(){}),"name");return!!t&&!!t.configurable};var hr=Function.prototype.bind;pr.boundFunctionsHaveNames=function(){return pr()&&"function"==typeof hr&&""!==function(){}.bind().name};var yr=pr,fr=we,dr=je(),gr=yr.functionsHaveConfigurableNames(),mr=vt,br=vt,vr=Object,wr=function(t,e){if("function"!=typeof t)throw new mr("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!gr||(dr?fr(t,"name",e,!0,!0):fr(t,"name",e)),t}((function(){if(null==this||this!==vr(this))throw new br("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0),Sr=wr,xr=Me.supportsDescriptors,jr=Object.getOwnPropertyDescriptor,Or=function(){if(xr&&"gim"===/a/gim.flags){var t=jr(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(r,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return Sr},Pr=Me.supportsDescriptors,kr=Or,Tr=Object.getOwnPropertyDescriptor,Ir=Object.defineProperty,Ar=TypeError,Er=Object.getPrototypeOf,Cr=/a/,Mr=Me,Fr=wr,Dr=Or,Nr=Be(Dr());Mr(Nr,{getPolyfill:Dr,implementation:Fr,shim:function(){if(!Pr||!Er)throw new Ar("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=kr(),e=Er(Cr),r=Tr(e,"flags");return r&&r.get===t||Ir(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var Rr=Nr,Wr={exports:{}},_r=St,Ur=function(){return _r()&&!!Symbol.toStringTag},Gr=Ur(),Br=$e("Object.prototype.toString"),qr=function(t){return!(Gr&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===Br(t)},Lr=function(t){return!!qr(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==Br(t)&&"[object Function]"===Br(t.callee)},Kr=function(){return qr(arguments)}();qr.isLegacyArguments=Lr;var $r=Kr?qr:Lr;const zr=n(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Vr="function"==typeof Map&&Map.prototype,Hr=Object.getOwnPropertyDescriptor&&Vr?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Qr=Vr&&Hr&&"function"==typeof Hr.get?Hr.get:null,Jr=Vr&&Map.prototype.forEach,Xr="function"==typeof Set&&Set.prototype,Yr=Object.getOwnPropertyDescriptor&&Xr?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Zr=Xr&&Yr&&"function"==typeof Yr.get?Yr.get:null,tn=Xr&&Set.prototype.forEach,en="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,rn="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,nn="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,on=Boolean.prototype.valueOf,an=Object.prototype.toString,sn=Function.prototype.toString,cn=String.prototype.match,ln=String.prototype.slice,pn=String.prototype.replace,un=String.prototype.toUpperCase,hn=String.prototype.toLowerCase,yn=RegExp.prototype.test,fn=Array.prototype.concat,dn=Array.prototype.join,gn=Array.prototype.slice,mn=Math.floor,bn="function"==typeof BigInt?BigInt.prototype.valueOf:null,vn=Object.getOwnPropertySymbols,wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Sn="function"==typeof Symbol&&"object"==typeof Symbol.iterator,xn="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,jn=Object.prototype.propertyIsEnumerable,On=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Pn(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||yn.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-mn(-t):mn(t);if(n!==t){var o=String(n),i=ln.call(e,o.length+1);return pn.call(o,r,"$&_")+"."+pn.call(pn.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return pn.call(e,r,"$&_")}var kn=zr,Tn=kn.custom,In=Fn(Tn)?Tn:null;function An(t,e,r){var n="double"===(r.quoteStyle||e)?'"':"'";return n+t+n}function En(t){return pn.call(String(t),/"/g,"&quot;")}function Cn(t){return!("[object Array]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}function Mn(t){return!("[object RegExp]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}function Fn(t){if(Sn)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!wn)return!1;try{return wn.call(t),!0}catch(Xs){}return!1}var Dn=Object.prototype.hasOwnProperty||function(t){return t in this};function Nn(t,e){return Dn.call(t,e)}function Rn(t){return an.call(t)}function Wn(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function _n(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return _n(ln.call(t,0,e.maxStringLength),e)+n}return An(pn.call(pn.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Un),"single",e)}function Un(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+un.call(e.toString(16))}function Gn(t){return"Object("+t+")"}function Bn(t){return t+" { ? }"}function qn(t,e,r,n){return t+" ("+e+") {"+(n?Ln(r,n):dn.call(r,", "))+"}"}function Ln(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+dn.call(t,","+r)+"\n"+e.prev}function Kn(t,e){var r=Cn(t),n=[];if(r){n.length=t.length;for(var o=0;o<t.length;o++)n[o]=Nn(t,o)?e(t[o],t):""}var i,a="function"==typeof vn?vn(t):[];if(Sn){i={};for(var s=0;s<a.length;s++)i["$"+a[s]]=a[s]}for(var c in t)Nn(t,c)&&(r&&String(Number(c))===c&&c<t.length||Sn&&i["$"+c]instanceof Symbol||(yn.call(/[^\w$]/,c)?n.push(e(c,t)+": "+e(t[c],t)):n.push(c+": "+e(t[c],t))));if("function"==typeof vn)for(var l=0;l<a.length;l++)jn.call(t,a[l])&&n.push("["+e(a[l])+"]: "+e(t[a[l]],t));return n}var $n=ue,zn=$e,Vn=function t(e,r,n,i){var a=r||{};if(Nn(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Nn(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=!Nn(a,"customInspect")||a.customInspect;if("boolean"!=typeof s&&"symbol"!==s)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Nn(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Nn(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var c=a.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return _n(e,a);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var l=String(e);return c?Pn(e,l):l}if("bigint"==typeof e){var p=String(e)+"n";return c?Pn(e,p):p}var u=void 0===a.depth?5:a.depth;if(void 0===n&&(n=0),n>=u&&u>0&&"object"==typeof e)return Cn(e)?"[Array]":"[Object]";var h,y=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=dn.call(Array(t.indent+1)," ")}return{base:r,prev:dn.call(Array(e+1),r)}}(a,n);if(void 0===i)i=[];else if(Wn(i,e)>=0)return"[Circular]";function f(e,r,o){if(r&&(i=gn.call(i)).push(r),o){var s={depth:a.depth};return Nn(a,"quoteStyle")&&(s.quoteStyle=a.quoteStyle),t(e,s,n+1,i)}return t(e,a,n+1,i)}if("function"==typeof e&&!Mn(e)){var d=function(t){if(t.name)return t.name;var e=cn.call(sn.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),g=Kn(e,f);return"[Function"+(d?": "+d:" (anonymous)")+"]"+(g.length>0?" { "+dn.call(g,", ")+" }":"")}if(Fn(e)){var m=Sn?pn.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):wn.call(e);return"object"!=typeof e||Sn?m:Gn(m)}if((h=e)&&"object"==typeof h&&("undefined"!=typeof HTMLElement&&h instanceof HTMLElement||"string"==typeof h.nodeName&&"function"==typeof h.getAttribute)){for(var b="<"+hn.call(String(e.nodeName)),v=e.attributes||[],w=0;w<v.length;w++)b+=" "+v[w].name+"="+An(En(v[w].value),"double",a);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+"</"+hn.call(String(e.nodeName))+">"}if(Cn(e)){if(0===e.length)return"[]";var S=Kn(e,f);return y&&!function(t){for(var e=0;e<t.length;e++)if(Wn(t[e],"\n")>=0)return!1;return!0}(S)?"["+Ln(S,y)+"]":"[ "+dn.call(S,", ")+" ]"}if(function(t){return!("[object Error]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}(e)){var x=Kn(e,f);return"cause"in Error.prototype||!("cause"in e)||jn.call(e,"cause")?0===x.length?"["+String(e)+"]":"{ ["+String(e)+"] "+dn.call(x,", ")+" }":"{ ["+String(e)+"] "+dn.call(fn.call("[cause]: "+f(e.cause),x),", ")+" }"}if("object"==typeof e&&s){if(In&&"function"==typeof e[In]&&kn)return kn(e,{depth:u-n});if("symbol"!==s&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!Qr||!t||"object"!=typeof t)return!1;try{Qr.call(t);try{Zr.call(t)}catch(b){return!0}return t instanceof Map}catch(Xs){}return!1}(e)){var j=[];return Jr&&Jr.call(e,(function(t,r){j.push(f(r,e,!0)+" => "+f(t,e))})),qn("Map",Qr.call(e),j,y)}if(function(t){if(!Zr||!t||"object"!=typeof t)return!1;try{Zr.call(t);try{Qr.call(t)}catch(e){return!0}return t instanceof Set}catch(Xs){}return!1}(e)){var O=[];return tn&&tn.call(e,(function(t){O.push(f(t,e))})),qn("Set",Zr.call(e),O,y)}if(function(t){if(!en||!t||"object"!=typeof t)return!1;try{en.call(t,en);try{rn.call(t,rn)}catch(b){return!0}return t instanceof WeakMap}catch(Xs){}return!1}(e))return Bn("WeakMap");if(function(t){if(!rn||!t||"object"!=typeof t)return!1;try{rn.call(t,rn);try{en.call(t,en)}catch(b){return!0}return t instanceof WeakSet}catch(Xs){}return!1}(e))return Bn("WeakSet");if(function(t){if(!nn||!t||"object"!=typeof t)return!1;try{return nn.call(t),!0}catch(Xs){}return!1}(e))return Bn("WeakRef");if(function(t){return!("[object Number]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}(e))return Gn(f(Number(e)));if(function(t){if(!t||"object"!=typeof t||!bn)return!1;try{return bn.call(t),!0}catch(Xs){}return!1}(e))return Gn(f(bn.call(e)));if(function(t){return!("[object Boolean]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}(e))return Gn(on.call(e));if(function(t){return!("[object String]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}(e))return Gn(f(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==o&&e===o)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==Rn(t)||xn&&"object"==typeof t&&xn in t)}(e)&&!Mn(e)){var P=Kn(e,f),k=On?On(e)===Object.prototype:e instanceof Object||e.constructor===Object,T=e instanceof Object?"":"null prototype",I=!k&&xn&&Object(e)===e&&xn in e?ln.call(Rn(e),8,-1):T?"Object":"",A=(k||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(I||T?"["+dn.call(fn.call([],I||[],T||[]),": ")+"] ":"");return 0===P.length?A+"{}":y?A+"{"+Ln(P,y)+"}":A+"{ "+dn.call(P,", ")+" }"}return String(e)},Hn=vt,Qn=$n("%WeakMap%",!0),Jn=$n("%Map%",!0),Xn=zn("WeakMap.prototype.get",!0),Yn=zn("WeakMap.prototype.set",!0),Zn=zn("WeakMap.prototype.has",!0),to=zn("Map.prototype.get",!0),eo=zn("Map.prototype.set",!0),ro=zn("Map.prototype.has",!0),no=function(t,e){for(var r,n=t;null!==(r=n.next);n=r)if(r.key===e)return n.next=r.next,r.next=t.next,t.next=r,r},oo=function(){var t,e,r,n={assert:function(t){if(!n.has(t))throw new Hn("Side channel does not contain "+Vn(t))},get:function(n){if(Qn&&n&&("object"==typeof n||"function"==typeof n)){if(t)return Xn(t,n)}else if(Jn){if(e)return to(e,n)}else if(r)return function(t,e){var r=no(t,e);return r&&r.value}(r,n)},has:function(n){if(Qn&&n&&("object"==typeof n||"function"==typeof n)){if(t)return Zn(t,n)}else if(Jn){if(e)return ro(e,n)}else if(r)return function(t,e){return!!no(t,e)}(r,n);return!1},set:function(n,o){Qn&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new Qn),Yn(t,n,o)):Jn?(e||(e=new Jn),eo(e,n,o)):(r||(r={key:{},next:null}),function(t,e,r){var n=no(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}}(r,n,o))}};return n},io=Ft,ao=oo(),so=vt,co={assert:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new so("`O` is not an object");if("string"!=typeof e)throw new so("`slot` must be a string");if(ao.assert(t),!co.has(t,e))throw new so("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new so("`O` is not an object");if("string"!=typeof e)throw new so("`slot` must be a string");var r=ao.get(t);return r&&r["$"+e]},has:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new so("`O` is not an object");if("string"!=typeof e)throw new so("`slot` must be a string");var r=ao.get(t);return!!r&&io(r,"$"+e)},set:function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new so("`O` is not an object");if("string"!=typeof e)throw new so("`slot` must be a string");var n=ao.get(t);n||(n={},ao.set(t,n)),n["$"+e]=r}};Object.freeze&&Object.freeze(co);var lo,po=co,uo=SyntaxError,ho="object"==typeof StopIteration?StopIteration:null,yo={}.toString,fo=Array.isArray||function(t){return"[object Array]"==yo.call(t)},go=String.prototype.valueOf,mo=Object.prototype.toString,bo=Ur(),vo=function(t){return"string"==typeof t||"object"==typeof t&&(bo?function(t){try{return go.call(t),!0}catch(Xs){return!1}}(t):"[object String]"===mo.call(t))},wo="function"==typeof Map&&Map.prototype?Map:null,So="function"==typeof Set&&Set.prototype?Set:null;wo||(lo=function(t){return!1});var xo=wo?Map.prototype.has:null,jo=So?Set.prototype.has:null;lo||xo||(lo=function(t){return!1});var Oo,Po=lo||function(t){if(!t||"object"!=typeof t)return!1;try{if(xo.call(t),jo)try{jo.call(t)}catch(Xs){return!0}return t instanceof wo}catch(Xs){}return!1},ko="function"==typeof Map&&Map.prototype?Map:null,To="function"==typeof Set&&Set.prototype?Set:null;To||(Oo=function(t){return!1});var Io=ko?Map.prototype.has:null,Ao=To?Set.prototype.has:null;Oo||Ao||(Oo=function(t){return!1});var Eo=Oo||function(t){if(!t||"object"!=typeof t)return!1;try{if(Ao.call(t),Io)try{Io.call(t)}catch(Xs){return!0}return t instanceof To}catch(Xs){}return!1},Co=$r,Mo=function(t){if(!ho)throw new uo("this environment lacks StopIteration");po.set(t,"[[Done]]",!1);var e={next:function(){var t=po.get(this,"[[Iterator]]"),e=po.get(t,"[[Done]]");try{return{done:e,value:e?void 0:t.next()}}catch(Xs){if(po.set(t,"[[Done]]",!0),Xs!==ho)throw Xs;return{done:!0,value:void 0}}}};return po.set(e,"[[Iterator]]",t),e};if(Ot()||St()){var Fo=Symbol.iterator;Wr.exports=function(t){return null!=t&&void 0!==t[Fo]?t[Fo]():Co(t)?Array.prototype[Fo].call(t):void 0}}else{var Do=fo,No=vo,Ro=ue,Wo=Ro("%Map%",!0),_o=Ro("%Set%",!0),Uo=$e,Go=Uo("Array.prototype.push"),Bo=Uo("String.prototype.charCodeAt"),qo=Uo("String.prototype.slice"),Lo=function(t){var e=0;return{next:function(){var r,n=e>=t.length;return n||(r=t[e],e+=1),{done:n,value:r}}}},Ko=function(t,e){if(Do(t)||Co(t))return Lo(t);if(No(t)){var r=0;return{next:function(){var e=function(t,e){if(e+1>=t.length)return e+1;var r=Bo(t,e);if(r<55296||r>56319)return e+1;var n=Bo(t,e+1);return n<56320||n>57343?e+1:e+2}(t,r),n=qo(t,r,e);return r=e,{done:e>t.length,value:n}}}}return e&&void 0!==t["_es6-shim iterator_"]?t["_es6-shim iterator_"]():void 0};if(Wo||_o){var $o=Po,zo=Eo,Vo=Uo("Map.prototype.forEach",!0),Ho=Uo("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var Qo=Uo("Map.prototype.iterator",!0),Jo=Uo("Set.prototype.iterator",!0);var Xo=Uo("Map.prototype.@@iterator",!0)||Uo("Map.prototype._es6-shim iterator_",!0),Yo=Uo("Set.prototype.@@iterator",!0)||Uo("Set.prototype._es6-shim iterator_",!0);Wr.exports=function(t){return function(t){if($o(t)){if(Qo)return Mo(Qo(t));if(Xo)return Xo(t);if(Vo){var e=[];return Vo(t,(function(t,r){Go(e,[r,t])})),Lo(e)}}if(zo(t)){if(Jo)return Mo(Jo(t));if(Yo)return Yo(t);if(Ho){var r=[];return Ho(t,(function(t){Go(r,t)})),Lo(r)}}}(t)||Ko(t)}}else Wr.exports=function(t){if(null!=t)return Ko(t,!0)}}var Zo=Wr.exports,ti=function(t){return t!=t},ei=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!ti(t)||!ti(e))},ri=ei,ni=function(){return"function"==typeof Object.is?Object.is:ri},oi=ni,ii=Me,ai=Me,si=ei,ci=ni,li=Be(ci(),Object);ai(li,{getPolyfill:ci,implementation:si,shim:function(){var t=oi();return ii(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var pi,ui,hi,yi,fi=li,di=Be,gi=$e,mi=ue("%ArrayBuffer%",!0),bi=gi("ArrayBuffer.prototype.byteLength",!0),vi=gi("Object.prototype.toString"),wi=!!mi&&!bi&&new mi(0).slice,Si=!!wi&&di(wi),xi=bi||Si?function(t){if(!t||"object"!=typeof t)return!1;try{return bi?bi(t):Si(t,0),!0}catch(Xs){return!1}}:mi?function(t){return"[object ArrayBuffer]"===vi(t)}:function(t){return!1},ji=Date.prototype.getDay,Oi=Object.prototype.toString,Pi=Ur(),ki=$e,Ti=Ur();if(Ti){pi=ki("Object.prototype.hasOwnProperty"),ui=ki("RegExp.prototype.exec"),hi={};var Ii=function(){throw hi};yi={toString:Ii,valueOf:Ii},"symbol"==typeof Symbol.toPrimitive&&(yi[Symbol.toPrimitive]=Ii)}var Ai=ki("Object.prototype.toString"),Ei=Object.getOwnPropertyDescriptor,Ci=Ti?function(t){if(!t||"object"!=typeof t)return!1;var e=Ei(t,"lastIndex");if(!e||!pi(e,"value"))return!1;try{ui(t,yi)}catch(Xs){return Xs===hi}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===Ai(t)},Mi=$e("SharedArrayBuffer.prototype.byteLength",!0),Fi=Mi?function(t){if(!t||"object"!=typeof t)return!1;try{return Mi(t),!0}catch(Xs){return!1}}:function(t){return!1},Di=Number.prototype.toString,Ni=Object.prototype.toString,Ri=Ur(),Wi=$e,_i=Wi("Boolean.prototype.toString"),Ui=Wi("Object.prototype.toString"),Gi=Ur(),Bi={exports:{}},qi=Object.prototype.toString;if(Ot()){var Li=Symbol.prototype.toString,Ki=/^Symbol\(.*\)$/;Bi.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==qi.call(t))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&Ki.test(Li.call(t))}(t)}catch(Xs){return!1}}}else Bi.exports=function(t){return!1};var $i=Bi.exports,zi={exports:{}},Vi="undefined"!=typeof BigInt&&BigInt;if("function"==typeof Vi&&"function"==typeof BigInt&&"bigint"==typeof Vi(42)&&"bigint"==typeof BigInt(42)){var Hi=BigInt.prototype.valueOf;zi.exports=function(t){return null!=t&&"boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t&&"symbol"!=typeof t&&"function"!=typeof t&&("bigint"==typeof t||function(t){try{return Hi.call(t),!0}catch(Xs){}return!1}(t))}}else zi.exports=function(t){return!1};var Qi,Ji=zi.exports,Xi=vo,Yi=$i,Zi=Ji,ta="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,ea="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;ta||(Qi=function(t){return!1});var ra=ta?ta.prototype.has:null,na=ea?ea.prototype.has:null;Qi||ra||(Qi=function(t){return!1});var oa=Qi||function(t){if(!t||"object"!=typeof t)return!1;try{if(ra.call(t,ra),na)try{na.call(t,na)}catch(Xs){return!0}return t instanceof ta}catch(Xs){}return!1},ia={exports:{}},aa=$e,sa=ue("%WeakSet%",!0),ca=aa("WeakSet.prototype.has",!0);if(ca){var la=aa("WeakMap.prototype.has",!0);ia.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(ca(t,ca),la)try{la(t,la)}catch(Xs){return!0}return t instanceof sa}catch(Xs){}return!1}}else ia.exports=function(t){return!1};var pa,ua,ha=ia.exports,ya=Po,fa=Eo,da=oa,ga=ha,ma=Function.prototype.toString,ba="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof ba&&"function"==typeof Object.defineProperty)try{pa=Object.defineProperty({},"length",{get:function(){throw ua}}),ua={},ba((function(){throw 42}),null,pa)}catch(Ys){Ys!==ua&&(ba=null)}else ba=null;var va=/^\s*class\b/,wa=function(t){try{var e=ma.call(t);return va.test(e)}catch(Xs){return!1}},Sa=function(t){try{return!wa(t)&&(ma.call(t),!0)}catch(Xs){return!1}},xa=Object.prototype.toString,ja="function"==typeof Symbol&&!!Symbol.toStringTag,Oa=!(0 in[,]),Pa=function(){return!1};if("object"==typeof document){var ka=document.all;xa.call(ka)===xa.call(document.all)&&(Pa=function(t){if((Oa||!t)&&(void 0===t||"object"==typeof t))try{var e=xa.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(Xs){}return!1})}var Ta=ba?function(t){if(Pa(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{ba(t,null,pa)}catch(Xs){if(Xs!==ua)return!1}return!wa(t)&&Sa(t)}:function(t){if(Pa(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(ja)return Sa(t);if(wa(t))return!1;var e=xa.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&Sa(t)},Ia=Object.prototype.toString,Aa=Object.prototype.hasOwnProperty,Ea=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Ca="undefined"==typeof globalThis?o:globalThis,Ma=function(t,e,r){if(!Ta(e))throw new TypeError("iterator must be a function");var n;arguments.length>=3&&(n=r),"[object Array]"===Ia.call(t)?function(t,e,r){for(var n=0,o=t.length;n<o;n++)Aa.call(t,n)&&(null==r?e(t[n],n,t):e.call(r,t[n],n,t))}(t,e,n):"string"==typeof t?function(t,e,r){for(var n=0,o=t.length;n<o;n++)null==r?e(t.charAt(n),n,t):e.call(r,t.charAt(n),n,t)}(t,e,n):function(t,e,r){for(var n in t)Aa.call(t,n)&&(null==r?e(t[n],n,t):e.call(r,t[n],n,t))}(t,e,n)},Fa=Be,Da=$e,Na=de,Ra=Da("Object.prototype.toString"),Wa=Ur(),_a="undefined"==typeof globalThis?o:globalThis,Ua=function(){for(var t=[],e=0;e<Ea.length;e++)"function"==typeof Ca[Ea[e]]&&(t[t.length]=Ea[e]);return t}(),Ga=Da("String.prototype.slice"),Ba=Object.getPrototypeOf,qa=Da("Array.prototype.indexOf",!0)||function(t,e){for(var r=0;r<t.length;r+=1)if(t[r]===e)return r;return-1},La={__proto__:null};Ma(Ua,Wa&&Na&&Ba?function(t){var e=new _a[t];if(Symbol.toStringTag in e){var r=Ba(e),n=Na(r,Symbol.toStringTag);if(!n){var o=Ba(r);n=Na(o,Symbol.toStringTag)}La["$"+t]=Fa(n.get)}}:function(t){var e=new _a[t],r=e.slice||e.set;r&&(La["$"+t]=Fa(r))});var Ka=$e("ArrayBuffer.prototype.byteLength",!0),$a=xi,za=lr,Va=$e,Ha=Rr,Qa=ue,Ja=Zo,Xa=oo,Ya=fi,Za=$r,ts=fo,es=xi,rs=function(t){return"object"==typeof t&&null!==t&&(Pi?function(t){try{return ji.call(t),!0}catch(Xs){return!1}}(t):"[object Date]"===Oi.call(t))},ns=Ci,os=Fi,is=yt,as=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t?null:Xi(t)?"String":function(t){return"number"==typeof t||"object"==typeof t&&(Ri?function(t){try{return Di.call(t),!0}catch(Xs){return!1}}(t):"[object Number]"===Ni.call(t))}(t)?"Number":function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(Gi&&Symbol.toStringTag in t?function(t){try{return _i(t),!0}catch(Xs){return!1}}(t):"[object Boolean]"===Ui(t))}(t)?"Boolean":Yi(t)?"Symbol":Zi(t)?"BigInt":void 0},ss=function(t){if(t&&"object"==typeof t){if(ya(t))return"Map";if(fa(t))return"Set";if(da(t))return"WeakMap";if(ga(t))return"WeakSet"}return!1},cs=function(t){if(!t||"object"!=typeof t)return!1;if(!Wa){var e=Ga(Ra(t),8,-1);return qa(Ua,e)>-1?e:"Object"===e&&function(t){var e=!1;return Ma(La,(function(r,n){if(!e)try{r(t),e=Ga(n,1)}catch(Xs){}})),e}(t)}return Na?function(t){var e=!1;return Ma(La,(function(r,n){if(!e)try{"$"+r(t)===n&&(e=Ga(n,1))}catch(Xs){}})),e}(t):null},ls=function(t){return $a(t)?Ka?Ka(t):t.byteLength:NaN},ps=Va("SharedArrayBuffer.prototype.byteLength",!0),us=Va("Date.prototype.getTime"),hs=Object.getPrototypeOf,ys=Va("Object.prototype.toString"),fs=Qa("%Set%",!0),ds=Va("Map.prototype.has",!0),gs=Va("Map.prototype.get",!0),ms=Va("Map.prototype.size",!0),bs=Va("Set.prototype.add",!0),vs=Va("Set.prototype.delete",!0),ws=Va("Set.prototype.has",!0),Ss=Va("Set.prototype.size",!0);function xs(t,e,r,n){for(var o,i=Ja(t);(o=i.next())&&!o.done;)if(Ts(e,o.value,r,n))return vs(t,o.value),!0;return!1}function js(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function Os(t,e,r,n,o,i){var a=js(r);if(null!=a)return a;var s=gs(e,a),c=za({},o,{strict:!1});return!(void 0===s&&!ds(e,a)||!Ts(n,s,c,i))&&!ds(t,a)&&Ts(n,s,c,i)}function Ps(t,e,r){var n=js(r);return null!=n?n:ws(e,n)&&!ws(t,n)}function ks(t,e,r,n,o,i){for(var a,s,c=Ja(t);(a=c.next())&&!a.done;)if(Ts(r,s=a.value,o,i)&&Ts(n,gs(e,s),o,i))return vs(t,s),!0;return!1}function Ts(t,e,r,n){var o=r||{};if(o.strict?Ya(t,e):t===e)return!0;if(as(t)!==as(e))return!1;if(!t||!e||"object"!=typeof t&&"object"!=typeof e)return o.strict?Ya(t,e):t==e;var i,a=n.has(t),s=n.has(e);if(a&&s){if(n.get(t)===n.get(e))return!0}else i={};return a||n.set(t,i),s||n.set(e,i),function(t,e,r,n){var o,i;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(ys(t)!==ys(e))return!1;if(Za(t)!==Za(e))return!1;if(ts(t)!==ts(e))return!1;var a=t instanceof Error,s=e instanceof Error;if(a!==s)return!1;if((a||s)&&(t.name!==e.name||t.message!==e.message))return!1;var c=ns(t),l=ns(e);if(c!==l)return!1;if((c||l)&&(t.source!==e.source||Ha(t)!==Ha(e)))return!1;var p=rs(t),u=rs(e);if(p!==u)return!1;if((p||u)&&us(t)!==us(e))return!1;if(r.strict&&hs&&hs(t)!==hs(e))return!1;var h=cs(t),y=cs(e);if(h!==y)return!1;if(h||y){if(t.length!==e.length)return!1;for(o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}var f=Is(t),d=Is(e);if(f!==d)return!1;if(f||d){if(t.length!==e.length)return!1;for(o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}var g=es(t),m=es(e);if(g!==m)return!1;if(g||m)return ls(t)===ls(e)&&"function"==typeof Uint8Array&&Ts(new Uint8Array(t),new Uint8Array(e),r,n);var b=os(t),v=os(e);if(b!==v)return!1;if(b||v)return ps(t)===ps(e)&&"function"==typeof Uint8Array&&Ts(new Uint8Array(t),new Uint8Array(e),r,n);if(typeof t!=typeof e)return!1;var w=is(t),S=is(e);if(w.length!==S.length)return!1;for(w.sort(),S.sort(),o=w.length-1;o>=0;o--)if(w[o]!=S[o])return!1;for(o=w.length-1;o>=0;o--)if(!Ts(t[i=w[o]],e[i],r,n))return!1;var x=ss(t),j=ss(e);return x===j&&("Set"===x||"Set"===j?function(t,e,r,n){if(Ss(t)!==Ss(e))return!1;for(var o,i,a,s=Ja(t),c=Ja(e);(o=s.next())&&!o.done;)if(o.value&&"object"==typeof o.value)a||(a=new fs),bs(a,o.value);else if(!ws(e,o.value)){if(r.strict)return!1;if(!Ps(t,e,o.value))return!1;a||(a=new fs),bs(a,o.value)}if(a){for(;(i=c.next())&&!i.done;)if(i.value&&"object"==typeof i.value){if(!xs(a,i.value,r.strict,n))return!1}else if(!r.strict&&!ws(t,i.value)&&!xs(a,i.value,r.strict,n))return!1;return 0===Ss(a)}return!0}(t,e,r,n):"Map"!==x||function(t,e,r,n){if(ms(t)!==ms(e))return!1;for(var o,i,a,s,c,l,p=Ja(t),u=Ja(e);(o=p.next())&&!o.done;)if(s=o.value[0],c=o.value[1],s&&"object"==typeof s)a||(a=new fs),bs(a,s);else if(void 0===(l=gs(e,s))&&!ds(e,s)||!Ts(c,l,r,n)){if(r.strict)return!1;if(!Os(t,e,s,c,r,n))return!1;a||(a=new fs),bs(a,s)}if(a){for(;(i=u.next())&&!i.done;)if(s=i.value[0],l=i.value[1],s&&"object"==typeof s){if(!ks(a,t,s,l,r,n))return!1}else if(!(r.strict||t.has(s)&&Ts(gs(t,s),l,r,n)||ks(a,t,s,l,za({},r,{strict:!1}),n)))return!1;return 0===Ss(a)}return!0}(t,e,r,n))}(t,e,o,n)}function Is(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0]||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))}const As=i((function(t,e,r){return Ts(t,e,r,Xa())})),Es={player:{x:et.x,y:et.y,flip:!1},journal:[],inventory:[],quests:[],warpers:[]},Cs={player:{x:et.x-200,y:et.y,flip:!1},journal:[j.FixTheClock,j.SphinxRiddleSolved],inventory:[v.Wrench,v.Gear1],quests:[{id:w.SphinxRiddle,completed:!0}],warpers:[{warpType:b.TownEast,state:!0}]};function Ms(t){return M(t,A).map((t=>({warpType:t.warpType,state:t.visible})))}class Fs extends r.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock")}create(){this.createBackgrounds(),this.player=new rt(this);const t=new T(this),e=this.createWarpers(),r=this.createNpcs(),n=this.createItems(),o=[this.player];this.clock=new g(this,o,this.player),this.interactiveObjects=this.add.group([...e,...r,...n],{runChildUpdate:!0}),this.add.group([this.player,this.clock],{runChildUpdate:!0}),this.physics.add.collider(this.player,t),this.createEventListeners(),this.cameras.main.startFollow(this.player,!0),this.cameras.main.setFollowOffset(0,c.cameraOffset),function(t){let e,r=localStorage.getItem("save");try{r&&(e=JSON.parse(r))}catch(i){console.error(i)}const n=e||Es;t.player.setX(n.player.x),t.player.setY(n.player.y),t.player.setFlipX(n.player.flip),n.journal.forEach((e=>t.player.journal.addEntry(e,!0))),n.inventory.forEach((e=>t.player.inventory.addItem(e))),n.quests.forEach((e=>t.player.quests.addQuest(e))),function(t,e){const r=M(t,A);e.forEach((t=>{const e=r.find((e=>e.warpType===t.warpType));e&&e.setVisible(t.state)}))}(t,n.warpers);const o=As(e,Es)?"[New]":As(e,Cs)?"[Debug]":"[Storage]";new K(t,`Game Loaded ${o}`)}(this)}update(){this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>void 0===t.visible||t.visible),this.player)||this.player.setInteractiveObject(void 0)}createBackgrounds(){const t=[this.physics.add.sprite(0,0,"town").setOrigin(0),this.physics.add.sprite(500,-1100,"clock_outside").setOrigin(0),this.physics.add.sprite(500,-2400,"clock_inner").setOrigin(0),this.physics.add.sprite(2300,0,"forest").setOrigin(0),this.physics.add.sprite(4400,100,"lake").setOrigin(0)];return c.debug&&t.forEach((t=>t.setInteractive({draggable:!0}))),t}createWarpers(){const t=[];for(const e in b)isNaN(Number(e))&&t.push(new A(this,b[e],this.player));return t}createNpcs(){return[new q(this,S.Inventor,this.player),new q(this,S.Stranger,this.player),new q(this,S.Sphinx,this.player),new q(this,S.Mayor,this.player),new q(this,S.ClockTower,this.player)]}createItems(){return[new P(this,v.Gear1,this.player)]}createEventListeners(){var t,e;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),null==(e=this.input.keyboard)||e.on("keydown-J",(()=>{this.player.journal.openJournal()}))}}class Ds extends r.GameObjects.Text{constructor(t,e,r,n,o){super(t,e,r,n,{...d,fontSize:48,backgroundColor:`#${h}`,padding:{x:15,y:10}}),this.setOrigin(.5),t.add.existing(this),this.setInteractive(),this.on("pointerdown",(()=>o())),this.on("pointerover",(()=>this.setTint(12303291))),this.on("pointerout",(()=>this.setTint(16777215)))}}const Ns={[j.FixTheClock]:"The inventor gave me a wrench to fix the clock tower. I need three gears to repair it.",[j.SphinxRiddleSolved]:"I solved the sphinx’s riddle. Now I can pass through the forest.",[j.MeetTheMayor]:"The inventor suggested I meet the mayor. She is usually by the old clock or in her office."};class Rs extends r.Scene{constructor(){super("JournalDialog"),e(this,"player")}init(t){this.player=t.player}create(){var t,e;const n=this.add.container(c.width/2,c.height/2);n.add(this.add.rectangle(0,0,.8*c.width,.8*c.height,0,.75).setStrokeStyle(4,f(u))),n.add(new Ds(this,.3*c.width,-.33*c.height,"Close",(()=>this.close()))),n.add(this.add.text(0,-.33*c.height,"Journal",{...d,fontSize:48}).setOrigin(.5));const o=this.add.text(0,-.2*c.height,this.player.journal.journal.map((t=>"- "+Ns[t]+"\n\n")).reverse(),{...d,wordWrap:{width:.7*c.width},align:"left"}).setOrigin(.5,0).setInteractive({draggable:!0});o.on("drag",((t,e,n)=>{o.y=r.Math.Clamp(n,.5*-o.displayHeight,.2*-c.height)})),n.add(o);const i=this.make.graphics();i.fillStyle(16777215),i.fillRect(.125*c.width,.2*c.height,.75*c.width,.7*c.height);const a=new Phaser.Display.Masks.BitmapMask(this,i);o.setMask(a),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()})),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.close()}))}close(){this.scene.stop(),this.scene.resume("Game")}}function Ws(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ws(Object(r),!0).forEach((function(e){Us(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ws(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Us(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Gs(t){return t.slice(0,-1)}function Bs(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function qs(t){return[...new Set(t)]}function Ls(t,e){const r=qs(t.map((t=>t.set))).filter(Boolean),n=(o=Bs(1,t.length+1),i=r,[o,i].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var o,i;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=n[e]))}function Ks(t,e,r=.5){Gs(t).forEach(((n,o)=>{const i=t[o+1],a=n.set!==i.set,s=e()<=r;var c,l,p;a&&s&&(c=t,l=i.set,p=n.set,c.forEach((t=>{t.set===l&&(t.set=p)})),n.right=!1,i.left=!1)}))}const $s=48;class zs extends r.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"nextUpdate")}init(t){this.parent=t.parent}create(){var t;this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,43.2,43.2,5601177).setSmoothness(32).setOrigin(-.03),this.keys=null==(t=this.input.keyboard)?void 0:t.addKeys("W,A,S,D,UP,DOWN,LEFT,RIGHT,P"),this.cameras.main.startFollow(this.mazePlayer)}createMaze(){const t=D(this);this.maze=function(t=8,e=t,r=!0,n=1){const o=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(n),i=[],a=Bs(t);for(let l=0;l<e;l+=1){const n=a.map((n=>({x:n,y:l,top:r||l>0,left:r||n>0,bottom:r||l<e-1,right:r||n<t-1})));i.push(n)}Gs(i).forEach(((t,e)=>{Ls(t,o),Ks(t,o),function(t,e,r){const n=Object.values(function(t,e){let r=qs(t.map((t=>t.set))).reduce(((t,e)=>_s(_s({},t),{},{[e]:[]})),{});return t.forEach((t=>r[t.set].push(t))),r}(t)),{ceil:o}=Math;n.forEach((t=>{(function(t,e,r){e=null==e?1:e;const n=null==t?0:t.length;if(!n||e<1)return[];e=e>n?n:e;let o=-1;const i=n-1,a=[...t];for(;++o<e;){const t=o+Math.floor(r()*(i-o+1)),e=a[t];a[t]=a[o],a[o]=e}return a.slice(0,e)})(t,o(r()*t.length),r).forEach((t=>{if(t){const r=e[t.x];t.bottom=!1,r.top=!1,r.set=t.set}}))}))}(t,i[e+1],o)}));const s=(c=i)[c.length-1];var c;return Ls(s,o),Ks(s,o,1),i}(24,24,!0,t),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,$s,$s),this.graphics.lineStyle(3,3385907),this.maze.forEach((t=>{t.forEach((t=>{if(t.top){const e=new Phaser.Geom.Line(t.x*$s,t.y*$s,t.x*$s+$s,t.y*$s);this.graphics.strokeLineShape(e)}if(t.bottom){const e=new Phaser.Geom.Line(t.x*$s,t.y*$s+$s,t.x*$s+$s,t.y*$s+$s);this.graphics.strokeLineShape(e)}if(t.left){const e=new Phaser.Geom.Line(t.x*$s,t.y*$s,t.x*$s,t.y*$s+$s);this.graphics.strokeLineShape(e)}if(t.right){const e=new Phaser.Geom.Line(t.x*$s+$s,t.y*$s,t.x*$s+$s,t.y*$s+$s);this.graphics.strokeLineShape(e)}}))})),this.cameras.main.setViewport(50,130,c.width-100,c.height-170)}update(t,e){if(t<this.nextUpdate)return;this.keys.P.isDown;const n=this.keys.LEFT.isDown||this.keys.A.isDown,o=this.keys.RIGHT.isDown||this.keys.D.isDown,i=this.keys.UP.isDown||this.keys.W.isDown,a=this.keys.DOWN.isDown||this.keys.S.isDown,s=new r.Math.Vector2(0,0);n?s.x=-48:o?s.x=$s:i?s.y=-48:a&&(s.y=$s);const c=new r.Math.Vector2(this.mazePlayer.x+s.x,this.mazePlayer.y+s.y);if((this.mazePlayer.x!==c.x||this.mazePlayer.y!==c.y)&&this.canMove(c)){this.mazePlayer.setPosition(c.x,c.y);const t=new r.Math.Vector2(1104,1104);this.parent.setAngle(r.Math.Angle.BetweenPoints(c,t)),this.mazePlayer.x===t.x&&this.mazePlayer.y===t.y&&this.parent.close(!0)}this.nextUpdate=t+75}canMove(t){const e=t.x,n=t.y,o=r.Math.FloorTo(e/$s),i=r.Math.FloorTo(n/$s);if(o<0||i<0||o>=24||i>=24)return!1;const a=r.Math.FloorTo(this.mazePlayer.x/$s),s=r.Math.FloorTo(this.mazePlayer.y/$s),c=this.maze[s][a];return!(c.top&&n<this.mazePlayer.y||c.bottom&&n>this.mazePlayer.y||c.left&&e<this.mazePlayer.x||c.right&&e>this.mazePlayer.x)}}class Vs extends r.Scene{constructor(){super("MazeDialog"),e(this,"player"),e(this,"container"),e(this,"arrow")}init(t){this.player=t.player}create(){var t;this.container=this.add.container(c.width/2,c.height/2),this.container.add(this.add.rectangle(0,0,.95*c.width,.95*c.height,0,.9).setStrokeStyle(4,f(u))),this.container.add(new Ds(this,.4*c.width,-.4*c.height,"Close",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*c.height,"Find your way through the forest",{...d,fontSize:48}).setOrigin(.5)),this.arrow=this.add.sprite(.4*-c.width,.4*-c.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),this.scene.launch("Maze",{parent:this})}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}close(t){this.scene.stop(),this.scene.stop("Maze"),this.scene.resume("Game"),t?E(b.Forest,this.player):this.player.setPosition(I[b.TownEast].x-40,I[b.TownEast].y)}}class Hs extends r.Scene{constructor(){super("Paused"),e(this,"parent")}init(t){this.parent=t.game}create(){var t;const e=c.width,r=c.height;this.add.rectangle(e/2,r/2,e,r,0,.75),this.add.text(e/2,200,"Game Paused",{...d,fontSize:72}).setOrigin(.5),new Ds(this,e/2,r/2,"Resume",(()=>this.resume())),new Ds(this,e/2,r/2+90,"Save",(()=>{this.resume(),function(t,e){const r={player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal,inventory:t.player.inventory.inventory,quests:t.player.quests.quests,warpers:Ms(t)};localStorage.setItem("save",JSON.stringify(r)),new K(t,"Game Saved")}(this.parent)})),new Ds(this,e/2,r/2+180,"Load",(()=>{this.resume(),this.parent.scene.restart()})),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume()))}resume(){this.scene.stop(),this.scene.resume("Game")}}class Qs extends r.Scene{constructor(){super("Preloader")}init(){this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("ladder","ladder.png"),this.load.image("warp","warp.png"),this.load.image("watch","watch.png"),this.load.image("arrow","arrow.png"),this.load.image("gear","items/gear.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:24,frameHeight:36}),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png")}create(){this.scene.start("Game")}}const Js={type:Phaser.AUTO,width:c.width,height:c.height,parent:"game-container",backgroundColor:1118481,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[l,Qs,Fs,Hs,Rs,Vs,zs],physics:{default:"arcade"},render:{pixelArt:!0,antialias:!1}};("m5x7","assets/m5x7.ttf",new FontFace("m5x7","url(assets/m5x7.ttf)").load().then((function(t){document.fonts.add(t)})).catch((function(t){return t}))).then((()=>{new r.Game(Js)}));
