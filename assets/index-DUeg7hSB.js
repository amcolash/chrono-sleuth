var t=Object.defineProperty,e=(e,r,i)=>(((e,r,i)=>{r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i})(e,"symbol"!=typeof r?r+"":r,i),i);import{p as r,g as i,c as n,a as o}from"./phaser-pZmLa9DQ.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const r of t)if("childList"===r.type)for(const t of r.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const s={width:1280,height:720},a={width:960,height:540};let l=!1,c=!1;c=!0;const{width:h,height:p}=s;l=!1,c=!1;const u={debug:!1,width:h,height:p,cameraOffset:p/3,zoomed:!1,dayMinutes:.25,rewindEnabled:!1,fastMode:!1};class y extends r.Scene{constructor(){super("Boot")}preload(){}create(){this.scene.start("Preloader")}}var d=(t=>(t[t.Backgrounds=0]="Backgrounds",t[t.Warpers=1]="Warpers",t[t.Npcs=2]="Npcs",t[t.Items=3]="Items",t[t.Player=4]="Player",t[t.Shader=5]="Shader",t[t.Ui=6]="Ui",t[t.Ui2=7]="Ui2",t[t.Overlay=8]="Overlay",t[t.Debug=9]="Debug",t))(d||{});class f extends r.GameObjects.GameObject{constructor(t,r,i,n,o,s){super(t,"Light"),e(this,"x"),e(this,"y"),e(this,"light"),e(this,"debug"),t.add.existing(this),this.light=t.lights.addLight(r,i,n,o,s),this.debug=t.add.graphics({x:r,y:i}).setDepth(d.Debug),this.debug.lineStyle(3,65280),this.x=r,this.y=i,u.debug&&this.debug.strokeCircle(0,0,n)}setPosition(t,e){this.debug.setVisible(this.light.visible),this.light.setPosition(t,e),this.debug.setPosition(t,e),this.x=t,this.y=e}destroy(t){var e,r;super.destroy(t),this.debug.destroy(),null==(r=null==(e=this.scene)?void 0:e.lights)||r.removeLight(this.light)}}const g={White:"fcfee9",Tan:"e6c99d",Peach:"d07151",Brown:"473946",Teal:"303646",Black:"1c1831",Lights:"ffccaa",Night:"335588",Background:"111111"};function m(t){return r.Display.Color.HexStringToColor(t).color}function b(t){return m(r.Display.Color.RGBToString(255*t.r,255*t.g,255*t.b))}const v={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${g.White}`},w=1200;let x=!1;function S(t){return b(t.lights.ambientColor)===m(g.White)}function k(t,e=!0){x||(j(t,g.White,e),t.lights.lights.forEach((r=>{const i=r.intensity;e?t.tweens.add({targets:r,duration:w,intensity:0,onComplete:()=>{r.setVisible(!1),r.setIntensity(i)}}):r.setVisible(!1)})))}function j(t,e,i){if(!i)return void t.lights.setAmbientColor(m(e));x=!0;const n=b(t.lights.ambientColor),o=r.Display.Color.ValueToColor(n),s=r.Display.Color.ValueToColor(e);t.tweens.addCounter({from:0,to:100,duration:w,onUpdate:e=>{const i=r.Display.Color.Interpolate.ColorWithColor(o,s,100,e.getValue());var n;t.lights.setAmbientColor((n=i,m(r.Display.Color.RGBToString(n.r,n.g,n.b))))},onComplete:()=>{x=!1}})}var O,P,T=Object.prototype.toString,A=function(t){var e=T.call(t),r="[object Arguments]"===e;return r||(r="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===T.call(t.callee)),r},I=Array.prototype.slice,E=A,C=Object.keys,M=C?function(t){return C(t)}:function(){if(P)return O;var t;if(P=1,!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=A,n=Object.prototype.propertyIsEnumerable,o=!n.call({toString:null},"toString"),s=n.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var e=t.constructor;return e&&e.prototype===t},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!c["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(r){return!0}}catch(r){return!0}return!1}();t=function(t){var n=null!==t&&"object"==typeof t,c="[object Function]"===r.call(t),p=i(t),u=n&&"[object String]"===r.call(t),y=[];if(!n&&!c&&!p)throw new TypeError("Object.keys called on a non-object");var d=s&&c;if(u&&t.length>0&&!e.call(t,0))for(var f=0;f<t.length;++f)y.push(String(f));if(p&&t.length>0)for(var g=0;g<t.length;++g)y.push(String(g));else for(var m in t)d&&"prototype"===m||!e.call(t,m)||y.push(String(m));if(o)for(var b=function(t){if("undefined"==typeof window||!h)return l(t);try{return l(t)}catch(e){return!1}}(t),v=0;v<a.length;++v)b&&"constructor"===a[v]||!e.call(t,a[v])||y.push(a[v]);return y}}return O=t}(),F=Object.keys;M.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return E(t)?F(I.call(t)):F(t)})}else Object.keys=M;return Object.keys||M};var B,D=M,R=Error,W=EvalError,z=RangeError,L=ReferenceError,G=SyntaxError,N=TypeError,U=URIError,_=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var i=Object.getOwnPropertySymbols(t);if(1!==i.length||i[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0},$="undefined"!=typeof Symbol&&Symbol,V=_,q=function(){return"function"==typeof $&&"function"==typeof Symbol&&"symbol"==typeof $("foo")&&"symbol"==typeof Symbol("bar")&&V()},H={__proto__:null,foo:{}},X=Object,K=Object.prototype.toString,Y=Math.max,Q=function(t,e){for(var r=[],i=0;i<t.length;i+=1)r[i]=t[i];for(var n=0;n<e.length;n+=1)r[n+t.length]=e[n];return r},J=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||"[object Function]"!==K.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var r,i=function(t,e){for(var r=[],i=1,n=0;i<t.length;i+=1,n+=1)r[n]=t[i];return r}(arguments),n=Y(0,e.length-i.length),o=[],s=0;s<n;s++)o[s]="$"+s;if(r=Function("binder","return function ("+function(t,e){for(var r="",i=0;i<t.length;i+=1)r+=t[i],i+1<t.length&&(r+=",");return r}(o)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof r){var n=e.apply(this,Q(i,arguments));return Object(n)===n?n:this}return e.apply(t,Q(i,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,r.prototype=new a,a.prototype=null}return r},Z=Function.prototype.call,tt=Object.prototype.hasOwnProperty,et=J.call(Z,tt),rt=R,it=W,nt=z,ot=L,st=G,at=N,lt=U,ct=Function,ht=function(t){try{return ct('"use strict"; return ('+t+").constructor;")()}catch(e){}},pt=Object.getOwnPropertyDescriptor;if(pt)try{pt({},"")}catch(Ll){pt=null}var ut=function(){throw new at},yt=pt?function(){try{return ut}catch(t){try{return pt(arguments,"callee").get}catch(e){return ut}}}():ut,dt=q(),ft={__proto__:H}.foo===H.foo&&!(H instanceof X),gt=Object.getPrototypeOf||(ft?function(t){return t.__proto__}:null),mt={},bt="undefined"!=typeof Uint8Array&&gt?gt(Uint8Array):B,vt={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?B:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?B:ArrayBuffer,"%ArrayIteratorPrototype%":dt&&gt?gt([][Symbol.iterator]()):B,"%AsyncFromSyncIteratorPrototype%":B,"%AsyncFunction%":mt,"%AsyncGenerator%":mt,"%AsyncGeneratorFunction%":mt,"%AsyncIteratorPrototype%":mt,"%Atomics%":"undefined"==typeof Atomics?B:Atomics,"%BigInt%":"undefined"==typeof BigInt?B:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?B:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?B:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?B:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":rt,"%eval%":eval,"%EvalError%":it,"%Float32Array%":"undefined"==typeof Float32Array?B:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?B:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?B:FinalizationRegistry,"%Function%":ct,"%GeneratorFunction%":mt,"%Int8Array%":"undefined"==typeof Int8Array?B:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?B:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?B:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":dt&&gt?gt(gt([][Symbol.iterator]())):B,"%JSON%":"object"==typeof JSON?JSON:B,"%Map%":"undefined"==typeof Map?B:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&dt&&gt?gt((new Map)[Symbol.iterator]()):B,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?B:Promise,"%Proxy%":"undefined"==typeof Proxy?B:Proxy,"%RangeError%":nt,"%ReferenceError%":ot,"%Reflect%":"undefined"==typeof Reflect?B:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?B:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&dt&&gt?gt((new Set)[Symbol.iterator]()):B,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?B:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":dt&&gt?gt(""[Symbol.iterator]()):B,"%Symbol%":dt?Symbol:B,"%SyntaxError%":st,"%ThrowTypeError%":yt,"%TypedArray%":bt,"%TypeError%":at,"%Uint8Array%":"undefined"==typeof Uint8Array?B:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?B:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?B:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?B:Uint32Array,"%URIError%":lt,"%WeakMap%":"undefined"==typeof WeakMap?B:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?B:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?B:WeakSet};if(gt)try{null.error}catch(Ll){var wt=gt(gt(Ll));vt["%Error.prototype%"]=wt}var xt=function t(e){var r;if("%AsyncFunction%"===e)r=ht("async function () {}");else if("%GeneratorFunction%"===e)r=ht("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=ht("async function* () {}");else if("%AsyncGenerator%"===e){var i=t("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&gt&&(r=gt(n.prototype))}return vt[e]=r,r},St={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},kt=J,jt=et,Ot=kt.call(Function.call,Array.prototype.concat),Pt=kt.call(Function.apply,Array.prototype.splice),Tt=kt.call(Function.call,String.prototype.replace),At=kt.call(Function.call,String.prototype.slice),It=kt.call(Function.call,RegExp.prototype.exec),Et=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ct=/\\(\\)?/g,Mt=function(t,e){var r,i=t;if(jt(St,i)&&(i="%"+(r=St[i])[0]+"%"),jt(vt,i)){var n=vt[i];if(n===mt&&(n=xt(i)),void 0===n&&!e)throw new at("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:n}}throw new st("intrinsic "+t+" does not exist!")},Ft=function(t,e){if("string"!=typeof t||0===t.length)throw new at("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new at('"allowMissing" argument must be a boolean');if(null===It(/^%?[^%]*%?$/,t))throw new st("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=At(t,0,1),r=At(t,-1);if("%"===e&&"%"!==r)throw new st("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new st("invalid intrinsic syntax, expected opening `%`");var i=[];return Tt(t,Et,(function(t,e,r,n){i[i.length]=r?Tt(n,Ct,"$1"):e||t})),i}(t),i=r.length>0?r[0]:"",n=Mt("%"+i+"%",e),o=n.name,s=n.value,a=!1,l=n.alias;l&&(i=l[0],Pt(r,Ot([0,1],l)));for(var c=1,h=!0;c<r.length;c+=1){var p=r[c],u=At(p,0,1),y=At(p,-1);if(('"'===u||"'"===u||"`"===u||'"'===y||"'"===y||"`"===y)&&u!==y)throw new st("property names with quotes must have matching quotes");if("constructor"!==p&&h||(a=!0),jt(vt,o="%"+(i+="."+p)+"%"))s=vt[o];else if(null!=s){if(!(p in s)){if(!e)throw new at("base intrinsic for "+t+" exists, but the property is not available.");return}if(pt&&c+1>=r.length){var d=pt(s,p);s=(h=!!d)&&"get"in d&&!("originalValue"in d.get)?d.get:s[p]}else h=jt(s,p),s=s[p];h&&!a&&(vt[o]=s)}}return s},Bt=Ft("%Object.defineProperty%",!0)||!1;if(Bt)try{Bt({},"a",{value:1})}catch(Ll){Bt=!1}var Dt=Bt,Rt=Ft("%Object.getOwnPropertyDescriptor%",!0);if(Rt)try{Rt([],"length")}catch(Ll){Rt=null}var Wt=Rt,zt=Dt,Lt=G,Gt=N,Nt=Wt,Ut=function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Gt("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new Gt("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Gt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Gt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Gt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Gt("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,s=arguments.length>6&&arguments[6],a=!!Nt&&Nt(t,e);if(zt)zt(t,e,{configurable:null===o&&a?a.configurable:!o,enumerable:null===i&&a?a.enumerable:!i,value:r,writable:null===n&&a?a.writable:!n});else{if(!s&&(i||n||o))throw new Lt("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=r}},_t=Dt,$t=function(){return!!_t};$t.hasArrayLengthDefineBug=function(){if(!_t)return null;try{return 1!==_t([],"length",{value:1}).length}catch(Ll){return!0}};var Vt=$t,qt=D,Ht="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Xt=Object.prototype.toString,Kt=Array.prototype.concat,Yt=Ut,Qt=Vt(),Jt=function(t,e,r,i){if(e in t)if(!0===i){if(t[e]===r)return}else if("function"!=typeof(n=i)||"[object Function]"!==Xt.call(n)||!i())return;var n;Qt?Yt(t,e,r,!0):Yt(t,e,r)},Zt=function(t,e){var r=arguments.length>2?arguments[2]:{},i=qt(e);Ht&&(i=Kt.call(i,Object.getOwnPropertySymbols(e)));for(var n=0;n<i.length;n+=1)Jt(t,i[n],e[i[n]],r[i[n]])};Zt.supportsDescriptors=!!Qt;var te=Zt,ee={exports:{}},re=Ft,ie=Ut,ne=Vt(),oe=Wt,se=N,ae=re("%Math.floor%"),le=function(t,e){if("function"!=typeof t)throw new se("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||ae(e)!==e)throw new se("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],i=!0,n=!0;if("length"in t&&oe){var o=oe(t,"length");o&&!o.configurable&&(i=!1),o&&!o.writable&&(n=!1)}return(i||n||!r)&&(ne?ie(t,"length",e,!0,!0):ie(t,"length",e)),t};!function(t){var e=J,r=Ft,i=le,n=N,o=r("%Function.prototype.apply%"),s=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||e.call(s,o),l=Dt,c=r("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new n("a function is required");var r=a(e,s,arguments);return i(r,1+c(0,t.length-(arguments.length-1)),!0)};var h=function(){return a(e,o,arguments)};l?l(t.exports,"apply",{value:h}):t.exports.apply=h}(ee);var ce=ee.exports,he=Ft,pe=ce,ue=pe(he("String.prototype.indexOf")),ye=function(t,e){var r=he(t,!!e);return"function"==typeof r&&ue(t,".prototype.")>-1?pe(r):r},de=D,fe=_(),ge=ye,me=Object,be=ge("Array.prototype.push"),ve=ge("Object.prototype.propertyIsEnumerable"),we=fe?Object.getOwnPropertySymbols:null,xe=function(t,e){if(null==t)throw new TypeError("target must be an object");var r=me(t);if(1===arguments.length)return r;for(var i=1;i<arguments.length;++i){var n=me(arguments[i]),o=de(n),s=fe&&(Object.getOwnPropertySymbols||we);if(s)for(var a=s(n),l=0;l<a.length;++l){var c=a[l];ve(n,c)&&be(o,c)}for(var h=0;h<o.length;++h){var p=o[h];if(ve(n,p)){var u=n[p];r[p]=u}}}return r},Se=xe,ke=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),r={},i=0;i<e.length;++i)r[e[i]]=e[i];var n=Object.assign({},r),o="";for(var s in n)o+=s;return t!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(Ll){return"y"===t[1]}return!1}()?Se:Object.assign:Se},je=te,Oe=ke,Pe=te,Te=xe,Ae=ke,Ie=ce.apply(Ae()),Ee=function(t,e){return Ie(Object,arguments)};Pe(Ee,{getPolyfill:Ae,implementation:Te,shim:function(){var t=Oe();return je(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var Ce=Ee,Me=function(){return"string"==typeof function(){}.name},Fe=Object.getOwnPropertyDescriptor;if(Fe)try{Fe([],"length")}catch(Ll){Fe=null}Me.functionsHaveConfigurableNames=function(){if(!Me()||!Fe)return!1;var t=Fe((function(){}),"name");return!!t&&!!t.configurable};var Be=Function.prototype.bind;Me.boundFunctionsHaveNames=function(){return Me()&&"function"==typeof Be&&""!==function(){}.bind().name};var De=Me,Re=Ut,We=Vt(),ze=De.functionsHaveConfigurableNames(),Le=N,Ge=N,Ne=Object,Ue=function(t,e){if("function"!=typeof t)throw new Le("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!ze||(We?Re(t,"name",e,!0,!0):Re(t,"name",e)),t}((function(){if(null==this||this!==Ne(this))throw new Ge("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0),_e=Ue,$e=te.supportsDescriptors,Ve=Object.getOwnPropertyDescriptor,qe=function(){if($e&&"gim"===/a/gim.flags){var t=Ve(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(r,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return _e},He=te.supportsDescriptors,Xe=qe,Ke=Object.getOwnPropertyDescriptor,Ye=Object.defineProperty,Qe=TypeError,Je=Object.getPrototypeOf,Ze=/a/,tr=te,er=Ue,rr=qe,ir=ce(rr());tr(ir,{getPolyfill:rr,implementation:er,shim:function(){if(!He||!Je)throw new Qe("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Xe(),e=Je(Ze),r=Ke(e,"flags");return r&&r.get===t||Ye(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var nr=ir,or={exports:{}},sr=_,ar=function(){return sr()&&!!Symbol.toStringTag},lr=ar(),cr=ye("Object.prototype.toString"),hr=function(t){return!(lr&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===cr(t)},pr=function(t){return!!hr(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==cr(t)&&"[object Function]"===cr(t.callee)},ur=function(){return hr(arguments)}();hr.isLegacyArguments=pr;var yr=ur?hr:pr;const dr=i(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var fr="function"==typeof Map&&Map.prototype,gr=Object.getOwnPropertyDescriptor&&fr?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mr=fr&&gr&&"function"==typeof gr.get?gr.get:null,br=fr&&Map.prototype.forEach,vr="function"==typeof Set&&Set.prototype,wr=Object.getOwnPropertyDescriptor&&vr?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,xr=vr&&wr&&"function"==typeof wr.get?wr.get:null,Sr=vr&&Set.prototype.forEach,kr="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,jr="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,Or="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,Pr=Boolean.prototype.valueOf,Tr=Object.prototype.toString,Ar=Function.prototype.toString,Ir=String.prototype.match,Er=String.prototype.slice,Cr=String.prototype.replace,Mr=String.prototype.toUpperCase,Fr=String.prototype.toLowerCase,Br=RegExp.prototype.test,Dr=Array.prototype.concat,Rr=Array.prototype.join,Wr=Array.prototype.slice,zr=Math.floor,Lr="function"==typeof BigInt?BigInt.prototype.valueOf:null,Gr=Object.getOwnPropertySymbols,Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Ur="function"==typeof Symbol&&"object"==typeof Symbol.iterator,_r="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,$r=Object.prototype.propertyIsEnumerable,Vr=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function qr(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||Br.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var i=t<0?-zr(-t):zr(t);if(i!==t){var n=String(i),o=Er.call(e,n.length+1);return Cr.call(n,r,"$&_")+"."+Cr.call(Cr.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Cr.call(e,r,"$&_")}var Hr=dr,Xr=Hr.custom,Kr=ti(Xr)?Xr:null;function Yr(t,e,r){var i="double"===(r.quoteStyle||e)?'"':"'";return i+t+i}function Qr(t){return Cr.call(String(t),/"/g,"&quot;")}function Jr(t){return!("[object Array]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}function Zr(t){return!("[object RegExp]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}function ti(t){if(Ur)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!Nr)return!1;try{return Nr.call(t),!0}catch(Ll){}return!1}var ei=Object.prototype.hasOwnProperty||function(t){return t in this};function ri(t,e){return ei.call(t,e)}function ii(t){return Tr.call(t)}function ni(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}function oi(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,i="... "+r+" more character"+(r>1?"s":"");return oi(Er.call(t,0,e.maxStringLength),e)+i}return Yr(Cr.call(Cr.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,si),"single",e)}function si(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+Mr.call(e.toString(16))}function ai(t){return"Object("+t+")"}function li(t){return t+" { ? }"}function ci(t,e,r,i){return t+" ("+e+") {"+(i?hi(r,i):Rr.call(r,", "))+"}"}function hi(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+Rr.call(t,","+r)+"\n"+e.prev}function pi(t,e){var r=Jr(t),i=[];if(r){i.length=t.length;for(var n=0;n<t.length;n++)i[n]=ri(t,n)?e(t[n],t):""}var o,s="function"==typeof Gr?Gr(t):[];if(Ur){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in t)ri(t,l)&&(r&&String(Number(l))===l&&l<t.length||Ur&&o["$"+l]instanceof Symbol||(Br.call(/[^\w$]/,l)?i.push(e(l,t)+": "+e(t[l],t)):i.push(l+": "+e(t[l],t))));if("function"==typeof Gr)for(var c=0;c<s.length;c++)$r.call(t,s[c])&&i.push("["+e(s[c])+"]: "+e(t[s[c]],t));return i}var ui=Ft,yi=ye,di=function t(e,r,i,o){var s=r||{};if(ri(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ri(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!ri(s,"customInspect")||s.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ri(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ri(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=s.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return oi(e,s);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var c=String(e);return l?qr(e,c):c}if("bigint"==typeof e){var h=String(e)+"n";return l?qr(e,h):h}var p=void 0===s.depth?5:s.depth;if(void 0===i&&(i=0),i>=p&&p>0&&"object"==typeof e)return Jr(e)?"[Array]":"[Object]";var u,y=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=Rr.call(Array(t.indent+1)," ")}return{base:r,prev:Rr.call(Array(e+1),r)}}(s,i);if(void 0===o)o=[];else if(ni(o,e)>=0)return"[Circular]";function d(e,r,n){if(r&&(o=Wr.call(o)).push(r),n){var a={depth:s.depth};return ri(s,"quoteStyle")&&(a.quoteStyle=s.quoteStyle),t(e,a,i+1,o)}return t(e,s,i+1,o)}if("function"==typeof e&&!Zr(e)){var f=function(t){if(t.name)return t.name;var e=Ir.call(Ar.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),g=pi(e,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(g.length>0?" { "+Rr.call(g,", ")+" }":"")}if(ti(e)){var m=Ur?Cr.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Nr.call(e);return"object"!=typeof e||Ur?m:ai(m)}if((u=e)&&"object"==typeof u&&("undefined"!=typeof HTMLElement&&u instanceof HTMLElement||"string"==typeof u.nodeName&&"function"==typeof u.getAttribute)){for(var b="<"+Fr.call(String(e.nodeName)),v=e.attributes||[],w=0;w<v.length;w++)b+=" "+v[w].name+"="+Yr(Qr(v[w].value),"double",s);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+"</"+Fr.call(String(e.nodeName))+">"}if(Jr(e)){if(0===e.length)return"[]";var x=pi(e,d);return y&&!function(t){for(var e=0;e<t.length;e++)if(ni(t[e],"\n")>=0)return!1;return!0}(x)?"["+hi(x,y)+"]":"[ "+Rr.call(x,", ")+" ]"}if(function(t){return!("[object Error]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}(e)){var S=pi(e,d);return"cause"in Error.prototype||!("cause"in e)||$r.call(e,"cause")?0===S.length?"["+String(e)+"]":"{ ["+String(e)+"] "+Rr.call(S,", ")+" }":"{ ["+String(e)+"] "+Rr.call(Dr.call("[cause]: "+d(e.cause),S),", ")+" }"}if("object"==typeof e&&a){if(Kr&&"function"==typeof e[Kr]&&Hr)return Hr(e,{depth:p-i});if("symbol"!==a&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!mr||!t||"object"!=typeof t)return!1;try{mr.call(t);try{xr.call(t)}catch(b){return!0}return t instanceof Map}catch(Ll){}return!1}(e)){var k=[];return br&&br.call(e,(function(t,r){k.push(d(r,e,!0)+" => "+d(t,e))})),ci("Map",mr.call(e),k,y)}if(function(t){if(!xr||!t||"object"!=typeof t)return!1;try{xr.call(t);try{mr.call(t)}catch(e){return!0}return t instanceof Set}catch(Ll){}return!1}(e)){var j=[];return Sr&&Sr.call(e,(function(t){j.push(d(t,e))})),ci("Set",xr.call(e),j,y)}if(function(t){if(!kr||!t||"object"!=typeof t)return!1;try{kr.call(t,kr);try{jr.call(t,jr)}catch(b){return!0}return t instanceof WeakMap}catch(Ll){}return!1}(e))return li("WeakMap");if(function(t){if(!jr||!t||"object"!=typeof t)return!1;try{jr.call(t,jr);try{kr.call(t,kr)}catch(b){return!0}return t instanceof WeakSet}catch(Ll){}return!1}(e))return li("WeakSet");if(function(t){if(!Or||!t||"object"!=typeof t)return!1;try{return Or.call(t),!0}catch(Ll){}return!1}(e))return li("WeakRef");if(function(t){return!("[object Number]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}(e))return ai(d(Number(e)));if(function(t){if(!t||"object"!=typeof t||!Lr)return!1;try{return Lr.call(t),!0}catch(Ll){}return!1}(e))return ai(d(Lr.call(e)));if(function(t){return!("[object Boolean]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}(e))return ai(Pr.call(e));if(function(t){return!("[object String]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}(e))return ai(d(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==n&&e===n)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==ii(t)||_r&&"object"==typeof t&&_r in t)}(e)&&!Zr(e)){var O=pi(e,d),P=Vr?Vr(e)===Object.prototype:e instanceof Object||e.constructor===Object,T=e instanceof Object?"":"null prototype",A=!P&&_r&&Object(e)===e&&_r in e?Er.call(ii(e),8,-1):T?"Object":"",I=(P||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(A||T?"["+Rr.call(Dr.call([],A||[],T||[]),": ")+"] ":"");return 0===O.length?I+"{}":y?I+"{"+hi(O,y)+"}":I+"{ "+Rr.call(O,", ")+" }"}return String(e)},fi=N,gi=ui("%WeakMap%",!0),mi=ui("%Map%",!0),bi=yi("WeakMap.prototype.get",!0),vi=yi("WeakMap.prototype.set",!0),wi=yi("WeakMap.prototype.has",!0),xi=yi("Map.prototype.get",!0),Si=yi("Map.prototype.set",!0),ki=yi("Map.prototype.has",!0),ji=function(t,e){for(var r,i=t;null!==(r=i.next);i=r)if(r.key===e)return i.next=r.next,r.next=t.next,t.next=r,r},Oi=function(){var t,e,r,i={assert:function(t){if(!i.has(t))throw new fi("Side channel does not contain "+di(t))},get:function(i){if(gi&&i&&("object"==typeof i||"function"==typeof i)){if(t)return bi(t,i)}else if(mi){if(e)return xi(e,i)}else if(r)return function(t,e){var r=ji(t,e);return r&&r.value}(r,i)},has:function(i){if(gi&&i&&("object"==typeof i||"function"==typeof i)){if(t)return wi(t,i)}else if(mi){if(e)return ki(e,i)}else if(r)return function(t,e){return!!ji(t,e)}(r,i);return!1},set:function(i,n){gi&&i&&("object"==typeof i||"function"==typeof i)?(t||(t=new gi),vi(t,i,n)):mi?(e||(e=new mi),Si(e,i,n)):(r||(r={key:{},next:null}),function(t,e,r){var i=ji(t,e);i?i.value=r:t.next={key:e,next:t.next,value:r}}(r,i,n))}};return i},Pi=et,Ti=Oi(),Ai=N,Ii={assert:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Ai("`O` is not an object");if("string"!=typeof e)throw new Ai("`slot` must be a string");if(Ti.assert(t),!Ii.has(t,e))throw new Ai("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Ai("`O` is not an object");if("string"!=typeof e)throw new Ai("`slot` must be a string");var r=Ti.get(t);return r&&r["$"+e]},has:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Ai("`O` is not an object");if("string"!=typeof e)throw new Ai("`slot` must be a string");var r=Ti.get(t);return!!r&&Pi(r,"$"+e)},set:function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Ai("`O` is not an object");if("string"!=typeof e)throw new Ai("`slot` must be a string");var i=Ti.get(t);i||(i={},Ti.set(t,i)),i["$"+e]=r}};Object.freeze&&Object.freeze(Ii);var Ei,Ci=Ii,Mi=SyntaxError,Fi="object"==typeof StopIteration?StopIteration:null,Bi={}.toString,Di=Array.isArray||function(t){return"[object Array]"==Bi.call(t)},Ri=String.prototype.valueOf,Wi=Object.prototype.toString,zi=ar(),Li=function(t){return"string"==typeof t||"object"==typeof t&&(zi?function(t){try{return Ri.call(t),!0}catch(Ll){return!1}}(t):"[object String]"===Wi.call(t))},Gi="function"==typeof Map&&Map.prototype?Map:null,Ni="function"==typeof Set&&Set.prototype?Set:null;Gi||(Ei=function(t){return!1});var Ui=Gi?Map.prototype.has:null,_i=Ni?Set.prototype.has:null;Ei||Ui||(Ei=function(t){return!1});var $i,Vi=Ei||function(t){if(!t||"object"!=typeof t)return!1;try{if(Ui.call(t),_i)try{_i.call(t)}catch(Ll){return!0}return t instanceof Gi}catch(Ll){}return!1},qi="function"==typeof Map&&Map.prototype?Map:null,Hi="function"==typeof Set&&Set.prototype?Set:null;Hi||($i=function(t){return!1});var Xi=qi?Map.prototype.has:null,Ki=Hi?Set.prototype.has:null;$i||Ki||($i=function(t){return!1});var Yi=$i||function(t){if(!t||"object"!=typeof t)return!1;try{if(Ki.call(t),Xi)try{Xi.call(t)}catch(Ll){return!0}return t instanceof Hi}catch(Ll){}return!1},Qi=yr,Ji=function(t){if(!Fi)throw new Mi("this environment lacks StopIteration");Ci.set(t,"[[Done]]",!1);var e={next:function(){var t=Ci.get(this,"[[Iterator]]"),e=Ci.get(t,"[[Done]]");try{return{done:e,value:e?void 0:t.next()}}catch(Ll){if(Ci.set(t,"[[Done]]",!0),Ll!==Fi)throw Ll;return{done:!0,value:void 0}}}};return Ci.set(e,"[[Iterator]]",t),e};if(q()||_()){var Zi=Symbol.iterator;or.exports=function(t){return null!=t&&void 0!==t[Zi]?t[Zi]():Qi(t)?Array.prototype[Zi].call(t):void 0}}else{var tn=Di,en=Li,rn=Ft,nn=rn("%Map%",!0),on=rn("%Set%",!0),sn=ye,an=sn("Array.prototype.push"),ln=sn("String.prototype.charCodeAt"),cn=sn("String.prototype.slice"),hn=function(t){var e=0;return{next:function(){var r,i=e>=t.length;return i||(r=t[e],e+=1),{done:i,value:r}}}},pn=function(t,e){if(tn(t)||Qi(t))return hn(t);if(en(t)){var r=0;return{next:function(){var e=function(t,e){if(e+1>=t.length)return e+1;var r=ln(t,e);if(r<55296||r>56319)return e+1;var i=ln(t,e+1);return i<56320||i>57343?e+1:e+2}(t,r),i=cn(t,r,e);return r=e,{done:e>t.length,value:i}}}}return e&&void 0!==t["_es6-shim iterator_"]?t["_es6-shim iterator_"]():void 0};if(nn||on){var un=Vi,yn=Yi,dn=sn("Map.prototype.forEach",!0),fn=sn("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var gn=sn("Map.prototype.iterator",!0),mn=sn("Set.prototype.iterator",!0);var bn=sn("Map.prototype.@@iterator",!0)||sn("Map.prototype._es6-shim iterator_",!0),vn=sn("Set.prototype.@@iterator",!0)||sn("Set.prototype._es6-shim iterator_",!0);or.exports=function(t){return function(t){if(un(t)){if(gn)return Ji(gn(t));if(bn)return bn(t);if(dn){var e=[];return dn(t,(function(t,r){an(e,[r,t])})),hn(e)}}if(yn(t)){if(mn)return Ji(mn(t));if(vn)return vn(t);if(fn){var r=[];return fn(t,(function(t){an(r,t)})),hn(r)}}}(t)||pn(t)}}else or.exports=function(t){if(null!=t)return pn(t,!0)}}var wn=or.exports,xn=function(t){return t!=t},Sn=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!xn(t)||!xn(e))},kn=Sn,jn=function(){return"function"==typeof Object.is?Object.is:kn},On=jn,Pn=te,Tn=te,An=Sn,In=jn,En=ce(In(),Object);Tn(En,{getPolyfill:In,implementation:An,shim:function(){var t=On();return Pn(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var Cn,Mn,Fn,Bn,Dn=En,Rn=ce,Wn=ye,zn=Ft("%ArrayBuffer%",!0),Ln=Wn("ArrayBuffer.prototype.byteLength",!0),Gn=Wn("Object.prototype.toString"),Nn=!!zn&&!Ln&&new zn(0).slice,Un=!!Nn&&Rn(Nn),_n=Ln||Un?function(t){if(!t||"object"!=typeof t)return!1;try{return Ln?Ln(t):Un(t,0),!0}catch(Ll){return!1}}:zn?function(t){return"[object ArrayBuffer]"===Gn(t)}:function(t){return!1},$n=Date.prototype.getDay,Vn=Object.prototype.toString,qn=ar(),Hn=ye,Xn=ar();if(Xn){Cn=Hn("Object.prototype.hasOwnProperty"),Mn=Hn("RegExp.prototype.exec"),Fn={};var Kn=function(){throw Fn};Bn={toString:Kn,valueOf:Kn},"symbol"==typeof Symbol.toPrimitive&&(Bn[Symbol.toPrimitive]=Kn)}var Yn=Hn("Object.prototype.toString"),Qn=Object.getOwnPropertyDescriptor,Jn=Xn?function(t){if(!t||"object"!=typeof t)return!1;var e=Qn(t,"lastIndex");if(!e||!Cn(e,"value"))return!1;try{Mn(t,Bn)}catch(Ll){return Ll===Fn}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===Yn(t)},Zn=ye("SharedArrayBuffer.prototype.byteLength",!0),to=Zn?function(t){if(!t||"object"!=typeof t)return!1;try{return Zn(t),!0}catch(Ll){return!1}}:function(t){return!1},eo=Number.prototype.toString,ro=Object.prototype.toString,io=ar(),no=ye,oo=no("Boolean.prototype.toString"),so=no("Object.prototype.toString"),ao=ar(),lo={exports:{}},co=Object.prototype.toString;if(q()){var ho=Symbol.prototype.toString,po=/^Symbol\(.*\)$/;lo.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==co.call(t))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&po.test(ho.call(t))}(t)}catch(Ll){return!1}}}else lo.exports=function(t){return!1};var uo=lo.exports,yo={exports:{}},fo="undefined"!=typeof BigInt&&BigInt;if("function"==typeof fo&&"function"==typeof BigInt&&"bigint"==typeof fo(42)&&"bigint"==typeof BigInt(42)){var go=BigInt.prototype.valueOf;yo.exports=function(t){return null!=t&&"boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t&&"symbol"!=typeof t&&"function"!=typeof t&&("bigint"==typeof t||function(t){try{return go.call(t),!0}catch(Ll){}return!1}(t))}}else yo.exports=function(t){return!1};var mo,bo=yo.exports,vo=Li,wo=uo,xo=bo,So="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,ko="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;So||(mo=function(t){return!1});var jo=So?So.prototype.has:null,Oo=ko?ko.prototype.has:null;mo||jo||(mo=function(t){return!1});var Po=mo||function(t){if(!t||"object"!=typeof t)return!1;try{if(jo.call(t,jo),Oo)try{Oo.call(t,Oo)}catch(Ll){return!0}return t instanceof So}catch(Ll){}return!1},To={exports:{}},Ao=ye,Io=Ft("%WeakSet%",!0),Eo=Ao("WeakSet.prototype.has",!0);if(Eo){var Co=Ao("WeakMap.prototype.has",!0);To.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(Eo(t,Eo),Co)try{Co(t,Co)}catch(Ll){return!0}return t instanceof Io}catch(Ll){}return!1}}else To.exports=function(t){return!1};var Mo,Fo,Bo=To.exports,Do=Vi,Ro=Yi,Wo=Po,zo=Bo,Lo=Function.prototype.toString,Go="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof Go&&"function"==typeof Object.defineProperty)try{Mo=Object.defineProperty({},"length",{get:function(){throw Fo}}),Fo={},Go((function(){throw 42}),null,Mo)}catch(Gl){Gl!==Fo&&(Go=null)}else Go=null;var No=/^\s*class\b/,Uo=function(t){try{var e=Lo.call(t);return No.test(e)}catch(Ll){return!1}},_o=function(t){try{return!Uo(t)&&(Lo.call(t),!0)}catch(Ll){return!1}},$o=Object.prototype.toString,Vo="function"==typeof Symbol&&!!Symbol.toStringTag,qo=!(0 in[,]),Ho=function(){return!1};if("object"==typeof document){var Xo=document.all;$o.call(Xo)===$o.call(document.all)&&(Ho=function(t){if((qo||!t)&&(void 0===t||"object"==typeof t))try{var e=$o.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(Ll){}return!1})}var Ko=Go?function(t){if(Ho(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{Go(t,null,Mo)}catch(Ll){if(Ll!==Fo)return!1}return!Uo(t)&&_o(t)}:function(t){if(Ho(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(Vo)return _o(t);if(Uo(t))return!1;var e=$o.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&_o(t)},Yo=Object.prototype.toString,Qo=Object.prototype.hasOwnProperty,Jo=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Zo="undefined"==typeof globalThis?n:globalThis,ts=function(t,e,r){if(!Ko(e))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=r),"[object Array]"===Yo.call(t)?function(t,e,r){for(var i=0,n=t.length;i<n;i++)Qo.call(t,i)&&(null==r?e(t[i],i,t):e.call(r,t[i],i,t))}(t,e,i):"string"==typeof t?function(t,e,r){for(var i=0,n=t.length;i<n;i++)null==r?e(t.charAt(i),i,t):e.call(r,t.charAt(i),i,t)}(t,e,i):function(t,e,r){for(var i in t)Qo.call(t,i)&&(null==r?e(t[i],i,t):e.call(r,t[i],i,t))}(t,e,i)},es=ce,rs=ye,is=Wt,ns=rs("Object.prototype.toString"),os=ar(),ss="undefined"==typeof globalThis?n:globalThis,as=function(){for(var t=[],e=0;e<Jo.length;e++)"function"==typeof Zo[Jo[e]]&&(t[t.length]=Jo[e]);return t}(),ls=rs("String.prototype.slice"),cs=Object.getPrototypeOf,hs=rs("Array.prototype.indexOf",!0)||function(t,e){for(var r=0;r<t.length;r+=1)if(t[r]===e)return r;return-1},ps={__proto__:null};ts(as,os&&is&&cs?function(t){var e=new ss[t];if(Symbol.toStringTag in e){var r=cs(e),i=is(r,Symbol.toStringTag);if(!i){var n=cs(r);i=is(n,Symbol.toStringTag)}ps["$"+t]=es(i.get)}}:function(t){var e=new ss[t],r=e.slice||e.set;r&&(ps["$"+t]=es(r))});var us=ye("ArrayBuffer.prototype.byteLength",!0),ys=_n,ds=Ce,fs=ye,gs=nr,ms=Ft,bs=wn,vs=Oi,ws=Dn,xs=yr,Ss=Di,ks=_n,js=function(t){return"object"==typeof t&&null!==t&&(qn?function(t){try{return $n.call(t),!0}catch(Ll){return!1}}(t):"[object Date]"===Vn.call(t))},Os=Jn,Ps=to,Ts=D,As=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t?null:vo(t)?"String":function(t){return"number"==typeof t||"object"==typeof t&&(io?function(t){try{return eo.call(t),!0}catch(Ll){return!1}}(t):"[object Number]"===ro.call(t))}(t)?"Number":function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(ao&&Symbol.toStringTag in t?function(t){try{return oo(t),!0}catch(Ll){return!1}}(t):"[object Boolean]"===so(t))}(t)?"Boolean":wo(t)?"Symbol":xo(t)?"BigInt":void 0},Is=function(t){if(t&&"object"==typeof t){if(Do(t))return"Map";if(Ro(t))return"Set";if(Wo(t))return"WeakMap";if(zo(t))return"WeakSet"}return!1},Es=function(t){if(!t||"object"!=typeof t)return!1;if(!os){var e=ls(ns(t),8,-1);return hs(as,e)>-1?e:"Object"===e&&function(t){var e=!1;return ts(ps,(function(r,i){if(!e)try{r(t),e=ls(i,1)}catch(Ll){}})),e}(t)}return is?function(t){var e=!1;return ts(ps,(function(r,i){if(!e)try{"$"+r(t)===i&&(e=ls(i,1))}catch(Ll){}})),e}(t):null},Cs=function(t){return ys(t)?us?us(t):t.byteLength:NaN},Ms=fs("SharedArrayBuffer.prototype.byteLength",!0),Fs=fs("Date.prototype.getTime"),Bs=Object.getPrototypeOf,Ds=fs("Object.prototype.toString"),Rs=ms("%Set%",!0),Ws=fs("Map.prototype.has",!0),zs=fs("Map.prototype.get",!0),Ls=fs("Map.prototype.size",!0),Gs=fs("Set.prototype.add",!0),Ns=fs("Set.prototype.delete",!0),Us=fs("Set.prototype.has",!0),_s=fs("Set.prototype.size",!0);function $s(t,e,r,i){for(var n,o=bs(t);(n=o.next())&&!n.done;)if(Ks(e,n.value,r,i))return Ns(t,n.value),!0;return!1}function Vs(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function qs(t,e,r,i,n,o){var s=Vs(r);if(null!=s)return s;var a=zs(e,s),l=ds({},n,{strict:!1});return!(void 0===a&&!Ws(e,s)||!Ks(i,a,l,o))&&!Ws(t,s)&&Ks(i,a,l,o)}function Hs(t,e,r){var i=Vs(r);return null!=i?i:Us(e,i)&&!Us(t,i)}function Xs(t,e,r,i,n,o){for(var s,a,l=bs(t);(s=l.next())&&!s.done;)if(Ks(r,a=s.value,n,o)&&Ks(i,zs(e,a),n,o))return Ns(t,a),!0;return!1}function Ks(t,e,r,i){var n=r||{};if(n.strict?ws(t,e):t===e)return!0;if(As(t)!==As(e))return!1;if(!t||!e||"object"!=typeof t&&"object"!=typeof e)return n.strict?ws(t,e):t==e;var o,s=i.has(t),a=i.has(e);if(s&&a){if(i.get(t)===i.get(e))return!0}else o={};return s||i.set(t,o),a||i.set(e,o),function(t,e,r,i){var n,o;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Ds(t)!==Ds(e))return!1;if(xs(t)!==xs(e))return!1;if(Ss(t)!==Ss(e))return!1;var s=t instanceof Error,a=e instanceof Error;if(s!==a)return!1;if((s||a)&&(t.name!==e.name||t.message!==e.message))return!1;var l=Os(t),c=Os(e);if(l!==c)return!1;if((l||c)&&(t.source!==e.source||gs(t)!==gs(e)))return!1;var h=js(t),p=js(e);if(h!==p)return!1;if((h||p)&&Fs(t)!==Fs(e))return!1;if(r.strict&&Bs&&Bs(t)!==Bs(e))return!1;var u=Es(t),y=Es(e);if(u!==y)return!1;if(u||y){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var d=Ys(t),f=Ys(e);if(d!==f)return!1;if(d||f){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var g=ks(t),m=ks(e);if(g!==m)return!1;if(g||m)return Cs(t)===Cs(e)&&"function"==typeof Uint8Array&&Ks(new Uint8Array(t),new Uint8Array(e),r,i);var b=Ps(t),v=Ps(e);if(b!==v)return!1;if(b||v)return Ms(t)===Ms(e)&&"function"==typeof Uint8Array&&Ks(new Uint8Array(t),new Uint8Array(e),r,i);if(typeof t!=typeof e)return!1;var w=Ts(t),x=Ts(e);if(w.length!==x.length)return!1;for(w.sort(),x.sort(),n=w.length-1;n>=0;n--)if(w[n]!=x[n])return!1;for(n=w.length-1;n>=0;n--)if(!Ks(t[o=w[n]],e[o],r,i))return!1;var S=Is(t),k=Is(e);return S===k&&("Set"===S||"Set"===k?function(t,e,r,i){if(_s(t)!==_s(e))return!1;for(var n,o,s,a=bs(t),l=bs(e);(n=a.next())&&!n.done;)if(n.value&&"object"==typeof n.value)s||(s=new Rs),Gs(s,n.value);else if(!Us(e,n.value)){if(r.strict)return!1;if(!Hs(t,e,n.value))return!1;s||(s=new Rs),Gs(s,n.value)}if(s){for(;(o=l.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!$s(s,o.value,r.strict,i))return!1}else if(!r.strict&&!Us(t,o.value)&&!$s(s,o.value,r.strict,i))return!1;return 0===_s(s)}return!0}(t,e,r,i):"Map"!==S||function(t,e,r,i){if(Ls(t)!==Ls(e))return!1;for(var n,o,s,a,l,c,h=bs(t),p=bs(e);(n=h.next())&&!n.done;)if(a=n.value[0],l=n.value[1],a&&"object"==typeof a)s||(s=new Rs),Gs(s,a);else if(void 0===(c=zs(e,a))&&!Ws(e,a)||!Ks(l,c,r,i)){if(r.strict)return!1;if(!qs(t,e,a,l,r,i))return!1;s||(s=new Rs),Gs(s,a)}if(s){for(;(o=p.next())&&!o.done;)if(a=o.value[0],c=o.value[1],a&&"object"==typeof a){if(!Xs(s,t,a,c,r,i))return!1}else if(!(r.strict||t.has(a)&&Ks(zs(t,a),c,r,i)||Xs(s,t,a,c,ds({},r,{strict:!1}),i)))return!1;return 0===_s(s)}return!0}(t,e,r,i))}(t,e,n,i)}function Ys(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0]||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))}const Qs=o((function(t,e,r){return Ks(t,e,r,vs())}));var Js=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t))(Js||{}),Zs=(t=>(t[t.Underground=0]="Underground",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.LakeEast=6]="LakeEast",t[t.TownNorth=7]="TownNorth",t[t.ClockSquare=8]="ClockSquare",t[t.ClockSquareNorth=9]="ClockSquareNorth",t[t.ClockEntrance=10]="ClockEntrance",t[t.ClockStairs=11]="ClockStairs",t[t.ClockTop=12]="ClockTop",t))(Zs||{}),ta=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t))(ta||{}),ea=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t))(ea||{}),ra=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.ClockTower=4]="ClockTower",t))(ra||{}),ia=(t=>(t[t.Sphinx=0]="Sphinx",t))(ia||{}),na=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.ForestMazeSolved=1]="ForestMazeSolved",t[t.SphinxRiddleSolved=2]="SphinxRiddleSolved",t[t.MetTheMayor=3]="MetTheMayor",t[t.ClockFirstGear=4]="ClockFirstGear",t))(na||{}),oa=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t))(oa||{});class sa{constructor(t){e(this,"scene"),e(this,"keys",{0:!1,1:!1,2:!1,3:!1,4:!1,5:!1}),this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W"),this.listener(2,"A"),this.listener(1,"S"),this.listener(3,"D"),this.listener(4,"SPACE"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE")}listener(t,e){var r,i;null==(r=this.scene.input.keyboard)||r.on(`keydown-${e}`,(()=>this.keys[t]=!0)),null==(i=this.scene.input.keyboard)||i.on(`keyup-${e}`,(()=>this.keys[t]=!1))}resetKeys(){this.keys[0]=!1,this.keys[1]=!1,this.keys[2]=!1,this.keys[3]=!1,this.keys[4]=!1,this.keys[5]=!1}}var aa=(t=>(t[t.Ladder=0]="Ladder",t[t.Warp=1]="Warp",t[t.WarpHidden=2]="WarpHidden",t[t.Invisible=3]="Invisible",t))(aa||{});const la={[Zs.Town]:{x:300,y:650,key:oa.Down,warpTo:Zs.Underground,visual:0},[Zs.Underground]:{x:301,y:875,key:oa.Up,warpTo:Zs.Town,visual:0},[Zs.TownEast]:{x:1720,y:650,key:oa.Right,warpTo:Zs.Forest,visual:2},[Zs.Forest]:{x:2650,y:815,key:oa.Left,warpTo:Zs.TownEast,visual:1},[Zs.TownNorth]:{x:775,y:650,key:oa.Up,warpTo:Zs.ClockSquare,visual:2},[Zs.ClockSquare]:{x:610,y:-330,key:oa.Left,warpTo:Zs.TownNorth,visual:1},[Zs.ClockSquareNorth]:{x:915,y:-330,key:oa.Up,warpTo:Zs.ClockEntrance,visual:2},[Zs.ClockEntrance]:{x:690,y:-1320,range:15,key:oa.Left,warpTo:Zs.ClockSquareNorth,visual:1},[Zs.ClockStairs]:{x:910,y:-1400,range:20,key:oa.Right,warpTo:Zs.ClockTop,visual:3},[Zs.ClockTop]:{x:780,y:-1970,range:10,key:oa.Left,warpTo:Zs.ClockStairs,visual:3},[Zs.ForestEast]:{x:3590,y:815,key:oa.Right,warpTo:Zs.Lake,visual:2},[Zs.Lake]:{x:4625,y:915,key:oa.Left,warpTo:Zs.ForestEast,visual:1},[Zs.LakeEast]:{x:6121,y:760,key:oa.Right,warpTo:Zs.Lake,visual:1}},ca=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[ra.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[ra.Stranger]:["The sphinxs riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[ra.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[ra.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[ra.Inventor]:["The sphinxs riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[ra.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, dont they?","They move, disappear, and seem to fly without wings."]}}];function ha(t){return t instanceof ul?Aa(t)%ca.length:0}function pa(t,e){const r=ha(t);return ca[r].hints[e]}const ua={[ra.Inventor]:[{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:ta.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(ea.ForestGear,!0),Pa(t.scene,Zs.TownNorth,!0)}},{messages:t=>pa(t.scene,ra.Inventor),conditions:{activeQuest:ea.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. Youll need three gears to do it."],conditions:{hasItem:ta.Wrench}},{messages:["The clock tower is the heart of our town, but its been broken for ages. Ive got a wrench, but youll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(na.FixTheClock),t.inventory.addItem(ta.Wrench)}}],[ra.Stranger]:[{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:ta.Gear1}},{messages:t=>pa(t.scene,ra.Stranger),conditions:{activeQuest:ea.SphinxRiddle}},{messages:["Ive heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forests creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:ta.Wrench},onCompleted:t=>{t.quests.addQuest({id:ea.ForestGear,completed:!1}),Pa(t.scene,Zs.TownEast,!0)}},{messages:["Who am I?","Eventually, you will learn."]}],[ra.Sphinx]:[{messages:t=>function(t){const e=ha(t);return[ca[e].question]}(t.scene),options:t=>function(t){const e=ha(t),r=[...ca[e].options].sort((()=>Math.random()-.5));return r.push("I dont know"),r}(t.scene),conditions:{activeQuest:ea.SphinxRiddle},onSelected:(t,e,r)=>{t===function(t){const e=ha(t);return ca[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(ea.SphinxRiddle,!0),t.journal.addEntry(na.SphinxRiddleSolved)}},r):"I dont know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},r):e.message.setDialog({messages:["That is not correct. Do not return."]},r)}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:ea.SphinxRiddle,completed:!1})}}],[ra.Mayor]:[{messages:["The minute hand on the clock is spinning again.","It looks like its missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:na.ClockFirstGear}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:na.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(na.MetTheMayor),Pa(t.scene,Zs.ClockSquareNorth,!0)}}],[ra.ClockTower]:[{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:na.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Lets see what happens when we add the first gear.","[CREAKING NOISE]","The clock tower is starting to partially move again. It looks like its missing two more gears."],conditions:{hasItem:ta.Gear1},onCompleted:t=>{t.inventory.removeItem(ta.Gear1),t.journal.addEntry(na.ClockFirstGear)}}]},ya={[ta.Gear1]:{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}},da={[ta.Wrench]:{x:150,y:650,image:"wrench",name:"Wrench"},[ta.Gear1]:{x:5120,y:915,image:"gear",name:"Gear"}};class fa extends Phaser.Physics.Arcade.Sprite{constructor(t,r,i){const{x:n,y:o,image:s}=da[r];super(t,n,o,s),e(this,"itemType"),e(this,"player"),e(this,"particles"),e(this,"light"),t.add.existing(this),t.physics.add.existing(this),u.debug&&this.setInteractive({draggable:!0}),this.setScale(.35).setDepth(d.Items).setPipeline("Light2D"),this.itemType=r,this.player=i,this.particles=t.add.particles(n,o,"warp",{scale:{start:0,end:.9},alpha:{start:.8,end:0},delay:500,lifespan:1500,maxAliveParticles:1}),u.debug?this.light=new f(t,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=t.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2)}onInteract(t){return t[oa.Continue]?(this.player.inventory.addItem(this.itemType),this.handleSideEffects(),this.destroy(),Js.Item):Js.None}destroy(t){var e,r;this.particles.destroy(),this.light instanceof f?this.light.destroy():null==(r=null==(e=this.scene)?void 0:e.lights)||r.removeLight(this.light),super.destroy(t)}getButtonPrompt(){return[`Pick Up ${ta[this.itemType]}`,"Press [CONTINUE]"]}handleSideEffects(){const t=ya[this.itemType];t&&this.player.message.setDialog(t,void 0,"player_portrait")}}const ga={[ra.Inventor]:{x:550,y:635,scale:.75,img:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[ra.Stranger]:{x:750,y:865,scale:1.35,img:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[ra.Sphinx]:{x:3520,y:790,scale:1,img:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:t=>xa(t.scene,!1),light:1.85},[ra.Mayor]:{x:1065,y:-340,scale:.9,img:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[ra.ClockTower]:{x:880,y:-2090,scale:.5,img:"warp",portrait:"clock_portrait",name:"Clock Tower",particles:{texture:"warp",scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]},onCreate:t=>{t.setOffset(150,-40)}}},ma=2*Math.PI;class ba extends r.GameObjects.Graphics{constructor(t){super(t),e(this,"angle1",0),e(this,"angle2",1),e(this,"angle3",4),e(this,"update1",!1),e(this,"update2",!1),e(this,"update3",!1),t.add.existing(this),this.setPosition(842,-2107),this.setDepth(d.Npcs)}update(t){this.update1&&(this.angle1=ma*(t/6e4)*20),this.update2&&(this.angle2=ma*(t/36e5)*20),this.update3&&(this.angle3=ma*(t/432e5)*20),this.clear(),this.lineStyle(6,m(g.Night)),this.lineBetween(0,0,50*Math.cos(this.angle1),50*Math.sin(this.angle1)),this.lineBetween(0,0,40*Math.cos(this.angle2),40*Math.sin(this.angle2)),this.lineBetween(0,0,25*Math.cos(this.angle3),25*Math.sin(this.angle3)),this.lineStyle(4,m(g.Black));for(let e=0;e<12;e++){const t=ma*(e/12),r=50*Math.cos(t),i=50*Math.sin(t);this.lineBetween(r,i,1.5*r,1.5*i)}}}class va extends Phaser.Physics.Arcade.Sprite{constructor(t,i,n){const{x:o,y:s,img:a,scale:l,onCreate:c,light:h,particles:p}=ga[i];super(t,o,s,a),e(this,"npcType"),e(this,"player"),e(this,"light"),e(this,"particles"),e(this,"lastPos",new r.Math.Vector2),e(this,"clock"),this.setScale(l).setDepth(d.Npcs).setPipeline("Light2D"),"warp"===a&&this.setAlpha(0),t.add.existing(this),t.physics.add.existing(this),u.debug&&this.setInteractive({draggable:!0}),u.debug?this.light=new f(t,this.x,this.y,this.displayHeight/150*150,16764074,h||1):this.light=t.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,h||1),this.npcType=i,this.player=n,p&&(this.particles=t.add.particles(o,s,"",p)),i===ra.ClockTower&&(this.clock=new ba(t)),c&&c(this)}update(t,e){this.x===this.lastPos.x&&this.y===this.lastPos.y||this.light.setPosition(this.x,this.y),this.lastPos.set(this.x,this.y),this.clock&&this.clock.update(t)}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Js.None;if(t[oa.Continue]){const t=function(t,e){const r=ua[t]||[];for(const o of r){const{conditions:t}=o,r=[];if(void 0!==(null==t?void 0:t.hasItem)&&r.push((i=e.inventory.inventory,n=t.hasItem,i.includes(n))),void 0!==(null==t?void 0:t.completedQuest)&&r.push(ka(e.quests.quests,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&r.push(Sa(e.quests.quests,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&r.push(ja(e.journal.journal,t.journalEntry)),null==t?void 0:t.invert)if(null==t?void 0:t.or){if(r.every((t=>!t)))return o}else if(r.every((t=>!t)))return o;if(null==t?void 0:t.or){if(r.some((t=>t)))return o}else if(r.every((t=>t)))return o}var i,n}(this.npcType,this.player);if(!t)return Js.None;const e=ga[this.npcType].portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),Js.Talked}return Js.None}getButtonPrompt(){return this.npcType===ra.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${ga[this.npcType].name}`,"Press [CONTINUE]"]}}const wa=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3630,y:760,id:ia.Sphinx},{x:4575,y:850},{x:6160,y:690}];function xa(t,e,i){var n,o;const s=Ta(t,ra.Sphinx);Pa(t,Zs.ForestEast,!0===e);const a=function(t,e){return Oa(t,r.GameObjects.Rectangle).find((t=>t.getData("WallType")===e))}(t,ia.Sphinx);if(a&&(e?a.setX((null==(n=wa.find((t=>t.id===ia.Sphinx)))?void 0:n.x)||0):a.setX(a.x-150),null==(o=a.body)||o.updateFromGameObject()),!s)return;const{x:l,y:c}=ga[ra.Sphinx],h=e?l+200:l,p=e?c-90:c;t.tweens.add({targets:s,alpha:0,duration:!e||i?0:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{s.setPosition(h,p)},onComplete:()=>{s.alpha=1}}),t.tweens.add({targets:s.light,x:h,y:p,duration:!e||i?0:450,ease:"Power1"})}function Sa(t,e){return t.some((t=>t.id===e&&!t.completed))}function ka(t,e){return t.some((t=>t.id===e&&t.completed))}function ja(t,e){return t.includes(e)}function Oa(t,e){return t.children.getAll().filter((t=>t instanceof e))}function Pa(t,e,r){const i=function(t,e){return Oa(t,Ia).find((t=>t.warpType===e))}(t,e);i&&i.setVisible(r)}function Ta(t,e){return Oa(t,va).find((t=>t.npcType===e))}function Aa(t){return t.scene.get("Game").clock.rewindCount||0}class Ia extends r.Physics.Arcade.Sprite{constructor(t,i,n){const{x:o,y:s,visual:a,range:l}=la[i];if(super(t,o,s,a===aa.Ladder?"ladder":"warp"),e(this,"warpType"),e(this,"player"),e(this,"particles1"),e(this,"particles2"),e(this,"range"),this.warpType=i,this.player=n,this.setScale(.6).setPipeline("Light2D"),this.range=l||30,t.add.existing(this),t.physics.add.existing(this),a!==aa.Warp&&a!==aa.WarpHidden||(this.setScale(.6,1),this.setPosition(o,s-12),this.particles1=t.add.particles(o,s-12,"warp",{x:{min:-3,max:3},y:{min:-3,max:3},speed:{random:[-40,40]},scale:{min:.35,max:.5},alpha:{start:.2,end:0},angle:{min:0,max:360},color:[m(g.Teal),m(g.White),m(g.Tan)],colorEase:"Linear",radial:!0,blendMode:r.BlendModes.OVERLAY}).setScale(1,2).setPipeline("Light2D"),this.particles1.viewBounds=this.particles1.getBounds(30,500),this.particles2=t.add.particles(o,s-12,"warp",{x:{min:-30,max:30},y:{min:-50,max:50},speed:{random:[-5,5]},scale:{min:.05,max:.15},alpha:{values:[0,.2,0]},angle:{min:0,max:360},lifespan:{min:1e3,max:1400},color:[m(g.Peach),m(g.White),m(g.Tan)],colorEase:"Linear",radial:!0,maxAliveParticles:20}).setPipeline("Light2D"),this.particles2.viewBounds=this.particles2.getBounds(30,500)),i===Zs.Underground&&(t.add.sprite(o,s-60,"ladder").setScale(.6).setPipeline("Light2D"),t.add.sprite(o,s-105,"ladder").setScale(.6).setPipeline("Light2D")),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),a===aa.Invisible&&this.setAlpha(0),this.setVisible(a!==aa.WarpHidden),u.debug){this.setInteractive({draggable:!0});const e=t.add.graphics();if(this.hasExtendedBounds()){e.lineStyle(2,16711935);const t=this.body;e.lineBetween(o-this.range,s-t.halfHeight,o-this.range,s+t.halfHeight),e.lineBetween(o+this.range,s-t.halfHeight,o+this.range,s+t.halfHeight),e.strokeCircle(o,s,5)}}}hasExtendedBounds(){const{visual:t,key:e}=la[this.warpType];return!(t!==aa.Warp&&t!==aa.WarpHidden&&t!==aa.Invisible||e!==oa.Left&&e!==oa.Right)}onInteract(t){const e=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,r=t[la[this.warpType].key]&&e;return!r||this.warpType!==Zs.TownEast||ja(this.player.journal.journal,na.ForestMazeSolved)||u.debug?r?(Ea(la[this.warpType].warpTo,this.player),Js.Teleported):Js.None:(this.scene.scene.pause(),this.scene.scene.launch("MazeDialog",{player:this.player}),Js.None)}getButtonPrompt(){const t=la[this.warpType].key;let e;return t===oa.Continue&&(e="[CONTINUE]"),t===oa.Up&&(e="[Up]"),t===oa.Down&&(e="[Down]"),t===oa.Left&&(e="[Left]"),t===oa.Right&&(e="[Right]"),[`Travel to ${Zs[la[this.warpType].warpTo]}`,"Press "+e]}setPosition(t,e,r,i){return super.setPosition(t,e,r,i),this.particles1&&this.particles2&&(this.particles1.setPosition(t,(e||0)-12),this.particles2.setPosition(t,(e||0)-12)),this}setVisible(t){return super.setVisible(t),this.particles1&&this.particles2&&(t?(this.particles1.start(),this.particles2.start()):(this.particles1.stop(),this.particles1.killAll(),this.particles2.stop(),this.particles2.killAll())),this}destroy(t){this.particles1&&this.particles2&&(this.particles1.destroy(),this.particles2.destroy()),super.destroy(t)}}function Ea(t,e){const{x:i,y:n,onWarp:o}=la[t],s=e.scene,a=i-s.cameras.main.width/2,l=n-s.cameras.main.height/2;o&&o(e),s.cameras.main.fadeOut(200,0,0,0,((t,e)=>{e>=1&&s.cameras.main.fadeIn(1e3,0,0,0)})),s.cameras.main.stopFollow(),s.tweens.add({targets:s.cameras.main,scrollX:a,scrollY:l-u.cameraOffset,duration:600,delay:100,ease:"Power1",onComplete:()=>{s.cameras.main.startFollow(e),s.cameras.main.setFollowOffset(0,u.cameraOffset)}}),e.setActive(!1),s.tweens.add({targets:e,alpha:0,duration:500,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e.setPosition(i,n)},onComplete:()=>{e.alpha=1,e.setActive(!0)}});const c=e.light instanceof r.GameObjects.Light?e.light:e.light.light;s.tweens.add({targets:c,x:i,y:n,duration:400,ease:"Power1"})}class Ca extends r.GameObjects.Container{constructor(t,r,i){super(t,40,u.height-60),e(this,"currentTime",0),e(this,"rewindCount",0),e(this,"player"),e(this,"rewindable"),e(this,"rewinding",!1),e(this,"counter",0),e(this,"bar"),e(this,"hand"),e(this,"timeText"),e(this,"dayOver"),this.setVisible(u.rewindEnabled).setDepth(d.Ui).setScrollFactor(0),this.scene.add.existing(this),this.rewindable=r,this.player=i,this.add(t.add.sprite(0,0,"watch").setScale(.25)),this.hand=t.add.rectangle(0,10,3,14,m(g.Black)).setOrigin(0,0),this.add(this.hand),this.timeText=t.add.text(15,10,"",v).setScrollFactor(0),this.bar=t.add.rectangle(0,u.height-6,0,6,13412864).setScrollFactor(0)}update(t,e){}}class Ma extends r.GameObjects.Text{constructor(t){super(t,u.width/2,u.height-50,"",v),this.setOrigin(.5).setBackgroundColor("#"+g.Black).setPadding(10,5).setAlign("center").setAlpha(.9).setScrollFactor(0).setDepth(d.Overlay).setVisible(!1),t.add.existing(this)}}class Fa extends r.GameObjects.Text{constructor(t,r,i,n,o,s){super(t,r,i,n,{...v,fontSize:48,backgroundColor:`#${g.Teal}`,padding:{x:15,y:10},...s}),e(this,"onClick"),this.setOrigin(.5),t.add.existing(this),this.onClick=o,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>o())),this.on("pointerover",(()=>this.setTint(12303291))),this.on("pointerout",(()=>this.setTint(16777215)))}}class Ba extends r.GameObjects.Container{constructor(t){var r,i,n;super(t),e(this,"buttons",[]),e(this,"activeIndex",-1),t.add.existing(this).setScrollFactor(0),null==(r=t.input.keyboard)||r.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(i=t.input.keyboard)||i.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(n=t.input.keyboard)||n.on("keydown-ENTER",(()=>{var t;null==(t=this.buttons[this.activeIndex])||t.onClick()}))}addButton(t){this.add(t),this.buttons.push(t),1===this.buttons.length&&this.setActiveButton(0),t.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(t){var e,r;null==(e=this.buttons[this.activeIndex])||e.setTint(16777215),this.activeIndex=t,null==(r=this.buttons[this.activeIndex])||r.setTint(m(g.Tan))}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const Da=20;class Ra extends r.GameObjects.Container{constructor(t,i){var n,o;super(t),e(this,"textWidth"),e(this,"textHeight"),e(this,"player"),e(this,"npc"),e(this,"npcName"),e(this,"text"),e(this,"box"),e(this,"image"),e(this,"options"),e(this,"optionsContainer"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),t.add.existing(this);const{width:s,height:a}=u;this.textWidth=s-130-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(Da,a-Da-170),this.setDepth(d.Overlay),this.setVisible(!1),this.player=i,this.npcName=new r.GameObjects.Text(t,170,15,"",{...v,color:"#"+g.Tan}),this.text=new r.GameObjects.Text(t,170,60,"",v),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(3),this.image=new r.GameObjects.Image(t,Da,Da,"").setOrigin(0).setScale(1.5),this.box=new r.GameObjects.Rectangle(t,0,0,s-40,170,m(g.Black),.8),this.box.setStrokeStyle(2,m(g.Tan),1),this.box.setOrigin(0,0),this.optionsContainer=new Ba(t).setDepth(d.Overlay),this.add([this.box,this.npcName,this.text,this.image]),null==(n=this.scene.input.keyboard)||n.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(o=this.scene.input.keyboard)||o.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}setDialog(t,e,r){this.setVisible(void 0!==t),this.npc=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,this.scene.gamepad.offsetButtons(void 0!==this.dialog),t&&(this.npcName.setVisible(!1),e||r?(e&&(this.npcName.setVisible(!0),this.npcName.setText(ga[e.npcType].name)),this.image.setVisible(!0),e?this.image.setTexture(ga[e.npcType].portrait):r&&this.image.setTexture(r),this.text.setPosition(170,Da+(e?40:0)).setWordWrapWidth(this.textWidth,!0).setFixedSize(this.textWidth,this.textHeight)):(this.image.setVisible(!1),this.text.setPosition(Da,Da).setWordWrapWidth(170+this.textWidth,!0).setFixedSize(170+this.textWidth,this.textHeight)),this.showMessage())}showMessage(){const t=this.getMessages(),e=t&&t[this.messageIndex];e&&(this.text.setText(e),this.text.getWrappedText().length>3&&console.error("Message too long!",e)),this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;const t=!u.zoomed;this.options.forEach(((e,r)=>{const i=new Fa(this.scene,u.width/2,u.height/(t?9:14)+r*(30+u.height/(t?16:22)),e,(()=>this.onSelectOption(e)),{fontSize:24,backgroundColor:"#"+g.Black,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(d.Overlay);this.optionsContainer.addButton(i)}))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.npc),this.optionsContainer.removeAll(!0))}updateDialog(){if(Date.now()<this.interactionTimeout)return;const t=this.getMessages();this.dialog&&t&&(this.messageIndex++,this.messageIndex>=t.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.npc),this.dialog=void 0,this.setVisible(!1)):this.showMessage(),this.scene.gamepad.offsetButtons(void 0!==this.dialog),this.interactionTimeout=Date.now()+350)}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}}class Wa extends r.GameObjects.Text{constructor(t,e,r=3500){const i=Oa(t,Wa).reduce(((t,e)=>Math.max(t,e.y-20)),0)+65;super(t,20,i,e,{...v,backgroundColor:"#"+g.Teal,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(d.Ui2).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:i+10,duration:350,hold:r,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}class za extends r.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),this.setScrollFactor(0).setDepth(d.Ui).setVisible(!1),t.add.existing(this),this.rect=t.add.rectangle(0,0,0,0,m(g.Teal)).setStrokeStyle(2,m(g.White)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=t.add.text(10,4,"Inventory",{...v,fontSize:32}),this.add(this.text)}addItem(t,e){this.inventory.push(t),this.add(this.scene.add.sprite(0,0,da[t].image).setScale(.35)),this.updateItems();const r=function(t,e){return Oa(t,fa).find((t=>t.itemType===e))}(this.scene,t);r&&r.destroy(),e||new Wa(this.scene,`New item added: ${da[t].name}`)}removeItem(t){var e;const r=this.inventory.indexOf(t);r>-1&&(this.inventory.splice(r,1),null==(e=this.getAll().find((e=>{var r;return(null==(r=e.texture)?void 0:r.key)===da[t].image})))||e.destroy()),this.updateItems()}updateItems(){let t=0;this.getAll().forEach((e=>{if(e instanceof r.GameObjects.Sprite){const r=32+50*t;e.setPosition(r,68),t++}})),this.setVisible(this.inventory.length>0);const e=Math.max(this.text.displayWidth+18,50*t+12);this.setPosition(u.width-e-20,20),this.rect.setSize(e,102)}}class La extends r.GameObjects.Sprite{constructor(t,r){super(t,u.width-50,u.height-55,"journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),this.setScrollFactor(0).setDepth(d.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),t.add.existing(this),this.player=r,this.unread=t.add.ellipse(u.width-21,u.height-89,20,20,11141120).setStrokeStyle(2,m(g.Black)).setScrollFactor(0).setDepth(d.Ui2).setVisible(!1)}addEntry(t,e){this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new Wa(this.scene,"New journal entry added!")),this.handleSideEffects(t,e||!1))}openJournal(){0!==this.journal.length&&(this.unread.setVisible(!1),this.scene.scene.pause(),this.scene.scene.launch("JournalDialog",{player:this.player}))}handleSideEffects(t,e){if(t===na.SphinxRiddleSolved&&xa(this.scene,!0,e),t===na.ClockFirstGear){const t=Ta(this.scene,ra.ClockTower);(null==t?void 0:t.clock)&&(t.clock.update1=!0)}}}const Ga={[ea.ForestGear]:"Find the gear in the forest",[ea.SphinxRiddle]:"Solve the Sphinx riddle"};class Na extends r.GameObjects.Container{constructor(t){super(t,u.width-330-20,120),e(this,"quests",[]),e(this,"questRectangle"),t.add.existing(this),this.setScrollFactor(0).setDepth(d.Ui).setVisible(!1),this.questRectangle=t.add.rectangle(0,0,330,60,m(g.Teal)).setStrokeStyle(2,m(g.White)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle),this.add(t.add.text(10,4,"Quests",{...v,fontSize:32}))}addQuest(t,e){this.quests.find((e=>e.id===t.id))||(this.quests.push(t),this.add(this.scene.add.text(0,0,Ga[t.id],{...v,fontSize:20})),this.updateQuests(),e||new Wa(this.scene,`New quest added: ${Ga[t.id]}`))}updateExistingQuest(t,e){const r=this.quests.find((e=>e.id===t));r&&(!r.completed&&e&&new Wa(this.scene,`Quest completed: ${Ga[r.id]}`),r.completed=e),this.updateQuests()}updateQuests(){const t=this.quests.filter((t=>!t.completed));let e=1,i=0;this.getAll().forEach((n=>{if(n instanceof r.GameObjects.Text)if(t.find((t=>n.text===Ga[t.id]))||"Quests"===n.text){if("Quests"!==n.text){const t=14+30*e;n.setPosition(10,t),e++,i=Math.max(i,n.width)}}else n.destroy()}));const n=i+20;this.setX(u.width-20-n),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(n,50+30*t.length)}reset(){this.quests=[],this.updateQuests()}}const Ua=1.35*(u.fastMode?350:120),_a=new r.Math.Vector2(400,650);class $a extends Phaser.Physics.Arcade.Sprite{constructor(t){var r;super(t,_a.x,_a.y,"character",0),e(this,"scene"),e(this,"keys"),e(this,"light"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),this.scene=t,t.add.existing(this),t.physics.add.existing(this),u.debug&&this.setInteractive(),this.setBodySize(48,70).setOffset(40,10).setOrigin(.5,.65).setDepth(d.Player).setScale(1.35).setPipeline("Light2D"),u.debug?this.light=new f(t,this.x,this.y,200,16768443,1.2):this.light=t.lights.addLight(this.x,this.y,200,16768443,1.2),(r=this).anims.create({key:"walk",frames:r.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:4,repeat:-1}),r.anims.play("walk"),this.keys=new sa(t),this.buttonPrompt=new Ma(t),this.message=new Ra(t,this),this.inventory=new za(t),this.quests=new Na(t),this.journal=new La(t,this)}update(t,e){u.debug&&this.setTint(this.interactive?16755370:16777215),this.buttonPrompt.setVisible(this.interactive&&!this.message.visible&&this.buttonPrompt.text.length>0||!1),this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity(),this.light.setPosition(this.x,this.y),function(t){var e;const r=(null==(e=t.body)?void 0:e.velocity.x)||0,i=r<0;Math.abs(r)>0?(t.anims.resume(),t.flipX=t.rewinding?!i:i):t.anims.pause(),t.setAngle(t.flipX?-5:5)}(this)}checkInteraction(){let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys.keys),t!==Js.None&&(this.interactionTimeout=Date.now()+(this.interactive.interactionTimeout||500),this.keys.resetKeys(),t===Js.Teleported&&(this.interactive=void 0))),t}updateVelocity(){let t=Ua;const e=this.keys.keys;e[oa.Left]&&this.setVelocityX(-t),e[oa.Right]&&this.setVelocityX(t),u.debug&&!this.interactive&&(e[oa.Up]&&this.setVelocityY(-t),e[oa.Down]&&this.setVelocityY(t)),e[oa.Left]&&e[oa.Right]&&this.setVelocityX(0)}record(){var t;this.history.length<1e3?this.history.push(new Phaser.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(_a.x,_a.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e;this.interactive=t,this.buttonPrompt.setText((null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t))||"")}}function Va(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t)))}const qa=function(t){const e=r.Display.Color.ColorToRGBA(t);return new r.Display.Color(e.r,e.g,e.b,e.a)}(m(g.Background));function Ha(t,e,r){t.cameras.main.fadeIn(e,qa.red,qa.green,qa.blue,((t,e)=>{}))}const Xa="chrono-sleuth-save",Ka={player:{x:_a.x,y:_a.y,flip:!1},journal:[],inventory:[],quests:[],warpers:[],settings:{gamepad:Va(),debug:!1,zoomed:Va()}},Ya={player:{x:_a.x-200,y:_a.y,flip:!1},journal:[na.FixTheClock,na.SphinxRiddleSolved,na.MetTheMayor],inventory:[ta.Wrench,ta.Gear1],quests:[{id:ea.SphinxRiddle,completed:!0}],warpers:[{warpType:Zs.TownEast,state:!0},{warpType:Zs.TownNorth,state:!0},{warpType:Zs.ClockSquareNorth,state:!0}],settings:{gamepad:!1,debug:!1,zoomed:!0}};function Qa(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal,inventory:t.player.inventory.inventory,quests:t.player.quests.quests,warpers:tl(t),settings:{gamepad:t.gamepad.visible,debug:u.debug,zoomed:u.zoomed}}}function Ja(t){const{save:e,error:r}=function(){const t=localStorage.getItem(Xa);let e,r;try{t&&(e=JSON.parse(t))}catch(i){console.error(i),r=i}return{save:e||Ka,error:r}}();r&&new Wa(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4);try{const r={...u};if(u.debug=e.settings.debug,u.zoomed=e.settings.zoomed,u.zoomed!==r.zoomed)return void function(t,e){console.log("setZoomed",e);const r=e?a:s;u.zoomed=e,u.width=r.width,u.height=r.height,u.cameraOffset=r.height/3,t.scale.setGameSize(r.width,r.height),t.scene.restart()}(t,u.zoomed);u.debug!==r.debug&&t.scene.restart(),t.player.setX(e.player.x),t.player.setY(e.player.y),t.player.setFlipX(e.player.flip),e.journal.forEach((e=>t.player.journal.addEntry(e,!0))),e.inventory.forEach((e=>t.player.inventory.addItem(e,!0))),e.quests.forEach((e=>t.player.quests.addQuest(e,!0))),function(t,e){const r=Oa(t,Ia);e.forEach((t=>{const e=r.find((e=>e.warpType===t.warpType));e&&e.setVisible(t.state)}))}(t,e.warpers),t.gamepad.setVisible(e.settings.gamepad);const i=Qs(e,Ka)?"[New]":Qs(e,Ya)?"[Debug]":"[Storage]";new Wa(t,`Game Loaded ${i}`),Qs(e,Ka)&&Za(t)}catch(i){console.error(i),new Wa(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4),Za(t,Ka),Ja(t)}}function Za(t,e){const r=Qa(t);localStorage.setItem(Xa,JSON.stringify(e||r)),new Wa(t,"Game Saved")}function tl(t){return Oa(t,Ia).map((t=>({warpType:t.warpType,state:t.visible})))}function el(){return Math.random()-.5}r.GameObjects.Container;const rl=[3200,600],il=[5350,690],nl=[500,200,100,50,10];class ol extends r.GameObjects.GameObject{constructor(t,i,n,o=40,s=[1400,600]){super(t,"fireflies"),e(this,"scene"),e(this,"center"),e(this,"lights",[]),e(this,"count"),e(this,"centers",[]),e(this,"bounds",[1e3,400]),e(this,"biases",[]),e(this,"debug"),t.add.existing(this),this.scene=t,this.count=o,this.bounds=s,this.center=new r.Math.Vector2(i,n);for(let e=0;e<this.count;e++){const e=new r.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),i=t.lights.addPointLight(0,0,e.color,7*Math.random()+3,.15,.045+.02*el());this.lights.push(i);const n=[];for(let t=0;t<2*nl.length;t++)n.push(el()*nl[t%nl.length]);n.push(10*el()),this.biases.push(n)}u.debug&&(this.debug=t.add.graphics().fillStyle(16711680,.5).lineStyle(2,16711680,1),this.debug.fillCircle(s[0]/2,s[1]/2,10),this.debug.strokeRect(0,0,s[0],s[1])),this.setPosition(i,n)}setPosition(t,e){this.centers=[];for(let i=0;i<this.count;i++)this.centers.push(new r.Math.Vector2(t+Math.random()*this.bounds[0]-this.bounds[0]/2,e+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(t-this.bounds[0]/2,e-this.bounds[1]/2)}update(t,e){if(!(Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0]))return;const r=t/1e3*.025,i=Math.cos(r),n=Math.sin(r);this.lights.forEach(((t,e)=>{const o=this.biases[e],s=Math.cos(70*r+o[10]);t.intensity=Math.min(.05+Math.abs(o[4]*s+o[3]*i+o[4]*i)/50,.4),t.x=i*o[0]+n*o[1]+i*o[2]+n*o[3]+i*o[4]+this.centers[e].x,t.y=n*o[5]+i*o[6]+n*o[7]+i*o[8]+n*o[9]+this.centers[e].y}))}}class sl extends r.Physics.Arcade.Image{constructor(t,i,n,o=100,s=100,a=!1){if(super(t,i,n,""),e(this,"width"),e(this,"height"),e(this,"flipped"),e(this,"graphics"),t.add.existing(this),t.physics.add.existing(this),this.scene=t,this.width=o,this.height=s,this.flipped=a,this.setOrigin(0),this.setVisible(!1),this.setSize(o,1.5*s),u.debug){const e=t.add.graphics();this.graphics=e,e.lineStyle(2,65280,1);const l=o/2,c=new r.Math.Vector2(i,a?n:n+s),h=new r.Math.Vector2(i+o,a?n+s:n);e.lineBetween(c.x,c.y,h.x,h.y),e.lineBetween(c.x-l,c.y,c.x,c.y),e.lineBetween(h.x,h.y,h.x+l,h.y),e.strokeCircle(c.x,c.y,2),e.strokeCircle(h.x,h.y,2)}}update(t,e){const i=this.scene.player;if(this.body&&this.scene.physics.world.intersects(this.body,i.body)){let t=r.Math.Clamp(1-(this.x+this.width-i.x)/this.width,0,1);this.flipped&&(t=1-t);const e=this.y+this.height,n=(1-i.originY)*i.displayHeight,o=e-this.height*t-n;i.setY(o)}}}class al extends r.Physics.Arcade.StaticGroup{constructor(t){super(t.physics.world,t),wa.forEach((e=>{const r=t.add.rectangle(e.x,e.y,6,100).setOrigin(0).setVisible(u.debug);r.setData("WallType",e.id),u.debug&&r.setInteractive({draggable:!0}),this.add(r)}))}}class ll extends r.GameObjects.Container{constructor(t,r){super(t,100,u.height-100),e(this,"buttons",[]),e(this,"lastAxisKey"),this.setScrollFactor(0).setDepth(d.Overlay),t.add.existing(this),this.createDPad(),r||this.createButtons(),this.createControllerListeners()}update(t,e){var r,i,n,o,s,a;const l=null==(r=this.scene.input.gamepad)?void 0:r.pad1;if(!l)return;const c=l.axes[0].getValue();if(Math.abs(c)<=.1&&this.lastAxisKey)return null==(i=this.scene.input.keyboard)||i.emit("keyup-"+this.lastAxisKey),void(this.lastAxisKey=void 0);if(c>.1){if("RIGHT"===this.lastAxisKey)return;"LEFT"===this.lastAxisKey&&(null==(n=this.scene.input.keyboard)||n.emit("keyup-LEFT")),null==(o=this.scene.input.keyboard)||o.emit("keydown-RIGHT"),this.lastAxisKey="RIGHT"}if(c<-.1){if("LEFT"===this.lastAxisKey)return;"RIGHT"===this.lastAxisKey&&(null==(s=this.scene.input.keyboard)||s.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastAxisKey="LEFT"}}createDPad(){const t=this.scene.add.container(10,-10);this.add(t);const e=this.scene.add.circle(0,0,60,m(g.Teal),.45).setStrokeStyle(3,m(g.Black));t.add(e),this.button(-57,0,"LEFT",t),this.button(57,0,"RIGHT",t),this.button(0,-57,"UP",t),this.button(0,57,"DOWN",t)}createButtons(){const t=this.scene.add.container(u.width-300,0);this.add(t);const e=this.scene.add.circle(40,0,65,m(g.Teal),.45).setStrokeStyle(3,m(g.Black)).setScale(1,.6).setAngle(-30);t.add(e),this.button(80,-20,"ENTER",t),this.button(0,20,"BACKSPACE",t)}createControllerListeners(){var t,e,r,i;null==(t=this.scene.input.gamepad)||t.on("connected",(t=>{new Wa(this.scene,"Gamepad connected")})),null==(e=this.scene.input.gamepad)||e.on("disconnected",(t=>{new Wa(this.scene,"Gamepad disconnected")})),null==(r=this.scene.input.gamepad)||r.on("down",((t,e)=>{var r;const i=this.getKeyFromButton(e);i&&(null==(r=this.scene.input.keyboard)||r.emit(`keydown-${i}`)),console.log("down",e)})),null==(i=this.scene.input.gamepad)||i.on("up",((t,e)=>{var r;const i=this.getKeyFromButton(e);i&&(null==(r=this.scene.input.keyboard)||r.emit(`keyup-${i}`)),console.log("up",e)}))}getKeyFromButton(t){let e;switch(t.index){case 0:e=t.pad.id.toLowerCase().includes("nintendo")?"BACKSPACE":"ENTER";break;case 1:e=t.pad.id.toLowerCase().includes("nintendo")?"ENTER":"BACKSPACE";break;case 9:e="ESC";break;case 12:e="UP";break;case 13:e="DOWN";break;case 14:e="LEFT";break;case 15:e="RIGHT"}return e}button(t,e,r,i){const n="ENTER"===r||"ESCAPE"===r?35:38,o=this.scene.add.circle(t,e,n,m(g.White),.8).setStrokeStyle(3,m(g.Black));o.setInteractive({useHandCursor:!0}).setScrollFactor(0),i.add(o),o.on("pointerdown",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keydown-${r}`),o.setFillStyle(m(g.Teal),Math.min(1,1.05))})),o.on("pointerup",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${r}`),o.setFillStyle(m(g.White),.8)})),o.on("pointerout",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${r}`),o.setFillStyle(m(g.White),.8)})),this.buttons.push(o)}offsetButtons(t){t?this.setPosition(100,u.height-300):this.setPosition(100,u.height-100)}}class cl extends r.GameObjects.Container{constructor(t,r,i,n,o){super(t,r,i),e(this,"img"),e(this,"rect"),t.add.existing(this),this.setScrollFactor(0).setDepth(d.Ui),this.rect=t.add.rectangle(0,0,42,42,m(g.Teal)).setScrollFactor(0).setStrokeStyle(2,m(g.Black)),this.img=t.add.image(-1,1,n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>o(this))),this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}}const hl=[{x:135,y:462,radius:150,color:m(g.Tan),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:887,y:200,radius:150},{x:1561,y:460},{x:791,y:472,intensity:.5},{x:962,y:469,intensity:.5},{x:162,y:814,intensity:2},{x:635,y:772},{x:1638,y:788,intensity:2},{x:5300,y:530,intensity:2},{x:5315,y:730,intensity:.75,radius:75}],pl=[{x:740,y:-1370,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5150,y:953,width:100,height:60,flip:!0},{x:5820,y:795,width:220,height:220}];class ul extends r.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock"),e(this,"gamepad")}create(){this.createBackgrounds(),this.player=new $a(this);const t=new al(this),e=this.createWarpers(),r=this.createNpcs(),i=this.createItems(),n=this.createSlopes(),o=new ol(this,rl[0],rl[1]),s=new ol(this,il[0],il[1]);this.createLights();const{debugUI:a}=this.createUI(),l=[this.player];this.clock=new Ca(this,l,this.player),this.interactiveObjects=this.add.group([...e,...r,...i],{runChildUpdate:!0});const c=this.add.group([this.player,this.clock,this.gamepad,o,s,...n],{runChildUpdate:!0});a&&c.add(a),this.physics.add.collider(this.player,t),this.createEventListeners();const h=this.cameras.main;h.startFollow(this.player,!0),h.setFollowOffset(0,u.cameraOffset),Ja(this),Ha(this,1e3)}update(){this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>void 0===t.visible||t.visible),this.player)||this.player.setInteractiveObject(void 0)}createBackgrounds(){const t=[this.physics.add.sprite(0,0,"town").setOrigin(0),this.physics.add.sprite(500,-1100,"clock_outside").setOrigin(0),this.physics.add.sprite(500,-2400,"clock_inner").setOrigin(0),this.physics.add.sprite(2300,0,"forest").setOrigin(0),this.physics.add.sprite(4400,100,"lake").setOrigin(0)];return t.forEach((t=>{"clock_inner"!==t.texture.key&&t.setPipeline("Light2D"),u.debug&&t.setInteractive({draggable:!0})})),t}createWarpers(){const t=[];for(const e in Zs)isNaN(Number(e))&&t.push(new Ia(this,Zs[e],this.player));return t}createNpcs(){return Object.values(ra).filter((t=>"number"==typeof t)).map((t=>new va(this,t,this.player)))}createItems(){return[new fa(this,ta.Gear1,this.player)]}createSlopes(){return pl.map((t=>new sl(this,t.x,t.y,t.width,t.height,t.flip)))}createUI(){return new cl(this,31,30,"settings",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),new cl(this,81,30,S(this)?"moon":"sun",(t=>{const e=S(this);var r;S(r=this)?function(t,e=!0){x||(j(t,g.Night,e),t.lights.lights.forEach((r=>{const i=r.intensity;r.setVisible(!0),e&&(r.setIntensity(0),t.tweens.add({targets:r,duration:w,intensity:i}))})))}(r):k(r),t.img.setTexture(e?"sun":"moon")})),new cl(this,131,30,u.zoomed?"zoom-out":"zoom-in",(()=>{const t=Qa(this);Za(this,{...t,settings:{...t.settings,zoomed:!u.zoomed}}),this.scene.restart()})),this.gamepad=new ll(this),{debugUI:void 0}}createLights(){this.lights.enable().setAmbientColor(m(g.White)),hl.forEach((t=>{u.debug?new f(this,t.x,t.y,t.radius||100,t.color||m(g.Lights),t.intensity||1):this.lights.addLight(t.x,t.y,t.radius||100,t.color||m(g.Lights),t.intensity||1)})),k(this,!1)}createEventListeners(){var t,e;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),null==(e=this.input.keyboard)||e.on("keydown-J",(()=>{this.player.journal.openJournal()})),this.events.on("resume",(()=>{this.player.keys.resetKeys()}))}}class yl extends r.GameObjects.Container{constructor(t,i,n,o,s){var a,l;super(t,i,n),e(this,"textObject"),e(this,"maskGraphics"),e(this,"scrollbar"),e(this,"scrollY"),e(this,"boxHeight"),t.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new r.GameObjects.Text(t,0,0,o,{...v,padding:{x:10,y:10},...s}),this.textObject.setOrigin(0).setScrollFactor(0).setInteractive(),this.add(this.textObject),t.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),null==(a=t.input.keyboard)||a.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(l=t.input.keyboard)||l.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=t.add.graphics().setPosition(i,n).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=t.add.rectangle(0,0,4,0,5592405).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(t,e){this.boxHeight=e,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,t,e);const r=this.maskGraphics.createGeometryMask();this.textObject.setMask(r),this.textObject.setWordWrapWidth(t-8),this.textObject.setFixedSize(t-8,0),this.updateTextPosition()}handleDrag(t){t.isDown&&(this.scrollY-=t.velocity.y,this.updateTextPosition())}handleScroll(t,e,r,i,n){this.scrollY+=.5*i,this.updateTextPosition()}updateTextPosition(){const t=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=Phaser.Math.Clamp(this.scrollY,0,t),this.textObject.y=-this.scrollY;const e=this.scrollY/t,r=this.boxHeight/this.textObject.height;this.scrollbar.height=r*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+4,e*(this.boxHeight-r*this.boxHeight))}}const dl={[na.FixTheClock]:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it.",[na.ForestMazeSolved]:"I finally got through the forest maze. Next time should be much easier.",[na.SphinxRiddleSolved]:"I solved the sphinxs riddle. Now I can pass through the forest.",[na.MetTheMayor]:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",[na.ClockFirstGear]:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."};class fl extends r.Scene{constructor(){super("JournalDialog"),e(this,"player")}init(t){this.player=t.player}create(){var t,e,r;const i=this.add.container(u.width/2,u.height/2);i.add(this.add.rectangle(0,0,.8*u.width,.8*u.height,0,.75).setStrokeStyle(4,m(g.Tan))),i.add(new Fa(this,.35*u.width,-.33*u.height,"X",(()=>this.close()))),i.add(this.add.text(0,-.33*u.height,"Journal",{...v,fontSize:48}).setOrigin(.5));const n=this.player.journal.journal.map((t=>`- ${dl[t]}\n`)).reverse();new yl(this,.13*u.width,.25*u.height,n,{fontSize:32}).setBoxSize(.74*u.width,.62*u.height),new ll(this).setVisible(!1),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()})),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.close()})),null==(r=this.input.keyboard)||r.on("keydown-BACKSPACE",(()=>{this.close()}))}close(){this.scene.stop(),this.scene.resume("Game")}}function gl(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function ml(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?gl(Object(r),!0).forEach((function(e){bl(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gl(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function bl(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vl(t){return t.slice(0,-1)}function wl(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function xl(t){return[...new Set(t)]}function Sl(t,e){const r=xl(t.map((t=>t.set))).filter(Boolean),i=(n=wl(1,t.length+1),o=r,[n,o].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var n,o;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=i[e]))}function kl(t,e,r=.5){vl(t).forEach(((i,n)=>{const o=t[n+1],s=i.set!==o.set,a=e()<=r;var l,c,h;s&&a&&(l=t,c=o.set,h=i.set,l.forEach((t=>{t.set===c&&(t.set=h)})),i.right=!1,o.left=!1)}))}const jl=48;class Ol extends r.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"nextUpdate")}init(t){this.parent=t.parent}create(){this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,.8*jl,.8*jl,5601177).setSmoothness(32).setOrigin(-.13),this.cameras.main.startFollow(this.mazePlayer),this.keys=this.parent.keys}createMaze(){const t=Aa(this.parent.player.scene);this.maze=function(t=8,e=t,r=!0,i=1){const n=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(i),o=[],s=wl(t);for(let c=0;c<e;c+=1){const i=s.map((i=>({x:i,y:c,top:r||c>0,left:r||i>0,bottom:r||c<e-1,right:r||i<t-1})));o.push(i)}vl(o).forEach(((t,e)=>{Sl(t,n),kl(t,n),function(t,e,r){const i=Object.values(function(t,e){let r=xl(t.map((t=>t.set))).reduce(((t,e)=>ml(ml({},t),{},{[e]:[]})),{});return t.forEach((t=>r[t.set].push(t))),r}(t)),{ceil:n}=Math;i.forEach((t=>{(function(t,e,r){e=null==e?1:e;const i=null==t?0:t.length;if(!i||e<1)return[];e=e>i?i:e;let n=-1;const o=i-1,s=[...t];for(;++n<e;){const t=n+Math.floor(r()*(o-n+1)),e=s[t];s[t]=s[n],s[n]=e}return s.slice(0,e)})(t,n(r()*t.length),r).forEach((t=>{if(t){const r=e[t.x];t.bottom=!1,r.top=!1,r.set=t.set}}))}))}(t,o[e+1],n)}));const a=(l=o)[l.length-1];var l;return Sl(a,n),kl(a,n,1),o}(24,24,!0,t),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,jl,jl),this.graphics.lineStyle(3,3385907),this.maze.forEach((t=>{t.forEach((t=>{if(t.top){const e=new Phaser.Geom.Line(t.x*jl,t.y*jl,t.x*jl+jl,t.y*jl);this.graphics.strokeLineShape(e)}if(t.bottom){const e=new Phaser.Geom.Line(t.x*jl,t.y*jl+jl,t.x*jl+jl,t.y*jl+jl);this.graphics.strokeLineShape(e)}if(t.left){const e=new Phaser.Geom.Line(t.x*jl,t.y*jl,t.x*jl,t.y*jl+jl);this.graphics.strokeLineShape(e)}if(t.right){const e=new Phaser.Geom.Line(t.x*jl+jl,t.y*jl,t.x*jl+jl,t.y*jl+jl);this.graphics.strokeLineShape(e)}}))})),this.cameras.main.setViewport(50,130,u.width-100,u.height-170)}update(t,e){if(t<this.nextUpdate)return;const i=this.keys.keys;i[oa.Continue];const n=new r.Math.Vector2(0,0);i[oa.Left]?n.x=-48:i[oa.Right]?n.x=jl:i[oa.Up]?n.y=-48:i[oa.Down]&&(n.y=jl);const o=new r.Math.Vector2(this.mazePlayer.x+n.x,this.mazePlayer.y+n.y);if((this.mazePlayer.x!==o.x||this.mazePlayer.y!==o.y)&&this.canMove(o)){this.mazePlayer.setPosition(o.x,o.y);const t=new r.Math.Vector2(1104,1104);this.parent.setAngle(r.Math.Angle.BetweenPoints(o,t)),this.mazePlayer.x===t.x&&this.mazePlayer.y===t.y&&this.parent.close(!0)}this.nextUpdate=t+140}canMove(t){const e=t.x,i=t.y,n=r.Math.FloorTo(e/jl),o=r.Math.FloorTo(i/jl);if(n<0||o<0||n>=24||o>=24)return!1;const s=r.Math.FloorTo(this.mazePlayer.x/jl),a=r.Math.FloorTo(this.mazePlayer.y/jl),l=this.maze[a][s];return!(l.top&&i<this.mazePlayer.y||l.bottom&&i>this.mazePlayer.y||l.left&&e<this.mazePlayer.x||l.right&&e>this.mazePlayer.x)}}class Pl extends r.Scene{constructor(){super("MazeDialog"),e(this,"player"),e(this,"container"),e(this,"arrow"),e(this,"keys")}init(t){this.player=t.player}create(){var t,e;this.container=this.add.container(u.width/2,u.height/2),this.container.add(this.add.rectangle(0,0,.95*u.width,.95*u.height,0,.9).setStrokeStyle(4,m(g.Tan))),this.container.add(new Fa(this,.44*u.width,-.4*u.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*u.height,"Find your way through the forest",{...v,fontSize:48}).setOrigin(.5)),this.arrow=this.add.sprite(.4*-u.width,.4*-u.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new ll(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new sa(this),this.scene.launch("Maze",{parent:this})}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}close(t){this.scene.stop(),this.scene.stop("Maze"),this.scene.resume("Game"),t?(Ea(Zs.Forest,this.player),this.player.journal.addEntry(na.ForestMazeSolved)):this.player.setPosition(la[Zs.TownEast].x-40,la[Zs.TownEast].y)}}class Tl extends r.Scene{constructor(){super("Paused"),e(this,"parent")}init(t){this.parent=t.game}create(){var t;const{width:e,height:r}=u;this.add.rectangle(e/2,r/2,e,r,0,.75).setInteractive().on("pointerdown",(()=>this.resume())),this.add.text(e/2,100,"Game Paused",{...v,fontSize:72}).setOrigin(.5),this.add.text(e-20,20,`Build Time: ${new Date("2024-08-01T02:16:51.938Z").toLocaleString()}`,{...v,fontSize:16}).setOrigin(1,0);const i=!u.zoomed,n=i?100:88,o=r/2-(i?100:70),s=new Ba(this);s.addButton(new Fa(this,e/2,o,"Resume",(()=>this.resume()))),s.addButton(new Fa(this,e/2,o+n,"Save",(()=>{this.resume(),Za(this.parent)}))),s.addButton(new Fa(this,e/2,o+2*n,"Load",(()=>{this.resume(),this.parent.scene.restart()}))),s.addButton(new Fa(this,e/2,o+3*n,"Toggle Gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}))),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume())),new ll(this).setVisible(!1)}resume(){this.scene.stop(),this.scene.resume("Game")}}var Al=(t=>(t.Straight="S",t.Corner="C",t.T="T",t.Cross="X",t.Empty=" ",t))(Al||{}),Il=(t=>(t[t.Up=0]="Up",t[t.Right=90]="Right",t[t.Down=180]="Down",t[t.Left=270]="Left",t))(Il||{});const El={S:[[0,0,0],[1,1,1],[0,0,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},Cl=[["C"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "],["T","C"," "," "," ","C","C"," ","C","S","T","X"," "," "," "," "],[" ","S"," "," "," ","T","S"," ","X"," "," ","S"," "," "," "," "],[" ","X","S","T"," ","S","S"," ","X"," "," ","X","X","T"," "," "],[" "," "," ","C","X","T","T","X","S"," "," ","T","C","S"," "," "],[" "," "," "," "," "," "," ","X","T"," "," "," "," ","S"," "," "],[" "," "," "," "," "," "," ","S","T"," "," "," "," ","T","S","C"],[" "," "," "," "," "," "," ","C","C"," "," "," "," "," "," ","C"]].map((t=>t.map((t=>t))));function Ml(t,e){if(!t||!e)return!1;const r=Fl(t),i=Fl(e),n=e.x-t.x,o=e.y-t.y;return 1===n&&0===o?r.right&&i.left:-1===n&&0===o?r.left&&i.right:0===n&&1===o?r.bottom&&i.top:0===n&&-1===o&&r.top&&i.bottom}function Fl(t){const e=function(t){let e=El[t.type];const r=Math.floor(t.rotation/90);for(let i=0;i<r;i++)e=Bl(e);return e}(t);return{left:e.some((t=>1===t[0])),right:e.some((t=>1===t[t.length-1])),top:e[0].some((t=>1===t)),bottom:e[e.length-1].some((t=>1===t))}}function Bl(t){return t[0].map(((e,r)=>t.map((t=>t[r])).reverse()))}class Dl extends r.Scene{constructor(){super("Pipes"),e(this,"parent"),e(this,"graphics"),e(this,"cursor"),e(this,"position"),e(this,"keys"),e(this,"pipes",[]),e(this,"images"),e(this,"blockSize"),e(this,"pipeSize"),e(this,"nextUpdate",0)}init(t){this.parent=t.parent,this.blockSize=u.zoomed?13:17,this.pipeSize=3.75*this.blockSize}preload(){this.prerenderPipes()}prerenderPipes(){for(const t of Object.values(Al).filter((t=>"number"!=typeof t))){const e=El[t],r=`pipe_${t}`;this.textures.exists(r)&&this.textures.remove(r);const i=this.textures.createCanvas(r,3*this.blockSize,3*this.blockSize);if(i){const t=i.context;t.fillStyle="#ffffff";for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)1===e[r][i]&&t.fillRect(i*this.blockSize,r*this.blockSize,this.blockSize,this.blockSize);i.refresh()}}}create(){this.graphics=this.add.graphics(),this.keys=this.parent.keys,this.cursor=this.add.rectangle(100,100,this.pipeSize,this.pipeSize,0,0).setStrokeStyle(2,m(g.Tan),.75).setVisible(!1),this.position=new r.Math.Vector2(0,0),this.createPipes(),this.updatePipes()}createPipes(){this.pipes=[],this.images=this.add.container().setPosition(u.width/2-16*this.pipeSize/2+this.pipeSize/2,u.height/4);for(let e=0;e<8;e++){this.pipes[e]||(this.pipes[e]=[]);for(let r=0;r<16;r++){let i=Cl[e][r];const n=0===r&&0===e,o=15===r&&7===e;let s=!n&&!o;i===Al.Empty&&Math.random()<.9&&(i=(t=Object.values(Al).filter((t=>"number"!=typeof t)))[Math.floor(Math.random()*t.length)],i===Al.Cross&&Math.random()<.5&&(i=Al.T),Math.random()<.25&&(s=!1)),this.pipes[e][r]={x:r,y:e,type:i,rotation:90*Phaser.Math.Between(0,3),interactive:s},n&&(this.pipes[e][r].rotation=Il.Up),o&&(this.pipes[e][r].rotation=Il.Down);const a=`pipe_${i}`,l=this.add.image(r*this.pipeSize,e*this.pipeSize,a).on("pointerdown",(()=>{this.cursor.setVisible(!1),this.pipes[e][r].rotation=(this.pipes[e][r].rotation+90)%360,this.updatePipes()}));s&&l.setInteractive(),this.images.add(l)}}var t}updatePipes(){const t=function(t,e,r){const i=[],n=new Set,o=t.length,s=t[0].length;return function e(r,a){const l=`${r},${a}`;n.add(l),i.push(t[a][r]),r+1<s&&!n.has(`${r+1},${a}`)&&Ml(t[a][r],t[a][r+1])&&e(r+1,a),r-1>=0&&!n.has(`${r-1},${a}`)&&Ml(t[a][r],t[a][r-1])&&e(r-1,a),a+1<o&&!n.has(`${r},${a+1}`)&&Ml(t[a][r],t[a+1][r])&&e(r,a+1),a-1>=0&&!n.has(`${r},${a-1}`)&&Ml(t[a][r],t[a-1][r])&&e(r,a-1)}(0,0),i}(this.pipes);this.pipes.forEach((e=>{e.forEach((e=>{const r=this.images.getAt(e.x+e.y*Cl[0].length);r.setAngle(e.rotation),t.includes(e)?(e.interactive?r.setTint(3364249):r.setTint(8789),e.x===Cl[0].length-1&&e.y===Cl.length-1&&this.parent.time.delayedCall(500,(()=>{this.parent.close(!0)}))):e.interactive?r.setTint(16777215):r.setTint(6710886)}))}))}update(t,e){if(t<this.nextUpdate)return;let r=!0;const i=this.keys.keys;if(i[oa.Continue]){const t=this.pipes[this.position.y][this.position.x];t.rotation=(t.rotation+90)%360,this.updatePipes()}else i[oa.Left]?this.position.x=Math.max(0,this.position.x-1):i[oa.Right]?this.position.x=Math.min(16,this.position.x+1):i[oa.Up]?this.position.y=Math.max(0,this.position.y-1):i[oa.Down]?this.position.y=Math.min(8,this.position.y+1):r=!1;r&&(this.nextUpdate=t+200,this.cursor.setVisible(!0),this.cursor.setPosition(this.images.x+this.position.x*this.pipeSize,this.images.y+this.position.y*this.pipeSize))}}class Rl extends r.Scene{constructor(){super("PipesDialog"),e(this,"player"),e(this,"container"),e(this,"arrow"),e(this,"keys"),e(this,"level")}init(t){this.player=t.player,this.level=t.level}create(){var t,e;this.container=this.add.container(u.width/2,u.height/2),this.container.add(this.add.rectangle(0,0,.95*u.width,.95*u.height,0,.9).setStrokeStyle(4,m(g.Tan))),this.container.add(new Fa(this,.44*u.width,-.4*u.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*u.height,"Rotate the pipes to fix the alchemy equipment",{...v,fontSize:48}).setOrigin(.5)),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new ll(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new sa(this),this.scene.launch("Pipes",{parent:this})}close(t){this.scene.stop(),this.scene.stop("Pipes"),this.scene.resume("Game"),t&&0===this.level&&this.player.journal.addEntry(na.ForestMazeSolved)}}class Wl extends r.Scene{constructor(){super("Preloader")}init(){const t=this.add.rectangle(u.width/2,u.height/2,.75*u.width,32).setStrokeStyle(1,16777215),e=this.add.rectangle(4+t.x-t.width/2,u.height/2,4,27,16777215);this.load.on("progress",(t=>{e.width=.75*u.width*t-5}));const r=document.createElement("img");r.src="assets/icons/settings.svg",r.id="loading",this.add.dom(0,0,r),Ha(this,300)}preload(){this.load.setPath("assets"),this.load.svg("sun","icons/sun.svg",{width:64,height:64}),this.load.svg("moon","icons/moon.svg",{width:64,height:64}),this.load.svg("settings","icons/settings.svg",{width:64,height:64}),this.load.svg("zoom-in","icons/zoom-in.svg",{width:64,height:64}),this.load.svg("zoom-out","icons/zoom-out.svg",{width:64,height:64}),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("ladder","ladder.png"),this.load.image("warp","warp.png"),this.load.image("watch","watch.png"),this.load.image("arrow","arrow.png"),this.load.image("gear","items/gear.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),this.load.image("player_portrait","characters/player_portrait.png"),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png"),this.load.image("clock_portrait","characters/clock_portrait.png")}create(){this.time.delayedCall(500,(()=>{var t;t=()=>{this.scene.start("Game")},this.cameras.main.fadeOut(300,qa.red,qa.green,qa.blue,((e,r)=>{r>=1&&t&&t()}))}))}}const zl={type:Phaser.AUTO,width:u.width,height:u.height,parent:"game-container",backgroundColor:m(g.Background),scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[y,Wl,ul,Tl,fl,Pl,Ol,Rl,Dl],input:{gamepad:!0},physics:{default:"arcade"},render:{pixelArt:!0,antialias:!1},dom:{createContainer:!0}};("m6x11","assets/m6x11.ttf",new FontFace("m6x11","url(assets/m6x11.ttf)").load().then((function(t){document.fonts.add(t)})).catch((function(t){return t}))).then((()=>{new r.Game(zl)}));
