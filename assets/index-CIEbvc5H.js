var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);import{i,p as s,g as n,c as o,a as r}from"./phaser-CpyY471L.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const a={};let l=class extends i.Loader.File{constructor(t,e,i,s){super(t,{type:"font",key:e,url:i,xhrSettings:s})}load(){const t=new FontFace(this.key,`url(${this.url})`);t.load().then((()=>{document.fonts.add(t),this.loader.emit(i.Loader.Events.FILE_PROGRESS,this,1),this.loader.nextFile(this,!0)})).catch((()=>{this.loader.nextFile(this,!1)}))}};class h extends i.Plugins.BasePlugin{constructor(t){super(t),t.registerFileType("font",this.fontFileCallback)}fontFileCallback(t,e,i){this.addFile(new l(this,t,e,i))}}const c={width:1280,height:720},d={width:960,height:540};let u=!1,p=!1;p=!0;let y=!0;const g=localStorage.getItem("chrono-sleuth-prod");let f;null!==g&&(y="true"===g);let m=y;m=!0;const{width:b,height:v}=c;y&&(u=!1,p=!1,y=!0,f=void 0,m=!0);const w={debug:u,prod:y,bootDialog:f,useShader:m,width:b,height:v,cameraOffset:v/3,zoomed:!1,dayMinutes:.25,rewindEnabled:!1,fastMode:p},x="fcfee9",S="e6c99d",k="303646",I="1c1831",P="993333",T="339933",j="ffccaa",C="335588",O="111111",A="ddaaee";function E(t){return s.Display.Color.HexStringToColor(t).color}function M(t){return E(s.Display.Color.RGBToString(255*t.r,255*t.g,255*t.b))}function F(t){const e=s.Display.Color.ColorToRGBA(t);return new s.Display.Color(e.r,e.g,e.b,e.a)}const z={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${x}`};class D extends s.Scene{constructor(){super("Boot")}init(){this.add.text(w.width-100,w.height-40,"Loading...",z).setOrigin(1,1);const t=document.createElement("img");t.src="assets/icons/settings.svg?1",t.id="loading",this.add.dom(0,0,t)}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("splash","splash.png"),this.load.font("m6x11","../m6x11.ttf"),this.load.svg("maximize","icons/maximize.svg",{width:64,height:64}),this.load.svg("minimize","icons/minimize.svg",{width:64,height:64}),this.load.json("build",`../build.json?cacheBust=${Date.now()}`)}create(){var t;try{const e=null==(t=this.cache.json.get("build"))?void 0:t.buildTime;if(e&&"2024-10-18T23:15:14.371Z"!==e)return this.add.text(w.width/2,w.height/2,"New version available!\nUpdating Game...",{...z,align:"center",fontSize:48}).setOrigin(.5),void setTimeout((()=>window.location.reload()),15e3)}catch(e){console.error(e)}w.prod?this.scene.start("MainMenu"):this.scene.start("Preloader")}}var L=(t=>(t[t.Backgrounds=-1]="Backgrounds",t[t.Warpers=0]="Warpers",t[t.Npcs=1]="Npcs",t[t.Items=2]="Items",t[t.Player=3]="Player",t[t.Shader=4]="Shader",t[t.Ui=5]="Ui",t[t.Ui2=6]="Ui2",t[t.Debug=7]="Debug",t[t.Overlay=8]="Overlay",t))(L||{});class B extends s.GameObjects.GameObject{constructor(t,i,s,n,o,r){super(t,"DebugLight"),e(this,"x"),e(this,"y"),e(this,"light"),e(this,"debug"),t.add.existing(this),this.light=t.lights.addLight(i,s,n,o,r),this.debug=t.add.graphics({x:i,y:s}).setDepth(L.Debug),this.debug.lineStyle(3,65280),this.debug.name="DebugLightGraphics",this.x=i,this.y=s,w.debug&&this.debug.strokeCircle(0,0,n)}setPosition(t,e){this.light.setPosition(t,e),this.debug.setPosition(t,e),this.x=t,this.y=e}destroy(t){var e,i;super.destroy(t),this.debug.destroy(),null==(i=null==(e=this.scene)?void 0:e.lights)||i.removeLight(this.light)}}var G=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t[t.Prop=4]="Prop",t))(G||{}),R=(t=>(t[t.Underground=0]="Underground",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.TownNorth=6]="TownNorth",t[t.ClockSquare=7]="ClockSquare",t[t.ClockSquareNorth=8]="ClockSquareNorth",t[t.ClockEntrance=9]="ClockEntrance",t[t.ClockStairs=10]="ClockStairs",t[t.ClockTop=11]="ClockTop",t[t.TownWest=12]="TownWest",t[t.MansionGrounds=13]="MansionGrounds",t[t.MansionEntrance=14]="MansionEntrance",t[t.Mansion=15]="Mansion",t[t.LabHatch=16]="LabHatch",t[t.Lab=17]="Lab",t[t.LibraryEntrance=18]="LibraryEntrance",t[t.Library=19]="Library",t))(R||{}),W=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t[t.Key=2]="Key",t[t.HerbRed=3]="HerbRed",t[t.HerbGreen=4]="HerbGreen",t[t.HerbBlue=5]="HerbBlue",t[t.Potion=6]="Potion",t[t.Gear2=7]="Gear2",t))(W||{}),U=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t[t.InvestigateTownWest=2]="InvestigateTownWest",t[t.ExploreLab=3]="ExploreLab",t[t.FindPotionIngredients=4]="FindPotionIngredients",t))(U||{}),H=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.ClockTower=4]="ClockTower",t))(H||{}),N=(t=>(t[t.Sphinx=0]="Sphinx",t))(N||{}),_=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.MetTheMayor=1]="MetTheMayor",t[t.ClockFirstGear=2]="ClockFirstGear",t[t.AlchemyLabFound=3]="AlchemyLabFound",t[t.AlchemySetFixed=4]="AlchemySetFixed",t[t.SafeDiscovered=5]="SafeDiscovered",t[t.ExtraPotionInformation=6]="ExtraPotionInformation",t[t.ClockSecondGear=7]="ClockSecondGear",t))(_||{}),V=(t=>(t[t.Chest=0]="Chest",t[t.LabHatch=1]="LabHatch",t[t.LabBook=2]="LabBook",t[t.AlchemySet=3]="AlchemySet",t[t.LabBookshelf1=4]="LabBookshelf1",t[t.LabBookshelf2=5]="LabBookshelf2",t[t.LabBookshelf3=6]="LabBookshelf3",t[t.LabPotionShelf1=7]="LabPotionShelf1",t[t.MansionPicture=8]="MansionPicture",t[t.MansionHole=9]="MansionHole",t))(V||{});const $={[H.Inventor]:{x:550,y:635,scale:.75,image:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[H.Stranger]:{x:750,y:865,scale:1.35,image:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[H.Sphinx]:{x:3520,y:790,scale:1,image:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:t=>Vt(t.scene,t.scene.player.gameState.data.sphinxMoved,!0),light:1.85,initializeOnStart:!0},[H.Mayor]:{x:1065,y:-340,scale:.9,image:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[H.ClockTower]:{x:880,y:-2090,scale:.5,image:"warp",portrait:"clock_portrait",name:"Clock Tower",particles:{texture:"warp",scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]},onCreate:t=>{t.setOffset(150,-40)}}},q=F(E(O));function K(t,e,i){t.cameras.main.fadeIn(e,q.red,q.green,q.blue,((t,e)=>{e>=1&&i&&i()}))}function X(t,e,i){t.cameras.main.fadeOut(e,q.red,q.green,q.blue,((t,e)=>{e>=1&&i&&i()}))}function Y(t,e,i){return!!(e.inventory.initialized&&e.quests.initialized&&e.journal.initialized)&&s.Math.Distance.BetweenPointsSquared(t,e)<(i||1e3)**2}function Q(t,e,i){var s;null==(s=t.gamepad)||s.setAlpha(0),t.scene.pause(),t.scene.launch(e,{player:t.player,...i})}function J(t,e,i,n,o){const r=.3*(o.duration||100);return t.tweens.addCounter({from:0,to:r,onUpdate:t=>{const o=s.Display.Color.Interpolate.ColorWithColor(e,i,r,t.getValue());var a;n((a=o,E(s.Display.Color.RGBToString(a.r,a.g,a.b))))},...o})}function Z(t,e,i){return e&&Object.values(e).includes(t)?`${i}.${Object.keys(e).find((i=>e[i]===t))}`:t}function tt(t){return t.replace(/([A-Z]+|[0-9]+)/g," $1").trim()}const et=1200;let it=!1;function st(t){return M(t.lights.ambientColor)===E(x)}function nt(t,e=!0){it||(ot(t,x,e),e?t.time.delayedCall(et,(()=>rt(t,.5))):rt(t,.5),t.lights.lights.forEach((i=>{const s=i.intensity;e?t.tweens.add({targets:i,duration:et,intensity:0,onComplete:()=>{i.setVisible(!1),i.setIntensity(s)}}):i.setVisible(!1)})))}function ot(t,e,i){if(!i)return void t.lights.setAmbientColor(E(e));it=!0;const n=M(t.lights.ambientColor),o=s.Display.Color.ValueToColor(n),r=s.Display.Color.ValueToColor(e);J(t,o,r,(e=>t.lights.setAmbientColor(e)),{duration:et,onComplete:()=>{it=!1}})}function rt(t,e){t.children.getAll("name","DebugLightGraphics").forEach((t=>t.setAlpha(e)))}const at=2*Math.PI;class lt extends s.GameObjects.Graphics{constructor(t,i){super(t),e(this,"player"),e(this,"angle1",0),e(this,"angle2",1),e(this,"angle3",4),e(this,"update1",!1),e(this,"update2",!1),e(this,"update3",!1),t.add.existing(this),this.player=i,this.setPosition(842,-2107),this.setDepth(L.Npcs),this.updateHands()}update(t){this.update1&&(this.angle1=at*(t/6e4)*35),this.update2&&(this.angle2=at*(t/36e5)*35),this.update3&&(this.angle3=at*(t/432e5)*35),this.clear(),this.lineStyle(6,E(C)),this.lineBetween(0,0,50*Math.cos(this.angle1),50*Math.sin(this.angle1)),this.lineBetween(0,0,40*Math.cos(this.angle2),40*Math.sin(this.angle2)),this.lineBetween(0,0,25*Math.cos(this.angle3),25*Math.sin(this.angle3)),this.lineStyle(4,E(I));for(let e=0;e<12;e++){const t=at*(e/12),i=50*Math.cos(t),s=50*Math.sin(t);this.lineBetween(i,s,1.5*i,1.5*s)}}updateHands(){Tt(this.player,_.ClockFirstGear)&&(this.update1=!0),Tt(this.player,_.ClockSecondGear)&&(this.update2=!0)}}var ht=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t[t.Shift=6]="Shift",t))(ht||{});class ct{constructor(t){e(this,"scene"),e(this,"keys",Object.keys(ht).map(Number).reduce(((t,e)=>({...t,[e]:!1})),{})),this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W"),this.listener(2,"A"),this.listener(1,"S"),this.listener(3,"D"),this.listener(4,"SPACE"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE"),this.listener(6,"SHIFT")}listener(t,e){var i,s;null==(i=this.scene.input.keyboard)||i.on(`keydown-${e}`,(()=>this.keys[t]=!0)),null==(s=this.scene.input.keyboard)||s.on(`keyup-${e}`,(()=>this.keys[t]=!1))}resetKeys(){Object.entries(this.keys).forEach((([t,e])=>this.keys[Number(t)]=!1))}}class dt extends s.Physics.Arcade.Image{constructor(t,i,n){const{x:o,y:r,image:a}=$[i];super(t,o,r,a),e(this,"npcType"),e(this,"player"),e(this,"light"),e(this,"particles"),e(this,"lastPos",new s.Math.Vector2),e(this,"clock"),e(this,"disabled",!1),e(this,"initialized",!1),this.npcType=i,this.player=n,this.setDepth(L.Npcs),"warp"===a&&this.setAlpha(0),Mt(this,$[i])}lazyInit(t){if(!t&&(this.initialized||!Y(this,this.player)))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0});const{x:e,y:i,light:s,particles:n,onCreate:o}=$[this.npcType],r=s||1,a=!st(this.scene);w.debug?(this.light=new B(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,r),this.light.light.setVisible(a)):(this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,r),this.light.setVisible(a)),n&&(this.particles=this.scene.add.particles(e,i,"",n)),this.npcType===H.ClockTower&&(this.clock=new lt(this.scene,this.player)),o&&o(this),this.initialized=!0}update(t,e){this.lazyInit(),!this.light||this.x===this.lastPos.x&&this.y===this.lastPos.y||this.light.setPosition(this.x,this.y),this.lastPos.set(this.x,this.y),this.clock&&this.clock.update(t)}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return G.None;if(t[ht.Continue]){const t=Ut(Gt[this.npcType],this.player,this);if(t&&(null==t?void 0:t.messages.length)>0){const e=$[this.npcType].portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),G.Talked}}return G.None}getButtonPrompt(){return this.npcType===H.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${$[this.npcType].name}`,"Press [CONTINUE]"]}}const ut={[V.Chest]:{x:5110,y:915,image:"chest",scale:{x:4.5,y:3}},[V.LabHatch]:{x:-1910,y:640},[V.LabBook]:{x:-700,y:1630,image:"book"},[V.AlchemySet]:{x:-2650,y:1600,image:"alchemy_empty",skipLighting:!0,particles:{scale:{min:.05,max:.15},speed:{min:30,max:120},alpha:{values:[0,.5,0]},gravityY:100,lifespan:{min:250,max:500},emitting:!1,stopAfter:60}},[V.LabBookshelf1]:{x:-2025,y:1700},[V.LabBookshelf2]:{x:-1290,y:1700},[V.LabBookshelf3]:{x:-1115,y:1700},[V.LabPotionShelf1]:{x:-1790,y:1700},[V.MansionPicture]:{x:-1233,y:-580,scale:1.2,angle:5,image:"picture",origin:{x:0,y:0},initializeOnStart:!0,skipLighting:!0},[V.MansionHole]:{x:-1870,y:-490}};class pt extends s.Physics.Arcade.Image{constructor(t,i,s){const{x:n,y:o,image:r}=ut[i];super(t,n,o,r||""),e(this,"propType"),e(this,"player"),e(this,"particles"),e(this,"initialized",!1),e(this,"disabled",!1),this.propType=i,this.player=s,this.setScale(r?.35:2).setDepth(L.Items),r||w.debug||this.setAlpha(0),Mt(this,ut[i])}lazyInit(t){if(!t&&(this.initialized||!Y(this,this.player)))return;if(this.checkDestroyed())return;this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0});const e=ut[this.propType].particles;e&&(this.particles=this.scene.add.particles(this.x,this.y,"warp",e).setDepth(L.Items)),this.initialized=!0}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return G.None;if(t[ht.Continue]){const t=Ut(Wt[this.propType]||[],this.player,this);if(t&&(null==t?void 0:t.messages.length)>0)return this.player.message.setDialog(t,this,ut[this.propType].portrait||"player_portrait"),G.Prop}return G.None}checkDestroyed(){let t=!1;return this.propType===V.LabHatch&&Tt(this.player,_.AlchemyLabFound)&&(t=!0),this.propType===V.Chest&&xt(this.player,W.Gear1)&&(t=!0),t&&this.destroy(),t}getButtonPrompt(){const t=Ut(Wt[this.propType]||[],this.player,this);let e=V[this.propType];return e=tt(e),t&&(null==t?void 0:t.messages.length)>0?[`Inspect ${e}`,"Press [CONTINUE]"]:""}update(){this.lazyInit()}}const yt={[_.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[_.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:R.ClockSquareNorth},[_.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[_.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:R.LabHatch},[_.AlchemySetFixed]:{description:"With the alchemy set fixed, I can now attempt to create the brew mentioned in the old journal."},[_.SafeDiscovered]:{description:"I discovered a safe in the abandonded mansion. I wonder what secrets it holds."},[_.ExtraPotionInformation]:{description:'I found an extra journal entry with more information on the potion. It stated the name of the potion was the "Keyless Elixir". This potion must be the key to unlocking the safe.'},[_.ClockSecondGear]:{description:"I found the second gear for the clock tower inside a safe, which was located within the abandoned mansion. I still need one more gear to fix it."}},gt={[U.ForestGear]:{description:"Find the gear in the forest",warpAdd:R.TownEast,warpComplete:R.TownNorth},[U.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[U.InvestigateTownWest]:{description:"Investigate the west side of town",warpAdd:R.TownWest},[U.ExploreLab]:{description:"Explore the hidden alchemy lab"},[U.FindPotionIngredients]:{description:"Find the 3 potion ingredients"}};var ft=(t=>(t[t.Ladder=0]="Ladder",t[t.Warp=1]="Warp",t[t.Invisible=2]="Invisible",t[t.WarpHidden=3]="WarpHidden",t[t.InvisibleHidden=4]="InvisibleHidden",t))(ft||{});const mt={[R.Town]:{x:300,y:650,key:ht.Down,warpTo:R.Underground,visual:0},[R.Underground]:{x:301,y:875,key:ht.Up,warpTo:R.Town,visual:0},[R.TownEast]:{x:1720,y:650,key:ht.Right,warpTo:R.Forest,visual:3},[R.Forest]:{x:2650,y:815,key:ht.Left,warpTo:R.TownEast,visual:1},[R.TownNorth]:{x:775,y:650,key:ht.Up,warpTo:R.ClockSquare,visual:3},[R.ClockSquare]:{x:610,y:-330,key:ht.Left,warpTo:R.TownNorth,visual:1},[R.ClockSquareNorth]:{x:915,y:-330,key:ht.Up,warpTo:R.ClockEntrance,visual:3},[R.ClockEntrance]:{x:690,y:-1320,range:15,key:ht.Left,warpTo:R.ClockSquareNorth,visual:1,skipLighting:!0},[R.ClockStairs]:{x:910,y:-1400,range:20,key:ht.Right,warpTo:R.ClockTop,visual:2},[R.ClockTop]:{x:780,y:-1970,range:10,key:ht.Left,warpTo:R.ClockStairs,visual:2},[R.ForestEast]:{x:3590,y:815,key:ht.Right,warpTo:R.Lake,visual:3,initializeOnStart:!0},[R.Lake]:{x:4625,y:915,key:ht.Left,warpTo:R.ForestEast,visual:1},[R.TownWest]:{x:90,y:650,key:ht.Left,warpTo:R.MansionGrounds,visual:3},[R.MansionGrounds]:{x:-620,y:640,key:ht.Right,warpTo:R.TownWest,visual:1},[R.MansionEntrance]:{x:-1290,y:640,key:ht.Up,warpTo:R.Mansion,visual:1},[R.Mansion]:{x:-1405,y:-420,key:ht.Down,warpTo:R.MansionEntrance,visual:2},[R.LabHatch]:{x:-1920,y:640,key:ht.Down,warpTo:R.Lab,visual:4},[R.Lab]:{x:-1380,y:1545,key:ht.Right,warpTo:R.LabHatch,visual:2,range:15,skipLighting:!0},[R.LibraryEntrance]:{x:1420,y:650,key:ht.Up,warpTo:R.Library,visual:3},[R.Library]:{x:1730,y:-120,key:ht.Left,warpTo:R.LibraryEntrance,visual:1}},bt=[];Object.values(gt).forEach((t=>{t.warpAdd&&bt.push(t.warpAdd),t.warpComplete&&bt.push(t.warpComplete)})),Object.values(yt).forEach((t=>{t.warpAdd&&bt.push(t.warpAdd)}));class vt extends s.Physics.Arcade.Image{constructor(t,i,s){const{x:n,y:o,visual:r,range:a}=mt[i];super(t,n,o,r===ft.Ladder?"ladder":"warp"),e(this,"warpType"),e(this,"player"),e(this,"graphics"),e(this,"portal1"),e(this,"portal2"),e(this,"range"),e(this,"initialized",!1),this.warpType=i,this.player=s,this.range=a||30,this.setScale(.6).setDepth(L.Warpers),r!==ft.Warp&&r!==ft.WarpHidden||(this.setScale(.6,1),this.setPosition(n,o-12)),w.debug||(r!==ft.WarpHidden&&r!==ft.InvisibleHidden||this.setVisible(!1),r!==ft.Invisible&&r!==ft.InvisibleHidden||this.setAlpha(0)),Mt(this,mt[i]),bt.includes(i)&&t.add.existing(this)}lazyInit(t){(t||!this.initialized&&Y(this,this.player))&&(bt.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createParticles(),this.createDebug(),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),this.setVisible(this.visible),this.warpType===R.Underground&&(this.scene.add.image(this.x,this.y-60,"ladder").setScale(.6).setDepth(L.Warpers).setPipeline("Light2D").setPostPipeline("XRayPipeline"),this.scene.add.image(this.x,this.y-105,"ladder").setScale(.6).setDepth(L.Warpers).setPipeline("Light2D").setPostPipeline("XRayPipeline")),this.initialized=!0)}createParticles(){const{visual:t,skipLighting:e}=mt[this.warpType];t!==ft.Warp&&t!==ft.WarpHidden||(this.setAlpha(.1),this.scene.anims.exists("portal")||this.scene.anims.create({key:"portal",frames:this.scene.anims.generateFrameNumbers("portal",{start:0,end:63}),frameRate:10,repeat:-1}),this.portal1=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.45,1).setAlpha(.9).play("portal"),this.portal1.postFX.addPixelate(1),this.portal1.postFX.addShadow(0,0,.1,1,3355562,6,.5),this.portal2=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.35,1).setAlpha(.65).setFlipX(!0),this.portal2.postFX.addPixelate(1),this.portal2.play("portal"),this.portal2.setFrame(Math.floor(30*Math.random())),e||(this.portal1.setPipeline("Light2D"),this.portal2.setPipeline("Light2D")),this.portal1.setPostPipeline("XRayPipeline"),this.portal2.setPostPipeline("XRayPipeline"))}createDebug(){if(w.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const t=this.body;this.graphics.lineBetween(-this.range,-t.halfHeight,-this.range,t.halfHeight),this.graphics.lineBetween(this.range,-t.halfHeight,this.range,t.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:t,key:e}=mt[this.warpType];return!(t!==ft.Warp&&t!==ft.WarpHidden&&t!==ft.Invisible||e!==ht.Left&&e!==ht.Right)}onInteract(t){const e=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,i=t[mt[this.warpType].key]&&e;return!i||this.warpType!==R.TownEast||this.player.gameState.data.mazeSolved||w.debug?i?(wt(mt[this.warpType].warpTo,this.player),G.Teleported):G.None:(Q(this.scene,"MazeDialog"),G.None)}getButtonPrompt(){const t=mt[this.warpType].key;let e;t===ht.Continue&&(e="[CONTINUE]"),t===ht.Up&&(e="[Up]"),t===ht.Down&&(e="[Down]"),t===ht.Left&&(e="[Left]"),t===ht.Right&&(e="[Right]");let i=R[mt[this.warpType].warpTo];return i=tt(i),[`Travel to ${i}`,"Press "+e]}setPosition(t,e,i,s){var n,o,r;return super.setPosition(t,e,i,s),null==(n=this.portal1)||n.setPosition(t,e),null==(o=this.portal2)||o.setPosition(t,e),null==(r=this.graphics)||r.setPosition(t,e),this}setVisible(t){var e,i;return super.setVisible(t),null==(e=this.portal1)||e.setVisible(t),null==(i=this.portal2)||i.setVisible(t),this}update(t,e){this.lazyInit()}destroy(t){var e,i;null==(e=this.portal1)||e.destroy(t),null==(i=this.portal2)||i.destroy(t),super.destroy(t)}}function wt(t,e,i){let{x:n,y:o,onWarp:r}=mt[t];i&&(n+=i.x,o+=i.y);const a=e.scene,l=n-a.cameras.main.width/2,h=o-a.cameras.main.height/2;r&&r(e),a.cameras.main.fadeOut(200,0,0,0,((t,e)=>{e>=1&&a.cameras.main.fadeIn(1e3,0,0,0)})),a.cameras.main.stopFollow(),a.tweens.add({targets:a.cameras.main,scrollX:l,scrollY:h-w.cameraOffset,duration:600,delay:100,ease:"Power1",onComplete:()=>{a.cameras.main.startFollow(e),a.cameras.main.setFollowOffset(0,w.cameraOffset)}}),e.setActive(!1),a.tweens.add({targets:e,alpha:0,duration:500,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e.setPosition(n,o)},onComplete:()=>{e.alpha=1,e.setActive(!0)}}),a.tweens.add({targets:e.light,intensity:0,duration:50,hold:600,yoyo:!0,repeat:0});const c=e.light instanceof s.GameObjects.Light?e.light:e.light.light;a.tweens.add({targets:c,x:n,y:o,duration:400,ease:"Power1"})}function xt(t,e){return void 0!==t.inventory.inventory.find((t=>t.type===e))}function St(t,e){return void 0!==t.inventory.inventory.find((t=>t.type===e&&!t.used))}function kt(t,e){return void 0!==t.inventory.inventory.find((t=>t.type===e&&t.used))}function It(t,e){return t.quests.quests.some((t=>t.id===e&&!t.completed))}function Pt(t,e){return t.quests.quests.some((t=>t.id===e&&t.completed))}function Tt(t,e){return t.journal.journal.includes(e)}function jt(t,e){return t.children.getAll().filter((t=>t instanceof e))}function Ct(t,e,i){const s=function(t,e){return jt(t,vt).find((t=>t.warpType===e))}(t,e);s&&s.setVisible(i)}function Ot(t,e){return jt(t,dt).find((t=>t.npcType===e))}function At(t,e){return jt(t,Nt).find((t=>t.itemType===e))}function Et(t,e){return jt(t,pt).find((t=>t.propType===e))}function Mt(t,e){const{scale:i,alpha:s,angle:n,depth:o,skipLighting:r,origin:a,initializeOnStart:l}=e;i&&("object"==typeof i?t.setScale(i.x,i.y):t.setScale(i)),s&&t.setAlpha(s),n&&t.setAngle(n),o&&t.setDepth(o),a&&t.setOrigin(a.x,a.y),r||t.setPipeline("Light2D"),t.setPostPipeline("XRayPipeline"),l&&t.lazyInit(!0)}const Ft=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[H.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[H.Stranger]:["The sphinx’s riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[H.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[H.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[H.Inventor]:["The sphinx’s riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[H.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, don’t they?","They move, disappear, and seem to fly without wings."]}}];function zt(t){return t instanceof xh&&It(t.player,U.FindPotionIngredients)?1:0}function Dt(t,e){const i=zt(t);return Ft[i].hints[e]}const Lt={messages:t=>function(t){const e=zt(t);return[Ft[e].question]}(t.scene),options:t=>function(t){const e=zt(t),i=[...Ft[e].options].sort((()=>Math.random()-.5));return i.push("I don’t know"),i}(t.scene),onSelected:function(t,e,i){t===function(t){const e=zt(t);return Ft[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(U.SphinxRiddle,!0),t.gameState.updateData({sphinxMoved:!0,sphinxFail:!1})}},i):"I don’t know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},i):e.message.setDialog({messages:["That is not correct. You will not remember how to get back to me."],onCompleted:t=>{t.gameState.updateData({mazeSolved:!1,mazeSeed:t.gameState.data.mazeSeed+1,sphinxFail:!0}),wt(R.TownEast,t,{x:-100,y:0})}},i)}},Bt={messages:["There. It looks like the alchemy set has been properly fit back together."],onCompleted:t=>{t.journal.addEntry(_.AlchemySetFixed)}},Gt={[H.Inventor]:[{messages:["There is still one more gear missing.","Something tells me there is a great evil near the lake."],conditions:{journalEntry:_.ClockSecondGear}},{messages:["Ah, the second gear. You should take it to the clock tower."],conditions:{hasItem:W.Gear2}},{messages:["You found a secret safe in the mansion?","Very interesting. There may be a hint about opening it nearby."],conditions:{journalEntry:_.SafeDiscovered}},{messages:["Blue Plumed Frond? I have not heard of such a plant.","The stranger may know. Many secrets lie under this town."],conditions:{activeQuest:U.FindPotionIngredients}},{messages:["There are rumors of an abandoned mansion west of the town.","Some say it is haunted and dark magic lurks within."],conditions:{activeQuest:U.InvestigateTownWest}},{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:W.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(U.ForestGear,!0)}},{messages:t=>Dt(t.scene,H.Inventor),conditions:{activeQuest:U.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:W.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench, but you’ll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(_.FixTheClock),t.inventory.addItem({type:W.Wrench,used:!1})}}],[H.Stranger]:[{messages:["I am worried about the secrets hidden near the lake.","Long ago I saw a great evil lurking there."],conditions:{journalEntry:_.ClockSecondGear}},{messages:["Another gear? The mayor probably wants that put back in the clock tower."],conditions:{hasItem:W.Gear2}},{messages:["The lock on that safe is no ordinary lock. It requires something special to open it."],conditions:{journalEntry:_.SafeDiscovered,hasUnusedItem:W.Potion}},{messages:["Hmm a potion, I wonder what it does.","The alchemist was no ordinary person and built magical safeguards against intruders."],conditions:{hasUnusedItem:W.Potion}},{messages:["Green Writhewood? Hm, there might be some near the forest or lake."],conditions:{activeQuest:U.FindPotionIngredients}},{messages:["You heard of the mansion to the west? It was abandoned many years ago.","There is a rumor of an alchemy lab hidden somewhere nearby, but I have been searching for years and have found not even a single potion."],conditions:{activeQuest:U.InvestigateTownWest}},{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:W.Gear1}},{messages:t=>Dt(t.scene,H.Stranger),conditions:{activeQuest:U.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:W.Wrench,custom:t=>!function(t,e){return t.quests.quests.some((t=>t.id===e))}(t,U.ForestGear)},onCompleted:t=>{t.quests.addQuest({id:U.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[H.Sphinx]:[{messages:t=>t.gameState.data.sphinxFail?["You have returned. I am surprised you were able to find your way back.","Try again."]:It(t,U.FindPotionIngredients)?["I see you are back again. You may find what you are looking for ahead, but must first answer my riddle."]:["Ponder this riddle. Answer wisely."],conditions:{activeQuest:U.SphinxRiddle,completedQuest:U.SphinxRiddle,or:!0},onCompleted:(t,e)=>{t.scene.time.delayedCall(50,(()=>{t.message.setDialog({...Lt},e)}))}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:U.SphinxRiddle,completed:!1})}}],[H.Mayor]:[{messages:["I’ve been hearing strange reports from the townsfolk. It’s as if time is slipping. Have you felt it?","The clock is still missing a gear. It must be somewhere nearby."],conditions:{journalEntry:_.ClockSecondGear}},{messages:["The second gear has been found? That’s incredible news!"],conditions:{completedQuest:U.InvestigateTownWest}},{messages:["Herbs? I haven’t the faintest idea where to being looking. Start at the source - there are bound to be a few ingredients in the lab you found."],conditions:{activeQuest:U.FindPotionIngredients}},{messages:["The minute hand on the clock is spinning again.","It looks like it’s missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:_.ClockFirstGear},onCompleted:t=>{t.quests.addQuest({id:U.InvestigateTownWest,completed:!1})}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:_.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(_.MetTheMayor)}}],[H.ClockTower]:[{messages:["With two of the gears in place, the clocks hands are moving again."],conditions:{journalEntry:_.ClockSecondGear}},{messages:["Slowly, you align and tighten the second gear into place.","[CREAKING NOISE]","Now two of the hands of the clock are moving again."],conditions:{hasItem:W.Gear2},onCompleted:t=>{t.inventory.removeItem(W.Gear2),t.journal.addEntry(_.ClockSecondGear)}},{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:_.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Let’s see what happens when we add the first gear. You tighten the gear into place.","[CREAKING NOISE]","The clock tower is starting to partially move again. It looks like it’s missing two more gears."],conditions:{hasItem:W.Gear1},onCompleted:t=>{t.inventory.removeItem(W.Gear1),t.journal.addEntry(_.ClockFirstGear)}}]},Rt={[W.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}],[W.Gear2]:[{messages:["Finally! I found the second gear to the clock tower.","I should take this and put it back."],onCompleted:t=>{t.quests.updateExistingQuest(U.InvestigateTownWest,!0)}}]},Wt={[V.Chest]:[{messages:["The chest seems to be locked.","It appears to have a puzzle around the latch"],conditions:{custom:t=>!xt(t,W.Gear1)&&void 0===At(t.scene,W.Gear1)},onCompleted:t=>{Q(t.scene,"TumblerDialog")}}],[V.LabHatch]:[{messages:["Let me see if I can open this hatch.","Wow, the rusty key fits!","[CREAKING NOISE]","Alright, let’s see what is down there!"],conditions:{hasItem:W.Key},onCompleted:(t,e)=>{null==e||e.destroy(),t.inventory.removeItem(W.Key),t.journal.addEntry(_.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[V.LabBook]:[{messages:[],conditions:{journalEntry:_.ClockSecondGear}},{messages:['How could I have missed this? The potion is called the "Keyless Exlixir".',"This must be the key to the safe."],conditions:{journalEntry:_.SafeDiscovered},onCompleted:t=>{t.journal.addEntry(_.ExtraPotionInformation)}},{messages:["I should speak to the mysterious stranger about this lab and the potion I brewed."],conditions:{hasItem:W.Potion}},{messages:["With the alchemy set fixed, I should be able to recreate the experiment.","I will need to find three ingredients according to this - Crimson Starbloom, Green Writhewood, and a Blue Plumed Frond.","Maybe I can find them in the lab or the forest. The villagers should know more."],conditions:{journalEntry:_.AlchemySetFixed},onCompleted:t=>{t.quests.addQuest({id:U.FindPotionIngredients,completed:!1}),t.gameState.updateData({mazeSolved:!1,mazeSeed:t.gameState.data.mazeSeed+1,sphinxMoved:!1})}},{messages:["Maybe I can find more information in the lab."],conditions:{activeQuest:U.ExploreLab}},{messages:["This lab journal contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:t=>{t.quests.addQuest({id:U.ExploreLab,completed:!1})}}],[V.AlchemySet]:[{messages:["There’s nothing more that I can do here."],conditions:{hasItem:W.Potion}},{messages:["Now we have all of the ingredients.","Now I should be able to recreate the experiment.","According to the book..."],conditions:{hasUsedItem:W.HerbBlue},onCompleted:function(t,e){const i=t.scene;t.inventory.removeItem(W.HerbBlue),t.setActive(!1),X(i,500,(()=>{i.time.delayedCall(700,(()=>{var s;null==e||e.setTexture("alchemy_full"),null==(s=null==e?void 0:e.particles)||s.setConfig({...ut[V.AlchemySet].particles,tint:[6684791],x:30,delay:200,stopAfter:120}).start(),K(i,1500,(()=>{t.message.setDialog({messages:["I have created the potion mentioned in the old journal.","I should bring it to the mysterious stranger to see if they know how to use it."],onCompleted:(t,e)=>{t.inventory.addItem({type:W.Potion,used:!1}),t.quests.updateExistingQuest(U.ExploreLab,!0),null==e||e.setTexture("alchemy_empty"),t.setActive(!0)}},e,"player_portrait")}))}))}))}},{messages:["The Blue Plumed Frond is last."],conditions:{hasItem:W.HerbBlue,hasUsedItem:W.HerbRed},onCompleted:(t,e)=>{qt(t,e,W.HerbBlue),t.quests.updateExistingQuest(U.FindPotionIngredients,!0)}},{messages:["The Crimson Starbloom comes next."],conditions:{hasItem:W.HerbRed,hasUsedItem:W.HerbGreen},onCompleted:(t,e)=>qt(t,e,W.HerbRed)},{messages:["The Green Writhewood goes in first."],conditions:{hasItem:W.HerbGreen},onCompleted:(t,e)=>qt(t,e,W.HerbGreen)},{messages:["Maybe the journal has more information about using this alchemy set."],conditions:{journalEntry:_.AlchemySetFixed}},{messages:["This alchemy set looks like the one in the journal.","If I can figure out how the set connects together, I might be able to recreate the experiment."],conditions:{activeQuest:U.ExploreLab},onCompleted:t=>{Q(t.scene,"PipesDialog")}},{messages:["A series of pipes and tubes. I shouldn’t touch this without knowing what it does."]}],[V.LabBookshelf1]:[{messages:['[Secrets of the Silver Transmutation]\n"Silver, the mirror of the soul, can be yielded from common materials. Begin with a lead base, cleanse it with the tears of a willow, and chant thrice under a new moon. Such processes, though fraught with danger, promise immense reward. Meticulous preparation of the material is crucial."','"Among these pages lie safeguards against volatile spirits and the precise lunar phases essential for success. Here are protective circles and counter-spells to be used should spirits prove malevolent. This knowledge has been passed down and refined for safety."'],conditions:{activeQuest:U.ExploreLab}}],[V.LabBookshelf2]:[{messages:['[Whispering Woods: A Compendium]\n"The sentient trees of Eldergrove are not myths; their trunks groan with ancient wisdom. To engage them, perform the Ritual of Leaves, using moonlit water and rare herbs, along with whispered incantations passed down by forest guardians."','"Notes on the rare Blue Moonflower, whose petals glow ghostly and unlock forest languages, are also included. Its bloom is brief, and harvesting must be timed at midnight to retain its properties. The chapter concludes with a discussion on plant symbiosis with Eldertrees."'],conditions:{activeQuest:U.ExploreLab}}],[V.LabBookshelf3]:[{messages:['[The Essence of Fire: Ignite and Control]\n"Mastering fire requires strength of will and profound respect for its power. Here, summoning circles and incantations to call forth fire spirits are detailed. Each summoning demands a tribute of phoenix ash. The endeavor is perilous, as spirits may lash out if provoked."','"The tome also discusses methods to quell flames should they rise against the summoner. Included are the chant of suppression and a dousing mixture from elemental waters and frost-bitten herbs. These countermeasures are vital for maintaining control over summoned entities."'],conditions:{activeQuest:U.ExploreLab}}],[V.LabPotionShelf1]:[{messages:["Nightshade, wolfsbane, starvine, frost ferns... No, those are not the right ingedients.","Oh, a Crimson Starbloom! Yes, this should work!"],conditions:{activeQuest:U.FindPotionIngredients,custom:t=>!xt(t,W.HerbRed)},onCompleted(t){t.inventory.addItem({type:W.HerbRed,used:!1})}},{messages:['Hm, this is an interesting collection. What’s this "Elixir of Luminescence"? Could light up some dark corners. And "Brew of Bravery"... might make me bold enough to face a dragon, or foolish enough to try. What about "Draught of the Depths"—sounds like it could show me treasures or drown me in visions. Better not risk it; these might just burn me to a crisp!'],conditions:{activeQuest:U.ExploreLab}}],[V.MansionPicture]:[{messages:["You pour the potion into the safe keyhole.","[CLUNK]","The safe clicks open.","Huh, what’s that?"],conditions:{journalEntry:_.ExtraPotionInformation,hasUnusedItem:W.Potion},onCompleted:(t,e)=>{t.inventory.removeItem(W.Potion);const i=t.scene,s=new Nt(t.scene,W.Gear2,t);i.interactiveObjects.add(s),e&&(s.disabled=!0,s.setPosition(e.x,e.y+20),i.tweens.add({targets:s,x:e.x-10,y:e.y+120,duration:1e3,onComplete:()=>{s.disabled=!1},ease:"Bounce.easeOut"}))}},{messages:["A sturdy looking safe was hidden behind the picture.","It looks like it requires a special key to open."],conditions:{journalEntry:_.SafeDiscovered}},{messages:["An abstract picture of blocks.","Wait a moment, something is behind this picture","[CREAK]"],onCompleted:t=>{t.journal.addEntry(_.SafeDiscovered)},conditions:{hasItem:W.Potion}},{messages:["An abstract picture of blocks."]}],[V.MansionHole]:[{messages:["Literally a hole in the wall."]}]};function Ut(t,e,i){for(const s of t){const{conditions:t}=s,n=[];if(void 0!==(null==t?void 0:t.hasItem)&&n.push(xt(e,t.hasItem)),void 0!==(null==t?void 0:t.hasUnusedItem)&&n.push(St(e,t.hasUnusedItem)),void 0!==(null==t?void 0:t.hasUsedItem)&&n.push(kt(e,t.hasUsedItem)),void 0!==(null==t?void 0:t.completedQuest)&&n.push(Pt(e,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&n.push(It(e,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&n.push(Tt(e,t.journalEntry)),(null==t?void 0:t.custom)&&n.push(t.custom(e,i)),null==t?void 0:t.invert){if(null==t?void 0:t.or){if(n.some((t=>!t)))return s}else if(n.every((t=>!t)))return s;return}if(null==t?void 0:t.or){if(n.some((t=>t)))return s}else if(n.every((t=>t)))return s}}const Ht={[W.Wrench]:{x:0,y:0,image:"wrench",name:"Old Wrench"},[W.Gear1]:{x:0,y:0,image:"gear",name:"Shiny Gear"},[W.Key]:{x:-1750,y:-420,image:"key",name:"Rusty Key",skipLighting:!0},[W.HerbRed]:{x:-200,y:1730,image:"herb_red",name:"Crimson Starbloom"},[W.HerbGreen]:{x:5295,y:985,image:"herb_green",name:"Green Writhewood"},[W.HerbBlue]:{x:1535,y:875,image:"herb_blue",name:"Blue Plumed Frond"},[W.Potion]:{x:0,y:0,image:"potion",name:"Strange Potion"},[W.Gear2]:{x:0,y:0,image:"gear2",name:"Old Gear"}};class Nt extends s.Physics.Arcade.Image{constructor(t,i,s){const{x:n,y:o,image:r}=Ht[i];super(t,n,o,r),e(this,"itemType"),e(this,"player"),e(this,"particles"),e(this,"light"),e(this,"disabled",!1),e(this,"initialized",!1),this.itemType=i,this.player=s,this.setScale(.35).setDepth(L.Items),Mt(this,Ht[i])}lazyInit(t){(t||!this.initialized&&Y(this,this.player))&&(xt(this.player,this.itemType)?this.destroy():(this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0}),this.particles=this.scene.add.particles(this.x,this.y,"warp",{scale:{start:0,end:.9},alpha:{start:.8,end:0},delay:500,lifespan:1500,maxAliveParticles:1}),w.debug?this.light=new B(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2),this.initialized=!0))}onInteract(t){if(t[ht.Continue]){this.player.inventory.addItem({type:this.itemType,used:!1}),this.destroy();const t=Ut(Rt[this.itemType]||[],this.player,this);return t&&(null==t?void 0:t.messages.length)>0&&this.player.message.setDialog(t,this,"player_portrait"),G.Item}return G.None}destroy(t){var e,i,s;null==(e=this.particles)||e.destroy(),this.light instanceof B?this.light.destroy():null==(s=null==(i=this.scene)?void 0:i.lights)||s.removeLight(this.light),super.destroy(t)}getButtonPrompt(){return[`Pick Up ${Ht[this.itemType].name}`,"Press [CONTINUE]"]}update(){var t,e;this.lazyInit(),null==(t=this.particles)||t.setPosition(this.x,this.y),null==(e=this.light)||e.setPosition(this.x,this.y)}}const _t=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3630,y:760,id:N.Sphinx},{x:4575,y:850},{x:5835,y:900},{x:-565,y:575},{x:-2075,y:575},{x:-1930,y:-480},{x:-1050,y:-510},{x:-3075,y:1630},{x:-1350,y:1510},{x:-730,y:1560}];function Vt(t,e,i){var n,o;const r=Ot(t,H.Sphinx);if(!r)return void console.error("Sphinx not found");const a=function(t,e){return jt(t,s.GameObjects.Rectangle).find((t=>t.getData("WallType")===e))}(t,N.Sphinx);if(a){const t=(null==(n=_t.find((t=>t.id===N.Sphinx)))?void 0:n.x)||0;e?a.setX(t||0):a.setX(t-150),null==(o=a.body)||o.updateFromGameObject()}Ct(t,R.ForestEast,e||!1);const{x:l,y:h}=$[H.Sphinx],c=e?l+200:l,d=e?h-90:h;t.tweens.add({targets:r,alpha:0,duration:!e||i?0:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{r.setPosition(c,d)},onComplete:()=>{r.alpha=1,r.disabled=e||!1}}),t.tweens.add({targets:r.light,x:c,y:d,duration:!e||i?0:450,ease:"Power1"})}const $t={[W.HerbRed]:{texture:"alchemy_red",tint:11141120,x:-20},[W.HerbGreen]:{texture:"alchemy_green",tint:43520,x:-35},[W.HerbBlue]:{texture:"alchemy_blue",tint:170,x:-5}};function qt(t,e,i){t.inventory.removeItem(i),t.setActive(!1),e&&e.particles&&(e.disabled=!0,e.setTexture($t[i].texture),e.particles.setConfig({...ut[V.AlchemySet].particles,tint:$t[i].tint,x:$t[i].x}).start().on("complete",(()=>{e.disabled=!1,t.setActive(!0)})))}const Kt={mazeSolved:!1,mazeSeed:0,sphinxFail:!1,sphinxMoved:!1};class Xt{constructor(t,i){e(this,"scene"),e(this,"player"),e(this,"data"),this.scene=t,this.player=i,this.data={...Kt}}updateData(t,e){this.data={...this.data,...t},Object.entries(t).forEach((([t,i])=>{this.handleSideEffects(t,i,e)}))}handleSideEffects(t,e,i){"sphinxMoved"===t&&Vt(this.scene,e,i)}}w.dayMinutes,s.GameObjects.Container;class Yt extends s.GameObjects.Text{constructor(t){super(t,w.width/2,w.height-50,"",z),this.setOrigin(.5).setBackgroundColor("#"+I).setPadding(10,5).setAlign("center").setAlpha(.9).setScrollFactor(0).setDepth(L.Overlay).setVisible(!1),t.add.existing(this)}}class Qt extends s.GameObjects.Text{constructor(t,i,s,n,o,r){super(t,i,s,n,{...z,fontSize:48,backgroundColor:`#${k}`,padding:{x:15,y:10},...r}),e(this,"onClick"),e(this,"disabled"),e(this,"selected"),this.setOrigin(.5),t.add.existing(this),this.onClick=o,this.disabled=!1,this.selected=!1,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>{this.disabled||(this.setSelected(!1),o(this))})),this.on("pointerover",(()=>{this.disabled||this.selected||this.setTint(12303291)})),this.on("pointerout",(()=>{this.disabled||this.selected||this.setTint(16777215)}))}disable(){this.disabled=!0,this.selected=!1,this.disableInteractive(),this.setTint(6710886)}enable(){this.disabled=!1,this.selected=!1,this.setInteractive(),this.setTint(16777215)}setSelected(t){this.selected=t,this.setTint(t?E(A):16777215)}}class Jt extends Qt{constructor(t,e,i,s,n,o,r,a){super(t,e,i,s,n,{fontSize:32,align:"center",...o}),this.setOrigin((null==a?void 0:a.x)||0,(null==a?void 0:a.y)||0),null!==r&&this.setFixedSize((null==r?void 0:r.x)||250,(null==r?void 0:r.y)||50)}}class Zt extends s.GameObjects.Container{constructor(t,i,s){var n,o,r;super(t,i,s),e(this,"buttons",[]),e(this,"activeIndex",-1),t.add.existing(this).setScrollFactor(0),null==(n=t.input.keyboard)||n.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(o=t.input.keyboard)||o.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(r=t.input.keyboard)||r.on("keydown-ENTER",(()=>{var t;null==(t=this.buttons[this.activeIndex])||t.onClick(this.buttons[this.activeIndex])}))}addButton(t){this.add(t),this.buttons.push(t),1===this.buttons.length&&this.setActiveButton(0),t.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(t){var e,i;null==(e=this.buttons[this.activeIndex])||e.setSelected(!1),this.activeIndex=t,null==(i=this.buttons[this.activeIndex])||i.setSelected(!0)}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const te=20;class ee extends s.GameObjects.Container{constructor(t,i){var s,n;super(t),e(this,"textWidth"),e(this,"textHeight"),e(this,"player"),e(this,"target"),e(this,"npcName"),e(this,"text"),e(this,"box"),e(this,"portrait"),e(this,"options"),e(this,"optionsContainer"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),e(this,"initialized",!1);const{width:o,height:r}=w;this.textWidth=o-135-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(te,r-te-170),this.setDepth(L.Overlay),this.setVisible(!1),this.player=i,null==(s=this.scene.input.keyboard)||s.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(n=this.scene.input.keyboard)||n.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}createUI(){this.scene.add.existing(this),this.npcName=new s.GameObjects.Text(this.scene,170,15,"",{...z,color:"#"+S}),this.text=new s.GameObjects.Text(this.scene,170,60,"",z),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(5),this.portrait=new s.GameObjects.Image(this.scene,te,te,"").setOrigin(0).setScale(1.5),this.box=new s.GameObjects.Rectangle(this.scene,0,0,w.width-40,170,E(I),.8),this.box.setStrokeStyle(2,E(S),1),this.box.setOrigin(0,0),this.optionsContainer=new Zt(this.scene).setDepth(L.Overlay),this.add([this.box,this.npcName,this.text,this.portrait])}setDialog(t,e,i){if(this.npcName||this.createUI(),this.setVisible(void 0!==t),this.target=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,this.scene.gamepad.offsetButtons(void 0!==this.dialog),!t)return;const s=i||(e instanceof dt?$[e.npcType].portrait:void 0);this.npcName.setVisible(!1),s?(this.portrait.setVisible(!0),this.portrait.setTexture(s),this.text.setPosition(170,te+(e instanceof dt?40:0)).setWordWrapWidth(this.textWidth,!0).setFixedSize(this.textWidth,this.textHeight),e instanceof dt&&(this.npcName.setVisible(!0),this.npcName.setText($[e.npcType].name))):(this.portrait.setVisible(!1),this.text.setPosition(te,te).setWordWrapWidth(170+this.textWidth,!0).setFixedSize(170+this.textWidth,this.textHeight)),this.showMessage()}showMessage(){const t=this.getMessages(),e=t&&t[this.messageIndex];e&&(this.text.setText(e),this.text.getWrappedText().length>5&&console.error("Message too long!",e)),this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;const t=!w.zoomed;this.options.forEach(((e,i)=>{const s=new Qt(this.scene,w.width/2,w.height/(t?9:14)+i*(30+w.height/(t?16:22)),e,(()=>this.onSelectOption(e)),{fontSize:24,backgroundColor:"#"+I,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(L.Overlay);this.optionsContainer.addButton(s)}))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){if(Date.now()<this.interactionTimeout)return;const t=this.getMessages();this.dialog&&t&&(this.messageIndex++,this.messageIndex>=t.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.setVisible(!1)):this.showMessage(),this.scene.gamepad.offsetButtons(void 0!==this.dialog),this.interactionTimeout=Date.now()+350)}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}}class ie extends s.GameObjects.Text{constructor(t,e,i=3500,s=k){const n=jt(t,ie).reduce(((t,e)=>Math.max(t,e.y-20)),0)+65;super(t,20,n,e,{...z,backgroundColor:"#"+s,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(L.Overlay).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:n+10,duration:350,hold:i,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}class se extends s.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),e(this,"initialized",!1),this.setScrollFactor(0).setDepth(L.Ui).setVisible(!1)}createUI(){this.initialized||(this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,E(k)).setStrokeStyle(2,E(x)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...z,fontSize:32}),this.add(this.text),this.initialized=!0)}addItem(t,e){if(this.initialized||this.createUI(),this.inventory.push(t),!t.used){const e=this.scene.add.image(0,0,Ht[t.type].image).setScale(.35);t.type===W.Key&&e.setAngle(45),this.add(e)}this.updateItems();const i=At(this.scene,t.type);null==i||i.destroy(),e||new ie(this.scene,`New item added: ${Ht[t.type].name}`)}removeItem(t){var e;this.initialized||this.createUI();const i=this.inventory.find((e=>e.type===t));i&&(i.used=!0,null==(e=this.getAll().find((e=>{var i;return(null==(i=e.texture)?void 0:i.key)===Ht[t].image})))||e.destroy()),this.updateItems()}updateItems(){var t;this.initialized||this.createUI();let e=0;this.getAll().forEach((t=>{if(t instanceof s.GameObjects.Image){const i=32+50*e;t.setPosition(i,68),e++}})),this.setVisible(this.inventory.length>0);const i=Math.max((null==(t=this.text)?void 0:t.displayWidth)+18,50*e+12);this.setPosition(w.width-i-20,20),this.rect.setSize(i,102)}}class ne extends s.GameObjects.Image{constructor(t,i){super(t,w.width-50,w.height-55,"journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),e(this,"initialized",!1),this.player=i}createUI(){var t;this.initialized||(this.setScrollFactor(0).setDepth(L.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(w.width-21,w.height-89,20,20,11141120).setStrokeStyle(2,E(I)).setScrollFactor(0).setDepth(L.Ui2).setVisible(!1),null==(t=this.scene.input.keyboard)||t.on("keydown-J",(()=>{this.openJournal()})),this.initialized=!0)}addEntry(t,e){this.initialized||this.createUI(),this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new ie(this.scene,"New journal entry added!")),this.handleSideEffects(t,e||!1))}openJournal(){this.initialized||this.createUI(),0!==this.journal.length&&Q(this.scene,"JournalDialog")}handleSideEffects(t,e){const{warpAdd:i}=yt[t];if(i&&Ct(this.scene,i,!0),t===_.ClockFirstGear||t===_.ClockSecondGear){const t=Ot(this.scene,H.ClockTower);(null==t?void 0:t.clock)&&t.clock.updateHands()}t===_.SafeDiscovered&&function(t,e){const i=Et(t.scene,V.MansionPicture);e||t.setActive(!1),null==i||i.scene.tweens.add({targets:i,angle:97,duration:e?0:1500,onComplete:()=>{e||(t.setActive(!0),t.message.setDialog({messages:["A sturdy looking safe was hidden behind the picture.","It looks like it requires a special key to open."]},void 0,"player_portrait"))}})}(this.player,e)}}class oe extends s.GameObjects.Container{constructor(t,i){super(t,w.width-330-20,120),e(this,"player"),e(this,"quests",[]),e(this,"questRectangle"),e(this,"initialized",!1),this.player=i}createUI(){if(this.initialized)return;this.scene.add.existing(this),this.setScrollFactor(0).setDepth(L.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,330,60,E(k)).setStrokeStyle(2,E(x)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const t=this.scene.add.text(10,4,"Quests",{...z,fontSize:32});this.add(t),this.initialized=!0}addQuest(t,e){this.initialized||this.createUI(),this.quests.find((e=>e.id===t.id))||(this.quests.push(t),this.add(this.scene.add.text(0,0,gt[t.id].description,{...z,fontSize:20})),this.updateQuests(),e||new ie(this.scene,`New quest added: ${gt[t.id].description}`),this.handleSideEffects(t.id,t.completed))}updateExistingQuest(t,e){this.initialized||this.createUI();const i=this.quests.find((e=>e.id===t));i?(!i.completed&&e&&new ie(this.scene,`Quest completed: ${gt[i.id].description}`),i.completed=e,this.updateQuests(),this.handleSideEffects(t,e)):console.error(`Quest ${t} not found in player quests`)}updateQuests(){this.initialized||this.createUI();const t=this.quests.filter((t=>!t.completed));let e=1,i=0;this.getAll().forEach((n=>{if(n instanceof s.GameObjects.Text)if(t.find((t=>n.text===gt[t.id].description))||"Quests"===n.text){if("Quests"!==n.text){const t=14+30*e;n.setPosition(10,t),e++,i=Math.max(i,n.width)}}else n.destroy()}));const n=i+20;this.setX(w.width-20-n),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(n,50+30*t.length)}handleSideEffects(t,e){const{warpAdd:i,warpComplete:s}=gt[t];if(i&&Ct(this.scene,i,!0),e&&s&&Ct(this.scene,s,!0),t===U.FindPotionIngredients&&!e){const t=this.player.scene;t.interactiveObjects.add(new Nt(t,W.HerbGreen,this.player)),t.interactiveObjects.add(new Nt(t,W.HerbBlue,this.player))}}reset(){this.quests=[],this.updateQuests()}}const re=1.35*(w.fastMode?350:175),ae=new s.Math.Vector2(400,650);class le extends s.Physics.Arcade.Sprite{constructor(t){var i;super(t,ae.x,ae.y,"character",0),e(this,"scene"),e(this,"keys"),e(this,"light"),e(this,"debug"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"gameState"),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),this.scene=t,t.add.existing(this),t.physics.add.existing(this),w.debug&&this.setInteractive(),this.setBodySize(48,70).setOffset(40,10).setOrigin(.5,.65).setDepth(L.Player).setScale(1.35).setPipeline("Light2D").setPostPipeline("XRayPipeline"),w.debug?(this.light=new B(t,this.x,this.y,200,16768443,1),this.debug=t.add.circle(this.x,this.y,3,16711935).setDepth(L.Debug)):this.light=t.lights.addLight(this.x,this.y,200,16768443,1),(i=this).anims.create({key:"walk",frames:i.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:4,repeat:-1}),i.anims.play("walk"),this.keys=new ct(t),this.message=new ee(t,this),this.inventory=new se(t),this.quests=new oe(t,this),this.journal=new ne(t,this),this.gameState=new Xt(t,this)}update(t,e){var i,s,n;w.debug&&(this.setTint(this.interactive?16755370:16777215),this.debug.setPosition(this.x,this.y));const o=this.interactive&&!this.message.visible&&(null==(s=null==(i=this.buttonPrompt)?void 0:i.text)?void 0:s.length)>0||!1;o&&!this.buttonPrompt&&(this.buttonPrompt=new Yt(this.scene)),null==(n=this.buttonPrompt)||n.setVisible(o),this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity(),this.light.setPosition(this.x,this.y-20),function(t){var e;const i=(null==(e=t.body)?void 0:e.velocity.x)||0,s=i<0;Math.abs(i)>0?(t.anims.resume(),t.flipX=t.rewinding?!s:s):t.anims.pause(),t.setAngle(t.flipX?-5:5)}(this)}checkInteraction(){let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys.keys),t!==G.None&&(this.interactionTimeout=Date.now()+(this.interactive.interactionTimeout||500),this.keys.resetKeys(),t===G.Teleported&&(this.interactive=void 0))),t}updateVelocity(){const t=this.keys.keys;let e=1;!w.prod&&t[ht.Shift]&&(e=2);const i=re*e;t[ht.Left]&&this.setVelocityX(-i),t[ht.Right]&&this.setVelocityX(i),w.debug&&!this.interactive&&(t[ht.Up]&&this.setVelocityY(-i),t[ht.Down]&&this.setVelocityY(i)),t[ht.Left]&&t[ht.Right]&&this.setVelocityX(0)}record(){var t;this.history.length<1e3?this.history.push(new s.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(ae.x,ae.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e,i;this.interactive=t,(null==t?void 0:t.onCollided)&&t.onCollided();const s=null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t);s&&!this.buttonPrompt&&(this.buttonPrompt=new Yt(this.scene)),null==(i=this.buttonPrompt)||i.setText(s)}}const he="chrono-sleuth-save";var ce=(t=>(t[t.New=0]="New",t[t.Act1=1]="Act1",t[t.Act2=2]="Act2",t[t.LabItems=3]="LabItems",t[t.Act3=4]="Act3",t))(ce||{});const de={gamepad:!1,debug:!1,zoomed:!0},ue={0:{player:{x:ae.x,y:ae.y,flip:!1},journal:[],inventory:[],quests:[],gameState:{...Kt},settings:{gamepad:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t))),debug:!1,zoomed:!0}},1:{player:{x:ae.x,y:ae.y,flip:!1},journal:[_.FixTheClock],inventory:[{type:W.Wrench,used:!1},{type:W.Gear1,used:!1}],quests:[{id:U.ForestGear,completed:!1},{id:U.SphinxRiddle,completed:!0}],gameState:{...Kt,mazeSolved:!0,sphinxMoved:!0},settings:{...de}},2:{player:{x:-770,y:ae.y,flip:!0},journal:[_.FixTheClock,_.MetTheMayor,_.ClockFirstGear],inventory:[{type:W.Wrench,used:!1},{type:W.Gear1,used:!0}],quests:[{id:U.ForestGear,completed:!0},{id:U.SphinxRiddle,completed:!0},{id:U.InvestigateTownWest,completed:!1}],gameState:{...Kt,mazeSolved:!0,sphinxMoved:!0},settings:{...de}},3:{player:{x:-1500,y:1729,flip:!0},journal:[_.FixTheClock,_.MetTheMayor,_.ClockFirstGear,_.AlchemyLabFound,_.AlchemySetFixed],inventory:[{type:W.Wrench,used:!1},{type:W.Gear1,used:!0},{type:W.Key,used:!0}],quests:[{id:U.ForestGear,completed:!0},{id:U.SphinxRiddle,completed:!0},{id:U.InvestigateTownWest,completed:!1},{id:U.ExploreLab,completed:!1},{id:U.FindPotionIngredients,completed:!1}],gameState:{...Kt},settings:{...de}},4:{player:{x:5073.875,y:915,flip:!1},journal:[_.FixTheClock,_.MetTheMayor,_.ClockFirstGear,_.AlchemyLabFound,_.AlchemySetFixed,_.SafeDiscovered,_.ExtraPotionInformation,_.ClockSecondGear],inventory:[{type:W.Wrench,used:!1},{type:W.Gear1,used:!0},{type:W.Key,used:!0},{type:W.HerbRed,used:!0},{type:W.HerbGreen,used:!0},{type:W.HerbBlue,used:!0},{type:W.Potion,used:!0},{type:W.Gear2,used:!0}],quests:[{id:U.ForestGear,completed:!0},{id:U.SphinxRiddle,completed:!0},{id:U.InvestigateTownWest,completed:!0},{id:U.ExploreLab,completed:!0},{id:U.FindPotionIngredients,completed:!0}],gameState:{...Kt,mazeSolved:!0,sphinxMoved:!0},settings:{...de}}};var pe,ye,ge=Object.prototype.toString,fe=function(t){var e=ge.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===ge.call(t.callee)),i},me=Array.prototype.slice,be=fe,ve=Object.keys,we=ve?function(t){return ve(t)}:function(){if(ye)return pe;var t;if(ye=1,!Object.keys){var e=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=fe,n=Object.prototype.propertyIsEnumerable,o=!n.call({toString:null},"toString"),r=n.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var e=t.constructor;return e&&e.prototype===t},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!h["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(i){return!0}}catch(i){return!0}return!1}();t=function(t){var n=null!==t&&"object"==typeof t,h="[object Function]"===i.call(t),d=s(t),u=n&&"[object String]"===i.call(t),p=[];if(!n&&!h&&!d)throw new TypeError("Object.keys called on a non-object");var y=r&&h;if(u&&t.length>0&&!e.call(t,0))for(var g=0;g<t.length;++g)p.push(String(g));if(d&&t.length>0)for(var f=0;f<t.length;++f)p.push(String(f));else for(var m in t)y&&"prototype"===m||!e.call(t,m)||p.push(String(m));if(o)for(var b=function(t){if("undefined"==typeof window||!c)return l(t);try{return l(t)}catch(e){return!1}}(t),v=0;v<a.length;++v)b&&"constructor"===a[v]||!e.call(t,a[v])||p.push(a[v]);return p}}return pe=t}(),xe=Object.keys;we.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return be(t)?xe(me.call(t)):xe(t)})}else Object.keys=we;return Object.keys||we};var Se,ke=we,Ie=Error,Pe=EvalError,Te=RangeError,je=ReferenceError,Ce=SyntaxError,Oe=TypeError,Ae=URIError,Ee=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var s=Object.getOwnPropertySymbols(t);if(1!==s.length||s[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0},Me="undefined"!=typeof Symbol&&Symbol,Fe=Ee,ze=function(){return"function"==typeof Me&&"function"==typeof Symbol&&"symbol"==typeof Me("foo")&&"symbol"==typeof Symbol("bar")&&Fe()},De={__proto__:null,foo:{}},Le=Object,Be=Object.prototype.toString,Ge=Math.max,Re=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i},We=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||"[object Function]"!==Be.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var i,s=function(t){for(var e=[],i=1,s=0;i<t.length;i+=1,s+=1)e[s]=t[i];return e}(arguments),n=Ge(0,e.length-s.length),o=[],r=0;r<n;r++)o[r]="$"+r;if(i=Function("binder","return function ("+function(t){for(var e="",i=0;i<t.length;i+=1)e+=t[i],i+1<t.length&&(e+=",");return e}(o)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=e.apply(this,Re(s,arguments));return Object(n)===n?n:this}return e.apply(t,Re(s,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,i.prototype=new a,a.prototype=null}return i},Ue=Function.prototype.call,He=Object.prototype.hasOwnProperty,Ne=We.call(Ue,He),_e=Ie,Ve=Pe,$e=Te,qe=je,Ke=Ce,Xe=Oe,Ye=Ae,Qe=Function,Je=function(t){try{return Qe('"use strict"; return ('+t+").constructor;")()}catch(e){}},Ze=Object.getOwnPropertyDescriptor;if(Ze)try{Ze({},"")}catch(Zh){Ze=null}var ti=function(){throw new Xe},ei=Ze?function(){try{return ti}catch(t){try{return Ze(arguments,"callee").get}catch(e){return ti}}}():ti,ii=ze(),si={__proto__:De}.foo===De.foo&&!(De instanceof Le),ni=Object.getPrototypeOf||(si?function(t){return t.__proto__}:null),oi={},ri="undefined"!=typeof Uint8Array&&ni?ni(Uint8Array):Se,ai={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?Se:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?Se:ArrayBuffer,"%ArrayIteratorPrototype%":ii&&ni?ni([][Symbol.iterator]()):Se,"%AsyncFromSyncIteratorPrototype%":Se,"%AsyncFunction%":oi,"%AsyncGenerator%":oi,"%AsyncGeneratorFunction%":oi,"%AsyncIteratorPrototype%":oi,"%Atomics%":"undefined"==typeof Atomics?Se:Atomics,"%BigInt%":"undefined"==typeof BigInt?Se:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?Se:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?Se:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?Se:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":_e,"%eval%":eval,"%EvalError%":Ve,"%Float32Array%":"undefined"==typeof Float32Array?Se:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?Se:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?Se:FinalizationRegistry,"%Function%":Qe,"%GeneratorFunction%":oi,"%Int8Array%":"undefined"==typeof Int8Array?Se:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?Se:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?Se:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ii&&ni?ni(ni([][Symbol.iterator]())):Se,"%JSON%":"object"==typeof JSON?JSON:Se,"%Map%":"undefined"==typeof Map?Se:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&ii&&ni?ni((new Map)[Symbol.iterator]()):Se,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?Se:Promise,"%Proxy%":"undefined"==typeof Proxy?Se:Proxy,"%RangeError%":$e,"%ReferenceError%":qe,"%Reflect%":"undefined"==typeof Reflect?Se:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?Se:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&ii&&ni?ni((new Set)[Symbol.iterator]()):Se,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?Se:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ii&&ni?ni(""[Symbol.iterator]()):Se,"%Symbol%":ii?Symbol:Se,"%SyntaxError%":Ke,"%ThrowTypeError%":ei,"%TypedArray%":ri,"%TypeError%":Xe,"%Uint8Array%":"undefined"==typeof Uint8Array?Se:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?Se:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?Se:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?Se:Uint32Array,"%URIError%":Ye,"%WeakMap%":"undefined"==typeof WeakMap?Se:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?Se:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?Se:WeakSet};if(ni)try{null.error}catch(Zh){var li=ni(ni(Zh));ai["%Error.prototype%"]=li}var hi=function t(e){var i;if("%AsyncFunction%"===e)i=Je("async function () {}");else if("%GeneratorFunction%"===e)i=Je("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=Je("async function* () {}");else if("%AsyncGenerator%"===e){var s=t("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&ni&&(i=ni(n.prototype))}return ai[e]=i,i},ci={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},di=We,ui=Ne,pi=di.call(Function.call,Array.prototype.concat),yi=di.call(Function.apply,Array.prototype.splice),gi=di.call(Function.call,String.prototype.replace),fi=di.call(Function.call,String.prototype.slice),mi=di.call(Function.call,RegExp.prototype.exec),bi=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,vi=/\\(\\)?/g,wi=function(t,e){var i,s=t;if(ui(ci,s)&&(s="%"+(i=ci[s])[0]+"%"),ui(ai,s)){var n=ai[s];if(n===oi&&(n=hi(s)),void 0===n&&!e)throw new Xe("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:n}}throw new Ke("intrinsic "+t+" does not exist!")},xi=function(t,e){if("string"!=typeof t||0===t.length)throw new Xe("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new Xe('"allowMissing" argument must be a boolean');if(null===mi(/^%?[^%]*%?$/,t))throw new Ke("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=fi(t,0,1),i=fi(t,-1);if("%"===e&&"%"!==i)throw new Ke("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new Ke("invalid intrinsic syntax, expected opening `%`");var s=[];return gi(t,bi,(function(t,e,i,n){s[s.length]=i?gi(n,vi,"$1"):e||t})),s}(t),s=i.length>0?i[0]:"",n=wi("%"+s+"%",e),o=n.name,r=n.value,a=!1,l=n.alias;l&&(s=l[0],yi(i,pi([0,1],l)));for(var h=1,c=!0;h<i.length;h+=1){var d=i[h],u=fi(d,0,1),p=fi(d,-1);if(('"'===u||"'"===u||"`"===u||'"'===p||"'"===p||"`"===p)&&u!==p)throw new Ke("property names with quotes must have matching quotes");if("constructor"!==d&&c||(a=!0),ui(ai,o="%"+(s+="."+d)+"%"))r=ai[o];else if(null!=r){if(!(d in r)){if(!e)throw new Xe("base intrinsic for "+t+" exists, but the property is not available.");return}if(Ze&&h+1>=i.length){var y=Ze(r,d);r=(c=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:r[d]}else c=ui(r,d),r=r[d];c&&!a&&(ai[o]=r)}}return r},Si=xi("%Object.defineProperty%",!0)||!1;if(Si)try{Si({},"a",{value:1})}catch(Zh){Si=!1}var ki=Si,Ii=xi("%Object.getOwnPropertyDescriptor%",!0);if(Ii)try{Ii([],"length")}catch(Zh){Ii=null}var Pi=Ii,Ti=ki,ji=Ce,Ci=Oe,Oi=Pi,Ai=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Ci("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new Ci("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Ci("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Ci("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Ci("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Ci("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,r=arguments.length>6&&arguments[6],a=!!Oi&&Oi(t,e);if(Ti)Ti(t,e,{configurable:null===o&&a?a.configurable:!o,enumerable:null===s&&a?a.enumerable:!s,value:i,writable:null===n&&a?a.writable:!n});else{if(!r&&(s||n||o))throw new ji("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}},Ei=ki,Mi=function(){return!!Ei};Mi.hasArrayLengthDefineBug=function(){if(!Ei)return null;try{return 1!==Ei([],"length",{value:1}).length}catch(Zh){return!0}};var Fi=Mi,zi=ke,Di="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Li=Object.prototype.toString,Bi=Array.prototype.concat,Gi=Ai,Ri=Fi(),Wi=function(t,e,i,s){if(e in t)if(!0===s){if(t[e]===i)return}else if("function"!=typeof(n=s)||"[object Function]"!==Li.call(n)||!s())return;var n;Ri?Gi(t,e,i,!0):Gi(t,e,i)},Ui=function(t,e){var i=arguments.length>2?arguments[2]:{},s=zi(e);Di&&(s=Bi.call(s,Object.getOwnPropertySymbols(e)));for(var n=0;n<s.length;n+=1)Wi(t,s[n],e[s[n]],i[s[n]])};Ui.supportsDescriptors=!!Ri;var Hi=Ui,Ni={exports:{}},_i=xi,Vi=Ai,$i=Fi(),qi=Pi,Ki=Oe,Xi=_i("%Math.floor%"),Yi=function(t,e){if("function"!=typeof t)throw new Ki("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||Xi(e)!==e)throw new Ki("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in t&&qi){var o=qi(t,"length");o&&!o.configurable&&(s=!1),o&&!o.writable&&(n=!1)}return(s||n||!i)&&($i?Vi(t,"length",e,!0,!0):Vi(t,"length",e)),t};!function(t){var e=We,i=xi,s=Yi,n=Oe,o=i("%Function.prototype.apply%"),r=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||e.call(r,o),l=ki,h=i("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new n("a function is required");var i=a(e,r,arguments);return s(i,1+h(0,t.length-(arguments.length-1)),!0)};var c=function(){return a(e,o,arguments)};l?l(t.exports,"apply",{value:c}):t.exports.apply=c}(Ni);var Qi=Ni.exports,Ji=xi,Zi=Qi,ts=Zi(Ji("String.prototype.indexOf")),es=function(t,e){var i=Ji(t,!!e);return"function"==typeof i&&ts(t,".prototype.")>-1?Zi(i):i},is=ke,ss=Ee(),ns=es,os=Object,rs=ns("Array.prototype.push"),as=ns("Object.prototype.propertyIsEnumerable"),ls=ss?Object.getOwnPropertySymbols:null,hs=function(t,e){if(null==t)throw new TypeError("target must be an object");var i=os(t);if(1===arguments.length)return i;for(var s=1;s<arguments.length;++s){var n=os(arguments[s]),o=is(n),r=ss&&(Object.getOwnPropertySymbols||ls);if(r)for(var a=r(n),l=0;l<a.length;++l){var h=a[l];as(n,h)&&rs(o,h)}for(var c=0;c<o.length;++c){var d=o[c];if(as(n,d)){var u=n[d];i[d]=u}}}return i},cs=hs,ds=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},s=0;s<e.length;++s)i[e[s]]=e[s];var n=Object.assign({},i),o="";for(var r in n)o+=r;return t!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(Zh){return"y"===t[1]}return!1}()?cs:Object.assign:cs},us=Hi,ps=ds,ys=Hi,gs=hs,fs=ds,ms=Qi.apply(fs()),bs=function(t,e){return ms(Object,arguments)};ys(bs,{getPolyfill:fs,implementation:gs,shim:function(){var t=ps();return us(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var vs=bs,ws=function(){return"string"==typeof function(){}.name},xs=Object.getOwnPropertyDescriptor;if(xs)try{xs([],"length")}catch(Zh){xs=null}ws.functionsHaveConfigurableNames=function(){if(!ws()||!xs)return!1;var t=xs((function(){}),"name");return!!t&&!!t.configurable};var Ss=Function.prototype.bind;ws.boundFunctionsHaveNames=function(){return ws()&&"function"==typeof Ss&&""!==function(){}.bind().name};var ks=ws,Is=Ai,Ps=Fi(),Ts=ks.functionsHaveConfigurableNames(),js=Oe,Cs=Oe,Os=Object,As=function(t,e){if("function"!=typeof t)throw new js("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!Ts||(Ps?Is(t,"name",e,!0,!0):Is(t,"name",e)),t}((function(){if(null==this||this!==Os(this))throw new Cs("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0),Es=As,Ms=Hi.supportsDescriptors,Fs=Object.getOwnPropertyDescriptor,zs=function(){if(Ms&&"gim"===/a/gim.flags){var t=Fs(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return Es},Ds=Hi.supportsDescriptors,Ls=zs,Bs=Object.getOwnPropertyDescriptor,Gs=Object.defineProperty,Rs=TypeError,Ws=Object.getPrototypeOf,Us=/a/,Hs=Hi,Ns=As,_s=zs,Vs=Qi(_s());Hs(Vs,{getPolyfill:_s,implementation:Ns,shim:function(){if(!Ds||!Ws)throw new Rs("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Ls(),e=Ws(Us),i=Bs(e,"flags");return i&&i.get===t||Gs(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var $s=Vs,qs={exports:{}},Ks=Ee,Xs=function(){return Ks()&&!!Symbol.toStringTag},Ys=Xs(),Qs=es("Object.prototype.toString"),Js=function(t){return!(Ys&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===Qs(t)},Zs=function(t){return!!Js(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==Qs(t)&&"[object Function]"===Qs(t.callee)},tn=function(){return Js(arguments)}();Js.isLegacyArguments=Zs;var en=tn?Js:Zs;const sn=n(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var nn="function"==typeof Map&&Map.prototype,on=Object.getOwnPropertyDescriptor&&nn?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,rn=nn&&on&&"function"==typeof on.get?on.get:null,an=nn&&Map.prototype.forEach,ln="function"==typeof Set&&Set.prototype,hn=Object.getOwnPropertyDescriptor&&ln?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,cn=ln&&hn&&"function"==typeof hn.get?hn.get:null,dn=ln&&Set.prototype.forEach,un="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,pn="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,yn="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,gn=Boolean.prototype.valueOf,fn=Object.prototype.toString,mn=Function.prototype.toString,bn=String.prototype.match,vn=String.prototype.slice,wn=String.prototype.replace,xn=String.prototype.toUpperCase,Sn=String.prototype.toLowerCase,kn=RegExp.prototype.test,In=Array.prototype.concat,Pn=Array.prototype.join,Tn=Array.prototype.slice,jn=Math.floor,Cn="function"==typeof BigInt?BigInt.prototype.valueOf:null,On=Object.getOwnPropertySymbols,An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,En="function"==typeof Symbol&&"object"==typeof Symbol.iterator,Mn="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,Fn=Object.prototype.propertyIsEnumerable,zn=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Dn(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||kn.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var s=t<0?-jn(-t):jn(t);if(s!==t){var n=String(s),o=vn.call(e,n.length+1);return wn.call(n,i,"$&_")+"."+wn.call(wn.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return wn.call(e,i,"$&_")}var Ln=sn,Bn=Ln.custom,Gn=Nn(Bn)?Bn:null;function Rn(t,e,i){var s="double"===(i.quoteStyle||e)?'"':"'";return s+t+s}function Wn(t){return wn.call(String(t),/"/g,"&quot;")}function Un(t){return!("[object Array]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}function Hn(t){return!("[object RegExp]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}function Nn(t){if(En)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!An)return!1;try{return An.call(t),!0}catch(Zh){}return!1}var _n=Object.prototype.hasOwnProperty||function(t){return t in this};function Vn(t,e){return _n.call(t,e)}function $n(t){return fn.call(t)}function qn(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,s=t.length;i<s;i++)if(t[i]===e)return i;return-1}function Kn(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,s="... "+i+" more character"+(i>1?"s":"");return Kn(vn.call(t,0,e.maxStringLength),e)+s}return Rn(wn.call(wn.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Xn),"single",e)}function Xn(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+xn.call(e.toString(16))}function Yn(t){return"Object("+t+")"}function Qn(t){return t+" { ? }"}function Jn(t,e,i,s){return t+" ("+e+") {"+(s?Zn(i,s):Pn.call(i,", "))+"}"}function Zn(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+Pn.call(t,","+i)+"\n"+e.prev}function to(t,e){var i=Un(t),s=[];if(i){s.length=t.length;for(var n=0;n<t.length;n++)s[n]=Vn(t,n)?e(t[n],t):""}var o,r="function"==typeof On?On(t):[];if(En){o={};for(var a=0;a<r.length;a++)o["$"+r[a]]=r[a]}for(var l in t)Vn(t,l)&&(i&&String(Number(l))===l&&l<t.length||En&&o["$"+l]instanceof Symbol||(kn.call(/[^\w$]/,l)?s.push(e(l,t)+": "+e(t[l],t)):s.push(l+": "+e(t[l],t))));if("function"==typeof On)for(var h=0;h<r.length;h++)Fn.call(t,r[h])&&s.push("["+e(r[h])+"]: "+e(t[r[h]],t));return s}var eo=xi,io=es,so=function t(e,i,s,n){var r=i||{};if(Vn(r,"quoteStyle")&&"single"!==r.quoteStyle&&"double"!==r.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Vn(r,"maxStringLength")&&("number"==typeof r.maxStringLength?r.maxStringLength<0&&r.maxStringLength!==1/0:null!==r.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!Vn(r,"customInspect")||r.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Vn(r,"indent")&&null!==r.indent&&"\t"!==r.indent&&!(parseInt(r.indent,10)===r.indent&&r.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Vn(r,"numericSeparator")&&"boolean"!=typeof r.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=r.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return Kn(e,r);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var h=String(e);return l?Dn(e,h):h}if("bigint"==typeof e){var c=String(e)+"n";return l?Dn(e,c):c}var d=void 0===r.depth?5:r.depth;if(void 0===s&&(s=0),s>=d&&d>0&&"object"==typeof e)return Un(e)?"[Array]":"[Object]";var u,p=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=Pn.call(Array(t.indent+1)," ")}return{base:i,prev:Pn.call(Array(e+1),i)}}(r,s);if(void 0===n)n=[];else if(qn(n,e)>=0)return"[Circular]";function y(e,i,o){if(i&&(n=Tn.call(n)).push(i),o){var a={depth:r.depth};return Vn(r,"quoteStyle")&&(a.quoteStyle=r.quoteStyle),t(e,a,s+1,n)}return t(e,r,s+1,n)}if("function"==typeof e&&!Hn(e)){var g=function(t){if(t.name)return t.name;var e=bn.call(mn.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),f=to(e,y);return"[Function"+(g?": "+g:" (anonymous)")+"]"+(f.length>0?" { "+Pn.call(f,", ")+" }":"")}if(Nn(e)){var m=En?wn.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):An.call(e);return"object"!=typeof e||En?m:Yn(m)}if((u=e)&&"object"==typeof u&&("undefined"!=typeof HTMLElement&&u instanceof HTMLElement||"string"==typeof u.nodeName&&"function"==typeof u.getAttribute)){for(var b="<"+Sn.call(String(e.nodeName)),v=e.attributes||[],w=0;w<v.length;w++)b+=" "+v[w].name+"="+Rn(Wn(v[w].value),"double",r);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+"</"+Sn.call(String(e.nodeName))+">"}if(Un(e)){if(0===e.length)return"[]";var x=to(e,y);return p&&!function(t){for(var e=0;e<t.length;e++)if(qn(t[e],"\n")>=0)return!1;return!0}(x)?"["+Zn(x,p)+"]":"[ "+Pn.call(x,", ")+" ]"}if(function(t){return!("[object Error]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}(e)){var S=to(e,y);return"cause"in Error.prototype||!("cause"in e)||Fn.call(e,"cause")?0===S.length?"["+String(e)+"]":"{ ["+String(e)+"] "+Pn.call(S,", ")+" }":"{ ["+String(e)+"] "+Pn.call(In.call("[cause]: "+y(e.cause),S),", ")+" }"}if("object"==typeof e&&a){if(Gn&&"function"==typeof e[Gn]&&Ln)return Ln(e,{depth:d-s});if("symbol"!==a&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!rn||!t||"object"!=typeof t)return!1;try{rn.call(t);try{cn.call(t)}catch(b){return!0}return t instanceof Map}catch(Zh){}return!1}(e)){var k=[];return an&&an.call(e,(function(t,i){k.push(y(i,e,!0)+" => "+y(t,e))})),Jn("Map",rn.call(e),k,p)}if(function(t){if(!cn||!t||"object"!=typeof t)return!1;try{cn.call(t);try{rn.call(t)}catch(e){return!0}return t instanceof Set}catch(Zh){}return!1}(e)){var I=[];return dn&&dn.call(e,(function(t){I.push(y(t,e))})),Jn("Set",cn.call(e),I,p)}if(function(t){if(!un||!t||"object"!=typeof t)return!1;try{un.call(t,un);try{pn.call(t,pn)}catch(b){return!0}return t instanceof WeakMap}catch(Zh){}return!1}(e))return Qn("WeakMap");if(function(t){if(!pn||!t||"object"!=typeof t)return!1;try{pn.call(t,pn);try{un.call(t,un)}catch(b){return!0}return t instanceof WeakSet}catch(Zh){}return!1}(e))return Qn("WeakSet");if(function(t){if(!yn||!t||"object"!=typeof t)return!1;try{return yn.call(t),!0}catch(Zh){}return!1}(e))return Qn("WeakRef");if(function(t){return!("[object Number]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}(e))return Yn(y(Number(e)));if(function(t){if(!t||"object"!=typeof t||!Cn)return!1;try{return Cn.call(t),!0}catch(Zh){}return!1}(e))return Yn(y(Cn.call(e)));if(function(t){return!("[object Boolean]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}(e))return Yn(gn.call(e));if(function(t){return!("[object String]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}(e))return Yn(y(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==o&&e===o)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==$n(t)||Mn&&"object"==typeof t&&Mn in t)}(e)&&!Hn(e)){var P=to(e,y),T=zn?zn(e)===Object.prototype:e instanceof Object||e.constructor===Object,j=e instanceof Object?"":"null prototype",C=!T&&Mn&&Object(e)===e&&Mn in e?vn.call($n(e),8,-1):j?"Object":"",O=(T||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(C||j?"["+Pn.call(In.call([],C||[],j||[]),": ")+"] ":"");return 0===P.length?O+"{}":p?O+"{"+Zn(P,p)+"}":O+"{ "+Pn.call(P,", ")+" }"}return String(e)},no=Oe,oo=eo("%WeakMap%",!0),ro=eo("%Map%",!0),ao=io("WeakMap.prototype.get",!0),lo=io("WeakMap.prototype.set",!0),ho=io("WeakMap.prototype.has",!0),co=io("Map.prototype.get",!0),uo=io("Map.prototype.set",!0),po=io("Map.prototype.has",!0),yo=function(t,e){for(var i,s=t;null!==(i=s.next);s=i)if(i.key===e)return s.next=i.next,i.next=t.next,t.next=i,i},go=function(){var t,e,i,s={assert:function(t){if(!s.has(t))throw new no("Side channel does not contain "+so(t))},get:function(s){if(oo&&s&&("object"==typeof s||"function"==typeof s)){if(t)return ao(t,s)}else if(ro){if(e)return co(e,s)}else if(i)return function(t,e){var i=yo(t,e);return i&&i.value}(i,s)},has:function(s){if(oo&&s&&("object"==typeof s||"function"==typeof s)){if(t)return ho(t,s)}else if(ro){if(e)return po(e,s)}else if(i)return function(t,e){return!!yo(t,e)}(i,s);return!1},set:function(s,n){oo&&s&&("object"==typeof s||"function"==typeof s)?(t||(t=new oo),lo(t,s,n)):ro?(e||(e=new ro),uo(e,s,n)):(i||(i={key:{},next:null}),function(t,e,i){var s=yo(t,e);s?s.value=i:t.next={key:e,next:t.next,value:i}}(i,s,n))}};return s},fo=Ne,mo=go(),bo=Oe,vo={assert:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new bo("`O` is not an object");if("string"!=typeof e)throw new bo("`slot` must be a string");if(mo.assert(t),!vo.has(t,e))throw new bo("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new bo("`O` is not an object");if("string"!=typeof e)throw new bo("`slot` must be a string");var i=mo.get(t);return i&&i["$"+e]},has:function(t,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new bo("`O` is not an object");if("string"!=typeof e)throw new bo("`slot` must be a string");var i=mo.get(t);return!!i&&fo(i,"$"+e)},set:function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new bo("`O` is not an object");if("string"!=typeof e)throw new bo("`slot` must be a string");var s=mo.get(t);s||(s={},mo.set(t,s)),s["$"+e]=i}};Object.freeze&&Object.freeze(vo);var wo,xo=vo,So=SyntaxError,ko="object"==typeof StopIteration?StopIteration:null,Io={}.toString,Po=Array.isArray||function(t){return"[object Array]"==Io.call(t)},To=String.prototype.valueOf,jo=Object.prototype.toString,Co=Xs(),Oo=function(t){return"string"==typeof t||"object"==typeof t&&(Co?function(t){try{return To.call(t),!0}catch(Zh){return!1}}(t):"[object String]"===jo.call(t))},Ao="function"==typeof Map&&Map.prototype?Map:null,Eo="function"==typeof Set&&Set.prototype?Set:null;Ao||(wo=function(t){return!1});var Mo=Ao?Map.prototype.has:null,Fo=Eo?Set.prototype.has:null;wo||Mo||(wo=function(t){return!1});var zo,Do=wo||function(t){if(!t||"object"!=typeof t)return!1;try{if(Mo.call(t),Fo)try{Fo.call(t)}catch(Zh){return!0}return t instanceof Ao}catch(Zh){}return!1},Lo="function"==typeof Map&&Map.prototype?Map:null,Bo="function"==typeof Set&&Set.prototype?Set:null;Bo||(zo=function(t){return!1});var Go=Lo?Map.prototype.has:null,Ro=Bo?Set.prototype.has:null;zo||Ro||(zo=function(t){return!1});var Wo=zo||function(t){if(!t||"object"!=typeof t)return!1;try{if(Ro.call(t),Go)try{Go.call(t)}catch(Zh){return!0}return t instanceof Bo}catch(Zh){}return!1},Uo=en,Ho=function(t){if(!ko)throw new So("this environment lacks StopIteration");xo.set(t,"[[Done]]",!1);var e={next:function(){var t=xo.get(this,"[[Iterator]]"),e=xo.get(t,"[[Done]]");try{return{done:e,value:e?void 0:t.next()}}catch(Zh){if(xo.set(t,"[[Done]]",!0),Zh!==ko)throw Zh;return{done:!0,value:void 0}}}};return xo.set(e,"[[Iterator]]",t),e};if(ze()||Ee()){var No=Symbol.iterator;qs.exports=function(t){return null!=t&&void 0!==t[No]?t[No]():Uo(t)?Array.prototype[No].call(t):void 0}}else{var _o=Po,Vo=Oo,$o=xi,qo=$o("%Map%",!0),Ko=$o("%Set%",!0),Xo=es,Yo=Xo("Array.prototype.push"),Qo=Xo("String.prototype.charCodeAt"),Jo=Xo("String.prototype.slice"),Zo=function(t){var e=0;return{next:function(){var i,s=e>=t.length;return s||(i=t[e],e+=1),{done:s,value:i}}}},tr=function(t,e){if(_o(t)||Uo(t))return Zo(t);if(Vo(t)){var i=0;return{next:function(){var e=function(t,e){if(e+1>=t.length)return e+1;var i=Qo(t,e);if(i<55296||i>56319)return e+1;var s=Qo(t,e+1);return s<56320||s>57343?e+1:e+2}(t,i),s=Jo(t,i,e);return i=e,{done:e>t.length,value:s}}}}return e&&void 0!==t["_es6-shim iterator_"]?t["_es6-shim iterator_"]():void 0};if(qo||Ko){var er=Do,ir=Wo,sr=Xo("Map.prototype.forEach",!0),nr=Xo("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var or=Xo("Map.prototype.iterator",!0),rr=Xo("Set.prototype.iterator",!0);var ar=Xo("Map.prototype.@@iterator",!0)||Xo("Map.prototype._es6-shim iterator_",!0),lr=Xo("Set.prototype.@@iterator",!0)||Xo("Set.prototype._es6-shim iterator_",!0);qs.exports=function(t){return function(t){if(er(t)){if(or)return Ho(or(t));if(ar)return ar(t);if(sr){var e=[];return sr(t,(function(t,i){Yo(e,[i,t])})),Zo(e)}}if(ir(t)){if(rr)return Ho(rr(t));if(lr)return lr(t);if(nr){var i=[];return nr(t,(function(t){Yo(i,t)})),Zo(i)}}}(t)||tr(t)}}else qs.exports=function(t){if(null!=t)return tr(t,!0)}}var hr=qs.exports,cr=function(t){return t!=t},dr=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!cr(t)||!cr(e))},ur=dr,pr=function(){return"function"==typeof Object.is?Object.is:ur},yr=pr,gr=Hi,fr=Hi,mr=dr,br=pr,vr=Qi(br(),Object);fr(vr,{getPolyfill:br,implementation:mr,shim:function(){var t=yr();return gr(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var wr,xr,Sr,kr,Ir=vr,Pr=Qi,Tr=es,jr=xi("%ArrayBuffer%",!0),Cr=Tr("ArrayBuffer.prototype.byteLength",!0),Or=Tr("Object.prototype.toString"),Ar=!!jr&&!Cr&&new jr(0).slice,Er=!!Ar&&Pr(Ar),Mr=Cr||Er?function(t){if(!t||"object"!=typeof t)return!1;try{return Cr?Cr(t):Er(t,0),!0}catch(Zh){return!1}}:jr?function(t){return"[object ArrayBuffer]"===Or(t)}:function(t){return!1},Fr=Date.prototype.getDay,zr=Object.prototype.toString,Dr=Xs(),Lr=es,Br=Xs();if(Br){wr=Lr("Object.prototype.hasOwnProperty"),xr=Lr("RegExp.prototype.exec"),Sr={};var Gr=function(){throw Sr};kr={toString:Gr,valueOf:Gr},"symbol"==typeof Symbol.toPrimitive&&(kr[Symbol.toPrimitive]=Gr)}var Rr=Lr("Object.prototype.toString"),Wr=Object.getOwnPropertyDescriptor,Ur=Br?function(t){if(!t||"object"!=typeof t)return!1;var e=Wr(t,"lastIndex");if(!e||!wr(e,"value"))return!1;try{xr(t,kr)}catch(Zh){return Zh===Sr}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===Rr(t)},Hr=es("SharedArrayBuffer.prototype.byteLength",!0),Nr=Hr?function(t){if(!t||"object"!=typeof t)return!1;try{return Hr(t),!0}catch(Zh){return!1}}:function(t){return!1},_r=Number.prototype.toString,Vr=Object.prototype.toString,$r=Xs(),qr=es,Kr=qr("Boolean.prototype.toString"),Xr=qr("Object.prototype.toString"),Yr=Xs(),Qr={exports:{}},Jr=Object.prototype.toString;if(ze()){var Zr=Symbol.prototype.toString,ta=/^Symbol\(.*\)$/;Qr.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==Jr.call(t))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&ta.test(Zr.call(t))}(t)}catch(Zh){return!1}}}else Qr.exports=function(t){return!1};var ea=Qr.exports,ia={exports:{}},sa="undefined"!=typeof BigInt&&BigInt;if("function"==typeof sa&&"function"==typeof BigInt&&"bigint"==typeof sa(42)&&"bigint"==typeof BigInt(42)){var na=BigInt.prototype.valueOf;ia.exports=function(t){return null!=t&&"boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t&&"symbol"!=typeof t&&"function"!=typeof t&&("bigint"==typeof t||function(t){try{return na.call(t),!0}catch(Zh){}return!1}(t))}}else ia.exports=function(t){return!1};var oa,ra=ia.exports,aa=Oo,la=ea,ha=ra,ca="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,da="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;ca||(oa=function(t){return!1});var ua=ca?ca.prototype.has:null,pa=da?da.prototype.has:null;oa||ua||(oa=function(t){return!1});var ya=oa||function(t){if(!t||"object"!=typeof t)return!1;try{if(ua.call(t,ua),pa)try{pa.call(t,pa)}catch(Zh){return!0}return t instanceof ca}catch(Zh){}return!1},ga={exports:{}},fa=es,ma=xi("%WeakSet%",!0),ba=fa("WeakSet.prototype.has",!0);if(ba){var va=fa("WeakMap.prototype.has",!0);ga.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(ba(t,ba),va)try{va(t,va)}catch(Zh){return!0}return t instanceof ma}catch(Zh){}return!1}}else ga.exports=function(t){return!1};var wa,xa,Sa=ga.exports,ka=Do,Ia=Wo,Pa=ya,Ta=Sa,ja=Function.prototype.toString,Ca="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof Ca&&"function"==typeof Object.defineProperty)try{wa=Object.defineProperty({},"length",{get:function(){throw xa}}),xa={},Ca((function(){throw 42}),null,wa)}catch(tc){tc!==xa&&(Ca=null)}else Ca=null;var Oa=/^\s*class\b/,Aa=function(t){try{var e=ja.call(t);return Oa.test(e)}catch(Zh){return!1}},Ea=function(t){try{return!Aa(t)&&(ja.call(t),!0)}catch(Zh){return!1}},Ma=Object.prototype.toString,Fa="function"==typeof Symbol&&!!Symbol.toStringTag,za=!(0 in[,]),Da=function(){return!1};if("object"==typeof document){var La=document.all;Ma.call(La)===Ma.call(document.all)&&(Da=function(t){if((za||!t)&&(void 0===t||"object"==typeof t))try{var e=Ma.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(Zh){}return!1})}var Ba=Ca?function(t){if(Da(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{Ca(t,null,wa)}catch(Zh){if(Zh!==xa)return!1}return!Aa(t)&&Ea(t)}:function(t){if(Da(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(Fa)return Ea(t);if(Aa(t))return!1;var e=Ma.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&Ea(t)},Ga=Object.prototype.toString,Ra=Object.prototype.hasOwnProperty,Wa=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Ua="undefined"==typeof globalThis?o:globalThis,Ha=function(t,e,i){if(!Ba(e))throw new TypeError("iterator must be a function");var s;arguments.length>=3&&(s=i),"[object Array]"===Ga.call(t)?function(t,e,i){for(var s=0,n=t.length;s<n;s++)Ra.call(t,s)&&(null==i?e(t[s],s,t):e.call(i,t[s],s,t))}(t,e,s):"string"==typeof t?function(t,e,i){for(var s=0,n=t.length;s<n;s++)null==i?e(t.charAt(s),s,t):e.call(i,t.charAt(s),s,t)}(t,e,s):function(t,e,i){for(var s in t)Ra.call(t,s)&&(null==i?e(t[s],s,t):e.call(i,t[s],s,t))}(t,e,s)},Na=Qi,_a=es,Va=Pi,$a=_a("Object.prototype.toString"),qa=Xs(),Ka="undefined"==typeof globalThis?o:globalThis,Xa=function(){for(var t=[],e=0;e<Wa.length;e++)"function"==typeof Ua[Wa[e]]&&(t[t.length]=Wa[e]);return t}(),Ya=_a("String.prototype.slice"),Qa=Object.getPrototypeOf,Ja=_a("Array.prototype.indexOf",!0)||function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return i;return-1},Za={__proto__:null};Ha(Xa,qa&&Va&&Qa?function(t){var e=new Ka[t];if(Symbol.toStringTag in e){var i=Qa(e),s=Va(i,Symbol.toStringTag);if(!s){var n=Qa(i);s=Va(n,Symbol.toStringTag)}Za["$"+t]=Na(s.get)}}:function(t){var e=new Ka[t],i=e.slice||e.set;i&&(Za["$"+t]=Na(i))});var tl=es("ArrayBuffer.prototype.byteLength",!0),el=Mr,il=vs,sl=es,nl=$s,ol=xi,rl=hr,al=go,ll=Ir,hl=en,cl=Po,dl=Mr,ul=function(t){return"object"==typeof t&&null!==t&&(Dr?function(t){try{return Fr.call(t),!0}catch(Zh){return!1}}(t):"[object Date]"===zr.call(t))},pl=Ur,yl=Nr,gl=ke,fl=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t?null:aa(t)?"String":function(t){return"number"==typeof t||"object"==typeof t&&($r?function(t){try{return _r.call(t),!0}catch(Zh){return!1}}(t):"[object Number]"===Vr.call(t))}(t)?"Number":function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(Yr&&Symbol.toStringTag in t?function(t){try{return Kr(t),!0}catch(Zh){return!1}}(t):"[object Boolean]"===Xr(t))}(t)?"Boolean":la(t)?"Symbol":ha(t)?"BigInt":void 0},ml=function(t){if(t&&"object"==typeof t){if(ka(t))return"Map";if(Ia(t))return"Set";if(Pa(t))return"WeakMap";if(Ta(t))return"WeakSet"}return!1},bl=function(t){if(!t||"object"!=typeof t)return!1;if(!qa){var e=Ya($a(t),8,-1);return Ja(Xa,e)>-1?e:"Object"===e&&function(t){var e=!1;return Ha(Za,(function(i,s){if(!e)try{i(t),e=Ya(s,1)}catch(Zh){}})),e}(t)}return Va?function(t){var e=!1;return Ha(Za,(function(i,s){if(!e)try{"$"+i(t)===s&&(e=Ya(s,1))}catch(Zh){}})),e}(t):null},vl=function(t){return el(t)?tl?tl(t):t.byteLength:NaN},wl=sl("SharedArrayBuffer.prototype.byteLength",!0),xl=sl("Date.prototype.getTime"),Sl=Object.getPrototypeOf,kl=sl("Object.prototype.toString"),Il=ol("%Set%",!0),Pl=sl("Map.prototype.has",!0),Tl=sl("Map.prototype.get",!0),jl=sl("Map.prototype.size",!0),Cl=sl("Set.prototype.add",!0),Ol=sl("Set.prototype.delete",!0),Al=sl("Set.prototype.has",!0),El=sl("Set.prototype.size",!0);function Ml(t,e,i,s){for(var n,o=rl(t);(n=o.next())&&!n.done;)if(Bl(e,n.value,i,s))return Ol(t,n.value),!0;return!1}function Fl(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function zl(t,e,i,s,n,o){var r=Fl(i);if(null!=r)return r;var a=Tl(e,r),l=il({},n,{strict:!1});return!(void 0===a&&!Pl(e,r)||!Bl(s,a,l,o))&&!Pl(t,r)&&Bl(s,a,l,o)}function Dl(t,e,i){var s=Fl(i);return null!=s?s:Al(e,s)&&!Al(t,s)}function Ll(t,e,i,s,n,o){for(var r,a,l=rl(t);(r=l.next())&&!r.done;)if(Bl(i,a=r.value,n,o)&&Bl(s,Tl(e,a),n,o))return Ol(t,a),!0;return!1}function Bl(t,e,i,s){var n=i||{};if(n.strict?ll(t,e):t===e)return!0;if(fl(t)!==fl(e))return!1;if(!t||!e||"object"!=typeof t&&"object"!=typeof e)return n.strict?ll(t,e):t==e;var o,r=s.has(t),a=s.has(e);if(r&&a){if(s.get(t)===s.get(e))return!0}else o={};return r||s.set(t,o),a||s.set(e,o),function(t,e,i,s){var n,o;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(kl(t)!==kl(e))return!1;if(hl(t)!==hl(e))return!1;if(cl(t)!==cl(e))return!1;var r=t instanceof Error,a=e instanceof Error;if(r!==a)return!1;if((r||a)&&(t.name!==e.name||t.message!==e.message))return!1;var l=pl(t),h=pl(e);if(l!==h)return!1;if((l||h)&&(t.source!==e.source||nl(t)!==nl(e)))return!1;var c=ul(t),d=ul(e);if(c!==d)return!1;if((c||d)&&xl(t)!==xl(e))return!1;if(i.strict&&Sl&&Sl(t)!==Sl(e))return!1;var u=bl(t),p=bl(e);if(u!==p)return!1;if(u||p){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var y=Gl(t),g=Gl(e);if(y!==g)return!1;if(y||g){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var f=dl(t),m=dl(e);if(f!==m)return!1;if(f||m)return vl(t)===vl(e)&&"function"==typeof Uint8Array&&Bl(new Uint8Array(t),new Uint8Array(e),i,s);var b=yl(t),v=yl(e);if(b!==v)return!1;if(b||v)return wl(t)===wl(e)&&"function"==typeof Uint8Array&&Bl(new Uint8Array(t),new Uint8Array(e),i,s);if(typeof t!=typeof e)return!1;var w=gl(t),x=gl(e);if(w.length!==x.length)return!1;for(w.sort(),x.sort(),n=w.length-1;n>=0;n--)if(w[n]!=x[n])return!1;for(n=w.length-1;n>=0;n--)if(!Bl(t[o=w[n]],e[o],i,s))return!1;var S=ml(t),k=ml(e);return S===k&&("Set"===S||"Set"===k?function(t,e,i,s){if(El(t)!==El(e))return!1;for(var n,o,r,a=rl(t),l=rl(e);(n=a.next())&&!n.done;)if(n.value&&"object"==typeof n.value)r||(r=new Il),Cl(r,n.value);else if(!Al(e,n.value)){if(i.strict)return!1;if(!Dl(t,e,n.value))return!1;r||(r=new Il),Cl(r,n.value)}if(r){for(;(o=l.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!Ml(r,o.value,i.strict,s))return!1}else if(!i.strict&&!Al(t,o.value)&&!Ml(r,o.value,i.strict,s))return!1;return 0===El(r)}return!0}(t,e,i,s):"Map"!==S||function(t,e,i,s){if(jl(t)!==jl(e))return!1;for(var n,o,r,a,l,h,c=rl(t),d=rl(e);(n=c.next())&&!n.done;)if(a=n.value[0],l=n.value[1],a&&"object"==typeof a)r||(r=new Il),Cl(r,a);else if(void 0===(h=Tl(e,a))&&!Pl(e,a)||!Bl(l,h,i,s)){if(i.strict)return!1;if(!zl(t,e,a,l,i,s))return!1;r||(r=new Il),Cl(r,a)}if(r){for(;(o=d.next())&&!o.done;)if(a=o.value[0],h=o.value[1],a&&"object"==typeof a){if(!Ll(r,t,a,h,i,s))return!1}else if(!(i.strict||t.has(a)&&Bl(Tl(t,a),h,i,s)||Ll(r,t,a,h,il({},i,{strict:!1}),s)))return!1;return 0===El(r)}return!0}(t,e,i,s))}(t,e,n,s)}function Gl(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0]||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))}const Rl=r((function(t,e,i){return Bl(t,e,i,al())}));function Wl(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal.sort(),inventory:t.player.inventory.inventory.sort(((t,e)=>t.type-e.type)),quests:t.player.quests.quests.sort(((t,e)=>t.id-e.id)),gameState:t.player.gameState.data,settings:{gamepad:t.gamepad.visible,debug:w.debug,zoomed:w.zoomed}}}function Ul(){const t=localStorage.getItem(he);let e,i;try{t&&(e=JSON.parse(t))}catch(s){console.error(s),i=s}return{save:e||ue[ce.New],error:i}}const Hl={journal:{enumObj:_,enumName:"JournalEntry"},inventory:{enumObj:W,enumName:"ItemType"},type:{enumObj:W,enumName:"ItemType"},quests:{enumObj:U,enumName:"QuestType"},id:{enumObj:U,enumName:"QuestType"}};function Nl(t,e){const i={...w};return w.debug=t.settings.debug,w.zoomed=t.settings.zoomed,w.zoomed!==i.zoomed?(function(t,e){const i=e?d:c;w.zoomed=e,w.width=i.width,w.height=i.height,w.cameraOffset=i.height/3,t.scale.setGameSize(i.width,i.height),t.scene.restart()}(e,w.zoomed),!0):w.debug!==i.debug&&(e.scene.restart(),!0)}function _l(t){const{save:e,error:i}=Ul();i&&new ie(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4);try{Nl(e,t),t.player.setX(e.player.x),t.player.setY(e.player.y),t.player.setFlipX(e.player.flip),t.time.delayedCall(50,(()=>{try{t.player.inventory.createUI(),t.player.quests.createUI(),t.player.journal.createUI(),e.inventory.sort(((t,e)=>t.type-e.type)).forEach((e=>t.player.inventory.addItem(e,!0))),e.journal.sort().forEach((e=>t.player.journal.addEntry(e,!0))),e.quests.sort(((t,e)=>t.id-e.id)).forEach((e=>t.player.quests.addQuest(e,!0))),t.player.gameState.updateData(e.gameState,!0)}catch(i){console.error(i),new ie(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4,P),Vl(t,ue[ce.New]),_l(t)}})),t.gamepad.setVisible(e.settings.gamepad);const i=Rl(e,ue[ce.New])?"[New]":"[Storage]";t.time.delayedCall(200,(()=>{new ie(t,`Game Loaded ${w.prod?"":i}`)})),Rl(e,ue[ce.New])&&Vl(t,void 0,!0)}catch(s){console.error(s),new ie(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4,P),Vl(t,ue[ce.New]),_l(t)}}function Vl(t,e,i){const s=Wl(t);localStorage.setItem(he,JSON.stringify(e||s)),i||new ie(t,"Game Saved")}class $l extends s.GameObjects.Container{constructor(t,i){var s;super(t,0,0),e(this,"text"),e(this,"player"),e(this,"activeElement"),e(this,"outline"),e(this,"scene"),e(this,"dayNight",!1),this.scene=t,this.player=i,t.physics.world.drawDebug=w.debug,w.debug?t.physics.world.createDebugGraphic():null==(s=t.physics.world.debugGraphic)||s.clear(),this.createEventListeners(),w.debug&&(this.setScrollFactor(0).setDepth(L.Debug).setAlpha(.8),this.scene.add.existing(this),this.text=t.add.text(20,90,"",{...z,fontSize:w.zoomed?24:32,backgroundColor:`#${I}`,padding:{x:5,y:5}}),this.add(this.text),this.outline=t.add.rectangle(0,0,0,0).setStrokeStyle(2,65280).setScale(1.1).setDepth(L.Debug))}createEventListeners(){var t,e,i,s,n,o,r,a,l;null==(t=this.scene.input.keyboard)||t.on("keydown-K",(()=>{Vl(this.scene)})),null==(e=this.scene.input.keyboard)||e.on("keydown-L",(()=>{this.scene.scene.restart()})),null==(i=this.scene.input.keyboard)||i.on("keydown-M",(()=>{Vl(this.scene,ue[ce.Act2]),this.scene.scene.restart()})),null==(s=this.scene.input.keyboard)||s.on("keydown-N",(()=>{Vl(this.scene,ue[ce.New]),this.scene.scene.restart()})),null==(n=this.scene.input.keyboard)||n.on("keydown-Z",(()=>{w.debug=!w.debug,Vl(this.scene),this.scene.scene.restart()})),null==(o=this.scene.input.keyboard)||o.on("keydown-FORWARD_SLASH",(()=>{var t;st(t=this.scene)?function(t,e=!0){it||(ot(t,C,e),rt(t,1),t.lights.lights.forEach((i=>{const s=i.intensity;i.setVisible(!0),e&&(i.setIntensity(0),t.tweens.add({targets:i,duration:et,intensity:s}))})))}(t):nt(t)})),null==(r=this.scene.input.keyboard)||r.on("keydown-CLOSED_BRACKET",(()=>{Q(this.scene,"DebugTool")})),w.debug&&(null==(a=this.scene.input.keyboard)||a.on("keydown-COMMA",(()=>{const t=this.scene.lights.lights;console.table(t,["x","y"])})),null==(l=this.scene.input.keyboard)||l.on("keydown-PERIOD",(()=>{const t=this.scene.input.activePointer;new B(this.scene,t.worldX,t.worldY,100,E(j),1)})),this.scene.input.on("gameobjectdown",((t,e)=>{1===t.buttons&&(e!==this.activeElement?this.activeElement=e:this.activeElement=void 0)})),this.scene.input.on("drag",((t,e)=>{this.activeElement===e&&e.setPosition(t.worldX,t.worldY)})),this.scene.input.on("wheel",((t,e,i,s,n)=>{this.scene.cameras.main.zoom=Math.max(.01,this.scene.cameras.main.zoom+5e-4*s)})),this.scene.input.on("pointerup",(t=>{1===t.button&&(this.scene.cameras.main.zoom=1)})))}update(){if(!w.debug)return;const t=this.scene.input.activePointer,e=[`FPS: ${this.scene.game.loop.actualFps.toFixed(1)}`,`Frame Time: ${this.scene.game.loop.delta.toFixed(2)}`,`Zoom: ${this.scene.cameras.main.zoom.toFixed(2)}`,"",`Player x: ${this.player.x.toFixed(1)}`,`Player y: ${this.player.y.toFixed(1)}`,"",`Mouse x: ${t.worldX.toFixed(1)}`,`Mouse y: ${t.worldY.toFixed(1)}`];if(this.activeElement&&(e.push(""),e.push(`Active x: ${this.activeElement.x.toFixed(1)}`),e.push(`Active y: ${this.activeElement.y.toFixed(1)}`)),this.text.setText(e),this.activeElement){this.outline.setPosition(this.activeElement.x,this.activeElement.y),this.outline.setSize(this.activeElement.displayWidth,this.activeElement.displayHeight),this.outline.setOrigin(this.activeElement.originX,this.activeElement.originY);const t=this.activeElement.body;(t&&t instanceof s.Physics.Arcade.Body||t instanceof s.Physics.Arcade.StaticBody)&&t.updateFromGameObject()}else this.outline.setSize(0,0)}}class ql extends s.Physics.Arcade.Image{constructor(t,i,n){var o;const{x:r,y:a,image:l,scale:h}=i;super(t,r,a,l),e(this,"player"),e(this,"initialized",!1),e(this,"info"),e(this,"center"),this.info=i,this.player=n,this.setOrigin(0).setDepth(L.Backgrounds),Mt(this,i);const c=null==(o=t.textures.get(l))?void 0:o.getSourceImage();this.center=new s.Math.Vector2(r+c.width*(h||1)/2,a+c.height*((h||1)/2)),w.debug&&t.add.rectangle(this.center.x,this.center.y,c.width,c.height).setStrokeStyle(10,26214).setOrigin(.5)}lazyInit(t){(t||!this.initialized&&Y(this.center,this.player,2e3))&&(this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0}),this.initialized=!0)}update(){this.lazyInit()}}function Kl(){return Math.random()-.5}const Xl=[3200,600],Yl=[5350,690],Ql=[500,200,100,50,10];class Jl extends s.GameObjects.GameObject{constructor(t,i,n,o=40,r=[1400,600]){super(t,"fireflies"),e(this,"scene"),e(this,"center",new s.Math.Vector2(0,0)),e(this,"lights",[]),e(this,"count"),e(this,"centers",[]),e(this,"bounds",[1e3,400]),e(this,"biases",[]),e(this,"initialized",!1),e(this,"debug"),t.add.existing(this),this.scene=t,this.count=o,this.bounds=r,this.setPosition(i,n)}setPosition(t,e){this.center.set(t,e),this.centers=[];for(let i=0;i<this.count;i++)this.centers.push(new s.Math.Vector2(t+Math.random()*this.bounds[0]-this.bounds[0]/2,e+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(t-this.bounds[0]/2,e-this.bounds[1]/2)}lazyInit(t){if(t||!this.initialized&&Y(this.center,this.scene.player)){for(let t=0;t<this.count;t++){const t=new s.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),e=this.scene.lights.addPointLight(0,0,t.color,7*Math.random()+3,.15,.045+.02*Kl());this.lights.push(e);const i=[];for(let s=0;s<2*Ql.length;s++)i.push(Kl()*Ql[s%Ql.length]);i.push(10*Kl()),this.biases.push(i)}w.debug&&(this.debug=this.scene.add.graphics().fillStyle(16711680,.5).lineStyle(2,16711680,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])),this.setPosition(this.center.x,this.center.y),this.initialized=!0}}update(t,e){if(this.lazyInit(),!(Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0]))return;const i=t/1e3*.025,s=Math.cos(i),n=Math.sin(i);this.lights.forEach(((t,e)=>{const o=this.biases[e],r=Math.cos(70*i+o[10]);t.intensity=Math.min(.05+Math.abs(o[4]*r+o[3]*s+o[4]*s)/50,.4),t.x=s*o[0]+n*o[1]+s*o[2]+n*o[3]+s*o[4]+this.centers[e].x,t.y=n*o[5]+s*o[6]+n*o[7]+s*o[8]+n*o[9]+this.centers[e].y}))}}class Zl extends s.Physics.Arcade.Image{constructor(t,i,s,n=100,o=100,r=!1,a=!1){super(t,i,s,""),e(this,"scene"),e(this,"width"),e(this,"height"),e(this,"flipped"),e(this,"upwards"),e(this,"graphics"),e(this,"initialized",!1),this.scene=t,this.width=n,this.height=o,this.flipped=r,this.upwards=a}lazyInit(t){if(t||!this.initialized&&Y(this,this.scene.player)){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0).setDepth(L.Debug),w.debug||this.setVisible(!1),this.setSize(this.width,1.5*this.height),w.debug){this.setInteractive({draggable:!0});const t=this.scene.add.graphics().setDepth(L.Debug);this.graphics=t,t.lineStyle(2,65280,1);const e=this.width/2,i=new s.Math.Vector2(0,this.flipped?0:0+this.height),n=new s.Math.Vector2(0+this.width,this.flipped?0+this.height:0);t.lineBetween(i.x,i.y,n.x,n.y),t.lineBetween(i.x-e,i.y,i.x,i.y),t.lineBetween(n.x,n.y,n.x+e,n.y),t.strokeCircle(i.x,i.y,2),t.strokeCircle(n.x,n.y,2)}this.initialized=!0}}update(t,e){if(this.lazyInit(),!this.initialized)return;w.debug&&this.graphics&&this.graphics.setPosition(this.x,this.y);const i=this.scene.player,n=i.keys.keys;if(this.body&&this.scene.physics.world.intersects(this.body,i.body)){let t=s.Math.Clamp(1-(this.x+this.width-i.x)/this.width,0,1);this.flipped&&(t=1-t);const e=this.y+this.height,o=(1-i.originY)*i.displayHeight,r=e-this.height*t-o;if(this.upwards&&n[ht.Up]&&Math.abs(i.y-r)<70)return i.setVelocityX(this.flipped?-re:re),i.setFlipX(this.flipped),void i.setY(r);if(this.upwards&&(n[ht.Right]||n[ht.Left]&&this.flipped)&&i.y<e-70)return void i.setY(r);if(this.upwards&&r<i.y)return;i.setY(r)}}}class th extends s.Physics.Arcade.StaticGroup{constructor(t,i){super(t.physics.world,t),e(this,"player"),e(this,"initialized",[]),this.player=i,_t.forEach(((t,e)=>{void 0!==t.id&&this.createWall(t,e)}))}createWall(t,e){const i=this.scene.add.rectangle(t.x,t.y,6,100).setOrigin(0).setVisible(w.debug);void 0!==t.id&&i.setData("WallType",t.id),w.debug&&i.setInteractive({draggable:!0}),this.add(i),this.initialized.push(e)}update(){for(let t=0;t<_t.length;t++){if(this.initialized.includes(t))continue;const e=_t[t];s.Math.Distance.BetweenPointsSquared(e,this.player)<1e6&&this.createWall(e,t)}}}const eh=.1;class ih extends s.GameObjects.Container{constructor(t,i){super(t,100,w.height-100),e(this,"buttons",[]),e(this,"lastXAxisKey"),e(this,"lastYAxisKey"),e(this,"minimal"),this.minimal=i,this.setScrollFactor(0).setDepth(L.Overlay),this.scene.add.group(this,{runChildUpdate:!0}),this.createControllerListeners()}createUI(){this.createDPad(),this.minimal||this.createButtons()}setVisible(t){return super.setVisible(t),t&&0===this.buttons.length&&this.createUI(),this}update(t,e){var i,s,n,o,r,a,l,h,c,d,u;const p=null==(i=this.scene.input.gamepad)?void 0:i.pad1;if(!p)return;const y=p.axes[0].getValue(),g=p.axes[1].getValue();if(Math.abs(y)<=eh&&this.lastXAxisKey)return null==(s=this.scene.input.keyboard)||s.emit("keyup-"+this.lastXAxisKey),void(this.lastXAxisKey=void 0);if(y>eh){if("RIGHT"===this.lastXAxisKey)return;"LEFT"===this.lastXAxisKey&&(null==(n=this.scene.input.keyboard)||n.emit("keyup-LEFT")),null==(o=this.scene.input.keyboard)||o.emit("keydown-RIGHT"),this.lastXAxisKey="RIGHT"}if(y<-.1){if("LEFT"===this.lastXAxisKey)return;"RIGHT"===this.lastXAxisKey&&(null==(r=this.scene.input.keyboard)||r.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastXAxisKey="LEFT"}if(Math.abs(g)<=eh&&this.lastYAxisKey)return null==(l=this.scene.input.keyboard)||l.emit("keyup-"+this.lastYAxisKey),void(this.lastYAxisKey=void 0);if(g>eh){if("DOWN"===this.lastYAxisKey)return;"UP"===this.lastYAxisKey&&(null==(h=this.scene.input.keyboard)||h.emit("keyup-UP")),null==(c=this.scene.input.keyboard)||c.emit("keydown-DOWN"),this.lastYAxisKey="DOWN"}if(g<-.1){if("UP"===this.lastYAxisKey)return;"DOWN"===this.lastYAxisKey&&(null==(d=this.scene.input.keyboard)||d.emit("keyup-DOWN")),null==(u=this.scene.input.keyboard)||u.emit("keydown-UP"),this.lastYAxisKey="UP"}}createDPad(){const t=this.scene.add.container(10,-10);this.add(t);const e=this.scene.add.circle(0,0,60,E(k),.45).setStrokeStyle(3,E(I));t.add(e),this.button(-57,0,"LEFT",t),this.button(57,0,"RIGHT",t),this.button(0,-57,"UP",t),this.button(0,57,"DOWN",t)}createButtons(){const t=this.scene.add.container(w.width-300,0);this.add(t);const e=this.scene.add.circle(40,0,65,E(k),.45).setStrokeStyle(3,E(I)).setScale(1,.6).setAngle(-30);t.add(e),this.button(80,-20,"ENTER",t),this.button(0,20,"BACKSPACE",t)}createControllerListeners(){var t,e,i,s;null==(t=this.scene.input.gamepad)||t.on("connected",(t=>{new ie(this.scene,"Gamepad connected")})),null==(e=this.scene.input.gamepad)||e.on("disconnected",(t=>{new ie(this.scene,"Gamepad disconnected")})),null==(i=this.scene.input.gamepad)||i.on("down",((t,e)=>{var i;const s=this.getKeyFromButton(e);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keydown-${s}`))})),null==(s=this.scene.input.gamepad)||s.on("up",((t,e)=>{var i;const s=this.getKeyFromButton(e);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keyup-${s}`))}))}getKeyFromButton(t){const e=t.pad.id.toLowerCase().includes("nintendo");let i;switch(t.index){case 0:i=e?"BACKSPACE":"ENTER";break;case 1:i=e?"ENTER":"BACKSPACE";break;case 2:i=e?"SHIFT":"BACK_SLASH";break;case 3:i=e?"BACK_SLASH":"SHIFT";break;case 8:i="J";break;case 9:i="ESC";break;case 12:i="UP";break;case 13:i="DOWN";break;case 14:i="LEFT";break;case 15:i="RIGHT"}return i}button(t,e,i,s){const n="ENTER"===i||"ESCAPE"===i?35:38,o=this.scene.add.circle(t,e,n,E(x),.8).setStrokeStyle(3,E(I));o.setInteractive({useHandCursor:!0}).setScrollFactor(0),s.add(o),o.on("pointerdown",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keydown-${i}`),o.setFillStyle(E(k),Math.min(1,1.05))})),o.on("pointerup",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),o.setFillStyle(E(x),.8)})),o.on("pointerout",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),o.setFillStyle(E(x),.8)})),this.buttons.push(o)}offsetButtons(t){t?this.setPosition(100,w.height-300):this.setPosition(100,w.height-100)}}class sh extends s.GameObjects.Container{constructor(t,i,s,n,o){super(t,i,s),e(this,"onClick"),e(this,"img"),e(this,"rect"),e(this,"selected"),t.add.existing(this),this.setScrollFactor(0).setDepth(L.Ui),this.rect=t.add.rectangle(0,0,42,42,E(k)).setScrollFactor(0).setStrokeStyle(2,E(I)),this.img=t.add.image(-1,1,n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>o(this))),this.onClick=o,this.selected=!1,this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}setTint(t){this.img.setTint(t)}setSelected(t){this.selected=t,this.setTint(t?E(A):16777215)}}var nh=(t=>(t.Horizontal="H",t.Vertical="V",t.Corner="C",t.T="T",t.Cross="X",t.Empty=" ",t))(nh||{});const oh={H:[[0,0,0],[1,1,1],[0,0,0]],V:[[0,1,0],[0,1,0],[0,1,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},rh=[[" "," "," ","V"," "," ","V"," "," ","V"," "," "," ","V"," "," "],[" "," ","C","C"," "," ","V"," "," ","V"," "," ","C","T","H","H"],["H","H","X","T","T","T","T","T","T","C"," "," ","V"," "," "," "],[" "," ","V","C","X","C"," ","C","X","H","T","H","X","H","C"," "],[" "," ","C","T","X","H","C"," ","V"," ","V"," ","V"," ","T","H"],["H","T","H","T","V"," ","T","H","X","H","T","H","T"," ","V"," "],[" ","V"," ","C","X","H","C"," ","T","C"," "," ","C","C","C","H"],[" ","V"," "," ","V"," "," "," ","V","V"," "," "," ","V"," "," "]].map((t=>t.map((t=>t))));function ah(t,e){if(!t||!e)return!1;const i=lh(t),s=lh(e),n=e.x-t.x,o=e.y-t.y;return 1===n&&0===o?i.right&&s.left:-1===n&&0===o?i.left&&s.right:0===n&&1===o?i.bottom&&s.top:0===n&&-1===o&&i.top&&s.bottom}function lh(t){const e=function(t){let e=oh[t.type];const i=Math.floor(t.rotation/90);for(let s=0;s<i;s++)e=hh(e);return e}(t);return{left:e.some((t=>1===t[0])),right:e.some((t=>1===t[t.length-1])),top:e[0].some((t=>1===t)),bottom:e[e.length-1].some((t=>1===t))}}function hh(t){return t[0].map(((e,i)=>t.map((t=>t[i])).reverse()))}const ch=Object.keys(W).map((t=>W[t])).filter((t=>"number"==typeof t)),dh=Object.keys(_).map((t=>_[t])).filter((t=>"number"==typeof t)),uh=Object.keys(H).map((t=>H[t])).filter((t=>"number"==typeof t)),ph=Object.keys(V).map((t=>V[t])).filter((t=>"number"==typeof t)),yh=Object.keys(U).map((t=>U[t])).filter((t=>"number"==typeof t)),gh=Object.keys(R).map((t=>R[t])).filter((t=>"number"==typeof t)),fh=Object.values(nh).filter((t=>"number"!=typeof t)),mh=["MainMenu","MazeDialog","PipesDialog","TumblerDialog","MemoryDialog","SliderDialog"],bh=[{x:0,y:0,image:"town"},{x:500,y:-1100,image:"clock_outside"},{x:500,y:-2400,image:"clock_inner",skipLighting:!0},{x:2300,y:0,image:"forest"},{x:4400,y:100,image:"lake"},{x:-2200,y:-170,image:"mansion_outside"},{x:-2e3,y:-1320,image:"mansion_inside",skipLighting:!0},{x:-3200,y:1300,image:"alchemy_lab",scale:.9,skipLighting:!0},{x:1600,y:-700,image:"library",skipLighting:!0}],vh=[{x:135,y:462,radius:150,color:E(S),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:887,y:200,radius:150},{x:1561,y:460},{x:791,y:472,intensity:.5},{x:962,y:469,intensity:.5},{x:162,y:814,intensity:2},{x:635,y:772},{x:1638,y:788,intensity:2},{x:5300,y:530,intensity:2},{x:5315,y:730,intensity:.75,radius:75}],wh=[{x:740,y:-1370,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5150,y:953,width:100,height:60,flip:!0},{x:-1300,y:-415,width:90,height:35},{x:-1710,y:1577,width:280,height:190,upwards:!0},{x:-1020,y:1697,width:200,height:70},{x:-2570,y:1728,width:200,height:40,flip:!0}];class xh extends s.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock"),e(this,"gamepad"),e(this,"shouldInit",!0)}init(){const t=function(t){const{save:e}=Ul();try{return Nl(e,t)}catch(i){console.error(i)}return!1}(this);this.shouldInit=!t}create(){if(!this.shouldInit)return;const t=performance.now();K(this,w.bootDialog?150:500),this.player=new le(this);const e=this.createBackgrounds(),i=new th(this,this.player),s=this.createWarpers(),n=this.createSlopes(),o=this.createNpcs(),r=this.createItems(),a=this.createProps(),l=new Jl(this,Xl[0],Xl[1]),h=new Jl(this,Yl[0],Yl[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...s,...o,...r,...a],{runChildUpdate:!0});const c=this.add.group([this.player,l,h,...n,i,...e],{runChildUpdate:!0});this.clock&&c.add(this.clock),this.physics.add.collider(this.player,i),this.createEventListeners();const d=this.cameras.main;d.startFollow(this.player,!0),d.setFollowOffset(0,w.cameraOffset),_l(this);const u=performance.now()-t,p=`Game.create() took ${u.toFixed(1)}ms to initialize`;w.prod||(w.debug&&u>300||!w.debug&&u>150?new ie(this,p,void 0,P):new ie(this,p))}update(){this.player&&(this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>{const i=t;let s=!0;return i.disabled&&(s=!1),void 0!==i.visible&&(s=s&&i.visible),s}),this.player)||this.player.setInteractiveObject(void 0))}createBackgrounds(){return bh.map((t=>new ql(this,t,this.player)))}createWarpers(){return gh.map((t=>new vt(this,t,this.player)))}createNpcs(){return uh.map((t=>new dt(this,t,this.player)))}createItems(){return[W.Key].map((t=>new Nt(this,t,this.player)))}createSlopes(){return wh.map((t=>new Zl(this,t.x,t.y,t.width,t.height,t.flip,t.upwards)))}createProps(){return ph.map((t=>new pt(this,t,this.player)))}createUI(){this.time.delayedCall(50,(()=>{let t=31;new sh(this,t,30,"settings",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),w.prod||new sh(this,t+=50,30,"terminal",(()=>{Q(this,"DebugTool")}))})),this.gamepad=new ih(this),w.prod||(this.time.delayedCall(500,(()=>{const t=new $l(this,this.player);this.add.group(t,{runChildUpdate:!0})})),w.bootDialog&&this.time.delayedCall(150,(()=>Q(this,w.bootDialog))))}createLights(){this.lights.enable().setAmbientColor(E(x)),vh.forEach((t=>{w.debug?new B(this,t.x,t.y,t.radius||100,t.color||E(j),t.intensity||1):this.lights.addLight(t.x,t.y,t.radius||100,t.color||E(j),t.intensity||1)})),nt(this,!1)}createEventListeners(){var t;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),this.events.on("resume",(()=>{this.player.keys.resetKeys()}))}}class Sh extends sh{constructor(t,e,i){super(t,e,i,t.scale.isFullscreen?"minimize":"maximize",(()=>{t.scale.isFullscreen?t.scale.stopFullscreen():t.scale.startFullscreen()})),t.scale.on(Phaser.Scale.Events.ENTER_FULLSCREEN,(()=>{this.img.scene=t,this.img.setTexture("minimize")})),t.scale.on(Phaser.Scale.Events.LEAVE_FULLSCREEN,(()=>{this.img.scene=t,this.img.setTexture("maximize")}))}}class kh extends s.Scene{constructor(){super("MainMenu")}create(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(w.width,w.height),this.add.image(30,w.height-15,"logo").setOrigin(0,1).setScale(.25),new ih(this,!0).setVisible(!1);const t=new Zt(this),e=new Sh(this,w.width-30,30);t.addButton(e),localStorage.getItem(he)&&t.addButton(new Qt(this,w.width-120,w.height-145,"Continue",(()=>this.scene.start("Preloader",{skipFade:!0})),{align:"center"}).setFixedSize(200,70)),t.addButton(new Qt(this,w.width-120,w.height-60,"New Game",(()=>{localStorage.removeItem(he),this.scene.start("Preloader",{skipFade:!0})}),{align:"center"}).setFixedSize(200,70)),t.setActiveButton(1),K(this,300)}}class Ih extends s.Scene{constructor(){super("Preloader"),e(this,"container")}init(t){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(w.width,w.height),this.add.image(30,w.height-15,"logo").setOrigin(0,1).setScale(.25);const e=.68*w.width,i=this.add.container(.23*w.width,.91*w.height);this.container=i;const s=this.add.rectangle(0,0,e,26).setStrokeStyle(1,16777215,.85).setOrigin(0);i.add(s);const n=this.add.rectangle(3,3,0,20,16777215,.85).setOrigin(0);i.add(n),this.load.on("progress",(t=>{const i=w.prod?.6*t:t;n.width=(e-6)*i})),w.prod&&this.load.on("complete",(()=>{this.tweens.add({targets:n,width:e-6,duration:2400})}));const o=document.createElement("img");o.src="assets/icons/settings.svg?2",o.id="loading",this.add.dom(0,0,o),(null==t?void 0:t.skipFade)||K(this,300)}preload(){this.load.setPath("assets"),this.load.svg("sun","icons/sun.svg",{width:64,height:64}),this.load.svg("moon","icons/moon.svg",{width:64,height:64}),this.load.svg("settings","icons/settings.svg",{width:64,height:64}),this.load.svg("zoom-in","icons/zoom-in.svg",{width:64,height:64}),this.load.svg("zoom-out","icons/zoom-out.svg",{width:64,height:64}),this.load.svg("terminal","icons/terminal.svg",{width:64,height:64}),this.load.svg("award","icons/award.svg",{width:64,height:64}),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("mansion_outside","maps/mansion_outside_hatch.jpg"),this.load.image("mansion_inside","maps/mansion_inside.jpg"),this.load.image("alchemy_lab","maps/alchemy_lab.jpg"),this.load.image("library","maps/library.jpg"),this.load.image("watch","items/watch.png"),this.load.image("ladder","props/ladder.png"),this.load.image("warp","props/warp.png"),this.load.spritesheet("portal","props/portal.png",{frameWidth:140,frameHeight:120}),this.load.image("gear","items/gear.png"),this.load.image("gear2","items/gear2.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.image("key","items/key.png"),this.load.image("herb_red","items/herb_red.png"),this.load.image("herb_green","items/herb_green.png"),this.load.image("herb_blue","items/herb_blue.png"),this.load.image("potion","items/potion.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),this.load.image("player_portrait","characters/player_portrait.png"),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png"),this.load.image("clock_portrait","characters/clock_portrait.png"),this.load.image("chest","props/chest.png"),this.load.image("chest_open","props/chest_open.png"),this.load.image("book","props/book.png"),this.load.image("picture","props/picture.png"),this.load.image("alchemy_empty","props/alchemy/alchemy_empty.png"),this.load.image("alchemy_green","props/alchemy/alchemy_green.png"),this.load.image("alchemy_red","props/alchemy/alchemy_red.png"),this.load.image("alchemy_blue","props/alchemy/alchemy_blue.png"),this.load.image("alchemy_full","props/alchemy/alchemy_full.png"),this.load.image("arrow","puzzles/arrow.png")}create(){this.time.delayedCall(w.prod?3e3:0,(()=>{X(this,300,(()=>{this.scene.start("Game")}))}))}}class Ph extends s.GameObjects.Container{constructor(t,i,n){var o,r,a,l,h;super(t,i,n),e(this,"buttons",[]),e(this,"activeIndex",new s.Math.Vector2),e(this,"cursor"),t.add.existing(this).setScrollFactor(0),this.activeIndex.set(-1,-1),null==(o=t.input.keyboard)||o.on("keydown-UP",(()=>{this.setActiveButton({x:0,y:-1})})),null==(r=t.input.keyboard)||r.on("keydown-DOWN",(()=>{this.setActiveButton({x:0,y:1})})),null==(a=t.input.keyboard)||a.on("keydown-LEFT",(()=>{this.setActiveButton({x:-1,y:0})})),null==(l=t.input.keyboard)||l.on("keydown-RIGHT",(()=>{this.setActiveButton({x:1,y:0})})),null==(h=t.input.keyboard)||h.on("keydown-ENTER",(()=>{const t=this.getActiveButton();t&&t.onClick(t)})),t.input.on("pointermove",(()=>{this.cursor.setVisible(!1)}))}setButtons(t){this.buttons=t,this.activeIndex.set(-1,-1),this.removeAll(!0),this.cursor=this.scene.add.rectangle(0,0,60,80).setStrokeStyle(2,E(S),.75).setVisible(!1).setDepth(1),this.add(this.cursor);let e=new s.Math.Vector2;for(const i of t)for(const t of i)if(void 0!==t){const i=t.getBounds();e.set(Math.max(e.x,i.width),Math.max(e.y,i.height)),this.add(t)}this.cursor.setSize(1.2*e.x,1.2*e.y)}getActiveButton(){var t;return null==(t=this.buttons[this.activeIndex.y])?void 0:t[this.activeIndex.x]}setActiveButton(t){var e,i,n,o,r,a;let{x:l,y:h}=this.activeIndex;const c=this.buttons.length;if(h=s.Math.Clamp(h,0,c-1),l=s.Math.Clamp(l,0,((null==(e=this.buttons[h])?void 0:e.length)||0)-1),0===t.x){let e;if(-1!==this.activeIndex.y){for(;h>=0&&h<c&&void 0===e;)h+=t.y,e=null==(i=this.buttons[h])?void 0:i[l];if(!e)return}l=s.Math.Clamp(l,0,(null==(n=this.buttons[h])?void 0:n.length)-1)}if(0===t.y&&-1!==this.activeIndex.x){let e;for(;l>=0&&l<(null==(o=this.buttons[h])?void 0:o.length)&&void 0===e;)l+=t.x,e=null==(r=this.buttons[h])?void 0:r[l];if(!e)return}const d=null==(a=this.buttons[h])?void 0:a[l];d&&(this.cursor.setPosition(d.x,d.y).setVisible(!0),this.activeIndex.set(l,h))}}const Th=[[1,1,1,0,1],[1,0,1,0,1],[1,1,1,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],jh=[["0","1","2"],["3"," ","4"],["5","6","7"]];class Ch extends s.Scene{constructor(){super("UITest"),e(this,"selected"),e(this,"cursor"),e(this,"grid"),this.selected=void 0}create(){var t;const e=[];for(let i=0;i<Th.length;i++){const t=[];for(let e=0;e<Th[i].length;e++)Th[i][e]?t.push(this.btn(e,i)):t.push(void 0);e.push(t)}this.grid=new Ph(this),this.grid.setButtons(e),null==(t=this.input.keyboard)||t.on("keydown-BACK_SLASH",(()=>{e[0][0].text="0",e[0][1].text="1",e[0][2].text="2",e[1][0].text="3",e[1][2].text="4",e[2][0].text="5",e[2][1].text="6",e[0][4].text=" ",e[1][4].text=" ",e[2][4].text=" ",e[3][4].text=" ",e[4][4].text=" ",e[5][4].text=" ",e[6][4].text=" "}))}btn(t,e){return new Qt(this,50+60*t,50+85*e,t<3?" ":e.toString(),(t=>this.selectButton(t)))}selectButton(t){if(void 0===this.selected)this.selected=t,t.setSelected(!0);else{const e=this.selected.text;this.selected.setSelected(!1),this.selected.text=t.text,t.text=e,this.selected=void 0,this.checkValid()&&console.log("You Won!")}}checkValid(){var t;let e=!0;for(let i=0;i<jh.length;i++)for(let s=0;s<jh[0].length;s++){const n=null==(t=this.grid.buttons[i])?void 0:t[s];n&&n.text!==jh[i][s]&&(e=!1)}return e}}class Oh extends s.GameObjects.Container{constructor(t,i,n,o,r,a){var l,h;super(t,i,n),e(this,"textObject"),e(this,"maskGraphics"),e(this,"scrollbar"),e(this,"scrollY"),e(this,"boxHeight"),t.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new s.GameObjects.Text(t,0,0,o,{...z,padding:{x:10,y:10},...r}),this.textObject.setOrigin(0).setScrollFactor(0).setInteractive(),this.add(this.textObject),t.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),this.textObject.on("pointerdown",((t,e,i)=>{const s=this.textObject.getWrappedText().length,n=i/this.textObject.height,o=Math.floor(n*s);a&&a(o)})),null==(l=t.input.keyboard)||l.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(h=t.input.keyboard)||h.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=t.add.graphics().setPosition(i,n).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=t.add.rectangle(0,0,4,0,5592405).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(t,e){this.boxHeight=e,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,t,e);const i=this.maskGraphics.createGeometryMask();return this.textObject.setMask(i),this.textObject.setWordWrapWidth(t-8),this.textObject.setFixedSize(t-8,0),this.updateTextPosition(),this}setText(t){return this.textObject.setText(t),this.updateTextPosition(),this}handleDrag(t){t.isDown&&(this.scrollY-=t.velocity.y,this.updateTextPosition())}handleScroll(t,e,i,s,n){this.scrollY+=.5*s,this.updateTextPosition()}updateTextPosition(){const t=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=s.Math.Clamp(this.scrollY,0,t),this.textObject.y=-this.scrollY;const e=this.scrollY/t,i=this.boxHeight/this.textObject.height;this.scrollbar.height=i*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+4,e*(this.boxHeight-i*this.boxHeight))}}class Ah extends s.Scene{constructor(t){super(t.key),e(this,"dialogData"),e(this,"container"),e(this,"keys"),e(this,"title"),e(this,"additionalUI"),e(this,"closing"),this.dialogData=t}create(){var t,e,i;this.additionalUI=[],this.closing=!1,this.container=this.add.container(w.width/2,w.height/2),this.container.add(this.add.rectangle(0,0,.95*w.width,.95*w.height,0,.75).setStrokeStyle(4,E(S))),this.container.add(new Qt(this,.44*w.width,-.4*w.height,"X",(()=>this.close(!1)),{backgroundColor:`#${P}`})),w.prod||this.dialogData.hideCloseSuccess||this.container.add(new sh(this,.38*w.width,-.4*w.height,"award",(()=>this.startClose(!0)))),this.title=this.add.text(0,-.4*w.height,this.dialogData.title,{...z,fontSize:48}).setOrigin(.5),this.container.add(this.title),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.startClose(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.startClose(!1)})),w.prod||null==(i=this.input.keyboard)||i.on("keydown-BACK_SLASH",(()=>{this.startClose(!0)})),this.keys=new ct(this),new ih(this,!0).setVisible(this.dialogData.gamepadVisible),this.container.setAlpha(0),this.dialogData.childScene?(this.scene.launch(this.dialogData.childScene,{parent:this}),this.scene.get(this.dialogData.childScene).events.on("create",(()=>this.fadeIn()))):this.fadeIn()}fadeIn(){this.tweens.add({targets:this.getTargets(),alpha:{start:0,to:1},delay:100,duration:500})}fadeOut(t){this.tweens.add({targets:this.getTargets(),alpha:{start:1,to:0},duration:250,hold:250,onComplete:t})}addTarget(t){t.setAlpha(0),this.additionalUI.push(t)}getTargets(){return[this.container,...this.additionalUI]}startClose(t){this.closing||(this.closing=!0,this.close(t))}close(t){this.fadeOut((()=>{var e,i;this.scene.stop(),this.dialogData.childScene&&this.scene.stop(this.dialogData.childScene),this.scene.resume("Game"),null==(i=null==(e=this.scene.get("Game"))?void 0:e.gamepad)||i.setAlpha(1),this.handleSuccess(t)}))}}const Eh="chrono-sleuth-debug-tab";function Mh(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Fh(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Mh(Object(i),!0).forEach((function(e){zh(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Mh(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function zh(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Dh(t){return t.slice(0,-1)}function Lh(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function Bh(t){return[...new Set(t)]}function Gh(t,e){const i=Bh(t.map((t=>t.set))).filter(Boolean),s=(n=Lh(1,t.length+1),o=i,[n,o].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var n,o;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=s[e]))}function Rh(t,e,i=.5){Dh(t).forEach(((s,n)=>{const o=t[n+1],r=s.set!==o.set,a=e()<=i;var l,h,c;r&&a&&(l=t,h=o.set,c=s.set,l.forEach((t=>{t.set===h&&(t.set=c)})),s.right=!1,o.left=!1)}))}const Wh=48;class Uh extends s.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"nextUpdate")}init(t){this.parent=t.parent}create(){this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,.8*Wh,.8*Wh,5601177).setSmoothness(32).setOrigin(-.13),this.cameras.main.startFollow(this.mazePlayer),this.keys=this.parent.keys,this.parent.addTarget(this.graphics),this.parent.addTarget(this.mazePlayer)}getMazeSeed(){return this.parent.player.gameState.data.mazeSeed||0}createMaze(){const t=this.getMazeSeed();this.maze=function(t=8,e=t,i=!0,s=1){const n=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(s),o=[],r=Lh(t);for(let h=0;h<e;h+=1){const s=r.map((s=>({x:s,y:h,top:i||h>0,left:i||s>0,bottom:i||h<e-1,right:i||s<t-1})));o.push(s)}Dh(o).forEach(((t,e)=>{Gh(t,n),Rh(t,n),function(t,e,i){const s=Object.values(function(t){let e=Bh(t.map((t=>t.set))).reduce(((t,e)=>Fh(Fh({},t),{},{[e]:[]})),{});return t.forEach((t=>e[t.set].push(t))),e}(t)),{ceil:n}=Math;s.forEach((t=>{(function(t,e,i){e=null==e?1:e;const s=null==t?0:t.length;if(!s||e<1)return[];e=e>s?s:e;let n=-1;const o=s-1,r=[...t];for(;++n<e;){const t=n+Math.floor(i()*(o-n+1)),e=r[t];r[t]=r[n],r[n]=e}return r.slice(0,e)})(t,n(i()*t.length),i).forEach((t=>{if(t){const i=e[t.x];t.bottom=!1,i.top=!1,i.set=t.set}}))}))}(t,o[e+1],n)}));const a=(l=o)[l.length-1];var l;return Gh(a,n),Rh(a,n,1),o}(24,24,!0,t),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,Wh,Wh),this.graphics.lineStyle(3,3385907),this.maze.forEach((t=>{t.forEach((t=>{if(t.top){const e=new s.Geom.Line(t.x*Wh,t.y*Wh,t.x*Wh+Wh,t.y*Wh);this.graphics.strokeLineShape(e)}if(t.bottom){const e=new s.Geom.Line(t.x*Wh,t.y*Wh+Wh,t.x*Wh+Wh,t.y*Wh+Wh);this.graphics.strokeLineShape(e)}if(t.left){const e=new s.Geom.Line(t.x*Wh,t.y*Wh,t.x*Wh,t.y*Wh+Wh);this.graphics.strokeLineShape(e)}if(t.right){const e=new s.Geom.Line(t.x*Wh+Wh,t.y*Wh,t.x*Wh+Wh,t.y*Wh+Wh);this.graphics.strokeLineShape(e)}}))})),this.cameras.main.setViewport(50,130,w.width-100,w.height-170)}update(t,e){if(t<this.nextUpdate)return;const i=this.keys.keys,n=new s.Math.Vector2(0,0);i[ht.Left]?n.x=-48:i[ht.Right]?n.x=Wh:i[ht.Up]?n.y=-48:i[ht.Down]&&(n.y=Wh);const o=new s.Math.Vector2(this.mazePlayer.x+n.x,this.mazePlayer.y+n.y);if((this.mazePlayer.x!==o.x||this.mazePlayer.y!==o.y)&&this.canMove(o)){this.mazePlayer.setPosition(o.x,o.y);const t=new s.Math.Vector2(1104,1104);this.parent.setAngle(s.Math.Angle.BetweenPoints(o,t)),this.mazePlayer.x===t.x&&this.mazePlayer.y===t.y&&this.parent.close(!0)}this.nextUpdate=t+140}canMove(t){const e=t.x,i=t.y,n=s.Math.FloorTo(e/Wh),o=s.Math.FloorTo(i/Wh);if(n<0||o<0||n>=24||o>=24)return!1;const r=s.Math.FloorTo(this.mazePlayer.x/Wh),a=s.Math.FloorTo(this.mazePlayer.y/Wh),l=this.maze[a][r];return!(l.top&&i<this.mazePlayer.y||l.bottom&&i>this.mazePlayer.y||l.left&&e<this.mazePlayer.x||l.right&&e>this.mazePlayer.x)}}class Hh extends s.GameObjects.Rectangle{constructor(t,i,n){super(t,0,0,i.size,i.size),e(this,"keys"),e(this,"cursorData"),e(this,"nextUpdate",0),e(this,"position",new s.Math.Vector2(-1,-1)),t.add.group(this,{runChildUpdate:!0}),this.setStrokeStyle(2,E(S),.75),this.setVisible(!1),this.cursorData=i,this.keys=n,t.input.on("pointerdown",(t=>{this.setVisible(!1)}))}update(t,e){var i;if(t<this.nextUpdate)return;let n=!0;const o=null==(i=this.cursorData.regions[0])?void 0:i.length,r=this.cursorData.regions.length,a=this.keys.keys;a[ht.Continue]?this.cursorData.keyHandler(this.position):a[ht.Left]?this.position.x--:a[ht.Right]?this.position.x++:a[ht.Up]?this.position.y--:a[ht.Down]?this.position.y++:n=!1,n&&(this.position.x=s.Math.Clamp(this.position.x,0,o-1),this.position.y=s.Math.Clamp(this.position.y,0,r-1),this.nextUpdate=t+170,this.setVisible(!0),this.setPosition(this.cursorData.regions[this.position.y][this.position.x].x,this.cursorData.regions[this.position.y][this.position.x].y))}}"function"==typeof SuppressedError&&SuppressedError;class Nh extends s.Scene{constructor(){super("Paused"),e(this,"parent"),e(this,"debugCount"),e(this,"container")}init(t){this.parent=t.game}create(){var t;const{width:e,height:i}=w;this.container=this.add.container(0,0),this.container.add(this.add.rectangle(e/2,i/2,e,i,0,.75).setInteractive().on("pointerdown",(()=>this.resume()))),this.container.add(this.add.text(e/2,100,"Game Paused",{...z,fontSize:72}).setOrigin(.5)),this.debugCount=0,this.container.add(this.add.text(e-20,i-20,`Build Time: ${new Date("2024-10-18T23:15:14.371Z").toLocaleString()}\n${w.prod?"":"Debug Mode"}`,{...z,fontSize:16,align:"right"}).setOrigin(1,1).setInteractive({useHandCursor:!1}).on("pointerdown",(()=>{this.debugCount++,this.debugCount>10&&(localStorage.setItem("chrono-sleuth-prod",w.prod?"false":"true"),window.location.reload())})));const s=!w.zoomed,n=s?100:80,o=s?48:36,r=s?220:180,a=new Zt(this);this.container.add(a);const l=new Sh(this,w.width-30,30);a.addButton(l),a.addButton(new Qt(this,e/2,r,"Resume",(()=>this.resume()),{fontSize:o})),a.addButton(new Qt(this,e/2,r+n,"Save",(()=>{this.resume(),Vl(this.parent)}),{fontSize:o})),a.addButton(new Qt(this,e/2,r+2*n,"Load",(()=>{this.resume(),this.parent.scene.restart()}),{fontSize:o})),a.addButton(new Qt(this,e/2,r+3*n,"Toggle Gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}),{fontSize:o})),a.setActiveButton(1),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume())),new ih(this).setVisible(!1),this.tweens.add({targets:this.container,alpha:{start:0,to:1},duration:250})}resume(){this.tweens.add({targets:this.container,alpha:{start:1,to:0},duration:250,onComplete:()=>{this.scene.stop(),this.scene.resume("Game")}})}}class _h extends s.Scene{constructor(){super("Pipes"),e(this,"parent"),e(this,"keys"),e(this,"pipes",[]),e(this,"totalPipes",0),e(this,"images",[]),e(this,"container"),e(this,"blockSize"),e(this,"pipeSize"),e(this,"initialized",!1)}init(t){this.parent=t.parent,this.blockSize=w.zoomed?13:17,this.pipeSize=3.75*this.blockSize}preload(){this.prerenderPipes()}prerenderPipes(){for(const t of fh){const e=oh[t],i=`pipe_${t}`;this.textures.exists(i)&&this.textures.remove(i);const s=this.textures.createCanvas(i,3*this.blockSize,3*this.blockSize);if(s){const t=s.context;t.fillStyle="#ffffff";for(let i=0;i<e.length;i++)for(let s=0;s<e[i].length;s++)1===e[i][s]&&t.fillRect(s*this.blockSize,i*this.blockSize,this.blockSize,this.blockSize);s.refresh()}}}create(){this.keys=this.parent.keys,this.container=this.add.container(),this.createPipes();const t=[];for(let i=0;i<6;i++){t.push([]);for(let e=0;e<14;e++)t[i].push({x:(e+1)*this.pipeSize,y:(i+1)*this.pipeSize})}const e=new Hh(this,{regions:t,size:this.pipeSize,keyHandler:t=>{const e=this.pipes[t.y+1][t.x+1];e.interactive&&(e.rotation=(e.rotation+90)%360,this.updatePipes())}},this.keys);this.container.add(e)}createPipes(){this.pipes=[],this.container=this.add.container().setPosition(w.width/2-16*this.pipeSize/2+this.pipeSize/2,w.height/4),this.totalPipes=0;for(let t=0;t<8;t++){this.pipes[t]||(this.pipes[t]=[]);for(let e=0;e<16;e++){let i=rh[t][e];const n=0===e||0===t||15===e||7===t,o=15===e&&7===t,r=!n;this.pipes[t][e]={x:e,y:t,type:i,rotation:n?0:90*s.Math.Between(0,3),interactive:r},i!==nh.Empty&&this.totalPipes++;const a=e+t*rh[0].length;this.time.delayedCall(50+5*a,(()=>{const s=`pipe_${i}`,n=this.add.image(e*this.pipeSize,t*this.pipeSize,s).on("pointerdown",(()=>{this.initialized&&(this.pipes[t][e].rotation=(this.pipes[t][e].rotation+90)%360,this.updatePipes())}));n.setAlpha(0).setScale(.5).setAngle(this.pipes[t][e].rotation),this.tweens.add({targets:n,alpha:1,scale:1,duration:300,onComplete:o?()=>{this.initialized=!0,this.updatePipes()}:void 0}),r?n.setInteractive():n.setTint(6710886),this.container.add(n),this.images.push(n)}))}}this.parent.addTarget(this.container)}updatePipes(){const t=function(t){const e=[],i=new Set,s=t.length,n=t[0].length;return function o(r,a){const l=`${r},${a}`;i.add(l),e.push(t[a][r]),r+1<n&&!i.has(`${r+1},${a}`)&&ah(t[a][r],t[a][r+1])&&o(r+1,a),r-1>=0&&!i.has(`${r-1},${a}`)&&ah(t[a][r],t[a][r-1])&&o(r-1,a),a+1<s&&!i.has(`${r},${a+1}`)&&ah(t[a][r],t[a+1][r])&&o(r,a+1),a-1>=0&&!i.has(`${r},${a-1}`)&&ah(t[a][r],t[a-1][r])&&o(r,a-1)}(0,2),e}(this.pipes);this.pipes.forEach((t=>{t.forEach((t=>{this.images[t.x+t.y*rh[0].length].setAngle(t.rotation)}))})),t.length===this.totalPipes&&this.parent.close(!0)}completed(t){const e=this.images.length,i=new s.Display.Color(255,255,255),n=F(E(k));for(let s=0;s<e;s++){const o=this.images[s];J(this,i,n,(t=>o.setTint(t)),{duration:500,delay:10*s,hold:1e3,onComplete:s===e-1?t:void 0})}}}const Vh=w.height/(w.zoomed?4:5.5),$h=[[1,0,1,1,0],[0,1,0,0,0],[0,0,1,0,1],[0,0,1,1,0],[1,1,0,0,1]],qh=2*Math.PI/16;class Kh extends Phaser.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,renderTarget:!0,fragShader:"\nprecision mediump float;\n\nuniform float     uAlpha;\nuniform vec2      uResolution;\nuniform sampler2D uMainSampler;\n\n// slight modifications made to original shader\n// use alpha channel for fragColor + changed uniform names\n\n// original shader from: https://www.shadertoy.com/view/WsVSzV\n\nfloat warp = 0.3;     // simulate curvature of CRT monitor\nfloat scan = 0.75;    // simulate darkness between scanlines\nfloat scanSize = 0.75; // size of scanlines [0.0 - 2.0] (smaller number = taller scanlines)\n\nvoid mainImage(out vec4 fragColor,in vec2 fragCoord)\n{\n  // squared distance from center\n  vec2 uv = fragCoord/uResolution.xy;\n  vec2 dc = abs(0.5-uv);\n  dc *= dc;\n\n  // warp the fragment coordinates\n  uv.x -= 0.5; uv.x *= 1.0+(dc.y*(0.3*warp)); uv.x += 0.5;\n  uv.y -= 0.5; uv.y *= 1.0+(dc.x*(0.4*warp)); uv.y += 0.5;\n\n  // sample inside boundaries, otherwise set to black\n  if (uv.y > 1.0 || uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0) {\n      fragColor = vec4(0.0,0.0,0.0,0.0);\n  } else {\n    // determine if we are drawing in a scanline\n    float apply = abs(sin(fragCoord.y * scanSize)*0.5*scan);\n\n    apply = uAlpha * apply;\n\n    // sample the texture\n    float alpha = texture2D(uMainSampler,uv).a;\n    fragColor = vec4(mix(texture2D(uMainSampler,uv).rgb,vec3(0.0), apply), alpha);\n  }\n}\n\nvoid main(void)\n{\n  mainImage(gl_FragColor, gl_FragCoord.xy);\n}\n"}),e(this,"alpha"),this.alpha=1}onDraw(t){this.set1f("uAlpha",this.alpha),this.bindAndDraw(t)}}class Xh extends Phaser.Plugins.ScenePlugin{boot(){var t;w.useShader&&(null==(t=this.systems)||t.events.on("create",this.applyPipeline,this))}applyPipeline(){var t;null==(t=this.scene)||t.cameras.main.setPostPipeline("CRTPipeline")}}class Yh extends Phaser.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,fragShader:"\nprecision mediump float;\n\nuniform float     uAlpha;\nuniform vec2      uResolution;\nuniform sampler2D uMainSampler;\n\nvoid main(void)\n{\n  vec2 uv = gl_FragCoord.xy / uResolution.xy;\n  vec4 baseColor = vec4(texture2D(uMainSampler, uv).rgba);\n  vec4 newColor = baseColor;\n  newColor.r *= 5.5;\n  newColor.b *= 4.5;\n\n  gl_FragColor = mix(baseColor, newColor, uAlpha);\n}\n"}),e(this,"alpha"),this.alpha=0}onDraw(t){this.set1f("uAlpha",this.alpha),this.bindAndDraw(t)}}!function(t={}){const{immediate:e=!1,onNeedRefresh:i,onOfflineReady:s,onRegistered:n,onRegisteredSW:o,onRegisterError:r}=t;let l,h;h=async function(){if("serviceWorker"in navigator){if(l=await function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){const t=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),o=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=Promise.allSettled(e.map((e=>{if(e=function(t,e){return new URL(t,e).href}(e,i),e in a)return;a[e]=!0;const s=e.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(i)for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.href===e&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=s?"stylesheet":"modulepreload",s||(r.as="script"),r.crossOrigin="",r.href=e,o&&r.setAttribute("nonce",o),document.head.appendChild(r),s?new Promise(((t,i)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function n(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return s.then((e=>{for(const t of e||[])"rejected"===t.status&&n(t.reason);return t().catch(n)}))}((async()=>{const{Workbox:t}=await import("./workbox-window.prod.es5-DCAOQoWB.js");return{Workbox:t}}),[],import.meta.url).then((({Workbox:t})=>new t("./sw.js",{scope:"./",type:"classic"}))).catch((t=>{null==r||r(t)})),!l)return;l.addEventListener("activated",(t=>{(t.isUpdate||t.isExternal)&&window.location.reload()})),l.addEventListener("installed",(t=>{t.isUpdate||null==s||s()})),l.register({immediate:e}).then((t=>{o?o("./sw.js",t):null==n||n(t)})).catch((t=>{null==r||r(t)}))}}()}({immediate:!0});const Qh={type:Phaser.WEBGL,width:w.width,height:w.height,parent:"game-container",backgroundColor:E(O),scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[D,kh,Ih,xh,Nh,class extends Ah{constructor(){super({key:"JournalDialog",title:"Journal",gamepadVisible:!1,hideCloseSuccess:!0}),e(this,"player")}init(t){this.player=t.player}create(){var t;super.create(),this.player.journal.unread.setVisible(!1);const e=this.player.journal.journal.map((t=>`- ${yt[t].description}\n`)).reverse(),i=new Oh(this,.08*w.width,.25*w.height,e,{fontSize:32});i.setBoxSize(.84*w.width,.62*w.height),this.addTarget(i),this.fadeIn(),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()}))}handleSuccess(){}},class extends Ah{constructor(){super({key:"DebugTool",title:"Debug Tool",gamepadVisible:!1,hideCloseSuccess:!0}),e(this,"player"),e(this,"tabs",[]),e(this,"tab",0),e(this,"mainContainer"),e(this,"textBox"),e(this,"helperText"),e(this,"stateContainer"),e(this,"saveContainer"),e(this,"miscContainer");const t=localStorage.getItem(Eh);t&&(this.tab=Number(t))}init(t){this.player=t.player}create(){var t;super.create(),this.mainContainer=this.add.container(-w.width/2,-w.height/2),this.container.add(this.mainContainer),this.mainContainer.add(this.add.rectangle(300,100,.65*w.width,.75*w.height,E("#112233")).setOrigin(0));const e=this.makeTab("Items",0),i=this.makeTab("Journal",1),s=this.makeTab("Quests",2),n=this.makeTab("State",3),o=this.makeTab("Warp",4),r=this.makeTab("Saves",5),a=this.makeTab("Misc",6);this.textBox=new Oh(this,300,100,"",{backgroundColor:"#123",fontSize:32},(t=>this.handleLineClick(t))).setBoxSize(.65*w.width,.75*w.height),this.mainContainer.add(this.textBox),this.helperText=this.add.text(w.zoomed?.94*w.width:.87*w.width,110,"",{...z,fontSize:24}).setOrigin(1,0).setDepth(1),this.mainContainer.add(this.helperText),this.tabs=[e,i,s,n,o,r,a],this.container.add(this.tabs),this.createStateContainer(),this.createSaveContainer(),this.createMiscContainer(),this.updateTabs(),null==(t=this.input.keyboard)||t.on("keydown-CLOSED_BRACKET",(()=>{this.close()}))}createStateContainer(){this.stateContainer=this.add.container(310,100),this.mainContainer.add(this.stateContainer);const t=this.player.gameState.data;Object.entries(t).forEach(((e,i)=>{const[s,n]=e,o=this.add.text(0,20+40*i,`${s}: ${n}`,{...z,fontSize:32}).setOrigin(0);switch(this.stateContainer.add(o),typeof n){case"boolean":o.setText(`${n?"[x]":"[ ]"} ${s}`),o.setInteractive().on("pointerdown",(()=>{t[s]=!t[s],o.setText(`${t[s]?"[x]":"[ ]"} ${s}`)}));break;case"number":const e=this.smallButton(o.width+20,22+40*i,"-",(()=>{t[s]--,o.setText(`${s}: ${t[s]}`)})),r=this.smallButton(o.width+55,22+40*i,"+",(()=>{t[s]++,o.setText(`${s}: ${t[s]}`)}));this.stateContainer.add([e,r])}}))}smallButton(t,e,i,s){return new Jt(this,t,e,i,s,{fontSize:36,backgroundColor:"#111",padding:{x:6,y:-4}},null)}createSaveContainer(){this.saveContainer=this.add.container(310,100),this.mainContainer.add(this.saveContainer),Object.entries(ue).forEach(((t,e)=>{const[i,s]=t,n=new Jt(this,0,10+60*e,ce[Number(i)],(()=>{Vl(this.player.scene,s),this.close(!0)}),{backgroundColor:"#111"});this.saveContainer.add(n)}));const t=new Jt(this,350,10,"Dump Save",(()=>{const t=(e=Wl(this.player.scene),JSON.stringify(e,((t,e)=>{const i=Hl[t];return Array.isArray(e)&&i?e.map((t=>Z(t,i.enumObj,i.enumName))):i?Z(e,i.enumObj,i.enumName):e}),2).replace(/"(\w+\.\w+)"/g,"$1"));var e;console.log(t)}),{backgroundColor:"#111"});this.saveContainer.add(t)}createMiscContainer(){this.miscContainer=this.add.container(310,100),this.mainContainer.add(this.miscContainer);const t=new Jt(this,350,10,"Debug Mode",(()=>{w.debug=!w.debug,this.close()}),{backgroundColor:"#111"});this.miscContainer.add(t)}makeTab(t,e){return new Jt(this,40-this.container.x,100-this.container.y+60*e,t,(()=>{this.tab=e,localStorage.setItem(Eh,String(e)),this.updateTabs()}))}handleLineClick(t){var e,i;switch(this.tab){case 0:const s=ch[t],n=this.player.inventory.inventory,o=n.find((t=>t.type===s));o?o.used?n.splice(n.indexOf(o),1):o.used=!o.used:this.player.inventory.addItem({type:s,used:!1},!0);break;case 1:const r=dh[t],a=this.player.journal.journal;Tt(this.player,r)?a.splice(a.indexOf(r),1):this.player.journal.addEntry(r,!0);break;case 2:const l=yh[t],h=this.player.quests.quests,c=h.find((t=>t.id===l));c?c.completed?h.splice(h.indexOf(c),1):c.completed=!c.completed:this.player.quests.addQuest({id:l,completed:!1},!0);break;case 4:const d=gh[t],u=mt[d];this.player.setPosition(u.x,u.y),this.close();break;case 6:if(t>1){const s=mh[t-2];"MainMenu"===s?(this.scene.sendToBack("Game"),this.scene.start(s)):(this.scene.stop(this),this.scene.resume("Game"),null==(i=null==(e=this.scene.get("Game"))?void 0:e.gamepad)||i.setAlpha(1),Q(this.player.scene,s))}}this.updateTabs()}updateTabs(){var t,e,i;this.tabs.forEach(((t,e)=>{t.setBackgroundColor(e===this.tab?"#123":"#151515")}));const s=0===this.tab||1===this.tab||2===this.tab||4===this.tab||6===this.tab,n=0===this.tab||2===this.tab;null==(t=this.stateContainer)||t.setVisible(3===this.tab),null==(e=this.saveContainer)||e.setVisible(5===this.tab),null==(i=this.miscContainer)||i.setVisible(6===this.tab),this.textBox.setVisible(s),this.helperText.setVisible(n);let o="";switch(this.tab){case 0:o=ch.map((t=>`[${St(this.player,t)?"-":kt(this.player,t)?"x":" "}] ${W[t]}`)).join("\n"),this.helperText.setText("[-] item held\n[x] item used");break;case 1:o=dh.map((t=>`[${Tt(this.player,t)?"x":" "}] ${_[t]}`)).join("\n");break;case 2:o=yh.map((t=>`[${It(this.player,t)?"-":Pt(this.player,t)?"x":" "}] ${U[t]}`)).join("\n"),this.helperText.setText("[-] quest active\n[x] quest complete");break;case 4:o=gh.map((t=>R[t])).join("\n");break;case 6:o=["Scenes","-----------------",...mh].join("\n")}this.textBox.setText(o)}handleSuccess(t){t||Vl(this.player.scene),this.player.scene.scene.restart()}},class extends Ah{constructor(){super({key:"MazeDialog",title:"Find your way through the forest",childScene:"Maze",gamepadVisible:!0}),e(this,"player"),e(this,"arrow")}init(t){var e,i;this.player=t.player,this.dialogData.gamepadVisible=null==(i=null==(e=t.player.scene)?void 0:e.gamepad)?void 0:i.visible}create(){super.create(),this.arrow=this.add.image(.4*-w.width,.4*-w.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow)}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}handleSuccess(t){t?(wt(R.Forest,this.player),this.player.gameState.updateData({mazeSolved:!0,mazeSeed:this.player.gameState.data.mazeSeed+1},!1)):this.player.setPosition(mt[R.TownEast].x-100,mt[R.TownEast].y)}},Uh,class extends Ah{constructor(){super({key:"PipesDialog",title:"Attach all of the pipes to fix the alchemy set.\n[CONTINUE/CLICK] to rotate",gamepadVisible:!1,childScene:"Pipes"}),e(this,"player")}init(t){this.player=t.player}create(){super.create(),this.title.setFontSize(36).setAlign("center").setY(this.title.y+10)}close(t){const e=this.scene.get("Pipes");t&&e?e.completed((()=>super.close(t))):super.close(t)}handleSuccess(t){t&&this.player.message.setDialog(Bt,Et(this.player.scene,V.AlchemySet),"player_portrait")}},_h,class extends Ah{constructor(){super({key:"TumblerDialog",title:"Open the lock by aligning all rings",gamepadVisible:!1}),e(this,"player"),e(this,"angles"),e(this,"rings",[]),e(this,"active"),e(this,"nextUpdate"),e(this,"disabled")}init(t){this.player=t.player}preload(){this.load.setPath("assets");for(let t=1;t<=5;t++)this.load.image(`ring_${t}`,`puzzles/tumbler/ring${t}.png`)}create(){super.create(),this.angles=[],this.rings=[],this.active=-1,this.nextUpdate=0,this.disabled=!1;const t=this.add.line(0,30,27,0,216,0,E(C)).setOrigin(0,0).setLineWidth(5);this.container.add(t),this.container.add(this.add.text(.45*-w.width,.2*w.height,"Use [Left]/[Right]\nto select a ring\n\nUse [Up]/[Down]\nto rotate a ring",{...z}));for(let e=0;e<$h.length;e++){let t=Math.floor(Math.random()*Math.PI*2);t=s.Math.Snap.To(t,qh),t=e/5*Math.PI*2,this.angles.push(t),this.circle(e)}this.updateMarkers()}circle(t){const e={x:w.width/2,y:w.height/2},i=this.add.image(0,30,`ring_${t+1}`).setScale(.8).setInteractive({draggable:!0,useHandCursor:!0,pixelPerfect:!0}).on("drag",(i=>{if(this.active=-1,i.isDown){this.active=t;const n=s.Math.Angle.Between(e.x,e.y,i.x,i.y);this.handleMove(t,n)}})).on("dragstart",(i=>{if(this.active=-1,i.isDown){this.active=t;const n=s.Math.Angle.Between(e.x,e.y,i.x,i.y);this.handleMove(t,n)}})).on("dragend",(()=>{this.active=-1,this.updateMarkers(!0)}));this.input.enableDebug(i),this.container.add(i),this.rings.push(i)}handleMove(t,e,i){var s;if(this.disabled)return;const n=this.angles[t]-e;this.angles[t]=e%(2*Math.PI),null==(s=$h[t])||s.forEach(((e,i)=>{i!==t&&(this.angles[i]=(this.angles[i]+e*n)%(2*Math.PI))})),this.updateMarkers(i)}updateMarkers(t){let e=!0;this.angles.forEach(((t,i)=>{var n;const o=s.Math.Snap.To(t,qh);Math.abs(o-0)<.6*qh||Math.abs(o-2*Math.PI)<.6*qh||(e=!1),null==(n=this.rings[i])||n.setAngle(s.Math.RadToDeg(o))})),e&&t&&this.close(!0)}completed(t){this.tweens.add({targets:this.rings,rotation:0,duration:500,onComplete:()=>{this.angles=[0,0,0,0,0],this.updateMarkers(),this.disabled=!0,this.active=-1,this.tweens.add({targets:this.rings,rotation:2*Math.PI,delay:500,duration:1500,hold:1e3,onComplete:t})}})}update(t,e){var i;if(!(t<this.nextUpdate)){if(this.nextUpdate=t+100,!this.disabled){const e=this.keys.keys;e[ht.Left]?(this.nextUpdate=t+300,this.active=s.Math.Clamp(this.active-1,0,this.angles.length-1)):e[ht.Right]?(this.nextUpdate=t+300,this.active=s.Math.Clamp(this.active+1,0,this.angles.length-1)):e[ht.Up]?this.handleMove(this.active,this.angles[this.active]-qh,!0):e[ht.Down]&&this.handleMove(this.active,this.angles[this.active]+qh,!0)}for(let t=0;t<5;t++)null==(i=this.rings[t])||i.setTint(this.active===t?E("C49B7C"):void 0)}}close(t){t?this.completed((()=>super.close(t))):super.close(t)}handleSuccess(t){t&&function(t){const e=t.scene,i=new Nt(e,W.Gear1,t);e.interactiveObjects.add(i);const s=Et(e,V.Chest);s&&(t.setX(s.x-100),s.setTexture("chest_open"),s.disabled=!0,i.disabled=!0,i.setPosition(s.x,s.y-20),i.setScale(.15),e.tweens.add({targets:i,scale:.35,y:s.y+20,duration:700,onComplete:()=>{s.disabled=!1,i.disabled=!1},ease:"Bounce.easeOut"}))}(this.player)}},class extends Ah{constructor(){super({key:"MemoryDialog",title:"Figure out the secret code",gamepadVisible:!1}),e(this,"sequence"),e(this,"pressed"),e(this,"buttons")}preload(){this.load.setPath("assets");for(let t=1;t<=12;t++)this.load.image(`rune_${t}`,`puzzles/runes/Stone${t}.png`)}create(){for(super.create(),this.sequence=[],this.pressed=[];this.sequence.length<6;){const t=s.Math.RND.between(0,11);this.sequence.includes(t)||this.sequence.push(t)}w.prod||this.container.add(this.add.text(0,.43*w.height,`[ ${this.sequence.map((t=>t+1)).join(", ")} ]`,{fontSize:18,align:"center"}).setOrigin(.5)),this.buttons=new Zt(this),this.container.add(this.buttons);const t=w.width/13*1.2,e=[];for(let s=0;s<12;s++){const i=s%3*t-t,n=1.2*-t+Math.floor(s/3)*t,o=Math.floor(s/3);void 0===e[o]&&e.push([]),e[o].push({x:i,y:n});const r=this.add.image(i,n,`rune_${s+1}`).setInteractive({useHandCursor:!0});r.on("pointerdown",(()=>this.onButtonPress(r,s))),this.buttons.add(r)}const i=new Hh(this,{regions:e,size:t,keyHandler:t=>{const e=3*t.y+t.x,i=this.buttons.getAt(e);this.onButtonPress(i,e)}},this.keys);this.container.add(i)}onButtonPress(t,e){const i=this.pressed.length;this.sequence[i]===e?(this.pressed.push(e),t.disableInteractive(),J(this,new s.Display.Color(255,255,255),F(E(T)),(e=>t.setTint(e)),{duration:250,onComplete:()=>{J(this,F(E(T)),F(3355443),(e=>t.setTint(e)),{duration:250,onComplete:()=>{this.sequence.length===this.pressed.length&&this.close(!0)}})}})):(t.disableInteractive(),J(this,new s.Display.Color(255,255,255),F(E(P)),(e=>t.setTint(e)),{duration:250,yoyo:!0,onComplete:()=>{this.buttons.each((t=>{t.setInteractive(),t.setTint(16777215)}))}}),this.pressed=[])}close(t){t?this.completed((()=>super.close(t))):super.close()}completed(t){this.time.delayedCall(300,(()=>{this.buttons.getAll().forEach(((e,i)=>{const s=11===i,n=e.tint,o=F(n),r=F(E(T));e.disableInteractive(),e.setTint(n),J(this,o,r,(t=>e.setTint(t)),{duration:200,delay:70*i,hold:500,onComplete:s?t:void 0})}))}))}handleSuccess(t){}},class extends Ah{constructor(){super({key:"SliderDialog",title:"Arrange the tiles to be in order.",gamepadVisible:!1}),e(this,"solution",[]),e(this,"layout",[]),e(this,"tiles",[])}preload(){this.load.setPath("assets");const t=Math.floor(1024/3);this.load.spritesheet("puzzle","puzzles/puzzle.png",{frameWidth:t,frameHeight:t})}create(){super.create();const t=[];this.solution=Array.from({length:9},((t,e)=>e)),this.layout=[...this.solution],this.tiles=[];for(let i=this.layout.length-1;i>0;i--){const t=Math.floor(Math.random()*(i+1));[this.layout[i],this.layout[t]]=[this.layout[t],this.layout[i]]}this.layout.forEach(((e,i)=>{const s=i%3,n=Math.floor(i/3),o=(s-1)*Vh,r=(n-1)*Vh+30;void 0===t[n]&&(t[n]=[]),t[n].push({x:o,y:r});const a=this.add.image(o,r,"puzzle",i).setOrigin(.5).setDisplaySize(.95*Vh,.95*Vh);this.container.add(a),a.setInteractive({useHandCursor:!0}),a.on("pointerdown",(()=>{this.moveTile(i)})),this.tiles.push(a)}));const e=new Hh(this,{regions:t,size:1.1*Vh,keyHandler:t=>{const e=3*t.y+t.x;this.moveTile(e)}},this.keys);this.container.add(e),this.updateLayout()}moveTile(t){const e=this.layout.indexOf(8),i=e%3,s=Math.floor(e/3),n=t%3,o=Math.floor(t/3);Math.abs(i-n)+Math.abs(s-o)===1&&(this.layout[e]=this.layout[t],this.layout[t]=8,this.updateLayout()),this.layout.join("")===this.solution.join("")&&this.handleSuccess(!0)}updateLayout(){this.layout.forEach(((t,e)=>{this.tiles[e].setFrame(t),this.tiles[e].setVisible(8!=t)}))}completed(t){for(let e=0;e<this.layout.length+1;e++)this.time.delayedCall(150*e,(()=>{e<this.layout.length&&(this.tiles[e].setFrame(e),this.tiles[e].setVisible(8!=e)),e>0&&this.tiles[e-1].setTint(6710886)}));this.time.delayedCall(2e3,t)}close(t){t?this.completed((()=>super.close(t))):super.close(t)}handleSuccess(t){t&&this.time.delayedCall(750,(()=>{this.close(!0)}))}},Ch],pipeline:{CRTPipeline:Kh,XRayPipeline:Yh},input:{gamepad:!0},disableContextMenu:w.prod,physics:{default:"arcade"},render:{pixelArt:!0,antialias:!1},dom:{createContainer:!0},plugins:{global:[{key:"FontPlugin",plugin:h,start:!0}],scene:[{key:"PipelinePlugin",plugin:Xh,mapping:"pipelinePlugin"}]}},Jh=document.querySelector("#initial-loader");null==Jh||Jh.remove(),new s.Game(Qh);
