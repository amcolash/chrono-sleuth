var ch=Object.defineProperty;var dh=(i,t,e)=>t in i?ch(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var d=(i,t,e)=>dh(i,typeof t!="symbol"?t+"":t,e);import{r as fh,g as ph,c as zi,a as gh}from"./phaser-DOKKBh0n.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const yh="modulepreload",mh=function(i,t){return new URL(i,t).href},$n={},vh=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(e.map(h=>{if(h=mh(h,s),h in $n)return;$n[h]=!0;const c=h.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!s)for(let v=a.length-1;v>=0;v--){const y=a[v];if(y.href===h&&(!c||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${u}`))return;const g=document.createElement("link");if(g.rel=c?"stylesheet":yh,c||(g.as="script"),g.crossOrigin="",g.href=h,l&&g.setAttribute("nonce",l),document.head.appendChild(g),c)return new Promise((v,y)=>{g.addEventListener("load",v),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return t().catch(n)})};function bh(i={}){const{immediate:t=!1,onNeedRefresh:e,onOfflineReady:s,onRegistered:r,onRegisteredSW:n,onRegisterError:a}=i;let o,l;const h=async(u=!0)=>{await l};async function c(){if("serviceWorker"in navigator){if(o=await vh(async()=>{const{Workbox:u}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:u}},[],import.meta.url).then(({Workbox:u})=>new u("./sw.js",{scope:"./",type:"classic"})).catch(u=>{a==null||a(u)}),!o)return;o.addEventListener("activated",u=>{(u.isUpdate||u.isExternal)&&window.location.reload()}),o.addEventListener("installed",u=>{u.isUpdate||s==null||s()}),o.register({immediate:t}).then(u=>{n?n("./sw.js",u):r==null||r(u)}).catch(u=>{a==null||a(u)})}}return l=c(),h}var E=fh();const wh={width:1280,height:720},il={width:960,height:540};let sl=!1,rl=!1,Sh=!1,an=!1;an=!0;let Qt=!0;const Wn=localStorage.getItem("chrono-sleuth-prod");Wn!==null&&(Qt=Wn==="true");let nl,al=Qt;al=!0;let ol=!1;Qt&&(ol=!1);const{width:xh,height:zn}=il;Qt&&(sl=!1,an=!1,Qt=!0,nl=void 0,rl=!1);const f={debug:sl,phaserInspector:rl,prod:Qt,bootDialog:nl,useShader:al,width:xh,height:zn,cameraOffset:zn/4,zoomed:!0,dayMinutes:.25,rewindEnabled:Sh,fastMode:an,perfTest:ol};var Ae=(i=>(i[i.None=0]="None",i[i.Teleported=1]="Teleported",i[i.Talked=2]="Talked",i[i.Item=3]="Item",i[i.Prop=4]="Prop",i))(Ae||{}),M=(i=>(i[i.Station=0]="Station",i[i.Town=1]="Town",i[i.TownEast=2]="TownEast",i[i.Forest=3]="Forest",i[i.ForestEast=4]="ForestEast",i[i.Lake=5]="Lake",i[i.TownNorth=6]="TownNorth",i[i.ClockSquare=7]="ClockSquare",i[i.ClockSquareNorth=8]="ClockSquareNorth",i[i.ClockEntrance=9]="ClockEntrance",i[i.ClockStairs=10]="ClockStairs",i[i.ClockTop=11]="ClockTop",i[i.TownWest=12]="TownWest",i[i.MansionGrounds=13]="MansionGrounds",i[i.MansionEntrance=14]="MansionEntrance",i[i.Mansion=15]="Mansion",i[i.LabHatch=16]="LabHatch",i[i.Lab=17]="Lab",i[i.LibraryEntrance=18]="LibraryEntrance",i[i.Library=19]="Library",i[i.TownHallEntrance=20]="TownHallEntrance",i[i.TownHall=21]="TownHall",i[i.InnEntrance=22]="InnEntrance",i[i.Inn=23]="Inn",i))(M||{}),I=(i=>(i[i.Wrench=0]="Wrench",i[i.Gear1=1]="Gear1",i[i.Key=2]="Key",i[i.HerbRed=3]="HerbRed",i[i.HerbGreen=4]="HerbGreen",i[i.HerbBlue=5]="HerbBlue",i[i.Potion=6]="Potion",i[i.Gear2=7]="Gear2",i[i.Note=8]="Note",i))(I||{}),B=(i=>(i[i.ForestGear=0]="ForestGear",i[i.SphinxRiddle=1]="SphinxRiddle",i[i.InvestigateTownWest=2]="InvestigateTownWest",i[i.ExploreLab=3]="ExploreLab",i[i.FindPotionIngredients=4]="FindPotionIngredients",i))(B||{}),le=(i=>(i[i.Inventor=0]="Inventor",i[i.Stranger=1]="Stranger",i[i.Sphinx=2]="Sphinx",i[i.Mayor=3]="Mayor",i[i.Innkeeper=4]="Innkeeper",i[i.Baker=5]="Baker",i))(le||{}),Gi=(i=>(i[i.Sphinx=0]="Sphinx",i))(Gi||{}),D=(i=>(i[i.FixTheClock=0]="FixTheClock",i[i.MetTheMayor=1]="MetTheMayor",i[i.ClockFirstGear=2]="ClockFirstGear",i[i.AlchemyLabFound=3]="AlchemyLabFound",i[i.AlchemySetFixed=4]="AlchemySetFixed",i[i.ExtraPotionInformation=5]="ExtraPotionInformation",i[i.SafeDiscovered=6]="SafeDiscovered",i[i.ClockSecondGear=7]="ClockSecondGear",i))(D||{}),G=(i=>(i[i.ClockTower=0]="ClockTower",i[i.Chest=1]="Chest",i[i.LabHatch=2]="LabHatch",i[i.LabBook=3]="LabBook",i[i.AlchemySet=4]="AlchemySet",i[i.LabBookshelf1=5]="LabBookshelf1",i[i.LabBookshelf2=6]="LabBookshelf2",i[i.LabBookshelf3=7]="LabBookshelf3",i[i.LabPotionShelf1=8]="LabPotionShelf1",i[i.MansionPicture=9]="MansionPicture",i[i.MansionHole=10]="MansionHole",i[i.Bed=11]="Bed",i[i.LibraryShelf=12]="LibraryShelf",i))(G||{}),Ct=(i=>(i[i.LabStairs=0]="LabStairs",i[i.InnStairs=1]="InnStairs",i))(Ct||{}),N=(i=>(i.Town="Town",i.Station="Train Station",i.ClockOutside="Clock Tower Square",i.ClockInner="Clock Tower",i.Forest="Strange Woods",i.Lake="Lake Epoch",i.MansionOutside="Mansion Grounds",i.MansionInside="Mansion",i.AlchemyLab="Secret Alchemy Lab",i.Library="Library",i.TownHall="Town Hall",i.Inn="Inn",i))(N||{}),we=(i=>(i.Intro="music-intro",i.Station="music-station",i.Town="music-town",i.Mansion="music-mansion",i.Forest="music-forest",i.Clock="music-clock",i))(we||{}),qt=(i=>(i[i.Library=0]="Library",i[i.Inn=1]="Inn",i[i.Train=2]="Train",i))(qt||{});const Kr={[we.Intro]:{locations:[],volume:.4},[we.Station]:{locations:[N.Station],volume:.5},[we.Town]:{locations:[N.Town,N.Library,N.Inn],volume:.5},[we.Clock]:{locations:[N.ClockInner,N.ClockOutside],volume:.5},[we.Forest]:{locations:[N.Forest,N.Lake],volume:.5},[we.Mansion]:{locations:[N.MansionInside,N.MansionOutside,N.AlchemyLab],volume:.5}},on={[we.Station]:"sounds/music/Unknown.mp3",[we.Clock]:"sounds/music/Night Time Scavenge II.mp3",[we.Mansion]:"sounds/music/Reflective District.mp3",[we.Forest]:"sounds/music/Serene.mp3",[we.Intro]:"sounds/music/A New Day's Hurry.mp3",[we.Town]:"sounds/music/A Different Kind Of Journey.mp3"};let me;function kh(i){me=new Eh(i)}class Eh{constructor(t){d(this,"sound");d(this,"music");d(this,"volume",.5);d(this,"scene");this.sound=t,t.on("mute",(e,s)=>{this.music&&(s?Gn(this.scene,this.music):ys(this.scene,this.music,this.volume))}),t.once("unlocked",()=>{this.music&&!this.music.isPlaying&&ys(this.scene,this.music,this.volume)})}start(t,e){var s,r;this.sound.mute||this.sound.locked||((s=this.music)==null?void 0:s.key)===t&&((r=this.music)!=null&&r.isPlaying)||this.scene.load.isLoading()||(this.stop(),this.volume=e||Kr[t].volume||.5,this.scene.cache.audio.exists(t)&&(this.music=this.sound.get(t)||this.sound.add(t,{loop:!0,volume:this.volume}),ys(this.scene,this.music,this.volume)))}stop(){this.music&&Gn(this.scene,this.music),this.music=void 0}setScene(t){this.scene=t,this.scene.load.setPath("assets")}getLocationMusic(t){const e=Object.entries(Kr).find(([s,r])=>r.locations.includes(t));if(e)return e[0]}fadeMusic(t,e=500,s){this.music&&this.scene.tweens.add({targets:this.music,volume:t,duration:e,onComplete:s})}}function ys(i,t,e=.5,s=500){i&&t&&!t.pendingRemove&&(t.play({volume:0,loop:!0}),i.tweens.getTweensOf(t).forEach(r=>r.stop()),i.tweens.add({targets:t,volume:e,duration:s}))}function Gn(i,t,e=500){i&&t.isPlaying?(i.tweens.getTweensOf(t).forEach(s=>s.stop()),i.tweens.add({targets:t,volume:0,duration:e,onComplete:()=>t.stop()})):t.stop()}const _={White:"fcfee9",Tan:"e6c99d",Brown:"473946",Slate:"303646",Teal:"008080",Black:"1c1831",Note:"222222",Warning:"993333",Success:"339933",Lights:"ffccaa",Night:"335588",Background:"111111",ButtonActive:"ddaaee"};function L(i){return E.Display.Color.HexStringToColor(i).color}function ln(i){return L(E.Display.Color.RGBToString(i.r*255,i.g*255,i.b*255))}function Oh(i){return L(E.Display.Color.RGBToString(i.r,i.g,i.b))}function ut(i){const t=E.Display.Color.ColorToRGBA(i);return new E.Display.Color(t.r,t.g,t.b,t.a)}function jt(i,t,e,s,r){const n=(r.duration||100)*.3;return i.tweens.addCounter({from:0,to:n,onUpdate:a=>{const o=E.Display.Color.Interpolate.ColorWithColor(t,e,n,a.getValue());s(Oh(o))},...r})}const ji=1200;let Hi=!1;function ll(i){return ln(i.lights.ambientColor)===L(_.White)}function yi(i){return ln(i.lights.ambientColor)===L(_.Night)}function hl(i,t=!0){Hi||(ul(i,_.White,t),t?i.time.delayedCall(ji,()=>Qr(i,.5)):Qr(i,.5),i.lights.lights.forEach(e=>{const s=e.intensity;t?i.tweens.add({targets:e,duration:ji,intensity:0,onComplete:()=>{e.setVisible(!1),e.setIntensity(s)}}):e.setVisible(!1)}))}function Ih(i,t=!0){Hi||(ul(i,_.Night,t),Qr(i,1),i.lights.lights.forEach(e=>{const s=e.intensity;e.setVisible(!0),t&&(e.setIntensity(0),i.tweens.add({targets:e,duration:ji,intensity:s}))}))}function ul(i,t,e){if(!e){i.lights.setAmbientColor(L(t));return}Hi=!0;const s=ln(i.lights.ambientColor),r=E.Display.Color.ValueToColor(s),n=E.Display.Color.ValueToColor(t);jt(i,r,n,a=>i.lights.setAmbientColor(a),{duration:ji,onComplete:()=>{Hi=!1}})}function Qr(i,t){i.children.getAll("name","DebugLightGraphics").forEach(s=>s.setAlpha(t))}var ms,jn;function cl(){if(jn)return ms;jn=1;var i=Object.prototype.toString;return ms=function(e){var s=i.call(e),r=s==="[object Arguments]";return r||(r=s!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&i.call(e.callee)==="[object Function]"),r},ms}var vs,Hn;function Th(){if(Hn)return vs;Hn=1;var i;if(!Object.keys){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,s=cl(),r=Object.prototype.propertyIsEnumerable,n=!r.call({toString:null},"toString"),a=r.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(p){var g=p.constructor;return g&&g.prototype===p},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!h["$"+p]&&t.call(window,p)&&window[p]!==null&&typeof window[p]=="object")try{l(window[p])}catch{return!0}}catch{return!0}return!1}(),u=function(p){if(typeof window>"u"||!c)return l(p);try{return l(p)}catch{return!1}};i=function(g){var v=g!==null&&typeof g=="object",y=e.call(g)==="[object Function]",m=s(g),w=v&&e.call(g)==="[object String]",k=[];if(!v&&!y&&!m)throw new TypeError("Object.keys called on a non-object");var x=a&&y;if(w&&g.length>0&&!t.call(g,0))for(var T=0;T<g.length;++T)k.push(String(T));if(m&&g.length>0)for(var C=0;C<g.length;++C)k.push(String(C));else for(var F in g)!(x&&F==="prototype")&&t.call(g,F)&&k.push(String(F));if(n)for(var K=u(g),$=0;$<o.length;++$)!(K&&o[$]==="constructor")&&t.call(g,o[$])&&k.push(o[$]);return k}}return vs=i,vs}var bs,Un;function hn(){if(Un)return bs;Un=1;var i=Array.prototype.slice,t=cl(),e=Object.keys,s=e?function(a){return e(a)}:Th(),r=Object.keys;return s.shim=function(){if(Object.keys){var a=function(){var o=Object.keys(arguments);return o&&o.length===arguments.length}(1,2);a||(Object.keys=function(l){return t(l)?r(i.call(l)):r(l)})}else Object.keys=s;return Object.keys||s},bs=s,bs}var ws,qn;function Ph(){return qn||(qn=1,ws=Error),ws}var Ss,Vn;function Ch(){return Vn||(Vn=1,Ss=EvalError),Ss}var xs,Xn;function Ah(){return Xn||(Xn=1,xs=RangeError),xs}var ks,Yn;function Rh(){return Yn||(Yn=1,ks=ReferenceError),ks}var Es,Kn;function dl(){return Kn||(Kn=1,Es=SyntaxError),Es}var Os,Qn;function pt(){return Qn||(Qn=1,Os=TypeError),Os}var Is,Jn;function Mh(){return Jn||(Jn=1,Is=URIError),Is}var Ts,Zn;function Qi(){return Zn||(Zn=1,Ts=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),s=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(s)!=="[object Symbol]")return!1;var r=42;t[e]=r;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var n=Object.getOwnPropertySymbols(t);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,e);if(a.value!==r||a.enumerable!==!0)return!1}return!0}),Ts}var Ps,ea;function un(){if(ea)return Ps;ea=1;var i=typeof Symbol<"u"&&Symbol,t=Qi();return Ps=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Ps}var Cs,ta;function _h(){if(ta)return Cs;ta=1;var i={__proto__:null,foo:{}},t=Object;return Cs=function(){return{__proto__:i}.foo===i.foo&&!(i instanceof t)},Cs}var As,ia;function Dh(){if(ia)return As;ia=1;var i="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,s="[object Function]",r=function(l,h){for(var c=[],u=0;u<l.length;u+=1)c[u]=l[u];for(var p=0;p<h.length;p+=1)c[p+l.length]=h[p];return c},n=function(l,h){for(var c=[],u=h,p=0;u<l.length;u+=1,p+=1)c[p]=l[u];return c},a=function(o,l){for(var h="",c=0;c<o.length;c+=1)h+=o[c],c+1<o.length&&(h+=l);return h};return As=function(l){var h=this;if(typeof h!="function"||t.apply(h)!==s)throw new TypeError(i+h);for(var c=n(arguments,1),u,p=function(){if(this instanceof u){var w=h.apply(this,r(c,arguments));return Object(w)===w?w:this}return h.apply(l,r(c,arguments))},g=e(0,h.length-c.length),v=[],y=0;y<g;y++)v[y]="$"+y;if(u=Function("binder","return function ("+a(v,",")+"){ return binder.apply(this,arguments); }")(p),h.prototype){var m=function(){};m.prototype=h.prototype,u.prototype=new m,m.prototype=null}return u},As}var Rs,sa;function cn(){if(sa)return Rs;sa=1;var i=Dh();return Rs=Function.prototype.bind||i,Rs}var Ms,ra;function fl(){if(ra)return Ms;ra=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=cn();return Ms=e.call(i,t),Ms}var _s,na;function Je(){if(na)return _s;na=1;var i,t=Ph(),e=Ch(),s=Ah(),r=Rh(),n=dl(),a=pt(),o=Mh(),l=Function,h=function(ve){try{return l('"use strict"; return ('+ve+").constructor;")()}catch{}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch{c=null}var u=function(){throw new a},p=c?function(){try{return arguments.callee,u}catch{try{return c(arguments,"callee").get}catch{return u}}}():u,g=un()(),v=_h()(),y=Object.getPrototypeOf||(v?function(ve){return ve.__proto__}:null),m={},w=typeof Uint8Array>"u"||!y?i:y(Uint8Array),k={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":g&&y?y([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":m,"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":m,"%AsyncIteratorPrototype%":m,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":e,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":m,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&y?y(y([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!g||!y?i:y(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":s,"%ReferenceError%":r,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!g||!y?i:y(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&y?y(""[Symbol.iterator]()):i,"%Symbol%":g?Symbol:i,"%SyntaxError%":n,"%ThrowTypeError%":p,"%TypedArray%":w,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet};if(y)try{null.error}catch(ve){var x=y(y(ve));k["%Error.prototype%"]=x}var T=function ve(ie){var J;if(ie==="%AsyncFunction%")J=h("async function () {}");else if(ie==="%GeneratorFunction%")J=h("function* () {}");else if(ie==="%AsyncGeneratorFunction%")J=h("async function* () {}");else if(ie==="%AsyncGenerator%"){var re=ve("%AsyncGeneratorFunction%");re&&(J=re.prototype)}else if(ie==="%AsyncIteratorPrototype%"){var fe=ve("%AsyncGenerator%");fe&&y&&(J=y(fe.prototype))}return k[ie]=J,J},C={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},F=cn(),K=fl(),$=F.call(Function.call,Array.prototype.concat),R=F.call(Function.apply,Array.prototype.splice),Y=F.call(Function.call,String.prototype.replace),Q=F.call(Function.call,String.prototype.slice),ae=F.call(Function.call,RegExp.prototype.exec),ne=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Oe=/\\(\\)?/g,ce=function(ie){var J=Q(ie,0,1),re=Q(ie,-1);if(J==="%"&&re!=="%")throw new n("invalid intrinsic syntax, expected closing `%`");if(re==="%"&&J!=="%")throw new n("invalid intrinsic syntax, expected opening `%`");var fe=[];return Y(ie,ne,function(ke,De,O,P){fe[fe.length]=O?Y(P,Oe,"$1"):De||ke}),fe},Ve=function(ie,J){var re=ie,fe;if(K(C,re)&&(fe=C[re],re="%"+fe[0]+"%"),K(k,re)){var ke=k[re];if(ke===m&&(ke=T(re)),typeof ke>"u"&&!J)throw new a("intrinsic "+ie+" exists, but is not available. Please file an issue!");return{alias:fe,name:re,value:ke}}throw new n("intrinsic "+ie+" does not exist!")};return _s=function(ie,J){if(typeof ie!="string"||ie.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof J!="boolean")throw new a('"allowMissing" argument must be a boolean');if(ae(/^%?[^%]*%?$/,ie)===null)throw new n("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var re=ce(ie),fe=re.length>0?re[0]:"",ke=Ve("%"+fe+"%",J),De=ke.name,O=ke.value,P=!1,q=ke.alias;q&&(fe=q[0],R(re,$([0,1],q)));for(var W=1,z=!0;W<re.length;W+=1){var Z=re[W],ee=Q(Z,0,1),te=Q(Z,-1);if((ee==='"'||ee==="'"||ee==="`"||te==='"'||te==="'"||te==="`")&&ee!==te)throw new n("property names with quotes must have matching quotes");if((Z==="constructor"||!z)&&(P=!0),fe+="."+Z,De="%"+fe+"%",K(k,De))O=k[De];else if(O!=null){if(!(Z in O)){if(!J)throw new a("base intrinsic for "+ie+" exists, but the property is not available.");return}if(c&&W+1>=re.length){var j=c(O,Z);z=!!j,z&&"get"in j&&!("originalValue"in j.get)?O=j.get:O=O[Z]}else z=K(O,Z),O=O[Z];z&&!P&&(k[De]=O)}}return O},_s}var Ds,aa;function dn(){if(aa)return Ds;aa=1;var i=Je(),t=i("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Ds=t,Ds}var Ls,oa;function fn(){if(oa)return Ls;oa=1;var i=Je(),t=i("%Object.getOwnPropertyDescriptor%",!0);if(t)try{t([],"length")}catch{t=null}return Ls=t,Ls}var Bs,la;function pn(){if(la)return Bs;la=1;var i=dn(),t=dl(),e=pt(),s=fn();return Bs=function(n,a,o){if(!n||typeof n!="object"&&typeof n!="function")throw new e("`obj` must be an object or a function`");if(typeof a!="string"&&typeof a!="symbol")throw new e("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new e("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new e("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new e("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new e("`loose`, if provided, must be a boolean");var l=arguments.length>3?arguments[3]:null,h=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,p=!!s&&s(n,a);if(i)i(n,a,{configurable:c===null&&p?p.configurable:!c,enumerable:l===null&&p?p.enumerable:!l,value:o,writable:h===null&&p?p.writable:!h});else if(u||!l&&!h&&!c)n[a]=o;else throw new t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Bs}var Fs,ha;function gn(){if(ha)return Fs;ha=1;var i=dn(),t=function(){return!!i};return t.hasArrayLengthDefineBug=function(){if(!i)return null;try{return i([],"length",{value:1}).length!==1}catch{return!0}},Fs=t,Fs}var Ns,ua;function At(){if(ua)return Ns;ua=1;var i=hn(),t=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",e=Object.prototype.toString,s=Array.prototype.concat,r=pn(),n=function(h){return typeof h=="function"&&e.call(h)==="[object Function]"},a=gn()(),o=function(h,c,u,p){if(c in h){if(p===!0){if(h[c]===u)return}else if(!n(p)||!p())return}a?r(h,c,u,!0):r(h,c,u)},l=function(h,c){var u=arguments.length>2?arguments[2]:{},p=i(c);t&&(p=s.call(p,Object.getOwnPropertySymbols(c)));for(var g=0;g<p.length;g+=1)o(h,p[g],c[p[g]],u[p[g]])};return l.supportsDescriptors=!!a,Ns=l,Ns}var $s={exports:{}},Ws,ca;function Lh(){if(ca)return Ws;ca=1;var i=Je(),t=pn(),e=gn()(),s=fn(),r=pt(),n=i("%Math.floor%");return Ws=function(o,l){if(typeof o!="function")throw new r("`fn` is not a function");if(typeof l!="number"||l<0||l>4294967295||n(l)!==l)throw new r("`length` must be a positive 32-bit integer");var h=arguments.length>2&&!!arguments[2],c=!0,u=!0;if("length"in o&&s){var p=s(o,"length");p&&!p.configurable&&(c=!1),p&&!p.writable&&(u=!1)}return(c||u||!h)&&(e?t(o,"length",l,!0,!0):t(o,"length",l)),o},Ws}var da;function Zt(){return da||(da=1,function(i){var t=cn(),e=Je(),s=Lh(),r=pt(),n=e("%Function.prototype.apply%"),a=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||t.call(a,n),l=dn(),h=e("%Math.max%");i.exports=function(p){if(typeof p!="function")throw new r("a function is required");var g=o(t,a,arguments);return s(g,1+h(0,p.length-(arguments.length-1)),!0)};var c=function(){return o(t,n,arguments)};l?l(i.exports,"apply",{value:c}):i.exports.apply=c}($s)),$s.exports}var zs,fa;function Ge(){if(fa)return zs;fa=1;var i=Je(),t=Zt(),e=t(i("String.prototype.indexOf"));return zs=function(r,n){var a=i(r,!!n);return typeof a=="function"&&e(r,".prototype.")>-1?t(a):a},zs}var Gs,pa;function pl(){if(pa)return Gs;pa=1;var i=hn(),t=Qi()(),e=Ge(),s=Object,r=e("Array.prototype.push"),n=e("Object.prototype.propertyIsEnumerable"),a=t?Object.getOwnPropertySymbols:null;return Gs=function(l,h){if(l==null)throw new TypeError("target must be an object");var c=s(l);if(arguments.length===1)return c;for(var u=1;u<arguments.length;++u){var p=s(arguments[u]),g=i(p),v=t&&(Object.getOwnPropertySymbols||a);if(v)for(var y=v(p),m=0;m<y.length;++m){var w=y[m];n(p,w)&&r(g,w)}for(var k=0;k<g.length;++k){var x=g[k];if(n(p,x)){var T=p[x];c[x]=T}}}return c},Gs}var js,ga;function gl(){if(ga)return js;ga=1;var i=pl(),t=function(){if(!Object.assign)return!1;for(var s="abcdefghijklmnopqrst",r=s.split(""),n={},a=0;a<r.length;++a)n[r[a]]=r[a];var o=Object.assign({},n),l="";for(var h in o)l+=h;return s!==l},e=function(){if(!Object.assign||!Object.preventExtensions)return!1;var s=Object.preventExtensions({1:2});try{Object.assign(s,"xy")}catch{return s[1]==="y"}return!1};return js=function(){return!Object.assign||t()||e()?i:Object.assign},js}var Hs,ya;function Bh(){if(ya)return Hs;ya=1;var i=At(),t=gl();return Hs=function(){var s=t();return i(Object,{assign:s},{assign:function(){return Object.assign!==s}}),s},Hs}var Us,ma;function Fh(){if(ma)return Us;ma=1;var i=At(),t=Zt(),e=pl(),s=gl(),r=Bh(),n=t.apply(s()),a=function(l,h){return n(Object,arguments)};return i(a,{getPolyfill:s,implementation:e,shim:r}),Us=a,Us}var qs,va;function Nh(){if(va)return qs;va=1;var i=function(){return typeof(function(){}).name=="string"},t=Object.getOwnPropertyDescriptor;if(t)try{t([],"length")}catch{t=null}i.functionsHaveConfigurableNames=function(){if(!i()||!t)return!1;var r=t(function(){},"name");return!!r&&!!r.configurable};var e=Function.prototype.bind;return i.boundFunctionsHaveNames=function(){return i()&&typeof e=="function"&&(function(){}).bind().name!==""},qs=i,qs}var Vs,ba;function $h(){if(ba)return Vs;ba=1;var i=pn(),t=gn()(),e=Nh().functionsHaveConfigurableNames(),s=pt();return Vs=function(n,a){if(typeof n!="function")throw new s("`fn` is not a function");var o=arguments.length>2&&!!arguments[2];return(!o||e)&&(t?i(n,"name",a,!0,!0):i(n,"name",a)),n},Vs}var Xs,wa;function yl(){if(wa)return Xs;wa=1;var i=$h(),t=pt(),e=Object;return Xs=i(function(){if(this==null||this!==e(this))throw new t("RegExp.prototype.flags getter called on non-object");var r="";return this.hasIndices&&(r+="d"),this.global&&(r+="g"),this.ignoreCase&&(r+="i"),this.multiline&&(r+="m"),this.dotAll&&(r+="s"),this.unicode&&(r+="u"),this.unicodeSets&&(r+="v"),this.sticky&&(r+="y"),r},"get flags",!0),Xs}var Ys,Sa;function ml(){if(Sa)return Ys;Sa=1;var i=yl(),t=At().supportsDescriptors,e=Object.getOwnPropertyDescriptor;return Ys=function(){if(t&&/a/mig.flags==="gim"){var r=e(RegExp.prototype,"flags");if(r&&typeof r.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var n="",a={};if(Object.defineProperty(a,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(a,"sticky",{get:function(){n+="y"}}),r.get.call(a),n==="dy")return r.get}}return i},Ys}var Ks,xa;function Wh(){if(xa)return Ks;xa=1;var i=At().supportsDescriptors,t=ml(),e=Object.getOwnPropertyDescriptor,s=Object.defineProperty,r=TypeError,n=Object.getPrototypeOf,a=/a/;return Ks=function(){if(!i||!n)throw new r("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var l=t(),h=n(a),c=e(h,"flags");return(!c||c.get!==l)&&s(h,"flags",{configurable:!0,enumerable:!1,get:l}),l},Ks}var Qs,ka;function zh(){if(ka)return Qs;ka=1;var i=At(),t=Zt(),e=yl(),s=ml(),r=Wh(),n=t(s());return i(n,{getPolyfill:s,implementation:e,shim:r}),Qs=n,Qs}var ri={exports:{}},Js,Ea;function Rt(){if(Ea)return Js;Ea=1;var i=Qi();return Js=function(){return i()&&!!Symbol.toStringTag},Js}var Zs,Oa;function vl(){if(Oa)return Zs;Oa=1;var i=Rt()(),t=Ge(),e=t("Object.prototype.toString"),s=function(o){return i&&o&&typeof o=="object"&&Symbol.toStringTag in o?!1:e(o)==="[object Arguments]"},r=function(o){return s(o)?!0:o!==null&&typeof o=="object"&&typeof o.length=="number"&&o.length>=0&&e(o)!=="[object Array]"&&e(o.callee)==="[object Function]"},n=function(){return s(arguments)}();return s.isLegacyArguments=r,Zs=n?s:r,Zs}const Gh={},jh=Object.freeze(Object.defineProperty({__proto__:null,default:Gh},Symbol.toStringTag,{value:"Module"})),Hh=ph(jh);var er,Ia;function Uh(){if(Ia)return er;Ia=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,s=i&&Map.prototype.forEach,r=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=r&&n&&typeof n.get=="function"?n.get:null,o=r&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,h=l?WeakMap.prototype.has:null,c=typeof WeakSet=="function"&&WeakSet.prototype,u=c?WeakSet.prototype.has:null,p=typeof WeakRef=="function"&&WeakRef.prototype,g=p?WeakRef.prototype.deref:null,v=Boolean.prototype.valueOf,y=Object.prototype.toString,m=Function.prototype.toString,w=String.prototype.match,k=String.prototype.slice,x=String.prototype.replace,T=String.prototype.toUpperCase,C=String.prototype.toLowerCase,F=RegExp.prototype.test,K=Array.prototype.concat,$=Array.prototype.join,R=Array.prototype.slice,Y=Math.floor,Q=typeof BigInt=="function"?BigInt.prototype.valueOf:null,ae=Object.getOwnPropertySymbols,ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Oe=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ce=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Oe||!0)?Symbol.toStringTag:null,Ve=Object.prototype.propertyIsEnumerable,ve=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(b){return b.__proto__}:null);function ie(b,S){if(b===1/0||b===-1/0||b!==b||b&&b>-1e3&&b<1e3||F.call(/e/,S))return S;var se=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof b=="number"){var he=b<0?-Y(-b):Y(b);if(he!==b){var ue=String(he),X=k.call(S,ue.length+1);return x.call(ue,se,"$&_")+"."+x.call(x.call(X,/([0-9]{3})/g,"$&_"),/_$/,"")}}return x.call(S,se,"$&_")}var J=Hh,re=J.custom,fe=oe(re)?re:null,ke={__proto__:null,double:'"',single:"'"},De={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};er=function b(S,se,he,ue){var X=se||{};if(Pe(X,"quoteStyle")&&!Pe(ke,X.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Pe(X,"maxStringLength")&&(typeof X.maxStringLength=="number"?X.maxStringLength<0&&X.maxStringLength!==1/0:X.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var at=Pe(X,"customInspect")?X.customInspect:!0;if(typeof at!="boolean"&&at!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Pe(X,"indent")&&X.indent!==null&&X.indent!=="	"&&!(parseInt(X.indent,10)===X.indent&&X.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Pe(X,"numericSeparator")&&typeof X.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var kt=X.numericSeparator;if(typeof S>"u")return"undefined";if(S===null)return"null";if(typeof S=="boolean")return S?"true":"false";if(typeof S=="string")return $e(S,X);if(typeof S=="number"){if(S===0)return 1/0/S>0?"0":"-0";var Le=String(S);return kt?ie(S,Le):Le}if(typeof S=="bigint"){var ot=String(S)+"n";return kt?ie(S,ot):ot}var hs=typeof X.depth>"u"?5:X.depth;if(typeof he>"u"&&(he=0),he>=hs&&hs>0&&typeof S=="object")return q(S)?"[Array]":"[Object]";var Dt=lh(X,he);if(typeof ue>"u")ue=[];else if(rt(ue,S)>=0)return"[Circular]";function He(Lt,wi,uh){if(wi&&(ue=R.call(ue),ue.push(wi)),uh){var Nn={depth:X.depth};return Pe(X,"quoteStyle")&&(Nn.quoteStyle=X.quoteStyle),b(Lt,Nn,he+1,ue)}return b(Lt,X,he+1,ue)}if(typeof S=="function"&&!z(S)){var Rn=yt(S),Mn=vi(S,He);return"[Function"+(Rn?": "+Rn:" (anonymous)")+"]"+(Mn.length>0?" { "+$.call(Mn,", ")+" }":"")}if(oe(S)){var _n=Oe?x.call(String(S),/^(Symbol\(.*\))_[^)]*$/,"$1"):ne.call(S);return typeof S=="object"&&!Oe?We(_n):_n}if(xt(S)){for(var si="<"+C.call(String(S.nodeName)),us=S.attributes||[],bi=0;bi<us.length;bi++)si+=" "+us[bi].name+"="+O(P(us[bi].value),"double",X);return si+=">",S.childNodes&&S.childNodes.length&&(si+="..."),si+="</"+C.call(String(S.nodeName))+">",si}if(q(S)){if(S.length===0)return"[]";var cs=vi(S,He);return Dt&&!oh(cs)?"["+ls(cs,Dt)+"]":"[ "+$.call(cs,", ")+" ]"}if(Z(S)){var ds=vi(S,He);return!("cause"in Error.prototype)&&"cause"in S&&!Ve.call(S,"cause")?"{ ["+String(S)+"] "+$.call(K.call("[cause]: "+He(S.cause),ds),", ")+" }":ds.length===0?"["+String(S)+"]":"{ ["+String(S)+"] "+$.call(ds,", ")+" }"}if(typeof S=="object"&&at){if(fe&&typeof S[fe]=="function"&&J)return J(S,{depth:hs-he});if(at!=="symbol"&&typeof S.inspect=="function")return S.inspect()}if(mt(S)){var Dn=[];return s&&s.call(S,function(Lt,wi){Dn.push(He(wi,S,!0)+" => "+He(Lt,S))}),An("Map",e.call(S),Dn,Dt)}if(wt(S)){var Ln=[];return o&&o.call(S,function(Lt){Ln.push(He(Lt,S))}),An("Set",a.call(S),Ln,Dt)}if(vt(S))return _t("WeakMap");if(St(S))return _t("WeakSet");if(bt(S))return _t("WeakRef");if(te(S))return We(He(Number(S)));if(je(S))return We(He(Q.call(S)));if(j(S))return We(v.call(S));if(ee(S))return We(He(String(S)));if(typeof window<"u"&&S===window)return"{ [object Window] }";if(typeof globalThis<"u"&&S===globalThis||typeof zi<"u"&&S===zi)return"{ [object globalThis] }";if(!W(S)&&!z(S)){var fs=vi(S,He),Bn=ve?ve(S)===Object.prototype:S instanceof Object||S.constructor===Object,ps=S instanceof Object?"":"null prototype",Fn=!Bn&&ce&&Object(S)===S&&ce in S?k.call(Re(S),8,-1):ps?"Object":"",hh=Bn||typeof S.constructor!="function"?"":S.constructor.name?S.constructor.name+" ":"",gs=hh+(Fn||ps?"["+$.call(K.call([],Fn||[],ps||[]),": ")+"] ":"");return fs.length===0?gs+"{}":Dt?gs+"{"+ls(fs,Dt)+"}":gs+"{ "+$.call(fs,", ")+" }"}return String(S)};function O(b,S,se){var he=se.quoteStyle||S,ue=ke[he];return ue+b+ue}function P(b){return x.call(String(b),/"/g,"&quot;")}function q(b){return Re(b)==="[object Array]"&&(!ce||!(typeof b=="object"&&ce in b))}function W(b){return Re(b)==="[object Date]"&&(!ce||!(typeof b=="object"&&ce in b))}function z(b){return Re(b)==="[object RegExp]"&&(!ce||!(typeof b=="object"&&ce in b))}function Z(b){return Re(b)==="[object Error]"&&(!ce||!(typeof b=="object"&&ce in b))}function ee(b){return Re(b)==="[object String]"&&(!ce||!(typeof b=="object"&&ce in b))}function te(b){return Re(b)==="[object Number]"&&(!ce||!(typeof b=="object"&&ce in b))}function j(b){return Re(b)==="[object Boolean]"&&(!ce||!(typeof b=="object"&&ce in b))}function oe(b){if(Oe)return b&&typeof b=="object"&&b instanceof Symbol;if(typeof b=="symbol")return!0;if(!b||typeof b!="object"||!ne)return!1;try{return ne.call(b),!0}catch{}return!1}function je(b){if(!b||typeof b!="object"||!Q)return!1;try{return Q.call(b),!0}catch{}return!1}var Te=Object.prototype.hasOwnProperty||function(b){return b in this};function Pe(b,S){return Te.call(b,S)}function Re(b){return y.call(b)}function yt(b){if(b.name)return b.name;var S=w.call(m.call(b),/^function\s*([\w$]+)/);return S?S[1]:null}function rt(b,S){if(b.indexOf)return b.indexOf(S);for(var se=0,he=b.length;se<he;se++)if(b[se]===S)return se;return-1}function mt(b){if(!e||!b||typeof b!="object")return!1;try{e.call(b);try{a.call(b)}catch{return!0}return b instanceof Map}catch{}return!1}function vt(b){if(!h||!b||typeof b!="object")return!1;try{h.call(b,h);try{u.call(b,u)}catch{return!0}return b instanceof WeakMap}catch{}return!1}function bt(b){if(!g||!b||typeof b!="object")return!1;try{return g.call(b),!0}catch{}return!1}function wt(b){if(!a||!b||typeof b!="object")return!1;try{a.call(b);try{e.call(b)}catch{return!0}return b instanceof Set}catch{}return!1}function St(b){if(!u||!b||typeof b!="object")return!1;try{u.call(b,u);try{h.call(b,h)}catch{return!0}return b instanceof WeakSet}catch{}return!1}function xt(b){return!b||typeof b!="object"?!1:typeof HTMLElement<"u"&&b instanceof HTMLElement?!0:typeof b.nodeName=="string"&&typeof b.getAttribute=="function"}function $e(b,S){if(b.length>S.maxStringLength){var se=b.length-S.maxStringLength,he="... "+se+" more character"+(se>1?"s":"");return $e(k.call(b,0,S.maxStringLength),S)+he}var ue=De[S.quoteStyle||"single"];ue.lastIndex=0;var X=x.call(x.call(b,ue,"\\$1"),/[\x00-\x1f]/g,nt);return O(X,"single",S)}function nt(b){var S=b.charCodeAt(0),se={8:"b",9:"t",10:"n",12:"f",13:"r"}[S];return se?"\\"+se:"\\x"+(S<16?"0":"")+T.call(S.toString(16))}function We(b){return"Object("+b+")"}function _t(b){return b+" { ? }"}function An(b,S,se,he){var ue=he?ls(se,he):$.call(se,", ");return b+" ("+S+") {"+ue+"}"}function oh(b){for(var S=0;S<b.length;S++)if(rt(b[S],`
`)>=0)return!1;return!0}function lh(b,S){var se;if(b.indent==="	")se="	";else if(typeof b.indent=="number"&&b.indent>0)se=$.call(Array(b.indent+1)," ");else return null;return{base:se,prev:$.call(Array(S+1),se)}}function ls(b,S){if(b.length===0)return"";var se=`
`+S.prev+S.base;return se+$.call(b,","+se)+`
`+S.prev}function vi(b,S){var se=q(b),he=[];if(se){he.length=b.length;for(var ue=0;ue<b.length;ue++)he[ue]=Pe(b,ue)?S(b[ue],b):""}var X=typeof ae=="function"?ae(b):[],at;if(Oe){at={};for(var kt=0;kt<X.length;kt++)at["$"+X[kt]]=X[kt]}for(var Le in b)Pe(b,Le)&&(se&&String(Number(Le))===Le&&Le<b.length||Oe&&at["$"+Le]instanceof Symbol||(F.call(/[^\w$]/,Le)?he.push(S(Le,b)+": "+S(b[Le],b)):he.push(Le+": "+S(b[Le],b))));if(typeof ae=="function")for(var ot=0;ot<X.length;ot++)Ve.call(b,X[ot])&&he.push("["+S(X[ot])+"]: "+S(b[X[ot]],b));return he}return er}var tr,Ta;function bl(){if(Ta)return tr;Ta=1;var i=Je(),t=Ge(),e=Uh(),s=pt(),r=i("%WeakMap%",!0),n=i("%Map%",!0),a=t("WeakMap.prototype.get",!0),o=t("WeakMap.prototype.set",!0),l=t("WeakMap.prototype.has",!0),h=t("Map.prototype.get",!0),c=t("Map.prototype.set",!0),u=t("Map.prototype.has",!0),p=function(m,w){for(var k=m,x;(x=k.next)!==null;k=x)if(x.key===w)return k.next=x.next,x.next=m.next,m.next=x,x},g=function(m,w){var k=p(m,w);return k&&k.value},v=function(m,w,k){var x=p(m,w);x?x.value=k:m.next={key:w,next:m.next,value:k}},y=function(m,w){return!!p(m,w)};return tr=function(){var w,k,x,T={assert:function(C){if(!T.has(C))throw new s("Side channel does not contain "+e(C))},get:function(C){if(r&&C&&(typeof C=="object"||typeof C=="function")){if(w)return a(w,C)}else if(n){if(k)return h(k,C)}else if(x)return g(x,C)},has:function(C){if(r&&C&&(typeof C=="object"||typeof C=="function")){if(w)return l(w,C)}else if(n){if(k)return u(k,C)}else if(x)return y(x,C);return!1},set:function(C,F){r&&C&&(typeof C=="object"||typeof C=="function")?(w||(w=new r),o(w,C,F)):n?(k||(k=new n),c(k,C,F)):(x||(x={key:{},next:null}),v(x,C,F))}};return T},tr}var ir,Pa;function qh(){if(Pa)return ir;Pa=1;var i=fl(),t=bl()(),e=pt(),s={assert:function(r,n){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");if(t.assert(r),!s.has(r,n))throw new e("`"+n+"` is not present on `O`")},get:function(r,n){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");var a=t.get(r);return a&&a["$"+n]},has:function(r,n){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");var a=t.get(r);return!!a&&i(a,"$"+n)},set:function(r,n,a){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");var o=t.get(r);o||(o={},t.set(r,o)),o["$"+n]=a}};return Object.freeze&&Object.freeze(s),ir=s,ir}var sr,Ca;function Vh(){if(Ca)return sr;Ca=1;var i=qh(),t=SyntaxError,e=typeof StopIteration=="object"?StopIteration:null;return sr=function(r){if(!e)throw new t("this environment lacks StopIteration");i.set(r,"[[Done]]",!1);var n={next:function(){var o=i.get(this,"[[Iterator]]"),l=i.get(o,"[[Done]]");try{return{done:l,value:l?void 0:o.next()}}catch(h){if(i.set(o,"[[Done]]",!0),h!==e)throw h;return{done:!0,value:void 0}}}};return i.set(n,"[[Iterator]]",r),n},sr}var rr,Aa;function wl(){if(Aa)return rr;Aa=1;var i={}.toString;return rr=Array.isArray||function(t){return i.call(t)=="[object Array]"},rr}var nr,Ra;function Sl(){if(Ra)return nr;Ra=1;var i=String.prototype.valueOf,t=function(a){try{return i.call(a),!0}catch{return!1}},e=Object.prototype.toString,s="[object String]",r=Rt()();return nr=function(a){return typeof a=="string"?!0:typeof a!="object"?!1:r?t(a):e.call(a)===s},nr}var ar,Ma;function xl(){if(Ma)return ar;Ma=1;var i=typeof Map=="function"&&Map.prototype?Map:null,t=typeof Set=="function"&&Set.prototype?Set:null,e;i||(e=function(a){return!1});var s=i?Map.prototype.has:null,r=t?Set.prototype.has:null;return!e&&!s&&(e=function(a){return!1}),ar=e||function(a){if(!a||typeof a!="object")return!1;try{if(s.call(a),r)try{r.call(a)}catch{return!0}return a instanceof i}catch{}return!1},ar}var or,_a;function kl(){if(_a)return or;_a=1;var i=typeof Map=="function"&&Map.prototype?Map:null,t=typeof Set=="function"&&Set.prototype?Set:null,e;t||(e=function(a){return!1});var s=i?Map.prototype.has:null,r=t?Set.prototype.has:null;return!e&&!r&&(e=function(a){return!1}),or=e||function(a){if(!a||typeof a!="object")return!1;try{if(r.call(a),s)try{s.call(a)}catch{return!0}return a instanceof t}catch{}return!1},or}var Da;function Xh(){if(Da)return ri.exports;Da=1;var i=vl(),t=Vh();if(un()()||Qi()()){var e=Symbol.iterator;ri.exports=function(R){if(R!=null&&typeof R[e]<"u")return R[e]();if(i(R))return Array.prototype[e].call(R)}}else{var s=wl(),r=Sl(),n=Je(),a=n("%Map%",!0),o=n("%Set%",!0),l=Ge(),h=l("Array.prototype.push"),c=l("String.prototype.charCodeAt"),u=l("String.prototype.slice"),p=function(R,Y){var Q=R.length;if(Y+1>=Q)return Y+1;var ae=c(R,Y);if(ae<55296||ae>56319)return Y+1;var ne=c(R,Y+1);return ne<56320||ne>57343?Y+1:Y+2},g=function(R){var Y=0;return{next:function(){var ae=Y>=R.length,ne;return ae||(ne=R[Y],Y+=1),{done:ae,value:ne}}}},v=function(R,Y){if(s(R)||i(R))return g(R);if(r(R)){var Q=0;return{next:function(){var ne=p(R,Q),Oe=u(R,Q,ne);return Q=ne,{done:ne>R.length,value:Oe}}}}if(Y&&typeof R["_es6-shim iterator_"]<"u")return R["_es6-shim iterator_"]()};if(!a&&!o)ri.exports=function(R){if(R!=null)return v(R,!0)};else{var y=xl(),m=kl(),w=l("Map.prototype.forEach",!0),k=l("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var x=l("Map.prototype.iterator",!0),T=l("Set.prototype.iterator",!0);var C=l("Map.prototype.@@iterator",!0)||l("Map.prototype._es6-shim iterator_",!0),F=l("Set.prototype.@@iterator",!0)||l("Set.prototype._es6-shim iterator_",!0),K=function(R){if(y(R)){if(x)return t(x(R));if(C)return C(R);if(w){var Y=[];return w(R,function(ae,ne){h(Y,[ne,ae])}),g(Y)}}if(m(R)){if(T)return t(T(R));if(F)return F(R);if(k){var Q=[];return k(R,function(ae){h(Q,ae)}),g(Q)}}};ri.exports=function(R){return K(R)||v(R)}}}return ri.exports}var lr,La;function El(){if(La)return lr;La=1;var i=function(t){return t!==t};return lr=function(e,s){return e===0&&s===0?1/e===1/s:!!(e===s||i(e)&&i(s))},lr}var hr,Ba;function Ol(){if(Ba)return hr;Ba=1;var i=El();return hr=function(){return typeof Object.is=="function"?Object.is:i},hr}var ur,Fa;function Yh(){if(Fa)return ur;Fa=1;var i=Ol(),t=At();return ur=function(){var s=i();return t(Object,{is:s},{is:function(){return Object.is!==s}}),s},ur}var cr,Na;function Kh(){if(Na)return cr;Na=1;var i=At(),t=Zt(),e=El(),s=Ol(),r=Yh(),n=t(s(),Object);return i(n,{getPolyfill:s,implementation:e,shim:r}),cr=n,cr}var dr,$a;function Il(){if($a)return dr;$a=1;var i=Zt(),t=Ge(),e=Je(),s=e("%ArrayBuffer%",!0),r=t("ArrayBuffer.prototype.byteLength",!0),n=t("Object.prototype.toString"),a=!!s&&!r&&new s(0).slice,o=!!a&&i(a);return dr=r||o?function(h){if(!h||typeof h!="object")return!1;try{return r?r(h):o(h,0),!0}catch{return!1}}:s?function(h){return n(h)==="[object ArrayBuffer]"}:function(h){return!1},dr}var fr,Wa;function Qh(){if(Wa)return fr;Wa=1;var i=Date.prototype.getDay,t=function(a){try{return i.call(a),!0}catch{return!1}},e=Object.prototype.toString,s="[object Date]",r=Rt()();return fr=function(a){return typeof a!="object"||a===null?!1:r?t(a):e.call(a)===s},fr}var pr,za;function Jh(){if(za)return pr;za=1;var i=Ge(),t=Rt()(),e,s,r,n;if(t){e=i("Object.prototype.hasOwnProperty"),s=i("RegExp.prototype.exec"),r={};var a=function(){throw r};n={toString:a,valueOf:a},typeof Symbol.toPrimitive=="symbol"&&(n[Symbol.toPrimitive]=a)}var o=i("Object.prototype.toString"),l=Object.getOwnPropertyDescriptor,h="[object RegExp]";return pr=t?function(u){if(!u||typeof u!="object")return!1;var p=l(u,"lastIndex"),g=p&&e(p,"value");if(!g)return!1;try{s(u,n)}catch(v){return v===r}}:function(u){return!u||typeof u!="object"&&typeof u!="function"?!1:o(u)===h},pr}var gr,Ga;function Zh(){if(Ga)return gr;Ga=1;var i=Ge(),t=i("SharedArrayBuffer.prototype.byteLength",!0);return gr=t?function(s){if(!s||typeof s!="object")return!1;try{return t(s),!0}catch{return!1}}:function(s){return!1},gr}var yr,ja;function eu(){if(ja)return yr;ja=1;var i=Number.prototype.toString,t=function(a){try{return i.call(a),!0}catch{return!1}},e=Object.prototype.toString,s="[object Number]",r=Rt()();return yr=function(a){return typeof a=="number"?!0:typeof a!="object"?!1:r?t(a):e.call(a)===s},yr}var mr,Ha;function tu(){if(Ha)return mr;Ha=1;var i=Ge(),t=i("Boolean.prototype.toString"),e=i("Object.prototype.toString"),s=function(o){try{return t(o),!0}catch{return!1}},r="[object Boolean]",n=Rt()();return mr=function(o){return typeof o=="boolean"?!0:o===null||typeof o!="object"?!1:n&&Symbol.toStringTag in o?s(o):e(o)===r},mr}var Si={exports:{}},Ua;function iu(){if(Ua)return Si.exports;Ua=1;var i=Object.prototype.toString,t=un()();if(t){var e=Symbol.prototype.toString,s=/^Symbol\(.*\)$/,r=function(a){return typeof a.valueOf()!="symbol"?!1:s.test(e.call(a))};Si.exports=function(a){if(typeof a=="symbol")return!0;if(i.call(a)!=="[object Symbol]")return!1;try{return r(a)}catch{return!1}}}else Si.exports=function(a){return!1};return Si.exports}var xi={exports:{}},vr,qa;function su(){if(qa)return vr;qa=1;var i=typeof BigInt<"u"&&BigInt;return vr=function(){return typeof i=="function"&&typeof BigInt=="function"&&typeof i(42)=="bigint"&&typeof BigInt(42)=="bigint"},vr}var Va;function ru(){if(Va)return xi.exports;Va=1;var i=su()();if(i){var t=BigInt.prototype.valueOf,e=function(r){try{return t.call(r),!0}catch{}return!1};xi.exports=function(r){return r===null||typeof r>"u"||typeof r=="boolean"||typeof r=="string"||typeof r=="number"||typeof r=="symbol"||typeof r=="function"?!1:typeof r=="bigint"?!0:e(r)}}else xi.exports=function(r){return!1};return xi.exports}var br,Xa;function nu(){if(Xa)return br;Xa=1;var i=Sl(),t=eu(),e=tu(),s=iu(),r=ru();return br=function(a){if(a==null||typeof a!="object"&&typeof a!="function")return null;if(i(a))return"String";if(t(a))return"Number";if(e(a))return"Boolean";if(s(a))return"Symbol";if(r(a))return"BigInt"},br}var wr,Ya;function au(){if(Ya)return wr;Ya=1;var i=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,t=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,e;i||(e=function(a){return!1});var s=i?i.prototype.has:null,r=t?t.prototype.has:null;return!e&&!s&&(e=function(a){return!1}),wr=e||function(a){if(!a||typeof a!="object")return!1;try{if(s.call(a,s),r)try{r.call(a,r)}catch{return!0}return a instanceof i}catch{}return!1},wr}var ki={exports:{}},Ka;function ou(){if(Ka)return ki.exports;Ka=1;var i=Je(),t=Ge(),e=i("%WeakSet%",!0),s=t("WeakSet.prototype.has",!0);if(s){var r=t("WeakMap.prototype.has",!0);ki.exports=function(a){if(!a||typeof a!="object")return!1;try{if(s(a,s),r)try{r(a,r)}catch{return!0}return a instanceof e}catch{}return!1}}else ki.exports=function(a){return!1};return ki.exports}var Sr,Qa;function lu(){if(Qa)return Sr;Qa=1;var i=xl(),t=kl(),e=au(),s=ou();return Sr=function(n){if(n&&typeof n=="object"){if(i(n))return"Map";if(t(n))return"Set";if(e(n))return"WeakMap";if(s(n))return"WeakSet"}return!1},Sr}var xr,Ja;function hu(){if(Ja)return xr;Ja=1;var i=Function.prototype.toString,t=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,e,s;if(typeof t=="function"&&typeof Object.defineProperty=="function")try{e=Object.defineProperty({},"length",{get:function(){throw s}}),s={},t(function(){throw 42},null,e)}catch(k){k!==s&&(t=null)}else t=null;var r=/^\s*class\b/,n=function(x){try{var T=i.call(x);return r.test(T)}catch{return!1}},a=function(x){try{return n(x)?!1:(i.call(x),!0)}catch{return!1}},o=Object.prototype.toString,l="[object Object]",h="[object Function]",c="[object GeneratorFunction]",u="[object HTMLAllCollection]",p="[object HTML document.all class]",g="[object HTMLCollection]",v=typeof Symbol=="function"&&!!Symbol.toStringTag,y=!(0 in[,]),m=function(){return!1};if(typeof document=="object"){var w=document.all;o.call(w)===o.call(document.all)&&(m=function(x){if((y||!x)&&(typeof x>"u"||typeof x=="object"))try{var T=o.call(x);return(T===u||T===p||T===g||T===l)&&x("")==null}catch{}return!1})}return xr=t?function(x){if(m(x))return!0;if(!x||typeof x!="function"&&typeof x!="object")return!1;try{t(x,null,e)}catch(T){if(T!==s)return!1}return!n(x)&&a(x)}:function(x){if(m(x))return!0;if(!x||typeof x!="function"&&typeof x!="object")return!1;if(v)return a(x);if(n(x))return!1;var T=o.call(x);return T!==h&&T!==c&&!/^\[object HTML/.test(T)?!1:a(x)},xr}var kr,Za;function uu(){if(Za)return kr;Za=1;var i=hu(),t=Object.prototype.toString,e=Object.prototype.hasOwnProperty,s=function(l,h,c){for(var u=0,p=l.length;u<p;u++)e.call(l,u)&&(c==null?h(l[u],u,l):h.call(c,l[u],u,l))},r=function(l,h,c){for(var u=0,p=l.length;u<p;u++)c==null?h(l.charAt(u),u,l):h.call(c,l.charAt(u),u,l)},n=function(l,h,c){for(var u in l)e.call(l,u)&&(c==null?h(l[u],u,l):h.call(c,l[u],u,l))},a=function(l,h,c){if(!i(h))throw new TypeError("iterator must be a function");var u;arguments.length>=3&&(u=c),t.call(l)==="[object Array]"?s(l,h,u):typeof l=="string"?r(l,h,u):n(l,h,u)};return kr=a,kr}var Er,eo;function cu(){return eo||(eo=1,Er=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),Er}var Or,to;function du(){if(to)return Or;to=1;var i=cu(),t=typeof globalThis>"u"?zi:globalThis;return Or=function(){for(var s=[],r=0;r<i.length;r++)typeof t[i[r]]=="function"&&(s[s.length]=i[r]);return s},Or}var Ir,io;function fu(){if(io)return Ir;io=1;var i=uu(),t=du(),e=Zt(),s=Ge(),r=fn(),n=s("Object.prototype.toString"),a=Rt()(),o=typeof globalThis>"u"?zi:globalThis,l=t(),h=s("String.prototype.slice"),c=Object.getPrototypeOf,u=s("Array.prototype.indexOf",!0)||function(m,w){for(var k=0;k<m.length;k+=1)if(m[k]===w)return k;return-1},p={__proto__:null};a&&r&&c?i(l,function(y){var m=new o[y];if(Symbol.toStringTag in m){var w=c(m),k=r(w,Symbol.toStringTag);if(!k){var x=c(w);k=r(x,Symbol.toStringTag)}p["$"+y]=e(k.get)}}):i(l,function(y){var m=new o[y],w=m.slice||m.set;w&&(p["$"+y]=e(w))});var g=function(m){var w=!1;return i(p,function(k,x){if(!w)try{"$"+k(m)===x&&(w=h(x,1))}catch{}}),w},v=function(m){var w=!1;return i(p,function(k,x){if(!w)try{k(m),w=h(x,1)}catch{}}),w};return Ir=function(m){if(!m||typeof m!="object")return!1;if(!a){var w=h(n(m),8,-1);return u(l,w)>-1?w:w!=="Object"?!1:v(m)}return r?g(m):null},Ir}var Tr,so;function pu(){if(so)return Tr;so=1;var i=Ge(),t=i("ArrayBuffer.prototype.byteLength",!0),e=Il();return Tr=function(r){return e(r)?t?t(r):r.byteLength:NaN},Tr}var Pr,ro;function gu(){if(ro)return Pr;ro=1;var i=Fh(),t=Ge(),e=zh(),s=Je(),r=Xh(),n=bl(),a=Kh(),o=vl(),l=wl(),h=Il(),c=Qh(),u=Jh(),p=Zh(),g=hn(),v=nu(),y=lu(),m=fu(),w=pu(),k=t("SharedArrayBuffer.prototype.byteLength",!0),x=t("Date.prototype.getTime"),T=Object.getPrototypeOf,C=t("Object.prototype.toString"),F=s("%Set%",!0),K=t("Map.prototype.has",!0),$=t("Map.prototype.get",!0),R=t("Map.prototype.size",!0),Y=t("Set.prototype.add",!0),Q=t("Set.prototype.delete",!0),ae=t("Set.prototype.has",!0),ne=t("Set.prototype.size",!0);function Oe(O,P,q,W){for(var z=r(O),Z;(Z=z.next())&&!Z.done;)if(J(P,Z.value,q,W))return Q(O,Z.value),!0;return!1}function ce(O){if(typeof O>"u")return null;if(typeof O!="object")return typeof O=="symbol"?!1:typeof O=="string"||typeof O=="number"?+O==+O:!0}function Ve(O,P,q,W,z,Z){var ee=ce(q);if(ee!=null)return ee;var te=$(P,ee),j=i({},z,{strict:!1});return typeof te>"u"&&!K(P,ee)||!J(W,te,j,Z)?!1:!K(O,ee)&&J(W,te,j,Z)}function ve(O,P,q){var W=ce(q);return W??(ae(P,W)&&!ae(O,W))}function ie(O,P,q,W,z,Z){for(var ee=r(O),te,j;(te=ee.next())&&!te.done;)if(j=te.value,J(q,j,z,Z)&&J(W,$(P,j),z,Z))return Q(O,j),!0;return!1}function J(O,P,q,W){var z=q||{};if(z.strict?a(O,P):O===P)return!0;var Z=v(O),ee=v(P);if(Z!==ee)return!1;if(!O||!P||typeof O!="object"&&typeof P!="object")return z.strict?a(O,P):O==P;var te=W.has(O),j=W.has(P),oe;if(te&&j){if(W.get(O)===W.get(P))return!0}else oe={};return te||W.set(O,oe),j||W.set(P,oe),De(O,P,z,W)}function re(O){return!O||typeof O!="object"||typeof O.length!="number"||typeof O.copy!="function"||typeof O.slice!="function"||O.length>0&&typeof O[0]!="number"?!1:!!(O.constructor&&O.constructor.isBuffer&&O.constructor.isBuffer(O))}function fe(O,P,q,W){if(ne(O)!==ne(P))return!1;for(var z=r(O),Z=r(P),ee,te,j;(ee=z.next())&&!ee.done;)if(ee.value&&typeof ee.value=="object")j||(j=new F),Y(j,ee.value);else if(!ae(P,ee.value)){if(q.strict||!ve(O,P,ee.value))return!1;j||(j=new F),Y(j,ee.value)}if(j){for(;(te=Z.next())&&!te.done;)if(te.value&&typeof te.value=="object"){if(!Oe(j,te.value,q.strict,W))return!1}else if(!q.strict&&!ae(O,te.value)&&!Oe(j,te.value,q.strict,W))return!1;return ne(j)===0}return!0}function ke(O,P,q,W){if(R(O)!==R(P))return!1;for(var z=r(O),Z=r(P),ee,te,j,oe,je,Te;(ee=z.next())&&!ee.done;)if(oe=ee.value[0],je=ee.value[1],oe&&typeof oe=="object")j||(j=new F),Y(j,oe);else if(Te=$(P,oe),typeof Te>"u"&&!K(P,oe)||!J(je,Te,q,W)){if(q.strict||!Ve(O,P,oe,je,q,W))return!1;j||(j=new F),Y(j,oe)}if(j){for(;(te=Z.next())&&!te.done;)if(oe=te.value[0],Te=te.value[1],oe&&typeof oe=="object"){if(!ie(j,O,oe,Te,q,W))return!1}else if(!q.strict&&(!O.has(oe)||!J($(O,oe),Te,q,W))&&!ie(j,O,oe,Te,i({},q,{strict:!1}),W))return!1;return ne(j)===0}return!0}function De(O,P,q,W){var z,Z;if(typeof O!=typeof P||O==null||P==null||C(O)!==C(P)||o(O)!==o(P))return!1;var ee=l(O),te=l(P);if(ee!==te)return!1;var j=O instanceof Error,oe=P instanceof Error;if(j!==oe||(j||oe)&&(O.name!==P.name||O.message!==P.message))return!1;var je=u(O),Te=u(P);if(je!==Te||(je||Te)&&(O.source!==P.source||e(O)!==e(P)))return!1;var Pe=c(O),Re=c(P);if(Pe!==Re||(Pe||Re)&&x(O)!==x(P)||q.strict&&T&&T(O)!==T(P))return!1;var yt=m(O),rt=m(P);if(yt!==rt)return!1;if(yt||rt){if(O.length!==P.length)return!1;for(z=0;z<O.length;z++)if(O[z]!==P[z])return!1;return!0}var mt=re(O),vt=re(P);if(mt!==vt)return!1;if(mt||vt){if(O.length!==P.length)return!1;for(z=0;z<O.length;z++)if(O[z]!==P[z])return!1;return!0}var bt=h(O),wt=h(P);if(bt!==wt)return!1;if(bt||wt)return w(O)!==w(P)?!1:typeof Uint8Array=="function"&&J(new Uint8Array(O),new Uint8Array(P),q,W);var St=p(O),xt=p(P);if(St!==xt)return!1;if(St||xt)return k(O)!==k(P)?!1:typeof Uint8Array=="function"&&J(new Uint8Array(O),new Uint8Array(P),q,W);if(typeof O!=typeof P)return!1;var $e=g(O),nt=g(P);if($e.length!==nt.length)return!1;for($e.sort(),nt.sort(),z=$e.length-1;z>=0;z--)if($e[z]!=nt[z])return!1;for(z=$e.length-1;z>=0;z--)if(Z=$e[z],!J(O[Z],P[Z],q,W))return!1;var We=y(O),_t=y(P);return We!==_t?!1:We==="Set"||_t==="Set"?fe(O,P,q,W):We==="Map"?ke(O,P,q,W):!0}return Pr=function(P,q,W){return J(P,q,W,n())},Pr}var yu=gu();const mu=gh(yu);var V=(i=>(i[i.Backgrounds=-1]="Backgrounds",i[i.Warpers=0]="Warpers",i[i.Npcs=1]="Npcs",i[i.Items=2]="Items",i[i.Player=3]="Player",i[i.Shader=4]="Shader",i[i.Ui=5]="Ui",i[i.Ui2=6]="Ui2",i[i.Debug=7]="Debug",i[i.Overlay=8]="Overlay",i))(V||{});const ge={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${_.White}`},Jr={fontFamily:"notepen, sans-serif",color:`#${_.Note}`,fontSize:42,fontStyle:"bold"};var vu=Phaser.Renderer.WebGL.Utils,bu=function(i,t,e,s){if(!(t.width===0||t.height===0)){e.addToRenderList(t);var r=t.frame,n=r.width,a=r.height,o=vu.getTintAppendFloatAlpha,l=i.pipelines.set(t.pipeline,t),h=l.setTexture2D(r.glTexture,t);i.pipelines.preBatch(t),l.batchTexture(t,r.glTexture,n,a,t.x,t.y,n/t.style.resolution,a/t.style.resolution,t.scaleX,t.scaleY,t.rotation,t.flipX,t.flipY,t.scrollFactorX,t.scrollFactorY,t.displayOriginX,t.displayOriginY,0,0,n,a,o(t.tintTopLeft,e.alpha*t._alphaTL),o(t.tintTopRight,e.alpha*t._alphaTR),o(t.tintBottomLeft,e.alpha*t._alphaBL),o(t.tintBottomRight,e.alpha*t._alphaBR),t.tintFill,0,0,e,s,!1,h),i.pipelines.postBatch(t)}},wu=function(i,t,e,s){t.width===0||t.height===0||(e.addToRenderList(t),i.batchSprite(t,t.frame,e,s))};const Su={renderWebGL:bu,renderCanvas:wu},Cr=Phaser.Display.Canvas.CanvasPool;var xu=function(i,t,e){e===void 0&&(e={});var s=Cr.create(this),r=s.getContext("2d",{willReadFrequently:!0});i.syncFont(s,r);var n=r.measureText(t),a=Math.ceil(n.width*i.baselineX),o=a,l=2*o;if(o=o*i.baselineY|0,s.width=a,s.height=l,r.fillStyle="#f00",r.fillRect(0,0,a,l),r.font=i._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i.testString,0,o),e.left=0,a===0||l===0||!r.getImageData(0,0,a,l))return Cr.remove(s),e;for(var h=r.getImageData(0,0,a,l).data,c=!1,u=0;u<a;u++){for(var p=0;p<l;p++){var g=(p*a+u)*4;if(h[g]!==255){e.left=u,c=!0;break}}if(c)break}return Cr.remove(s),e};const ku=60;var no=!1,Eu=function(i){if(!no){i===void 0&&(i=ku);var t=Phaser.VERSION.split("."),e=parseInt(t[0]);if(e===3){var s=parseInt(t[1]);s<i&&console.error(`Minimum supported version : ${e}.${s}`)}else console.error(`Can't supported version : ${e}`);no=!0}};Eu();const Ou=Phaser.GameObjects.GameObject;class Tl extends Ou{setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setTestString(t){return this.style.setTestString(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t,e,s){return this.style.setBackgroundColor(t,e,s)}setBackgroundStrokeColor(t,e){return this.style.setBackgroundStrokeColor(t,e)}setBackgroundCornerRadius(t,e){return this.style.setBackgroundCornerRadius(t,e)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,s,r,n,a){return this.style.setShadow(t,e,s,r,n,a)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setUnderline(t,e,s){return this.style.setUnderline(t,e,s)}setUnderlineColor(t){return this.style.setUnderlineColor(t)}setUnderlineThickness(t){return this.style.setUnderlineThickness(t)}setUnderlineOffset(t){return this.style.setUnderlineOffset(t)}setStrikethrough(t,e,s){return this.style.setStrikethrough(t,e,s)}setStrikethroughColor(t){return this.style.setStrikethroughColor(t)}setStrikethroughThickness(t){return this.style.setStrikethroughThickness(t)}setStrikethroughOffset(t){return this.style.setStrikethroughOffset(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setWordWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setHAlign(t){return this.style.setHAlign(t)}setVAlign(t){return this.style.setVAlign(t)}get lineSpacing(){return this.style.lineSpacing}set lineSpacing(t){this.style.lineSpacing=t}setLineSpacing(t){return this.style.lineSpacing=t,this.updateText(!0),this}setXOffset(t){return this.style.setXOffset(t)}setMaxLines(t){return this.style.setMaxLines(t)}setResolution(t){return this.style.setResolution(t)}getTextMetrics(){return this.style.getTextMetrics()}setTextMetrics(t,e){return this.style.setTextMetrics(t,e)}measureTextMargins(t,e){return xu(this.style,t,e)}}const Ce=Phaser.GameObjects.Components;Phaser.Class.mixin(Tl,[Ce.Alpha,Ce.BlendMode,Ce.ComputedSize,Ce.Crop,Ce.Depth,Ce.Flip,Ce.GetBounds,Ce.Mask,Ce.Origin,Ce.Pipeline,Ce.PostPipeline,Ce.ScrollFactor,Ce.Tint,Ce.Transform,Ce.Visible,Su]);const Iu=Phaser.Utils.String.Pad;var be=function(i,t,e){if(i==null)return i;switch(typeof i){case"string":return i;case"number":return`#${Iu(Math.floor(i).toString(16),6,"0",1)}`;case"function":return i(t,e);case"object":return i.hasOwnProperty("r")?i.hasOwnProperty("a")?`rgba(${i.r},${i.g},${i.b},${i.a})`:`rgb(${i.r},${i.g},${i.b})`:i.hasOwnProperty("h")?i.hasOwnProperty("a")?`hsla(${i.h},${i.s},${i.l},${i.a})`:`hsl(${i.h},${i.s},${i.l})`:i;default:return i}},Tu={backgroundColor:["backgroundColor",null,be],backgroundColor2:["backgroundColor2",null,be],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,be],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",be],stroke:["stroke","#fff",be],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",be],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",be],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],strikethroughColor:["strikethrough.color","#000",be],strikethroughThickness:["strikethrough.thickness",0,null],strikethroughOffset:["strikethrough.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]};/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */const Ei=Phaser.Display.Canvas.CanvasPool;var ao=function(i){var t=Ei.create(this),e=t.getContext("2d",{willReadFrequently:!0});i.syncFont(t,e);var s=e.measureText(i.testString);if("actualBoundingBoxAscent"in s){var r=s.actualBoundingBoxAscent,n=s.actualBoundingBoxDescent,h={ascent:r,descent:n,fontSize:r+n};return Ei.remove(t),h}var a=Math.ceil(s.width*i.baselineX),o=a,l=2*o;o=o*i.baselineY|0,t.width=a,t.height=l,e.fillStyle="#f00",e.fillRect(0,0,a,l),e.font=i._font,e.textBaseline="alphabetic",e.fillStyle="#000",e.fillText(i.testString,0,o);var h={ascent:0,descent:0,fontSize:0};if(!e.getImageData(0,0,a,l))return h.ascent=o,h.descent=o+6,h.fontSize=h.ascent+h.descent,Ei.remove(t),h;var c=e.getImageData(0,0,a,l).data,u=c.length,p=a*4,g,v,y=0,m=!1;for(g=0;g<o;g++){for(v=0;v<p;v+=4)if(c[y+v]!==255){m=!0;break}if(!m)y+=p;else break}for(h.ascent=o-g,y=u-p,m=!1,g=l;g>o;g--){for(v=0;v<p;v+=4)if(c[y+v]!==255){m=!0;break}if(!m)y-=p;else break}return h.descent=g-o,h.fontSize=h.ascent+h.descent,Ei.remove(t),h},Se={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,MIX_WRAP:3,SPLITREGEXP:/(?:\r\n|\r|\n)/};const oo={none:Se.NO_WRAP,word:Se.WORD_WRAP,char:Se.CHAR_WRAP,character:Se.CHAR_WRAP,mix:Se.MIX_WRAP},Pu=Phaser.Utils.Objects.GetAdvancedValue,Be=Phaser.Utils.Objects.GetValue;class Pl{constructor(t,e,s){this.parent=t,s===void 0&&(s=Tu),this.propertyMap=s,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.strikethroughColor,this.strikethroughThickness,this.strikethroughOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}get isWrapFitMode(){return this.fixedWidth>0&&this.wrapMode!==Se.NO_WRAP&&this.wrapWidth===0}setStyle(t,e,s){if(e===void 0&&(e=!0),s===void 0&&(s=!1),t&&t.hasOwnProperty("wordWrap")){var r=t.wordWrap;r.hasOwnProperty("width")&&(t.wrap={mode:"word",width:r.width})}if(t&&t.hasOwnProperty("wrap")){var n=t.wrap;if(n.hasOwnProperty("mode")){var a=n.mode;typeof a=="string"&&(n.mode=oo[a])}else n.hasOwnProperty("width")&&(n.mode=1)}t&&t.rtl&&s&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&typeof t.fontSize=="number"&&(t.fontSize=t.fontSize.toString()+"px");var o=this.propertyMap;for(var l in o){var h=o[l],c=h[0],u=s?h[1]:this[l],p=h[2];if(l==="wrapCallback"||l==="wrapCallbackScope")this[l]=Be(t,c,u);else{var g=Pu(t,c,u);p&&(g=p(g)),this[l]=g}}var v=Be(t,"font",null);v===null?this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily:this._font=v;var y=Be(t,"fill",null);y!==null&&(this.color=be(y));var m=Be(t,"metrics",!1);return m?this.metrics={ascent:Be(m,"ascent",0),descent:Be(m,"descent",0),fontSize:Be(m,"fontSize",0)}:(e||!this.metrics)&&(this.metrics=ao(this)),e?this.parent.updateText():this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim(),this.metrics=ao(this)),this.parent.updateText(t)}buildFont(){var t=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim();return t!==this._font&&(this._font=t),this}setFont(t){return typeof t=="string"?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=Be(t,"fontFamily","Courier"),this.fontSize=Be(t,"fontSize","16px"),this.fontStyle=Be(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return typeof t=="number"&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}setResolution(t){return this.resolution=t,this.update(!1)}setXOffset(t){return this.xOffset=t,this.update(!1)}setBackgroundColor(t,e,s){return s===void 0&&(s=!0),this.backgroundColor=be(t,this.parent.canvas,this.parent.context),this.backgroundColor2=be(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=s,this.update(!1)}setBackgroundStrokeColor(t,e){return this.backgroundStrokeColor=be(t,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}setBackgroundCornerRadius(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}setFill(t){return this.color=be(t,this.parent.canvas,this.parent.context),this.update(!1)}setColor(t){return this.color=be(t,this.parent.canvas,this.parent.context),this.update(!1)}setStroke(t,e){return t===void 0?this.strokeThickness=0:(e===void 0&&(e=this.strokeThickness),this.stroke=be(t,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}setShadow(t,e,s,r,n,a){return t===void 0&&(t=0),e===void 0&&(e=0),s===void 0&&(s="#000"),r===void 0&&(r=0),n===void 0&&(n=!1),a===void 0&&(a=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=be(s,this.parent.canvas,this.parent.context),this.shadowBlur=r,this.shadowStroke=n,this.shadowFill=a,this.update(!1)}setShadowOffset(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return t===void 0&&(t="#000"),this.shadowColor=be(t,this.parent.canvas,this.parent.context),this.update(!1)}setShadowBlur(t){return t===void 0&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,s){return t===void 0&&(t="#000"),e===void 0&&(e=0),s===void 0&&(s=0),this.underlineColor=be(t,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=s,this.update(!1)}setUnderlineColor(t){return t===void 0&&(t="#000"),this.underlineColor=be(t,this.parent.canvas,this.parent.context),this.update(!1)}setUnderlineThickness(t){return t===void 0&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return t===void 0&&(t=0),this.underlineOffset=t,this.update(!1)}setStrikethrough(t,e,s){return t===void 0&&(t="#000"),e===void 0&&(e=0),s===void 0&&(s=0),this.strikethroughColor=be(t,this.parent.canvas,this.parent.context),this.strikethroughThickness=e,this.strikethroughOffset=s,this.update(!1)}setStrikethroughColor(t){return t===void 0&&(t="#000"),this.strikethroughColor=be(t,this.parent.canvas,this.parent.context),this.update(!1)}setStrikethroughThickness(t){return t===void 0&&(t=0),this.strikethroughThickness=t,this.update(!1)}setStrikethroughOffset(t){return t===void 0&&(t=0),this.strikethroughOffset=t,this.update(!1)}setWrapMode(t){return typeof t=="string"&&(t=oo[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return t===void 0&&(t="left"),e===void 0&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return t===void 0&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return t===void 0&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return t===void 0&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}setTextMetrics(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&(typeof e=="string"?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=Be(e,"fontFamily",this.fontFamily),this.fontSize=Be(e,"fontSize",this.fontSize),this.fontStyle=Be(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}get lineHeight(){return this.metrics.fontSize+this.parent.lineSpacing}toJSON(){var t={},e=this.propertyMap;for(var s in e)t[s]=this[s];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}var Cu=function(i){return i==null?i="":Array.isArray(i)?i=i.join(`
`):typeof i=="number"&&(i=i.toString()),i};const ct=Phaser.Utils.Objects.GetValue;class Au{constructor(t,e,s,r,n){t===void 0&&(t=0),e===void 0&&(e=t),s===void 0&&(s=0),r===void 0&&(r=0),n===void 0&&(n=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,s,r,n)}setTo(t,e,s,r,n){return this.setPosition(t,e),this.setRadius(n),this.setSize(s,r),this}setPosition(t,e){return this.x=t,this.y=e,this}setRadius(t){return t===void 0&&(t=0),this.radius=t,this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){t==null&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){t==null&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}set radius(t){var e,s;typeof t=="number"?(e=t,s=t):(e=ct(t,"x",0),s=ct(t,"y",0));var r=this.cornerRadius;r.tl=Oi(ct(t,"tl",void 0),e,s),r.tr=Oi(ct(t,"tr",void 0),e,s),r.bl=Oi(ct(t,"bl",void 0),e,s),r.br=Oi(ct(t,"br",void 0),e,s)}get radiusTL(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)}set radiusTL(t){Ii(this.cornerRadius.tl,t)}get radiusTR(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)}set radiusTR(t){Ii(this.cornerRadius.tr,t)}get radiusBL(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)}set radiusBL(t){Ii(this.cornerRadius.bl,t)}get radiusBR(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)}set radiusBR(t){Ii(this.cornerRadius.br,t)}}var Oi=function(i,t,e){return i===void 0?i={x:t,y:e}:typeof i=="number"&&(i={x:i,y:i}),Cl(i),i},Ii=function(i,t){typeof t=="number"?(i.x=t,i.y=t):(i.x=ct(t,"x",0),i.y=ct(t,"y",0)),Cl(i)},Cl=function(i){i.convex=i.x>=0||i.y>=0,i.x=Math.abs(i.x),i.y=Math.abs(i.y)};const lo=Phaser.Math.DegToRad;var Ru=function(i,t,e,s,r,n,a){var o=new Au(t,e,s,r,n),l=o.minWidth,h=o.minHeight,c=s>=l?1:s/l,u=r>=h?1:r/h,p=o.cornerRadius,g,v,y,m,w,k,x;i.save(),i.beginPath(),i.translate(t,e),g=p.tl,Pi(g)?(v=g.x*c,y=g.y*u,Ti(g)?(m=v,w=y,lt(i,m,w,v,y,180,270,!1,a)):(m=0,w=0,lt(i,m,w,v,y,90,0,!0,a)),k=0,x=y):(i.lineTo(0,0),k=0,x=0),g=p.tr,Pi(g)?(v=g.x*c,y=g.y*u,Ti(g)?(m=s-v,w=y,lt(i,m,w,v,y,270,360,!1,a)):(m=s,w=0,lt(i,m,w,v,y,180,90,!0,a))):i.lineTo(s,0),g=p.br,Pi(g)?(v=g.x*c,y=g.y*u,Ti(g)?(m=s-v,w=r-y,lt(i,m,w,v,y,0,90,!1,a)):(m=s,w=r,lt(i,m,w,v,y,270,180,!0,a))):i.lineTo(s,r),g=p.bl,Pi(g)?(v=g.x*c,y=g.y*u,Ti(g)?(m=v,w=r-y,lt(i,m,w,v,y,90,180,!1,a)):(m=0,w=r,lt(i,m,w,v,y,360,270,!0,a))):i.lineTo(0,r),i.lineTo(k,x),i.closePath(),i.restore()},Ti=function(i){return!i.hasOwnProperty("convex")||i.convex},Pi=function(i){return i.x>0&&i.y>0},lt=function(i,t,e,s,r,n,a,o,l){if(o&&a>n?a-=360:!o&&a<n&&(a+=360),n=lo(n),a=lo(a),l==null)i.ellipse(t,e,s,r,0,n,a,o);else{l+=1;for(var h,c,u,p=(a-n)/l,g=0;g<=l;g++)u=n+p*g,h=t+s*Math.cos(u),c=e+r*Math.sin(u),i.lineTo(h,c)}},Mu=function(i,t,e,s,r,n,a,o,l,h,c,u,p){if(Ru(t,e,s,r,n,a,p),o!=null){if(c!=null){var g;u?g=t.createLinearGradient(0,0,r,0):g=t.createLinearGradient(0,0,0,n),g.addColorStop(0,o),g.addColorStop(1,c),o=g}t.fillStyle=o,t.fill()}l!=null&&h>0&&(t.strokeStyle=l,t.lineWidth=h,t.stroke())},_u=function(i,t,e,s,r,n,a,o){if(!(t==null&&e==null)){var l=i.canvas.width,h=i.canvas.height;e==null&&(s=0);var c=s/2;l=Math.max(1,l-s),h=Math.max(1,h-s),Mu(i.canvas,i.context,c,c,l,h,r,t,e,s,n,a,o)}};const Du={draw(i,t,e,s){var r=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save();var a=this.defaultStyle;this.clear(),_u(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),i+=this.startXOffset,t+=this.startYOffset;var o=a.halign,l=a.valign,h,c=a.lineHeight,u=r.lines,p=u.length,g=a.maxLines,v,y,m;g>0&&p>g?(v=g,l==="center"?y=Math.floor((p-v)/2):l==="bottom"?y=p-v:y=0):(v=p,y=0),m=y+v;var w,k,x=this.rtl,T=x?this.parent.width:void 0;l==="center"?k=Math.max((s-v*c)/2,0):l==="bottom"?k=Math.max(s-v*c-2,0):k=0,k+=t;for(var C=y;C<m;C++)if(h=r.getLineWidth(C),h!==0){for(var F=u[C],K=F.length,$=o,R=0;R<K;R++){var Y=F[R].prop.align;if(Y!==void 0){$=Y;break}}$==="center"?w=(e-h)/2:$==="right"?w=x?0:e-h:w=x?e-h:0,w+=i;for(var R=0;R<K;R++)this.drawPen(F[R],w,k,T)}n.restore()},drawPen(i,t,e,s){t+=i.x,e+=i.y+(i.prop.y||0),s!==void 0&&(t=s-t);var r=this.canvas,n=this.context;n.save();var a=this.parser.propToContextStyle(this.defaultStyle,i.prop);if(a.bgcolor!==null&&i.width>0){var o=this.defaultStyle.metrics,l=e-o.ascent,h=o.fontSize;this.drawRectangle(t,l,i.width,h,a.bgcolor,a)}if(a.underlineThickness>0&&i.width>0){var c=e+a.underlineOffset-a.underlineThickness/2;this.drawLine(t,c,i.width,a.underlineThickness,a.underlineColor,a)}if(i.isTextPen&&(a.buildFont(),a.syncFont(r,n),a.syncStyle(r,n),this.drawText(t,e,i.text,a)),i.isImagePen&&this.drawImage(t,e,i.prop.img,i.prop.color,a),a.strikethroughThickness>0&&i.width>0){var c=e+a.strikethroughOffset-a.strikethroughThickness/2;this.drawLine(t,c,i.width,a.strikethroughThickness,a.strikethroughColor,a)}if(n.restore(),i.hasAreaMarker&&i.width>0){var u,p=i.prop.area;if(p)u={key:p};else{var g=i.prop.url;u={key:`url:${g}`,url:g}}this.hitAreaManager.add(t,e-this.startYOffset,i.width,this.defaultStyle.lineHeight,u)}},clear(){var i=this.canvas;this.context.clearRect(0,0,i.width,i.height)},drawRectangle(i,t,e,s,r,n){this.autoRound&&(i=Math.round(i),t=Math.round(t));var a=this.context;a.fillStyle=r,a.fillRect(i,t,e,s)},drawLine(i,t,e,s,r,n){this.autoRound&&(i=Math.round(i),t=Math.round(t));var a=this.context;n.syncShadow(a,n.shadowStroke);var o=a.lineCap;a.lineCap="butt",a.strokeStyle=r,a.lineWidth=s,a.beginPath(),a.moveTo(i,t),a.lineTo(i+e,t),a.stroke(),a.lineCap=o},drawText(i,t,e,s){this.autoRound&&(i=Math.round(i),t=Math.round(t));var r=this.context;s.stroke&&s.stroke!=="none"&&s.strokeThickness>0&&(s.syncShadow(r,s.shadowStroke),r.strokeText(e,i,t)),s.color&&s.color!=="none"&&(s.syncShadow(r,s.shadowFill),r.fillText(e,i,t))},drawImage(i,t,e,s,r){t-=this.startYOffset,this.parent.imageManager.draw(e,this.context,i,t,s,this.autoRound)}},Et=Phaser.Utils.Objects.GetValue,Lu=Se.NO_NEWLINE,ho=Se.RAW_NEWLINE;class Bu{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=Et(t,"text",""),this.x=Et(t,"x",0),this.y=Et(t,"y",0),this.width=Et(t,"width",0);var e=Et(t,"prop",null);e===null&&(e={}),this.prop=e,this.newLineMode=Et(t,"newLineMode",0),this.startIndex=Et(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===ho&&(t+=`
`),t}get wrapText(){var t=this.text;return this.newLineMode!==Lu&&(t+=`
`),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===ho&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area||!!this.prop.url}}var Fu=function(i){if(typeof i!="object"||i===null)return i;if(Array.isArray(i))i.length=0;else for(var t in i)delete i[t];return i},Ui=function(i,t){var e=Array.isArray(i);if(t===void 0?t=e?[]:{}:Fu(t),e){t.length=i.length;for(var s=0,r=i.length;s<r;s++)t[s]=i[s]}else for(var n in i)t[n]=i[n];return t},Nu=function(){};const uo=Phaser.Utils.Objects.GetFastValue,co=Se.NO_NEWLINE,$u=Se.WRAPPED_NEWLINE;class yn{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.tagToText=uo(t,"tagToText",Nu),this.tagToTextScope=uo(t,"tagToTextScope",void 0)}destroy(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}clear(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,s,r,n,a){var o=this.pensPool.pop();return o==null&&(o=new Bu),Ot.text=t,Ot.x=e,Ot.y=s,Ot.width=r,Ot.prop=n,Ot.newLineMode=a,o.resetFromJSON(Ot),this.addPen(o),this}addImagePen(t,e,s,r){return this.addTextPen("",t,e,s,r,co),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,s=t?t.y:0,r=t?Ui(t.prop):null;return this.addTextPen("",e,s,0,r,$u),this}addPen(t){var e=this.lastPen;e==null?t.startIndex=0:t.startIndex=e.endIndex,this.pens.push(t);var s=this.lastLine;s==null&&(s=this.linesPool.pop()||[],this.lines.push(s)),s.push(t),t.newLineMode!==co&&(s=this.linesPool.pop()||[],this.lines.push(s)),this.maxLinesWidth=void 0}clone(t){t==null&&(t=new yn),t.clear();for(var e=0,s=this.lines.length;e<s;e++)for(var r=this.lines[e],n=0,a=r.length;n<a;n++){var o=r[n];t.addPen(o.text,o.x,o.y,o.width,Ui(o.prop),o.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,s=!1,r;for(e=t;e>=0&&(r=this.lines[e],s=r!=null&&r.length>0,!s);e--);if(!s)return 0;var n=r[r.length-1];return n.endIndex}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var s=e[e.length-1];if(s==null)return 0;var r=s.lastX;return r}getMaxLineWidth(){if(this.maxLinesWidth!==void 0)return this.maxLinesWidth;for(var t,e=0,s=0,r=this.lines.length;s<r;s++)t=this.getLineWidth(s),t>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,s=this.lines.length;e<s;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,s=0,r=e.length;s<r;s++)t+=e[s].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,s=0,r=this.pens.length;s<r;s++)t+=e[s].rawTextLength;return t}getSliceTagText(t,e,s){var r=this.lastPen;if(r==null)return"";var n=r.endIndex;(t===void 0||t===0)&&(t=-1),(e===void 0||e===n)&&(e=n+1),s===void 0&&(s=!1);for(var a="",o,l,h,c,u,p,g,v=0,y=this.pens.length;v<y&&(o=this.pens[v],c=o.endIndex,!(!(c<=t)&&(o=this.pens[v],l=s?o.wrapText:o.plainText,p=o.prop,h=o.startIndex,u=h>=t&&c<=e,u||(l=l.substring(t-h,e-h)),this.tagToTextScope?a+=this.tagToText.call(this.tagToTextScope,l,p,g):a+=this.tagToText(l,p,g),g=p,c>=e)));v++);return a}get length(){return this.lines.length}set length(t){this.clear()}}var Ot={};class Ht{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}}const Wu=Phaser.Geom.Rectangle;var fo=new Ht;class zu{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){for(var t=0,e=this.hitAreas.length;t<e;t++)this.hitAreas[t].data=null;return fo.pushMultiple(this.hitAreas),this}add(t,e,s,r,n){n===void 0&&(n={});var a=fo.pop();return a===null?a=new Wu(t,e,s,r):a.setTo(t,e,s,r),a.data=n,this.hitAreas.push(a),this}getFirst(t,e){for(var s=0,r=this.hitAreas.length;s<r;s++){var n=this.hitAreas[s];if(n.contains(t,e))return n}return null}getByKey(t){for(var e=0,s=this.hitAreas.length;e<s;e++){var r=this.hitAreas[e];if(r.data.key===t)return r}return null}drawBounds(t,e,s){e===void 0&&(e=16777215),s&&t.save().scaleCanvas(s.scaleX,s.scaleY).rotateCanvas(s.rotation).translateCanvas(s.x,s.y);for(var r=0,n=this.hitAreas.length;r<n;r++){var a=this.hitAreas[r];t.lineStyle(1,e).strokeRect(a.x,a.y,a.width,a.height)}return s&&t.restore(),this}}var Gu=function(){this.parent.on("pointerdown",ju,this).on("pointerup",Hu,this).on("pointermove",Ar,this).on("pointerover",Ar,this).on("pointerout",function(i,t){Ar.call(this,i,null,null,t)},this)},ju=function(i,t,e,s){var r=this.hitAreaManager.getFirst(t,e);if(r!==null){var n=r.data.key;Vt.call(this,"areadown",n,i,t,e,s),r.data&&(r.data.isDown=!0)}},Hu=function(i,t,e,s){var r=this.hitAreaManager.getFirst(t,e);if(r!==null){var n=r.data.key;if(Vt.call(this,"areaup",n,i,t,e,s),!!r.data){if(r.data.isDown){if(Vt.call(this,"areaclick",n,i,t,e,s),!r.data)return;var a=r.data.url;a&&window.open(a,"_blank")}r.data.isDown=!1}}},Ar=function(i,t,e,s){if(t===null){if(this.lastHitAreaKey!==null){Vt.call(this,"areaout",this.lastHitAreaKey,i,t,e,s);var r=this.hitAreaManager.getByKey(this.lastHitAreaKey);r&&r.data&&(r.data.isDown=!1),this.lastHitAreaKey=null}return}var r=this.hitAreaManager.getFirst(t,e),n=r?r.data.key:null;if(this.lastHitAreaKey!==n){if(this.lastHitAreaKey!==null){Vt.call(this,"areaout",this.lastHitAreaKey,i,t,e,s);var a=this.hitAreaManager.getByKey(this.lastHitAreaKey);a&&(this.urlTagCursorStyle&&po(this.scene,a,""),a.data.isDown=!1)}n!==null&&(Vt.call(this,"areaover",n,i,t,e,s),r.data&&this.urlTagCursorStyle&&po(this.scene,r,this.urlTagCursorStyle)),this.lastHitAreaKey=n}},Vt=function(i,t,e,s,r,n){this.parent.emit(`${i}-${t}`,e,s,r,n),this.parent.emit(i,t,e,s,r,n)},po=function(i,t,e){!t||!t.data||!t.data.url||(i.input.manager.canvas.style.cursor=e)},Uu=/^[\x00-\x7F]+$/,go=function(i){return Uu.test(i)};const qu=Se.NO_NEWLINE,Vu=Se.RAW_NEWLINE,Rr=Se.WRAPPED_NEWLINE,yo=Se.NO_WRAP,Xu=Se.WORD_WRAP,Al=Se.CHAR_WRAP,Yu=Se.SPLITREGEXP;var Rl=function(i,t,e,s,r,n){s<=0&&(e=yo);var a=[];if(!i||!i.length)return a;for(var o=e===yo,l=i.split(Yu),h,c,u,p=0,g=l.length;p<g;p++){if(h=l[p],u=p===g-1?qu:Vu,o){var v=t.measureText(h).width;a.push(n.getLine(h,v,u));continue}if(c=p===0?s-r:s,h.length<=100){var v=t.measureText(h).width;if(v<=c){a.push(n.getLine(h,v,u));continue}}for(var y=Ku(h,e),m,w,k="",x=0,T,C=0,F=y.length;C<F;C++){if(m=y[C],w=t.measureText(m).width,w>s&&Qu(m)){k!==""?a.push(n.getLine(k,x,Rr)):C===0&&r>0&&a.push(n.getLine("",0,Rr)),a.push(...Rl(m,t,Al,s,0,n));var K=a.pop();k=K.text,x=K.width,n.freeLine(K),k===" "&&(k="",x=0);continue}T=x+w,T>c?(a.push(n.getLine(k,x,Rr)),k=m,x=w,c=s):(k+=m,x=T),C===F-1&&a.push(n.getLine(k,x,u))}}return a},Ku=function(i,t){var e;switch(t){case Xu:e=[],i=i.split(" ");for(var s=0,r=i.length;s<r;s++){var n=i[s];s<r-1?e.push(n+" "):n!==""&&e.push(n)}break;case Al:e=i.split("");break;default:e=[],i=i.split(" ");for(var s=0,r=i.length;s<r;s++){var n=i[s];s<r-1?go(n)?e.push(n+" "):(e.push(...n.split("")),e.push(" ")):n!==""&&(go(n)?e.push(n):e.push(...n.split("")))}break}return e},Qu=function(i){switch(i.length){case 1:return!1;case 2:return i.charAt(1)!==" ";default:return!0}};const Mr=Phaser.Utils.Objects.GetValue,Ju=Se.NO_WRAP,mo=Se.NO_NEWLINE,Zu=Se.WRAPPED_NEWLINE;class Ml{constructor(t){this.parent=t.parent,this.scene=this.parent.scene,this.context=Mr(t,"context",null),this.canvas=this.context.canvas,this.parser=Mr(t,"parser",null),this.defaultStyle=Mr(t,"style",null),this.autoRound=!0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.wrapTextLinesPool=t.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new zu,this.lastHitAreaKey=null,this.urlTagCursorStyle=null}destroy(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0}updatePenManager(t,e,s,r,n){if(n===void 0&&(n=this.penManager),n.clear(),t==="")return n;var a=this.parent.style;if(a.isWrapFitMode){var o=this.parent.padding;s=a.fixedWidth-o.left-o.right}for(var l=this.canvas,h=this.context,c=0,u=0,p=a.wrapCallback,g=a.wrapCallbackScope,v=!0,y,m,w,k=this.parser.splitText(t),x,T,C=this.wrapTextLinesPool,F=0,K=k.length;F<K;F++)if(x=this.parser.tagTextToProp(k[F],m),y=x.plainText,m=x.prop,m.img){var $=this.imageManager.getOuterWidth(m.img);s>0&&e!==Ju&&s<c+$&&(n.addNewLinePen(),u+=r,c=0),n.addImagePen(c,u,$,Ui(m)),c+=$}else if(y!==""){if(h.save(),w=this.parser.propToContextStyle(this.defaultStyle,m),w.buildFont(),w.syncFont(l,h),w.syncStyle(l,h),!p)T=Rl(y,h,e,s,c,C);else{T=p.call(g,y,h,s,c),typeof T=="string"&&(T=T.split(`
`));for(var Q,R=0,Y=T.length;R<Y;R++)Q=T[R],typeof Q=="string"?T[R]=C.getLine(Q,h.measureText(Q).width,R<Y-1?Zu:mo):v=!1}for(var Q,R=0,Y=T.length;R<Y;R++)Q=T[R],n.addTextPen(Q.text,c,u,Q.width,Ui(m),Q.newLineMode),Q.newLineMode!==mo?(c=0,u+=r):c+=Q.width;v&&C.freeLines(T),T=null,h.restore()}for(var F=0,K=this.lines.length;F<K;F++){var ae=this.lines[F],ne=ae[ae.length-1];ne&&(ne.width+=this.parser.getStrokeThinkness(this.defaultStyle,ne.prop))}return n}get startXOffset(){return this.defaultStyle.xOffset}get startYOffset(){return this.defaultStyle.metrics.ascent}get lines(){return this.penManager.lines}get displayLinesCount(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return Math.ceil(this.penManager.getMaxLineWidth())}get linesHeight(){var t=this.displayLinesCount,e=this.defaultStyle.lineHeight*t;return t>0&&(e-=this.defaultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}get rtl(){return this.parent.style.rtl}newPenManager(){return new yn({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,s){var r;if(t==null)r=this.penManager.plainText;else{var n=this.parser.splitText(t,1);r="";for(var a=0,o=n.length;a<o;a++)r+=n[a]}return(e!=null||s!=null)&&(e==null&&(e=0),s==null&&(s=r.length),r=r.substring(e,s)),r}getPenManager(t,e){if(t===void 0)return this.copyPenManager(e,this.penManager);e===void 0&&(e=this.newPenManager());var s=this.defaultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,e),e}getText(t,e,s,r){if(t==null)return this.penManager.getSliceTagText(e,s,r);var n=this.tmpPenManager,a=this.defaultStyle;return this.updatePenManager(t,a.wrapMode,a.wrapWidth,a.lineHeight,n),n.getSliceTagText(e,s,r)}copyPenManager(t,e){return e===void 0&&(e=this.penManager),e.copy(t)}getTextWidth(t){return t===void 0&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return t===void 0&&(t=this.penManager),t.lastPen}}var ec={setInteractive:Gu};Object.assign(Ml.prototype,Du,ec);class vo extends Ht{freeLine(t){if(t)return this.push(t),this}freeLines(t){if(t)return this.pushMultiple(t),this}getLine(t,e,s){var r=this.pop();return r===null&&(r={}),r.text=t,r.width=e,r.newLineMode=s,r}}const tc=Phaser.Utils.Objects.IsPlainObject,Bt=Phaser.Utils.Objects.GetValue;var _r=function(i,t){tc(i)?(t=i,i=t.key):t===void 0&&(t={key:i}),t.hasOwnProperty("key")||(t.key=i);var e=t.key,s=t.frame,r=t.width,n=t.height;if(r===void 0||n===void 0){var a=this.textureManager.getFrame(e,s),o=a?a.cutWidth:0,l=a?a.cutHeight:0;r===void 0&&n===void 0?(r=o,n=l):r===void 0?r=o*(n/l):n===void 0&&(n=l*(r/o))}this.images[i]={key:e,frame:s,width:r,height:n,y:Bt(t,"y",0),left:Bt(t,"left",0),right:Bt(t,"right",0),originX:Bt(t,"originX",0),originY:Bt(t,"originY",0),tintFill:Bt(t,"tintFill",!1)}};const bo=Phaser.Display.Canvas.CanvasPool;var ic=function(i,t,e,s,r,n,a,o){e===void 0&&(e=0),s===void 0&&(s=0),r===void 0&&(r=i.cutWidth),n===void 0&&(n=i.cutHeight),o===void 0&&(o=!1),o&&(e=Math.round(e),s=Math.round(s));var l=t.getContext("2d",{willReadFrequently:!0});if(a){var h=bo.create(null,r,n,Phaser.CANVAS,!0),c=h.getContext("2d",{willReadFrequently:!0});c.drawImage(i.source.image,i.cutX,i.cutY,i.cutWidth,i.cutHeight,0,0,r,n),c.globalCompositeOperation="source-in",c.fillStyle=a,c.fillRect(0,0,r,n),l.drawImage(h,0,0,r,n,e,s,r,n),bo.remove(h)}else l.drawImage(i.source.image,i.cutX,i.cutY,i.cutWidth,i.cutHeight,e,s,r,n)},sc=function(i,t,e,s,r,n){var a=this.get(i);if(a){var o=this.textureManager.getFrame(a.key,a.frame),l=a.width,h=a.height;e+=a.left-a.originX*l,s+=a.y-a.originY*h,a.tintFill||(r=void 0),ic(o,t.canvas,e,s,l,h,r,n)}};class _l{constructor(t){this.textureManager=t.sys.textures,this.images={}}destroy(){this.textureManager=void 0,this.images=void 0}add(t,e){if(typeof t=="string")_r.call(this,t,e);else if(Array.isArray(t))for(var s=t,r=0,n=s.length;r<n;r++)_r.call(this,s[r]);else{var s=t;for(var t in s)_r.call(this,t,s[t])}return this}has(t){return this.images.hasOwnProperty(t)}remove(t){return this.has(t)&&delete this.images[t],this}get(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}}var rc={draw:sc};Object.assign(_l.prototype,rc);var nc=function(i,t,e,s,r,n,a){var o=i.sys.textures,l=i.renderer;s===void 0&&(s=0),r===void 0&&(r=0),n===void 0&&(n=t.width),a===void 0&&(a=t.height);var h;o.exists(e)?h=o.get(e):h=o.createCanvas(e,n,a);var c=h.getSourceImage();c.width!==n&&(c.width=n),c.height!==a&&(c.height=a);var u=c.getContext("2d",{willReadFrequently:!0});u.clearRect(0,0,n,a),u.drawImage(t,s,r,n,a),l.gl&&h&&l.canvasToTexture(c,h.source[0].glTexture,!0,0)},ac=function(i,t){!i&&i!==0&&(i=""),t===void 0&&(t=!0),Array.isArray(i)&&(i=i.join(`
`));var e;return t?e=`${this.text}
${i}`:e=`${this.text}${i}`,e!=this.text&&this.setText(e),this};const oc=Phaser.Utils.Objects.IsPlainObject,wo=Phaser.DOM.AddToDOM,So=Phaser.Display.Canvas.CanvasPool,lc=Phaser.GameObjects.GameObject,Me=Phaser.Utils.Objects.GetValue,hc=Phaser.DOM.RemoveFromDOM,uc=Se.SPLITREGEXP,cc=Phaser.Utils.String.UUID;var Ft=null,Dr=null,Lr=null;class Dl extends Tl{constructor(t,e,s,r,n,a,o){if(oc(e)){var l=e;e=Me(l,"x",0),s=Me(l,"y",0),r=Me(l,"text",""),n=Me(l,"style")}if(e===void 0&&(e=0),s===void 0&&(s=0),super(t,a),this.renderer=t.sys.game.renderer,this.setPosition(e,s),this.setOrigin(0,0),this.initPipeline(),this.initPostPipeline(!0),this.canvas=So.create(this),this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this._imageManager=void 0,n){if(n.hasOwnProperty("align")){var h=n.align;delete n.align,n.halign=h}n.hasOwnProperty("stroke")&&!n.hasOwnProperty("strokeThickness")&&(n.strokeThickness=1)}this.style=new Pl(this,n);var c=Me(n,"images",void 0);c&&this.addImage(c),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,this.style.resolution===0&&(this.style.resolution=1),this._crop=this.resetCropObject(),this._textureKey=cc(),this.texture=t.sys.textures.addCanvas(this._textureKey,this.canvas),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null);var u=Me(n,"sharedPool",!0),p,g,v;u?(Ft||(Ft={},Dr=new Ht,Lr=new vo,this.scene.game.events.once("destroy",function(){Ft=null,Dr=null,Lr=null})),Ft.hasOwnProperty(a)||(Ft[a]=new Ht),p=Ft[a],g=Dr,v=Lr):(p=new Ht,g=new Ht,v=new vo),this.canvasText=new Ml({parent:this,context:this.context,parser:o,style:this.style,pensPool:p,linesPool:g,wrapTextLinesPool:v}),this.parser=o,this.initRTL(),n&&n.padding&&this.setPadding(n.padding),this.setText(r),this.setUrlTagCursorStyle(Me(n,"urlTagCursorStyle","pointer")),Me(n,"interactive",!1)&&this.setInteractive()}preDestroy(){hc(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),So.remove(this.canvas);var t=this.texture;t&&t.destroy()}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",wo(this.canvas,this.scene.sys.canvas),this.originX=1)}setRTL(t){t===void 0&&(t=!0);var e=this.style;if(e.rtl===t)return this;if(e.rtl=t,t?(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",wo(this.canvas,this.scene.sys.canvas)):(this.canvas.dir="ltr",this.context.direction="ltr"),e.halign==="left"?e.halign="right":e.halign==="right"&&(e.halign="left"),this._imageManager){var s=this._imageManager.images;for(var r in s)s[r].originX=1-s[r].originX}return this}setText(t){return t=Cu(t),t===this._text?this:(this._text=t,this.updateText(),this)}setPadding(t,e,s,r){if(typeof t=="object"){var n=t,a=Me(n,"x",null);a!==null?(t=a,s=a):(t=Me(n,"left",0),s=Me(n,"right",t));var o=Me(n,"y",null);o!==null?(e=o,r=o):(e=Me(n,"top",0),r=Me(n,"bottom",e))}else t===void 0&&(t=0),e===void 0&&(e=t),s===void 0&&(s=t),r===void 0&&(r=e);return this.padding.left=t,this.padding.top=e,this.padding.right=s,this.padding.bottom=r,this.updateText(!1)}updateText(t){t===void 0&&(t=!0);var e=this.canvasText,s=this.style;t&&e.updatePenManager(this._text,s.wrapMode,s.wrapWidth,s.lineHeight);var r=this.padding,n,a,o=Math.ceil(e.linesWidth);s.fixedWidth===0?(this.width=o+r.left+r.right,n=o):(this.width=s.fixedWidth,n=this.width-r.left-r.right,n<o&&(n=o)),s.fixedHeight===0?(this.height=e.linesHeight+r.top+r.bottom,a=e.linesHeight):(this.height=s.fixedHeight,a=this.height-r.top-r.bottom,a<e.linesHeight&&(a=e.linesHeight));var l=this.width,h=this.height;this.updateDisplayOrigin();var c=s.resolution;l*=c,h*=c,l=Math.max(Math.ceil(l),1),h=Math.max(Math.ceil(h),1);var u=this.canvas,p=this.context;u.width!==l||u.height!==h?(u.width=l,u.height=h,this.frame.setSize(l,h)):p.clearRect(0,0,l,h),p.save(),p.scale(c,c);var g=this.style.rtl?r.right:r.left,v=r.top;e.draw(g,v,n,a),p.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(u,this.frame.source.glTexture,!0),this.frame.glTexture.spectorMetadata={textureKey:"BBCodeText Game Object"}),this.dirty=!0;var y=this.input;return y&&!y.customHitArea&&(y.hitArea.width=this.width,y.hitArea.height=this.height),this}toJSON(){var t=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}setInteractive(t,e,s){var r=!!this.input;return lc.prototype.setInteractive.call(this,t,e,s),r||this.canvasText.setInteractive(),this}setUrlTagCursorStyle(t){return this.urlTagCursorStyle=t,this}get urlTagCursorStyle(){return this.canvasText.urlTagCursorStyle}set urlTagCursorStyle(t){this.canvasText.urlTagCursorStyle=t}getWrappedText(t,e,s){return typeof t=="number"&&(s=e,e=t,t=void 0),t=this.canvasText.getText(t,e,s,!0),t.split(uc)}getPlainText(t,e,s){return typeof t=="number"&&(s=e,e=t,t=void 0),this.canvasText.getPlainText(t,e,s)}getText(t,e,s,r){return typeof t=="number"&&(r=s,s=e,e=t,t=void 0),r===void 0&&(r=!1),this.canvasText.getText(t,e,s,r)}getSubString(t,e,s){return typeof t=="number"&&(s=e,e=t,t=void 0),this.getText(t,e,s)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}get imageManager(){return this._imageManager||(this._imageManager=new _l(this.scene)),this._imageManager}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}generateTexture(t,e,s,r,n){var a=this.canvas;return r===void 0?r=a.width:r*=this.resolution,n===void 0?n=a.height:n*=this.resolution,nc(this.scene,a,t,e,s,r,n),this}}var dc={appendText:ac};Object.assign(Dl.prototype,dc);var fc=function(i,t){for(var e=this.tagRegex,s=[],r=0,n=!1,a=!1;;){var o=e.RE_SPLITTEXT.exec(i);if(!o)break;var l=o[0];if(a)if(e.RE_ESC_CLOSE.test(l))a=!1;else continue;else if(n)if(e.RE_RAW_CLOSE.test(l))n=!1;else continue;else e.RE_ESC_OPEN.test(l)?a=!0:e.RE_RAW_OPEN.test(l)&&(n=!0);var h=e.RE_SPLITTEXT.lastIndex,c=h-l.length;if(r<c){var u=i.substring(r,c);s.push(u)}t===void 0&&s.push(l),r=h}var p=i.length;return r<p&&s.push(i.substring(r,p)),s};const ye=!1,de=!0;var pc={plainText:null,prevProp:null},gc=function(i,t){var e=this.tagRegex;t==null&&(t={});var s="";if(t.img&&H(t,ye,"img"),t.esc)e.RE_ESC_CLOSE.test(i)?H(t,ye,"esc"):s=i;else if(t.raw)e.RE_RAW_CLOSE.test(i)?H(t,ye,"raw"):s=i;else if(e.RE_ESC_OPEN.test(i))H(t,de,"esc",!0);else if(e.RE_ESC_CLOSE.test(i))H(t,ye,"esc");else if(e.RE_RAW_OPEN.test(i))H(t,de,"raw",!0);else if(e.RE_RAW_CLOSE.test(i))H(t,ye,"raw");else if(e.RE_BLOD_OPEN.test(i))H(t,de,"b",!0);else if(e.RE_BLOD_CLOSE.test(i))H(t,ye,"b");else if(e.RE_ITALICS_OPEN.test(i))H(t,de,"i",!0);else if(e.RE_ITALICS_CLOSE.test(i))H(t,ye,"i");else if(e.RE_WEIGHT_OPEN.test(i)){var r=i.match(e.RE_WEIGHT_OPEN);H(t,de,"weight",r[1])}else if(e.RE_WEIGHT_CLOSE.test(i))H(t,ye,"weight");else if(e.RE_SIZE_OPEN.test(i)){var r=i.match(e.RE_SIZE_OPEN);H(t,de,"size",`${r[1]}px`)}else if(e.RE_SIZE_CLOSE.test(i))H(t,ye,"size");else if(e.RE_FAMILY_OPEN.test(i)){var r=i.match(e.RE_FAMILY_OPEN);H(t,de,"family",r[1])}else if(e.RE_FAMILY_CLOSE.test(i))H(t,ye,"family");else if(e.RE_COLOR_OPEN.test(i)){var r=i.match(e.RE_COLOR_OPEN);H(t,de,"color",r[1])}else if(e.RE_COLOR_CLOSE.test(i))H(t,ye,"color");else if(e.RE_UNDERLINE_OPEN.test(i))H(t,de,"u",!0);else if(e.RE_UNDERLINE_OPENC.test(i)){var r=i.match(e.RE_UNDERLINE_OPENC);H(t,de,"u",r[1])}else if(e.RE_UNDERLINE_CLOSE.test(i))H(t,ye,"u");else if(e.RE_STRIKETHROUGH_OPEN.test(i))H(t,de,"s",!0);else if(e.RE_STRIKETHROUGH_OPENC.test(i)){var r=i.match(e.RE_STRIKETHROUGH_OPENC);H(t,de,"s",r[1])}else if(e.RE_STRIKETHROUGH_CLOSE.test(i))H(t,ye,"s");else if(e.RE_SHADOW_OPEN.test(i))H(t,de,"shadow",!0);else if(e.RE_SHADOW_OPENC.test(i)){var r=i.match(e.RE_SHADOW_OPENC);H(t,de,"shadow",r[1])}else if(e.RE_SHADOW_CLOSE.test(i))H(t,ye,"shadow");else if(e.RE_STROKE_OPEN.test(i))H(t,de,"stroke",!0);else if(e.RE_STROKE_OPENC.test(i)){var r=i.match(e.RE_STROKE_OPENC);H(t,de,"stroke",r[1])}else if(e.RE_STROKE_CLOSE.test(i))H(t,ye,"stroke");else if(e.RE_BGCOLOR_OPEN.test(i)){var r=i.match(e.RE_BGCOLOR_OPEN);H(t,de,"bgcolor",r[1])}else if(e.RE_BGCOLOR_CLOSE.test(i))H(t,ye,"bgcolor");else if(e.RE_OFFSETY_OPEN.test(i)){var r=i.match(e.RE_OFFSETY_OPEN);H(t,de,"y",parseFloat(r[1]))}else if(e.RE_OFFSETY_CLOSE.test(i))H(t,ye,"y");else if(e.RE_IMAGE_OPEN.test(i)){var r=i.match(e.RE_IMAGE_OPEN);H(t,de,"img",r[1])}else if(e.RE_IMAGE_CLOSE.test(i))H(t,ye,"img");else if(e.RE_AREA_OPEN.test(i)){var r=i.match(e.RE_AREA_OPEN);H(t,de,"area",r[1])}else if(e.RE_AREA_CLOSE.test(i))H(t,ye,"area");else if(e.RE_URL_OPEN.test(i)){var r=i.match(e.RE_URL_OPEN);H(t,de,"url",r[1])}else if(e.RE_URL_CLOSE.test(i))H(t,ye,"url");else if(e.RE_ALIGN_OPEN.test(i)){var r=i.match(e.RE_ALIGN_OPEN);H(t,de,"align",r[1])}else if(e.RE_ALIGN_CLOSE.test(i))H(t,ye,"align");else if(e.RE_ID_OPEN.test(i)){var r=i.match(e.RE_ID_OPEN);H(t,de,"id",r[1])}else e.RE_ID_CLOSE.test(i)?H(t,ye,"id"):s=i;var n=pc;return n.plainText=s,n.prop=t,n},H=function(i,t,e,s){return t===de?i[e]=s:i.hasOwnProperty(e)&&delete i[e],i},yc=function(i,t){var e=vc;if(t.hasOwnProperty("img"))e.image=t.img;else{if(e.image=null,t.hasOwnProperty("family")?e.fontFamily=t.family:e.fontFamily=i.fontFamily,t.hasOwnProperty("size")){var s=t.size;typeof s=="number"&&(s=`${s}px`),e.fontSize=s}else e.fontSize=i.fontSize;e.fontStyle=mc(t),t.hasOwnProperty("color")?e.color=t.color:e.color=i.color,t.hasOwnProperty("stroke")?t.stroke===!0?(e.stroke=i.stroke,e.strokeThickness=i.strokeThickness):(e.stroke=t.stroke,e.strokeThickness=i.strokeThickness):(e.stroke=i.stroke,e.strokeThickness=0)}return t.hasOwnProperty("shadow")?t.shadow===!0?(e.shadowColor=i.shadowColor,e.shadowOffsetX=i.shadowOffsetX,e.shadowOffsetY=i.shadowOffsetY,e.shadowBlur=i.shadowBlur,e.shadowStroke=!0,e.shadowFill=!0):(e.shadowColor=t.shadow,e.shadowOffsetX=i.shadowOffsetX,e.shadowOffsetY=i.shadowOffsetY,e.shadowBlur=i.shadowBlur,e.shadowStroke=!0,e.shadowFill=!0):(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowStroke=!1,e.shadowFill=!1),t.hasOwnProperty("u")?t.u===!0?(e.underlineColor=i.underlineColor,e.underlineThickness=i.underlineThickness,e.underlineOffset=i.underlineOffset):(e.underlineColor=t.u,e.underlineThickness=i.underlineThickness,e.underlineOffset=i.underlineOffset):(e.underlineColor="#000",e.underlineThickness=0,e.underlineOffset=0),t.hasOwnProperty("s")?t.s===!0?(e.strikethroughColor=i.strikethroughColor,e.strikethroughThickness=i.strikethroughThickness,e.strikethroughOffset=i.strikethroughOffset):(e.strikethroughColor=t.s,e.strikethroughThickness=i.strikethroughThickness,e.strikethroughOffset=i.strikethroughOffset):(e.strikethroughColor="#000",e.strikethroughThickness=0,e.strikethroughOffset=0),t.hasOwnProperty("bgcolor")?e.bgcolor=t.bgcolor:e.bgcolor=null,e},mc=function(i){var t=i.b,e=i.weight,s=i.i;return t||e||s?s?t?"bold italic":e?`${e} italic`:"italic":t?"bold":e.toString():""},vc=new Pl,bc=function(i,t,e){e==null&&(e=wc);var s=this.delimiters[0],r=this.delimiters[1],n=[];for(var a in e)t.hasOwnProperty(a)||n.push(`${s}/${a}${r}`);for(var a in t){var o=t[a];if(a!=="img"){if(e[a]===o)continue}switch(a){case"size":n.push(`${s}size=${o.replace("px","")}${r}`);break;case"color":case"weight":case"family":case"stroke":case"bgcolor":case"y":case"img":case"area":case"url":case"align":case"id":n.push(`${s}${a}=${o}${r}`);break;case"u":case"s":o===!0?n.push(`${s}${a}${r}`):n.push(`${s}${a}=${o}${r}`);break;default:n.push(`${s}${a}${r}`);break}}return n.push(i),n.join("")},wc={},xo=function(i){return i.replace(Sc,"\\$&").replace(xc,"\\x2d")},Sc=/[|\\{}()[\]^$+*?.]/g,xc=/-/g,ko,Eo,U={},pe=function(i,t,e,s){return s===void 0?`${i}${e}${t}`:`${i}${e}=(${s})${t}`},xe=function(i,t,e){return`${i}/${e}${t}`},kc=function(i){return`[^${i}]+`},Br="[-.0-9]+",Ec=["[a-zA-Z]+","#[0-9abcdef]+","rgba?\\(s*[.0-9]+s*(,s*[.0-9]+s*){2,3}\\)"],Nt=Ec.join("|"),Ll=function(i,t){if(t===void 0){var e=i;i=e[0],t=e[1]}if(ko===i&&Eo===t)return!1;ko=i,Eo=t,i=xo(i),t=xo(t);var s=kc(t),r="esc",n=pe(i,t,r),a=xe(i,t,r),o="raw",l=pe(i,t,o),h=xe(i,t,o),c="b",u=pe(i,t,c),p=xe(i,t,c),g="i",v=pe(i,t,g),y=xe(i,t,g),m="weight",w=pe(i,t,m,Br),k=xe(i,t,m),x="size",T=pe(i,t,x,Br),C=xe(i,t,x),F="family",K=pe(i,t,F,s),$=xe(i,t,F),R="color",Y=pe(i,t,R,Nt),Q=xe(i,t,R),ae="u",ne=pe(i,t,ae),Oe=pe(i,t,ae,Nt),ce=xe(i,t,ae),Ve="s",ve=pe(i,t,Ve),ie=pe(i,t,Ve,Nt),J=xe(i,t,Ve),re="shadow",fe=pe(i,t,re),ke=pe(i,t,re,Nt),De=xe(i,t,re),O="stroke",P=pe(i,t,O),q=pe(i,t,O,Nt),W=xe(i,t,O),z="bgcolor",Z=pe(i,t,z,Nt),ee=xe(i,t,z),te="y",j=pe(i,t,te,Br),oe=xe(i,t,te),je="img",Te=pe(i,t,je,s),Pe=xe(i,t,je),Re="area",yt=pe(i,t,Re,s),rt=xe(i,t,Re),mt="url",vt=pe(i,t,mt,s),bt=xe(i,t,mt),wt="align",St=pe(i,t,wt,s),xt=xe(i,t,wt),$e="id",nt=pe(i,t,$e,s),We=xe(i,t,$e);return U.RE_ESC_OPEN=new RegExp(n,"i"),U.RE_ESC_CLOSE=new RegExp(a,"i"),U.RE_RAW_OPEN=new RegExp(l,"i"),U.RE_RAW_CLOSE=new RegExp(h,"i"),U.RE_BLOD_OPEN=new RegExp(u,"i"),U.RE_BLOD_CLOSE=new RegExp(p,"i"),U.RE_ITALICS_OPEN=new RegExp(v,"i"),U.RE_ITALICS_CLOSE=new RegExp(y,"i"),U.RE_WEIGHT_OPEN=new RegExp(w,"i"),U.RE_WEIGHT_CLOSE=new RegExp(k,"i"),U.RE_SIZE_OPEN=new RegExp(T,"i"),U.RE_SIZE_CLOSE=new RegExp(C,"i"),U.RE_FAMILY_OPEN=new RegExp(K,"i"),U.RE_FAMILY_CLOSE=new RegExp($,"i"),U.RE_COLOR_OPEN=new RegExp(Y,"i"),U.RE_COLOR_CLOSE=new RegExp(Q,"i"),U.RE_UNDERLINE_OPEN=new RegExp(ne,"i"),U.RE_UNDERLINE_OPENC=new RegExp(Oe,"i"),U.RE_UNDERLINE_CLOSE=new RegExp(ce,"i"),U.RE_STRIKETHROUGH_OPEN=new RegExp(ve,"i"),U.RE_STRIKETHROUGH_OPENC=new RegExp(ie,"i"),U.RE_STRIKETHROUGH_CLOSE=new RegExp(J,"i"),U.RE_SHADOW_OPEN=new RegExp(fe,"i"),U.RE_SHADOW_OPENC=new RegExp(ke,"i"),U.RE_SHADOW_CLOSE=new RegExp(De,"i"),U.RE_STROKE_OPEN=new RegExp(P,"i"),U.RE_STROKE_OPENC=new RegExp(q,"i"),U.RE_STROKE_CLOSE=new RegExp(W,"i"),U.RE_BGCOLOR_OPEN=new RegExp(Z,"i"),U.RE_BGCOLOR_CLOSE=new RegExp(ee,"i"),U.RE_OFFSETY_OPEN=new RegExp(j,"i"),U.RE_OFFSETY_CLOSE=new RegExp(oe,"i"),U.RE_IMAGE_OPEN=new RegExp(Te,"i"),U.RE_IMAGE_CLOSE=new RegExp(Pe,"i"),U.RE_AREA_OPEN=new RegExp(yt,"i"),U.RE_AREA_CLOSE=new RegExp(rt,"i"),U.RE_URL_OPEN=new RegExp(vt,"i"),U.RE_URL_CLOSE=new RegExp(bt,"i"),U.RE_ALIGN_OPEN=new RegExp(St,"i"),U.RE_ALIGN_CLOSE=new RegExp(xt,"i"),U.RE_ID_OPEN=new RegExp(nt,"i"),U.RE_ID_CLOSE=new RegExp(We,"i"),U.RE_SPLITTEXT=new RegExp([l,h,n,a,u,p,v,y,w,k,T,C,K,$,Y,Q,ne,Oe,ce,ve,ie,J,fe,ke,De,P,q,W,Z,ee,j,oe,Te,Pe,yt,rt,vt,bt,St,xt,nt,We].join("|"),"ig"),!0},Oo=function(i,t){return i!==void 0&&Ll(i,t),Object.assign({},U)};const Oc=Phaser.Utils.Objects.GetValue;class Bl{constructor(t){var e=Oc(t,"delimiters","[]");this.tagRegex=Oo(e),this.delimiters=e}getStrokeThinkness(t,e){var s;return e.hasOwnProperty("stroke")?s=t.strokeThickness:s=0,s}setDelimiters(t,e){return Ll(t,e)&&(this.tagRegex=Oo()),this}}var Ic={splitText:fc,tagTextToProp:gc,propToContextStyle:yc,propToTagText:bc};Object.assign(Bl.prototype,Ic);class Tc extends Dl{constructor(t,e,s,r,n){var a=new Bl(n);super(t,e,s,r,n,"rexBBCodeText",a)}setDelimiters(t,e){return this.parser.setDelimiters(t,e),this}}const Fr={pos:{x:0,y:0},condition:i=>yi(i.scene)},Zr={[le.Inventor]:{x:550,y:635,scale:.75,image:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor",positionData:[Fr]},[le.Stranger]:{x:1340,y:1500,scale:1.35,image:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[le.Sphinx]:{x:3520,y:790,scale:1,image:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",light:1.85,positionData:[{pos:{x:3720,y:700},condition:i=>i.scene.player.gameState.data.sphinxMoved,onMove:i=>Lo(i.scene,!0)},{pos:{x:3520,y:790},condition:()=>!0,onMove:i=>Lo(i.scene,!1)}]},[le.Mayor]:{x:790,y:-350,scale:.9,image:"mayor",portrait:"mayor_portrait",name:"Joleen the Mayor",positionData:[Fr]},[le.Innkeeper]:{x:2300,y:-1240,scale:1.1,image:"innkeeper",portrait:"innkeeper_portrait",name:"Bart the Innkeeper",skipLighting:!0},[le.Baker]:{x:1836,y:-1205,scale:.85,image:"baker",portrait:"baker_portrait",name:"Amanda the Baker",skipLighting:!0,positionData:[Fr,{condition:i=>i.scene.player.gameState.data.day>1,pos:{x:2470,y:-320}}]}},Ze={[G.ClockTower]:{x:880,y:-2090,scale:.5,name:"Clock Tower",portrait:"clock_portrait",particles:{scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]}},[G.Chest]:{x:4955,y:915,image:"chest",scale:{x:4.5,y:3}},[G.LabHatch]:{x:-1910,y:640,name:"Trap Door"},[G.LabBook]:{x:-700,y:1630,scale:.7,name:"Journal",image:"book",skipLighting:!0},[G.AlchemySet]:{x:-2650,y:1600,scale:.7,image:"alchemy_empty",skipLighting:!0,particles:{scale:{min:.05,max:.15},speed:{min:30,max:120},alpha:{values:[0,.5,0]},gravityY:100,lifespan:{min:250,max:500},emitting:!1,stopAfter:60},onCreate:i=>In(i.scene.player)},[G.LabBookshelf1]:{x:-2025,y:1700,name:"Bookshelf"},[G.LabBookshelf2]:{x:-1290,y:1700,name:"Bookshelf"},[G.LabBookshelf3]:{x:-1115,y:1700,name:"Bookshelf"},[G.LabPotionShelf1]:{x:-1790,y:1700,name:"Potion Shelf"},[G.MansionPicture]:{x:-1233,y:-580,scale:1.2,angle:5,name:"Picture",image:"picture",origin:{x:0,y:0},onCreate:i=>{const t=i.scene.player;ft(t,D.SafeDiscovered)&&Ul(t,!0)}},[G.MansionHole]:{x:-1870,y:-490,name:"Hole in the Wall"},[G.Bed]:{x:2670,y:-1530,scale:{x:7,y:2}},[G.LibraryShelf]:{x:2100,y:-290,name:"Library Shelf"}},Pc={octave:3.5,speed:1,volume:1,type:"sine"},Cc={octave:3.7,speed:.75,volume:.9},Ac={[le.Inventor]:{octave:3.3,speed:1,volume:1.8},[le.Stranger]:{octave:2.8,speed:1.1,volume:2.6},[le.Sphinx]:{octave:2.5,speed:2,volume:2,type:"triangle"},[le.Mayor]:{octave:3.9,speed:.8,volume:.8}},Rc={[G.ClockTower]:{octave:2.1,speed:1.5,volume:1.5,type:"sawtooth"}};function Mc(i,t=15){const e=i.text,s=e.replace(/[^ ]/g," ");i.text="";let r="",n=0;const a=i.scene.time.addEvent({delay:t,loop:!0});return{promise:new Promise(o=>{a.callback=()=>{if(n>=e.length)return i.text=e,a.destroy(),i.getWrappedText().length>sn&&console.error("Message too long!",e),o();r=_c(e,n+1),n++;const l=s.substring(r.replace(/\<[^\>]+\>/g,"").length);i.text=r+l}}),stop:()=>{a.destroy(),i.text=e,i.getWrappedText().length>sn&&console.error("Message too long!",e)}}}function _c(i,t){let e="",s=[],r=0,n=0;for(;r<t&&n<i.length;){if(i[n]==="<"){let a=i.indexOf(">",n);if(a!==-1){let o=i.substring(n,a+1);e+=o,o.startsWith("</")?s.pop():o.endsWith("/>")||s.push(o),n=a+1;continue}}e+=i[n],r++,n++}for(let a=s.length-1;a>=0;a--){let o=s[a].match(/\<([^\>=]*)/);o&&(e+=`</${o[1]}>`)}return e}function Dc(i,t,e,s){return e===0?{promise:Promise.resolve()}:(s.sound.unlock(),((n,a)=>{let o=!1;const l=()=>{o=!0},h=u=>new Promise(p=>{const g=a.sound.addAudioSprite("words");g.on("complete",()=>{g.destroy(),p()}),g.play(u,{rate:3,detune:(t.octave-4)*300})});return{promise:new Promise(async u=>{const p=n.toLowerCase().split(" "),g=3;for(let v=0;v<p.length&&!o;v+=g){const y=p[v][0];y.charCodeAt(0)>=97&&y.charCodeAt(0)<=122&&await h(y)}u()}),stop:l}})(i,s))}function Lc(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(t=>navigator.userAgent.match(t))}function Bc(i,t){const e=t?il:wh;f.zoomed=t,f.width=e.width,f.height=e.height,f.cameraOffset=e.height/3,i.scale.setGameSize(e.width,e.height),i.scene.restart()}const Xt=ut(L(_.Background));function Mt(i,t,e){const s=i.cameras.main;if(s.fadeEffect&&s.fadeEffect.progress===1&&s.fadeEffect.direction===!1){e&&i.time.delayedCall(t,()=>e());return}s.fadeIn(t,Xt.red,Xt.green,Xt.blue,(r,n)=>{n>=1&&e&&e()})}function Ye(i,t,e){const s=i.cameras.main;if(s.fadeEffect&&s.fadeEffect.progress===1&&s.fadeEffect.direction===!0){e&&i.time.delayedCall(t,()=>e());return}s.fadeOut(t,Xt.red,Xt.green,Xt.blue,(r,n)=>{n>=1&&e&&e()})}function pi(i,t,e){return E.Math.Distance.BetweenPointsSquared(i,t)<e*e}function Fl(i){return i.inventory.initialized&&i.quests.initialized&&i.journal.initialized&&i.gameState.initialized}function st(i,t,e){return Fl?pi(i,t,e||1e3):!1}function qe(i,t,e){var s,r;i.player.message.setDialog(),i.player.message.setVisible(!1),(s=i.gamepad)==null||s.setAlpha(0),(r=i.gamepad)==null||r.resetButtons(),i.scene.pause(),i.scene.launch(t,{player:i.player,...e})}function Io(i,t,e){if(t&&Object.values(t).includes(i)){const s=Object.keys(t).find(r=>t[r]===i);return`${e}.${s}`}return i}function mn(i){return i.replace(/([A-Z]+|[0-9]+)/g," $1").replace(/\s*([\(\[\{])\s*/g," $1").replace(/\s*([\)\]\}])\s*/g,"$1 ").replace(/\s+/g," ").trim()}let To;const qi=document.documentElement;function Fc(){qi.style.cursor="default",clearTimeout(To),To=setTimeout(()=>{qi.style.cursor="none"},2500)}function Nc(){qi.style.cursor="none",qi.addEventListener("mousemove",Fc)}class tt extends E.GameObjects.GameObject{constructor(e,s,r,n,a,o){super(e,"DebugLight");d(this,"x");d(this,"y");d(this,"light");d(this,"debug");e.add.existing(this),this.light=e.lights.addLight(s,r,n,a,o),this.debug=e.add.graphics({x:s,y:r}).setDepth(V.Debug),this.debug.lineStyle(3,a),this.debug.name="DebugLightGraphics",this.x=s,this.y=r,f.debug&&this.debug.strokeCircle(0,0,n)}setPosition(e,s){this.light.setPosition(e,s),this.debug.setPosition(e,s),this.x=e,this.y=s}setIntensity(e){this.light.setIntensity(e)}setVisible(e){this.light.setVisible(e)}destroy(e){var s,r;super.destroy(e),this.debug.destroy(),(r=(s=this.scene)==null?void 0:s.lights)==null||r.removeLight(this.light)}}var A=(i=>(i[i.Up=0]="Up",i[i.Down=1]="Down",i[i.Left=2]="Left",i[i.Right=3]="Right",i[i.Continue=4]="Continue",i[i.Back=5]="Back",i[i.Shift=6]="Shift",i))(A||{});class Ji{constructor(t){d(this,"scene");d(this,"keys",Object.keys(A).map(Number).reduce((t,e)=>({...t,[e]:!1}),{}));d(this,"lastInput");this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W","UP"),this.listener(2,"A","LEFT"),this.listener(1,"S","DOWN"),this.listener(3,"D","RIGHT"),this.listener(4,"SPACE","ENTER"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE"),this.listener(6,"SHIFT"),this.scene.input.on("pointerdown",()=>{this.lastInput="mouse"});const e=()=>this.lastInput="mouse";window.document.addEventListener("pointermove",e),t.events.on("destroy",()=>window.removeEventListener("pointermove",e))}listener(t,e,s){var r,n;(r=this.scene.input.keyboard)==null||r.on(`keydown-${e}`,a=>{var o;s&&((o=this.scene.input.keyboard)==null||o.emit(`keydown-${s}`)),this.keys[t]=!0,a?this.lastInput="keyboard":this.lastInput="gamepad"}),(n=this.scene.input.keyboard)==null||n.on(`keyup-${e}`,a=>{var o;s&&((o=this.scene.input.keyboard)==null||o.emit(`keyup-${s}`)),this.keys[t]=!1,a?this.lastInput="keyboard":this.lastInput="gamepad"})}resetKeys(){Object.entries(this.keys).forEach(([e,s])=>this.keys[Number(e)]=!1)}}class $i extends E.Physics.Arcade.Image{constructor(e,s,r){const n=Zr[s],{x:a,y:o,image:l}=n;super(e,a,o,"characters",l);d(this,"npcType");d(this,"npcData");d(this,"player");d(this,"light");d(this,"particles");d(this,"shadow");d(this,"moveTimeline");d(this,"disabled",!1);d(this,"initialized",!1);this.name=`NPC-${s}`,this.npcData=n,this.npcType=s,this.player=r,this.setDepth(V.Npcs),ti(this,n)}lazyInit(){var c;if(this.initialized||!Fl(this.player))return;let e=pi(this,this.player,1e3);if((c=this.npcData.positionData)==null||c.forEach(u=>{pi(u.pos,this.player,1e3)&&(e=!0)}),!e)return;this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0});const{x:s,y:r,light:n,particles:a,onCreate:o}=this.npcData,l=n||1,h=!ll(this.scene);f.debug?(this.light=new tt(this.scene,this.x,this.y,150*(this.displayHeight/150),16764074,l),this.light.light.setVisible(h)):(this.light=this.scene.lights.addLight(this.x,this.y,150*(this.displayHeight/150),16764074,l),this.light.setVisible(h)),a&&(this.particles=this.scene.add.particles(s,r,"props",{frame:"warp",...a}).setName(`NPC-${this.npcType}-Particles`)),this.shadow=this.scene.add.image(this.x,this.y,"props","warp").setScale(.75,.15).setTint(0).setAlpha(.5),o&&o(this),this.initialized=!0,this.handleMovement(!0)}update(e,s){this.lazyInit(),this.handleMovement()}handleMovement(e=!1){var r,n,a,o,l;if(!this.initialized)return;const s=this.npcData.positionData;if(s&&!this.moveTimeline){const h={x:this.npcData.x,y:this.npcData.y};let c;for(let u=0;u<s.length;u++){const{pos:p,condition:g}=s[u];if(g(this)){h.x=p.x,h.y=p.y,c=s[u].onMove;break}}if(Math.abs(this.x-h.x)>1||Math.abs(this.y-h.y)>1)if(c&&c(this),e)this.setPosition(h.x,h.y);else{const u=this.light instanceof tt?(n=(r=this.light)==null?void 0:r.light)==null?void 0:n.intensity:(a=this.light)==null?void 0:a.intensity,p=200;this.moveTimeline=this.scene.add.timeline([{at:0,tween:{targets:this,alpha:0,duration:p,onUpdate:(g,v,y,m)=>{var w;return(w=this.light)==null?void 0:w.setIntensity(m*u)},onComplete:()=>{var g,v;(g=this.light)==null||g.setVisible(!1),(v=this.light)==null||v.setIntensity(u)}}},{at:p+100,tween:{targets:this,alpha:1,duration:p,delay:p,onStart:()=>{var g,v;(g=this.light)==null||g.setIntensity(0),yi(this.scene)&&((v=this.light)==null||v.setVisible(!0))},onUpdate:(g,v,y,m)=>{var w;return(w=this.light)==null?void 0:w.setIntensity(m*u)}},run:()=>this.setPosition(h.x,h.y)}]).play().once("complete",()=>this.moveTimeline=void 0)}}(o=this.light)==null||o.setPosition(this.x,this.y),(l=this.shadow)==null||l.setPosition(this.x,this.y+this.displayHeight/2)}setPosition(e,s,r,n){return super.setPosition(e,s,r,n),this.light&&e&&s&&this.light.setPosition(e,s),this}onInteract(e){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Ae.None;if(e[A.Continue]){const s=Md[this.npcType],r=Yi(s,this.player,this);if(r&&(r==null?void 0:r.messages.length)>0){const n=this.npcData.portrait.length>0;return this.player.message.setDialog(r,n?this:void 0),Ae.Talked}}return Ae.None}getButtonPrompt(){return[`Talk to ${this.npcData.name}`,"Press [CONTINUE]"]}}const Ci=50,Po=40,Co=25,Nr=45,Ai=Math.PI*2,Nl=1e3*60,$l=Nl*60,$c=$l*12;class vn extends E.GameObjects.Graphics{constructor(e,s,r=!1){super(e);d(this,"player");d(this,"small");d(this,"angle1",0);d(this,"angle2",1);d(this,"angle3",4);d(this,"update1",!1);d(this,"update2",!1);d(this,"update3",!1);this.name="ClockHands",e.add.existing(this),this.player=s;const n=r?897:842,a=r?247:-2107;this.setPosition(n,a),this.setDepth(V.Npcs),this.updateHands(),this.small=r}update(e){if(!pi(this,this.player,f.width/1.5))return;this.update1&&(this.angle1=Ai*(e/Nl)*Nr),this.update2&&(this.angle2=Ai*(e/$l)*Nr),this.update3&&(this.angle3=Ai*(e/$c)*Nr),this.clear(),this.fillStyle(L("#224477")),this.fillCircle(0,0,5);const s=this.small?.4:1,r=this.small?1.35:1,n=this.small?.7:1,a=this.small?4:6,o=this.small?1:2;[a,o].forEach(l=>{this.lineStyle(l,L(l===o?"#4477aa":_.Black)),this.lineBetween(0,0,Math.cos(this.angle1)*Ci*s,Math.sin(this.angle1)*Ci*s),this.lineBetween(0,0,Math.cos(this.angle2)*Po*s,Math.sin(this.angle2)*Po*s),this.lineBetween(0,0,Math.cos(this.angle3)*Co*s*r,Math.sin(this.angle3)*Co*s*r)}),this.lineStyle(this.small?3:5,L(_.Black));for(let l=0;l<12;l++){const h=Ai*(l/12),c=Math.cos(h)*Ci*s*n,u=Math.sin(h)*Ci*s*n;this.lineBetween(c,u,c*1.5,u*1.5)}}updateHands(){ft(this.player,D.ClockFirstGear)&&(this.update1=!0),ft(this.player,D.ClockSecondGear)&&(this.update2=!0)}}class Vi extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a,image:o}=Ze[s];super(e,n,a,o?"props":"",o||"");d(this,"propType");d(this,"player");d(this,"particles");d(this,"clock");d(this,"initialized",!1);d(this,"disabled",!1);this.name=`Prop-${s}`,this.propType=s,this.player=r,this.setScale(o?.35:2).setDepth(V.Items),!o&&!f.debug&&this.setAlpha(0),ti(this,Ze[s]),s===G.MansionPicture&&this.resetPostPipeline()}lazyInit(){if(this.initialized||!st(this,this.player)||this.checkDestroyed())return;this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0});const{particles:e,onCreate:s}=Ze[this.propType];e&&(this.particles=this.scene.add.particles(this.x,this.y,"props",{frame:"warp",...e}).setDepth(V.Items).setName(`Prop-${this.propType}-Particles`)),this.propType===G.MansionPicture&&this.scene.add.image(this.x,this.y,"props","safe").setOrigin(0,0).setScale(.9).setName("Prop-Safe").setPipeline("Light2D"),this.propType===G.ClockTower&&(this.clock=new vn(this.scene,this.player)),s&&s(this),this.initialized=!0}onInteract(e){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Ae.None;if(e[A.Continue]){const s=Vo[this.propType]||[],r=Yi(s,this.player,this);if(r&&(r==null?void 0:r.messages.length)>0)return this.player.message.setDialog(r,this,Ze[this.propType].portrait||"player_portrait"),Ae.Prop}return Ae.None}checkDestroyed(){let e=!1;return this.propType===G.LabHatch&&ft(this.player,D.AlchemyLabFound)&&(e=!0),this.propType===G.Chest&&it(this.player,I.Gear1)&&(e=!0),e&&this.destroy(),e}getButtonPrompt(){const e=Vo[this.propType]||[],s=Yi(e,this.player,this);let r=Ze[this.propType].name||G[this.propType];r=mn(r),this.propType===G.MansionPicture&&ft(this.player,D.SafeDiscovered)&&(r="Safe");let n="Inspect";return this.propType===G.Bed&&(n="Rest in"),s&&(s==null?void 0:s.messages.length)>0?[`${n} ${r}`,"Press [CONTINUE]"]:""}update(e){var s;this.lazyInit(),(s=this.clock)==null||s.update(e)}}function Wc(i){i.anims.create({key:"walk",frames:i.anims.generateFrameNumbers("character",{start:0,end:5}),repeat:-1,frameRate:f.prod?6:9}),i.anims.play("walk")}const en=5;function Zi(i){var r,n;const t=i.x-i.previousPosition.x;Math.abs(((r=i.body)==null?void 0:r.velocity.x)||0)>1||Math.abs(((n=i.body)==null?void 0:n.velocity.y)||0)>1||Math.abs(t)>1?i.anims.resume():i.anims.pause();const s=t<0;Math.abs(t)>0&&(i.flipX=i.rewinding?!s:s),i.setAngle(i.flipX?-5:en)}const $r=1e3*60*f.dayMinutes,Wl=250,zl=8;class mf extends E.GameObjects.Container{constructor(e,s,r){var n,a;super(e,40,f.height-60);d(this,"currentTime",0);d(this,"rewindCount",0);d(this,"player");d(this,"rewindable");d(this,"rewinding",!1);d(this,"counter",0);d(this,"bar");d(this,"hand");d(this,"timeText");d(this,"dayOver");this.name="Clock",this.setVisible(f.rewindEnabled).setDepth(V.Ui).setScrollFactor(0),this.scene.add.existing(this),this.rewindable=s,this.player=r,this.add(e.add.image(0,0,"items","watch")),this.hand=e.add.rectangle(0,10,3,14,L(_.Black)).setOrigin(0,0),this.add(this.hand),this.timeText=e.add.text(15,10,"",ge).setScrollFactor(0),this.bar=e.add.rectangle(0,f.height-6,0,6,13412864).setScrollFactor(0),(n=this.scene.input.keyboard)==null||n.on("keydown-SHIFT",()=>{this.rewinding=!0,this.rewindable.forEach(o=>o.setRewind(!0))}),(a=this.scene.input.keyboard)==null||a.on("keyup-SHIFT",()=>{this.rewinding=!1,this.rewindable.forEach(o=>o.setRewind(!1))})}update(e,s){var c;const r=this.currentTime/f.dayMinutes;this.bar.width=f.width*r;const n=60*60*1e3,a=7*n+this.currentTime/$r*17*n,o=Math.floor(a/1e3/60/60%12),l=Math.floor(a/1e3/60%60),h=a/n<12?"AM":"PM";this.timeText.setText(`${o===0?"12":o}:${l.toString().padStart(2,"0")} ${h}`),this.hand.setAngle(a/(n*12)*360+180),this.currentTime>$r&&!this.rewinding&&!this.player.message.visible&&(this.dayOver=this.scene.add.text(250,250,"Day Over",{...ge,fontSize:96}).setScrollFactor(0),this.rewinding=!0,this.rewindable.forEach(u=>u.setRewind(!0))),this.rewinding?this.currentTime>0?this.currentTime=Math.max(0,this.currentTime-s*zl):(this.rewinding=!1,this.rewindable.forEach(u=>{u.setRewind(!1),u.reset&&u.reset()}),(c=this.dayOver)==null||c.destroy(),this.rewindCount++):this.player.message.visible||(this.counter>Wl&&(this.rewindable.forEach(u=>u.record()),this.counter=0),this.counter+=s,this.currentTime+=s),this.bar.width=this.currentTime/$r*f.width}}class Ao extends E.GameObjects.Text{constructor(t){super(t,f.width/2,f.height-50,"",ge),this.setOrigin(.5).setBackgroundColor("#"+_.Black).setPadding(10,5).setAlign("center").setAlpha(.8).setScrollFactor(0).setDepth(V.Overlay).setVisible(!1),t.add.existing(this)}}const Tt={[I.Wrench]:{x:0,y:0,image:"wrench",name:"Old Wrench"},[I.Gear1]:{x:0,y:0,image:"gear",name:"Shiny Gear"},[I.Key]:{x:0,y:0,image:"key",name:"Rusty Key",skipLighting:!0},[I.HerbRed]:{x:-200,y:1730,image:"herb_red",name:"Crimson Starbloom"},[I.HerbGreen]:{x:5650,y:985,image:"herb_green",name:"Green Writhewood"},[I.HerbBlue]:{x:1535,y:875,image:"herb_blue",name:"Blue Plumed Frond"},[I.Potion]:{x:0,y:0,image:"potion",name:"Strange Potion"},[I.Gear2]:{x:0,y:0,image:"gear2",name:"Old Gear"},[I.Note]:{x:0,y:0,image:"note",name:"Old Note"}};class zc extends E.GameObjects.Container{constructor(e){super(e,0,0);d(this,"inventory",[]);d(this,"text");d(this,"rect");d(this,"initialized");this.setScrollFactor(0).setDepth(V.Ui).setVisible(!1),this.initialized=!1}createUI(){this.initialized||(this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,L(_.Slate)).setStrokeStyle(2,L(_.White)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...ge,fontSize:32}),this.add(this.text),this.initialized=!0)}addItem(e,s){if(this.initialized||this.createUI(),this.inventory.push(e),!e.used){const n=this.scene.add.image(0,0,"items",Tt[e.type].image).setScale(.35);e.type===I.Key&&n.setAngle(45),this.add(n)}this.updateItems();const r=Ql(this.scene,e.type);r==null||r.destroy(),s||(new Ne(this.scene,`New item added: ${Tt[e.type].name}`),ns(this.scene))}useItem(e){var r;this.initialized||this.createUI();const s=this.inventory.find(n=>n.type===e);s&&(s.used=!0,(r=this.getAll().find(n=>{var a,o;return(((a=n.frame)==null?void 0:a.name)||((o=n.texture)==null?void 0:o.key))===Tt[e].image}))==null||r.destroy()),this.updateItems()}updateItems(){var r;this.initialized||this.createUI();let e=0;this.getAll().forEach(n=>{if(n instanceof E.GameObjects.Image){const a=32+50*e;n.setPosition(a,68),e++}}),this.setVisible(this.inventory.length>0);const s=Math.max(((r=this.text)==null?void 0:r.displayWidth)+18,50*e+12);this.setPosition(f.width-s-20,20),this.rect.setSize(s,102)}}const bn={[D.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[D.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:M.ClockSquareNorth},[D.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[D.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:M.LabHatch},[D.AlchemySetFixed]:{description:"With the alchemy set fixed, I can now attempt to create the brew mentioned in the old journal."},[D.ExtraPotionInformation]:{description:'I found an extra journal entry with more information on the potion. It stated the name of the potion was the "Exlixir of Sight". This potion must be the key to finding a gear.'},[D.SafeDiscovered]:{description:"I discovered a safe in the abandonded mansion. I wonder what secrets it holds."},[D.ClockSecondGear]:{description:"I found the second gear for the clock tower inside a safe, which was located within the abandoned mansion. I still need one more gear to fix it."}},Gc=`precision mediump float;

uniform float     uAlpha;
uniform float     uChromaticAberration;

uniform sampler2D uMainSampler;

varying vec2 outTexCoord;

// slight modifications made to original shader
// use alpha channel for fragColor + changed uniform names

// original shader from: https://www.shadertoy.com/view/WsVSzV
// tips for chromatic aberration: https://lettier.github.io/3d-game-shaders-for-beginners/chromatic-aberration.html

const float warp = 0.35;     // simulate curvature of CRT monitor (larger number = more curvature)
const float scan = 0.75;    // simulate darkness between scanlines
const float scanSize = 0.85; // size of scanlines [0.0 - 2.0] (smaller number = taller scanlines)

// TODO: Remove hardcoded screen size
vec2 pixels = vec2(floor(960. / uChromaticAberration / 2.), floor(540. / uChromaticAberration / 2.));

float chromaticAberration = 0.15 * uAlpha * uChromaticAberration;
float redOffset   =  0.006 * chromaticAberration;
float greenOffset =  0.003 * chromaticAberration;
float blueOffset  = -0.003 * chromaticAberration;

vec4 mainImage(in vec2 fragCoord, in vec2 uv) {
  if (uAlpha <= 0.0) {
    return texture2D(uMainSampler, uv);
  }

  // squared distance from center
  vec2 dc = abs(0.5-uv);
  dc *= dc;

  // warp the fragment coordinates
  uv.x -= 0.5; uv.x *= 1.0+(dc.y*(0.3*warp)); uv.x += 0.5;
  uv.y -= 0.5; uv.y *= 1.0+(dc.x*(0.4*warp)); uv.y += 0.5;

  vec2 chromaticOffset = vec2((abs(0.5-uv) + 0.5) * 2.);

  if (uChromaticAberration > 1.) {
    uv.x -= mod(uv.x, 1.0/pixels.x);
    uv.y -= mod(uv.y, 1.0/pixels.y);
  }

  vec4 color;
  color.r = texture2D(uMainSampler,uv + vec2(redOffset * chromaticOffset)).r;
  color.g = texture2D(uMainSampler,uv + vec2(greenOffset * chromaticOffset)).g;
  color.b = texture2D(uMainSampler,uv + vec2(blueOffset * chromaticOffset)).b;
  color.a = texture2D(uMainSampler,uv).a;

  // sample inside boundaries, otherwise set to black
  if (uv.y > 1.0 || uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0) {
      return vec4(0.0);
  } else {
    // determine if we are drawing in a scanline
    float apply = abs(sin(fragCoord.y * scanSize)*0.5*scan);

    apply = uAlpha * apply;

    // sample the texture
    return vec4(mix(color.rgb,vec3(0.0), apply), color.a);
  }
}

void main(void) {
  gl_FragColor = mainImage(gl_FragCoord.xy, outTexCoord);
}`;let wn=1,Sn=1;class Gl extends E.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,renderTarget:!0,fragShader:Gc})}onPreRender(){this.set1f("uAlpha",wn),this.set1f("uChromaticAberration",Sn)}}class jc extends E.Plugins.ScenePlugin{boot(){var e;wn=1,Sn=1,(e=this.systems)==null||e.events.on("start",this.applyPipeline,this);const{save:t}=Cn();xn(t.settings.useShader)}applyPipeline(){var e,s;(e=this.scene)==null||e.cameras.main.setPostPipeline("CRTPipeline");const t=(s=this.scene)==null?void 0:s.cameras.main.getPostPipeline(Gl);t==null||t.bootFX()}}function xn(i){i!==void 0?f.useShader=i:f.useShader=!f.useShader,wn=f.useShader?1:0}function Xi(i){Sn=i}const Hc=`precision mediump float;

uniform float     uAlpha;
uniform sampler2D uMainSampler;

varying vec2 outTexCoord;

void main(void)
{
  vec4 baseColor = vec4(texture2D(uMainSampler, outTexCoord).rgba);
  vec4 newColor = baseColor;
  newColor.g *= 1.25;
  newColor.r *= 2.5;
  newColor.b *= 3.;

  gl_FragColor = mix(baseColor, newColor, uAlpha);
}`;let Pt=0;class Uc extends E.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,fragShader:Hc})}onPreRender(){this.set1f("uAlpha",Pt)}}function es(i,t,e=!1){const s=t?.85:0;if(Xi(1),Pt===s)return;if(e){Pt=s;return}const r=t?0:1750;i.sound.playAudioSprite("sfx","xray",{rate:.85,delay:r/1e3}),i.tweens.addCounter({from:Pt,to:t?.85:0,onUpdate:n=>Pt=n.getValue(),duration:t?2500:1500,delay:r,ease:t?"Bounce":void 0}),i.tweens.addCounter({from:1,to:15,onUpdate:n=>Xi(n.getValue()),ease:"Bounce",duration:1e3,delay:r,yoyo:!0})}class qc extends E.GameObjects.Image{constructor(e,s){super(e,f.width-50,f.height-55,"items","journal");d(this,"player");d(this,"journal",[]);d(this,"unread");d(this,"initialized");this.player=s,this.initialized=!1}createUI(){var e;this.initialized||(this.setScrollFactor(0).setDepth(V.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(f.width-21,f.height-89,20,20,11141120).setStrokeStyle(2,L(_.Black)).setScrollFactor(0).setDepth(V.Ui2).setVisible(!1),(e=this.scene.input.keyboard)==null||e.on("keydown-J",()=>{this.openJournal()}),this.initialized=!0)}addEntry(e,s){this.initialized||this.createUI(),!this.journal.includes(e)&&(this.journal.length===0&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(e),s||(this.unread.setVisible(!0),new Ne(this.scene,"New journal entry added!")),this.handleSideEffects(e,s||!1))}openJournal(){this.initialized||this.createUI(),this.journal.length!==0&&qe(this.scene,"JournalDialog")}handleSideEffects(e,s){const{warpAdd:r}=bn[e];if(r&&Ki(this.scene,r,!1),e===D.ClockFirstGear||e===D.ClockSecondGear){ei(this.scene,vn).forEach(l=>l.updateHands());const a=e===D.ClockFirstGear&&this.player.gameState.data.day===1,o=e===D.ClockSecondGear&&this.player.gameState.data.day===2;(a||o)&&this.player.gameState.updateData({night:!0},s)}e===D.ExtraPotionInformation&&!it(this.player,I.Gear2)&&es(this.scene,!0,s),e===D.SafeDiscovered&&Ul(this.player,s),s||ns(this.scene)}}const zt={[B.ForestGear]:{description:"Search the forest for clues",warpAdd:M.TownEast,warpComplete:M.TownNorth},[B.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[B.InvestigateTownWest]:{description:"Investigate the western mansion",warpAdd:M.TownWest},[B.ExploreLab]:{description:"Explore the hidden alchemy lab"},[B.FindPotionIngredients]:{description:"Find the 3 potion ingredients"}},Ro=330;class Vc extends E.GameObjects.Container{constructor(e,s){super(e,f.width-Ro-20,120);d(this,"player");d(this,"quests",[]);d(this,"questRectangle");d(this,"initialized");this.player=s,this.initialized=!1}createUI(){if(this.initialized)return;this.scene.add.existing(this),this.setScrollFactor(0).setDepth(V.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,Ro,60,L(_.Slate)).setStrokeStyle(2,L(_.White)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const e=this.scene.add.text(10,4,"Quests",{...ge,fontSize:32});this.add(e),this.initialized=!0}addQuest(e,s){this.initialized||this.createUI(),!this.quests.find(r=>r.id===e.id)&&(this.quests.push(e),this.add(this.scene.add.text(0,0,zt[e.id].description,{...ge,fontSize:20})),this.updateQuests(),s||new Ne(this.scene,`New quest added: ${zt[e.id].description}`),this.handleSideEffects(e.id,e.completed,s))}updateExistingQuest(e,s){this.initialized||this.createUI();const r=this.quests.find(n=>n.id===e);r?(!r.completed&&s&&new Ne(this.scene,`Quest completed: ${zt[r.id].description}`),r.completed=s,this.updateQuests(),this.handleSideEffects(e,s)):console.error(`Quest ${e} not found in player quests`)}updateQuests(){this.initialized||this.createUI();const e=this.quests.filter(a=>!a.completed);let s=1,r=0;this.getAll().forEach(a=>{if(a instanceof E.GameObjects.Text){if(!e.find(o=>a.text===zt[o.id].description)&&a.text!=="Quests")a.destroy();else if(a.text!=="Quests"){const o=14+30*s;a.setPosition(10,o),s++,r=Math.max(r,a.width)}}});const n=r+20;this.setX(f.width-20-n),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(e.length>0),this.questRectangle.setSize(n,50+30*e.length)}handleSideEffects(e,s,r){const{warpAdd:n,warpComplete:a}=zt[e];if(n&&Ki(this.scene,n,!1),s&&a&&Ki(this.scene,a,!1),e===B.FindPotionIngredients&&!s){const o=this.player.scene;o.interactiveObjects.add(new Jt(o,I.HerbGreen,this.player)),o.interactiveObjects.add(new Jt(o,I.HerbBlue,this.player))}e===B.ExploreLab&&!s&&In(this.player),r||ns(this.scene)}reset(){this.quests=[],this.updateQuests()}}const jl=1.35,tn=(f.fastMode?350:175)*jl,Xc=1e3,Yc="Rosie Vale",Ut=new E.Math.Vector2(920,1500);class kn extends E.Physics.Arcade.Sprite{constructor(e){super(e,Ut.x,Ut.y,"character",0);d(this,"scene");d(this,"keys");d(this,"shadow");d(this,"light");d(this,"debug");d(this,"buttonPrompt");d(this,"interactive");d(this,"interactionTimeout",0);d(this,"message");d(this,"inventory");d(this,"quests");d(this,"journal");d(this,"gameState");d(this,"previousPosition",new E.Math.Vector2);d(this,"walkingSound");d(this,"lastPlayedSound",0);d(this,"counter",0);d(this,"history",[]);d(this,"rewinding",!1);d(this,"unlockCamera",!1);this.name="Player",this.scene=e,e.add.existing(this),e.physics.add.existing(this),f.debug&&this.setInteractive(),this.setBodySize(48,74).setDepth(V.Player).setScale(jl).setPipeline("Light2D").setPostPipeline("XRayPipeline"),f.debug?(this.light=new tt(e,this.x,this.y,200,16768443,1),this.debug=e.add.circle(this.x,this.y,3,16711935).setDepth(V.Debug)):this.light=e.lights.addLight(this.x,this.y,200,16768443,1),this.shadow=this.scene.add.image(this.x,this.y,"props","warp").setPipeline("Light2D").setScale(.7,.15).setTint(0),Wc(this),this.keys=new Ji(e),this.message=new On(e,this),this.inventory=new zc(e),this.quests=new Vc(e,this),this.journal=new qc(e,this),this.gameState=new $d(e,this),this.walkingSound=e.sound.addAudioSprite("sfx"),f.perfTest&&e.time.delayedCall(1e3,()=>{this.setVelocityX(tn),e.time.addEvent({delay:1e3,callback:()=>this.setVelocityX(this.body?-this.body.velocity.x:0),loop:!0})})}update(e,s){var a,o,l,h,c;const r=this.interactive&&!this.message.visible&&((o=(a=this.buttonPrompt)==null?void 0:a.text)==null?void 0:o.length)>0||!1;r&&!this.buttonPrompt&&(this.buttonPrompt=new Ao(this.scene)),(l=this.buttonPrompt)==null||l.setVisible(r),f.perfTest||(this.setVelocity(0),this.rewinding?this.counter+s>Wl/zl?(this.rewind(),this.counter=0):this.counter+=s:!this.checkInteraction()&&!this.message.visible&&this.updateVelocity()),f.debug&&this.setTint(this.interactive?16755370:16777215),Zi(this);const n=Math.abs(((h=this.body)==null?void 0:h.velocity.x)||0)>1||Math.abs(((c=this.body)==null?void 0:c.velocity.y)||0)>1;n&&!this.walkingSound.isPlaying&&Date.now()-this.lastPlayedSound>150?this.walkingSound.play("ladder",{loop:!0,rate:.75,volume:.4}):n||(this.walkingSound.stop(),this.lastPlayedSound=Date.now()),this.previousPosition.set(this.x,this.y),this.shadow.rotation>0&&this.shadow.setRotation(Math.max(0,this.shadow.rotation-.075)),this.shadow.rotation<0&&this.shadow.setRotation(Math.min(0,this.shadow.rotation+.075)),this.shadow.setAlpha(this.rotation!==0?.25:.5)}postUpdate(){var e;this.light.setPosition(this.x,this.y-20),this.shadow.setPosition(this.x,this.y+this.displayHeight/2),f.debug&&((e=this.debug)==null||e.setPosition(this.x,this.y))}checkInteraction(){var s;let e;return this.interactive&&Date.now()>this.interactionTimeout&&(e=this.interactive.onInteract(this.keys.keys),e!==Ae.None&&(this.interactionTimeout=Date.now()+(((s=this.interactive)==null?void 0:s.interactionTimeout)||500),this.keys.resetKeys(),e===Ae.Teleported&&(this.interactive=void 0))),e}updateVelocity(){const e=this.keys.keys;let s=1;!f.prod&&e[A.Shift]&&(s=2),this.anims.timeScale=s;const r=tn*s;e[A.Left]&&this.setVelocityX(-r),e[A.Right]&&this.setVelocityX(r),f.debug&&!this.interactive&&(e[A.Up]&&this.setVelocityY(-r),e[A.Down]&&this.setVelocityY(r)),e[A.Left]&&e[A.Right]&&this.setVelocityX(0)}setY(e){return this.setPosition(this.x,e),this}record(){var e;this.history.length<Xc?this.history.push(new E.Math.Vector3(this.x,this.y,((e=this.body)==null?void 0:e.velocity.x)||0)):console.warn("Max history reached")}rewind(){const e=this.history.pop();e&&(this.x=e.x,this.y=e.y,this.setVelocityX(-e.z))}setRewind(e){this.rewinding=e,this.counter=0}reset(){this.quests.reset(),this.setPosition(Ut.x,Ut.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(e){var r,n,a;this.interactive=e,e!=null&&e.onCollided&&e.onCollided();const s=(r=e==null?void 0:e.getButtonPrompt)==null?void 0:r.call(e);s&&!this.buttonPrompt&&(this.buttonPrompt=new Ao(this.scene)),(n=this.buttonPrompt)==null||n.setText(s),(a=this.buttonPrompt)==null||a.setVisible(this.message.visible?!1:(s==null?void 0:s.length)>0)}}class Ke extends E.GameObjects.Text{constructor(e,s,r,n,a,o){super(e,s,r,n,{...ge,fontSize:48,backgroundColor:`#${_.Slate}`,padding:{x:15,y:10},...o});d(this,"onClick");d(this,"disabled");d(this,"selected");this.setOrigin(.5),e.add.existing(this),this.onClick=()=>{this.disabled||(e.sound.playAudioSprite("sfx","button"),this.setSelected(!1),a(this))},this.disabled=!1,this.selected=!1,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",()=>{this.onClick(this)}),this.on("pointerover",()=>{!this.disabled&&!this.selected&&this.setTint(12303291)}),this.on("pointerout",()=>{!this.disabled&&!this.selected&&this.setTint(16777215)})}disable(){this.disabled=!0,this.selected=!1,this.disableInteractive(),this.setTint(6710886)}enable(){this.disabled=!1,this.selected=!1,this.setInteractive(),this.setTint(16777215)}setSelected(e){this.selected=e,this.setTint(e?L(_.ButtonActive):16777215)}}class It extends Ke{constructor(t,e,s,r,n,a,o,l){super(t,e,s,r,n,{fontSize:32,align:"center",...a}),this.setOrigin((l==null?void 0:l.x)||0,(l==null?void 0:l.y)||0),o!==null&&this.setFixedSize((o==null?void 0:o.x)||250,(o==null?void 0:o.y)||50)}}class En extends E.GameObjects.Container{constructor(e,s,r){var n,a,o;super(e,s,r);d(this,"buttons",[]);d(this,"activeIndex",-1);e.add.existing(this).setScrollFactor(0),(n=e.input.keyboard)==null||n.on("keydown-UP",()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))}),(a=e.input.keyboard)==null||a.on("keydown-DOWN",()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))}),(o=e.input.keyboard)==null||o.on("keydown-ENTER",()=>{var l;(l=this.buttons[this.activeIndex])==null||l.onClick()})}addButton(e){this.add(e),this.buttons.push(e),this.buttons.length===1&&this.setActiveButton(0),e.on("pointerover",()=>{this.setActiveButton(-1)})}setActiveButton(e){var s,r;(s=this.buttons[this.activeIndex])==null||s.setSelected(!1),this.activeIndex=e,(r=this.buttons[this.activeIndex])==null||r.setSelected(!0)}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const Ee=20,ni=170,ai=150,Mo=40,sn=4,_o=350,Do=125;class On extends E.GameObjects.Container{constructor(e,s){var a,o;super(e);d(this,"textWidth");d(this,"textHeight");d(this,"player");d(this,"target");d(this,"background");d(this,"npcName");d(this,"text");d(this,"portrait");d(this,"arrow");d(this,"arrowTween");d(this,"options");d(this,"optionsContainer");d(this,"dialog");d(this,"messageIndex");d(this,"interactionTimeout");d(this,"initialized",!1);d(this,"animating",!1);d(this,"stopAnimation");d(this,"stopAudio");const{width:r,height:n}=f;this.textWidth=r-135-Ee*4,this.textHeight=ni-Ee*2,this.setScrollFactor(0),this.setPosition(Ee,n-Ee-ni),this.setDepth(V.Overlay),this.setAlpha(0),this.setVisible(!1),s&&(this.player=s),(a=this.scene.input.keyboard)==null||a.on("keydown-ENTER",()=>{this.options||this.updateDialog()}),(o=this.scene.input.keyboard)==null||o.on("keydown-BACKSPACE",()=>{this.options||this.updateDialog()})}createUI(){this.scene.add.existing(this),this.npcName=new E.GameObjects.Text(this.scene,Ee+ai,Ee-5,"",{...ge,color:"#"+_.Tan}),this.text=new Tc(this.scene,Ee+ai,Ee+Mo,"",{fontFamily:ge.fontFamily,fontSize:ge.fontSize,color:`#${_.White}`}),this.scene.add.existing(this.text),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(sn).setWrapMode("word"),this.text.parser.setDelimiters("<",">"),this.portrait=this.scene.add.image(Ee,Ee,"characters","").setOrigin(0).setScale(1.5),this.background=this.scene.add.rectangle(0,0,f.width,f.height,0,0).setOrigin(0).setDepth(V.Ui).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.options||this.updateDialog()}).setVisible(!1);const e=this.scene.add.rectangle(0,0,f.width-Ee*2,ni,L(_.Black),.9).setStrokeStyle(2,L(_.Tan),1).setOrigin(0,0).setScrollFactor(0).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.options||this.updateDialog()});this.optionsContainer=new En(this.scene).setDepth(V.Overlay),this.arrow=this.scene.add.image(f.width-Ee*2-20,ni-22,"icons","chevron-down").setScale(.5),this.arrowTween=this.scene.tweens.add({targets:this.arrow,y:ni-16,duration:700,ease:"Sine.easeIn",yoyo:!0,repeat:-1}),this.add([e,this.npcName,this.text,this.portrait,this.arrow])}setDialog(e,s,r){var a,o,l;if(this.npcName||this.createUI(),this.animating&&((a=this.stopAudio)==null||a.call(this),(o=this.stopAnimation)==null||o.call(this),this.animating=!1,this.resetArrow()),this.setVisible(!0),this.background.setVisible(!0),this.scene.tweens.add({targets:this,alpha:e!==void 0?1:0,duration:Do,onComplete:()=>this.setVisible(e!==void 0)}),this.target=s,this.messageIndex=0,this.dialog=e,this.interactionTimeout=Date.now()+_o,(l=this.scene.gamepad)==null||l.setAlpha(this.dialog?0:1),!e)return;let n=r;if(s instanceof $i&&(n=Zr[s.npcType].portrait),s instanceof kn&&(n="player_portrait"),this.npcName.setVisible(!1),!n)this.portrait.setVisible(!1),this.text.setPosition(Ee,Ee).setWordWrapWidth(Ee+ai+this.textWidth).setFixedSize(Ee+ai+this.textWidth,this.textHeight);else{this.portrait.setVisible(!0),this.portrait.setFrame(n);let h;n==="player_portrait"?h=Yc:s instanceof $i?h=Zr[s.npcType].name:s instanceof Vi&&(h=Ze[s.propType].name),h&&(this.npcName.setVisible(!0),this.npcName.setText(h)),this.text.setPosition(Ee+ai,Ee+(h?Mo:0)).setWordWrapWidth(this.textWidth).setFixedSize(this.textWidth,this.textHeight)}this.showMessage()}showMessage(){var r,n,a,o;const e=this.getMessages(),s=e&&e[this.messageIndex];if(this.arrow.setAlpha(0),s){this.text.setText(s);let l;((n=(r=this.portrait)==null?void 0:r.frame)==null?void 0:n.name)==="player_portrait"&&(l=Cc),this.target instanceof $i&&(l=Ac[this.target.npcType]),this.target instanceof Vi&&(l=Rc[this.target.propType]),l||(l=Pc);const{promise:h,stop:c}=Dc(s,l,this.scene.sound.mute||(o=(a=this.dialog)==null?void 0:a.mute)!=null&&o.includes(this.messageIndex)?0:this.scene.sound.volume,this.scene),{promise:u,stop:p}=Mc(this.text);this.animating=!0,this.stopAudio=c,this.stopAnimation=p,Promise.all([h,u]).then(()=>{this.animating=!1,this.stopAudio=void 0,this.stopAnimation=void 0,this.resetArrow()})}this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;this.arrowTween.stop(),this.arrow.setAlpha(0);const e=!f.zoomed;this.options.forEach((s,r)=>{const n=new Ke(this.scene,f.width/2,f.height/(e?9:14)+r*(30+f.height/(e?16:22)),s,()=>this.onSelectOption(s),{fontSize:24,backgroundColor:"#"+_.Black,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(V.Overlay);this.optionsContainer.addButton(n)})}onSelectOption(e){var s;(s=this.dialog)!=null&&s.onSelected&&(this.dialog.onSelected(e,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){var s,r,n,a;if(Date.now()<this.interactionTimeout)return;const e=this.getMessages();if(!(!this.dialog||!e)){if(this.animating){(s=this.stopAudio)==null||s.call(this),(r=this.stopAnimation)==null||r.call(this),this.animating=!1,this.resetArrow();return}this.scene.sound.playAudioSprite("sfx","button",{volume:.7}),this.messageIndex++,this.text.setText(""),this.messageIndex>=e.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.scene.tweens.add({targets:this,alpha:0,duration:Do,onComplete:()=>this.setVisible(!1)}),this.background.setVisible(!1),(n=this.scene.gamepad)==null||n.resetButtons()):(this.dialog.onMessageShown&&this.dialog.onMessageShown(this.player,this.messageIndex,this.target),this.scene.time.delayedCall(150,()=>this.showMessage())),(a=this.scene.gamepad)==null||a.setAlpha(this.dialog===void 0?1:0),this.interactionTimeout=Date.now()+_o}}getMessages(){var s;let e=(s=this.dialog)==null?void 0:s.messages;return typeof e=="function"&&(e=e(this.player)),e}getOptions(){var s;let e=(s=this.dialog)==null?void 0:s.options;return typeof e=="function"&&(e=e(this.player)),e}resetArrow(){this.arrowTween.isDestroyed()||this.arrowTween.restart(),this.scene.tweens.add({targets:this.arrow,alpha:1,duration:500})}}const rn=[{x:40,y:600},{x:1750,y:600},{x:320,y:1300},{x:1410,y:1450},{x:510,y:-400},{x:1170,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3610,y:760,id:Gi.Sphinx,onCreate:i=>{var e;i.scene.player.gameState.data.sphinxMoved||i.setX(i.x-Hl),(e=i.body)==null||e.updateFromGameObject()}},{x:4455,y:850},{x:5690,y:900},{x:-565,y:575},{x:-2075,y:575},{x:-1930,y:-480},{x:-1050,y:-510},{x:-3075,y:1630},{x:-1350,y:1510},{x:-730,y:1560},{x:1620,y:-350},{x:3095,y:-350},{x:3510,y:-350},{x:4630,y:-350},{x:1790,y:-1245},{x:2790,y:-1245},{x:2765,y:-1580}];function Kc(i,t){const e=f.zoomed?.75:1,s=new On(i),r=i.add.text(f.width/2,f.height/2,"Later that day...",{...ge,fontSize:"42px"}).setOrigin(.5).setScrollFactor(0).setAlpha(0);t.setAngle(en);const n=i.add.timeline([{at:1500,tween:{targets:t,x:850*e,duration:2500,onComplete:()=>t.anims.pause()},run:()=>{t.anims.resume(),i.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:3100,run:()=>i.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:6e3,run:()=>Ye(i,500)},{at:7500,run:()=>{const l=i.cameras.main;l.stopFollow(),l.centerOn(1e4,1e4),r.setAlpha(1),Mt(i,500)}},{at:1e4,run:()=>Ye(i,500)},{at:12e3,run:()=>{i.textures.exists("warp")?i.scene.start("Game"):i.scene.start("Preloader")}}]),a=i.add.timeline([{at:1500,tween:{targets:t,x:1200*e,duration:2500,onComplete:()=>t.anims.pause()},run:()=>{t.anims.resume(),i.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:3100,run:()=>i.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:5500,run:()=>{t.setFlipX(!0),t.setAngle(-5)}},{at:6500,run:()=>{s.setDialog({messages:["No doubt about it, this will be a strange journey.","Whatever awaits me in this town, it’s certain that nothing will ever be the same again."],onCompleted:()=>n.play()},void 0,"player_portrait")}}]);i.add.timeline([{at:2500,tween:{targets:t,x:850*e,duration:3e3,onComplete:()=>t.anims.pause()},run:()=>{t.anims.resume(),i.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:4100,run:()=>i.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:7e3,run:()=>{t.setFlipX(!0),t.setAngle(-5)}},{at:8e3,run:()=>{t.setFlipX(!1),t.setAngle(en)}},{at:9e3,run:()=>{s.setDialog({messages:["What a beautiful mountain-scape. I almost forgot where I am headed.","It’s been three days since the letter arrived... It has been many years since I last visited that sleepy old town.","Rumors swirl of strange occurrences. People disappearing, clocks that never strike the hour, and a darkness that lingers beneath the surface."],onCompleted:()=>a.play()},void 0,"player_portrait")}}]).play()}function Qc(i){me.start(we.Station);const t=i.add.image(800,1460,"train").setScale(1.35).setDepth(V.Shader),e=i.player;e.previousPosition.set(e.x+1,e.y),Zi(e),e.active=!1,i.add.timeline([{at:200,run:()=>i.sound.playAudioSprite("sfx","train_whistle",{rate:.9,volume:.6})},{at:2500,tween:{targets:t,x:-500,duration:5e3},run:()=>i.sound.playAudioSprite("sfx","train_rolling",{volume:.6})},{at:2500,tween:{targets:t,y:t.y-4,loop:-1,yoyo:!0,duration:100}},{at:7800,run:()=>{t.destroy(),e.message.setDialog({messages:["Now that I have arrived in town, I should talk to the townsfolk about the strange occurrences.","Maybe someone has seen something that could help me start my investigation."],onCompleted:r=>{r.active=!0}},e)}}]).play()}const Hl=150;function Lo(i,t){var s,r;const e=Ld(i,Gi.Sphinx);if(e){const n=((s=rn.find(a=>a.id===Gi.Sphinx))==null?void 0:s.x)||0;e.setX(n-(t?0:Hl)),(r=e.body)==null||r.updateFromGameObject()}Ki(i,M.ForestEast,!t)}function Jc(i){const t=i.scene,e=new Jt(t,I.Gear1,i);t.interactiveObjects.add(e);const s=mi(t,G.Chest);s&&(i.active=!1,i.setX(s.x-75),i.previousPosition.set(i.x-1,i.y),t.sound.playAudioSprite("sfx","chest"),s.setFrame("chest_open"),e.setPosition(s.x,s.y-20),e.setScale(.15),t.tweens.add({targets:e,scale:.35,y:s.y+20,duration:700,onComplete:()=>i.active=!0,ease:"Bounce.easeOut"}))}const ci={[I.HerbRed]:{frame:"alchemy_red",tint:11141120,x:-20},[I.HerbGreen]:{frame:"alchemy_green",tint:43520,x:-35},[I.HerbBlue]:{frame:"alchemy_blue",tint:170,x:-5}};function Wr(i,t,e){i.inventory.useItem(e),i.setActive(!1),!(!t||!t.particles)&&(i.scene.sound.playAudioSprite("sfx","ingredient"),In(i),t.disabled=!0,t.particles.setConfig({...Ze[G.AlchemySet].particles,tint:ci[e].tint,x:ci[e].x}).start().on("complete",()=>{t.disabled=!1,i.setActive(!0)}))}function In(i){const t=mi(i.scene,G.AlchemySet);t&&(t.setFrame("alchemy_empty"),it(i,I.Potion)||(di(i,I.HerbBlue)?t.setFrame(ci[I.HerbBlue].frame):di(i,I.HerbRed)?t.setFrame(ci[I.HerbRed].frame):di(i,I.HerbGreen)&&t.setFrame(ci[I.HerbGreen].frame)))}function Zc(i,t){const e=i.scene;i.inventory.useItem(I.HerbBlue),i.setActive(!1),Ye(e,500,()=>{e.time.delayedCall(700,()=>{var s;t==null||t.setFrame("alchemy_full"),(s=t==null?void 0:t.particles)==null||s.setConfig({...Ze[G.AlchemySet].particles,tint:[6684791],x:30,delay:350,stopAfter:120}).start(),e.sound.playAudioSprite("sfx","potion"),Mt(e,1500,()=>{i.message.setDialog({messages:["I have created the potion mentioned in the old journal.","I should bring it to the mysterious stranger to see if they know how to use it."],onCompleted:(r,n)=>{r.inventory.addItem({type:I.Potion,used:!1}),r.quests.updateExistingQuest(B.ExploreLab,!0),n==null||n.setFrame("alchemy_empty"),r.setActive(!0)}},t,"player_portrait")})})})}function Ul(i,t){const e=mi(i.scene,G.MansionPicture),s=97;t?e==null||e.setAngle(s):(i.setActive(!1),e==null||e.scene.tweens.add({targets:e,angle:s,duration:1500,onComplete:()=>{i.setActive(!0),i.message.setDialog({messages:["A sturdy looking safe was hidden behind the picture.","It looks like it requires a special key to open."]},i)}}))}function ed(i){i.inventory.useItem(I.Potion),i.active=!1;const t=i.scene,e=new Jt(i.scene,I.Gear2,i);t.interactiveObjects.add(e);const s=mi(t,G.MansionPicture);s&&(es(t,!1),t.sound.playAudioSprite("sfx","safe_open"),e.setPosition(s.x,s.y+20),t.tweens.add({targets:e,x:s.x-10,y:s.y+120,duration:1e3,hold:3750,onComplete:()=>{i.message.setDialog({messages:["Wow, that was wild.","I should be more careful next time before I drink random potions.","At least I found the gear!"],onCompleted:()=>t.time.delayedCall(500,()=>i.active=!0)},s,"player_portrait")},ease:"Bounce.easeOut"}))}function td(i){me.stop(),i.setActive(!1),i.gameState.updateData({day:i.gameState.data.day+1,night:!1}),i.scene.add.timeline([{at:0,run:()=>Ye(i.scene,500,()=>{i.setPosition(2660,i.y),i.previousPosition.set(i.x+1,i.y),Zi(i)})},{at:1e3,run:()=>i.scene.sound.playAudioSprite("sfx","lullaby",{rate:.85,volume:.4})},{at:4e3,run:()=>{Mt(i.scene,1e3,()=>{i.message.setDialog({messages:["Ah, what a lovely rest. Time to get back to work!"],onCompleted:t=>t.setActive(!0)},i)})}}]).play()}class id extends E.GameObjects.Container{constructor(e,s){var n;super(e,0,0);d(this,"text");d(this,"rect");d(this,"player");d(this,"activeElement");d(this,"outline");d(this,"scene");d(this,"xray",!1);d(this,"dragOffset",new E.Math.Vector2);d(this,"historyStack",[]);d(this,"debugCamera");if(this.scene=e,this.player=s,e.physics.world.drawDebug=f.debug,f.debug?e.physics.world.createDebugGraphic():(n=e.physics.world.debugGraphic)==null||n.clear(),this.createEventListeners(),!f.debug)return;this.setScrollFactor(0).setDepth(V.Debug).setAlpha(.8),this.scene.add.existing(this),this.rect=e.add.rectangle(0,0,0,0,L(_.Black)).setOrigin(0).setDepth(V.Debug),this.add(this.rect),this.text=e.add.bitmapText(20,90,"m6x11-24",""),this.add(this.text),this.outline=e.add.rectangle(0,0,0,0).setStrokeStyle(6,65280).setDepth(V.Debug),this.debugCamera=e.add.rectangle(0,0,f.width,f.height).setStrokeStyle(4,14518272).setDepth(V.Debug);const r=e.cameras.main;r.on("followupdate",()=>{this.debugCamera.setPosition(f.width/2+r.scrollX,f.height/2+r.scrollY)})}createEventListeners(){var e,s,r,n,a,o,l,h,c,u,p,g,v;(e=this.scene.input.keyboard)==null||e.on("keydown-K",()=>{et(this.scene)}),(s=this.scene.input.keyboard)==null||s.on("keydown-L",()=>{this.scene.scene.restart()}),(r=this.scene.input.keyboard)==null||r.on("keydown-M",()=>{localStorage.removeItem(Qe),this.scene.scene.restart()}),(n=this.scene.input.keyboard)==null||n.on("keydown-N",()=>{localStorage.removeItem(Qe),this.scene.scene.start("Preloader")}),(a=this.scene.input.keyboard)==null||a.on("keydown-Z",()=>{f.debug=!f.debug,et(this.scene),this.scene.scene.restart()}),(o=this.scene.input.keyboard)==null||o.on("keydown-X",()=>{if(this.historyStack.length>0){const y=this.historyStack.pop();(y==null?void 0:y.object)instanceof tt?y.object.destroy():y.object.setPosition(y.x,y.y)}}),(l=this.scene.input.keyboard)==null||l.on("keydown-FORWARD_SLASH",()=>{this.scene.player.gameState.updateData({night:!this.scene.player.gameState.data.night})}),(h=this.scene.input.keyboard)==null||h.on("keydown-CLOSED_BRACKET",()=>{qe(this.scene,"DebugTool")}),(c=this.scene.input.keyboard)==null||c.on("keydown-QUOTES",()=>{es(this.scene,!this.xray),this.xray=!this.xray}),(u=this.scene.input.keyboard)==null||u.on("keydown-PLUS",()=>{this.scene.scale.isFullscreen?this.scene.scale.stopFullscreen():this.scene.scale.startFullscreen()}),(p=this.scene.input.keyboard)==null||p.on("keydown-V",()=>{this.player.message.setDialog({messages:["<b><i>[CREAK]</i></b> A <color=red>red</color> test [CREAK]"]})}),f.debug&&((g=this.scene.input.keyboard)==null||g.on("keydown-COMMA",()=>{const y=this.scene.lights.lights;console.table(y,["x","y"])}),(v=this.scene.input.keyboard)==null||v.on("keydown-PERIOD",()=>{const y=this.scene.input.activePointer,m=new tt(this.scene,y.worldX,y.worldY,100,L(_.Lights),1);this.historyStack.push({x:m.x,y:m.y,object:m})}),this.scene.input.on("gameobjectdown",(y,m)=>{y.buttons===1&&(m instanceof kn||(m&&m!==this.activeElement?(this.activeElement=m,this.dragOffset.set(m.x-y.worldX,m.y-y.worldY),this.historyStack.push({x:m.x,y:m.y,object:m})):(this.activeElement=void 0,this.dragOffset.set(0,0))))}),this.scene.input.on("drag",(y,m)=>{this.activeElement===m&&m.setPosition(this.dragOffset.x+y.worldX,this.dragOffset.y+y.worldY)}),this.scene.input.on("wheel",(y,m,w,k,x)=>{this.scene.cameras.main.zoom=Math.max(.01,this.scene.cameras.main.zoom+k*5e-4)}),this.scene.input.on("pointerup",y=>{y.button===1&&(this.scene.cameras.main.zoom=1)}))}update(){if(!f.debug)return;const e=this.scene.input.activePointer,s=[`FPS (now): ${(1e3/this.scene.game.loop.delta).toFixed(1)}`,`FPS (avg): ${this.scene.game.loop.actualFps.toFixed(1)}`,`Frame Time: ${this.scene.game.loop.delta.toFixed(2)}`,`Camera: ${this.scene.cameras.main.scrollX.toFixed(1)}, ${this.scene.cameras.main.scrollY.toFixed(1)}`,`Zoom: ${this.scene.cameras.main.zoom.toFixed(2)}`,"",`Player x: ${this.player.x.toFixed(1)}`,`Player y: ${this.player.y.toFixed(1)}`,"",`Mouse x: ${e.worldX.toFixed(1)}`,`Mouse y: ${e.worldY.toFixed(1)}`];if(this.activeElement&&(s.push(""),s.push(`Active x: ${this.activeElement.x.toFixed(1)}`),s.push(`Active y: ${this.activeElement.y.toFixed(1)}`)),this.text.setText(s),this.rect.setPosition(this.text.x-10,this.text.y-10).setSize(this.text.displayWidth+20,this.text.displayHeight+20),this.activeElement){this.outline.setPosition(this.activeElement.x,this.activeElement.y),this.outline.setSize(this.activeElement.displayWidth,this.activeElement.displayHeight),this.outline.setOrigin(this.activeElement.originX,this.activeElement.originY),this.outline.setAngle(this.activeElement.angle||0);const r=this.activeElement.body;(r&&r instanceof E.Physics.Arcade.Body||r instanceof E.Physics.Arcade.StaticBody)&&r.updateFromGameObject()}else this.outline.setSize(0,0)}}class sd extends E.Physics.Arcade.Image{constructor(e,s,r){var u;const{x:n,y:a,image:o,scale:l}=s;super(e,n,a,o);d(this,"player");d(this,"initialized",!1);d(this,"info");d(this,"center");d(this,"bounds",new E.Geom.Rectangle);d(this,"debug");d(this,"music");this.name=`Background-${s.image}`,this.info=s,this.player=r,this.setOrigin(0).setDepth(V.Backgrounds),ti(this,s);const h=(u=e.textures.get(o))==null?void 0:u.getSourceImage();this.center=new E.Math.Vector2(n+h.width*(l||1)/2,a+h.height*((l||1)/2));const c=Object.entries(Kr).find(([p,g])=>g.locations.includes(this.info.location));this.music=c?c[0]:void 0,f.debug&&(this.debug=e.add.rectangle(this.x,this.y,h.width*(l||1),h.height*(l||1)).setStrokeStyle(6,26214).setOrigin(0).setDepth(V.Debug))}lazyInit(){this.initialized||!st(this.center,this.player,2e3)||(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.getBounds(this.bounds),f.debug&&this.setInteractive({draggable:!0}),this.info.onCreate&&this.info.onCreate(this),this.initialized=!0)}update(){var e,s;if(this.lazyInit(),(e=this.bounds)!=null&&e.contains(this.player.x,this.player.y)&&(this.player.active&&this.music&&me.start(this.music),!f.debug&&!this.player.unlockCamera))if(this.bounds.width<f.width){const r=f.width-this.bounds.width;this.scene.cameras.main.setBounds(this.bounds.x-r/2,this.bounds.y,f.width,this.bounds.height)}else if(this.bounds.height<f.height){const r=f.height-this.bounds.height;this.scene.cameras.main.setBounds(this.bounds.x,this.bounds.y-r/2,this.bounds.width,f.height)}else this.scene.cameras.main.setBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);f.debug&&((s=this.debug)==null||s.setPosition(this.x,this.y))}}function zr(){return Math.random()-.5}const Ri={Forest:[3200,600],Lake:[5125,700]},Gr=[500,200,100,50,10];class Bo extends E.GameObjects.GameObject{constructor(e,s,r,n=40,a=[1400,600]){super(e,"fireflies");d(this,"scene");d(this,"center",new E.Math.Vector2(0,0));d(this,"lights",[]);d(this,"count");d(this,"centers",[]);d(this,"bounds",[1e3,400]);d(this,"biases",[]);d(this,"time",0);d(this,"initialized",!1);d(this,"debug");e.add.existing(this),this.scene=e,this.count=n,this.bounds=a,this.setPosition(s,r)}setPosition(e,s){this.center.set(e,s),this.centers=[];for(let r=0;r<this.count;r++)this.centers.push(new E.Math.Vector2(e+Math.random()*this.bounds[0]-this.bounds[0]/2,s+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(e-this.bounds[0]/2,s-this.bounds[1]/2)}lazyInit(){if(!(this.initialized||!st(this.center,this.scene.player))){for(let e=0;e<this.count;e++){const s=new E.Display.Color(Math.random()*40+50,Math.random()*60+190,Math.random()*20+10),r=this.scene.lights.addPointLight(0,0,s.color,Math.random()*7+3,.15,.045+zr()*.02);this.lights.push(r);const n=[];for(let a=0;a<Gr.length*2;a++)n.push(zr()*Gr[a%Gr.length]);n.push(zr()*10),this.biases.push(n)}f.debug&&(this.debug=this.scene.add.graphics(),this.updateDebug()),this.setPosition(this.center.x,this.center.y),this.initialized=!0}}updateDebug(e=!1){const s=e?13260:16711680;this.debug.clear(),this.debug.fillStyle(s,.5).lineStyle(4,s,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])}update(e,s){this.lazyInit();const r=Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0];if(this.debug&&this.updateDebug(r),!r){this.lights.forEach(h=>h.visible=!1);return}this.time+=s;const a=this.time/1e3*.025,o=Math.cos(a),l=Math.sin(a);this.lights.forEach((h,c)=>{const u=this.biases[c],p=Math.cos(a*70+u[10]);h.visible=!0,h.intensity=Math.min(.2+Math.abs(u[4]*p+u[3]*o+u[4]*o)/50,.4),h.x=o*u[0]+l*u[1]+o*u[2]+l*u[3]+o*u[4]+this.centers[c].x,h.y=l*u[5]+o*u[6]+l*u[7]+o*u[8]+l*u[9]+this.centers[c].y})}}const jr={[Ct.LabStairs]:{x:-1670,y:1730,size:{x:80,y:80},text:"Press [UP] to go upstairs"},[Ct.InnStairs]:{x:2e3,y:-1205,size:{x:80,y:80},text:"Press [UP] to go upstairs"}};class rd extends E.GameObjects.Image{constructor(e,s,r){const{x:n,y:a}=jr[s];super(e,n,a,"");d(this,"player");d(this,"disabled",!1);d(this,"initialized",!1);this.name=`HelperText-${s}`,this.player=r}lazyInit(){if(this.initialized||!st(this,this.player))return;const{size:e}=jr[Ct.LabStairs];this.setDepth(V.Items),this.setDisplaySize(e.x,e.y),f.debug||this.setAlpha(0),this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0}),this.initialized=!0}getButtonPrompt(){return jr[Ct.LabStairs].text}onInteract(e){return Ae.None}update(){this.lazyInit()}}class nd extends E.GameObjects.Container{constructor(e,s){const{position:r,size:n}=s;super(e,r.x,r.y);d(this,"initialized",!1);d(this,"center");d(this,"player");d(this,"layers",[]);d(this,"info");this.name=`ParallaxBackground-${r.x}-${r.y}`,this.info=s,this.player=e.player,this.setDepth(V.Backgrounds),this.center=new E.Math.Vector2(r.x+.5*n.x,r.y+.5*n.y),f.debug&&this.add(e.add.rectangle(this.center.x,this.center.y,n.x,n.y).setStrokeStyle(10,26214).setOrigin(.5))}lazyInit(){if(this.initialized||!st(this.center,this.player,this.info.size.x))return;this.scene.add.existing(this),this.scene.physics.add.existing(this);const{position:e,size:s,scale:r,images:n,skipLighting:a}=this.info;n.forEach(({texture:o,scale:l,speed:h})=>{const c=this.scene.add.tileSprite(e.x,e.y,s.x,s.y,o);c.setOrigin(0).setTileScale((r||1)*(l||1)).setData("speed",h),a||c.setPipeline("Light2D"),c.setPostPipeline("XRayPipeline"),this.add(c),this.layers.push(c)}),f.debug&&this.setInteractive({draggable:!0,hitArea:new E.Geom.Rectangle(e.x,e.y,s.x,s.y),hitAreaCallback:E.Geom.Rectangle.Contains}),this.initialized=!0}update(){if(this.lazyInit(),!this.initialized||!this.getBounds().contains(this.player.x,this.player.y))return;const{size:e}=this.info,s=E.Math.Clamp(this.player.x-this.center.x,-.5*e.x,.5*e.x)/e.x;this.layers.forEach(r=>{r.tilePositionX=s*r.getData("speed")*e.x})}}const Hr={[qt.Library]:{x:1100,y:-470,text:"Library"},[qt.Inn]:{x:1350,y:450,text:"Inn"},[qt.Train]:{x:235,y:555,text:"Train"}};class ad extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a}=Hr[s];super(e,n,a,"props","paper");d(this,"player");d(this,"initialized",!1);d(this,"signType");d(this,"text");d(this,"light");this.name=`Sign-${s}`,this.player=r,this.signType=s,ti(this,{...Hr[s],depth:V.Player,origin:{x:.5,y:.5}}),this.setTint(13417386)}lazyInit(){if(this.initialized||!st(this,this.player))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0});const{x:e,y:s,text:r}=Hr[this.signType];this.text=this.scene.add.text(e,s,r.toUpperCase(),{fontFamily:"Germania One",fontStyle:"normal",fontSize:28,color:"#372737",stroke:"#8e6117",strokeThickness:6}).setOrigin(.5).setDepth(V.Player+1).setPipeline("Light2D");const n=5;this.setDisplaySize(this.text.displayWidth+n*5,this.text.displayHeight+n),this.initialized=!0;const a=!ll(this.scene),o=1;f.debug?(this.light=new tt(this.scene,this.x,this.y,300*(this.displayWidth/400),16764074,o),this.light.light.setVisible(a)):(this.light=this.scene.lights.addLight(this.x,this.y,300*(this.displayWidth/400),16764074,o),this.light.setVisible(a)),this.scene.lightData.push({light:this.light,intensity:o,random:Math.random()})}update(){var e,s;this.lazyInit(),(e=this.text)==null||e.setPosition(this.x,this.y),(s=this.light)==null||s.setPosition(this.x,this.y)}}class Fo extends E.Physics.Arcade.Image{constructor(e,s,r,n=100,a=100,o=!1,l=!1){super(e,s,r,"");d(this,"scene");d(this,"width");d(this,"height");d(this,"flipped");d(this,"graphics");d(this,"initialized",!1);d(this,"upwards");this.name=`Slope-${s}-${r}`,this.scene=e,this.width=n,this.height=a,this.flipped=o,this.upwards=l}lazyInit(){if(!(this.initialized||!st(this,this.scene.player))){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0).setDepth(V.Items).setVisible(f.debug).setSize(this.width,this.height*1.5),f.debug){this.setInteractive({draggable:!0});const e=this.scene.add.graphics().setDepth(V.Debug);this.graphics=e,e.lineStyle(2,65280,1);const s=this.width/2,r=new E.Math.Vector2(0,this.flipped?0:0+this.height),n=new E.Math.Vector2(0+this.width,this.flipped?0+this.height:0);e.lineBetween(r.x,r.y,n.x,n.y),e.lineBetween(r.x-s,r.y,r.x,r.y),e.lineBetween(n.x,n.y,n.x+s,n.y),e.strokeCircle(r.x,r.y,2),e.strokeCircle(n.x,n.y,2)}this.initialized=!0}}update(e,s){var o;if(this.lazyInit(),!this.initialized)return;(o=this.graphics)==null||o.setPosition(this.x,this.y);const r=this.scene.player,n=r.keys.keys,a=.75*tn;if(this.body&&this.scene.physics.world.intersects(this.body,r.body)){if(!r.active||n[A.Shift])return;let l=E.Math.Clamp(1-(this.x+this.width-r.x)/this.width,0,1);this.flipped&&(l=1-l);const h=this.y+this.height,c=(1-r.originY)*r.displayHeight,u=h-this.height*l-c;if(n[A.Right]&&r.setVelocityX(a),n[A.Left]&&r.setVelocityX(-a),l>.1&&l<.9&&r.shadow.setRotation(Math.atan2(this.height,this.width)*(this.flipped?1:-1)),this.upwards&&n[A.Up]&&Math.abs(r.y-u)<70){r.setVelocityX(this.flipped?-a:a),r.setY(u);return}if(this.upwards&&(n[A.Right]||n[A.Left]&&this.flipped)&&r.y<h-70){r.setY(u);return}if(this.upwards&&u<r.y)return;r.setY(u)}}}const od=6,ld=100;class hd extends E.Physics.Arcade.StaticGroup{constructor(e,s){super(e.physics.world,e);d(this,"player");d(this,"initialized",[]);this.player=s}createWall(e,s){var n;const r=this.scene.add.rectangle(e.x,e.y,od,ld).setOrigin(0).setVisible(f.debug);r.name=`Wall-${e.id||s}-${e.x}-${e.y}`,e.id!==void 0&&r.setData("WallType",e.id),f.debug&&r.setInteractive({draggable:!0}),this.add(r),this.initialized.push(s),(n=e.onCreate)==null||n.call(e,r)}update(){for(let e=0;e<rn.length;e++){if(this.initialized.includes(e))continue;const s=rn[e];E.Math.Distance.BetweenPointsSquared(s,this.player)<1e3**2&&this.createWall(s,e)}}}var Ie=(i=>(i[i.Ladder=0]="Ladder",i[i.Warp=1]="Warp",i[i.Invisible=2]="Invisible",i[i.WarpLocked=3]="WarpLocked",i[i.InvisibleLocked=4]="InvisibleLocked",i))(Ie||{});const Fe={[M.Town]:{x:280,y:650,key:A.Down,warpTo:M.Station,location:N.Station,visual:2,sound:"ladder"},[M.Station]:{x:365,y:1355,key:A.Left,direction:A.Up,warpTo:M.Town,location:N.Town,visual:2,sound:"ladder"},[M.TownEast]:{x:1720,y:650,key:A.Right,warpTo:M.Forest,location:N.Forest,visual:3},[M.Forest]:{x:2650,y:815,key:A.Left,warpTo:M.TownEast,location:N.Town,visual:1},[M.TownNorth]:{x:775,y:650,key:A.Up,warpTo:M.ClockSquare,location:N.ClockOutside,visual:3},[M.ClockSquare]:{x:560,y:-330,key:A.Down,warpTo:M.TownNorth,location:N.Town,visual:1},[M.ClockSquareNorth]:{x:930,y:-330,key:A.Up,warpTo:M.ClockEntrance,location:N.ClockInner,visual:3},[M.ClockEntrance]:{x:690,y:-1320,range:15,key:A.Left,direction:A.Down,warpTo:M.ClockSquareNorth,location:N.ClockOutside,visual:1,skipLighting:!0},[M.ClockStairs]:{x:910,y:-1418,range:20,key:A.Right,direction:A.Up,warpTo:M.ClockTop,location:N.ClockInner,name:"Clock Tower (Upstairs)",visual:2,sound:"ladder"},[M.ClockTop]:{x:780,y:-1980,range:10,key:A.Left,direction:A.Down,warpTo:M.ClockStairs,location:N.ClockInner,name:"Clock Tower (Downstairs)",visual:2,sound:"ladder"},[M.ForestEast]:{x:3570,y:815,key:A.Right,warpTo:M.Lake,location:N.Lake,visual:3,onCreate:i=>i.updateLocked(!i.scene.player.gameState.data.sphinxMoved)},[M.Lake]:{x:4510,y:915,key:A.Left,warpTo:M.ForestEast,location:N.Forest,visual:1},[M.TownWest]:{x:90,y:650,key:A.Left,warpTo:M.MansionGrounds,location:N.MansionOutside,visual:3},[M.MansionGrounds]:{x:-620,y:640,key:A.Right,warpTo:M.TownWest,location:N.Town,visual:1},[M.MansionEntrance]:{x:-1290,y:640,key:A.Up,warpTo:M.Mansion,location:N.MansionInside,visual:2},[M.Mansion]:{x:-1405,y:-420,key:A.Down,warpTo:M.MansionEntrance,location:N.MansionOutside,visual:2},[M.LabHatch]:{x:-1920,y:640,key:A.Down,warpTo:M.Lab,location:N.AlchemyLab,visual:4},[M.Lab]:{x:-1380,y:1545,key:A.Right,direction:A.Up,warpTo:M.LabHatch,location:N.MansionOutside,visual:2,range:15,skipLighting:!0},[M.LibraryEntrance]:{x:1130,y:-330,key:A.Up,warpTo:M.Library,location:N.Library,visual:2},[M.Library]:{x:1680,y:-290,key:A.Down,warpTo:M.LibraryEntrance,location:N.ClockOutside,visual:2},[M.TownHallEntrance]:{x:2990,y:-290,key:A.Down,warpTo:M.TownHall,location:N.TownHall,visual:2},[M.TownHall]:{x:3560,y:-250,key:A.Down,warpTo:M.TownHallEntrance,location:N.Library,visual:2},[M.InnEntrance]:{x:1300,y:650,key:A.Up,warpTo:M.Inn,location:N.Inn,visual:2},[M.Inn]:{x:2555,y:-1180,key:A.Down,warpTo:M.InnEntrance,location:N.Town,visual:2}},No=30,ud=12,gi=[];Object.values(zt).forEach(i=>{i.warpAdd&&gi.push(i.warpAdd),i.warpComplete&&gi.push(i.warpComplete)});Object.values(bn).forEach(i=>{i.warpAdd&&gi.push(i.warpAdd)});class Wi extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a,visual:o,range:l}=Fe[s];super(e,n,a,"props","warp");d(this,"warpType");d(this,"player");d(this,"locked");d(this,"graphics");d(this,"light");d(this,"portal1");d(this,"portal2");d(this,"range");d(this,"initialized",!1);this.name=`Warp-${s}`,this.warpType=s,this.player=r,this.range=l||No,this.setScale(.6).setDepth(V.Warpers),(o===Ie.Warp||o===Ie.WarpLocked)&&(this.setScale(.6,1),this.setPosition(n,a-ud)),f.debug||(this.updateLocked(o===Ie.WarpLocked||o===Ie.InvisibleLocked),(o===Ie.Invisible||o===Ie.InvisibleLocked)&&this.setAlpha(0)),ti(this,Fe[s]),gi.includes(s)&&e.add.existing(this)}lazyInit(){if(this.initialized||!st(this,this.player))return;gi.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createAnimations(),this.createDebug();const{onCreate:e,visual:s}=Fe[this.warpType];(s===Ie.Warp||s===Ie.WarpLocked)&&(this.light=this.scene.lights.addPointLight(this.x,this.y,5132207,125,0)),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/No*4),this.body.height),this.updateLocked(),e&&e(this),this.initialized=!0}createAnimations(){const{visual:e,skipLighting:s}=Fe[this.warpType];(e===Ie.Warp||e===Ie.WarpLocked)&&(this.setAlpha(.1),this.scene.anims.exists("portal")||this.scene.anims.create({key:"portal",frames:this.scene.anims.generateFrameNumbers("portal",{start:0,end:63}),frameRate:10,repeat:-1,randomFrame:!0}),this.portal1=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.45,1).setAlpha(.9).setName(`${this.name}-1`).play("portal"),this.portal1.postFX.addPixelate(1),this.portal1.postFX.addShadow(0,0,.1,2,3355562,3,.5),this.portal2=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.35,1).setAlpha(.65).setFlipX(!0).setName(`${this.name}-2`).play("portal"),this.portal2.postFX.addPixelate(1),this.portal2.setFrame(Math.floor(Math.random()*30)),s||(this.portal1.setPipeline("Light2D"),this.portal2.setPipeline("Light2D")),this.portal1.setPostPipeline("XRayPipeline"),this.portal2.setPostPipeline("XRayPipeline"))}createDebug(){if(f.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const e=this.body;this.graphics.lineBetween(-this.range,-e.halfHeight,-this.range,e.halfHeight),this.graphics.lineBetween(this.range,-e.halfHeight,this.range,e.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:e,key:s}=Fe[this.warpType];return(e===Ie.Warp||e===Ie.WarpLocked||e===Ie.Invisible)&&(s===A.Left||s===A.Right)}onInteract(e){const s=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,r=Fe[this.warpType].key,n=e[r]&&s;if(n&&this.warpType===M.TownEast&&!this.player.gameState.data.mazeSolved&&!f.debug)return qe(this.scene,"MazeDialog"),Ae.None;if(n){const a=Fe[this.warpType];return Tn(this.warpType,a.warpTo,this.player,{x:0,y:-12}),Ae.Teleported}return Ae.None}getButtonPrompt(){const{key:e,location:s,name:r}=Fe[this.warpType];let n;e===A.Up&&(n="[Up]"),e===A.Down&&(n="[Down]"),e===A.Left&&(n="[Left]"),e===A.Right&&(n="[Right]");let a=r||s;return a=mn(a),[`Travel to ${a}`,"Press "+n]}setPosition(e,s,r,n){var a,o,l;return super.setPosition(e,s,r,n),(a=this.portal1)==null||a.setPosition(e,s),(o=this.portal2)==null||o.setPosition(e,s),(l=this.graphics)==null||l.setPosition(e,s),this}setVisible(e){var s,r,n;return super.setVisible(e),(s=this.portal1)==null||s.setVisible(e),(r=this.portal2)==null||r.setVisible(e),(n=this.light)==null||n.setVisible(e),this}updateLocked(e){e!==void 0&&(this.locked=e),this.setVisible(!this.locked)}update(e,s){this.lazyInit(),this.initialized&&this.light&&pi(this,this.player,f.width/1.8)&&(this.light.setPosition(this.x,this.y),this.light.intensity=E.Math.Clamp(this.light.intensity+Math.random()*.025-.0125,.1,.2))}destroy(e){var s,r;(s=this.portal1)==null||s.destroy(e),(r=this.portal2)==null||r.destroy(e),super.destroy(e)}}const cd={[A.Up]:{x:0,y:-1},[A.Down]:{x:0,y:1},[A.Left]:{x:-1,y:0},[A.Right]:{x:1,y:0}};function Tn(i,t,e,s,r){const{direction:n,key:a,sound:o,visual:l,location:h}=Fe[i];let{x:c,y:u}=Fe[t],p=!0;if(yi(e.scene)&&(i===M.TownEast||i===M.TownWest||i===M.Town)&&(p=!1),(!f.prod&&r||f.debug)&&(p=!0),!p){e.message.setDialog({messages:["It is too late to leave town now.","I should rest at the inn until tomorrow."]},e);return}const g=cd[n!==void 0?n:a],v=e.scene,y=v.cameras.main;s&&(c+=s.x,u+=s.y);const m=c-v.cameras.main.width/2,w=u-v.cameras.main.height/2-f.cameraOffset;let k="warp";(l===Ie.Invisible||l===Ie.InvisibleLocked)&&(k="door"),o&&(k=o),y.stopFollow(),y.removeBounds(),e.unlockCamera=!0,e.setActive(!1);const x=me.getLocationMusic(h);x&&me.start(x),v.add.timeline([{at:0,run:()=>{Ye(v,200),v.sound.playAudioSprite("sfx",k)},tween:{delay:0,targets:y,scrollX:y.scrollX+g.x*75,scrollY:y.scrollY+g.y*75,duration:200}},{at:0,tween:{targets:e,alpha:0,duration:200}},{at:450,run:()=>{e.unlockCamera=!1,e.setPosition(c,u),e.previousPosition.set(c,u),y.scrollX=m,y.scrollY=w}},{at:600,tween:{targets:e,alpha:1,duration:200},run:()=>Mt(v,400,()=>{y.startFollow(e,!0),y.setFollowOffset(0,f.cameraOffset),e.setActive(!0)})}]).play()}const oi=.8,$o=.45,Mi=.1;class ts extends E.GameObjects.Container{constructor(e,s){super(e,100,f.height-100);d(this,"buttons",[]);d(this,"lastXAxisKey");d(this,"lastYAxisKey");d(this,"minimal");this.minimal=s,this.setScrollFactor(0).setDepth(V.Overlay),e.add.group(this,{runChildUpdate:!0}),e.add.existing(this),this.createControllerListeners()}createUI(){this.createDPad(),this.minimal||this.createButtons()}setVisible(e){return super.setVisible(e),e&&this.buttons.length===0&&this.createUI(),this}update(e,s){var o,l,h,c,u,p,g,v,y,m,w;const r=(o=this.scene.input.gamepad)==null?void 0:o.pad1;if(!r)return;const n=r.axes[0].getValue(),a=r.axes[1].getValue();if(Math.abs(n)<=Mi&&this.lastXAxisKey){(l=this.scene.input.keyboard)==null||l.emit("keyup-"+this.lastXAxisKey),this.lastXAxisKey=void 0;return}if(n>Mi){if(this.lastXAxisKey==="RIGHT")return;this.lastXAxisKey==="LEFT"&&((h=this.scene.input.keyboard)==null||h.emit("keyup-LEFT")),(c=this.scene.input.keyboard)==null||c.emit("keydown-RIGHT"),this.lastXAxisKey="RIGHT"}if(n<-.1){if(this.lastXAxisKey==="LEFT")return;this.lastXAxisKey==="RIGHT"&&((u=this.scene.input.keyboard)==null||u.emit("keyup-RIGHT")),(p=this.scene.input.keyboard)==null||p.emit("keydown-LEFT"),this.lastXAxisKey="LEFT"}if(Math.abs(a)<=Mi&&this.lastYAxisKey){(g=this.scene.input.keyboard)==null||g.emit("keyup-"+this.lastYAxisKey),this.lastYAxisKey=void 0;return}if(a>Mi){if(this.lastYAxisKey==="DOWN")return;this.lastYAxisKey==="UP"&&((v=this.scene.input.keyboard)==null||v.emit("keyup-UP")),(y=this.scene.input.keyboard)==null||y.emit("keydown-DOWN"),this.lastYAxisKey="DOWN"}if(a<-.1){if(this.lastYAxisKey==="UP")return;this.lastYAxisKey==="DOWN"&&((m=this.scene.input.keyboard)==null||m.emit("keyup-DOWN")),(w=this.scene.input.keyboard)==null||w.emit("keydown-UP"),this.lastYAxisKey="UP"}}createDPad(){const e=this.scene.add.container(10,-10);this.add(e);const s=this.scene.add.circle(0,0,60,L(_.Slate),$o).setStrokeStyle(3,L(_.Black));e.add(s),this.button(-57,0,"LEFT",e),this.button(57,0,"RIGHT",e),this.button(0,-57,"UP",e),this.button(0,57,"DOWN",e)}createButtons(){const e=this.scene.add.container(f.width-300,0);this.add(e);const s=this.scene.add.circle(40,0,65,L(_.Slate),$o).setStrokeStyle(3,L(_.Black)).setScale(1,.6).setAngle(-30);e.add(s),this.button(80,-20,"ENTER",e),this.button(0,20,"BACKSPACE",e)}createControllerListeners(){var e,s,r,n;(e=this.scene.input.gamepad)==null||e.on("connected",a=>{new Ne(this.scene,"Gamepad connected")}),(s=this.scene.input.gamepad)==null||s.on("disconnected",a=>{new Ne(this.scene,"Gamepad disconnected")}),(r=this.scene.input.gamepad)==null||r.on("down",(a,o)=>{var h;const l=this.getKeyFromButton(o);l&&((h=this.scene.input.keyboard)==null||h.emit(`keydown-${l}`))}),(n=this.scene.input.gamepad)==null||n.on("up",(a,o)=>{var h;const l=this.getKeyFromButton(o);l&&((h=this.scene.input.keyboard)==null||h.emit(`keyup-${l}`))})}getKeyFromButton(e){const s=e.pad.id.toLowerCase().includes("nintendo");let r;switch(e.index){case 0:s?r="BACKSPACE":r="ENTER";break;case 1:s?r="ENTER":r="BACKSPACE";break;case 2:s?r="SHIFT":r="BACK_SLASH";break;case 3:s?r="BACK_SLASH":r="SHIFT";break;case 8:r="J";break;case 9:r="ESC";break;case 12:r="UP";break;case 13:r="DOWN";break;case 14:r="LEFT";break;case 15:r="RIGHT";break}return r}button(e,s,r,n){const a=r==="ENTER"||r==="ESCAPE"?35:38,o=this.scene.add.circle(e,s,a,L(_.White),oi).setStrokeStyle(3,L(_.Black));o.setInteractive({useHandCursor:!0}).setScrollFactor(0),n.add(o),o.on("pointerdown",()=>{var l;(l=this.scene.input.keyboard)==null||l.emit(`keydown-${r}`),o.setFillStyle(L(_.Slate),Math.min(1,oi+.25))}),o.on("pointerup",()=>{var l;(l=this.scene.input.keyboard)==null||l.emit(`keyup-${r}`),o.setFillStyle(L(_.White),oi)}),o.on("pointerout",()=>{var l;(l=this.scene.input.keyboard)==null||l.emit(`keyup-${r}`),o.setFillStyle(L(_.White),oi)}),this.buttons.push(o)}resetButtons(){this.buttons.forEach(e=>e.setFillStyle(L(_.White),oi))}}class Xe extends E.GameObjects.Container{constructor(e,s,r,n,a){super(e,s,r);d(this,"onClick");d(this,"img");d(this,"rect");d(this,"selected");e.add.existing(this),this.setScrollFactor(0).setDepth(V.Ui),this.rect=e.add.rectangle(0,0,42,42,L(_.Slate)).setScrollFactor(0).setStrokeStyle(2,L(_.Black)),this.img=e.add.image(-1,1,"icons",n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.onClick=()=>{e.sound.playAudioSprite("sfx","button"),a()},this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.onClick()),this.selected=!1,this.rect.on("pointerover",()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)}),this.rect.on("pointerout",()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)})}setTint(e){this.img.setTint(e)}setSelected(e){this.selected=e,this.setTint(e?L(_.ButtonActive):16777215)}setIcon(e){this.img.setTexture("icons",e).setDisplaySize(32,32)}}var Pn=(i=>(i.Horizontal="H",i.Vertical="V",i.Corner="C",i.T="T",i.Cross="X",i.Empty=" ",i))(Pn||{});const ql={H:[[0,0,0],[1,1,1],[0,0,0]],V:[[0,1,0],[0,1,0],[0,1,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},Ur=[[" "," "," ","V"," "," ","V"," "," ","V"," "," "," ","V"," "," "],[" "," ","C","C"," "," ","V"," "," ","V"," "," ","C","T","H","H"],["H","H","X","T","T","T","T","T","T","C"," "," ","V"," "," "," "],[" "," ","V","C","X","C"," ","C","X","H","T","H","X","H","C"," "],[" "," ","C","T","X","H","C"," ","V"," ","V"," ","V"," ","T","H"],["H","T","H","T","V"," ","T","H","X","H","T","H","T"," ","V"," "],[" ","V"," ","C","X","H","C"," ","T","C"," "," ","C","C","C","H"],[" ","V"," "," ","V"," "," "," ","V","V"," "," "," ","V"," "," "]].map(i=>i.map(t=>t)),Wo={x:0,y:2};function dd(i,t,e){const s=[],r=new Set,n=i.length,a=i[0].length;function o(l,h){const c=`${l},${h}`;r.add(c),s.push(i[h][l]),l+1<a&&!r.has(`${l+1},${h}`)&&_i(i[h][l],i[h][l+1])&&o(l+1,h),l-1>=0&&!r.has(`${l-1},${h}`)&&_i(i[h][l],i[h][l-1])&&o(l-1,h),h+1<n&&!r.has(`${l},${h+1}`)&&_i(i[h][l],i[h+1][l])&&o(l,h+1),h-1>=0&&!r.has(`${l},${h-1}`)&&_i(i[h][l],i[h-1][l])&&o(l,h-1)}return o(t,e),s}function _i(i,t){if(!i||!t)return!1;const e=zo(i),s=zo(t),r=t.x-i.x,n=t.y-i.y;return r===1&&n===0?e.right&&s.left:r===-1&&n===0?e.left&&s.right:r===0&&n===1?e.bottom&&s.top:r===0&&n===-1?e.top&&s.bottom:!1}function zo(i){const t=fd(i);return{left:t.some(e=>e[0]===1),right:t.some(e=>e[e.length-1]===1),top:t[0].some(e=>e===1),bottom:t[t.length-1].some(e=>e===1)}}function fd(i){let t=ql[i.type];const e=Math.floor(i.rotation/90);for(let s=0;s<e;s++)t=pd(t);return t}function pd(i){return i[0].map((t,e)=>i.map(s=>s[e]).reverse())}const Go=Object.keys(I).map(i=>I[i]).filter(i=>typeof i=="number"),jo=Object.keys(D).map(i=>D[i]).filter(i=>typeof i=="number"),gd=Object.keys(le).map(i=>le[i]).filter(i=>typeof i=="number"),yd=Object.keys(G).map(i=>G[i]).filter(i=>typeof i=="number"),Ho=Object.keys(B).map(i=>B[i]).filter(i=>typeof i=="number"),Vl=Object.keys(M).map(i=>M[i]).filter(i=>typeof i=="number"),md=Object.values(N),vd=Object.keys(Ct).map(i=>Ct[i]).filter(i=>typeof i=="number"),bd=Object.values(Pn).filter(i=>typeof i!="number"),Uo=["MainMenu","MazeDialog","PipesDialog","TumblerDialog","MemoryDialog","SliderDialog","Books"],wd=Object.keys(qt).map(i=>qt[i]).filter(i=>typeof i=="number"),Sd=[{x:45,y:0,image:"town",location:N.Town,scale:2},{x:500,y:-1100,image:"clock_outside",location:N.ClockOutside,scale:2},{x:500,y:-2400,image:"clock_inner",location:N.ClockInner,scale:2,skipLighting:!0},{x:2300,y:0,image:"forest",location:N.Forest,scale:2},{x:4400,y:100,image:"lake",location:N.Lake,scale:2},{x:-2200,y:-170,image:"mansion_outside",location:N.MansionOutside,scale:2},{x:-2e3,y:-1320,image:"mansion_inside",location:N.MansionInside,scale:2},{x:-3200,y:1300,image:"alchemy_lab",location:N.AlchemyLab,scale:1.8,skipLighting:!0},{x:1490,y:-860,image:"library",location:N.Library,scale:2,skipLighting:!0},{x:1600,y:-1850,image:"inn",location:N.Inn,scale:2,skipLighting:!0},{x:320,y:1050,image:"station",location:N.Station,scale:3},{x:3450,y:-940,image:"town_hall",location:N.TownHall,scale:2,skipLighting:!0}],xd=[{x:135,y:462,radius:150,color:L(_.Tan),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:897,y:240,intensity:1.5},{x:1561,y:460},{x:791,y:472,intensity:.75},{x:962,y:469,intensity:.75},{x:560,y:1353,radius:70,intensity:.75},{x:658,y:1353,radius:70,intensity:.75},{x:763,y:1353,radius:70,intensity:.75},{x:842,y:1353,radius:70,intensity:.75},{x:939,y:1353,radius:70,intensity:.75},{x:1049,y:1353,radius:70,intensity:.75},{x:1148,y:1353,radius:70,intensity:.75},{x:639,y:1174,radius:90},{x:750,y:1174,radius:90},{x:856,y:1174,radius:90},{x:958,y:1174,radius:90},{x:1066,y:1174,radius:90}],kd=[],Ed=[{x:420,y:1390,width:180,height:160,flip:!0},{x:740,y:-1380,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5077,y:953,width:100,height:60,flip:!0},{x:-1300,y:-415,width:90,height:35},{x:-1710,y:1577,width:280,height:190,upwards:!0},{x:-1020,y:1697,width:200,height:70},{x:-2570,y:1728,width:200,height:40,flip:!0},{x:1960,y:-1492,width:420,height:350,upwards:!0}],Od=()=>{const i=document.createElement("div");i.id="stats",i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";const t=localStorage.getItem("chrono-sleuth-stats")!=="false";i.classList.toggle("hidden",!t);const e=document.createElement("img");e.src="bar-chart-2.svg",e.width=24,e.height=24;const s=document.createElement("button");s.style.cssText="background-color:transparent;border:none;padding:0;bottom:8px;right:8px;position:fixed;cursor:pointer",s.appendChild(e),s.onclick=()=>{const o=!i.classList.contains("hidden");i.classList.toggle("hidden",o),localStorage.setItem("chrono-sleuth-stats",(!o).toString())},i.appendChild(s);const r=document.createElement("div");r.style.cssText="position:fixed;top:6px;left:6px;color:white;font-family:Helvetica,Arial,sans-serif;text-shadow:1px 1px 1px black",i.appendChild(r);const n=[];function a(o){return i.appendChild(o.dom),n.push(o),o}return{REVISION:17,dom:i,fps:r,panels:n,addPanel:a}},Gt=(i,t,e)=>{var s=1/0,r=0,n=Math.round;const a=1.25,o=n(window.devicePixelRatio||1)*a,l=100*o,h=65*o,c=3*o,u=2*o,p=3*o,g=23*o,v=Math.floor(l-p*2),y=h-g-2*o,m=document.createElement("canvas");m.width=l,m.height=h;const w=m.getContext("2d");w.font="bold "+9*o+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=e,w.fillRect(0,0,l,h),w.fillStyle=t,w.fillText(i,c,u),w.fillRect(p,g,v,y),w.fillStyle=e,w.globalAlpha=.9,w.fillRect(p,g,v,y);let k=0,x=0,T=new Array(Math.floor(v/o)).fill(0);return{dom:m,update:function(C){if(!(performance.now()-k<100)){T[x]=C,x=(x+1)%T.length,s=Math.min(...T),r=Math.max(...T),w.fillStyle=e,w.globalAlpha=1,w.fillRect(0,0,l,g),w.fillStyle=t,w.fillText(`${i}: ${C.toFixed(1)}`,c,u),w.fillText(`[${s.toFixed(1)} - ${r.toFixed(1)}]`,c,u+10*o),w.fillRect(p,g,v,y),w.fillStyle=e,w.globalAlpha=.8;for(let F=0;F<T.length;F++){const K=(x+F)%T.length,$=T[K]/r;w.fillRect(p+o*F,g,o+(2-a),Math.min(y-o,Math.max(o,n((1-$)*y))))}k=performance.now()}}}};let Ue;function Id(i){Ue=Od(),document.body.appendChild(Ue.dom);const t=Ue.dom.style;t.display="flex",t.justifyContent="center",t.flexWrap="wrap",t.gap="6px",t.cursor="",t.right="0",t.top="",t.bottom="10px",t.opacity="0.7";const e=Ue.addPanel(Gt("FPS","#9ad8e4","#064b62")),s=Ue.addPanel(Gt("Frame Time","#f3b0c3","#6b1e3d")),r=Ue.addPanel(Gt("Memory (mb)","#ffd59a","#6b3e06")),n=Ue.addPanel(Gt("Render","#e9f3a3","#4c6b1a")),a=Ue.addPanel(Gt("Step","#c3c3f3","#1d1d6b"));let o=0,l=0;i.events.on(Phaser.Core.Events.PRE_STEP,()=>o=performance.now()),i.events.on(Phaser.Core.Events.POST_STEP,()=>a.update(performance.now()-o)),i.events.on(Phaser.Core.Events.PRE_RENDER,()=>l=performance.now()),i.events.on(Phaser.Core.Events.POST_RENDER,()=>{const h=i.loop.deltaHistory.slice(0,10).reduce((c,u)=>c+u,0)/10;n.update(performance.now()-l),e.update(1e3/h),s.update(performance.now()-o),Ue.fps.textContent=`${Math.floor(1e3/h)}`,performance.memory&&r.update(performance.memory.usedJSHeapSize/1048576)})}class Xl extends E.Scene{constructor(){super("Game");d(this,"player");d(this,"interactiveObjects");d(this,"clock");d(this,"gamepad");d(this,"saveIcon");d(this,"lightData",[]);d(this,"postUpdated",[]);d(this,"cullingStats");d(this,"shouldInit",!0);d(this,"cameraPadding",150);d(this,"cameraBounds",new E.Geom.Rectangle(0,0,f.width+this.cameraPadding*2,f.height+this.cameraPadding*2));d(this,"objectBounds",new E.Geom.Rectangle(0,0,0,0))}init(){const e=Nd(this);this.shouldInit=!e}create(){if(!this.shouldInit)return;me.setScene(this);const e=performance.now();Ye(this,0),this.time.delayedCall(f.bootDialog?0:250,()=>Mt(this,f.bootDialog?150:500)),this.player=new kn(this),this.postUpdated.push(this.player);const s=this.createBackgrounds(),r=this.createParallaxBackgrounds(),n=new hd(this,this.player),a=this.createSlopes(),o=this.createHelperText(),l=this.createSigns(),h=this.createWarpers(),c=this.createNpcs(),u=this.createItems(),p=this.createProps(),g=new vn(this,this.player,!0),v=new Bo(this,Ri.Forest[0],Ri.Forest[1]),y=new Bo(this,Ri.Lake[0],Ri.Lake[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...h,...c,...u,...p,...o],{runChildUpdate:!0});const m=this.add.group([this.player,v,y,g,n,...a,...l,...s,...r],{runChildUpdate:!0});this.clock&&m.add(this.clock),this.physics.add.collider(this.player,n),this.createEventListeners();const w=this.cameras.main;if(w.startFollow(this.player,!0),w.setFollowOffset(0,f.cameraOffset),nn(this),!f.prod){const x=performance.now()-e,T=`Game.create() took ${x.toFixed(1)}ms to initialize`;f.debug&&x>300?new Ne(this,T,void 0,_.Warning):!f.debug&&x>150&&new Ne(this,T,void 0,_.Warning),window.bootTime>-1&&(console.log("Total game boot time",Date.now()-window.bootTime),window.bootTime=-1)}}update(e){if(this.player&&(this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,(r,n)=>{const a=r;let o=!0;return a.disabled&&(o=!1),a.visible!==void 0&&(o=o&&a.visible),o},this.player)||this.player.setInteractiveObject(void 0)),yi(this))for(let s of this.lightData)Math.random()>.98&&s.light.setIntensity(s.intensity*(.9+Math.random()*.1));this.frustumCull()}frustumCull(){var r,n,a;const e=performance.now();this.cameraBounds.x=this.cameras.main.scrollX-this.cameraPadding,this.cameraBounds.y=this.cameras.main.scrollY-this.cameraPadding;const s=this.children.getAll();for(let o of s)if(o instanceof E.GameObjects.Image||o instanceof E.GameObjects.Sprite||o instanceof E.GameObjects.Particles.ParticleEmitter||o instanceof E.GameObjects.Graphics){if(o.depth!==V.Debug&&(o instanceof Fo||!(o instanceof Wi)&&((r=o.name)!=null&&r.startsWith("Warp"))||o.depth>=V.Ui||((n=o.name)==null?void 0:n.length)===0))continue;this.objectBounds.setTo(o.x,o.y,o.displayWidth||o.width||1,o.displayHeight||o.height||1),E.Geom.Intersects.RectangleToRectangle(this.cameraBounds,this.objectBounds)?o instanceof Wi?o.updateLocked():o.setVisible(!0):o.setVisible(!1)}Ue&&!this.cullingStats&&(this.cullingStats=Ue.addPanel(Gt("Culling","#9ad8e4","#064b62"))),(a=this.cullingStats)==null||a.update(performance.now()-e)}createBackgrounds(){return Sd.map(e=>new sd(this,e,this.player))}createParallaxBackgrounds(){return kd.map(e=>new nd(this,e))}createWarpers(){return Vl.map(e=>new Wi(this,e,this.player))}createNpcs(){return gd.map(e=>new $i(this,e,this.player))}createItems(){return[].map(e=>new Jt(this,e,this.player))}createSlopes(){return Ed.map(e=>new Fo(this,e.x,e.y,e.width,e.height,e.flip,e.upwards))}createProps(){return yd.map(e=>new Vi(this,e,this.player))}createHelperText(){return vd.map(e=>new rd(this,e,this.player))}createSigns(){return wd.map(e=>new ad(this,e,this.player))}createUI(){this.time.delayedCall(50,()=>{let e=30;new Xe(this,e,30,"settings",()=>{this.player.message.visible||(this.scene.pause(),this.scene.launch("Paused",{game:this}))}),f.prod||new Xe(this,e+=50,30,"terminal",()=>{qe(this,"DebugTool")}),this.saveIcon=this.add.image(30,f.height-30,"icons","save").setScale(.4).setDepth(V.Ui).setScrollFactor(0).setAlpha(0),this.saveIcon.postFX.addGlow(0,2)}),this.gamepad=new ts(this),f.prod||(this.time.delayedCall(500,()=>{const e=new id(this,this.player);this.add.group(e,{runChildUpdate:!0})}),f.bootDialog&&this.time.delayedCall(150,()=>qe(this,f.bootDialog)))}createLights(){this.lights.enable().setAmbientColor(L(_.White)),xd.forEach(e=>{const s=e.intensity||1;f.debug?this.lightData.push({light:new tt(this,e.x,e.y,e.radius||100,e.color||L(_.Lights),s),random:Math.random(),intensity:s}):this.lightData.push({light:this.lights.addLight(e.x,e.y,e.radius||100,e.color||L(_.Lights),s),random:Math.random(),intensity:s})}),hl(this,!1)}createEventListeners(){var e;(e=this.input.keyboard)==null||e.on("keydown-ESC",()=>{this.player.message.visible||(this.scene.pause(),this.scene.launch("Paused",{game:this}))}),this.events.on("resume",()=>{this.player.keys.resetKeys()}),this.events.on("postupdate",()=>{this.postUpdated.forEach(s=>s.postUpdate())})}}const is=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[le.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[le.Stranger]:["The sphinx’s riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","essay","dream","photograph","landscape"],hints:{[le.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[le.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[le.Inventor]:["The sphinx’s riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[le.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, don’t they?","They move, disappear, and seem to fly without wings."]}}];function ss(i){if(i instanceof Xl){const t=i.player;if(rs(t,B.FindPotionIngredients))return 1}return 0}const Td=()=>({messages:i=>Pd(i.scene),options:i=>Cd(i.scene),onSelected:Rd});function Pd(i){const t=ss(i);return[is[t].question]}function Cd(i){const t=ss(i),s=[...is[t].options].sort(()=>Math.random()-.5);return s.push("I don’t know"),s}function Ad(i){const t=ss(i);return is[t].answer}function qo(i,t){const e=ss(i);return is[e].hints[t]}function Rd(i,t,e){const s=Ad(t.scene);i===s?t.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:r=>{r.quests.updateExistingQuest(B.SphinxRiddle,!0),r.gameState.updateData({sphinxMoved:!0,sphinxFail:!1})}},e):i==="I don’t know"?t.message.setDialog({messages:["Come back when you have an answer for me."]},e):t.message.setDialog({messages:["That is not correct. You will not remember how to get back to me."],onCompleted:r=>{r.gameState.updateData({mazeSolved:!1,mazeSeed:r.gameState.data.mazeSeed+1,sphinxFail:!0});const n={value:0};r.active=!1,r.scene.add.timeline([{at:0,tween:{targets:n,value:{from:1,to:15},duration:1e3,onUpdate:a=>Xi(a.getValue())}},{at:500,run:()=>{Ye(r.scene,300),me.stop()},sound:"sphinx_warp"},{at:3500,run:()=>{Xi(1);const{x:a,y:o}=Ze[G.Bed];r.setPosition(a,o),r.previousPosition.set(r.x+1,r.y),Zi(r),Mt(r.scene,2e3)}},{at:6500,run:()=>{r.active=!0,r.message.setDialog({messages:["I just had the oddest dream.","I suppose I should continue investigating the town..."]},r)}}]).play()}},e)}const Md={[le.Inventor]:[{messages:["There is still one more gear missing.","Something tells me there is a great evil near the lake."],conditions:{journalEntry:D.ClockSecondGear}},{messages:["Ah, the second gear. You should take it to the clock tower."],conditions:{hasItem:I.Gear2}},{messages:["You found a secret safe in the mansion?","Very interesting. There may be a hint about opening it nearby."],conditions:{journalEntry:D.SafeDiscovered}},{messages:["<color=blue>Blue Plumed Frond</color>? I have not heard of such a plant.","The stranger may know. Many secrets lie under this town."],conditions:{activeQuest:B.FindPotionIngredients}},{messages:["There are rumors of an abandoned mansion west of the town.","Some say it is haunted and dark magic lurks within."],conditions:{activeQuest:B.InvestigateTownWest}},{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:I.Gear1},onCompleted:i=>{i.quests.updateExistingQuest(B.ForestGear,!0)}},{messages:i=>qo(i.scene,le.Inventor),conditions:{activeQuest:B.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:I.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench you can borrow, but you’ll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:i=>{i.journal.addEntry(D.FixTheClock),i.inventory.addItem({type:I.Wrench,used:!1})}}],[le.Stranger]:[{messages:["I am worried about the secrets hidden near the lake.","Long ago I saw a great evil lurking there."],conditions:{journalEntry:D.ClockSecondGear}},{messages:["Another gear? The mayor probably wants that put back in the clock tower."],conditions:{hasItem:I.Gear2}},{messages:["The lock on that safe is no ordinary lock. It requires something special to open it."],conditions:{journalEntry:D.SafeDiscovered,hasUnusedItem:I.Potion}},{messages:["Hmm a potion, I wonder what it does.","The alchemist was no ordinary person and built magical safeguards against intruders."],conditions:{hasUnusedItem:I.Potion}},{messages:["<color=green>Green Writhewood</color>? Hm, there might be some near the forest or lake."],conditions:{activeQuest:B.FindPotionIngredients}},{messages:["You heard of the mansion to the west? It was abandoned many years ago.","There is a rumor of an alchemy lab hidden somewhere nearby, but I have been searching for years and have found not even a single potion."],conditions:{activeQuest:B.InvestigateTownWest}},{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:I.Gear1}},{messages:i=>qo(i.scene,le.Stranger),conditions:{activeQuest:B.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:I.Wrench},onCompleted:i=>{i.quests.addQuest({id:B.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[le.Sphinx]:[{messages:i=>i.gameState.data.sphinxFail?["You have returned. I am surprised you were able to find your way back.","Try again."]:rs(i,B.FindPotionIngredients)?["I see you are back again. You may find what you are looking for ahead, but must first answer my riddle."]:["Ponder this riddle. Answer wisely."],conditions:{activeQuest:B.SphinxRiddle,completedQuest:B.SphinxRiddle,or:!0},onCompleted:(i,t)=>{i.scene.time.delayedCall(50,()=>{i.message.setDialog(Td(),t)})}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:i=>{i.quests.addQuest({id:B.SphinxRiddle,completed:!1})}}],[le.Mayor]:[{messages:["The clock is still missing a gear. It must be somewhere nearby.","I’ve been hearing strange reports from the townsfolk. It’s as if time is slipping. Have you felt it?"],conditions:{journalEntry:D.ClockSecondGear}},{messages:["The second gear has been found? That’s incredible news!"],conditions:{completedQuest:B.InvestigateTownWest}},{messages:["Herbs? I haven’t the faintest idea where to being looking. Start at the source - there are bound to be a few ingredients in the lab you found."],conditions:{activeQuest:B.FindPotionIngredients}},{messages:["The minute hand on the clock is spinning again.","It looks like it’s missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:D.ClockFirstGear},onCompleted:i=>{i.quests.addQuest({id:B.InvestigateTownWest,completed:!1})}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:D.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:i=>{i.journal.addEntry(D.MetTheMayor)}}],[le.Innkeeper]:[{messages:["Welcome to our humble inn. I hope you find peace here.","We can set you up with a room if you need it."]}],[le.Baker]:[{messages:["I see you found my favorite spot to get away from the bustle of our little town. Getting lost in a far away land is one of my favorite pastimes.","I come here most afternoons after early mornings of baking."],conditions:{custom:i=>i.gameState.data.day===2}},{messages:["Welcome to town! I bake the best bread around. I have a feeling I'll be seeing you again."]}]},_d={[I.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}],[I.Gear2]:[{messages:["Finally! I found the second gear to the clock tower.","I should take this and put it back."],onCompleted:i=>{i.quests.updateExistingQuest(B.InvestigateTownWest,!0)}}]},Vo={[G.ClockTower]:[{messages:["With two of the gears in place, the clocks hands are moving again."],conditions:{journalEntry:D.ClockSecondGear}},{messages:["Slowly, you align and tighten the second gear into place.","<b><i>[CLUNKING NOISE]</i></b>","Now two of the hands of the clock are moving again."],conditions:{hasItem:I.Gear2},mute:[1],onMessageShown:(i,t)=>{t===1&&i.scene.sound.playAudioSprite("sfx","clunk")},onCompleted:i=>{i.inventory.useItem(I.Gear2),i.journal.addEntry(D.ClockSecondGear)}},{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:D.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Let’s see what happens when we add the first gear. You tighten the gear into place.","<b><i>[CLUNKING NOISE]</i></b>","The clock tower is starting to partially move again. It looks like it’s missing two more gears."],conditions:{hasItem:I.Gear1},mute:[2],onMessageShown:(i,t)=>{t===2&&i.scene.sound.playAudioSprite("sfx","clunk")},onCompleted:i=>{i.inventory.useItem(I.Gear1),i.journal.addEntry(D.ClockFirstGear)}}],[G.Chest]:[{messages:["The chest seems to be locked.","It appears to have many symbols above the latch."],conditions:{custom:i=>!it(i,I.Gear1)&&Ql(i.scene,I.Gear1)===void 0},onCompleted:i=>{qe(i.scene,"MemoryDialog")}}],[G.LabHatch]:[{messages:["Let me see if I can open this hatch.","Wow, the rusty key fits!","<b><i>[CREAKING NOISE]</i></b>","Alright, let’s see what is down there!"],conditions:{hasItem:I.Key},mute:[2],onMessageShown:(i,t)=>{t===2&&i.scene.sound.playAudioSprite("sfx","door")},onCompleted:(i,t)=>{t==null||t.destroy(),i.inventory.useItem(I.Key),i.journal.addEntry(D.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[G.LabBook]:[{messages:[],conditions:{journalEntry:D.ClockSecondGear}},{messages:["I should retrace my steps to see if there is anything strange or new in the area."],conditions:{custom:()=>Pt>0}},{messages:['How could I have missed this? The potion is called the "Elixir of Sight".',"This must be related to one of the gears in the clock tower.","Well, bottoms up, I suppose!"],conditions:{hasItem:I.Potion,custom:()=>Pt===0},onCompleted:i=>{i.active=!1,i.journal.addEntry(D.ExtraPotionInformation),i.inventory.useItem(I.Potion),i.scene.time.delayedCall(3500,()=>{i.message.setDialog({messages:["I feel... different.","I should retrace my steps to see if there is anything strange or new in the area."],onCompleted:t=>{t.active=!0}},i)})}},{messages:["With the alchemy set fixed, I should be able to recreate the experiment.","I will need to find three ingredients according to this - <color=red>Crimson Starbloom</color>, <color=green>Green Writhewood</color>, and a <color=blue>Blue Plumed Frond</color>.","Maybe I can find them in the lab or the forest. The villagers should know more."],conditions:{journalEntry:D.AlchemySetFixed},onCompleted:i=>{i.quests.addQuest({id:B.FindPotionIngredients,completed:!1}),i.gameState.updateData({mazeSolved:!1,mazeSeed:i.gameState.data.mazeSeed+1,sphinxMoved:!1})}},{messages:["Maybe I can find more information in the lab."],conditions:{activeQuest:B.ExploreLab}},{messages:["This lab journal contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:i=>{i.quests.addQuest({id:B.ExploreLab,completed:!1})}}],[G.AlchemySet]:[{messages:["There’s nothing more that I can do here."],conditions:{hasItem:I.Potion}},{messages:["Now I have all of the ingredients.","With these, I should be able to recreate the experiment.","According to the book..."],conditions:{hasUsedItem:I.HerbBlue},onCompleted:(i,t)=>{Zc(i,t)}},{messages:["The Blue Plumed Frond is last."],conditions:{hasItem:I.HerbBlue,hasUsedItem:I.HerbRed},onCompleted:(i,t)=>{Wr(i,t,I.HerbBlue),i.quests.updateExistingQuest(B.FindPotionIngredients,!0)}},{messages:["The Crimson Starbloom comes next."],conditions:{hasItem:I.HerbRed,hasUsedItem:I.HerbGreen},onCompleted:(i,t)=>Wr(i,t,I.HerbRed)},{messages:["The Green Writhewood goes in first."],conditions:{hasItem:I.HerbGreen},onCompleted:(i,t)=>Wr(i,t,I.HerbGreen)},{messages:["Maybe the journal has more information about using this alchemy set."],conditions:{journalEntry:D.AlchemySetFixed}},{messages:["This alchemy set looks like the one in the journal.","If I can figure out how the set connects together, I might be able to recreate the experiment."],conditions:{activeQuest:B.ExploreLab},onCompleted:i=>{qe(i.scene,"PipesDialog")}},{messages:["A series of pipes and tubes. I shouldn’t touch this without knowing what it does."]}],[G.LabBookshelf1]:[{messages:[`<b>[Secrets of the Silver Transmutation]</b>
"Silver, the mirror of the soul, can be yielded from common materials. Begin with a lead base, cleanse it with the tears of a willow,"`,'"and chant thrice under a new moon. Such processes, though fraught with danger, promise immense reward. Meticulous preparation of the material is crucial. Among these pages lie safeguards against volatile spirits"','"and the precise lunar phases essential for success. Here are protective circles and counter-spells to be used should spirits prove malevolent. This knowledge has been passed down and refined for safety."'],conditions:{activeQuest:B.ExploreLab}}],[G.LabBookshelf2]:[{messages:[`<b>[Whispering Woods: A Compendium]</b>
"The sentient trees of Eldergrove are not myths; their trunks groan with ancient wisdom. To engage them, perform the Ritual of Leaves,"`,'"using moonlit water and rare herbs, along with whispered incantations passed down by forest guardians. Notes on the rare Blue Moonflower, whose petals glow ghostly and unlock forest languages, are also included."','"Its bloom is brief, and harvesting must be timed at midnight to retain its properties. The chapter concludes with a discussion on plant symbiosis with Eldertrees."'],conditions:{activeQuest:B.ExploreLab}}],[G.LabBookshelf3]:[{messages:[`<b>[The Essence of Fire: Ignite and Control]</b>
"Mastering fire requires strength of will and profound respect for its power. Here, summoning circles and incantations to call forth fire spirits"`,'"are detailed. Each summoning demands a tribute of phoenix ash. The endeavor is perilous, as spirits may lash out if provoked. The tome also discusses methods to quell flames should they rise against the summoner."','"Included are the chant of suppression and a dousing mixture from elemental waters and frost-bitten herbs. These countermeasures are vital for maintaining control over summoned entities."'],conditions:{activeQuest:B.ExploreLab}}],[G.LabPotionShelf1]:[{messages:["Nightshade, wolfsbane, starvine, frost ferns... No, those are not the right ingedients.","Oh, a <color=red>Crimson Starbloom</color>! Yes, this should work!"],conditions:{activeQuest:B.FindPotionIngredients,custom:i=>!it(i,I.HerbRed)},onCompleted(i){i.inventory.addItem({type:I.HerbRed,used:!1})}},{messages:['Hm, this is an interesting collection. What’s this "Elixir of Luminescence"? Could light up some dark corners. And "Brew of Bravery"... might make me bold enough to face a dragon, or foolish enough to try. What about "Draught of the Depths"—sounds like it could show me treasures or drown me in visions. Better not risk it; these might just burn me to a crisp!'],conditions:{activeQuest:B.ExploreLab}}],[G.MansionPicture]:[{messages:[],conditions:{hasItem:I.Gear2}},{messages:["A sturdy looking safe was hidden behind the picture.","There are large rusty rings to the side, as if it they were meant to be moved."],conditions:{journalEntry:D.SafeDiscovered},onCompleted:i=>{qe(i.scene,"TumblerDialog")}},{messages:["An abstract picture of blocks.","Wait a moment, something is behind this picture...","<b><i>[CREAK]</i></b>"],mute:[2],onMessageShown:(i,t)=>{t===2&&i.scene.sound.playAudioSprite("sfx","chest")},onCompleted:i=>{i.journal.addEntry(D.SafeDiscovered)},conditions:{hasUsedItem:I.Potion}},{messages:["An abstract picture of blocks."]}],[G.MansionHole]:[{messages:["Literally a hole in the wall.","Huh, there is something here. It's a key!"],conditions:{hasItem:I.Key,invert:!0},onCompleted:i=>{i.inventory.addItem({type:I.Key,used:!1})}},{messages:["Literally a hole in the wall."]}],[G.Bed]:[{conditions:{custom:i=>yi(i.scene)},messages:["What a long day. Time for some sleep before I continue my journey."],onCompleted:i=>td(i)},{messages:["A comfortable bed.","I should rest here if I need to."]}],[G.LibraryShelf]:[{conditions:{hasUnusedItem:I.Note},messages:["A library shelf, maybe I can find something interesting here."],onCompleted:i=>qe(i.scene,"Books")}]};function Yi(i,t,e){for(const s of i){const{conditions:r}=s,n=[];if((r==null?void 0:r.hasItem)!==void 0&&n.push(it(t,r.hasItem)),(r==null?void 0:r.hasUnusedItem)!==void 0&&n.push(Yl(t,r.hasUnusedItem)),(r==null?void 0:r.hasUsedItem)!==void 0&&n.push(di(t,r.hasUsedItem)),(r==null?void 0:r.completedQuest)!==void 0&&n.push(Kl(t,r.completedQuest)),(r==null?void 0:r.activeQuest)!==void 0&&n.push(rs(t,r.activeQuest)),(r==null?void 0:r.journalEntry)!==void 0&&n.push(ft(t,r.journalEntry)),r!=null&&r.custom&&n.push(r.custom(t,e)),r!=null&&r.invert){if(r!=null&&r.or){if(n.some(a=>!a))return s}else if(n.every(a=>!a))return s;return}if(r!=null&&r.or){if(n.some(a=>a))return s}else if(n.every(a=>a))return s}}class Jt extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a,image:o}=Tt[s];super(e,n,a,"items",o);d(this,"itemType");d(this,"player");d(this,"particles");d(this,"light");d(this,"disabled",!1);d(this,"initialized",!1);this.name=`Item-${s}`,this.itemType=s,this.player=r,this.setScale(.35).setDepth(V.Items),ti(this,Tt[s])}lazyInit(){if(this.initialized||!st(this,this.player))return;if(it(this.player,this.itemType)){this.destroy();return}this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0}),this.particles=this.scene.add.particles(this.x,this.y,"props",{frame:"warp",scale:{start:0,end:.9},alpha:{start:.7,end:0},delay:500,lifespan:1500,maxAliveParticles:1}).setDepth(V.Items).setName(`Item-${this.itemType}-Particles`),f.debug?this.light=new tt(this.scene,this.x,this.y,150*(this.displayHeight/150),16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,150*(this.displayHeight/150),16764074,2);const e=Tt[this.itemType].onCreate;e&&e(this),this.initialized=!0}onInteract(e){return e[A.Continue]?(this.scene.time.delayedCall(0,()=>{this.player.inventory.addItem({type:this.itemType,used:!1});const s=_d[this.itemType]||[],r=Yi(s,this.player,this);r&&(r==null?void 0:r.messages.length)>0&&this.player.message.setDialog(r,this,"player_portrait")}),this.destroy(),Ae.Item):Ae.None}destroy(e){var s,r,n;(s=this.particles)==null||s.destroy(),this.light instanceof tt?this.light.destroy():(n=(r=this.scene)==null?void 0:r.lights)==null||n.removeLight(this.light),super.destroy(e)}getButtonPrompt(){return[`Pick Up ${Tt[this.itemType].name}`,"Press [CONTINUE]"]}update(){var e,s;this.lazyInit(),(e=this.particles)==null||e.setPosition(this.x,this.y),(s=this.light)==null||s.setPosition(this.x,this.y)}}function it(i,t){return i.inventory.inventory.find(e=>e.type===t)!==void 0}function Yl(i,t){return i.inventory.inventory.find(e=>e.type===t&&!e.used)!==void 0}function di(i,t){return i.inventory.inventory.find(e=>e.type===t&&e.used)!==void 0}function rs(i,t){return i.quests.quests.some(e=>e.id===t&&!e.completed)}function Kl(i,t){return i.quests.quests.some(e=>e.id===t&&e.completed)}function ft(i,t){return i.journal.journal.includes(t)}function ei(i,t){return i.children.getAll().filter(e=>e instanceof t)}function Ki(i,t,e){const s=Dd(i,t);s&&s.updateLocked(e)}function Dd(i,t){return ei(i,Wi).find(e=>e.warpType===t)}function Ld(i,t){return ei(i,E.GameObjects.Rectangle).find(e=>e.getData("WallType")===t)}function Ql(i,t){return ei(i,Jt).find(e=>e.itemType===t)}function mi(i,t){return ei(i,Vi).find(e=>e.propType===t)}function ti(i,t){const{scale:e,alpha:s,angle:r,depth:n,skipLighting:a,origin:o}=t;e&&(typeof e=="object"?i.setScale(e.x,e.y):i.setScale(e)),s&&i.setAlpha(s),r&&i.setAngle(r),n&&i.setDepth(n),o&&i.setOrigin(o.x,o.y),a||i.setPipeline("Light2D"),i.setPostPipeline("XRayPipeline")}class Ne extends E.GameObjects.Text{constructor(t,e,s=3500,r=_.Slate){const n=ei(t,Ne).reduce((a,o)=>Math.max(a,o.y-20),0)+65;super(t,20,n,e,{...ge,backgroundColor:"#"+r,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(V.Overlay).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:n+10,duration:350,hold:s,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}function Yt(i){return{player:{x:i.player.x,y:i.player.y,flip:i.player.flipX},journal:i.player.journal.journal.sort(),inventory:i.player.inventory.inventory.sort((e,s)=>e.type-s.type),quests:i.player.quests.quests.sort((e,s)=>e.id-s.id),gameState:i.player.gameState.data,settings:{gamepad:i.gamepad.visible,debug:f.debug,zoomed:f.zoomed,useShader:f.useShader,time:Date.now(),muted:i.sound.mute}}}function Cn(){const i=localStorage.getItem(Qe);let t,e;try{i&&(t=JSON.parse(i))}catch(s){console.error(s),e=s}return{save:t||Kt[dt.New],error:e,newGame:!t}}const Bd={journal:{enumObj:D,enumName:"JournalEntry"},inventory:{enumObj:I,enumName:"ItemType"},type:{enumObj:I,enumName:"ItemType"},quests:{enumObj:B,enumName:"QuestType"},id:{enumObj:B,enumName:"QuestType"}};function Fd(i){return JSON.stringify(i,(e,s)=>{const r=Bd[e];return Array.isArray(s)&&r?s.map(n=>Io(n,r.enumObj,r.enumName)):r?Io(s,r.enumObj,r.enumName):s},2).replace(/"(\w+\.\w+)"/g,"$1")}function Jl(i,t){const e={...f};return f.debug=i.settings.debug,f.zoomed=i.settings.zoomed,f.useShader=i.settings.useShader,xn(f.useShader),es(t,!1,!0),f.zoomed!==e.zoomed?(Bc(t,f.zoomed),!0):f.debug!==e.debug?(t.scene.restart(),!0):!1}function Nd(i){const{save:t}=Cn();try{return Jl(t,i)}catch(e){console.error(e)}return!1}function nn(i){const{save:t,error:e,newGame:s}=Cn();e&&new Ne(i,`Unfortunately, it looks like this save is corrupted.
Failed to Load Game`,1e4);try{Jl(t,i),i.sound.stopAll(),i.sound.mute=t.settings.muted,i.player.setX(t.player.x),i.player.setY(t.player.y),i.player.previousPosition.set(t.player.x+(t.player.flip?1:-1),t.player.y),i.time.delayedCall(50,()=>{try{i.player.inventory.createUI(),i.player.quests.createUI(),i.player.journal.createUI(),s&&Qc(i),t.inventory.sort((r,n)=>r.type-n.type).forEach(r=>i.player.inventory.addItem(r,!0)),t.journal.sort().reverse().forEach(r=>i.player.journal.addEntry(r,!0)),t.quests.sort((r,n)=>r.id-n.id).forEach(r=>i.player.quests.addQuest(r,!0)),i.player.gameState.updateData(t.gameState,!0)}catch(r){console.error(r),new Ne(i,`Unfortunately, it looks like this save is corrupted.
Failed to Load Game`,1e4,_.Warning),et(i,Kt[dt.New]),nn(i)}}),i.gamepad.setVisible(t.settings.gamepad),mu(t,Kt[dt.New])&&et(i,void 0,!0)}catch(r){console.error(r),new Ne(i,`Unfortunately, it looks like this save is corrupted.
Failed to Load Game`,1e4,_.Warning),et(i,Kt[dt.New]),nn(i)}}function et(i,t,e){const s=Yt(i);localStorage.setItem(Qe,JSON.stringify(t||s)),e||i.tweens.add({targets:i.saveIcon,alpha:.7,scale:.6,duration:500,hold:250,yoyo:!0,onComplete:()=>i.saveIcon.setAlpha(0)})}function ns(i){f.prod&&et(i)}const ii={mazeSolved:!1,mazeSeed:0,sphinxFail:!1,sphinxMoved:!1,day:1,night:!1};class $d{constructor(t,e){d(this,"scene");d(this,"player");d(this,"initialized");d(this,"data");this.scene=t,this.player=e,this.initialized=!1,this.data={...ii}}updateData(t,e){this.data={...this.data,...t},Object.entries(t).forEach(([s,r])=>{this.handleSideEffects(s,r,e)}),e||ns(this.scene),this.initialized=!0}handleSideEffects(t,e,s){t==="night"&&(e?Ih(this.scene,!s):hl(this.scene,!s))}}const Qe="chrono-sleuth-save";var dt=(i=>(i[i.New=0]="New",i[i.Act1=1]="Act1",i[i.Act2=2]="Act2",i[i.LabItems=3]="LabItems",i[i.Act3=4]="Act3",i))(dt||{});const Zl={player:{x:Ut.x,y:Ut.y,flip:!1},journal:[],inventory:[],quests:[],gameState:{...ii},settings:{gamepad:Lc(),debug:!1,zoomed:!0,useShader:!0,time:Date.now(),muted:!1}},as={...Zl.settings,gamepad:!1},Wd={player:{x:642,y:650,flip:!1},journal:[D.FixTheClock],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!1}],quests:[{id:B.ForestGear,completed:!1},{id:B.SphinxRiddle,completed:!0}],gameState:{...ii,mazeSolved:!0,sphinxMoved:!0},settings:{...as}},zd={player:{x:-770,y:650,flip:!0},journal:[D.FixTheClock,D.MetTheMayor,D.ClockFirstGear],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!0}],quests:[{id:B.ForestGear,completed:!0},{id:B.SphinxRiddle,completed:!0},{id:B.InvestigateTownWest,completed:!1}],gameState:{...ii,mazeSolved:!0,sphinxMoved:!0},settings:{...as}},Gd={player:{x:-1500,y:1729,flip:!0},journal:[D.FixTheClock,D.MetTheMayor,D.ClockFirstGear,D.AlchemyLabFound,D.AlchemySetFixed],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!0},{type:I.Key,used:!0}],quests:[{id:B.ForestGear,completed:!0},{id:B.SphinxRiddle,completed:!0},{id:B.InvestigateTownWest,completed:!1},{id:B.ExploreLab,completed:!1},{id:B.FindPotionIngredients,completed:!1}],gameState:{...ii},settings:{...as}},jd={player:{x:5073.875,y:915,flip:!1},journal:[D.FixTheClock,D.MetTheMayor,D.ClockFirstGear,D.AlchemyLabFound,D.AlchemySetFixed,D.SafeDiscovered,D.ExtraPotionInformation,D.ClockSecondGear],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!0},{type:I.Key,used:!0},{type:I.HerbRed,used:!0},{type:I.HerbGreen,used:!0},{type:I.HerbBlue,used:!0},{type:I.Potion,used:!0},{type:I.Gear2,used:!0}],quests:[{id:B.ForestGear,completed:!0},{id:B.SphinxRiddle,completed:!0},{id:B.InvestigateTownWest,completed:!0},{id:B.ExploreLab,completed:!0},{id:B.FindPotionIngredients,completed:!0}],gameState:{...ii,mazeSolved:!0,sphinxMoved:!0},settings:{...as}},Kt={0:Zl,1:Wd,2:zd,3:Gd,4:jd};class Hd extends E.Scene{constructor(){super({key:"Boot",pack:{files:[{type:"image",key:"splash",url:"assets/splash.jpg"},{type:"image",key:"logo",url:"assets/logo.jpg"}]}})}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(f.width,f.height),this.add.image(35,f.height-30,"logo").setOrigin(0,1).setScale(.4),kh(this.sound)}preload(){this.load.setPath("assets"),this.load.font("m6x11","fonts/m6x11.ttf","truetype"),this.load.bitmapFont("m6x11-24","fonts/m6x11-24.png","fonts/m6x11-24.xml"),this.load.font("notepen","fonts/Notepen.ttf","truetype"),this.load.font("Germania One","fonts/GermaniaOne-Regular.ttf","truetype"),this.load.atlas("icons","atlases/icons.png","atlases/icons.json"),this.load.audioSprite("words","sounds/words.json"),this.load.audioSprite("sfx","sounds/sfx.json"),this.load.audio(we.Town,on[we.Town]),this.load.json("build",`../build.json?cacheBust=${Date.now()}`),f.phaserInspector&&(this.load.scripts("inspector",["https://cdn.jsdelivr.net/npm/tweakpane@3.1.10/dist/tweakpane.js","https://cdn.jsdelivr.net/npm/phaser-plugin-inspector@2.5.0/dist/phaser-plugin-inspector.umd.js"]),this.load.once("complete",()=>{PhaserPluginInspector.Install(this.plugins)}))}create(){var t;try{const e=(t=this.cache.json.get("build"))==null?void 0:t.buildTime;if(e&&e!=="2025-03-20T03:49:06.900Z"){this.add.text(f.width/2,f.height/2,`New version available!
Updating Game...`,{...ge,align:"center",fontSize:48}).setOrigin(.5).postFX.addGlow(0,10),caches.keys().then(r=>{for(const n of r)caches.delete(n)}),setTimeout(()=>window.location.reload(),3e3);return}}catch(e){console.error(e)}!f.prod||!localStorage.getItem(Qe)?this.scene.start("Preloader"):this.scene.start("MainMenu")}}function eh(i){i.load.setPath("assets"),i.load.image("train","maps/intro/train.png"),i.load.image("layer2","maps/intro/layer2.png"),i.load.image("layer3","maps/intro/layer3.png"),i.load.image("layer4","maps/intro/layer4.png"),i.load.image("layer5","maps/intro/layer5.png"),f.prod&&i.load.audio(we.Intro,on[we.Intro])}class Ud extends E.Scene{constructor(){super("Intro");d(this,"player");d(this,"playerProgess",0);d(this,"direction",1);d(this,"pauseDuration",0)}preload(){eh(this)}init(){var e,s;this.sound.mute=Kt[dt.New].settings.muted,f.prod||((e=this.input.keyboard)==null||e.on("keydown-BACK_SLASH",()=>{Ye(this,500,()=>{this.textures.exists("props")?this.scene.start("Game"):this.scene.start("Preloader")})}),(s=this.input.keyboard)==null||s.on("keydown-R",()=>{this.scene.restart()}))}create(){var v;me.setScene(this),me.start(we.Intro);const e=this.sound.addAudioSprite("sfx"),s=e.markers.train_rolling;e.addMarker({name:"train_rolling_trimmed",start:(s.start||0)+.5,duration:3.25}),e.play("train_rolling_trimmed",{loop:!0,volume:.15});const r=f.zoomed?.75:1;Mt(this,350),this.add.image(f.width,f.height,"layer5").setScale(5.4*r);const n=this.add.image(0,f.height,"layer4").setScale(5.4*r),a=this.add.image(0,f.height,"layer4").setScale(5.4*r),o=this.add.image(0,350*r,"layer3").setScale(2.16*r),l=this.add.image(0,f.height*.7,"layer2").setScale(5.4*r),h=f.width;let c=15e3;this.tweens.add({targets:[n],x:{from:-h*2.5,to:0},duration:c*8,repeat:-1}),this.tweens.add({targets:[a],x:{from:0,to:h*2.5},duration:c*8,repeat:-1}),this.tweens.add({targets:o,x:{from:-h*2,to:h*2.75},duration:c*4,hold:c*6,repeat:-1}),this.tweens.add({targets:[l],x:{from:-h,to:h*1.5},duration:c,hold:c*3,repeat:-1});const u=this.add.container(0,f.zoomed?-35:0);this.player=this.add.sprite(560*r,f.height-250*r,"character",0).setScale(2.5*r),this.player.anims.create({key:"walk",frames:this.player.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:5,repeat:-1}),this.player.anims.play("walk"),this.player.anims.pause(),u.add(this.player),this.cameras.main.startFollow(this.player,!0,.1,.1,0,120);const p=this.add.image(f.width/2,f.height/2,"train").setScale(2.35*r);u.add(p),this.tweens.add({targets:u,x:u.x+1,y:u.y+5,duration:300,hold:300,ease:"Bounce",repeat:-1}),(v=this.add.rectangle(-f.width/2,f.height-(f.zoomed?60:35),f.width*2,35,4472896).setOrigin(0).postFX)==null||v.addShadow(0,0,.5,1),Kc(this,this.player)}}class th extends Xe{constructor(t,e,s){super(t,e,s,t.scale.isFullscreen?"minimize":"maximize",()=>{t.scale.isFullscreen?t.scale.stopFullscreen():t.scale.startFullscreen()}),t.scale.on(Phaser.Scale.Events.ENTER_FULLSCREEN,()=>{this.img.scene=t,this.img.setTexture("icons","minimize")}),t.scale.on(Phaser.Scale.Events.LEAVE_FULLSCREEN,()=>{this.img.scene=t,this.img.setTexture("icons","maximize")})}}class qd extends E.Scene{constructor(){super("MainMenu")}create(){me.setScene(this),me.start(we.Town),this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(f.width,f.height);const t=this.add.container(0,0);t.setAlpha(0),this.tweens.add({targets:t,alpha:1,duration:150}),t.add(this.add.image(35,f.height-30,"logo").setOrigin(0,1).setScale(.4)),new Ji(this),new ts(this,!0).setVisible(!1);const e=new En(this);t.add(e);const s=new th(this,f.width-30,30);e.addButton(s),localStorage.getItem(Qe)&&e.addButton(new Ke(this,f.width-120,f.height-145,"Continue",()=>this.scene.start("Preloader"),{align:"center"}).setFixedSize(200,70)),e.addButton(new Ke(this,f.width-120,f.height-60,"New Game",()=>{localStorage.removeItem(Qe),this.scene.start("Preloader")},{align:"center"}).setFixedSize(200,70)),e.setActiveButton(1)}}class Vd extends E.Scene{constructor(){super("Preloader");d(this,"container")}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(f.width,f.height),this.add.image(35,f.height-30,"logo").setOrigin(0,1).setScale(.4);const e=f.width*.66,s=f.height*.05,r=3,n=this.add.container(f.width*.24,f.height*.86);this.container=n;const a=this.add.rectangle(0,0,e,s).setStrokeStyle(1,16777215,.85).setOrigin(0);n.add(a);const o=this.add.rectangle(r,r,0,s-r*2,16777215,.85).setOrigin(0);n.add(o),this.load.on("progress",h=>{const c=f.prod?h*.6:h;o.width=(e-r*2)*c}),f.prod&&this.load.on("complete",()=>{this.tweens.add({targets:o,width:e-r*2,duration:2e3})});const l=this.add.image(f.width-50,f.height-60,"icons","settings").setScale(.75);this.tweens.add({targets:l,angle:360,duration:2e3,delay:100,repeat:-1})}preload(){this.load.setPath("assets"),this.load.image("station","maps/station.png"),this.load.image("town","maps/town.png"),this.load.image("library","maps/library.png"),this.load.image("town_hall","maps/town_hall.png"),this.load.image("inn","maps/inn.png"),this.load.image("clock_outside","maps/clock_outside.png"),this.load.image("clock_inner","maps/clock_inner.png"),this.load.image("forest","maps/forest.png"),this.load.image("lake","maps/lake.png"),this.load.image("mansion_outside","maps/mansion_outside.png"),this.load.image("mansion_inside","maps/mansion_inside.png"),this.load.image("alchemy_lab","maps/alchemy_lab.png"),this.load.spritesheet("portal","spritesheets/portal.png",{frameWidth:140,frameHeight:120}),this.load.spritesheet("character","spritesheets/player.png",{frameWidth:40,frameHeight:74}),this.load.atlas("items","atlases/items.png","atlases/items.json"),this.load.atlas("props","atlases/props.png","atlases/props.json"),this.load.atlas("characters","atlases/characters.png","atlases/characters.json"),f.prod&&Object.entries(on).filter(([e,s])=>e!==we.Town).forEach(([e,s])=>{this.load.audio(e,s)}),this.load.image("train","maps/intro/train.png"),localStorage.getItem(Qe)||eh(this)}create(){f.prod?this.time.delayedCall(2500,()=>Ye(this,300,()=>this.start())):this.start()}start(){localStorage.getItem(Qe)?this.scene.start("Game"):this.scene.start("Intro")}}class ih extends E.GameObjects.Container{constructor(e,s,r){var n,a,o,l,h;super(e,s,r);d(this,"buttons",[]);d(this,"activeIndex",new E.Math.Vector2);d(this,"cursor");e.add.existing(this).setScrollFactor(0),this.activeIndex.set(-1,-1),(n=e.input.keyboard)==null||n.on("keydown-UP",()=>{this.setActiveButton({x:0,y:-1})}),(a=e.input.keyboard)==null||a.on("keydown-DOWN",()=>{this.setActiveButton({x:0,y:1})}),(o=e.input.keyboard)==null||o.on("keydown-LEFT",()=>{this.setActiveButton({x:-1,y:0})}),(l=e.input.keyboard)==null||l.on("keydown-RIGHT",()=>{this.setActiveButton({x:1,y:0})}),(h=e.input.keyboard)==null||h.on("keydown-ENTER",()=>{const c=this.getActiveButton();c&&c.onClick()}),e.input.on("pointermove",()=>{this.cursor.setVisible(!1)})}setButtons(e){this.buttons=e,this.activeIndex.set(-1,-1),this.removeAll(!0),this.cursor=this.scene.add.rectangle(0,0,60,80).setStrokeStyle(2,L(_.Tan),.75).setVisible(!1).setDepth(1),this.add(this.cursor);for(const s of e)for(const r of s)r!==void 0&&this.add(r)}getActiveButton(){var e;return(e=this.buttons[this.activeIndex.y])==null?void 0:e[this.activeIndex.x]}setActiveButton(e){var o,l,h,c,u,p,g;let{x:s,y:r}=this.activeIndex;if(this.cursor.visible===!1){const v=(o=this.buttons[r])==null?void 0:o[s];v&&(this.updateButtonSize(v),this.cursor.setPosition(v.x,v.y).setVisible(!0),this.cursor.setVisible(!0));return}const n=this.buttons.length;if(r=E.Math.Clamp(r,0,n-1),s=E.Math.Clamp(s,0,(((l=this.buttons[r])==null?void 0:l.length)||0)-1),e.x===0){let v;if(this.activeIndex.y!==-1){for(;r>=0&&r<n&&v===void 0;)r+=e.y,v=(h=this.buttons[r])==null?void 0:h[s];if(!v)return}s=E.Math.Clamp(s,0,((c=this.buttons[r])==null?void 0:c.length)-1)}if(e.y===0&&this.activeIndex.x!==-1){let v;for(;s>=0&&s<((u=this.buttons[r])==null?void 0:u.length)&&v===void 0;)s+=e.x,v=(p=this.buttons[r])==null?void 0:p[s];if(!v)return}const a=(g=this.buttons[r])==null?void 0:g[s];a&&(this.updateButtonSize(a),this.cursor.setPosition(a.x,a.y).setVisible(!0),this.activeIndex.set(s,r))}updateButtonSize(e){e instanceof Ke&&this.cursor.setSize(e.displayWidth+8,e.displayHeight+8),e instanceof Xe&&this.cursor.setSize(e.rect.displayWidth+8,e.rect.displayHeight+8)}}const qr=[[1,1,1,0,1],[1,0,1,0,1],[1,1,1,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],Vr=[["0","1","2"],["3"," ","4"],["5","6","7"]];class Xd extends E.Scene{constructor(){super("UITest");d(this,"selected");d(this,"cursor");d(this,"grid");this.selected=void 0}create(){var s;const e=[];for(let r=0;r<qr.length;r++){const n=[];for(let a=0;a<qr[r].length;a++)qr[r][a]?n.push(this.btn(a,r)):n.push(void 0);e.push(n)}this.grid=new ih(this),this.grid.setButtons(e),(s=this.input.keyboard)==null||s.on("keydown-BACK_SLASH",()=>{e[0][0].text="0",e[0][1].text="1",e[0][2].text="2",e[1][0].text="3",e[1][2].text="4",e[2][0].text="5",e[2][1].text="6",e[0][4].text=" ",e[1][4].text=" ",e[2][4].text=" ",e[3][4].text=" ",e[4][4].text=" ",e[5][4].text=" ",e[6][4].text=" "})}btn(e,s){return new Ke(this,50+e*60,50+s*85,e<3?" ":s.toString(),r=>this.selectButton(r))}selectButton(e){if(this.selected===void 0)this.selected=e,e.setSelected(!0);else{const s=this.selected.text;this.selected.setSelected(!1),this.selected.text=e.text,e.text=s,this.selected=void 0,this.checkValid()&&console.log("You Won!")}}checkValid(){var s;let e=!0;for(let r=0;r<Vr.length;r++)for(let n=0;n<Vr[0].length;n++){const a=(s=this.grid.buttons[r])==null?void 0:s[n];a&&a.text!==Vr[r][n]&&(e=!1)}return e}}class os extends E.GameObjects.Rectangle{constructor(e,s,r){super(e,0,0);d(this,"keys");d(this,"cursorData");d(this,"nextUpdate",0);d(this,"position",new E.Math.Vector2(-1,-1));e.add.group(this,{runChildUpdate:!0}),this.setStrokeStyle(3,L(_.Tan),.75),this.setVisible(!1).setDepth(V.Shader),this.cursorData=s,this.keys=r,e.input.on("pointerdown",n=>{this.setVisible(!1)})}update(e,s){var o;if(e<this.nextUpdate)return;let r=!0,n;this.cursorData.regions[this.position.y]&&(n=this.cursorData.regions[this.position.y][this.position.x]);const a=this.keys.keys;if(a[A.Continue]?this.cursorData.onSelect(this.position,n):a[A.Left]?this.position.x--:a[A.Right]?this.position.x++:a[A.Up]?this.position.y--:a[A.Down]?this.position.y++:r=!1,r){const l=(o=this.cursorData.regions[0])==null?void 0:o.length,h=this.cursorData.regions.length;this.position.x=E.Math.Clamp(this.position.x,0,l-1),this.position.y=E.Math.Clamp(this.position.y,0,h-1);const c=this.cursorData.regions[this.position.y][this.position.x];this.cursorData.hidden||this.setVisible(!0),this.setPosition(c.x,c.y),this.setDisplaySize(c.width,c.height),this.cursorData.onChange&&this.cursorData.onChange(this.position,c),this.nextUpdate=e+200}}}class gt extends E.Scene{constructor(e){super(e.key);d(this,"dialogData");d(this,"container");d(this,"keys");d(this,"title");d(this,"closing");d(this,"additionalUI");this.dialogData=e}create(){var e,s,r;this.additionalUI=[],this.closing=!1,this.container=this.add.container(f.width/2,f.height/2),this.dialogData.skipUI||(this.container.add(this.add.rectangle(0,0,f.width*.95,f.height*.95,0,.75).setStrokeStyle(4,L(_.Tan))),this.container.add(new Ke(this,f.width*.43,f.height*-.39,"X",()=>this.close(!1),{backgroundColor:`#${_.Warning}`})),!f.prod&&!this.dialogData.hideCloseSuccess&&this.container.add(new Xe(this,f.width*.38,f.height*-.4,"award",()=>this.close(!0))),this.title=this.add.text(0,f.height*-.4,this.dialogData.title,{...ge,fontSize:48}).setOrigin(.5),this.container.add(this.title)),(e=this.input.keyboard)==null||e.on("keydown-ESC",()=>{this.close(!1)}),(s=this.input.keyboard)==null||s.on("keydown-BACKSPACE",()=>{this.close(!1)}),f.prod||(r=this.input.keyboard)==null||r.on("keydown-BACK_SLASH",()=>{this.close(!0)}),this.keys=new Ji(this),new ts(this,!0).setVisible(this.dialogData.gamepadVisible),this.container.setAlpha(0),this.dialogData.childScene?(this.scene.launch(this.dialogData.childScene,{parent:this}),this.scene.get(this.dialogData.childScene).events.on("create",()=>this.fadeIn())):this.fadeIn(),me.setScene(this),me.fadeMusic(.15)}fadeIn(){this.tweens.killAll(),this.tweens.add({targets:this.getTargets(),alpha:{start:0,to:1},delay:100,duration:500})}fadeOut(e){this.tweens.killAll(),this.tweens.add({targets:this.getTargets(),alpha:{start:1,to:0},duration:250,hold:250,onComplete:e})}addTarget(e){e.setAlpha(0),this.additionalUI.push(e)}getTargets(){return[this.container,...this.additionalUI]}close(e){if(this.closing)return;this.closing=!0,this.preHandleSuccess(e);const s=this.scene.get("Game");me.fadeMusic(me.volume,500,()=>me.setScene(s)),this.fadeOut(()=>{var r,n;this.scene.stop(),this.dialogData.childScene&&this.scene.stop(this.dialogData.childScene),this.scene.resume(s),(r=s==null?void 0:s.gamepad)==null||r.setAlpha(1),(n=s==null?void 0:s.gamepad)==null||n.resetButtons(),this.handleSuccess(e)})}preHandleSuccess(e){}}const Di=6,ui=["The Forgotten Aeon","Taming the Wild Griffin","Surrender to the Starlit Realm","The Creation of Time","The Eternal End","The Bard’s Forbidden Melody","Bound by Fate and Fire","Secrets of the Fifth Element","The Enchanted Knight’s Oath","A Potion for Yesterday","Chronomancer’s Dilemma","Tome of the Lost Hours","The Midnight Convergence","The Rogue’s Tempting Treasure","Whispers of the Moonlit Grove","The Sorcerer’s Gentle Caress","The Elixir That Binds","Transmutation of the Soul","The Philosopher’s Vice","The Silver Circle’s Curse","A Mage’s Soft Touch","The Alchemist’s Second Life","The Thaumaturge’s Gambit","Through the Alchemist’s Looking Glass","Legends of the Velvet Throne"],Li=[ui.indexOf("The Creation of Time"),ui.indexOf("Chronomancer’s Dilemma"),ui.indexOf("Transmutation of the Soul"),ui.indexOf("The Eternal End")];class Yd extends gt{constructor(){super({key:"Books",title:"Books",gamepadVisible:!1,skipUI:!0});d(this,"player");d(this,"books");d(this,"message");d(this,"answer");d(this,"bookshelf");d(this,"door");d(this,"debug")}preload(){this.load.setPath("assets"),this.load.atlas("bookshelf","atlases/bookshelf.png","atlases/bookshelf.json")}init(e){this.player=e.player}create(){super.create(),this.books=[],this.message=new On(this),this.answer=[],this.debug=[],this.container.add(this.add.rectangle(0,0,f.width,f.height,0));const e=it(this.player,I.Note);if(this.createBookshelf(e),this.container.add(new Ke(this,f.width*.47,f.height*-.43,"X",()=>this.close(!1),{...ge,backgroundColor:void 0,fontSize:54})),!f.prod&&!this.dialogData.hideCloseSuccess){const s=new Xe(this,f.width*.467,f.height*-.3,"award",()=>this.close(!0));s.rect.fillColor=0,s.rect.strokeColor=0,this.container.add(s)}if(e){this.time.delayedCall(200,()=>{this.message.setDialog({messages:["This note seems to be a clue of some sort. Maybe it has to do with some sort of ordering for the books on the shelf."]},void 0,"player_portrait")});const s=this.add.image(0,0,"props","paper").setScale(1.6,2.25).setAngle(90);s.setPosition(20+s.displayHeight/2,5+s.displayWidth/2),this.addTarget(s);const r=this.add.text(70,50,["A spiral marks the heart of the sequence.",'Time begins with "Creation" and ends in "Eternity".',"A blue tome, near the center, waits before the final touch."].join(`

`),{...Jr,fontSize:36}).setWordWrapWidth(260);this.addTarget(r)}this.fadeIn()}createBookshelf(e){var c;const s=this.textures.get("bookshelf"),r=Object.entries(s.frames),n=[],a=4,o=e?150:0;this.bookshelf=this.add.image(o,0,"bookshelf","Bookshelf-0").setScale(a).setTint(6710886),this.container.add(this.bookshelf),this.door=this.add.image(o,0,"bookshelf","Door-0").setScale(a).setTint(6710886),this.container.add(this.door);const l=r.filter(u=>u[1].name.startsWith("Book_")).sort((u,p)=>{const g=Number(u[1].name.replace("Book_","").replace("-0","")),v=Number(p[1].name.replace("Book_","").replace("-0",""));return g-v});for(let u=0;u<l.length;u++){const p=l[u],g=this.add.image(o,0,"bookshelf",p[1].name).setScale(a);g.setData({index:u}),this.container.add(g);const v=2,y=p[1].data.spriteSourceSize,m=new E.Geom.Rectangle(y.x-v,y.y-v,y.w+v*2,y.h+v*2);g.setInteractive({hitArea:m,hitAreaCallback:E.Geom.Rectangle.Contains,cursor:"pointer"});const w=Math.floor(u/4);n[w]===void 0&&n.push([]),n[w].push({x:-1,y:-1,width:-1,height:-1,object:g});const k=(c=g.preFX)==null?void 0:c.addGlow(L(_.Tan),0);if(k&&(this.books.push({image:g,glow:k,strength:0,name:ui[u]}),g.on("pointerover",()=>{this.books[u].strength=Di}),g.on("pointerout",()=>{this.answer.includes(u)||(this.books[u].strength=0)}),g.on("pointerdown",()=>{this.handleClick(u)}),!f.prod&&e&&Li.includes(u))){const x=this.add.text(m.x*4-o+40,m.y*4-f.height/2+40,(Li.indexOf(u)+1).toString(),ge).setAlpha(.5);this.container.add(x),this.debug.push(x)}}const h=new os(this,{regions:n,onSelect:(u,p)=>{if(p!=null&&p.object&&!this.message.visible){const g=p.object.getData("index");this.handleClick(g)}},onChange:(u,p)=>{if(p!=null&&p.object){const g=p.object.getData("index");this.books.forEach((v,y)=>{this.answer.includes(y)||(v.strength=y===g?Di:0)})}},hidden:!0},this.keys);this.container.add(h)}handleClick(e){const s=it(this.player,I.Note),r=Li[this.answer.length]===e&&s,n=[this.books[e].name];r&&n.push("<b><i>[CLUNK]</i></b> The book shifts slightly."),this.message.setDialog({messages:n,mute:r?[1]:void 0,onMessageShown:(a,o,l)=>{o===1&&this.sound.playAudioSprite("sfx","safe_click")},onCompleted:r?()=>{this.answer.push(e),this.books[e].strength=Di,this.books[e].glow.color=L(_.Success),this.answer.length===Li.length&&this.close(!0)}:()=>{this.answer=[],this.books.forEach(a=>{a.glow.color=L(_.Tan),a.strength=0})}},void 0,"player_portrait")}update(e,s){super.update(e,s),this.updateBooks(e,s)}updateBooks(e,s){if(this.message.visible)return;const r=.001,n=.015;for(let a=0;a<this.books.length;a++){const o=this.books[a],l=o.strength-o.glow.outerStrength;if(Math.abs(l)>r){let h=n*s*Math.sign(l);o.glow.outerStrength=Math.abs(h)>Math.abs(l)?o.strength:o.glow.outerStrength+h,o.glow.outerStrength=Phaser.Math.Clamp(o.glow.outerStrength,0,Di)}}}handleSuccess(e){e&&this.player.inventory.useItem(I.Note)}close(e){if(this.books.forEach(r=>{r.strength=0,r.image.destroy()}),this.debug.forEach(r=>r.destroy()),this.bookshelf.setTint(L(_.White)),this.door.setTint(L(_.White)),!e){super.close(!1);return}const s=400;this.add.timeline([{at:s+0,run:()=>{this.sound.playAudioSprite("sfx","safe_open")}},{at:s+250,run:()=>this.door.setFrame("Door-1")},{at:s+500,run:()=>this.door.setFrame("Door-2")},{at:s+1400,run:()=>this.message.setDialog({messages:["It looks like there is a secret room behind the bookshelf!"],onCompleted:()=>super.close(!0)},void 0,"player_portrait")}]).play()}}const Bi=6,Kd=200;class sh extends E.GameObjects.Container{constructor(e,s,r,n,a,o){var l,h;super(e,s,r);d(this,"textObject");d(this,"maskGraphics");d(this,"scrollbar");d(this,"scrollTimer");d(this,"scrollY");d(this,"boxHeight");e.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new E.GameObjects.Text(e,0,0,n,{...ge,padding:{x:10,y:10},...a}),this.textObject.setOrigin(0).setScrollFactor(0),this.textObject.setInteractive({cursor:o?"pointer":"ns-resize"}),this.add(this.textObject),e.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),this.textObject.on("pointerdown",(c,u,p)=>{o&&(clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout(()=>{const g=this.textObject.getWrappedText().length,v=p/this.textObject.height,y=Math.floor(v*g);o(y)},Kd))}),(l=e.input.keyboard)==null||l.on("keydown-UP",()=>{this.scrollY-=30,this.updateTextPosition()}),(h=e.input.keyboard)==null||h.on("keydown-DOWN",()=>{this.scrollY+=30,this.updateTextPosition()}),this.maskGraphics=e.add.graphics().setPosition(s,r).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=e.add.rectangle(0,0,(a==null?void 0:a.scrollbarWidth)||Bi,0,(a==null?void 0:a.scrollbarColor)||L(_.Night)).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(e,s){this.boxHeight=s,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,e,s);const r=this.maskGraphics.createGeometryMask();return this.textObject.setMask(r),this.textObject.setWordWrapWidth(e-Bi*2),this.textObject.setFixedSize(e-Bi*2,0),this.updateTextPosition(),this}setText(e){return this.textObject.setText(e),this.updateTextPosition(),this}handleDrag(e){e.isDown&&(clearTimeout(this.scrollTimer),this.scrollY-=e.velocity.y/2,this.updateTextPosition())}handleScroll(e,s,r,n,a){this.scrollY+=n*.5,this.updateTextPosition()}updateTextPosition(){const e=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=E.Math.Clamp(this.scrollY,0,e),this.textObject.y=-this.scrollY;const s=this.scrollY/e,r=this.boxHeight/this.textObject.height;this.scrollbar.height=r*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+Bi,s*(this.boxHeight-r*this.boxHeight))}}const li=250,Xo="chrono-sleuth-debug-tab",fi=[];md.sort().forEach(i=>{const e=28-i.length,s=Math.floor(e/2),r="-".repeat(s-1);let n=`${r} ${i} ${r}`;n=n.padEnd(28,"-"),fi.push({label:n});const a=Vl.filter(o=>Fe[o].location===i).sort((o,l)=>M[o].localeCompare(M[l])).map(o=>({label:Fe[o].name||mn(M[o]),warp:o}));fi.push(...a),fi.push({label:""})});class Qd extends gt{constructor(){super({key:"DebugTool",title:"Debug Tool",gamepadVisible:!1,hideCloseSuccess:!0});d(this,"player");d(this,"tabs",[]);d(this,"tab",0);d(this,"mainContainer");d(this,"textBox");d(this,"helperText");d(this,"stateContainer");d(this,"saveContainer");d(this,"miscContainer");d(this,"preSave");d(this,"testVoice",{octave:3.5,speed:1,volume:1,type:"sine"});const e=localStorage.getItem(Xo);e&&(this.tab=Number(e))}init(e){this.player=e.player;const s=Yt(this.player.scene);s.settings.time=0,this.preSave=JSON.stringify(s)}create(){var h;super.create(),this.mainContainer=this.add.container(-f.width/2,-f.height/2),this.container.add(this.mainContainer),this.mainContainer.add(this.add.rectangle(li+50,100,f.width*.65,f.height*.75,L("#112233")).setOrigin(0));const e=this.makeTab("Items",0),s=this.makeTab("Journal",1),r=this.makeTab("Quests",2),n=this.makeTab("State",3),a=this.makeTab("Warp",4),o=this.makeTab("Saves",5),l=this.makeTab("Misc",6);this.textBox=new sh(this,li+50,100,"",{fontSize:32},c=>this.handleLineClick(c)).setBoxSize(f.width*.42,f.height*.75),this.mainContainer.add(this.textBox),this.helperText=this.add.text(f.zoomed?f.width*.94:f.width*.87,110,"",{...ge,fontSize:24}).setOrigin(1,0).setDepth(1),this.mainContainer.add(this.helperText),this.tabs=[e,s,r,n,a,o,l],this.container.add(this.tabs),this.createStateContainer(),this.createSaveContainer(),this.createMiscContainer(),this.updateTabs(),(h=this.input.keyboard)==null||h.on("keydown-CLOSED_BRACKET",()=>{this.close()})}createStateContainer(){this.stateContainer=this.add.container(li+60,100),this.mainContainer.add(this.stateContainer);const e=this.player.gameState.data;Object.entries(e).forEach((s,r)=>{const[n,a]=s,o=this.add.text(0,20+40*r,`${n}: ${a}`,{...ge,fontSize:32}).setOrigin(0);switch(this.stateContainer.add(o),typeof a){case"boolean":o.setText(`${a?"[x]":"[ ]"} ${n}`),o.setInteractive().on("pointerdown",()=>{e[n]=!e[n],o.setText(`${e[n]?"[x]":"[ ]"} ${n}`)});break;case"number":const l=this.smallButton(o.width+20,22+40*r,"-",()=>{e[n]--,o.setText(`${n}: ${e[n]}`)}),h=this.smallButton(o.width+55,22+40*r,"+",()=>{e[n]++,o.setText(`${n}: ${e[n]}`)});this.stateContainer.add([l,h]);break}})}smallButton(e,s,r,n){return new It(this,e,s,r,n,{fontSize:36,backgroundColor:"#111",padding:{x:6,y:-4}},null)}createSaveContainer(){this.saveContainer=this.add.container(li+60,100),this.mainContainer.add(this.saveContainer),Object.entries(Kt).forEach((s,r)=>{const[n,a]=s,o=new It(this,0,10+60*r,dt[Number(n)],()=>{Number(n)===dt.New?(localStorage.removeItem(Qe),window.location.reload()):(et(this.player.scene,a),this.player.x+=.1,this.close(!0))},{backgroundColor:"#111"});this.saveContainer.add(o)});const e=new It(this,350,10,"Dump Save",()=>{const s=Yt(this.player.scene),r=Fd(s);navigator.clipboard.writeText(r).catch(n=>console.error(n)),console.warn("save copied to clipboard!"),console.log(r)},{backgroundColor:"#111"});this.saveContainer.add(e)}createMiscContainer(){this.miscContainer=this.add.container(li+60,100),this.mainContainer.add(this.miscContainer);let e=-50;const s=new It(this,350,e+=60,"Debug Mode",()=>{f.debug=!f.debug,this.close()},{backgroundColor:"#111"});this.miscContainer.add(s);const r=new It(this,350,e+=60,"Clear Cache",async()=>{const a=await caches.keys();for(const o of a)await caches.delete(o);window.location.reload()},{backgroundColor:"#111"});this.miscContainer.add(r);const n=new It(this,350,e+=60,"Toggle Lights",()=>this.player.gameState.updateData({night:!this.player.gameState.data.night}),{backgroundColor:"#111"});this.miscContainer.add(n)}makeTab(e,s){return new It(this,-this.container.x+40,-this.container.y+100+60*s,e,()=>{this.tab=s,localStorage.setItem(Xo,String(s)),this.updateTabs()})}rangeInput(e,s,r,n,a){const o=this.add.text(e,s,`${a}: ${r().toFixed(1)}`,{...ge}),l=this.smallButton(e+130,s,"-",()=>{n(r()-.1),o.text=`${a}: ${r().toFixed(1)}`}),h=this.smallButton(e+170,s,"+",()=>{n(r()+.1),o.text=`${a}: ${r().toFixed(1)}`});return[o,l,h]}handleLineClick(e){var s,r;switch(this.tab){case 0:const n=Go[e],a=this.player.inventory.inventory,o=a.find(v=>v.type===n);o?o.used?a.splice(a.indexOf(o),1):o.used=!o.used:this.player.inventory.addItem({type:n,used:!1},!0);break;case 1:const l=jo[e],h=this.player.journal.journal;ft(this.player,l)?h.splice(h.indexOf(l),1):this.player.journal.addEntry(l,!0);break;case 2:const c=Ho[e],u=this.player.quests.quests,p=u.find(v=>v.id===c);p?p.completed?u.splice(u.indexOf(p),1):p.completed=!p.completed:this.player.quests.addQuest({id:c,completed:!1},!0);break;case 4:const g=fi[e];g.warp&&(Tn(M.Town,Fe[g.warp].warpTo,this.player,void 0,!0),this.close());break;case 6:if(e>1){const v=Uo[e-2];v==="MainMenu"?(this.scene.sendToBack("Game"),this.scene.start(v)):(this.scene.stop(this),this.scene.resume("Game"),(r=(s=this.scene.get("Game"))==null?void 0:s.gamepad)==null||r.setAlpha(1),qe(this.player.scene,v))}break}this.updateTabs()}updateTabs(){var n,a,o;this.tabs.forEach((l,h)=>{l.setBackgroundColor(h===this.tab?"#123":"#151515")});const e=this.tab===0||this.tab===1||this.tab===2||this.tab===4||this.tab===6,s=this.tab===0||this.tab===2;(n=this.stateContainer)==null||n.setVisible(this.tab===3),(a=this.saveContainer)==null||a.setVisible(this.tab===5),(o=this.miscContainer)==null||o.setVisible(this.tab===6),this.textBox.setVisible(e),this.helperText.setVisible(s);let r="";switch(this.tab){case 0:r=Go.map(l=>`[${Yl(this.player,l)?"-":di(this.player,l)?"x":" "}] ${I[l]}`).join(`
`),this.helperText.setText(`[-] item held
[x] item used`);break;case 1:r=jo.map(l=>`[${ft(this.player,l)?"x":" "}] ${D[l]}`).join(`
`);break;case 2:r=Ho.map(l=>`[${rs(this.player,l)?"-":Kl(this.player,l)?"x":" "}] ${B[l]}`).join(`
`),this.helperText.setText(`[-] quest active
[x] quest complete`);break;case 4:r=fi.map(l=>l.label).join(`
`);break;case 6:r=["Scenes","-----------------",...Uo].join(`
`);break}this.textBox.setText(r)}handleSuccess(e){const s=Yt(this.player.scene);s.settings.time=0,this.preSave!==JSON.stringify(s)&&(e||et(this.player.scene),this.player.scene.scene.restart())}}class Jd extends gt{constructor(){super({key:"JournalDialog",title:"Journal",gamepadVisible:!1,hideCloseSuccess:!0,skipUI:!0});d(this,"player")}init(e){this.player=e.player}create(){var r;super.create(),this.container.add(this.add.image(0,0,"props","paper").setScale(2.9,3.3)),this.container.add(new Ke(this,f.width*.44,f.height*-.36,"X",()=>this.close(!1),{...Jr,backgroundColor:void 0,fontSize:54})),this.player.journal.unread.setVisible(!1);const e=this.player.journal.journal.map(n=>`${bn[n].description}
`).reverse(),s=new sh(this,f.width*.08,f.height*.2,e,{...Jr,scrollbarColor:L(_.Brown)});s.setBoxSize(f.width*.84,f.height*.62),this.addTarget(s),this.fadeIn(),(r=this.input.keyboard)==null||r.on("keydown-J",()=>{this.close()}),this.sound.playAudioSprite("sfx","book_open")}preHandleSuccess(){this.sound.playAudioSprite("sfx","book_close")}handleSuccess(){}}function Yo(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,s)}return e}function Ko(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Yo(Object(e),!0).forEach(function(s){Zd(i,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):Yo(Object(e)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(e,s))})}return i}function Zd(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function rh(i){return i.slice(0,-1)}function nh(i,t=0){return t?Array.from(Array(t-i).keys()).map(e=>e+i):Array.from(Array(i).keys())}function ah(i){return[...new Set(i)]}function Qo(i,t){const e=ah(i.map(a=>a.set)).filter(Boolean),s=(r=nh(1,i.length+1),n=e,[r,n].reduce((a,o)=>a.filter(l=>!o.includes(l)))).sort(()=>.5-t());var r,n;i.filter(a=>!a.set).forEach((a,o)=>a.set=s[o])}function Jo(i,t,e=.5){rh(i).forEach((s,r)=>{const n=i[r+1],a=s.set!==n.set,o=t()<=e;a&&o&&(function(l,h,c){l.forEach(u=>{u.set===h&&(u.set=c)})}(i,n.set,s.set),s.right=!1,n.left=!1)})}function ef(i=8,t=i,e=!0,s=1){const r=function(h){return function(){let c=h+=1831565813;return c=Math.imul(c^c>>>15,1|c),c^=c+Math.imul(c^c>>>7,61|c),((c^c>>>14)>>>0)/4294967296}}(s),n=[],a=nh(i);for(let h=0;h<t;h+=1){const c=a.map(u=>({x:u,y:h,top:e||h>0,left:e||u>0,bottom:e||h<t-1,right:e||u<i-1}));n.push(c)}rh(n).forEach((h,c)=>{Qo(h,r),Jo(h,r),function(u,p,g){const v=Object.values(function(m,w){let k=ah(m.map(x=>x.set)).reduce((x,T)=>Ko(Ko({},x),{},{[T]:[]}),{});return m.forEach(x=>k[x.set].push(x)),k}(u)),{ceil:y}=Math;v.forEach(m=>{(function(w,k,x){k=k??1;const T=w==null?0:w.length;if(!T||k<1)return[];k=k>T?T:k;let C=-1;const F=T-1,K=[...w];for(;++C<k;){const $=C+Math.floor(x()*(F-C+1)),R=K[$];K[$]=K[C],K[C]=R}return K.slice(0,k)})(m,y(g()*m.length),g).forEach(w=>{if(w){const k=p[w.x];w.bottom=!1,k.top=!1,k.set=w.set}})})}(h,n[c+1],r)});const o=(l=n)[l.length-1];var l;return Qo(o,r),Jo(o,r,1),n}const $t=24,ze=16,Zo=140;class tf extends E.Scene{constructor(){super("Maze");d(this,"parent");d(this,"keys");d(this,"maze");d(this,"mazePlayer");d(this,"playerPosition",new E.Math.Vector2(0,0));d(this,"nextUpdate");d(this,"walking");d(this,"audioThrottle",0)}init(e){this.parent=e.parent}preload(){this.load.setPath("assets"),this.load.image("maze_player","puzzles/maze/maze_player.png"),this.load.image("maze_tiles","puzzles/maze/maze_tiles.png")}create(){this.createMaze(),this.playerPosition.set(0,0),this.mazePlayer=this.add.image(this.playerPosition.x,this.playerPosition.y,"maze_player").setDisplaySize(ze/2,ze/2).setOrigin(-.5);const e=this.cameras.main;e.startFollow(this.mazePlayer),e.setZoom(5),e.setViewport(50,130,f.width-100,f.height-170),this.keys=this.parent.keys,this.parent.addTarget(this.mazePlayer),f.prod||this.input.on("wheel",(r,n,a,o,l)=>{e.zoom=Math.max(.01,e.zoom+o*5e-4)}),this.walking=this.sound.addAudioSprite("sfx");const s=this.walking.markers.ladder;this.walking.addMarker({name:"step",start:s.start,duration:.3})}getMazeSeed(){return this.parent.player.gameState.data.mazeSeed||0}createMaze(){var u,p,g,v;const e=this.getMazeSeed();this.maze=ef($t,$t,!0,e);const s=this.maze,r=s.length,n=s[0].length,a=Array.from({length:2*r+1},()=>Array(2*n+1).fill(1));for(let y=0;y<r;y++)for(let m=0;m<n;m++)a[2*y+1][2*m+1]=0,s[y][m].top||(a[2*y][2*m+1]=0),s[y][m].bottom||(a[2*y+2][2*m+1]=0),s[y][m].left||(a[2*y+1][2*m]=0),s[y][m].right||(a[2*y+1][2*m+2]=0);a[0][0]=0,a[1][0]=0,a[0][1]=0,a[2*r][2*n]=0,a[2*r-1][2*n]=0,a[2*r][2*n-1]=0;const o=a.length,l=this.make.tilemap({tileWidth:ze,tileHeight:ze,width:o,height:o}),h=l.addTilesetImage("maze_tiles"),c=l.createBlankLayer("layer",h);c.setScale(.5),this.parent.addTarget(c);for(let y=0;y<o-1;y++)for(let m=0;m<o-1;m++){const w=(u=a[y])==null?void 0:u[m],k=(p=a[y])==null?void 0:p[m+1],x=(g=a[y+1])==null?void 0:g[m],C=((v=a[y+1])==null?void 0:v[m+1])+x*2+k*4+w*8;c.putTileAt(C,m,y)}}update(e,s){if(e<this.nextUpdate)return;const r=this.keys.keys,n=new E.Math.Vector2(0,0);r[A.Left]?n.x=-16:r[A.Right]?n.x=ze:r[A.Up]?n.y=-16:r[A.Down]&&(n.y=ze);const a=new E.Math.Vector2(this.playerPosition.x+n.x,this.playerPosition.y+n.y),o=new E.Math.Vector2(($t-1)*ze,($t-1)*ze);(this.playerPosition.x!==a.x||this.playerPosition.y!==a.y)&&this.canMove(a)&&(Date.now()>this.audioThrottle&&(this.walking.play("step",{volume:.5}),this.audioThrottle=Date.now()+350),this.mazePlayer.setPosition(this.playerPosition.x,this.playerPosition.y),this.playerPosition.set(a.x,a.y),this.tweens.killTweensOf(this.mazePlayer),this.tweens.add({targets:this.mazePlayer,x:a.x,y:a.y,duration:Zo}),this.parent.setAngle(E.Math.Angle.BetweenPoints(a,o))),this.playerPosition.x===o.x&&this.playerPosition.y===o.y&&this.parent.close(!0),this.nextUpdate=e+Zo}canMove(e){const s=e.x,r=e.y,n=Math.floor(s/ze),a=Math.floor(r/ze);if(n<0||a<0||n>=$t||a>=$t)return!1;const o=Math.floor(this.playerPosition.x/ze),l=Math.floor(this.playerPosition.y/ze),h=this.maze[l][o];return!(!h||h.top&&r<this.playerPosition.y||h.bottom&&r>this.playerPosition.y||h.left&&s<this.playerPosition.x||h.right&&s>this.playerPosition.x)}}class sf extends gt{constructor(){super({key:"MazeDialog",title:"Find your way through the forest",childScene:"Maze",gamepadVisible:!0});d(this,"player");d(this,"arrow")}init(e){var s,r;this.player=e.player,this.dialogData.gamepadVisible=(r=(s=e.player.scene)==null?void 0:s.gamepad)==null?void 0:r.visible}create(){super.create(),this.arrow=this.add.image(-f.width*.4,-f.height*.4,"icons","arrow-up").setScale(.5).setRotation(Math.PI*.75),this.container.add(this.arrow)}setAngle(e){this.arrow.setRotation(e+Math.PI/2)}handleSuccess(e){e&&Ye(this.player.scene,500,()=>{Tn(M.TownEast,M.Forest,this.player),this.player.gameState.updateData({mazeSolved:!0,mazeSeed:this.player.gameState.data.mazeSeed+1},!1)})}}const rf=6,Xr=12;class nf extends gt{constructor(){super({key:"MemoryDialog",title:"Figure out the secret code",gamepadVisible:!1});d(this,"sequence");d(this,"pressed");d(this,"buttons");d(this,"player")}init(e){this.player=e.player}preload(){this.load.setPath("assets"),this.load.atlas("runes","atlases/runes.png","atlases/runes.json")}create(){for(super.create(),this.sequence=[],this.pressed=[];this.sequence.length<rf;){const a=E.Math.RND.between(0,Xr-1);this.sequence.includes(a)||this.sequence.push(a)}f.prod||this.container.add(this.add.text(0,f.height*.43,`[ ${this.sequence.map(a=>a+1).join(", ")} ]`,{fontSize:24,align:"center"}).setOrigin(.5)),this.buttons=new En(this),this.container.add(this.buttons);const s=f.width/13*1.2,r=[];for(let a=0;a<Xr;a++){const o=-s+a%3*s,l=-s*1.2+Math.floor(a/3)*s,h=Math.floor(a/3);r[h]===void 0&&r.push([]),r[h].push({x:o,y:l,width:s,height:s});const c=this.add.image(o,l,"runes",`Stone${a+1}`).setInteractive({useHandCursor:!0});c.on("pointerdown",()=>this.onButtonPress(c,a)),this.buttons.add(c)}const n=new os(this,{regions:r,onSelect:a=>{const o=a.y*3+a.x,l=this.buttons.getAt(o);this.onButtonPress(l,o)}},this.keys);this.container.add(n)}onButtonPress(e,s){const r=this.pressed.length;if(this.sequence[r]===s){this.sound.playAudioSprite("sfx","safe_click",{volume:.75}),this.pressed.push(s),e.disableInteractive();const n=new E.Display.Color(255,255,255),a=ut(L(_.Success));jt(this,n,a,o=>e.setTint(o),{duration:250,onComplete:()=>{const o=ut(L(_.Success)),l=ut(3355443);jt(this,o,l,h=>e.setTint(h),{duration:250,onComplete:()=>{this.sequence.length===this.pressed.length&&this.close(!0)}})}})}else{this.sound.playAudioSprite("sfx","memory_wrong",{volume:.75}),e.disableInteractive();const n=new E.Display.Color(255,255,255),a=ut(L(_.Warning));jt(this,n,a,o=>e.setTint(o),{duration:250,yoyo:!0,onComplete:()=>{this.buttons.each(o=>{o.setInteractive(),o.setTint(16777215)})}}),this.pressed=[]}}close(e){e?this.completed(()=>super.close(e)):super.close()}completed(e){this.time.delayedCall(300,()=>{this.sound.playAudioSprite("sfx","unlock",{volume:.75}),this.buttons.getAll().forEach((s,r)=>{const n=r===Xr-1,a=s.tint,o=ut(a),l=ut(L(_.Success));s.disableInteractive(),s.setTint(a),jt(this,o,l,h=>s.setTint(h),{duration:200,delay:r*70,hold:500,onComplete:n?e:void 0})})})}handleSuccess(e){e&&Jc(this.player)}}class af extends E.Scene{constructor(){super("Paused");d(this,"parent");d(this,"debugCount");d(this,"container");d(this,"preSave")}init(e){this.parent=e.game;const s=Yt(this.parent.player.scene);s.settings.time=0,this.preSave=JSON.stringify(s)}create(){var v;const{width:e,height:s}=f;me.setScene(this),me.fadeMusic(.15),this.container=this.add.container(0,0),this.container.add(this.add.rectangle(e/2,s/2,e,s,0,.75).setInteractive().on("pointerdown",()=>this.resume())),this.container.add(this.add.text(e/2,f.height/2-100,"Game Paused",{...ge,fontSize:72}).setOrigin(.5)),this.debugCount=0,this.container.add(this.add.text(e-20,s-20,`Build Time: ${new Date("2025-03-20T03:49:06.900Z").toLocaleString()}
${f.prod?"":"Debug Mode"}`,{...ge,fontSize:16,align:"right",padding:{x:20,y:20}}).setOrigin(1,1).setInteractive({useHandCursor:!1}).on("pointerdown",()=>{this.debugCount++,this.debugCount>10&&(localStorage.setItem("chrono-sleuth-prod",f.prod?"false":"true"),window.location.reload())}));const n=!f.zoomed?48:36,a=new ih(this);this.container.add(a);const o=new Xe(this,f.width-210,30,"tv",()=>{xn()}),l=new Xe(this,f.width-150,30,"gamepad",()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}),h=new Xe(this,f.width-90,30,this.parent.sound.mute?"volume-mute":"volume",()=>{const y=this.parent.sound.mute;this.parent.sound.mute=!y,h.setIcon(y?"volume":"volume-mute")}),c=new th(this,f.width-30,30),u=new Ke(this,e/2,f.height/2,"Resume",()=>this.resume(),{fontSize:n});let p;f.prod||(p=new Xe(this,80,30,"terminal",()=>{this.resume(),this.parent.time.delayedCall(200,()=>{qe(this.parent,"DebugTool")})})),a.setButtons([[p,o,l,h,c],[void 0,u,void 0,void 0,void 0],[void 0,void 0,void 0,void 0,void 0]]),a.activeIndex.set(1,1),(v=this.input.keyboard)==null||v.on("keydown-ESC",()=>this.resume()),new Ji(this),new ts(this,!0).setVisible(!1),this.tweens.add({targets:this.container,alpha:{start:0,to:1},duration:250})}resume(){me.fadeMusic(me.volume,500,()=>me.setScene(this.parent)),this.tweens.add({targets:this.container,alpha:{start:1,to:0},duration:250,onComplete:()=>{this.scene.stop(),this.scene.resume("Game")}}),this.parent.time.delayedCall(300,()=>{const e=Yt(this.parent);e.settings.time=0,this.preSave!==JSON.stringify(e)&&et(this.parent)})}}const hi=16,Fi=8;class of extends E.Scene{constructor(){super("Pipes");d(this,"parent");d(this,"keys");d(this,"pipes",[]);d(this,"totalPipes",0);d(this,"images",[]);d(this,"container");d(this,"blockSize");d(this,"pipeSize");d(this,"initialized",!1);d(this,"enabled",!0)}init(e){this.parent=e.parent,this.blockSize=f.zoomed?13:17,this.pipeSize=this.blockSize*3.75,this.enabled=!0}preload(){this.prerenderPipes()}prerenderPipes(){for(const e of bd){const s=ql[e],r=`pipe_${e}`;this.textures.exists(r)&&this.textures.remove(r);const n=this.textures.createCanvas(r,this.blockSize*3,this.blockSize*3);if(n){const a=n.context;a.fillStyle="#ffffff";for(let o=0;o<s.length;o++)for(let l=0;l<s[o].length;l++)s[o][l]===1&&a.fillRect(l*this.blockSize,o*this.blockSize,this.blockSize,this.blockSize);n.refresh()}}}create(){this.keys=this.parent.keys,this.container=this.add.container(),this.createPipes();const e=[];for(let r=0;r<Fi-2;r++){e.push([]);for(let n=0;n<hi-2;n++)e[r].push({x:(n+1)*this.pipeSize,y:(r+1)*this.pipeSize,width:this.pipeSize,height:this.pipeSize})}const s=new os(this,{regions:e,onSelect:r=>this.rotatePipe(r.x+1,r.y+1)},this.keys);this.container.add(s)}createPipes(){this.pipes=[],this.container=this.add.container().setPosition(f.width/2-hi*this.pipeSize/2+this.pipeSize/2,f.height/4),this.totalPipes=0;const e=5;for(let s=0;s<Fi;s++){this.pipes[s]||(this.pipes[s]=[]);for(let r=0;r<hi;r++){let n=Ur[s][r];const a=r===0||s===0||r===hi-1||s===Fi-1,o=r===hi-1&&s===Fi-1,l=!a;this.pipes[s][r]={x:r,y:s,type:n,rotation:a?0:E.Math.Between(0,3)*90,interactive:l},n!==Pn.Empty&&this.totalPipes++;const h=r+s*Ur[0].length;this.time.delayedCall(50+h*e,()=>{const c=`pipe_${n}`,u=this.add.image(r*this.pipeSize,s*this.pipeSize,c).on("pointerdown",()=>this.rotatePipe(r,s));u.setAlpha(0).setScale(.5).setAngle(this.pipes[s][r].rotation),this.tweens.add({targets:u,alpha:1,scale:1,duration:300,onComplete:o?()=>{this.initialized=!0,this.updatePipes()}:void 0}),l?u.setInteractive():u.setTint(6710886),this.container.add(u),this.images.push(u)})}}this.parent.addTarget(this.container)}rotatePipe(e,s){this.pipes[s][e].interactive&&this.initialized&&this.enabled&&(this.pipes[s][e].rotation=(this.pipes[s][e].rotation+90)%360,Math.random()>.35&&this.sound.playAudioSprite("sfx","pipes_squeak",{volume:.25,detune:E.Math.Between(-500,500)}),this.updatePipes())}updatePipes(){const e=dd(this.pipes,Wo.x,Wo.y);this.pipes.forEach(s=>{s.forEach(r=>{this.images[r.x+r.y*Ur[0].length].setAngle(r.rotation)})}),e.length===this.totalPipes&&this.parent.close(!0)}completed(e){this.enabled=!1;const s=this.images.length,r=new E.Display.Color(255,255,255),n=ut(L(_.Teal));this.sound.playAudioSprite("sfx","pipes_complete",{volume:1.2});for(let a=0;a<s;a++){const o=this.images[a],l=a===s-1;jt(this,r,n,h=>o.setTint(h),{duration:500,delay:a*10,hold:1e3,onComplete:l?()=>{e&&e(),this.tweens.add({targets:this.container.list,alpha:0,duration:100})}:void 0})}}}class lf extends gt{constructor(){super({key:"PipesDialog",title:`Attach all of the pipes to fix the alchemy set.
[CONTINUE/CLICK] to rotate`,gamepadVisible:!1,childScene:"Pipes"});d(this,"player")}init(e){this.player=e.player}create(){super.create(),this.title.setFontSize(36).setAlign("center").setY(this.title.y+10)}close(e){const s=this.scene.get("Pipes");e&&s?s.completed(()=>super.close(e)):super.close(e)}handleSuccess(e){e&&this.player.message.setDialog({messages:["There. It looks like the alchemy set has been properly fit back together."],onCompleted:s=>{s.journal.addEntry(D.AlchemySetFixed)}},mi(this.player.scene,G.AlchemySet),"player_portrait")}}const _e=3,Wt=f.height/(f.zoomed?4:5.5),hf=30,Ni=_e*_e-1;class uf extends gt{constructor(){super({key:"SliderDialog",title:"Arrange the tiles to be in order.",gamepadVisible:!1});d(this,"solution",[]);d(this,"layout",[]);d(this,"tiles",[])}preload(){this.load.setPath("assets");const e=Math.floor(512/_e);this.load.spritesheet("slider","puzzles/slider.jpg",{frameWidth:e,frameHeight:e})}create(){super.create();const e=[];this.solution=Array.from({length:_e*_e},(r,n)=>n),this.layout=[...this.solution],this.tiles=[];for(let r=this.layout.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[this.layout[r],this.layout[n]]=[this.layout[n],this.layout[r]]}this.layout.forEach((r,n)=>{const a=n%_e,o=Math.floor(n/_e),l=(a-(_e-1)/2)*Wt,h=(o-(_e-1)/2)*Wt+hf;e[o]===void 0&&(e[o]=[]),e[o].push({x:l,y:h,width:Wt*1.1,height:Wt*1.1});const c=this.add.image(l,h,"slider",n).setOrigin(.5).setDisplaySize(Wt*.95,Wt*.95);this.container.add(c),c.setInteractive({useHandCursor:!0}),c.on("pointerdown",()=>{this.moveTile(n)}),this.tiles.push(c)});const s=new os(this,{regions:e,onSelect:r=>{const n=r.y*_e+r.x;this.moveTile(n)}},this.keys);this.container.add(s),this.updateLayout()}moveTile(e){const s=this.layout.indexOf(Ni),r=s%_e,n=Math.floor(s/_e),a=e%_e,o=Math.floor(e/_e);Math.abs(r-a)+Math.abs(n-o)===1&&(this.layout[s]=this.layout[e],this.layout[e]=Ni,this.sound.playAudioSprite("sfx","puzzle_slide",{volume:.5}),this.updateLayout()),this.layout.join("")===this.solution.join("")&&this.handleSuccess(!0)}updateLayout(){this.layout.forEach((e,s)=>{this.tiles[s].setFrame(e),this.tiles[s].setVisible(e!=Ni)})}completed(e){for(let s=0;s<this.layout.length+1;s++)this.time.delayedCall(s*150,()=>{s<this.layout.length&&(this.tiles[s].setFrame(s),this.tiles[s].setVisible(s!=Ni)),s>0&&this.tiles[s-1].setTint(6710886)});this.time.delayedCall(2e3,e)}close(e){e?this.completed(()=>super.close(e)):super.close(e)}handleSuccess(e){e&&this.time.delayedCall(750,()=>{this.close(!0)})}}const el=[[1,0,1,1,0],[0,1,0,0,0],[0,0,1,0,1],[0,0,1,1,0],[1,1,0,0,1]],tl=36,cf=16,ht=Math.PI*2/cf;class df extends gt{constructor(){super({key:"TumblerDialog",title:"Open the lock by aligning all rings",gamepadVisible:!1});d(this,"player");d(this,"angles");d(this,"rings");d(this,"line");d(this,"fx");d(this,"active");d(this,"nextUpdate");d(this,"disabled")}init(e){this.player=e.player}preload(){this.load.setPath("assets"),this.load.atlas("rings","atlases/tumbler.png","atlases/tumbler.json")}create(){super.create(),this.angles=[],this.rings=[],this.fx=[],this.active=0,this.nextUpdate=0,this.disabled=!1,this.line=this.add.line(0,30,tl*.75,0,tl*6,0,L(_.Night)).setOrigin(0,0).setLineWidth(5),this.container.add(this.line),this.container.add(this.add.text(-f.width*.45,f.height*.2,`Use [Left]/[Right]
to select a ring

Use [Up]/[Down]
to rotate a ring`,{...ge}));for(let e=0;e<el.length;e++){let s=Math.floor(Math.random()*Math.PI*2);s=E.Math.Snap.To(s,ht),s=e/5*Math.PI*2,this.angles.push(s),this.circle(e)}this.updateMarkers()}circle(e){const s={x:f.width/2,y:f.height/2},r=this.add.image(0,30,"rings",`ring${e+1}`).setScale(.8).setInteractive({draggable:!0,useHandCursor:!0,pixelPerfect:!0}).on("drag",n=>{if(this.active=-1,n.isDown){this.active=e;const a=E.Math.Angle.Between(s.x,s.y,n.x,n.y);this.handleMove(e,a)}}).on("dragstart",n=>{if(this.active=-1,n.isDown){this.active=e;const a=E.Math.Angle.Between(s.x,s.y,n.x,n.y);this.handleMove(e,a)}}).on("dragend",()=>{this.active=-1,this.updateMarkers(!0)});this.fx.push(r.postFX.addGlow(L(_.Night),2,0)),f.debug&&this.input.enableDebug(r),this.container.add(r),this.rings.push(r)}handleMove(e,s,r){var o;if(this.disabled)return;const n=JSON.stringify(this.angles),a=this.angles[e]-s;this.angles[e]=E.Math.Snap.To(s%(Math.PI*2),ht),(o=el[e])==null||o.forEach((l,h)=>{h!==e&&(this.angles[h]=E.Math.Snap.To((this.angles[h]+l*a)%(Math.PI*2),ht))}),n!==JSON.stringify(this.angles)&&this.sound.playAudioSprite("sfx","safe_click",{detune:E.Math.Between(-500,500)}),this.updateMarkers(r)}updateMarkers(e){let s=!0;this.angles.forEach((r,n)=>{var o;const a=E.Math.Snap.To(r,ht);Math.abs(a-0)<ht*.6||Math.abs(a-Math.PI*2)<ht*.6||(s=!1),(o=this.rings[n])==null||o.setAngle(E.Math.RadToDeg(a))}),s&&e&&this.close(!0)}completed(e){for(let s=0;s<5;s++)this.sound.playAudioSprite("sfx","safe_click",{delay:s*.1+Math.random()*.05,detune:E.Math.Between(-500,500)});this.sound.playAudioSprite("sfx","chest",{delay:.75}),this.tweens.add({targets:this.rings,rotation:0,duration:500,onComplete:()=>{this.angles=[0,0,0,0,0],this.updateMarkers(),this.disabled=!0,this.active=-1,this.tweens.add({targets:[...this.rings,this.line],rotation:Math.PI*2,delay:500,duration:1500,hold:1e3,onComplete:e})}})}update(e,s){var r;if(!(e<this.nextUpdate)){if(this.nextUpdate=e+100,!this.disabled){const n=this.keys.keys;n[A.Left]?(this.nextUpdate=e+300,this.active=E.Math.Clamp(this.active-1,0,this.angles.length-1)):n[A.Right]?(this.nextUpdate=e+300,this.active=E.Math.Clamp(this.active+1,0,this.angles.length-1)):n[A.Up]?this.handleMove(this.active,this.angles[this.active]-ht,!0):n[A.Down]&&this.handleMove(this.active,this.angles[this.active]+ht,!0)}for(let n=0;n<5;n++)(r=this.rings[n])==null||r.setTint(this.active===n?L("C49B7C"):void 0),this.fx[n].color=L(this.active===n?"C49B7C":_.Night)}}close(e){e?this.completed(()=>super.close(e)):super.close(e)}handleSuccess(e){e&&ed(this.player)}}bh({immediate:!0});const ff={type:Phaser.WEBGL,width:f.width,height:f.height,parent:"game-container",backgroundColor:L(_.Background),scale:{mode:Phaser.Scale.FIT,autoCenter:f.prod?Phaser.Scale.CENTER_BOTH:Phaser.Scale.CENTER_HORIZONTALLY},loader:{imageLoadType:"HTMLImageElement"},scene:[Hd,qd,Vd,Ud,Xl,af,Qd,Jd,sf,tf,lf,of,df,nf,uf,Yd,Xd],pipeline:{CRTPipeline:Gl,XRayPipeline:Uc},input:{gamepad:!0},disableContextMenu:f.prod,physics:{default:"arcade"},fps:{panicMax:165,smoothStep:!0},render:{pixelArt:!0,antialias:!1},maxLights:20,dom:{createContainer:!0},plugins:{scene:[{key:"PipelinePlugin",plugin:jc,mapping:"pipelinePlugin"}]}};Nc();const Yr=document.querySelector("#initial-loader");Yr==null||Yr.remove();const pf=new E.Game(ff);(!f.prod||f.debug)&&Id(pf);
