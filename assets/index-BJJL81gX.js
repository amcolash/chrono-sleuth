var kh=Object.defineProperty;var Eh=(t,i,e)=>i in t?kh(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var d=(t,i,e)=>Eh(t,typeof i!="symbol"?i+"":i,e);import{r as Oh,g as Ih,c as Xi,a as Th}from"./phaser-DOKKBh0n.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const Ph="modulepreload",Ch=function(t,i){return new URL(t,i).href},Xn={},Ah=function(i,e,s){let r=Promise.resolve();if(e&&e.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(e.map(h=>{if(h=Ch(h,s),h in Xn)return;Xn[h]=!0;const u=h.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(!!s)for(let v=a.length-1;v>=0;v--){const y=a[v];if(y.href===h&&(!u||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${c}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":Ph,u||(g.as="script"),g.crossOrigin="",g.href=h,l&&g.setAttribute("nonce",l),document.head.appendChild(g),u)return new Promise((v,y)=>{g.addEventListener("load",v),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return i().catch(n)})};function Rh(t={}){const{immediate:i=!1,onNeedRefresh:e,onOfflineReady:s,onRegistered:r,onRegisteredSW:n,onRegisterError:a}=t;let o,l;const h=async(c=!0)=>{await l};async function u(){if("serviceWorker"in navigator){if(o=await Ah(async()=>{const{Workbox:c}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:c}},[],import.meta.url).then(({Workbox:c})=>new c("./sw.js",{scope:"./",type:"classic"})).catch(c=>{a==null||a(c)}),!o)return;o.addEventListener("activated",c=>{(c.isUpdate||c.isExternal)&&window.location.reload()}),o.addEventListener("installed",c=>{c.isUpdate||s==null||s()}),o.register({immediate:i}).then(c=>{n?n("./sw.js",c):r==null||r(c)}).catch(c=>{a==null||a(c)})}}return l=u(),h}var E=Oh();const Mh={width:1280,height:720},fl={width:960,height:540};let pl=!1,gl=!1,_h=!1,dn=!1;dn=!0;let ii=!0;const Yn=localStorage.getItem("chrono-sleuth-prod");Yn!==null&&(ii=Yn==="true");let fn;fn="LockpickDialog";let yl=ii;yl=!0;let ml=!1;ii&&(ml=!1);const{width:Dh,height:Kn}=fl;ii&&(pl=!1,dn=!1,ii=!0,fn=void 0,gl=!1);const f={debug:pl,phaserInspector:gl,prod:ii,bootDialog:fn,useShader:yl,width:Dh,height:Kn,cameraOffset:Kn/4,zoomed:!0,dayMinutes:.25,rewindEnabled:_h,fastMode:dn,perfTest:ml};var Ae=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t[t.Prop=4]="Prop",t))(Ae||{}),R=(t=>(t[t.Station=0]="Station",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.TownNorth=6]="TownNorth",t[t.ClockSquare=7]="ClockSquare",t[t.ClockSquareNorth=8]="ClockSquareNorth",t[t.ClockEntrance=9]="ClockEntrance",t[t.ClockStairs=10]="ClockStairs",t[t.ClockTop=11]="ClockTop",t[t.TownWest=12]="TownWest",t[t.MansionGrounds=13]="MansionGrounds",t[t.MansionEntrance=14]="MansionEntrance",t[t.Mansion=15]="Mansion",t[t.LabHatch=16]="LabHatch",t[t.Lab=17]="Lab",t[t.LibraryEntrance=18]="LibraryEntrance",t[t.Library=19]="Library",t[t.InnEntrance=20]="InnEntrance",t[t.Inn=21]="Inn",t))(R||{}),I=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t[t.Key=2]="Key",t[t.HerbRed=3]="HerbRed",t[t.HerbGreen=4]="HerbGreen",t[t.HerbBlue=5]="HerbBlue",t[t.Potion=6]="Potion",t[t.Gear2=7]="Gear2",t[t.Note=8]="Note",t))(I||{}),B=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t[t.InvestigateTownWest=2]="InvestigateTownWest",t[t.ExploreLab=3]="ExploreLab",t[t.FindPotionIngredients=4]="FindPotionIngredients",t))(B||{}),le=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.Innkeeper=4]="Innkeeper",t[t.Baker=5]="Baker",t))(le||{}),Yi=(t=>(t[t.Sphinx=0]="Sphinx",t))(Yi||{}),D=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.MetTheMayor=1]="MetTheMayor",t[t.ClockFirstGear=2]="ClockFirstGear",t[t.AlchemyLabFound=3]="AlchemyLabFound",t[t.AlchemySetFixed=4]="AlchemySetFixed",t[t.ExtraPotionInformation=5]="ExtraPotionInformation",t[t.SafeDiscovered=6]="SafeDiscovered",t[t.ClockSecondGear=7]="ClockSecondGear",t))(D||{}),z=(t=>(t[t.ClockTower=0]="ClockTower",t[t.Chest=1]="Chest",t[t.LabHatch=2]="LabHatch",t[t.LabBook=3]="LabBook",t[t.AlchemySet=4]="AlchemySet",t[t.LabBookshelf1=5]="LabBookshelf1",t[t.LabBookshelf2=6]="LabBookshelf2",t[t.LabBookshelf3=7]="LabBookshelf3",t[t.LabPotionShelf1=8]="LabPotionShelf1",t[t.MansionPicture=9]="MansionPicture",t[t.MansionHole=10]="MansionHole",t[t.Bed=11]="Bed",t[t.LibraryShelf=12]="LibraryShelf",t))(z||{}),_t=(t=>(t[t.LabStairs=0]="LabStairs",t[t.InnStairs=1]="InnStairs",t))(_t||{}),G=(t=>(t.Town="Town",t.Station="Train Station",t.ClockOutside="Clock Tower Square",t.ClockInner="Clock Tower",t.Forest="Strange Woods",t.Lake="Lake Epoch",t.MansionOutside="Mansion Grounds",t.MansionInside="Mansion",t.AlchemyLab="Secret Alchemy Lab",t.Library="Library",t.Inn="Inn",t))(G||{}),we=(t=>(t.Intro="music-intro",t.Station="music-station",t.Town="music-town",t.Mansion="music-mansion",t.Forest="music-forest",t.Clock="music-clock",t))(we||{}),Qt=(t=>(t[t.Library=0]="Library",t[t.Inn=1]="Inn",t[t.Train=2]="Train",t))(Qt||{});const rn={[we.Intro]:{locations:[],volume:.4},[we.Station]:{locations:[G.Station],volume:.5},[we.Town]:{locations:[G.Town,G.Library,G.Inn],volume:.5},[we.Clock]:{locations:[G.ClockInner,G.ClockOutside],volume:.5},[we.Forest]:{locations:[G.Forest,G.Lake],volume:.5},[we.Mansion]:{locations:[G.MansionInside,G.MansionOutside,G.AlchemyLab],volume:.5}},pn={[we.Station]:"sounds/music/Unknown.mp3",[we.Clock]:"sounds/music/Night Time Scavenge II.mp3",[we.Mansion]:"sounds/music/Reflective District.mp3",[we.Forest]:"sounds/music/Serene.mp3",[we.Intro]:"sounds/music/A New Day's Hurry.mp3",[we.Town]:"sounds/music/A Different Kind Of Journey.mp3"};let me;function Lh(t){me=new Bh(t)}class Bh{constructor(i){d(this,"sound");d(this,"music");d(this,"volume",.5);d(this,"scene");this.sound=i,i.on("mute",(e,s)=>{this.music&&(s?Qn(this.scene,this.music):Es(this.scene,this.music,this.volume))}),i.once("unlocked",()=>{this.music&&!this.music.isPlaying&&Es(this.scene,this.music,this.volume)})}start(i,e){var s,r;this.sound.mute||this.sound.locked||((s=this.music)==null?void 0:s.key)===i&&((r=this.music)!=null&&r.isPlaying)||this.scene.load.isLoading()||(this.stop(),this.volume=e||rn[i].volume||.5,this.scene.cache.audio.exists(i)&&(this.music=this.sound.get(i)||this.sound.add(i,{loop:!0,volume:this.volume}),Es(this.scene,this.music,this.volume)))}stop(){this.music&&Qn(this.scene,this.music),this.music=void 0}setScene(i){this.scene=i,this.scene.load.setPath("assets")}getLocationMusic(i){const e=Object.entries(rn).find(([s,r])=>r.locations.includes(i));if(e)return e[0]}fadeMusic(i,e=500,s){this.music&&this.scene.tweens.add({targets:this.music,volume:i,duration:e,onComplete:s})}}function Es(t,i,e=.5,s=500){t&&i&&!i.pendingRemove&&(i.play({volume:0,loop:!0}),t.tweens.getTweensOf(i).forEach(r=>r.stop()),t.tweens.add({targets:i,volume:e,duration:s}))}function Qn(t,i,e=500){t&&i.isPlaying?(t.tweens.getTweensOf(i).forEach(s=>s.stop()),t.tweens.add({targets:i,volume:0,duration:e,onComplete:()=>i.stop()})):i.stop()}const _={White:"fcfee9",Tan:"e6c99d",Brown:"473946",Slate:"303646",Teal:"008080",Black:"1c1831",Note:"222222",Warning:"993333",Success:"339933",Lights:"ffccaa",Night:"aa99cc",Background:"111111",ButtonActive:"ddaaee"};function L(t){return E.Display.Color.HexStringToColor(t).color}function gn(t){return L(E.Display.Color.RGBToString(t.r*255,t.g*255,t.b*255))}function Fh(t){return L(E.Display.Color.RGBToString(t.r,t.g,t.b))}function gt(t){const i=E.Display.Color.ColorToRGBA(t);return new E.Display.Color(i.r,i.g,i.b,i.a)}function Xt(t,i,e,s,r){const n=(r.duration||100)*.3;return t.tweens.addCounter({from:0,to:n,onUpdate:a=>{const o=E.Display.Color.Interpolate.ColorWithColor(i,e,n,a.getValue());s(Fh(o))},...r})}var V=(t=>(t[t.Backgrounds=-1]="Backgrounds",t[t.Warpers=0]="Warpers",t[t.Npcs=1]="Npcs",t[t.Items=2]="Items",t[t.Player=3]="Player",t[t.Shader=4]="Shader",t[t.Ui=5]="Ui",t[t.Ui2=6]="Ui2",t[t.Debug=7]="Debug",t[t.Overlay=8]="Overlay",t))(V||{});function Nh(t){t.anims.create({key:"walk",frames:t.anims.generateFrameNumbers("character",{start:0,end:5}),repeat:-1,frameRate:f.prod?6:9}),t.anims.play("walk")}const nn=5;function rs(t){var r,n;const i=t.x-t.previousPosition.x;Math.abs(((r=t.body)==null?void 0:r.velocity.x)||0)>1||Math.abs(((n=t.body)==null?void 0:n.velocity.y)||0)>1||Math.abs(i)>1?t.anims.resume():t.anims.pause();const s=i<0;Math.abs(i)>0&&(t.flipX=t.rewinding?!s:s),t.setAngle(t.flipX?-5:nn)}class at extends E.GameObjects.GameObject{constructor(e,s,r,n,a,o){super(e,"DebugLight");d(this,"x");d(this,"y");d(this,"light");d(this,"debug");e.add.existing(this),this.light=e.lights.addLight(s,r,n,a,o),this.debug=e.add.graphics({x:s,y:r}).setDepth(V.Debug),this.debug.lineStyle(3,a),this.debug.name="DebugLightGraphics",this.x=s,this.y=r,f.debug&&this.debug.strokeCircle(0,0,n)}setPosition(e,s){this.light.setPosition(e,s),this.debug.setPosition(e,s),this.x=e,this.y=s}setIntensity(e){this.light.setIntensity(e)}setVisible(e){this.light.setVisible(e)}destroy(e){var s,r;super.destroy(e),this.debug.destroy(),(r=(s=this.scene)==null?void 0:s.lights)==null||r.removeLight(this.light)}}const ue={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${_.White}`},an={fontFamily:"notepen, sans-serif",color:`#${_.Note}`,fontSize:42,fontStyle:"bold"},Os=1e3*60*f.dayMinutes,vl=250,bl=8;class Lf extends E.GameObjects.Container{constructor(e,s,r){var n,a;super(e,40,f.height-60);d(this,"currentTime",0);d(this,"rewindCount",0);d(this,"player");d(this,"rewindable");d(this,"rewinding",!1);d(this,"counter",0);d(this,"bar");d(this,"hand");d(this,"timeText");d(this,"dayOver");this.name="Clock",this.setVisible(f.rewindEnabled).setDepth(V.Ui).setScrollFactor(0),this.scene.add.existing(this),this.rewindable=s,this.player=r,this.add(e.add.image(0,0,"items","watch")),this.hand=e.add.rectangle(0,10,3,14,L(_.Black)).setOrigin(0,0),this.add(this.hand),this.timeText=e.add.text(15,10,"",ue).setScrollFactor(0),this.bar=e.add.rectangle(0,f.height-6,0,6,13412864).setScrollFactor(0),(n=this.scene.input.keyboard)==null||n.on("keydown-SHIFT",()=>{this.rewinding=!0,this.rewindable.forEach(o=>o.setRewind(!0))}),(a=this.scene.input.keyboard)==null||a.on("keyup-SHIFT",()=>{this.rewinding=!1,this.rewindable.forEach(o=>o.setRewind(!1))})}update(e,s){var u;const r=this.currentTime/f.dayMinutes;this.bar.width=f.width*r;const n=60*60*1e3,a=7*n+this.currentTime/Os*17*n,o=Math.floor(a/1e3/60/60%12),l=Math.floor(a/1e3/60%60),h=a/n<12?"AM":"PM";this.timeText.setText(`${o===0?"12":o}:${l.toString().padStart(2,"0")} ${h}`),this.hand.setAngle(a/(n*12)*360+180),this.currentTime>Os&&!this.rewinding&&!this.player.message.visible&&(this.dayOver=this.scene.add.text(250,250,"Day Over",{...ue,fontSize:96}).setScrollFactor(0),this.rewinding=!0,this.rewindable.forEach(c=>c.setRewind(!0))),this.rewinding?this.currentTime>0?this.currentTime=Math.max(0,this.currentTime-s*bl):(this.rewinding=!1,this.rewindable.forEach(c=>{c.setRewind(!1),c.reset&&c.reset()}),(u=this.dayOver)==null||u.destroy(),this.rewindCount++):this.player.message.visible||(this.counter>vl&&(this.rewindable.forEach(c=>c.record()),this.counter=0),this.counter+=s,this.currentTime+=s),this.bar.width=this.currentTime/Os*f.width}}class Jn extends E.GameObjects.Text{constructor(i){super(i,f.width/2,f.height-50,"",ue),this.setOrigin(.5).setBackgroundColor("#"+_.Black).setPadding(10,5).setAlign("center").setAlpha(.8).setScrollFactor(0).setDepth(V.Overlay).setVisible(!1),i.add.existing(this)}}var C=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t[t.Shift=6]="Shift",t))(C||{});class ns{constructor(i){d(this,"scene");d(this,"keys",Object.keys(C).map(Number).reduce((i,e)=>({...i,[e]:!1}),{}));d(this,"lastInput");this.scene=i,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W","UP"),this.listener(2,"A","LEFT"),this.listener(1,"S","DOWN"),this.listener(3,"D","RIGHT"),this.listener(4,"SPACE","ENTER"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE"),this.listener(6,"SHIFT"),this.scene.input.on("pointerdown",()=>{this.lastInput="mouse"});const e=()=>this.lastInput="mouse";window.document.addEventListener("pointermove",e),i.events.on("destroy",()=>window.removeEventListener("pointermove",e))}listener(i,e,s){var r,n;(r=this.scene.input.keyboard)==null||r.on(`keydown-${e}`,a=>{var o;s&&((o=this.scene.input.keyboard)==null||o.emit(`keydown-${s}`)),this.keys[i]=!0,a?this.lastInput="keyboard":this.lastInput="gamepad"}),(n=this.scene.input.keyboard)==null||n.on(`keyup-${e}`,a=>{var o;s&&((o=this.scene.input.keyboard)==null||o.emit(`keyup-${s}`)),this.keys[i]=!1,a?this.lastInput="keyboard":this.lastInput="gamepad"})}resetKeys(){Object.entries(this.keys).forEach(([e,s])=>this.keys[Number(e)]=!1)}}var $h=Phaser.Renderer.WebGL.Utils,Wh=function(t,i,e,s){if(!(i.width===0||i.height===0)){e.addToRenderList(i);var r=i.frame,n=r.width,a=r.height,o=$h.getTintAppendFloatAlpha,l=t.pipelines.set(i.pipeline,i),h=l.setTexture2D(r.glTexture,i);t.pipelines.preBatch(i),l.batchTexture(i,r.glTexture,n,a,i.x,i.y,n/i.style.resolution,a/i.style.resolution,i.scaleX,i.scaleY,i.rotation,i.flipX,i.flipY,i.scrollFactorX,i.scrollFactorY,i.displayOriginX,i.displayOriginY,0,0,n,a,o(i.tintTopLeft,e.alpha*i._alphaTL),o(i.tintTopRight,e.alpha*i._alphaTR),o(i.tintBottomLeft,e.alpha*i._alphaBL),o(i.tintBottomRight,e.alpha*i._alphaBR),i.tintFill,0,0,e,s,!1,h),t.pipelines.postBatch(i)}},Gh=function(t,i,e,s){i.width===0||i.height===0||(e.addToRenderList(i),t.batchSprite(i,i.frame,e,s))};const zh={renderWebGL:Wh,renderCanvas:Gh},Is=Phaser.Display.Canvas.CanvasPool;var jh=function(t,i,e){e===void 0&&(e={});var s=Is.create(this),r=s.getContext("2d",{willReadFrequently:!0});t.syncFont(s,r);var n=r.measureText(i),a=Math.ceil(n.width*t.baselineX),o=a,l=2*o;if(o=o*t.baselineY|0,s.width=a,s.height=l,r.fillStyle="#f00",r.fillRect(0,0,a,l),r.font=t._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(t.testString,0,o),e.left=0,a===0||l===0||!r.getImageData(0,0,a,l))return Is.remove(s),e;for(var h=r.getImageData(0,0,a,l).data,u=!1,c=0;c<a;c++){for(var p=0;p<l;p++){var g=(p*a+c)*4;if(h[g]!==255){e.left=c,u=!0;break}}if(u)break}return Is.remove(s),e};const Hh=60;var Zn=!1,Uh=function(t){if(!Zn){t===void 0&&(t=Hh);var i=Phaser.VERSION.split("."),e=parseInt(i[0]);if(e===3){var s=parseInt(i[1]);s<t&&console.error(`Minimum supported version : ${e}.${s}`)}else console.error(`Can't supported version : ${e}`);Zn=!0}};Uh();const qh=Phaser.GameObjects.GameObject;class wl extends qh{setStyle(i){return this.style.setStyle(i)}setFont(i){return this.style.setFont(i)}setFontFamily(i){return this.style.setFontFamily(i)}setFontSize(i){return this.style.setFontSize(i)}setFontStyle(i){return this.style.setFontStyle(i)}setTestString(i){return this.style.setTestString(i)}setFixedSize(i,e){return this.style.setFixedSize(i,e)}setBackgroundColor(i,e,s){return this.style.setBackgroundColor(i,e,s)}setBackgroundStrokeColor(i,e){return this.style.setBackgroundStrokeColor(i,e)}setBackgroundCornerRadius(i,e){return this.style.setBackgroundCornerRadius(i,e)}setFill(i){return this.style.setFill(i)}setColor(i){return this.style.setColor(i)}setStroke(i,e){return this.style.setStroke(i,e)}setShadow(i,e,s,r,n,a){return this.style.setShadow(i,e,s,r,n,a)}setShadowOffset(i,e){return this.style.setShadowOffset(i,e)}setShadowColor(i){return this.style.setShadowColor(i)}setShadowBlur(i){return this.style.setShadowBlur(i)}setShadowStroke(i){return this.style.setShadowStroke(i)}setShadowFill(i){return this.style.setShadowFill(i)}setUnderline(i,e,s){return this.style.setUnderline(i,e,s)}setUnderlineColor(i){return this.style.setUnderlineColor(i)}setUnderlineThickness(i){return this.style.setUnderlineThickness(i)}setUnderlineOffset(i){return this.style.setUnderlineOffset(i)}setStrikethrough(i,e,s){return this.style.setStrikethrough(i,e,s)}setStrikethroughColor(i){return this.style.setStrikethroughColor(i)}setStrikethroughThickness(i){return this.style.setStrikethroughThickness(i)}setStrikethroughOffset(i){return this.style.setStrikethroughOffset(i)}setWrapMode(i){return this.style.setWrapMode(i)}setWrapWidth(i){return this.style.setWrapWidth(i)}setWordWrapWidth(i){return this.style.setWrapWidth(i)}setAlign(i){return this.style.setHAlign(i)}setHAlign(i){return this.style.setHAlign(i)}setVAlign(i){return this.style.setVAlign(i)}get lineSpacing(){return this.style.lineSpacing}set lineSpacing(i){this.style.lineSpacing=i}setLineSpacing(i){return this.style.lineSpacing=i,this.updateText(!0),this}setXOffset(i){return this.style.setXOffset(i)}setMaxLines(i){return this.style.setMaxLines(i)}setResolution(i){return this.style.setResolution(i)}getTextMetrics(){return this.style.getTextMetrics()}setTextMetrics(i,e){return this.style.setTextMetrics(i,e)}measureTextMargins(i,e){return jh(this.style,i,e)}}const Ce=Phaser.GameObjects.Components;Phaser.Class.mixin(wl,[Ce.Alpha,Ce.BlendMode,Ce.ComputedSize,Ce.Crop,Ce.Depth,Ce.Flip,Ce.GetBounds,Ce.Mask,Ce.Origin,Ce.Pipeline,Ce.PostPipeline,Ce.ScrollFactor,Ce.Tint,Ce.Transform,Ce.Visible,zh]);const Vh=Phaser.Utils.String.Pad;var be=function(t,i,e){if(t==null)return t;switch(typeof t){case"string":return t;case"number":return`#${Vh(Math.floor(t).toString(16),6,"0",1)}`;case"function":return t(i,e);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?`rgba(${t.r},${t.g},${t.b},${t.a})`:`rgb(${t.r},${t.g},${t.b})`:t.hasOwnProperty("h")?t.hasOwnProperty("a")?`hsla(${t.h},${t.s},${t.l},${t.a})`:`hsl(${t.h},${t.s},${t.l})`:t;default:return t}},Xh={backgroundColor:["backgroundColor",null,be],backgroundColor2:["backgroundColor2",null,be],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,be],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",be],stroke:["stroke","#fff",be],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",be],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",be],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],strikethroughColor:["strikethrough.color","#000",be],strikethroughThickness:["strikethrough.thickness",0,null],strikethroughOffset:["strikethrough.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]};/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */const Ii=Phaser.Display.Canvas.CanvasPool;var ea=function(t){var i=Ii.create(this),e=i.getContext("2d",{willReadFrequently:!0});t.syncFont(i,e);var s=e.measureText(t.testString);if("actualBoundingBoxAscent"in s){var r=s.actualBoundingBoxAscent,n=s.actualBoundingBoxDescent,h={ascent:r,descent:n,fontSize:r+n};return Ii.remove(i),h}var a=Math.ceil(s.width*t.baselineX),o=a,l=2*o;o=o*t.baselineY|0,i.width=a,i.height=l,e.fillStyle="#f00",e.fillRect(0,0,a,l),e.font=t._font,e.textBaseline="alphabetic",e.fillStyle="#000",e.fillText(t.testString,0,o);var h={ascent:0,descent:0,fontSize:0};if(!e.getImageData(0,0,a,l))return h.ascent=o,h.descent=o+6,h.fontSize=h.ascent+h.descent,Ii.remove(i),h;var u=e.getImageData(0,0,a,l).data,c=u.length,p=a*4,g,v,y=0,m=!1;for(g=0;g<o;g++){for(v=0;v<p;v+=4)if(u[y+v]!==255){m=!0;break}if(!m)y+=p;else break}for(h.ascent=o-g,y=c-p,m=!1,g=l;g>o;g--){for(v=0;v<p;v+=4)if(u[y+v]!==255){m=!0;break}if(!m)y-=p;else break}return h.descent=g-o,h.fontSize=h.ascent+h.descent,Ii.remove(i),h},Se={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,MIX_WRAP:3,SPLITREGEXP:/(?:\r\n|\r|\n)/};const ta={none:Se.NO_WRAP,word:Se.WORD_WRAP,char:Se.CHAR_WRAP,character:Se.CHAR_WRAP,mix:Se.MIX_WRAP},Yh=Phaser.Utils.Objects.GetAdvancedValue,Be=Phaser.Utils.Objects.GetValue;class Sl{constructor(i,e,s){this.parent=i,s===void 0&&(s=Xh),this.propertyMap=s,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.strikethroughColor,this.strikethroughThickness,this.strikethroughOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}get isWrapFitMode(){return this.fixedWidth>0&&this.wrapMode!==Se.NO_WRAP&&this.wrapWidth===0}setStyle(i,e,s){if(e===void 0&&(e=!0),s===void 0&&(s=!1),i&&i.hasOwnProperty("wordWrap")){var r=i.wordWrap;r.hasOwnProperty("width")&&(i.wrap={mode:"word",width:r.width})}if(i&&i.hasOwnProperty("wrap")){var n=i.wrap;if(n.hasOwnProperty("mode")){var a=n.mode;typeof a=="string"&&(n.mode=ta[a])}else n.hasOwnProperty("width")&&(n.mode=1)}i&&i.rtl&&s&&!i.hasOwnProperty("halign")&&(i.halign="right"),i&&i.hasOwnProperty("fontSize")&&typeof i.fontSize=="number"&&(i.fontSize=i.fontSize.toString()+"px");var o=this.propertyMap;for(var l in o){var h=o[l],u=h[0],c=s?h[1]:this[l],p=h[2];if(l==="wrapCallback"||l==="wrapCallbackScope")this[l]=Be(i,u,c);else{var g=Yh(i,u,c);p&&(g=p(g)),this[l]=g}}var v=Be(i,"font",null);v===null?this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily:this._font=v;var y=Be(i,"fill",null);y!==null&&(this.color=be(y));var m=Be(i,"metrics",!1);return m?this.metrics={ascent:Be(m,"ascent",0),descent:Be(m,"descent",0),fontSize:Be(m,"fontSize",0)}:(e||!this.metrics)&&(this.metrics=ea(this)),e?this.parent.updateText():this.parent}syncFont(i,e){e.font=this._font}syncStyle(i,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(i,e){e?(i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY,i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur):(i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowColor=0,i.shadowBlur=0)}update(i){return i&&(this._font=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim(),this.metrics=ea(this)),this.parent.updateText(i)}buildFont(){var i=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim();return i!==this._font&&(this._font=i),this}setFont(i){return typeof i=="string"?(this.fontFamily=i,this.fontSize="",this.fontStyle=""):(this.fontFamily=Be(i,"fontFamily","Courier"),this.fontSize=Be(i,"fontSize","16px"),this.fontStyle=Be(i,"fontStyle","")),this.update(!0)}setFontFamily(i){return this.fontFamily=i,this.update(!0)}setFontStyle(i){return this.fontStyle=i,this.update(!0)}setFontSize(i){return typeof i=="number"&&(i=i.toString()+"px"),this.fontSize=i,this.update(!0)}setTestString(i){return this.testString=i,this.update(!0)}setFixedSize(i,e){return this.fixedWidth=i,this.fixedHeight=e,i&&(this.parent.width=i),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}setResolution(i){return this.resolution=i,this.update(!1)}setXOffset(i){return this.xOffset=i,this.update(!1)}setBackgroundColor(i,e,s){return s===void 0&&(s=!0),this.backgroundColor=be(i,this.parent.canvas,this.parent.context),this.backgroundColor2=be(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=s,this.update(!1)}setBackgroundStrokeColor(i,e){return this.backgroundStrokeColor=be(i,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}setBackgroundCornerRadius(i,e){return this.backgroundCornerRadius=i,this.backgroundCornerIteration=e,this.update(!1)}setFill(i){return this.color=be(i,this.parent.canvas,this.parent.context),this.update(!1)}setColor(i){return this.color=be(i,this.parent.canvas,this.parent.context),this.update(!1)}setStroke(i,e){return i===void 0?this.strokeThickness=0:(e===void 0&&(e=this.strokeThickness),this.stroke=be(i,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}setShadow(i,e,s,r,n,a){return i===void 0&&(i=0),e===void 0&&(e=0),s===void 0&&(s="#000"),r===void 0&&(r=0),n===void 0&&(n=!1),a===void 0&&(a=!0),this.shadowOffsetX=i,this.shadowOffsetY=e,this.shadowColor=be(s,this.parent.canvas,this.parent.context),this.shadowBlur=r,this.shadowStroke=n,this.shadowFill=a,this.update(!1)}setShadowOffset(i,e){return i===void 0&&(i=0),e===void 0&&(e=i),this.shadowOffsetX=i,this.shadowOffsetY=e,this.update(!1)}setShadowColor(i){return i===void 0&&(i="#000"),this.shadowColor=be(i,this.parent.canvas,this.parent.context),this.update(!1)}setShadowBlur(i){return i===void 0&&(i=0),this.shadowBlur=i,this.update(!1)}setShadowStroke(i){return this.shadowStroke=i,this.update(!1)}setShadowFill(i){return this.shadowFill=i,this.update(!1)}setUnderline(i,e,s){return i===void 0&&(i="#000"),e===void 0&&(e=0),s===void 0&&(s=0),this.underlineColor=be(i,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=s,this.update(!1)}setUnderlineColor(i){return i===void 0&&(i="#000"),this.underlineColor=be(i,this.parent.canvas,this.parent.context),this.update(!1)}setUnderlineThickness(i){return i===void 0&&(i=0),this.underlineThickness=i,this.update(!1)}setUnderlineOffset(i){return i===void 0&&(i=0),this.underlineOffset=i,this.update(!1)}setStrikethrough(i,e,s){return i===void 0&&(i="#000"),e===void 0&&(e=0),s===void 0&&(s=0),this.strikethroughColor=be(i,this.parent.canvas,this.parent.context),this.strikethroughThickness=e,this.strikethroughOffset=s,this.update(!1)}setStrikethroughColor(i){return i===void 0&&(i="#000"),this.strikethroughColor=be(i,this.parent.canvas,this.parent.context),this.update(!1)}setStrikethroughThickness(i){return i===void 0&&(i=0),this.strikethroughThickness=i,this.update(!1)}setStrikethroughOffset(i){return i===void 0&&(i=0),this.strikethroughOffset=i,this.update(!1)}setWrapMode(i){return typeof i=="string"&&(i=ta[i.toLowerCase()]||0),this.wrapMode=i,this.update(!0)}setWrapWidth(i){return this.wrapWidth=i,this.update(!1)}setAlign(i,e){return i===void 0&&(i="left"),e===void 0&&(e="top"),this.halign=i,this.valign=e,this.update(!1)}setHAlign(i){return i===void 0&&(i="left"),this.halign=i,this.update(!1)}setVAlign(i){return i===void 0&&(i="top"),this.valign=i,this.update(!1)}setMaxLines(i){return i===void 0&&(i=0),this.maxLines=i,this.update(!1)}getTextMetrics(){var i=this.metrics;return{ascent:i.ascent,descent:i.descent,fontSize:i.fontSize}}setTextMetrics(i,e){return this.metrics.ascent=i.ascent,this.metrics.descent=i.descent,this.metrics.fontSize=i.fontSize,e&&(typeof e=="string"?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=Be(e,"fontFamily",this.fontFamily),this.fontSize=Be(e,"fontSize",this.fontSize),this.fontStyle=Be(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}get lineHeight(){return this.metrics.fontSize+this.parent.lineSpacing}toJSON(){var i={},e=this.propertyMap;for(var s in e)i[s]=this[s];return i.metrics=this.getTextMetrics(),i}destroy(){this.parent=void 0}}var Kh=function(t){return t==null?t="":Array.isArray(t)?t=t.join(`
`):typeof t=="number"&&(t=t.toString()),t};const yt=Phaser.Utils.Objects.GetValue;class Qh{constructor(i,e,s,r,n){i===void 0&&(i=0),e===void 0&&(e=i),s===void 0&&(s=0),r===void 0&&(r=0),n===void 0&&(n=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(i,e,s,r,n)}setTo(i,e,s,r,n){return this.setPosition(i,e),this.setRadius(n),this.setSize(s,r),this}setPosition(i,e){return this.x=i,this.y=e,this}setRadius(i){return i===void 0&&(i=0),this.radius=i,this}setSize(i,e){return this.width=i,this.height=e,this}get minWidth(){var i=this.cornerRadius;return Math.max(i.tl.x+i.tr.x,i.bl.x+i.br.x)}get minHeight(){var i=this.cornerRadius;return Math.max(i.tl.y+i.bl.y,i.tr.y+i.br.y)}get width(){return this._width}set width(i){i==null&&(i=0),this._width=Math.max(i,this.minWidth)}get height(){return this._height}set height(i){i==null&&(i=0),this._height=Math.max(i,this.minHeight)}get radius(){var i=this.cornerRadius;return Math.max(i.tl.x,i.tl.y,i.tr.x,i.tr.y,i.bl.x,i.bl.y,i.br.x,i.br.y)}set radius(i){var e,s;typeof i=="number"?(e=i,s=i):(e=yt(i,"x",0),s=yt(i,"y",0));var r=this.cornerRadius;r.tl=Ti(yt(i,"tl",void 0),e,s),r.tr=Ti(yt(i,"tr",void 0),e,s),r.bl=Ti(yt(i,"bl",void 0),e,s),r.br=Ti(yt(i,"br",void 0),e,s)}get radiusTL(){var i=this.cornerRadius.tl;return Math.max(i.x,i.y)}set radiusTL(i){Pi(this.cornerRadius.tl,i)}get radiusTR(){var i=this.cornerRadius.tr;return Math.max(i.x,i.y)}set radiusTR(i){Pi(this.cornerRadius.tr,i)}get radiusBL(){var i=this.cornerRadius.bl;return Math.max(i.x,i.y)}set radiusBL(i){Pi(this.cornerRadius.bl,i)}get radiusBR(){var i=this.cornerRadius.br;return Math.max(i.x,i.y)}set radiusBR(i){Pi(this.cornerRadius.br,i)}}var Ti=function(t,i,e){return t===void 0?t={x:i,y:e}:typeof t=="number"&&(t={x:t,y:t}),xl(t),t},Pi=function(t,i){typeof i=="number"?(t.x=i,t.y=i):(t.x=yt(i,"x",0),t.y=yt(i,"y",0)),xl(t)},xl=function(t){t.convex=t.x>=0||t.y>=0,t.x=Math.abs(t.x),t.y=Math.abs(t.y)};const ia=Phaser.Math.DegToRad;var Jh=function(t,i,e,s,r,n,a){var o=new Qh(i,e,s,r,n),l=o.minWidth,h=o.minHeight,u=s>=l?1:s/l,c=r>=h?1:r/h,p=o.cornerRadius,g,v,y,m,w,k,x;t.save(),t.beginPath(),t.translate(i,e),g=p.tl,Ai(g)?(v=g.x*u,y=g.y*c,Ci(g)?(m=v,w=y,dt(t,m,w,v,y,180,270,!1,a)):(m=0,w=0,dt(t,m,w,v,y,90,0,!0,a)),k=0,x=y):(t.lineTo(0,0),k=0,x=0),g=p.tr,Ai(g)?(v=g.x*u,y=g.y*c,Ci(g)?(m=s-v,w=y,dt(t,m,w,v,y,270,360,!1,a)):(m=s,w=0,dt(t,m,w,v,y,180,90,!0,a))):t.lineTo(s,0),g=p.br,Ai(g)?(v=g.x*u,y=g.y*c,Ci(g)?(m=s-v,w=r-y,dt(t,m,w,v,y,0,90,!1,a)):(m=s,w=r,dt(t,m,w,v,y,270,180,!0,a))):t.lineTo(s,r),g=p.bl,Ai(g)?(v=g.x*u,y=g.y*c,Ci(g)?(m=v,w=r-y,dt(t,m,w,v,y,90,180,!1,a)):(m=0,w=r,dt(t,m,w,v,y,360,270,!0,a))):t.lineTo(0,r),t.lineTo(k,x),t.closePath(),t.restore()},Ci=function(t){return!t.hasOwnProperty("convex")||t.convex},Ai=function(t){return t.x>0&&t.y>0},dt=function(t,i,e,s,r,n,a,o,l){if(o&&a>n?a-=360:!o&&a<n&&(a+=360),n=ia(n),a=ia(a),l==null)t.ellipse(i,e,s,r,0,n,a,o);else{l+=1;for(var h,u,c,p=(a-n)/l,g=0;g<=l;g++)c=n+p*g,h=i+s*Math.cos(c),u=e+r*Math.sin(c),t.lineTo(h,u)}},Zh=function(t,i,e,s,r,n,a,o,l,h,u,c,p){if(Jh(i,e,s,r,n,a,p),o!=null){if(u!=null){var g;c?g=i.createLinearGradient(0,0,r,0):g=i.createLinearGradient(0,0,0,n),g.addColorStop(0,o),g.addColorStop(1,u),o=g}i.fillStyle=o,i.fill()}l!=null&&h>0&&(i.strokeStyle=l,i.lineWidth=h,i.stroke())},ec=function(t,i,e,s,r,n,a,o){if(!(i==null&&e==null)){var l=t.canvas.width,h=t.canvas.height;e==null&&(s=0);var u=s/2;l=Math.max(1,l-s),h=Math.max(1,h-s),Zh(t.canvas,t.context,u,u,l,h,r,i,e,s,n,a,o)}};const tc={draw(t,i,e,s){var r=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save();var a=this.defaultStyle;this.clear(),ec(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,i+=this.startYOffset;var o=a.halign,l=a.valign,h,u=a.lineHeight,c=r.lines,p=c.length,g=a.maxLines,v,y,m;g>0&&p>g?(v=g,l==="center"?y=Math.floor((p-v)/2):l==="bottom"?y=p-v:y=0):(v=p,y=0),m=y+v;var w,k,x=this.rtl,T=x?this.parent.width:void 0;l==="center"?k=Math.max((s-v*u)/2,0):l==="bottom"?k=Math.max(s-v*u-2,0):k=0,k+=i;for(var A=y;A<m;A++)if(h=r.getLineWidth(A),h!==0){for(var F=c[A],K=F.length,N=o,M=0;M<K;M++){var Y=F[M].prop.align;if(Y!==void 0){N=Y;break}}N==="center"?w=(e-h)/2:N==="right"?w=x?0:e-h:w=x?e-h:0,w+=t;for(var M=0;M<K;M++)this.drawPen(F[M],w,k,T)}n.restore()},drawPen(t,i,e,s){i+=t.x,e+=t.y+(t.prop.y||0),s!==void 0&&(i=s-i);var r=this.canvas,n=this.context;n.save();var a=this.parser.propToContextStyle(this.defaultStyle,t.prop);if(a.bgcolor!==null&&t.width>0){var o=this.defaultStyle.metrics,l=e-o.ascent,h=o.fontSize;this.drawRectangle(i,l,t.width,h,a.bgcolor,a)}if(a.underlineThickness>0&&t.width>0){var u=e+a.underlineOffset-a.underlineThickness/2;this.drawLine(i,u,t.width,a.underlineThickness,a.underlineColor,a)}if(t.isTextPen&&(a.buildFont(),a.syncFont(r,n),a.syncStyle(r,n),this.drawText(i,e,t.text,a)),t.isImagePen&&this.drawImage(i,e,t.prop.img,t.prop.color,a),a.strikethroughThickness>0&&t.width>0){var u=e+a.strikethroughOffset-a.strikethroughThickness/2;this.drawLine(i,u,t.width,a.strikethroughThickness,a.strikethroughColor,a)}if(n.restore(),t.hasAreaMarker&&t.width>0){var c,p=t.prop.area;if(p)c={key:p};else{var g=t.prop.url;c={key:`url:${g}`,url:g}}this.hitAreaManager.add(i,e-this.startYOffset,t.width,this.defaultStyle.lineHeight,c)}},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawRectangle(t,i,e,s,r,n){this.autoRound&&(t=Math.round(t),i=Math.round(i));var a=this.context;a.fillStyle=r,a.fillRect(t,i,e,s)},drawLine(t,i,e,s,r,n){this.autoRound&&(t=Math.round(t),i=Math.round(i));var a=this.context;n.syncShadow(a,n.shadowStroke);var o=a.lineCap;a.lineCap="butt",a.strokeStyle=r,a.lineWidth=s,a.beginPath(),a.moveTo(t,i),a.lineTo(t+e,i),a.stroke(),a.lineCap=o},drawText(t,i,e,s){this.autoRound&&(t=Math.round(t),i=Math.round(i));var r=this.context;s.stroke&&s.stroke!=="none"&&s.strokeThickness>0&&(s.syncShadow(r,s.shadowStroke),r.strokeText(e,t,i)),s.color&&s.color!=="none"&&(s.syncShadow(r,s.shadowFill),r.fillText(e,t,i))},drawImage(t,i,e,s,r){i-=this.startYOffset,this.parent.imageManager.draw(e,this.context,t,i,s,this.autoRound)}},Pt=Phaser.Utils.Objects.GetValue,ic=Se.NO_NEWLINE,sa=Se.RAW_NEWLINE;class sc{constructor(i){this.prop={},this.resetFromJSON(i)}resetFromJSON(i){this.text=Pt(i,"text",""),this.x=Pt(i,"x",0),this.y=Pt(i,"y",0),this.width=Pt(i,"width",0);var e=Pt(i,"prop",null);e===null&&(e={}),this.prop=e,this.newLineMode=Pt(i,"newLineMode",0),this.startIndex=Pt(i,"startIndex",0)}get plainText(){var i=this.text;return this.newLineMode===sa&&(i+=`
`),i}get wrapText(){var i=this.text;return this.newLineMode!==ic&&(i+=`
`),i}get rawTextLength(){var i=this.text.length;return this.newLineMode===sa&&(i+=1),i}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return this.text!==""}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area||!!this.prop.url}}var rc=function(t){if(typeof t!="object"||t===null)return t;if(Array.isArray(t))t.length=0;else for(var i in t)delete t[i];return t},Ki=function(t,i){var e=Array.isArray(t);if(i===void 0?i=e?[]:{}:rc(i),e){i.length=t.length;for(var s=0,r=t.length;s<r;s++)i[s]=t[s]}else for(var n in t)i[n]=t[n];return i},nc=function(){};const ra=Phaser.Utils.Objects.GetFastValue,na=Se.NO_NEWLINE,ac=Se.WRAPPED_NEWLINE;class yn{constructor(i){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=i.pensPool,this.linesPool=i.linesPool,this.tagToText=ra(i,"tagToText",nc),this.tagToTextScope=ra(i,"tagToTextScope",void 0)}destroy(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}clear(){for(var i=0,e=this.lines.length;i<e;i++)this.lines[i].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(i,e,s,r,n,a){var o=this.pensPool.pop();return o==null&&(o=new sc),Ct.text=i,Ct.x=e,Ct.y=s,Ct.width=r,Ct.prop=n,Ct.newLineMode=a,o.resetFromJSON(Ct),this.addPen(o),this}addImagePen(i,e,s,r){return this.addTextPen("",i,e,s,r,na),this}addNewLinePen(){var i=this.lastPen,e=i?i.lastX:0,s=i?i.y:0,r=i?Ki(i.prop):null;return this.addTextPen("",e,s,0,r,ac),this}addPen(i){var e=this.lastPen;e==null?i.startIndex=0:i.startIndex=e.endIndex,this.pens.push(i);var s=this.lastLine;s==null&&(s=this.linesPool.pop()||[],this.lines.push(s)),s.push(i),i.newLineMode!==na&&(s=this.linesPool.pop()||[],this.lines.push(s)),this.maxLinesWidth=void 0}clone(i){i==null&&(i=new yn),i.clear();for(var e=0,s=this.lines.length;e<s;e++)for(var r=this.lines[e],n=0,a=r.length;n<a;n++){var o=r[n];i.addPen(o.text,o.x,o.y,o.width,Ki(o.prop),o.newLineMode)}return i}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(i){if(i>=this.lines.length)return this.getLineEndIndex(i);var e=this.lines[i];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(i){i>=this.lines.length&&(i=this.lines.length-1);var e,s=!1,r;for(e=i;e>=0&&(r=this.lines[e],s=r!=null&&r.length>0,!s);e--);if(!s)return 0;var n=r[r.length-1];return n.endIndex}getLineWidth(i){var e=this.lines[i];if(!e)return 0;var s=e[e.length-1];if(s==null)return 0;var r=s.lastX;return r}getMaxLineWidth(){if(this.maxLinesWidth!==void 0)return this.maxLinesWidth;for(var i,e=0,s=0,r=this.lines.length;s<r;s++)i=this.getLineWidth(s),i>e&&(e=i);return this.maxLinesWidth=e,e}getLineWidths(){for(var i=[],e=0,s=this.lines.length;e<s;e++)i.push(this.getLineWidth(e));return i}get linesCount(){return this.lines.length}get plainText(){for(var i="",e=this.pens,s=0,r=e.length;s<r;s++)i+=e[s].plainText;return i}get rawTextLength(){for(var i=0,e=this.pens,s=0,r=this.pens.length;s<r;s++)i+=e[s].rawTextLength;return i}getSliceTagText(i,e,s){var r=this.lastPen;if(r==null)return"";var n=r.endIndex;(i===void 0||i===0)&&(i=-1),(e===void 0||e===n)&&(e=n+1),s===void 0&&(s=!1);for(var a="",o,l,h,u,c,p,g,v=0,y=this.pens.length;v<y&&(o=this.pens[v],u=o.endIndex,!(!(u<=i)&&(o=this.pens[v],l=s?o.wrapText:o.plainText,p=o.prop,h=o.startIndex,c=h>=i&&u<=e,c||(l=l.substring(i-h,e-h)),this.tagToTextScope?a+=this.tagToText.call(this.tagToTextScope,l,p,g):a+=this.tagToText(l,p,g),g=p,u>=e)));v++);return a}get length(){return this.lines.length}set length(i){this.clear()}}var Ct={};class Yt{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(i){return this.items.push(i),this}pushMultiple(i){return this.items.push.apply(this.items,i),i.length=0,this}clear(){return this.items.length=0,this}}const oc=Phaser.Geom.Rectangle;var aa=new Yt;class lc{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){for(var i=0,e=this.hitAreas.length;i<e;i++)this.hitAreas[i].data=null;return aa.pushMultiple(this.hitAreas),this}add(i,e,s,r,n){n===void 0&&(n={});var a=aa.pop();return a===null?a=new oc(i,e,s,r):a.setTo(i,e,s,r),a.data=n,this.hitAreas.push(a),this}getFirst(i,e){for(var s=0,r=this.hitAreas.length;s<r;s++){var n=this.hitAreas[s];if(n.contains(i,e))return n}return null}getByKey(i){for(var e=0,s=this.hitAreas.length;e<s;e++){var r=this.hitAreas[e];if(r.data.key===i)return r}return null}drawBounds(i,e,s){e===void 0&&(e=16777215),s&&i.save().scaleCanvas(s.scaleX,s.scaleY).rotateCanvas(s.rotation).translateCanvas(s.x,s.y);for(var r=0,n=this.hitAreas.length;r<n;r++){var a=this.hitAreas[r];i.lineStyle(1,e).strokeRect(a.x,a.y,a.width,a.height)}return s&&i.restore(),this}}var hc=function(){this.parent.on("pointerdown",cc,this).on("pointerup",uc,this).on("pointermove",Ts,this).on("pointerover",Ts,this).on("pointerout",function(t,i){Ts.call(this,t,null,null,i)},this)},cc=function(t,i,e,s){var r=this.hitAreaManager.getFirst(i,e);if(r!==null){var n=r.data.key;Jt.call(this,"areadown",n,t,i,e,s),r.data&&(r.data.isDown=!0)}},uc=function(t,i,e,s){var r=this.hitAreaManager.getFirst(i,e);if(r!==null){var n=r.data.key;if(Jt.call(this,"areaup",n,t,i,e,s),!!r.data){if(r.data.isDown){if(Jt.call(this,"areaclick",n,t,i,e,s),!r.data)return;var a=r.data.url;a&&window.open(a,"_blank")}r.data.isDown=!1}}},Ts=function(t,i,e,s){if(i===null){if(this.lastHitAreaKey!==null){Jt.call(this,"areaout",this.lastHitAreaKey,t,i,e,s);var r=this.hitAreaManager.getByKey(this.lastHitAreaKey);r&&r.data&&(r.data.isDown=!1),this.lastHitAreaKey=null}return}var r=this.hitAreaManager.getFirst(i,e),n=r?r.data.key:null;if(this.lastHitAreaKey!==n){if(this.lastHitAreaKey!==null){Jt.call(this,"areaout",this.lastHitAreaKey,t,i,e,s);var a=this.hitAreaManager.getByKey(this.lastHitAreaKey);a&&(this.urlTagCursorStyle&&oa(this.scene,a,""),a.data.isDown=!1)}n!==null&&(Jt.call(this,"areaover",n,t,i,e,s),r.data&&this.urlTagCursorStyle&&oa(this.scene,r,this.urlTagCursorStyle)),this.lastHitAreaKey=n}},Jt=function(t,i,e,s,r,n){this.parent.emit(`${t}-${i}`,e,s,r,n),this.parent.emit(t,i,e,s,r,n)},oa=function(t,i,e){!i||!i.data||!i.data.url||(t.input.manager.canvas.style.cursor=e)},dc=/^[\x00-\x7F]+$/,la=function(t){return dc.test(t)};const fc=Se.NO_NEWLINE,pc=Se.RAW_NEWLINE,Ps=Se.WRAPPED_NEWLINE,ha=Se.NO_WRAP,gc=Se.WORD_WRAP,kl=Se.CHAR_WRAP,yc=Se.SPLITREGEXP;var El=function(t,i,e,s,r,n){s<=0&&(e=ha);var a=[];if(!t||!t.length)return a;for(var o=e===ha,l=t.split(yc),h,u,c,p=0,g=l.length;p<g;p++){if(h=l[p],c=p===g-1?fc:pc,o){var v=i.measureText(h).width;a.push(n.getLine(h,v,c));continue}if(u=p===0?s-r:s,h.length<=100){var v=i.measureText(h).width;if(v<=u){a.push(n.getLine(h,v,c));continue}}for(var y=mc(h,e),m,w,k="",x=0,T,A=0,F=y.length;A<F;A++){if(m=y[A],w=i.measureText(m).width,w>s&&vc(m)){k!==""?a.push(n.getLine(k,x,Ps)):A===0&&r>0&&a.push(n.getLine("",0,Ps)),a.push(...El(m,i,kl,s,0,n));var K=a.pop();k=K.text,x=K.width,n.freeLine(K),k===" "&&(k="",x=0);continue}T=x+w,T>u?(a.push(n.getLine(k,x,Ps)),k=m,x=w,u=s):(k+=m,x=T),A===F-1&&a.push(n.getLine(k,x,c))}}return a},mc=function(t,i){var e;switch(i){case gc:e=[],t=t.split(" ");for(var s=0,r=t.length;s<r;s++){var n=t[s];s<r-1?e.push(n+" "):n!==""&&e.push(n)}break;case kl:e=t.split("");break;default:e=[],t=t.split(" ");for(var s=0,r=t.length;s<r;s++){var n=t[s];s<r-1?la(n)?e.push(n+" "):(e.push(...n.split("")),e.push(" ")):n!==""&&(la(n)?e.push(n):e.push(...n.split("")))}break}return e},vc=function(t){switch(t.length){case 1:return!1;case 2:return t.charAt(1)!==" ";default:return!0}};const Cs=Phaser.Utils.Objects.GetValue,bc=Se.NO_WRAP,ca=Se.NO_NEWLINE,wc=Se.WRAPPED_NEWLINE;class Ol{constructor(i){this.parent=i.parent,this.scene=this.parent.scene,this.context=Cs(i,"context",null),this.canvas=this.context.canvas,this.parser=Cs(i,"parser",null),this.defaultStyle=Cs(i,"style",null),this.autoRound=!0,this.pensPool=i.pensPool,this.linesPool=i.linesPool,this.wrapTextLinesPool=i.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new lc,this.lastHitAreaKey=null,this.urlTagCursorStyle=null}destroy(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0}updatePenManager(i,e,s,r,n){if(n===void 0&&(n=this.penManager),n.clear(),i==="")return n;var a=this.parent.style;if(a.isWrapFitMode){var o=this.parent.padding;s=a.fixedWidth-o.left-o.right}for(var l=this.canvas,h=this.context,u=0,c=0,p=a.wrapCallback,g=a.wrapCallbackScope,v=!0,y,m,w,k=this.parser.splitText(i),x,T,A=this.wrapTextLinesPool,F=0,K=k.length;F<K;F++)if(x=this.parser.tagTextToProp(k[F],m),y=x.plainText,m=x.prop,m.img){var N=this.imageManager.getOuterWidth(m.img);s>0&&e!==bc&&s<u+N&&(n.addNewLinePen(),c+=r,u=0),n.addImagePen(u,c,N,Ki(m)),u+=N}else if(y!==""){if(h.save(),w=this.parser.propToContextStyle(this.defaultStyle,m),w.buildFont(),w.syncFont(l,h),w.syncStyle(l,h),!p)T=El(y,h,e,s,u,A);else{T=p.call(g,y,h,s,u),typeof T=="string"&&(T=T.split(`
`));for(var Q,M=0,Y=T.length;M<Y;M++)Q=T[M],typeof Q=="string"?T[M]=A.getLine(Q,h.measureText(Q).width,M<Y-1?wc:ca):v=!1}for(var Q,M=0,Y=T.length;M<Y;M++)Q=T[M],n.addTextPen(Q.text,u,c,Q.width,Ki(m),Q.newLineMode),Q.newLineMode!==ca?(u=0,c+=r):u+=Q.width;v&&A.freeLines(T),T=null,h.restore()}for(var F=0,K=this.lines.length;F<K;F++){var ae=this.lines[F],ne=ae[ae.length-1];ne&&(ne.width+=this.parser.getStrokeThinkness(this.defaultStyle,ne.prop))}return n}get startXOffset(){return this.defaultStyle.xOffset}get startYOffset(){return this.defaultStyle.metrics.ascent}get lines(){return this.penManager.lines}get displayLinesCount(){var i=this.penManager.linesCount,e=this.defaultStyle.maxLines;return e>0&&i>e&&(i=e),i}get linesWidth(){return Math.ceil(this.penManager.getMaxLineWidth())}get linesHeight(){var i=this.displayLinesCount,e=this.defaultStyle.lineHeight*i;return i>0&&(e-=this.defaultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}get rtl(){return this.parent.style.rtl}newPenManager(){return new yn({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return this._tmpPenManager===null&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(i,e,s){var r;if(i==null)r=this.penManager.plainText;else{var n=this.parser.splitText(i,1);r="";for(var a=0,o=n.length;a<o;a++)r+=n[a]}return(e!=null||s!=null)&&(e==null&&(e=0),s==null&&(s=r.length),r=r.substring(e,s)),r}getPenManager(i,e){if(i===void 0)return this.copyPenManager(e,this.penManager);e===void 0&&(e=this.newPenManager());var s=this.defaultStyle;return this.updatePenManager(i,s.wrapMode,s.wrapWidth,s.lineHeight,e),e}getText(i,e,s,r){if(i==null)return this.penManager.getSliceTagText(e,s,r);var n=this.tmpPenManager,a=this.defaultStyle;return this.updatePenManager(i,a.wrapMode,a.wrapWidth,a.lineHeight,n),n.getSliceTagText(e,s,r)}copyPenManager(i,e){return e===void 0&&(e=this.penManager),e.copy(i)}getTextWidth(i){return i===void 0&&(i=this.penManager),i.getMaxLineWidth()}getLastPen(i){return i===void 0&&(i=this.penManager),i.lastPen}}var Sc={setInteractive:hc};Object.assign(Ol.prototype,tc,Sc);class ua extends Yt{freeLine(i){if(i)return this.push(i),this}freeLines(i){if(i)return this.pushMultiple(i),this}getLine(i,e,s){var r=this.pop();return r===null&&(r={}),r.text=i,r.width=e,r.newLineMode=s,r}}const xc=Phaser.Utils.Objects.IsPlainObject,Wt=Phaser.Utils.Objects.GetValue;var As=function(t,i){xc(t)?(i=t,t=i.key):i===void 0&&(i={key:t}),i.hasOwnProperty("key")||(i.key=t);var e=i.key,s=i.frame,r=i.width,n=i.height;if(r===void 0||n===void 0){var a=this.textureManager.getFrame(e,s),o=a?a.cutWidth:0,l=a?a.cutHeight:0;r===void 0&&n===void 0?(r=o,n=l):r===void 0?r=o*(n/l):n===void 0&&(n=l*(r/o))}this.images[t]={key:e,frame:s,width:r,height:n,y:Wt(i,"y",0),left:Wt(i,"left",0),right:Wt(i,"right",0),originX:Wt(i,"originX",0),originY:Wt(i,"originY",0),tintFill:Wt(i,"tintFill",!1)}};const da=Phaser.Display.Canvas.CanvasPool;var kc=function(t,i,e,s,r,n,a,o){e===void 0&&(e=0),s===void 0&&(s=0),r===void 0&&(r=t.cutWidth),n===void 0&&(n=t.cutHeight),o===void 0&&(o=!1),o&&(e=Math.round(e),s=Math.round(s));var l=i.getContext("2d",{willReadFrequently:!0});if(a){var h=da.create(null,r,n,Phaser.CANVAS,!0),u=h.getContext("2d",{willReadFrequently:!0});u.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,0,0,r,n),u.globalCompositeOperation="source-in",u.fillStyle=a,u.fillRect(0,0,r,n),l.drawImage(h,0,0,r,n,e,s,r,n),da.remove(h)}else l.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,e,s,r,n)},Ec=function(t,i,e,s,r,n){var a=this.get(t);if(a){var o=this.textureManager.getFrame(a.key,a.frame),l=a.width,h=a.height;e+=a.left-a.originX*l,s+=a.y-a.originY*h,a.tintFill||(r=void 0),kc(o,i.canvas,e,s,l,h,r,n)}};class Il{constructor(i){this.textureManager=i.sys.textures,this.images={}}destroy(){this.textureManager=void 0,this.images=void 0}add(i,e){if(typeof i=="string")As.call(this,i,e);else if(Array.isArray(i))for(var s=i,r=0,n=s.length;r<n;r++)As.call(this,s[r]);else{var s=i;for(var i in s)As.call(this,i,s[i])}return this}has(i){return this.images.hasOwnProperty(i)}remove(i){return this.has(i)&&delete this.images[i],this}get(i){return this.has(i)||this.textureManager.exists(i)&&this.add(i),this.images[i]}getOuterWidth(i){var e=this.get(i);return e?e.width+e.left+e.right:0}getFrame(i){var e=this.get(i);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(i){return!!this.getFrame(i)}}var Oc={draw:Ec};Object.assign(Il.prototype,Oc);var Ic=function(t,i,e,s,r,n,a){var o=t.sys.textures,l=t.renderer;s===void 0&&(s=0),r===void 0&&(r=0),n===void 0&&(n=i.width),a===void 0&&(a=i.height);var h;o.exists(e)?h=o.get(e):h=o.createCanvas(e,n,a);var u=h.getSourceImage();u.width!==n&&(u.width=n),u.height!==a&&(u.height=a);var c=u.getContext("2d",{willReadFrequently:!0});c.clearRect(0,0,n,a),c.drawImage(i,s,r,n,a),l.gl&&h&&l.canvasToTexture(u,h.source[0].glTexture,!0,0)},Tc=function(t,i){!t&&t!==0&&(t=""),i===void 0&&(i=!0),Array.isArray(t)&&(t=t.join(`
`));var e;return i?e=`${this.text}
${t}`:e=`${this.text}${t}`,e!=this.text&&this.setText(e),this};const Pc=Phaser.Utils.Objects.IsPlainObject,fa=Phaser.DOM.AddToDOM,pa=Phaser.Display.Canvas.CanvasPool,Cc=Phaser.GameObjects.GameObject,Me=Phaser.Utils.Objects.GetValue,Ac=Phaser.DOM.RemoveFromDOM,Rc=Se.SPLITREGEXP,Mc=Phaser.Utils.String.UUID;var Gt=null,Rs=null,Ms=null;class Tl extends wl{constructor(i,e,s,r,n,a,o){if(Pc(e)){var l=e;e=Me(l,"x",0),s=Me(l,"y",0),r=Me(l,"text",""),n=Me(l,"style")}if(e===void 0&&(e=0),s===void 0&&(s=0),super(i,a),this.renderer=i.sys.game.renderer,this.setPosition(e,s),this.setOrigin(0,0),this.initPipeline(),this.initPostPipeline(!0),this.canvas=pa.create(this),this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this._imageManager=void 0,n){if(n.hasOwnProperty("align")){var h=n.align;delete n.align,n.halign=h}n.hasOwnProperty("stroke")&&!n.hasOwnProperty("strokeThickness")&&(n.strokeThickness=1)}this.style=new Sl(this,n);var u=Me(n,"images",void 0);u&&this.addImage(u),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,this.style.resolution===0&&(this.style.resolution=1),this._crop=this.resetCropObject(),this._textureKey=Mc(),this.texture=i.sys.textures.addCanvas(this._textureKey,this.canvas),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null);var c=Me(n,"sharedPool",!0),p,g,v;c?(Gt||(Gt={},Rs=new Yt,Ms=new ua,this.scene.game.events.once("destroy",function(){Gt=null,Rs=null,Ms=null})),Gt.hasOwnProperty(a)||(Gt[a]=new Yt),p=Gt[a],g=Rs,v=Ms):(p=new Yt,g=new Yt,v=new ua),this.canvasText=new Ol({parent:this,context:this.context,parser:o,style:this.style,pensPool:p,linesPool:g,wrapTextLinesPool:v}),this.parser=o,this.initRTL(),n&&n.padding&&this.setPadding(n.padding),this.setText(r),this.setUrlTagCursorStyle(Me(n,"urlTagCursorStyle","pointer")),Me(n,"interactive",!1)&&this.setInteractive()}preDestroy(){Ac(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),pa.remove(this.canvas);var i=this.texture;i&&i.destroy()}set text(i){this.setText(i)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",fa(this.canvas,this.scene.sys.canvas),this.originX=1)}setRTL(i){i===void 0&&(i=!0);var e=this.style;if(e.rtl===i)return this;if(e.rtl=i,i?(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",fa(this.canvas,this.scene.sys.canvas)):(this.canvas.dir="ltr",this.context.direction="ltr"),e.halign==="left"?e.halign="right":e.halign==="right"&&(e.halign="left"),this._imageManager){var s=this._imageManager.images;for(var r in s)s[r].originX=1-s[r].originX}return this}setText(i){return i=Kh(i),i===this._text?this:(this._text=i,this.updateText(),this)}setPadding(i,e,s,r){if(typeof i=="object"){var n=i,a=Me(n,"x",null);a!==null?(i=a,s=a):(i=Me(n,"left",0),s=Me(n,"right",i));var o=Me(n,"y",null);o!==null?(e=o,r=o):(e=Me(n,"top",0),r=Me(n,"bottom",e))}else i===void 0&&(i=0),e===void 0&&(e=i),s===void 0&&(s=i),r===void 0&&(r=e);return this.padding.left=i,this.padding.top=e,this.padding.right=s,this.padding.bottom=r,this.updateText(!1)}updateText(i){i===void 0&&(i=!0);var e=this.canvasText,s=this.style;i&&e.updatePenManager(this._text,s.wrapMode,s.wrapWidth,s.lineHeight);var r=this.padding,n,a,o=Math.ceil(e.linesWidth);s.fixedWidth===0?(this.width=o+r.left+r.right,n=o):(this.width=s.fixedWidth,n=this.width-r.left-r.right,n<o&&(n=o)),s.fixedHeight===0?(this.height=e.linesHeight+r.top+r.bottom,a=e.linesHeight):(this.height=s.fixedHeight,a=this.height-r.top-r.bottom,a<e.linesHeight&&(a=e.linesHeight));var l=this.width,h=this.height;this.updateDisplayOrigin();var u=s.resolution;l*=u,h*=u,l=Math.max(Math.ceil(l),1),h=Math.max(Math.ceil(h),1);var c=this.canvas,p=this.context;c.width!==l||c.height!==h?(c.width=l,c.height=h,this.frame.setSize(l,h)):p.clearRect(0,0,l,h),p.save(),p.scale(u,u);var g=this.style.rtl?r.right:r.left,v=r.top;e.draw(g,v,n,a),p.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(c,this.frame.source.glTexture,!0),this.frame.glTexture.spectorMetadata={textureKey:"BBCodeText Game Object"}),this.dirty=!0;var y=this.input;return y&&!y.customHitArea&&(y.hitArea.width=this.width,y.hitArea.height=this.height),this}toJSON(){var i=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return i.data=e,i}setInteractive(i,e,s){var r=!!this.input;return Cc.prototype.setInteractive.call(this,i,e,s),r||this.canvasText.setInteractive(),this}setUrlTagCursorStyle(i){return this.urlTagCursorStyle=i,this}get urlTagCursorStyle(){return this.canvasText.urlTagCursorStyle}set urlTagCursorStyle(i){this.canvasText.urlTagCursorStyle=i}getWrappedText(i,e,s){return typeof i=="number"&&(s=e,e=i,i=void 0),i=this.canvasText.getText(i,e,s,!0),i.split(Rc)}getPlainText(i,e,s){return typeof i=="number"&&(s=e,e=i,i=void 0),this.canvasText.getPlainText(i,e,s)}getText(i,e,s,r){return typeof i=="number"&&(r=s,s=e,e=i,i=void 0),r===void 0&&(r=!1),this.canvasText.getText(i,e,s,r)}getSubString(i,e,s){return typeof i=="number"&&(s=e,e=i,i=void 0),this.getText(i,e,s)}copyPenManager(i){return this.canvasText.copyPenManager(i)}getPenManager(i,e){return this.canvasText.getPenManager(i,e)}setSize(i,e){return this.setFixedSize(i,e)}resize(i,e){return this.setFixedSize(i,e)}get imageManager(){return this._imageManager||(this._imageManager=new Il(this.scene)),this._imageManager}addImage(i,e){return this.imageManager.add(i,e),this}drawAreaBounds(i,e){return this.canvasText.hitAreaManager.drawBounds(i,e,this),this}generateTexture(i,e,s,r,n){var a=this.canvas;return r===void 0?r=a.width:r*=this.resolution,n===void 0?n=a.height:n*=this.resolution,Ic(this.scene,a,i,e,s,r,n),this}}var _c={appendText:Tc};Object.assign(Tl.prototype,_c);var Dc=function(t,i){for(var e=this.tagRegex,s=[],r=0,n=!1,a=!1;;){var o=e.RE_SPLITTEXT.exec(t);if(!o)break;var l=o[0];if(a)if(e.RE_ESC_CLOSE.test(l))a=!1;else continue;else if(n)if(e.RE_RAW_CLOSE.test(l))n=!1;else continue;else e.RE_ESC_OPEN.test(l)?a=!0:e.RE_RAW_OPEN.test(l)&&(n=!0);var h=e.RE_SPLITTEXT.lastIndex,u=h-l.length;if(r<u){var c=t.substring(r,u);s.push(c)}i===void 0&&s.push(l),r=h}var p=t.length;return r<p&&s.push(t.substring(r,p)),s};const ye=!1,fe=!0;var Lc={plainText:null,prevProp:null},Bc=function(t,i){var e=this.tagRegex;i==null&&(i={});var s="";if(i.img&&H(i,ye,"img"),i.esc)e.RE_ESC_CLOSE.test(t)?H(i,ye,"esc"):s=t;else if(i.raw)e.RE_RAW_CLOSE.test(t)?H(i,ye,"raw"):s=t;else if(e.RE_ESC_OPEN.test(t))H(i,fe,"esc",!0);else if(e.RE_ESC_CLOSE.test(t))H(i,ye,"esc");else if(e.RE_RAW_OPEN.test(t))H(i,fe,"raw",!0);else if(e.RE_RAW_CLOSE.test(t))H(i,ye,"raw");else if(e.RE_BLOD_OPEN.test(t))H(i,fe,"b",!0);else if(e.RE_BLOD_CLOSE.test(t))H(i,ye,"b");else if(e.RE_ITALICS_OPEN.test(t))H(i,fe,"i",!0);else if(e.RE_ITALICS_CLOSE.test(t))H(i,ye,"i");else if(e.RE_WEIGHT_OPEN.test(t)){var r=t.match(e.RE_WEIGHT_OPEN);H(i,fe,"weight",r[1])}else if(e.RE_WEIGHT_CLOSE.test(t))H(i,ye,"weight");else if(e.RE_SIZE_OPEN.test(t)){var r=t.match(e.RE_SIZE_OPEN);H(i,fe,"size",`${r[1]}px`)}else if(e.RE_SIZE_CLOSE.test(t))H(i,ye,"size");else if(e.RE_FAMILY_OPEN.test(t)){var r=t.match(e.RE_FAMILY_OPEN);H(i,fe,"family",r[1])}else if(e.RE_FAMILY_CLOSE.test(t))H(i,ye,"family");else if(e.RE_COLOR_OPEN.test(t)){var r=t.match(e.RE_COLOR_OPEN);H(i,fe,"color",r[1])}else if(e.RE_COLOR_CLOSE.test(t))H(i,ye,"color");else if(e.RE_UNDERLINE_OPEN.test(t))H(i,fe,"u",!0);else if(e.RE_UNDERLINE_OPENC.test(t)){var r=t.match(e.RE_UNDERLINE_OPENC);H(i,fe,"u",r[1])}else if(e.RE_UNDERLINE_CLOSE.test(t))H(i,ye,"u");else if(e.RE_STRIKETHROUGH_OPEN.test(t))H(i,fe,"s",!0);else if(e.RE_STRIKETHROUGH_OPENC.test(t)){var r=t.match(e.RE_STRIKETHROUGH_OPENC);H(i,fe,"s",r[1])}else if(e.RE_STRIKETHROUGH_CLOSE.test(t))H(i,ye,"s");else if(e.RE_SHADOW_OPEN.test(t))H(i,fe,"shadow",!0);else if(e.RE_SHADOW_OPENC.test(t)){var r=t.match(e.RE_SHADOW_OPENC);H(i,fe,"shadow",r[1])}else if(e.RE_SHADOW_CLOSE.test(t))H(i,ye,"shadow");else if(e.RE_STROKE_OPEN.test(t))H(i,fe,"stroke",!0);else if(e.RE_STROKE_OPENC.test(t)){var r=t.match(e.RE_STROKE_OPENC);H(i,fe,"stroke",r[1])}else if(e.RE_STROKE_CLOSE.test(t))H(i,ye,"stroke");else if(e.RE_BGCOLOR_OPEN.test(t)){var r=t.match(e.RE_BGCOLOR_OPEN);H(i,fe,"bgcolor",r[1])}else if(e.RE_BGCOLOR_CLOSE.test(t))H(i,ye,"bgcolor");else if(e.RE_OFFSETY_OPEN.test(t)){var r=t.match(e.RE_OFFSETY_OPEN);H(i,fe,"y",parseFloat(r[1]))}else if(e.RE_OFFSETY_CLOSE.test(t))H(i,ye,"y");else if(e.RE_IMAGE_OPEN.test(t)){var r=t.match(e.RE_IMAGE_OPEN);H(i,fe,"img",r[1])}else if(e.RE_IMAGE_CLOSE.test(t))H(i,ye,"img");else if(e.RE_AREA_OPEN.test(t)){var r=t.match(e.RE_AREA_OPEN);H(i,fe,"area",r[1])}else if(e.RE_AREA_CLOSE.test(t))H(i,ye,"area");else if(e.RE_URL_OPEN.test(t)){var r=t.match(e.RE_URL_OPEN);H(i,fe,"url",r[1])}else if(e.RE_URL_CLOSE.test(t))H(i,ye,"url");else if(e.RE_ALIGN_OPEN.test(t)){var r=t.match(e.RE_ALIGN_OPEN);H(i,fe,"align",r[1])}else if(e.RE_ALIGN_CLOSE.test(t))H(i,ye,"align");else if(e.RE_ID_OPEN.test(t)){var r=t.match(e.RE_ID_OPEN);H(i,fe,"id",r[1])}else e.RE_ID_CLOSE.test(t)?H(i,ye,"id"):s=t;var n=Lc;return n.plainText=s,n.prop=i,n},H=function(t,i,e,s){return i===fe?t[e]=s:t.hasOwnProperty(e)&&delete t[e],t},Fc=function(t,i){var e=$c;if(i.hasOwnProperty("img"))e.image=i.img;else{if(e.image=null,i.hasOwnProperty("family")?e.fontFamily=i.family:e.fontFamily=t.fontFamily,i.hasOwnProperty("size")){var s=i.size;typeof s=="number"&&(s=`${s}px`),e.fontSize=s}else e.fontSize=t.fontSize;e.fontStyle=Nc(i),i.hasOwnProperty("color")?e.color=i.color:e.color=t.color,i.hasOwnProperty("stroke")?i.stroke===!0?(e.stroke=t.stroke,e.strokeThickness=t.strokeThickness):(e.stroke=i.stroke,e.strokeThickness=t.strokeThickness):(e.stroke=t.stroke,e.strokeThickness=0)}return i.hasOwnProperty("shadow")?i.shadow===!0?(e.shadowColor=t.shadowColor,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.shadowBlur=t.shadowBlur,e.shadowStroke=!0,e.shadowFill=!0):(e.shadowColor=i.shadow,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.shadowBlur=t.shadowBlur,e.shadowStroke=!0,e.shadowFill=!0):(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowStroke=!1,e.shadowFill=!1),i.hasOwnProperty("u")?i.u===!0?(e.underlineColor=t.underlineColor,e.underlineThickness=t.underlineThickness,e.underlineOffset=t.underlineOffset):(e.underlineColor=i.u,e.underlineThickness=t.underlineThickness,e.underlineOffset=t.underlineOffset):(e.underlineColor="#000",e.underlineThickness=0,e.underlineOffset=0),i.hasOwnProperty("s")?i.s===!0?(e.strikethroughColor=t.strikethroughColor,e.strikethroughThickness=t.strikethroughThickness,e.strikethroughOffset=t.strikethroughOffset):(e.strikethroughColor=i.s,e.strikethroughThickness=t.strikethroughThickness,e.strikethroughOffset=t.strikethroughOffset):(e.strikethroughColor="#000",e.strikethroughThickness=0,e.strikethroughOffset=0),i.hasOwnProperty("bgcolor")?e.bgcolor=i.bgcolor:e.bgcolor=null,e},Nc=function(t){var i=t.b,e=t.weight,s=t.i;return i||e||s?s?i?"bold italic":e?`${e} italic`:"italic":i?"bold":e.toString():""},$c=new Sl,Wc=function(t,i,e){e==null&&(e=Gc);var s=this.delimiters[0],r=this.delimiters[1],n=[];for(var a in e)i.hasOwnProperty(a)||n.push(`${s}/${a}${r}`);for(var a in i){var o=i[a];if(a!=="img"){if(e[a]===o)continue}switch(a){case"size":n.push(`${s}size=${o.replace("px","")}${r}`);break;case"color":case"weight":case"family":case"stroke":case"bgcolor":case"y":case"img":case"area":case"url":case"align":case"id":n.push(`${s}${a}=${o}${r}`);break;case"u":case"s":o===!0?n.push(`${s}${a}${r}`):n.push(`${s}${a}=${o}${r}`);break;default:n.push(`${s}${a}${r}`);break}}return n.push(t),n.join("")},Gc={},ga=function(t){return t.replace(zc,"\\$&").replace(jc,"\\x2d")},zc=/[|\\{}()[\]^$+*?.]/g,jc=/-/g,ya,ma,U={},ge=function(t,i,e,s){return s===void 0?`${t}${e}${i}`:`${t}${e}=(${s})${i}`},xe=function(t,i,e){return`${t}/${e}${i}`},Hc=function(t){return`[^${t}]+`},_s="[-.0-9]+",Uc=["[a-zA-Z]+","#[0-9abcdef]+","rgba?\\(s*[.0-9]+s*(,s*[.0-9]+s*){2,3}\\)"],zt=Uc.join("|"),Pl=function(t,i){if(i===void 0){var e=t;t=e[0],i=e[1]}if(ya===t&&ma===i)return!1;ya=t,ma=i,t=ga(t),i=ga(i);var s=Hc(i),r="esc",n=ge(t,i,r),a=xe(t,i,r),o="raw",l=ge(t,i,o),h=xe(t,i,o),u="b",c=ge(t,i,u),p=xe(t,i,u),g="i",v=ge(t,i,g),y=xe(t,i,g),m="weight",w=ge(t,i,m,_s),k=xe(t,i,m),x="size",T=ge(t,i,x,_s),A=xe(t,i,x),F="family",K=ge(t,i,F,s),N=xe(t,i,F),M="color",Y=ge(t,i,M,zt),Q=xe(t,i,M),ae="u",ne=ge(t,i,ae),Oe=ge(t,i,ae,zt),de=xe(t,i,ae),Ke="s",ve=ge(t,i,Ke),ie=ge(t,i,Ke,zt),J=xe(t,i,Ke),re="shadow",pe=ge(t,i,re),ke=ge(t,i,re,zt),De=xe(t,i,re),O="stroke",P=ge(t,i,O),q=ge(t,i,O,zt),$=xe(t,i,O),W="bgcolor",Z=ge(t,i,W,zt),ee=xe(t,i,W),te="y",j=ge(t,i,te,_s),oe=xe(t,i,te),He="img",Te=ge(t,i,He,s),Pe=xe(t,i,He),Re="area",wt=ge(t,i,Re,s),lt=xe(t,i,Re),St="url",xt=ge(t,i,St,s),kt=xe(t,i,St),Et="align",Ot=ge(t,i,Et,s),It=xe(t,i,Et),$e="id",ht=ge(t,i,$e,s),We=xe(t,i,$e);return U.RE_ESC_OPEN=new RegExp(n,"i"),U.RE_ESC_CLOSE=new RegExp(a,"i"),U.RE_RAW_OPEN=new RegExp(l,"i"),U.RE_RAW_CLOSE=new RegExp(h,"i"),U.RE_BLOD_OPEN=new RegExp(c,"i"),U.RE_BLOD_CLOSE=new RegExp(p,"i"),U.RE_ITALICS_OPEN=new RegExp(v,"i"),U.RE_ITALICS_CLOSE=new RegExp(y,"i"),U.RE_WEIGHT_OPEN=new RegExp(w,"i"),U.RE_WEIGHT_CLOSE=new RegExp(k,"i"),U.RE_SIZE_OPEN=new RegExp(T,"i"),U.RE_SIZE_CLOSE=new RegExp(A,"i"),U.RE_FAMILY_OPEN=new RegExp(K,"i"),U.RE_FAMILY_CLOSE=new RegExp(N,"i"),U.RE_COLOR_OPEN=new RegExp(Y,"i"),U.RE_COLOR_CLOSE=new RegExp(Q,"i"),U.RE_UNDERLINE_OPEN=new RegExp(ne,"i"),U.RE_UNDERLINE_OPENC=new RegExp(Oe,"i"),U.RE_UNDERLINE_CLOSE=new RegExp(de,"i"),U.RE_STRIKETHROUGH_OPEN=new RegExp(ve,"i"),U.RE_STRIKETHROUGH_OPENC=new RegExp(ie,"i"),U.RE_STRIKETHROUGH_CLOSE=new RegExp(J,"i"),U.RE_SHADOW_OPEN=new RegExp(pe,"i"),U.RE_SHADOW_OPENC=new RegExp(ke,"i"),U.RE_SHADOW_CLOSE=new RegExp(De,"i"),U.RE_STROKE_OPEN=new RegExp(P,"i"),U.RE_STROKE_OPENC=new RegExp(q,"i"),U.RE_STROKE_CLOSE=new RegExp($,"i"),U.RE_BGCOLOR_OPEN=new RegExp(Z,"i"),U.RE_BGCOLOR_CLOSE=new RegExp(ee,"i"),U.RE_OFFSETY_OPEN=new RegExp(j,"i"),U.RE_OFFSETY_CLOSE=new RegExp(oe,"i"),U.RE_IMAGE_OPEN=new RegExp(Te,"i"),U.RE_IMAGE_CLOSE=new RegExp(Pe,"i"),U.RE_AREA_OPEN=new RegExp(wt,"i"),U.RE_AREA_CLOSE=new RegExp(lt,"i"),U.RE_URL_OPEN=new RegExp(xt,"i"),U.RE_URL_CLOSE=new RegExp(kt,"i"),U.RE_ALIGN_OPEN=new RegExp(Ot,"i"),U.RE_ALIGN_CLOSE=new RegExp(It,"i"),U.RE_ID_OPEN=new RegExp(ht,"i"),U.RE_ID_CLOSE=new RegExp(We,"i"),U.RE_SPLITTEXT=new RegExp([l,h,n,a,c,p,v,y,w,k,T,A,K,N,Y,Q,ne,Oe,de,ve,ie,J,pe,ke,De,P,q,$,Z,ee,j,oe,Te,Pe,wt,lt,xt,kt,Ot,It,ht,We].join("|"),"ig"),!0},va=function(t,i){return t!==void 0&&Pl(t,i),Object.assign({},U)};const qc=Phaser.Utils.Objects.GetValue;class Cl{constructor(i){var e=qc(i,"delimiters","[]");this.tagRegex=va(e),this.delimiters=e}getStrokeThinkness(i,e){var s;return e.hasOwnProperty("stroke")?s=i.strokeThickness:s=0,s}setDelimiters(i,e){return Pl(i,e)&&(this.tagRegex=va()),this}}var Vc={splitText:Dc,tagTextToProp:Bc,propToContextStyle:Fc,propToTagText:Wc};Object.assign(Cl.prototype,Vc);class Xc extends Tl{constructor(i,e,s,r,n){var a=new Cl(n);super(i,e,s,r,n,"rexBBCodeText",a)}setDelimiters(i,e){return this.parser.setDelimiters(i,e),this}}const mn={[D.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[D.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:R.ClockSquareNorth},[D.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[D.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:R.LabHatch},[D.AlchemySetFixed]:{description:"With the alchemy set fixed, I can now attempt to create the brew mentioned in the old journal."},[D.ExtraPotionInformation]:{description:'I found an extra journal entry with more information on the potion. It stated the name of the potion was the "Exlixir of Sight". This potion must be the key to finding a gear.'},[D.SafeDiscovered]:{description:"I discovered a safe in the abandonded mansion. I wonder what secrets it holds."},[D.ClockSecondGear]:{description:"I found the second gear for the clock tower inside a safe, which was located within the abandoned mansion. I still need one more gear to fix it."}},qt={[B.ForestGear]:{description:"Search the forest for clues",warpAdd:R.TownEast,warpComplete:R.TownNorth},[B.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[B.InvestigateTownWest]:{description:"Investigate the western mansion",warpAdd:R.TownWest},[B.ExploreLab]:{description:"Explore the hidden alchemy lab"},[B.FindPotionIngredients]:{description:"Find the 3 potion ingredients"}};var Ie=(t=>(t[t.Ladder=0]="Ladder",t[t.Warp=1]="Warp",t[t.Invisible=2]="Invisible",t[t.WarpLocked=3]="WarpLocked",t[t.InvisibleLocked=4]="InvisibleLocked",t))(Ie||{});const Fe={[R.Town]:{x:280,y:650,key:C.Down,warpTo:R.Station,location:G.Station,visual:2,sound:"ladder"},[R.Station]:{x:365,y:1355,key:C.Left,direction:C.Up,warpTo:R.Town,location:G.Town,visual:2,sound:"ladder"},[R.TownEast]:{x:1720,y:650,key:C.Right,warpTo:R.Forest,location:G.Forest,visual:3},[R.Forest]:{x:2650,y:815,key:C.Left,warpTo:R.TownEast,location:G.Town,visual:1},[R.TownNorth]:{x:775,y:650,key:C.Up,warpTo:R.ClockSquare,location:G.ClockOutside,visual:3},[R.ClockSquare]:{x:560,y:-330,key:C.Down,warpTo:R.TownNorth,location:G.Town,visual:1,onWarpStart(t){nt(t.scene)&&(Ye(t,I.Gear2)?od(t):Ye(t,I.Gear1)&&ad(t))}},[R.ClockSquareNorth]:{x:930,y:-330,key:C.Up,warpTo:R.ClockEntrance,location:G.ClockInner,visual:3},[R.ClockEntrance]:{x:690,y:-1320,range:15,key:C.Left,direction:C.Down,warpTo:R.ClockSquareNorth,location:G.ClockOutside,visual:1,skipLighting:!0},[R.ClockStairs]:{x:910,y:-1418,range:20,key:C.Right,direction:C.Up,warpTo:R.ClockTop,location:G.ClockInner,name:"Clock Tower (Upstairs)",visual:2,sound:"ladder"},[R.ClockTop]:{x:780,y:-1980,range:10,key:C.Left,direction:C.Down,warpTo:R.ClockStairs,location:G.ClockInner,name:"Clock Tower (Downstairs)",visual:2,sound:"ladder"},[R.ForestEast]:{x:3570,y:815,key:C.Right,warpTo:R.Lake,location:G.Lake,visual:3,onCreate:t=>t.updateLocked(!t.scene.player.gameState.data.sphinxMoved)},[R.Lake]:{x:4510,y:915,key:C.Left,warpTo:R.ForestEast,location:G.Forest,visual:1},[R.TownWest]:{x:90,y:650,key:C.Left,warpTo:R.MansionGrounds,location:G.MansionOutside,visual:3},[R.MansionGrounds]:{x:-620,y:640,key:C.Right,warpTo:R.TownWest,location:G.Town,visual:1},[R.MansionEntrance]:{x:-1290,y:640,key:C.Up,warpTo:R.Mansion,location:G.MansionInside,visual:2},[R.Mansion]:{x:-1405,y:-420,key:C.Down,warpTo:R.MansionEntrance,location:G.MansionOutside,visual:2},[R.LabHatch]:{x:-1920,y:640,key:C.Down,warpTo:R.Lab,location:G.AlchemyLab,visual:4},[R.Lab]:{x:-1380,y:1545,key:C.Right,direction:C.Up,warpTo:R.LabHatch,location:G.MansionOutside,visual:2,range:15,skipLighting:!0},[R.LibraryEntrance]:{x:1130,y:-330,key:C.Up,warpTo:R.Library,location:G.Library,visual:2},[R.Library]:{x:1680,y:-290,key:C.Down,warpTo:R.LibraryEntrance,location:G.ClockOutside,visual:2},[R.InnEntrance]:{x:1300,y:650,key:C.Up,warpTo:R.Inn,location:G.Inn,visual:2},[R.Inn]:{x:2555,y:-1180,key:C.Down,warpTo:R.InnEntrance,location:G.Town,visual:2}};function Yc(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(i=>navigator.userAgent.match(i))}function Kc(t,i){const e=i?fl:Mh;f.zoomed=i,f.width=e.width,f.height=e.height,f.cameraOffset=e.height/3,t.scale.setGameSize(e.width,e.height),t.scene.restart()}const Zt=gt(L(_.Background));function Dt(t,i,e){const s=t.cameras.main;if(s.fadeEffect&&s.fadeEffect.progress===1&&s.fadeEffect.direction===!1){e&&t.time.delayedCall(i,()=>e());return}s.fadeIn(i,Zt.red,Zt.green,Zt.blue,(r,n)=>{n>=1&&e&&e()})}function Je(t,i,e){const s=t.cameras.main;if(s.fadeEffect&&s.fadeEffect.progress===1&&s.fadeEffect.direction===!0){e&&t.time.delayedCall(i,()=>e());return}s.fadeOut(i,Zt.red,Zt.green,Zt.blue,(r,n)=>{n>=1&&e&&e()})}function wi(t,i,e){return E.Math.Distance.BetweenPointsSquared(t,i)<e*e}function vn(t){return t.inventory.initialized&&t.quests.initialized&&t.journal.initialized&&t.gameState.initialized}function Ze(t,i,e){return vn(i)?wi(t,i,e||1e3):!1}function ze(t,i,e){var s,r;t.player.message.setDialog(),t.player.message.setVisible(!1),(s=t.gamepad)==null||s.setAlpha(0),(r=t.gamepad)==null||r.resetButtons(),t.scene.pause(),t.scene.launch(i,{player:t.player,...e})}function ba(t,i,e){if(i&&Object.values(i).includes(t)){const s=Object.keys(i).find(r=>i[r]===t);return`${e}.${s}`}return t}function bn(t){return t.replace(/([A-Z]+|[0-9]+)/g," $1").replace(/\s*([\(\[\{])\s*/g," $1").replace(/\s*([\)\]\}])\s*/g,"$1 ").replace(/\s+/g," ").trim()}let wa;const Qi=document.documentElement;function Qc(){Qi.style.cursor="default",clearTimeout(wa),wa=setTimeout(()=>{Qi.style.cursor="none"},2500)}function Jc(){Qi.style.cursor="none",Qi.addEventListener("mousemove",Qc)}const Sa=30,Zc=12,Si=[];Object.values(qt).forEach(t=>{t.warpAdd&&Si.push(t.warpAdd),t.warpComplete&&Si.push(t.warpComplete)});Object.values(mn).forEach(t=>{t.warpAdd&&Si.push(t.warpAdd)});class qi extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a,visual:o,range:l}=Fe[s];super(e,n,a,"props","warp");d(this,"warpType");d(this,"player");d(this,"locked");d(this,"graphics");d(this,"light");d(this,"portal1");d(this,"portal2");d(this,"range");d(this,"initialized",!1);this.name=`Warp-${s}`,this.warpType=s,this.player=r,this.range=l||Sa,this.setScale(.6).setDepth(V.Warpers),(o===Ie.Warp||o===Ie.WarpLocked)&&(this.setScale(.6,1),this.setPosition(n,a-Zc)),f.debug||(this.updateLocked(o===Ie.WarpLocked||o===Ie.InvisibleLocked),(o===Ie.Invisible||o===Ie.InvisibleLocked)&&this.setAlpha(0)),ai(this,Fe[s]),Si.includes(s)&&e.add.existing(this)}lazyInit(){if(this.initialized||!Ze(this,this.player))return;Si.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createAnimations(),this.createDebug();const{onCreate:e,visual:s}=Fe[this.warpType];(s===Ie.Warp||s===Ie.WarpLocked)&&(this.light=this.scene.lights.addPointLight(this.x,this.y,5132207,125,0)),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/Sa*4),this.body.height),this.updateLocked(),e&&e(this),this.initialized=!0}createAnimations(){const{visual:e,skipLighting:s}=Fe[this.warpType];(e===Ie.Warp||e===Ie.WarpLocked)&&(this.setAlpha(.1),this.scene.anims.exists("portal")||this.scene.anims.create({key:"portal",frames:this.scene.anims.generateFrameNumbers("portal",{start:0,end:63}),frameRate:10,repeat:-1,randomFrame:!0}),this.portal1=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.45,1).setAlpha(.9).setName(`${this.name}-1`).play("portal"),this.portal1.postFX.addPixelate(1),this.portal1.postFX.addShadow(0,0,.1,2,3355562,3,.5),this.portal2=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.35,1).setAlpha(.65).setFlipX(!0).setName(`${this.name}-2`).play("portal"),this.portal2.postFX.addPixelate(1),this.portal2.setFrame(Math.floor(Math.random()*30)),s||(this.portal1.setPipeline("Light2D"),this.portal2.setPipeline("Light2D")),this.portal1.setPostPipeline("XRayPipeline"),this.portal2.setPostPipeline("XRayPipeline"))}createDebug(){if(f.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const e=this.body;this.graphics.lineBetween(-this.range,-e.halfHeight,-this.range,e.halfHeight),this.graphics.lineBetween(this.range,-e.halfHeight,this.range,e.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:e,key:s}=Fe[this.warpType];return(e===Ie.Warp||e===Ie.WarpLocked||e===Ie.Invisible)&&(s===C.Left||s===C.Right)}onInteract(e){const s=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,r=Fe[this.warpType].key,n=e[r]&&s;if(n&&this.warpType===R.TownEast&&!this.player.gameState.data.mazeSolved&&!f.debug)return ze(this.scene,"MazeDialog"),Ae.None;if(n){const a=Fe[this.warpType];return as(this.warpType,a.warpTo,this.player,{x:0,y:-12}),Ae.Teleported}return Ae.None}getButtonPrompt(){const{key:e,location:s,name:r}=Fe[this.warpType];let n;e===C.Up&&(n="[Up]"),e===C.Down&&(n="[Down]"),e===C.Left&&(n="[Left]"),e===C.Right&&(n="[Right]");let a=r||s;return a=bn(a),[f.debug?`(WarpType.${R[this.warpType]})`:void 0,`Travel to ${a}`,"Press "+n].filter(l=>l)}setPosition(e,s,r,n){var a,o,l;return super.setPosition(e,s,r,n),(a=this.portal1)==null||a.setPosition(e,s),(o=this.portal2)==null||o.setPosition(e,s),(l=this.graphics)==null||l.setPosition(e,s),this}setVisible(e){var s,r,n;return super.setVisible(e),(s=this.portal1)==null||s.setVisible(e),(r=this.portal2)==null||r.setVisible(e),(n=this.light)==null||n.setVisible(e),this}updateLocked(e){e!==void 0&&(this.locked=e),this.setVisible(!this.locked)}update(e,s){this.lazyInit(),this.initialized&&this.light&&wi(this,this.player,f.width/1.8)&&(this.light.setPosition(this.x,this.y),this.light.intensity=E.Math.Clamp(this.light.intensity+Math.random()*.025-.0125,.1,.2))}destroy(e){var s,r;(s=this.portal1)==null||s.destroy(e),(r=this.portal2)==null||r.destroy(e),super.destroy(e)}}const eu={[C.Up]:{x:0,y:-1},[C.Down]:{x:0,y:1},[C.Left]:{x:-1,y:0},[C.Right]:{x:1,y:0}};function as(t,i,e,s,r){const{direction:n,key:a,sound:o,visual:l,location:h,onWarpStart:u}=Fe[t];let{x:c,y:p}=Fe[i],g=!0;if(nt(e.scene)&&(t===R.LibraryEntrance||t===R.ClockSquareNorth||t===R.Inn)&&(g=!1),(!f.prod&&r||f.debug)&&(g=!0),!g){e.message.setDialog({messages:["It is too late to venture off now.","I should rest at the inn until tomorrow."]},e);return}const v=eu[n!==void 0?n:a],y=e.scene,m=y.cameras.main;s&&(c+=s.x,p+=s.y);const w=c-y.cameras.main.width/2,k=p-y.cameras.main.height/2-f.cameraOffset;let x="warp";(l===Ie.Invisible||l===Ie.InvisibleLocked)&&(x="door"),o&&(x=o),m.stopFollow(),m.removeBounds(),e.unlockCamera=!0,e.setActive(!1);const T=me.getLocationMusic(h);T&&me.start(T),u==null||u(e),y.add.timeline([{at:0,run:()=>{Je(y,200),y.sound.playAudioSprite("sfx",x)},tween:{delay:0,targets:m,scrollX:m.scrollX+v.x*75,scrollY:m.scrollY+v.y*75,duration:200}},{at:0,tween:{targets:e,alpha:0,duration:200}},{at:450,run:()=>{e.unlockCamera=!1,e.setPosition(c,p),e.previousPosition.set(c,p),m.scrollX=w,m.scrollY=k}},{at:600,tween:{targets:e,alpha:1,duration:200},run:()=>Dt(y,400,()=>{m.startFollow(e,!0),m.setFollowOffset(0,f.cameraOffset),e.setActive(!0)})}]).play()}const st={[z.ClockTower]:{x:880,y:-2090,scale:.5,name:"Clock Tower",portrait:"clock_portrait",particles:{scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]}},[z.Chest]:{x:4955,y:915,image:"chest",scale:{x:4.5,y:3},onCreate(t){Ye(t.scene.player,I.Gear1)&&t.setFrame("chest_open")}},[z.LabHatch]:{x:-1910,y:640,name:"Trap Door"},[z.LabBook]:{x:-700,y:1630,scale:.7,name:"Journal",image:"book",skipLighting:!0},[z.AlchemySet]:{x:-2650,y:1600,scale:.7,image:"alchemy_empty",skipLighting:!0,particles:{scale:{min:.05,max:.15},speed:{min:30,max:120},alpha:{values:[0,.5,0]},gravityY:100,lifespan:{min:250,max:500},emitting:!1,stopAfter:60},onCreate:t=>Rn(t.scene.player)},[z.LabBookshelf1]:{x:-2025,y:1700,name:"Bookshelf"},[z.LabBookshelf2]:{x:-1290,y:1700,name:"Bookshelf"},[z.LabBookshelf3]:{x:-1115,y:1700,name:"Bookshelf"},[z.LabPotionShelf1]:{x:-1790,y:1700,name:"Potion Shelf"},[z.MansionPicture]:{x:-1233,y:-580,scale:1.2,angle:5,name:"Picture",image:"picture",origin:{x:0,y:0},onCreate:t=>{const i=t.scene.player;vt(i,D.SafeDiscovered)&&Yl(i,!0)}},[z.MansionHole]:{x:-1870,y:-490,name:"Hole in the Wall"},[z.Bed]:{x:2670,y:-1530,scale:{x:7,y:2}},[z.LibraryShelf]:{x:2100,y:-290,name:"Library Shelf"}},on=[{x:40,y:600},{x:1750,y:600},{x:320,y:1300},{x:1410,y:1450},{x:510,y:-400},{x:1170,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3610,y:760,id:Yi.Sphinx,onCreate:t=>{var e;t.scene.player.gameState.data.sphinxMoved||t.setX(t.x-Xl),(e=t.body)==null||e.updateFromGameObject()}},{x:4455,y:850},{x:5690,y:900},{x:-565,y:575},{x:-2075,y:575},{x:-1930,y:-480},{x:-1050,y:-510},{x:-3075,y:1630},{x:-1350,y:1510},{x:-730,y:1560},{x:1620,y:-350},{x:3095,y:-350},{x:1790,y:-1245},{x:2790,y:-1245},{x:2765,y:-1580}];var Ds,xa;function Al(){if(xa)return Ds;xa=1;var t=Object.prototype.toString;return Ds=function(e){var s=t.call(e),r=s==="[object Arguments]";return r||(r=s!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&t.call(e.callee)==="[object Function]"),r},Ds}var Ls,ka;function tu(){if(ka)return Ls;ka=1;var t;if(!Object.keys){var i=Object.prototype.hasOwnProperty,e=Object.prototype.toString,s=Al(),r=Object.prototype.propertyIsEnumerable,n=!r.call({toString:null},"toString"),a=r.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(p){var g=p.constructor;return g&&g.prototype===p},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},u=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!h["$"+p]&&i.call(window,p)&&window[p]!==null&&typeof window[p]=="object")try{l(window[p])}catch{return!0}}catch{return!0}return!1}(),c=function(p){if(typeof window>"u"||!u)return l(p);try{return l(p)}catch{return!1}};t=function(g){var v=g!==null&&typeof g=="object",y=e.call(g)==="[object Function]",m=s(g),w=v&&e.call(g)==="[object String]",k=[];if(!v&&!y&&!m)throw new TypeError("Object.keys called on a non-object");var x=a&&y;if(w&&g.length>0&&!i.call(g,0))for(var T=0;T<g.length;++T)k.push(String(T));if(m&&g.length>0)for(var A=0;A<g.length;++A)k.push(String(A));else for(var F in g)!(x&&F==="prototype")&&i.call(g,F)&&k.push(String(F));if(n)for(var K=c(g),N=0;N<o.length;++N)!(K&&o[N]==="constructor")&&i.call(g,o[N])&&k.push(o[N]);return k}}return Ls=t,Ls}var Bs,Ea;function wn(){if(Ea)return Bs;Ea=1;var t=Array.prototype.slice,i=Al(),e=Object.keys,s=e?function(a){return e(a)}:tu(),r=Object.keys;return s.shim=function(){if(Object.keys){var a=function(){var o=Object.keys(arguments);return o&&o.length===arguments.length}(1,2);a||(Object.keys=function(l){return i(l)?r(t.call(l)):r(l)})}else Object.keys=s;return Object.keys||s},Bs=s,Bs}var Fs,Oa;function iu(){return Oa||(Oa=1,Fs=Error),Fs}var Ns,Ia;function su(){return Ia||(Ia=1,Ns=EvalError),Ns}var $s,Ta;function ru(){return Ta||(Ta=1,$s=RangeError),$s}var Ws,Pa;function nu(){return Pa||(Pa=1,Ws=ReferenceError),Ws}var Gs,Ca;function Rl(){return Ca||(Ca=1,Gs=SyntaxError),Gs}var zs,Aa;function bt(){return Aa||(Aa=1,zs=TypeError),zs}var js,Ra;function au(){return Ra||(Ra=1,js=URIError),js}var Hs,Ma;function os(){return Ma||(Ma=1,Hs=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var i={},e=Symbol("test"),s=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(s)!=="[object Symbol]")return!1;var r=42;i[e]=r;for(e in i)return!1;if(typeof Object.keys=="function"&&Object.keys(i).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(i).length!==0)return!1;var n=Object.getOwnPropertySymbols(i);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(i,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(i,e);if(a.value!==r||a.enumerable!==!0)return!1}return!0}),Hs}var Us,_a;function Sn(){if(_a)return Us;_a=1;var t=typeof Symbol<"u"&&Symbol,i=os();return Us=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:i()},Us}var qs,Da;function ou(){if(Da)return qs;Da=1;var t={__proto__:null,foo:{}},i=Object;return qs=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof i)},qs}var Vs,La;function lu(){if(La)return Vs;La=1;var t="Function.prototype.bind called on incompatible ",i=Object.prototype.toString,e=Math.max,s="[object Function]",r=function(l,h){for(var u=[],c=0;c<l.length;c+=1)u[c]=l[c];for(var p=0;p<h.length;p+=1)u[p+l.length]=h[p];return u},n=function(l,h){for(var u=[],c=h,p=0;c<l.length;c+=1,p+=1)u[p]=l[c];return u},a=function(o,l){for(var h="",u=0;u<o.length;u+=1)h+=o[u],u+1<o.length&&(h+=l);return h};return Vs=function(l){var h=this;if(typeof h!="function"||i.apply(h)!==s)throw new TypeError(t+h);for(var u=n(arguments,1),c,p=function(){if(this instanceof c){var w=h.apply(this,r(u,arguments));return Object(w)===w?w:this}return h.apply(l,r(u,arguments))},g=e(0,h.length-u.length),v=[],y=0;y<g;y++)v[y]="$"+y;if(c=Function("binder","return function ("+a(v,",")+"){ return binder.apply(this,arguments); }")(p),h.prototype){var m=function(){};m.prototype=h.prototype,c.prototype=new m,m.prototype=null}return c},Vs}var Xs,Ba;function xn(){if(Ba)return Xs;Ba=1;var t=lu();return Xs=Function.prototype.bind||t,Xs}var Ys,Fa;function Ml(){if(Fa)return Ys;Fa=1;var t=Function.prototype.call,i=Object.prototype.hasOwnProperty,e=xn();return Ys=e.call(t,i),Ys}var Ks,Na;function it(){if(Na)return Ks;Na=1;var t,i=iu(),e=su(),s=ru(),r=nu(),n=Rl(),a=bt(),o=au(),l=Function,h=function(ve){try{return l('"use strict"; return ('+ve+").constructor;")()}catch{}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch{u=null}var c=function(){throw new a},p=u?function(){try{return arguments.callee,c}catch{try{return u(arguments,"callee").get}catch{return c}}}():c,g=Sn()(),v=ou()(),y=Object.getPrototypeOf||(v?function(ve){return ve.__proto__}:null),m={},w=typeof Uint8Array>"u"||!y?t:y(Uint8Array),k={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":g&&y?y([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":m,"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":m,"%AsyncIteratorPrototype%":m,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":i,"%eval%":eval,"%EvalError%":e,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":m,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&y?y(y([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!g||!y?t:y(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":s,"%ReferenceError%":r,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!g||!y?t:y(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&y?y(""[Symbol.iterator]()):t,"%Symbol%":g?Symbol:t,"%SyntaxError%":n,"%ThrowTypeError%":p,"%TypedArray%":w,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet};if(y)try{null.error}catch(ve){var x=y(y(ve));k["%Error.prototype%"]=x}var T=function ve(ie){var J;if(ie==="%AsyncFunction%")J=h("async function () {}");else if(ie==="%GeneratorFunction%")J=h("function* () {}");else if(ie==="%AsyncGeneratorFunction%")J=h("async function* () {}");else if(ie==="%AsyncGenerator%"){var re=ve("%AsyncGeneratorFunction%");re&&(J=re.prototype)}else if(ie==="%AsyncIteratorPrototype%"){var pe=ve("%AsyncGenerator%");pe&&y&&(J=y(pe.prototype))}return k[ie]=J,J},A={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},F=xn(),K=Ml(),N=F.call(Function.call,Array.prototype.concat),M=F.call(Function.apply,Array.prototype.splice),Y=F.call(Function.call,String.prototype.replace),Q=F.call(Function.call,String.prototype.slice),ae=F.call(Function.call,RegExp.prototype.exec),ne=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Oe=/\\(\\)?/g,de=function(ie){var J=Q(ie,0,1),re=Q(ie,-1);if(J==="%"&&re!=="%")throw new n("invalid intrinsic syntax, expected closing `%`");if(re==="%"&&J!=="%")throw new n("invalid intrinsic syntax, expected opening `%`");var pe=[];return Y(ie,ne,function(ke,De,O,P){pe[pe.length]=O?Y(P,Oe,"$1"):De||ke}),pe},Ke=function(ie,J){var re=ie,pe;if(K(A,re)&&(pe=A[re],re="%"+pe[0]+"%"),K(k,re)){var ke=k[re];if(ke===m&&(ke=T(re)),typeof ke>"u"&&!J)throw new a("intrinsic "+ie+" exists, but is not available. Please file an issue!");return{alias:pe,name:re,value:ke}}throw new n("intrinsic "+ie+" does not exist!")};return Ks=function(ie,J){if(typeof ie!="string"||ie.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof J!="boolean")throw new a('"allowMissing" argument must be a boolean');if(ae(/^%?[^%]*%?$/,ie)===null)throw new n("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var re=de(ie),pe=re.length>0?re[0]:"",ke=Ke("%"+pe+"%",J),De=ke.name,O=ke.value,P=!1,q=ke.alias;q&&(pe=q[0],M(re,N([0,1],q)));for(var $=1,W=!0;$<re.length;$+=1){var Z=re[$],ee=Q(Z,0,1),te=Q(Z,-1);if((ee==='"'||ee==="'"||ee==="`"||te==='"'||te==="'"||te==="`")&&ee!==te)throw new n("property names with quotes must have matching quotes");if((Z==="constructor"||!W)&&(P=!0),pe+="."+Z,De="%"+pe+"%",K(k,De))O=k[De];else if(O!=null){if(!(Z in O)){if(!J)throw new a("base intrinsic for "+ie+" exists, but the property is not available.");return}if(u&&$+1>=re.length){var j=u(O,Z);W=!!j,W&&"get"in j&&!("originalValue"in j.get)?O=j.get:O=O[Z]}else W=K(O,Z),O=O[Z];W&&!P&&(k[De]=O)}}return O},Ks}var Qs,$a;function kn(){if($a)return Qs;$a=1;var t=it(),i=t("%Object.defineProperty%",!0)||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return Qs=i,Qs}var Js,Wa;function En(){if(Wa)return Js;Wa=1;var t=it(),i=t("%Object.getOwnPropertyDescriptor%",!0);if(i)try{i([],"length")}catch{i=null}return Js=i,Js}var Zs,Ga;function On(){if(Ga)return Zs;Ga=1;var t=kn(),i=Rl(),e=bt(),s=En();return Zs=function(n,a,o){if(!n||typeof n!="object"&&typeof n!="function")throw new e("`obj` must be an object or a function`");if(typeof a!="string"&&typeof a!="symbol")throw new e("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new e("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new e("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new e("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new e("`loose`, if provided, must be a boolean");var l=arguments.length>3?arguments[3]:null,h=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,c=arguments.length>6?arguments[6]:!1,p=!!s&&s(n,a);if(t)t(n,a,{configurable:u===null&&p?p.configurable:!u,enumerable:l===null&&p?p.enumerable:!l,value:o,writable:h===null&&p?p.writable:!h});else if(c||!l&&!h&&!u)n[a]=o;else throw new i("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Zs}var er,za;function In(){if(za)return er;za=1;var t=kn(),i=function(){return!!t};return i.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},er=i,er}var tr,ja;function Lt(){if(ja)return tr;ja=1;var t=wn(),i=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",e=Object.prototype.toString,s=Array.prototype.concat,r=On(),n=function(h){return typeof h=="function"&&e.call(h)==="[object Function]"},a=In()(),o=function(h,u,c,p){if(u in h){if(p===!0){if(h[u]===c)return}else if(!n(p)||!p())return}a?r(h,u,c,!0):r(h,u,c)},l=function(h,u){var c=arguments.length>2?arguments[2]:{},p=t(u);i&&(p=s.call(p,Object.getOwnPropertySymbols(u)));for(var g=0;g<p.length;g+=1)o(h,p[g],u[p[g]],c[p[g]])};return l.supportsDescriptors=!!a,tr=l,tr}var ir={exports:{}},sr,Ha;function hu(){if(Ha)return sr;Ha=1;var t=it(),i=On(),e=In()(),s=En(),r=bt(),n=t("%Math.floor%");return sr=function(o,l){if(typeof o!="function")throw new r("`fn` is not a function");if(typeof l!="number"||l<0||l>4294967295||n(l)!==l)throw new r("`length` must be a positive 32-bit integer");var h=arguments.length>2&&!!arguments[2],u=!0,c=!0;if("length"in o&&s){var p=s(o,"length");p&&!p.configurable&&(u=!1),p&&!p.writable&&(c=!1)}return(u||c||!h)&&(e?i(o,"length",l,!0,!0):i(o,"length",l)),o},sr}var Ua;function ri(){return Ua||(Ua=1,function(t){var i=xn(),e=it(),s=hu(),r=bt(),n=e("%Function.prototype.apply%"),a=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||i.call(a,n),l=kn(),h=e("%Math.max%");t.exports=function(p){if(typeof p!="function")throw new r("a function is required");var g=o(i,a,arguments);return s(g,1+h(0,p.length-(arguments.length-1)),!0)};var u=function(){return o(i,n,arguments)};l?l(t.exports,"apply",{value:u}):t.exports.apply=u}(ir)),ir.exports}var rr,qa;function je(){if(qa)return rr;qa=1;var t=it(),i=ri(),e=i(t("String.prototype.indexOf"));return rr=function(r,n){var a=t(r,!!n);return typeof a=="function"&&e(r,".prototype.")>-1?i(a):a},rr}var nr,Va;function _l(){if(Va)return nr;Va=1;var t=wn(),i=os()(),e=je(),s=Object,r=e("Array.prototype.push"),n=e("Object.prototype.propertyIsEnumerable"),a=i?Object.getOwnPropertySymbols:null;return nr=function(l,h){if(l==null)throw new TypeError("target must be an object");var u=s(l);if(arguments.length===1)return u;for(var c=1;c<arguments.length;++c){var p=s(arguments[c]),g=t(p),v=i&&(Object.getOwnPropertySymbols||a);if(v)for(var y=v(p),m=0;m<y.length;++m){var w=y[m];n(p,w)&&r(g,w)}for(var k=0;k<g.length;++k){var x=g[k];if(n(p,x)){var T=p[x];u[x]=T}}}return u},nr}var ar,Xa;function Dl(){if(Xa)return ar;Xa=1;var t=_l(),i=function(){if(!Object.assign)return!1;for(var s="abcdefghijklmnopqrst",r=s.split(""),n={},a=0;a<r.length;++a)n[r[a]]=r[a];var o=Object.assign({},n),l="";for(var h in o)l+=h;return s!==l},e=function(){if(!Object.assign||!Object.preventExtensions)return!1;var s=Object.preventExtensions({1:2});try{Object.assign(s,"xy")}catch{return s[1]==="y"}return!1};return ar=function(){return!Object.assign||i()||e()?t:Object.assign},ar}var or,Ya;function cu(){if(Ya)return or;Ya=1;var t=Lt(),i=Dl();return or=function(){var s=i();return t(Object,{assign:s},{assign:function(){return Object.assign!==s}}),s},or}var lr,Ka;function uu(){if(Ka)return lr;Ka=1;var t=Lt(),i=ri(),e=_l(),s=Dl(),r=cu(),n=i.apply(s()),a=function(l,h){return n(Object,arguments)};return t(a,{getPolyfill:s,implementation:e,shim:r}),lr=a,lr}var hr,Qa;function du(){if(Qa)return hr;Qa=1;var t=function(){return typeof(function(){}).name=="string"},i=Object.getOwnPropertyDescriptor;if(i)try{i([],"length")}catch{i=null}t.functionsHaveConfigurableNames=function(){if(!t()||!i)return!1;var r=i(function(){},"name");return!!r&&!!r.configurable};var e=Function.prototype.bind;return t.boundFunctionsHaveNames=function(){return t()&&typeof e=="function"&&(function(){}).bind().name!==""},hr=t,hr}var cr,Ja;function fu(){if(Ja)return cr;Ja=1;var t=On(),i=In()(),e=du().functionsHaveConfigurableNames(),s=bt();return cr=function(n,a){if(typeof n!="function")throw new s("`fn` is not a function");var o=arguments.length>2&&!!arguments[2];return(!o||e)&&(i?t(n,"name",a,!0,!0):t(n,"name",a)),n},cr}var ur,Za;function Ll(){if(Za)return ur;Za=1;var t=fu(),i=bt(),e=Object;return ur=t(function(){if(this==null||this!==e(this))throw new i("RegExp.prototype.flags getter called on non-object");var r="";return this.hasIndices&&(r+="d"),this.global&&(r+="g"),this.ignoreCase&&(r+="i"),this.multiline&&(r+="m"),this.dotAll&&(r+="s"),this.unicode&&(r+="u"),this.unicodeSets&&(r+="v"),this.sticky&&(r+="y"),r},"get flags",!0),ur}var dr,eo;function Bl(){if(eo)return dr;eo=1;var t=Ll(),i=Lt().supportsDescriptors,e=Object.getOwnPropertyDescriptor;return dr=function(){if(i&&/a/mig.flags==="gim"){var r=e(RegExp.prototype,"flags");if(r&&typeof r.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var n="",a={};if(Object.defineProperty(a,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(a,"sticky",{get:function(){n+="y"}}),r.get.call(a),n==="dy")return r.get}}return t},dr}var fr,to;function pu(){if(to)return fr;to=1;var t=Lt().supportsDescriptors,i=Bl(),e=Object.getOwnPropertyDescriptor,s=Object.defineProperty,r=TypeError,n=Object.getPrototypeOf,a=/a/;return fr=function(){if(!t||!n)throw new r("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var l=i(),h=n(a),u=e(h,"flags");return(!u||u.get!==l)&&s(h,"flags",{configurable:!0,enumerable:!1,get:l}),l},fr}var pr,io;function gu(){if(io)return pr;io=1;var t=Lt(),i=ri(),e=Ll(),s=Bl(),r=pu(),n=i(s());return t(n,{getPolyfill:s,implementation:e,shim:r}),pr=n,pr}var hi={exports:{}},gr,so;function Bt(){if(so)return gr;so=1;var t=os();return gr=function(){return t()&&!!Symbol.toStringTag},gr}var yr,ro;function Fl(){if(ro)return yr;ro=1;var t=Bt()(),i=je(),e=i("Object.prototype.toString"),s=function(o){return t&&o&&typeof o=="object"&&Symbol.toStringTag in o?!1:e(o)==="[object Arguments]"},r=function(o){return s(o)?!0:o!==null&&typeof o=="object"&&typeof o.length=="number"&&o.length>=0&&e(o)!=="[object Array]"&&e(o.callee)==="[object Function]"},n=function(){return s(arguments)}();return s.isLegacyArguments=r,yr=n?s:r,yr}const yu={},mu=Object.freeze(Object.defineProperty({__proto__:null,default:yu},Symbol.toStringTag,{value:"Module"})),vu=Ih(mu);var mr,no;function bu(){if(no)return mr;no=1;var t=typeof Map=="function"&&Map.prototype,i=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=t&&i&&typeof i.get=="function"?i.get:null,s=t&&Map.prototype.forEach,r=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=r&&n&&typeof n.get=="function"?n.get:null,o=r&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,h=l?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,c=u?WeakSet.prototype.has:null,p=typeof WeakRef=="function"&&WeakRef.prototype,g=p?WeakRef.prototype.deref:null,v=Boolean.prototype.valueOf,y=Object.prototype.toString,m=Function.prototype.toString,w=String.prototype.match,k=String.prototype.slice,x=String.prototype.replace,T=String.prototype.toUpperCase,A=String.prototype.toLowerCase,F=RegExp.prototype.test,K=Array.prototype.concat,N=Array.prototype.join,M=Array.prototype.slice,Y=Math.floor,Q=typeof BigInt=="function"?BigInt.prototype.valueOf:null,ae=Object.getOwnPropertySymbols,ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Oe=typeof Symbol=="function"&&typeof Symbol.iterator=="object",de=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Oe||!0)?Symbol.toStringTag:null,Ke=Object.prototype.propertyIsEnumerable,ve=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(b){return b.__proto__}:null);function ie(b,S){if(b===1/0||b===-1/0||b!==b||b&&b>-1e3&&b<1e3||F.call(/e/,S))return S;var se=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof b=="number"){var he=b<0?-Y(-b):Y(b);if(he!==b){var ce=String(he),X=k.call(S,ce.length+1);return x.call(ce,se,"$&_")+"."+x.call(x.call(X,/([0-9]{3})/g,"$&_"),/_$/,"")}}return x.call(S,se,"$&_")}var J=vu,re=J.custom,pe=oe(re)?re:null,ke={__proto__:null,double:'"',single:"'"},De={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};mr=function b(S,se,he,ce){var X=se||{};if(Pe(X,"quoteStyle")&&!Pe(ke,X.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Pe(X,"maxStringLength")&&(typeof X.maxStringLength=="number"?X.maxStringLength<0&&X.maxStringLength!==1/0:X.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var ct=Pe(X,"customInspect")?X.customInspect:!0;if(typeof ct!="boolean"&&ct!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Pe(X,"indent")&&X.indent!==null&&X.indent!=="	"&&!(parseInt(X.indent,10)===X.indent&&X.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Pe(X,"numericSeparator")&&typeof X.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Tt=X.numericSeparator;if(typeof S>"u")return"undefined";if(S===null)return"null";if(typeof S=="boolean")return S?"true":"false";if(typeof S=="string")return $e(S,X);if(typeof S=="number"){if(S===0)return 1/0/S>0?"0":"-0";var Le=String(S);return Tt?ie(S,Le):Le}if(typeof S=="bigint"){var ut=String(S)+"n";return Tt?ie(S,ut):ut}var ms=typeof X.depth>"u"?5:X.depth;if(typeof he>"u"&&(he=0),he>=ms&&ms>0&&typeof S=="object")return q(S)?"[Array]":"[Object]";var Nt=wh(X,he);if(typeof ce>"u")ce=[];else if(lt(ce,S)>=0)return"[Circular]";function Ue($t,Oi,xh){if(Oi&&(ce=M.call(ce),ce.push(Oi)),xh){var Vn={depth:X.depth};return Pe(X,"quoteStyle")&&(Vn.quoteStyle=X.quoteStyle),b($t,Vn,he+1,ce)}return b($t,X,he+1,ce)}if(typeof S=="function"&&!W(S)){var Wn=wt(S),Gn=ki(S,Ue);return"[Function"+(Wn?": "+Wn:" (anonymous)")+"]"+(Gn.length>0?" { "+N.call(Gn,", ")+" }":"")}if(oe(S)){var zn=Oe?x.call(String(S),/^(Symbol\(.*\))_[^)]*$/,"$1"):ne.call(S);return typeof S=="object"&&!Oe?We(zn):zn}if(It(S)){for(var li="<"+A.call(String(S.nodeName)),vs=S.attributes||[],Ei=0;Ei<vs.length;Ei++)li+=" "+vs[Ei].name+"="+O(P(vs[Ei].value),"double",X);return li+=">",S.childNodes&&S.childNodes.length&&(li+="..."),li+="</"+A.call(String(S.nodeName))+">",li}if(q(S)){if(S.length===0)return"[]";var bs=ki(S,Ue);return Nt&&!bh(bs)?"["+ys(bs,Nt)+"]":"[ "+N.call(bs,", ")+" ]"}if(Z(S)){var ws=ki(S,Ue);return!("cause"in Error.prototype)&&"cause"in S&&!Ke.call(S,"cause")?"{ ["+String(S)+"] "+N.call(K.call("[cause]: "+Ue(S.cause),ws),", ")+" }":ws.length===0?"["+String(S)+"]":"{ ["+String(S)+"] "+N.call(ws,", ")+" }"}if(typeof S=="object"&&ct){if(pe&&typeof S[pe]=="function"&&J)return J(S,{depth:ms-he});if(ct!=="symbol"&&typeof S.inspect=="function")return S.inspect()}if(St(S)){var jn=[];return s&&s.call(S,function($t,Oi){jn.push(Ue(Oi,S,!0)+" => "+Ue($t,S))}),$n("Map",e.call(S),jn,Nt)}if(Et(S)){var Hn=[];return o&&o.call(S,function($t){Hn.push(Ue($t,S))}),$n("Set",a.call(S),Hn,Nt)}if(xt(S))return Ft("WeakMap");if(Ot(S))return Ft("WeakSet");if(kt(S))return Ft("WeakRef");if(te(S))return We(Ue(Number(S)));if(He(S))return We(Ue(Q.call(S)));if(j(S))return We(v.call(S));if(ee(S))return We(Ue(String(S)));if(typeof window<"u"&&S===window)return"{ [object Window] }";if(typeof globalThis<"u"&&S===globalThis||typeof Xi<"u"&&S===Xi)return"{ [object globalThis] }";if(!$(S)&&!W(S)){var Ss=ki(S,Ue),Un=ve?ve(S)===Object.prototype:S instanceof Object||S.constructor===Object,xs=S instanceof Object?"":"null prototype",qn=!Un&&de&&Object(S)===S&&de in S?k.call(Re(S),8,-1):xs?"Object":"",Sh=Un||typeof S.constructor!="function"?"":S.constructor.name?S.constructor.name+" ":"",ks=Sh+(qn||xs?"["+N.call(K.call([],qn||[],xs||[]),": ")+"] ":"");return Ss.length===0?ks+"{}":Nt?ks+"{"+ys(Ss,Nt)+"}":ks+"{ "+N.call(Ss,", ")+" }"}return String(S)};function O(b,S,se){var he=se.quoteStyle||S,ce=ke[he];return ce+b+ce}function P(b){return x.call(String(b),/"/g,"&quot;")}function q(b){return Re(b)==="[object Array]"&&(!de||!(typeof b=="object"&&de in b))}function $(b){return Re(b)==="[object Date]"&&(!de||!(typeof b=="object"&&de in b))}function W(b){return Re(b)==="[object RegExp]"&&(!de||!(typeof b=="object"&&de in b))}function Z(b){return Re(b)==="[object Error]"&&(!de||!(typeof b=="object"&&de in b))}function ee(b){return Re(b)==="[object String]"&&(!de||!(typeof b=="object"&&de in b))}function te(b){return Re(b)==="[object Number]"&&(!de||!(typeof b=="object"&&de in b))}function j(b){return Re(b)==="[object Boolean]"&&(!de||!(typeof b=="object"&&de in b))}function oe(b){if(Oe)return b&&typeof b=="object"&&b instanceof Symbol;if(typeof b=="symbol")return!0;if(!b||typeof b!="object"||!ne)return!1;try{return ne.call(b),!0}catch{}return!1}function He(b){if(!b||typeof b!="object"||!Q)return!1;try{return Q.call(b),!0}catch{}return!1}var Te=Object.prototype.hasOwnProperty||function(b){return b in this};function Pe(b,S){return Te.call(b,S)}function Re(b){return y.call(b)}function wt(b){if(b.name)return b.name;var S=w.call(m.call(b),/^function\s*([\w$]+)/);return S?S[1]:null}function lt(b,S){if(b.indexOf)return b.indexOf(S);for(var se=0,he=b.length;se<he;se++)if(b[se]===S)return se;return-1}function St(b){if(!e||!b||typeof b!="object")return!1;try{e.call(b);try{a.call(b)}catch{return!0}return b instanceof Map}catch{}return!1}function xt(b){if(!h||!b||typeof b!="object")return!1;try{h.call(b,h);try{c.call(b,c)}catch{return!0}return b instanceof WeakMap}catch{}return!1}function kt(b){if(!g||!b||typeof b!="object")return!1;try{return g.call(b),!0}catch{}return!1}function Et(b){if(!a||!b||typeof b!="object")return!1;try{a.call(b);try{e.call(b)}catch{return!0}return b instanceof Set}catch{}return!1}function Ot(b){if(!c||!b||typeof b!="object")return!1;try{c.call(b,c);try{h.call(b,h)}catch{return!0}return b instanceof WeakSet}catch{}return!1}function It(b){return!b||typeof b!="object"?!1:typeof HTMLElement<"u"&&b instanceof HTMLElement?!0:typeof b.nodeName=="string"&&typeof b.getAttribute=="function"}function $e(b,S){if(b.length>S.maxStringLength){var se=b.length-S.maxStringLength,he="... "+se+" more character"+(se>1?"s":"");return $e(k.call(b,0,S.maxStringLength),S)+he}var ce=De[S.quoteStyle||"single"];ce.lastIndex=0;var X=x.call(x.call(b,ce,"\\$1"),/[\x00-\x1f]/g,ht);return O(X,"single",S)}function ht(b){var S=b.charCodeAt(0),se={8:"b",9:"t",10:"n",12:"f",13:"r"}[S];return se?"\\"+se:"\\x"+(S<16?"0":"")+T.call(S.toString(16))}function We(b){return"Object("+b+")"}function Ft(b){return b+" { ? }"}function $n(b,S,se,he){var ce=he?ys(se,he):N.call(se,", ");return b+" ("+S+") {"+ce+"}"}function bh(b){for(var S=0;S<b.length;S++)if(lt(b[S],`
`)>=0)return!1;return!0}function wh(b,S){var se;if(b.indent==="	")se="	";else if(typeof b.indent=="number"&&b.indent>0)se=N.call(Array(b.indent+1)," ");else return null;return{base:se,prev:N.call(Array(S+1),se)}}function ys(b,S){if(b.length===0)return"";var se=`
`+S.prev+S.base;return se+N.call(b,","+se)+`
`+S.prev}function ki(b,S){var se=q(b),he=[];if(se){he.length=b.length;for(var ce=0;ce<b.length;ce++)he[ce]=Pe(b,ce)?S(b[ce],b):""}var X=typeof ae=="function"?ae(b):[],ct;if(Oe){ct={};for(var Tt=0;Tt<X.length;Tt++)ct["$"+X[Tt]]=X[Tt]}for(var Le in b)Pe(b,Le)&&(se&&String(Number(Le))===Le&&Le<b.length||Oe&&ct["$"+Le]instanceof Symbol||(F.call(/[^\w$]/,Le)?he.push(S(Le,b)+": "+S(b[Le],b)):he.push(Le+": "+S(b[Le],b))));if(typeof ae=="function")for(var ut=0;ut<X.length;ut++)Ke.call(b,X[ut])&&he.push("["+S(X[ut])+"]: "+S(b[X[ut]],b));return he}return mr}var vr,ao;function Nl(){if(ao)return vr;ao=1;var t=it(),i=je(),e=bu(),s=bt(),r=t("%WeakMap%",!0),n=t("%Map%",!0),a=i("WeakMap.prototype.get",!0),o=i("WeakMap.prototype.set",!0),l=i("WeakMap.prototype.has",!0),h=i("Map.prototype.get",!0),u=i("Map.prototype.set",!0),c=i("Map.prototype.has",!0),p=function(m,w){for(var k=m,x;(x=k.next)!==null;k=x)if(x.key===w)return k.next=x.next,x.next=m.next,m.next=x,x},g=function(m,w){var k=p(m,w);return k&&k.value},v=function(m,w,k){var x=p(m,w);x?x.value=k:m.next={key:w,next:m.next,value:k}},y=function(m,w){return!!p(m,w)};return vr=function(){var w,k,x,T={assert:function(A){if(!T.has(A))throw new s("Side channel does not contain "+e(A))},get:function(A){if(r&&A&&(typeof A=="object"||typeof A=="function")){if(w)return a(w,A)}else if(n){if(k)return h(k,A)}else if(x)return g(x,A)},has:function(A){if(r&&A&&(typeof A=="object"||typeof A=="function")){if(w)return l(w,A)}else if(n){if(k)return c(k,A)}else if(x)return y(x,A);return!1},set:function(A,F){r&&A&&(typeof A=="object"||typeof A=="function")?(w||(w=new r),o(w,A,F)):n?(k||(k=new n),u(k,A,F)):(x||(x={key:{},next:null}),v(x,A,F))}};return T},vr}var br,oo;function wu(){if(oo)return br;oo=1;var t=Ml(),i=Nl()(),e=bt(),s={assert:function(r,n){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");if(i.assert(r),!s.has(r,n))throw new e("`"+n+"` is not present on `O`")},get:function(r,n){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");var a=i.get(r);return a&&a["$"+n]},has:function(r,n){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");var a=i.get(r);return!!a&&t(a,"$"+n)},set:function(r,n,a){if(!r||typeof r!="object"&&typeof r!="function")throw new e("`O` is not an object");if(typeof n!="string")throw new e("`slot` must be a string");var o=i.get(r);o||(o={},i.set(r,o)),o["$"+n]=a}};return Object.freeze&&Object.freeze(s),br=s,br}var wr,lo;function Su(){if(lo)return wr;lo=1;var t=wu(),i=SyntaxError,e=typeof StopIteration=="object"?StopIteration:null;return wr=function(r){if(!e)throw new i("this environment lacks StopIteration");t.set(r,"[[Done]]",!1);var n={next:function(){var o=t.get(this,"[[Iterator]]"),l=t.get(o,"[[Done]]");try{return{done:l,value:l?void 0:o.next()}}catch(h){if(t.set(o,"[[Done]]",!0),h!==e)throw h;return{done:!0,value:void 0}}}};return t.set(n,"[[Iterator]]",r),n},wr}var Sr,ho;function $l(){if(ho)return Sr;ho=1;var t={}.toString;return Sr=Array.isArray||function(i){return t.call(i)=="[object Array]"},Sr}var xr,co;function Wl(){if(co)return xr;co=1;var t=String.prototype.valueOf,i=function(a){try{return t.call(a),!0}catch{return!1}},e=Object.prototype.toString,s="[object String]",r=Bt()();return xr=function(a){return typeof a=="string"?!0:typeof a!="object"?!1:r?i(a):e.call(a)===s},xr}var kr,uo;function Gl(){if(uo)return kr;uo=1;var t=typeof Map=="function"&&Map.prototype?Map:null,i=typeof Set=="function"&&Set.prototype?Set:null,e;t||(e=function(a){return!1});var s=t?Map.prototype.has:null,r=i?Set.prototype.has:null;return!e&&!s&&(e=function(a){return!1}),kr=e||function(a){if(!a||typeof a!="object")return!1;try{if(s.call(a),r)try{r.call(a)}catch{return!0}return a instanceof t}catch{}return!1},kr}var Er,fo;function zl(){if(fo)return Er;fo=1;var t=typeof Map=="function"&&Map.prototype?Map:null,i=typeof Set=="function"&&Set.prototype?Set:null,e;i||(e=function(a){return!1});var s=t?Map.prototype.has:null,r=i?Set.prototype.has:null;return!e&&!r&&(e=function(a){return!1}),Er=e||function(a){if(!a||typeof a!="object")return!1;try{if(r.call(a),s)try{s.call(a)}catch{return!0}return a instanceof i}catch{}return!1},Er}var po;function xu(){if(po)return hi.exports;po=1;var t=Fl(),i=Su();if(Sn()()||os()()){var e=Symbol.iterator;hi.exports=function(M){if(M!=null&&typeof M[e]<"u")return M[e]();if(t(M))return Array.prototype[e].call(M)}}else{var s=$l(),r=Wl(),n=it(),a=n("%Map%",!0),o=n("%Set%",!0),l=je(),h=l("Array.prototype.push"),u=l("String.prototype.charCodeAt"),c=l("String.prototype.slice"),p=function(M,Y){var Q=M.length;if(Y+1>=Q)return Y+1;var ae=u(M,Y);if(ae<55296||ae>56319)return Y+1;var ne=u(M,Y+1);return ne<56320||ne>57343?Y+1:Y+2},g=function(M){var Y=0;return{next:function(){var ae=Y>=M.length,ne;return ae||(ne=M[Y],Y+=1),{done:ae,value:ne}}}},v=function(M,Y){if(s(M)||t(M))return g(M);if(r(M)){var Q=0;return{next:function(){var ne=p(M,Q),Oe=c(M,Q,ne);return Q=ne,{done:ne>M.length,value:Oe}}}}if(Y&&typeof M["_es6-shim iterator_"]<"u")return M["_es6-shim iterator_"]()};if(!a&&!o)hi.exports=function(M){if(M!=null)return v(M,!0)};else{var y=Gl(),m=zl(),w=l("Map.prototype.forEach",!0),k=l("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var x=l("Map.prototype.iterator",!0),T=l("Set.prototype.iterator",!0);var A=l("Map.prototype.@@iterator",!0)||l("Map.prototype._es6-shim iterator_",!0),F=l("Set.prototype.@@iterator",!0)||l("Set.prototype._es6-shim iterator_",!0),K=function(M){if(y(M)){if(x)return i(x(M));if(A)return A(M);if(w){var Y=[];return w(M,function(ae,ne){h(Y,[ne,ae])}),g(Y)}}if(m(M)){if(T)return i(T(M));if(F)return F(M);if(k){var Q=[];return k(M,function(ae){h(Q,ae)}),g(Q)}}};hi.exports=function(M){return K(M)||v(M)}}}return hi.exports}var Or,go;function jl(){if(go)return Or;go=1;var t=function(i){return i!==i};return Or=function(e,s){return e===0&&s===0?1/e===1/s:!!(e===s||t(e)&&t(s))},Or}var Ir,yo;function Hl(){if(yo)return Ir;yo=1;var t=jl();return Ir=function(){return typeof Object.is=="function"?Object.is:t},Ir}var Tr,mo;function ku(){if(mo)return Tr;mo=1;var t=Hl(),i=Lt();return Tr=function(){var s=t();return i(Object,{is:s},{is:function(){return Object.is!==s}}),s},Tr}var Pr,vo;function Eu(){if(vo)return Pr;vo=1;var t=Lt(),i=ri(),e=jl(),s=Hl(),r=ku(),n=i(s(),Object);return t(n,{getPolyfill:s,implementation:e,shim:r}),Pr=n,Pr}var Cr,bo;function Ul(){if(bo)return Cr;bo=1;var t=ri(),i=je(),e=it(),s=e("%ArrayBuffer%",!0),r=i("ArrayBuffer.prototype.byteLength",!0),n=i("Object.prototype.toString"),a=!!s&&!r&&new s(0).slice,o=!!a&&t(a);return Cr=r||o?function(h){if(!h||typeof h!="object")return!1;try{return r?r(h):o(h,0),!0}catch{return!1}}:s?function(h){return n(h)==="[object ArrayBuffer]"}:function(h){return!1},Cr}var Ar,wo;function Ou(){if(wo)return Ar;wo=1;var t=Date.prototype.getDay,i=function(a){try{return t.call(a),!0}catch{return!1}},e=Object.prototype.toString,s="[object Date]",r=Bt()();return Ar=function(a){return typeof a!="object"||a===null?!1:r?i(a):e.call(a)===s},Ar}var Rr,So;function Iu(){if(So)return Rr;So=1;var t=je(),i=Bt()(),e,s,r,n;if(i){e=t("Object.prototype.hasOwnProperty"),s=t("RegExp.prototype.exec"),r={};var a=function(){throw r};n={toString:a,valueOf:a},typeof Symbol.toPrimitive=="symbol"&&(n[Symbol.toPrimitive]=a)}var o=t("Object.prototype.toString"),l=Object.getOwnPropertyDescriptor,h="[object RegExp]";return Rr=i?function(c){if(!c||typeof c!="object")return!1;var p=l(c,"lastIndex"),g=p&&e(p,"value");if(!g)return!1;try{s(c,n)}catch(v){return v===r}}:function(c){return!c||typeof c!="object"&&typeof c!="function"?!1:o(c)===h},Rr}var Mr,xo;function Tu(){if(xo)return Mr;xo=1;var t=je(),i=t("SharedArrayBuffer.prototype.byteLength",!0);return Mr=i?function(s){if(!s||typeof s!="object")return!1;try{return i(s),!0}catch{return!1}}:function(s){return!1},Mr}var _r,ko;function Pu(){if(ko)return _r;ko=1;var t=Number.prototype.toString,i=function(a){try{return t.call(a),!0}catch{return!1}},e=Object.prototype.toString,s="[object Number]",r=Bt()();return _r=function(a){return typeof a=="number"?!0:typeof a!="object"?!1:r?i(a):e.call(a)===s},_r}var Dr,Eo;function Cu(){if(Eo)return Dr;Eo=1;var t=je(),i=t("Boolean.prototype.toString"),e=t("Object.prototype.toString"),s=function(o){try{return i(o),!0}catch{return!1}},r="[object Boolean]",n=Bt()();return Dr=function(o){return typeof o=="boolean"?!0:o===null||typeof o!="object"?!1:n&&Symbol.toStringTag in o?s(o):e(o)===r},Dr}var Ri={exports:{}},Oo;function Au(){if(Oo)return Ri.exports;Oo=1;var t=Object.prototype.toString,i=Sn()();if(i){var e=Symbol.prototype.toString,s=/^Symbol\(.*\)$/,r=function(a){return typeof a.valueOf()!="symbol"?!1:s.test(e.call(a))};Ri.exports=function(a){if(typeof a=="symbol")return!0;if(t.call(a)!=="[object Symbol]")return!1;try{return r(a)}catch{return!1}}}else Ri.exports=function(a){return!1};return Ri.exports}var Mi={exports:{}},Lr,Io;function Ru(){if(Io)return Lr;Io=1;var t=typeof BigInt<"u"&&BigInt;return Lr=function(){return typeof t=="function"&&typeof BigInt=="function"&&typeof t(42)=="bigint"&&typeof BigInt(42)=="bigint"},Lr}var To;function Mu(){if(To)return Mi.exports;To=1;var t=Ru()();if(t){var i=BigInt.prototype.valueOf,e=function(r){try{return i.call(r),!0}catch{}return!1};Mi.exports=function(r){return r===null||typeof r>"u"||typeof r=="boolean"||typeof r=="string"||typeof r=="number"||typeof r=="symbol"||typeof r=="function"?!1:typeof r=="bigint"?!0:e(r)}}else Mi.exports=function(r){return!1};return Mi.exports}var Br,Po;function _u(){if(Po)return Br;Po=1;var t=Wl(),i=Pu(),e=Cu(),s=Au(),r=Mu();return Br=function(a){if(a==null||typeof a!="object"&&typeof a!="function")return null;if(t(a))return"String";if(i(a))return"Number";if(e(a))return"Boolean";if(s(a))return"Symbol";if(r(a))return"BigInt"},Br}var Fr,Co;function Du(){if(Co)return Fr;Co=1;var t=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,i=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,e;t||(e=function(a){return!1});var s=t?t.prototype.has:null,r=i?i.prototype.has:null;return!e&&!s&&(e=function(a){return!1}),Fr=e||function(a){if(!a||typeof a!="object")return!1;try{if(s.call(a,s),r)try{r.call(a,r)}catch{return!0}return a instanceof t}catch{}return!1},Fr}var _i={exports:{}},Ao;function Lu(){if(Ao)return _i.exports;Ao=1;var t=it(),i=je(),e=t("%WeakSet%",!0),s=i("WeakSet.prototype.has",!0);if(s){var r=i("WeakMap.prototype.has",!0);_i.exports=function(a){if(!a||typeof a!="object")return!1;try{if(s(a,s),r)try{r(a,r)}catch{return!0}return a instanceof e}catch{}return!1}}else _i.exports=function(a){return!1};return _i.exports}var Nr,Ro;function Bu(){if(Ro)return Nr;Ro=1;var t=Gl(),i=zl(),e=Du(),s=Lu();return Nr=function(n){if(n&&typeof n=="object"){if(t(n))return"Map";if(i(n))return"Set";if(e(n))return"WeakMap";if(s(n))return"WeakSet"}return!1},Nr}var $r,Mo;function Fu(){if(Mo)return $r;Mo=1;var t=Function.prototype.toString,i=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,e,s;if(typeof i=="function"&&typeof Object.defineProperty=="function")try{e=Object.defineProperty({},"length",{get:function(){throw s}}),s={},i(function(){throw 42},null,e)}catch(k){k!==s&&(i=null)}else i=null;var r=/^\s*class\b/,n=function(x){try{var T=t.call(x);return r.test(T)}catch{return!1}},a=function(x){try{return n(x)?!1:(t.call(x),!0)}catch{return!1}},o=Object.prototype.toString,l="[object Object]",h="[object Function]",u="[object GeneratorFunction]",c="[object HTMLAllCollection]",p="[object HTML document.all class]",g="[object HTMLCollection]",v=typeof Symbol=="function"&&!!Symbol.toStringTag,y=!(0 in[,]),m=function(){return!1};if(typeof document=="object"){var w=document.all;o.call(w)===o.call(document.all)&&(m=function(x){if((y||!x)&&(typeof x>"u"||typeof x=="object"))try{var T=o.call(x);return(T===c||T===p||T===g||T===l)&&x("")==null}catch{}return!1})}return $r=i?function(x){if(m(x))return!0;if(!x||typeof x!="function"&&typeof x!="object")return!1;try{i(x,null,e)}catch(T){if(T!==s)return!1}return!n(x)&&a(x)}:function(x){if(m(x))return!0;if(!x||typeof x!="function"&&typeof x!="object")return!1;if(v)return a(x);if(n(x))return!1;var T=o.call(x);return T!==h&&T!==u&&!/^\[object HTML/.test(T)?!1:a(x)},$r}var Wr,_o;function Nu(){if(_o)return Wr;_o=1;var t=Fu(),i=Object.prototype.toString,e=Object.prototype.hasOwnProperty,s=function(l,h,u){for(var c=0,p=l.length;c<p;c++)e.call(l,c)&&(u==null?h(l[c],c,l):h.call(u,l[c],c,l))},r=function(l,h,u){for(var c=0,p=l.length;c<p;c++)u==null?h(l.charAt(c),c,l):h.call(u,l.charAt(c),c,l)},n=function(l,h,u){for(var c in l)e.call(l,c)&&(u==null?h(l[c],c,l):h.call(u,l[c],c,l))},a=function(l,h,u){if(!t(h))throw new TypeError("iterator must be a function");var c;arguments.length>=3&&(c=u),i.call(l)==="[object Array]"?s(l,h,c):typeof l=="string"?r(l,h,c):n(l,h,c)};return Wr=a,Wr}var Gr,Do;function $u(){return Do||(Do=1,Gr=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),Gr}var zr,Lo;function Wu(){if(Lo)return zr;Lo=1;var t=$u(),i=typeof globalThis>"u"?Xi:globalThis;return zr=function(){for(var s=[],r=0;r<t.length;r++)typeof i[t[r]]=="function"&&(s[s.length]=t[r]);return s},zr}var jr,Bo;function Gu(){if(Bo)return jr;Bo=1;var t=Nu(),i=Wu(),e=ri(),s=je(),r=En(),n=s("Object.prototype.toString"),a=Bt()(),o=typeof globalThis>"u"?Xi:globalThis,l=i(),h=s("String.prototype.slice"),u=Object.getPrototypeOf,c=s("Array.prototype.indexOf",!0)||function(m,w){for(var k=0;k<m.length;k+=1)if(m[k]===w)return k;return-1},p={__proto__:null};a&&r&&u?t(l,function(y){var m=new o[y];if(Symbol.toStringTag in m){var w=u(m),k=r(w,Symbol.toStringTag);if(!k){var x=u(w);k=r(x,Symbol.toStringTag)}p["$"+y]=e(k.get)}}):t(l,function(y){var m=new o[y],w=m.slice||m.set;w&&(p["$"+y]=e(w))});var g=function(m){var w=!1;return t(p,function(k,x){if(!w)try{"$"+k(m)===x&&(w=h(x,1))}catch{}}),w},v=function(m){var w=!1;return t(p,function(k,x){if(!w)try{k(m),w=h(x,1)}catch{}}),w};return jr=function(m){if(!m||typeof m!="object")return!1;if(!a){var w=h(n(m),8,-1);return c(l,w)>-1?w:w!=="Object"?!1:v(m)}return r?g(m):null},jr}var Hr,Fo;function zu(){if(Fo)return Hr;Fo=1;var t=je(),i=t("ArrayBuffer.prototype.byteLength",!0),e=Ul();return Hr=function(r){return e(r)?i?i(r):r.byteLength:NaN},Hr}var Ur,No;function ju(){if(No)return Ur;No=1;var t=uu(),i=je(),e=gu(),s=it(),r=xu(),n=Nl(),a=Eu(),o=Fl(),l=$l(),h=Ul(),u=Ou(),c=Iu(),p=Tu(),g=wn(),v=_u(),y=Bu(),m=Gu(),w=zu(),k=i("SharedArrayBuffer.prototype.byteLength",!0),x=i("Date.prototype.getTime"),T=Object.getPrototypeOf,A=i("Object.prototype.toString"),F=s("%Set%",!0),K=i("Map.prototype.has",!0),N=i("Map.prototype.get",!0),M=i("Map.prototype.size",!0),Y=i("Set.prototype.add",!0),Q=i("Set.prototype.delete",!0),ae=i("Set.prototype.has",!0),ne=i("Set.prototype.size",!0);function Oe(O,P,q,$){for(var W=r(O),Z;(Z=W.next())&&!Z.done;)if(J(P,Z.value,q,$))return Q(O,Z.value),!0;return!1}function de(O){if(typeof O>"u")return null;if(typeof O!="object")return typeof O=="symbol"?!1:typeof O=="string"||typeof O=="number"?+O==+O:!0}function Ke(O,P,q,$,W,Z){var ee=de(q);if(ee!=null)return ee;var te=N(P,ee),j=t({},W,{strict:!1});return typeof te>"u"&&!K(P,ee)||!J($,te,j,Z)?!1:!K(O,ee)&&J($,te,j,Z)}function ve(O,P,q){var $=de(q);return $??(ae(P,$)&&!ae(O,$))}function ie(O,P,q,$,W,Z){for(var ee=r(O),te,j;(te=ee.next())&&!te.done;)if(j=te.value,J(q,j,W,Z)&&J($,N(P,j),W,Z))return Q(O,j),!0;return!1}function J(O,P,q,$){var W=q||{};if(W.strict?a(O,P):O===P)return!0;var Z=v(O),ee=v(P);if(Z!==ee)return!1;if(!O||!P||typeof O!="object"&&typeof P!="object")return W.strict?a(O,P):O==P;var te=$.has(O),j=$.has(P),oe;if(te&&j){if($.get(O)===$.get(P))return!0}else oe={};return te||$.set(O,oe),j||$.set(P,oe),De(O,P,W,$)}function re(O){return!O||typeof O!="object"||typeof O.length!="number"||typeof O.copy!="function"||typeof O.slice!="function"||O.length>0&&typeof O[0]!="number"?!1:!!(O.constructor&&O.constructor.isBuffer&&O.constructor.isBuffer(O))}function pe(O,P,q,$){if(ne(O)!==ne(P))return!1;for(var W=r(O),Z=r(P),ee,te,j;(ee=W.next())&&!ee.done;)if(ee.value&&typeof ee.value=="object")j||(j=new F),Y(j,ee.value);else if(!ae(P,ee.value)){if(q.strict||!ve(O,P,ee.value))return!1;j||(j=new F),Y(j,ee.value)}if(j){for(;(te=Z.next())&&!te.done;)if(te.value&&typeof te.value=="object"){if(!Oe(j,te.value,q.strict,$))return!1}else if(!q.strict&&!ae(O,te.value)&&!Oe(j,te.value,q.strict,$))return!1;return ne(j)===0}return!0}function ke(O,P,q,$){if(M(O)!==M(P))return!1;for(var W=r(O),Z=r(P),ee,te,j,oe,He,Te;(ee=W.next())&&!ee.done;)if(oe=ee.value[0],He=ee.value[1],oe&&typeof oe=="object")j||(j=new F),Y(j,oe);else if(Te=N(P,oe),typeof Te>"u"&&!K(P,oe)||!J(He,Te,q,$)){if(q.strict||!Ke(O,P,oe,He,q,$))return!1;j||(j=new F),Y(j,oe)}if(j){for(;(te=Z.next())&&!te.done;)if(oe=te.value[0],Te=te.value[1],oe&&typeof oe=="object"){if(!ie(j,O,oe,Te,q,$))return!1}else if(!q.strict&&(!O.has(oe)||!J(N(O,oe),Te,q,$))&&!ie(j,O,oe,Te,t({},q,{strict:!1}),$))return!1;return ne(j)===0}return!0}function De(O,P,q,$){var W,Z;if(typeof O!=typeof P||O==null||P==null||A(O)!==A(P)||o(O)!==o(P))return!1;var ee=l(O),te=l(P);if(ee!==te)return!1;var j=O instanceof Error,oe=P instanceof Error;if(j!==oe||(j||oe)&&(O.name!==P.name||O.message!==P.message))return!1;var He=c(O),Te=c(P);if(He!==Te||(He||Te)&&(O.source!==P.source||e(O)!==e(P)))return!1;var Pe=u(O),Re=u(P);if(Pe!==Re||(Pe||Re)&&x(O)!==x(P)||q.strict&&T&&T(O)!==T(P))return!1;var wt=m(O),lt=m(P);if(wt!==lt)return!1;if(wt||lt){if(O.length!==P.length)return!1;for(W=0;W<O.length;W++)if(O[W]!==P[W])return!1;return!0}var St=re(O),xt=re(P);if(St!==xt)return!1;if(St||xt){if(O.length!==P.length)return!1;for(W=0;W<O.length;W++)if(O[W]!==P[W])return!1;return!0}var kt=h(O),Et=h(P);if(kt!==Et)return!1;if(kt||Et)return w(O)!==w(P)?!1:typeof Uint8Array=="function"&&J(new Uint8Array(O),new Uint8Array(P),q,$);var Ot=p(O),It=p(P);if(Ot!==It)return!1;if(Ot||It)return k(O)!==k(P)?!1:typeof Uint8Array=="function"&&J(new Uint8Array(O),new Uint8Array(P),q,$);if(typeof O!=typeof P)return!1;var $e=g(O),ht=g(P);if($e.length!==ht.length)return!1;for($e.sort(),ht.sort(),W=$e.length-1;W>=0;W--)if($e[W]!=ht[W])return!1;for(W=$e.length-1;W>=0;W--)if(Z=$e[W],!J(O[Z],P[Z],q,$))return!1;var We=y(O),Ft=y(P);return We!==Ft?!1:We==="Set"||Ft==="Set"?pe(O,P,q,$):We==="Map"?ke(O,P,q,$):!0}return Ur=function(P,q,$){return J(P,q,$,n())},Ur}var Hu=ju();const Uu=Th(Hu);class Ne extends E.GameObjects.Text{constructor(i,e,s=3500,r=_.Slate){const n=ni(i,Ne).reduce((a,o)=>Math.max(a,o.y-20),0)+65;super(i,20,n,e,{...ue,backgroundColor:"#"+r,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(V.Overlay).setScrollFactor(0),i.add.existing(this),i.add.tween({targets:this,alpha:1,scale:1.05,y:n+10,duration:350,hold:s,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}function ei(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal.sort(),inventory:t.player.inventory.inventory.sort((e,s)=>e.type-s.type),quests:t.player.quests.quests.sort((e,s)=>e.id-s.id),gameState:t.player.gameState.data,settings:{gamepad:t.gamepad.visible,debug:f.debug,zoomed:f.zoomed,useShader:f.useShader,time:Date.now(),muted:t.sound.mute}}}function Tn(){const t=localStorage.getItem(tt);let i,e;try{t&&(i=JSON.parse(t))}catch(s){console.error(s),e=s}return{save:i||ti[mt.New],error:e,newGame:!i}}const qu={journal:{enumObj:D,enumName:"JournalEntry"},inventory:{enumObj:I,enumName:"ItemType"},type:{enumObj:I,enumName:"ItemType"},quests:{enumObj:B,enumName:"QuestType"},id:{enumObj:B,enumName:"QuestType"}};function Vu(t){return JSON.stringify(t,(e,s)=>{const r=qu[e];return Array.isArray(s)&&r?s.map(n=>ba(n,r.enumObj,r.enumName)):r?ba(s,r.enumObj,r.enumName):s},2).replace(/"(\w+\.\w+)"/g,"$1")}function ql(t,i){const e={...f};return f.debug=t.settings.debug,f.zoomed=t.settings.zoomed,f.useShader=t.settings.useShader,An(f.useShader),hs(i,!1,!0),f.zoomed!==e.zoomed?(Kc(i,f.zoomed),!0):f.debug!==e.debug?(i.scene.restart(),!0):!1}function Xu(t){const{save:i}=Tn();try{return ql(i,t)}catch(e){console.error(e)}return!1}function ln(t){const{save:i,error:e,newGame:s}=Tn();e&&new Ne(t,`Unfortunately, it looks like this save is corrupted.
Failed to Load Game`,1e4);try{ql(i,t),t.sound.stopAll(),t.sound.mute=i.settings.muted,t.player.setX(i.player.x),t.player.setY(i.player.y),t.player.previousPosition.set(i.player.x+(i.player.flip?1:-1),i.player.y),t.time.delayedCall(50,()=>{try{const{inventory:r,quests:n,journal:a,gameState:o}=t.player;t.player.inventory.createUI(),t.player.quests.createUI(),t.player.journal.createUI(),s?ed(t):(i.inventory.sort((l,h)=>l.type-h.type).forEach(l=>r.addItem(l,!0)),i.journal.sort().reverse().forEach(l=>a.addEntry(l,!0)),i.quests.sort((l,h)=>l.id-h.id).forEach(l=>n.addQuest(l,!0)),o.updateData(i.gameState,!0))}catch(r){console.error(r),new Ne(t,`Unfortunately, it looks like this save is corrupted.
Failed to Load Game`,1e4,_.Warning),rt(t,ti[mt.New]),ln(t)}}),t.gamepad.setVisible(i.settings.gamepad),Uu(i,ti[mt.New])&&rt(t,void 0,!0)}catch(r){console.error(r),new Ne(t,`Unfortunately, it looks like this save is corrupted.
Failed to Load Game`,1e4,_.Warning),rt(t,ti[mt.New]),ln(t)}}function rt(t,i,e){const s=ei(t);localStorage.setItem(tt,JSON.stringify(i||s)),e||t.tweens.add({targets:t.saveIcon,alpha:.7,scale:.6,duration:500,hold:250,yoyo:!0,onComplete:()=>t.saveIcon.setAlpha(0)})}function ls(t){f.prod&&rt(t)}const Yu=`precision mediump float;

uniform float     uAlpha;
uniform float     uChromaticAberration;

uniform sampler2D uMainSampler;

varying vec2 outTexCoord;

// slight modifications made to original shader
// use alpha channel for fragColor + changed uniform names

// original shader from: https://www.shadertoy.com/view/WsVSzV
// tips for chromatic aberration: https://lettier.github.io/3d-game-shaders-for-beginners/chromatic-aberration.html

const float warp = 0.35;     // simulate curvature of CRT monitor (larger number = more curvature)
const float scan = 0.75;    // simulate darkness between scanlines
const float scanSize = 0.85; // size of scanlines [0.0 - 2.0] (smaller number = taller scanlines)

// TODO: Remove hardcoded screen size
vec2 pixels = vec2(floor(960. / uChromaticAberration / 2.), floor(540. / uChromaticAberration / 2.));

float chromaticAberration = 0.15 * uAlpha * uChromaticAberration;
float redOffset   =  0.006 * chromaticAberration;
float greenOffset =  0.003 * chromaticAberration;
float blueOffset  = -0.003 * chromaticAberration;

vec4 mainImage(in vec2 fragCoord, in vec2 uv) {
  if (uAlpha <= 0.0) {
    return texture2D(uMainSampler, uv);
  }

  // squared distance from center
  vec2 dc = abs(0.5-uv);
  dc *= dc;

  // warp the fragment coordinates
  uv.x -= 0.5; uv.x *= 1.0+(dc.y*(0.3*warp)); uv.x += 0.5;
  uv.y -= 0.5; uv.y *= 1.0+(dc.x*(0.4*warp)); uv.y += 0.5;

  vec2 chromaticOffset = vec2((abs(0.5-uv) + 0.5) * 2.);

  if (uChromaticAberration > 1.) {
    uv.x -= mod(uv.x, 1.0/pixels.x);
    uv.y -= mod(uv.y, 1.0/pixels.y);
  }

  vec4 color;
  color.r = texture2D(uMainSampler,uv + vec2(redOffset * chromaticOffset)).r;
  color.g = texture2D(uMainSampler,uv + vec2(greenOffset * chromaticOffset)).g;
  color.b = texture2D(uMainSampler,uv + vec2(blueOffset * chromaticOffset)).b;
  color.a = texture2D(uMainSampler,uv).a;

  // sample inside boundaries, otherwise set to black
  if (uv.y > 1.0 || uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0) {
      return vec4(0.0);
  } else {
    // determine if we are drawing in a scanline
    float apply = abs(sin(fragCoord.y * scanSize)*0.5*scan);

    apply = uAlpha * apply;

    // sample the texture
    return vec4(mix(color.rgb,vec3(0.0), apply), color.a);
  }
}

void main(void) {
  gl_FragColor = mainImage(gl_FragCoord.xy, outTexCoord);
}`;let Pn=1,Cn=1;class Vl extends E.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(i){super({game:i,renderTarget:!0,fragShader:Yu})}onPreRender(){this.set1f("uAlpha",Pn),this.set1f("uChromaticAberration",Cn)}}class Ku extends E.Plugins.ScenePlugin{boot(){var e;Pn=1,Cn=1,(e=this.systems)==null||e.events.on("start",this.applyPipeline,this);const{save:i}=Tn();An(i.settings.useShader)}applyPipeline(){var e,s;(e=this.scene)==null||e.cameras.main.setPostPipeline("CRTPipeline");const i=(s=this.scene)==null?void 0:s.cameras.main.getPostPipeline(Vl);i==null||i.bootFX()}}function An(t){t!==void 0?f.useShader=t:f.useShader=!f.useShader,Pn=f.useShader?1:0}function Ji(t){Cn=t}const Qu=`precision mediump float;

uniform float     uAlpha;
uniform sampler2D uMainSampler;

varying vec2 outTexCoord;

void main(void)
{
  vec4 baseColor = vec4(texture2D(uMainSampler, outTexCoord).rgba);
  vec4 newColor = baseColor;
  newColor.g *= 1.25;
  newColor.r *= 2.5;
  newColor.b *= 3.;

  gl_FragColor = mix(baseColor, newColor, uAlpha);
}`;let Rt=0;class Ju extends E.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(i){super({game:i,fragShader:Qu})}onPreRender(){this.set1f("uAlpha",Rt)}}function hs(t,i,e=!1){const s=i?.85:0;if(Ji(1),Rt===s)return;if(e){Rt=s;return}const r=i?0:1750;t.sound.playAudioSprite("sfx","xray",{rate:.85,delay:r/1e3}),t.tweens.addCounter({from:Rt,to:i?.85:0,onUpdate:n=>Rt=n.getValue(),duration:i?2500:1500,delay:r,ease:i?"Bounce":void 0}),t.tweens.addCounter({from:1,to:15,onUpdate:n=>Ji(n.getValue()),ease:"Bounce",duration:1e3,delay:r,yoyo:!0})}function Zu(t,i){const e=f.zoomed?.75:1,s=new Dn(t),r=t.add.text(f.width/2,f.height/2,"Later that day...",{...ue,fontSize:"42px"}).setOrigin(.5).setScrollFactor(0).setAlpha(0);i.setAngle(nn);const n=t.add.timeline([{at:1500,tween:{targets:i,x:850*e,duration:2500,onComplete:()=>i.anims.pause()},run:()=>{i.anims.resume(),t.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:3100,run:()=>t.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:6e3,run:()=>Je(t,500)},{at:7500,run:()=>{const l=t.cameras.main;l.stopFollow(),l.centerOn(1e4,1e4),r.setAlpha(1),Dt(t,500)}},{at:1e4,run:()=>Je(t,500)},{at:12e3,run:()=>{t.textures.exists("warp")?t.scene.start("Game"):t.scene.start("Preloader")}}]),a=t.add.timeline([{at:1500,tween:{targets:i,x:1200*e,duration:2500,onComplete:()=>i.anims.pause()},run:()=>{i.anims.resume(),t.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:3100,run:()=>t.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:5500,run:()=>{i.setFlipX(!0),i.setAngle(-5)}},{at:6500,run:()=>{s.setDialog({messages:["No doubt about it, this will be a strange journey.","Whatever awaits me in this town, it’s certain that nothing will ever be the same again."],onCompleted:()=>n.play()},void 0,"player_portrait")}}]);t.add.timeline([{at:2500,tween:{targets:i,x:850*e,duration:3e3,onComplete:()=>i.anims.pause()},run:()=>{i.anims.resume(),t.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:4100,run:()=>t.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:7e3,run:()=>{i.setFlipX(!0),i.setAngle(-5)}},{at:8e3,run:()=>{i.setFlipX(!1),i.setAngle(nn)}},{at:9e3,run:()=>{s.setDialog({messages:["What a beautiful mountain-scape. I almost forgot where I am headed.","It’s been three days since the letter arrived... It has been many years since I last visited that sleepy old town.","Rumors swirl of strange occurrences. People disappearing, clocks that never strike the hour, and a darkness that lingers beneath the surface."],onCompleted:()=>a.play()},void 0,"player_portrait")}}]).play()}function ed(t){me.start(we.Station);const i=t.add.image(800,1460,"train").setScale(1.35).setDepth(V.Shader),e=t.player;e.previousPosition.set(e.x+1,e.y),rs(e),e.active=!1,t.add.timeline([{at:200,run:()=>t.sound.playAudioSprite("sfx","train_whistle",{rate:.9,volume:.6})},{at:2500,tween:{targets:i,x:-500,duration:5e3},run:()=>t.sound.playAudioSprite("sfx","train_rolling",{volume:.6})},{at:2500,tween:{targets:i,y:i.y-4,loop:-1,yoyo:!0,duration:100}},{at:7800,run:()=>{i.destroy(),e.message.setDialog({messages:["Now that I have arrived in town, I should talk to the townsfolk about the strange occurrences.","Maybe someone has seen something that could help me start my investigation."],onCompleted:r=>{r.active=!0}},e)}}]).play()}const Xl=150;function $o(t,i){var s,r;const e=Jd(t,Yi.Sphinx);if(e){const n=((s=on.find(a=>a.id===Yi.Sphinx))==null?void 0:s.x)||0;e.setX(n-(i?0:Xl)),(r=e.body)==null||r.updateFromGameObject()}ts(t,R.ForestEast,!i)}function td(t){const i=t.scene,e=new si(i,I.Gear1,t);i.interactiveObjects.add(e);const s=xi(i,z.Chest);s&&(t.active=!1,t.setX(s.x-75),t.previousPosition.set(t.x-1,t.y),i.sound.playAudioSprite("sfx","chest"),s.setFrame("chest_open"),e.setPosition(s.x,s.y-20),e.setScale(.15),i.tweens.add({targets:e,scale:.35,y:s.y+20,duration:700,onComplete:()=>t.active=!0,ease:"Bounce.easeOut"}))}const yi={[I.HerbRed]:{frame:"alchemy_red",tint:11141120,x:-20},[I.HerbGreen]:{frame:"alchemy_green",tint:43520,x:-35},[I.HerbBlue]:{frame:"alchemy_blue",tint:170,x:-5}};function qr(t,i,e){t.inventory.useItem(e),t.setActive(!1),!(!i||!i.particles)&&(t.scene.sound.playAudioSprite("sfx","ingredient"),Rn(t),i.disabled=!0,i.particles.setConfig({...st[z.AlchemySet].particles,tint:yi[e].tint,x:yi[e].x}).start().on("complete",()=>{i.disabled=!1,t.setActive(!0)}))}function Rn(t){const i=xi(t.scene,z.AlchemySet);i&&(i.setFrame("alchemy_empty"),Ye(t,I.Potion)||(vi(t,I.HerbBlue)?i.setFrame(yi[I.HerbBlue].frame):vi(t,I.HerbRed)?i.setFrame(yi[I.HerbRed].frame):vi(t,I.HerbGreen)&&i.setFrame(yi[I.HerbGreen].frame)))}function id(t,i){const e=t.scene;t.inventory.useItem(I.HerbBlue),t.setActive(!1),Je(e,500,()=>{e.time.delayedCall(700,()=>{var s;i==null||i.setFrame("alchemy_full"),(s=i==null?void 0:i.particles)==null||s.setConfig({...st[z.AlchemySet].particles,tint:[6684791],x:30,delay:350,stopAfter:120}).start(),e.sound.playAudioSprite("sfx","potion"),Dt(e,1500,()=>{t.message.setDialog({messages:["I have created the potion mentioned in the old journal.","I should bring it to the mysterious stranger to see if they know how to use it."],onCompleted:(r,n)=>{r.inventory.addItem({type:I.Potion,used:!1}),r.quests.updateExistingQuest(B.ExploreLab,!0),n==null||n.setFrame("alchemy_empty"),r.setActive(!0)}},i,"player_portrait")})})})}function Yl(t,i){const e=xi(t.scene,z.MansionPicture),s=97;i?e==null||e.setAngle(s):(t.setActive(!1),e==null||e.scene.tweens.add({targets:e,angle:s,duration:1500,onComplete:()=>{t.setActive(!0),t.message.setDialog({messages:["A sturdy looking safe was hidden behind the picture.","It looks like it requires a special key to open."]},t)}}))}function sd(t){t.inventory.useItem(I.Potion),t.active=!1;const i=t.scene,e=new si(t.scene,I.Gear2,t);i.interactiveObjects.add(e);const s=xi(i,z.MansionPicture);s&&(hs(i,!1),i.sound.playAudioSprite("sfx","safe_open"),e.setPosition(s.x,s.y+20),i.tweens.add({targets:e,x:s.x-10,y:s.y+120,duration:1e3,hold:3750,onComplete:()=>{t.message.setDialog({messages:["Wow, that was wild.","I should be more careful next time before I drink random potions.","At least I found the gear!"],onCompleted:()=>i.time.delayedCall(500,()=>t.active=!0)},s,"player_portrait")},ease:"Bounce.easeOut"}))}function rd(t){me.stop(),t.setActive(!1),t.gameState.updateData({day:t.gameState.data.day+1,night:!1}),t.scene.add.timeline([{at:0,run:()=>Je(t.scene,500,()=>{t.setPosition(2660,t.y),t.previousPosition.set(t.x+1,t.y),rs(t)})},{at:1e3,run:()=>t.scene.sound.playAudioSprite("sfx","lullaby",{rate:.85,volume:.4})},{at:4e3,run:()=>{Dt(t.scene,1e3,()=>{t.message.setDialog({messages:["Ah, what a lovely rest. Time to get back to work!"],onCompleted:i=>i.setActive(!0)},t)})}}]).play()}class nd{constructor(i,e){d(this,"scene");d(this,"message");d(this,"timeline");d(this,"onComplete");var s;this.scene=i,this.message=e,this.timeline=i.add.timeline({}),(s=i.input.keyboard)==null||s.on("keydown-BACK_SLASH",()=>{this.timeline.stop(),this.message.setDialog(),this.onComplete()})}add(i,e,s=500){const r=typeof i=="string"?[i]:i;this.timeline.add({from:s,run:()=>{this.timeline.pause(),this.message.setDialog({messages:r,onCompleted:()=>this.timeline.resume()},void 0,e)}})}setComplete(i){this.onComplete=i,this.timeline.add({from:500,run:i})}}function Kl(t){const i=t.scene;t.setActive(!1);const e=i.add.image(640,630,"characters","innkeeper").setPipeline("Light2D"),s=i.add.image(480,635,"TODO").setDisplaySize(50,120).setPipeline("Light2D"),r=i.add.image(400,640,"TODO").setDisplaySize(50,120).setPipeline("Light2D"),n=i.add.image(1010,645,"TODO").setDisplaySize(50,120).setPipeline("Light2D"),a=t.message;i.sound.playAudioSprite("sfx","town_chatter");const o=new nd(i,a);return o.timeline.add({from:1800,run:()=>t.previousPosition.x=t.x-1}),o.timeline.add({from:500,run:()=>t.previousPosition.x=t.x+1}),o.timeline.add({from:700,run:()=>t.previousPosition.x=t.x-1}),o.timeline.add({from:500,run:()=>t.previousPosition.x=t.x-1}),o.timeline.add({from:500,run:()=>t.previousPosition.x=t.x-1}),{villagers:[e,s,r,n],dialog:o}}function Ql(t,i,e){i.add("Well, it is getting late. I should head to the inn and turn in for the night.","player_portrait",1500),i.setComplete(()=>{Je(t.scene,250,()=>{as(R.InnEntrance,R.Inn,t),e.forEach(s=>s.destroy())})}),i.timeline.play()}function ad(t){const{dialog:i,villagers:e}=Kl(t);i.add("It looks like the town is having a meeting. I should listen in to see if I can learn anything else about the clocktower.","player_portrait",1500),i.add(["Alright everyone, let's get started with the meeting tonight.",`For those unaware, we have a new person joining tonight. ${Ln} has been investigating the clocktower mystery.`,"Today, she found a missing gear and installed it back into the clock! Thank you Rosie."],"mayor_portrait",2500),i.add("Welcome Rosie! We are thrilled to have you here. Great job on investigating the mystery of the clock tower!","innkeeper_portrait"),i.add("Now, let's get to the main topic of the evening. Has anyone noticed any oddities? Yesterday, the clock stopped and today I heard from Johan that some of his tools were missing.","mayor_portrait"),i.add("TODO MORE DIALOG","player_portrait"),Ql(t,i,e)}function od(t){const{dialog:i,villagers:e}=Kl(t);i.add("TODO MORE DIALOG","player_portrait"),Ql(t,i,e)}const Vi={[le.Inventor]:{x:550,y:635,scale:.75,image:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor",positionData:[{pos:{x:560,y:635},condition:t=>nt(t.scene)}]},[le.Stranger]:{x:1340,y:1500,scale:1.35,image:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[le.Sphinx]:{x:3520,y:790,scale:1,image:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",light:1.85,positionData:[{pos:{x:3720,y:700},condition:t=>t.scene.player.gameState.data.sphinxMoved,onMove:t=>$o(t.scene,!0)},{pos:{x:3520,y:790},condition:()=>!0,onMove:t=>$o(t.scene,!1)}]},[le.Mayor]:{x:790,y:-350,scale:.9,image:"mayor",portrait:"mayor_portrait",name:"Joleen the Mayor",positionData:[{pos:{x:855,y:640},condition:t=>nt(t.scene)}]},[le.Innkeeper]:{x:2300,y:-1240,scale:1.05,image:"innkeeper",portrait:"innkeeper_portrait",name:"Bart the Innkeeper",skipLighting:!0},[le.Baker]:{x:1836,y:-1205,scale:.85,image:"baker",portrait:"baker_portrait",name:"Amanda the Baker",skipLighting:!0,positionData:[{pos:{x:940,y:630},condition:t=>nt(t.scene)}]}},ld={octave:3.5,speed:1,volume:1,type:"sine"},hd={octave:3.7,speed:.75,volume:.9},cd={[le.Inventor]:{octave:3.3,speed:1,volume:1.8},[le.Stranger]:{octave:2.8,speed:1.1,volume:2.6},[le.Sphinx]:{octave:2.5,speed:2,volume:2,type:"triangle"},[le.Mayor]:{octave:3.9,speed:.8,volume:.8}},ud={[z.ClockTower]:{octave:2.1,speed:1.5,volume:1.5,type:"sawtooth"}};function dd(t,i=15){const e=t.text,s=e.replace(/[^ ]/g," ");t.text="";let r="",n=0;const a=t.scene.time.addEvent({delay:i,loop:!0});return{promise:new Promise(o=>{a.callback=()=>{if(n>=e.length)return t.text=e,a.destroy(),t.getWrappedText().length>hn&&console.error("Message too long!",e),o();r=fd(e,n+1),n++;const l=s.substring(r.replace(/\<[^\>]+\>/g,"").length);t.text=r+l}}),stop:()=>{a.destroy(),t.text=e,t.getWrappedText().length>hn&&console.error("Message too long!",e)}}}function fd(t,i){let e="",s=[],r=0,n=0;for(;r<i&&n<t.length;){if(t[n]==="<"){let a=t.indexOf(">",n);if(a!==-1){let o=t.substring(n,a+1);e+=o,o.startsWith("</")?s.pop():o.endsWith("/>")||s.push(o),n=a+1;continue}}e+=t[n],r++,n++}for(let a=s.length-1;a>=0;a--){let o=s[a].match(/\<([^\>=]*)/);o&&(e+=`</${o[1]}>`)}return e}function pd(t,i,e,s){return e===0?{promise:Promise.resolve()}:(s.sound.unlock(),((n,a)=>{let o=!1;const l=()=>{o=!0},h=c=>new Promise(p=>{const g=a.sound.addAudioSprite("words");g.on("complete",()=>{g.destroy(),p()}),g.play(c,{rate:3,detune:(i.octave-4)*300})});return{promise:new Promise(async c=>{const p=n.toLowerCase().split(" "),g=3;for(let v=0;v<p.length&&!o;v+=g){const y=p[v][0];y.charCodeAt(0)>=97&&y.charCodeAt(0)<=122&&await h(y)}c()}),stop:l}})(t,s))}class mi extends E.Physics.Arcade.Image{constructor(e,s,r){const n=Vi[s],{x:a,y:o,image:l}=n;super(e,a,o,"characters",l);d(this,"npcType");d(this,"npcData");d(this,"player");d(this,"light");d(this,"particles");d(this,"shadow");d(this,"moveTimeline");d(this,"disabled",!1);d(this,"initialized",!1);d(this,"debugPosition",!1);this.name=`NPC-${s}`,this.npcData=n,this.npcType=s,this.player=r,this.setDepth(V.Npcs),ai(this,n)}lazyInit(){var u;if(this.initialized||!vn(this.player))return;let e=wi(this,this.player,1e3);if((u=this.npcData.positionData)==null||u.forEach(c=>{wi(c.pos,this.player,1e3)&&(e=!0)}),!e)return;this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0});const{x:s,y:r,light:n,particles:a,onCreate:o}=this.npcData,l=n||1,h=!oh(this.scene);f.debug?(this.light=new at(this.scene,this.x,this.y,150*(this.displayHeight/150),16764074,l),this.light.light.setVisible(h)):(this.light=this.scene.lights.addLight(this.x,this.y,150*(this.displayHeight/150),16764074,l),this.light.setVisible(h)),a&&(this.particles=this.scene.add.particles(s,r,"props",{frame:"warp",...a}).setName(`NPC-${this.npcType}-Particles`)),this.shadow=this.scene.add.image(this.x,this.y,"props","warp").setScale(.75,.15).setTint(0).setAlpha(.5),o&&o(this),this.initialized=!0,this.handleMovement(!0)}update(e,s){this.lazyInit(),this.handleMovement()}handleMovement(e=!1){var r,n,a,o,l;if(!this.initialized)return;const s=this.npcData.positionData;if(!this.debugPosition){if(s&&!this.moveTimeline){const h={x:this.npcData.x,y:this.npcData.y};let u;for(let c=0;c<s.length;c++){const{pos:p,condition:g}=s[c];if(g(this)){h.x=p.x,h.y=p.y,u=s[c].onMove;break}}if(Math.abs(this.x-h.x)>1||Math.abs(this.y-h.y)>1)if(u&&u(this),e)this.setPosition(h.x,h.y);else{const c=this.light instanceof at?(n=(r=this.light)==null?void 0:r.light)==null?void 0:n.intensity:(a=this.light)==null?void 0:a.intensity,p=200;this.moveTimeline=this.scene.add.timeline([{at:0,tween:{targets:this,alpha:0,duration:p,onUpdate:(g,v,y,m)=>{var w;return(w=this.light)==null?void 0:w.setIntensity(m*c)},onComplete:()=>{var g,v;(g=this.light)==null||g.setVisible(!1),(v=this.light)==null||v.setIntensity(c)}}},{at:p+100,tween:{targets:this,alpha:1,duration:p,delay:p,onStart:()=>{var g,v;(g=this.light)==null||g.setIntensity(0),nt(this.scene)&&((v=this.light)==null||v.setVisible(!0))},onUpdate:(g,v,y,m)=>{var w;return(w=this.light)==null?void 0:w.setIntensity(m*c)}},run:()=>this.setPosition(h.x,h.y)}]).play().once("complete",()=>this.moveTimeline=void 0)}}(o=this.light)==null||o.setPosition(this.x,this.y),(l=this.shadow)==null||l.setPosition(this.x,this.y+this.displayHeight/2)}}setPosition(e,s,r,n){return super.setPosition(e,s,r,n),this.light&&e&&s&&this.light.setPosition(e,s),this}onInteract(e){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Ae.None;if(e[C.Continue]){const s=Kd[this.npcType],r=es(s,this.player,this);if(r&&(r==null?void 0:r.messages.length)>0){const n=this.npcData.portrait.length>0;return this.player.message.setDialog(r,n?this:void 0),Ae.Talked}}return Ae.None}getButtonPrompt(){return[`Talk to ${this.npcData.name}`,"Press [CONTINUE]"]}}const Di=50,Wo=40,Go=25,Vr=45,Li=Math.PI*2,Jl=1e3*60,Zl=Jl*60,gd=Zl*12;class Mn extends E.GameObjects.Graphics{constructor(e,s,r=!1){super(e);d(this,"player");d(this,"small");d(this,"angle1",0);d(this,"angle2",1);d(this,"angle3",4);d(this,"update1",!1);d(this,"update2",!1);d(this,"update3",!1);this.name="ClockHands",e.add.existing(this),this.player=s;const n=r?897:842,a=r?247:-2107;this.setPosition(n,a),this.setDepth(V.Npcs),this.updateHands(),this.small=r}update(e){if(!wi(this,this.player,f.width/1.5))return;this.update1&&(this.angle1=Li*(e/Jl)*Vr),this.update2&&(this.angle2=Li*(e/Zl)*Vr),this.update3&&(this.angle3=Li*(e/gd)*Vr),this.clear(),this.fillStyle(L("#224477")),this.fillCircle(0,0,5);const s=this.small?.4:1,r=this.small?1.35:1,n=this.small?.7:1,a=this.small?4:6,o=this.small?1:2;[a,o].forEach(l=>{this.lineStyle(l,L(l===o?"#4477aa":_.Black)),this.lineBetween(0,0,Math.cos(this.angle1)*Di*s,Math.sin(this.angle1)*Di*s),this.lineBetween(0,0,Math.cos(this.angle2)*Wo*s,Math.sin(this.angle2)*Wo*s),this.lineBetween(0,0,Math.cos(this.angle3)*Go*s*r,Math.sin(this.angle3)*Go*s*r)}),this.lineStyle(this.small?3:5,L(_.Black));for(let l=0;l<12;l++){const h=Li*(l/12),u=Math.cos(h)*Di*s*n,c=Math.sin(h)*Di*s*n;this.lineBetween(u,c,u*1.5,c*1.5)}}updateHands(){vt(this.player,D.ClockFirstGear)&&(this.update1=!0),vt(this.player,D.ClockSecondGear)&&(this.update2=!0)}}class Zi extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a,image:o}=st[s];super(e,n,a,o?"props":"",o||"");d(this,"propType");d(this,"player");d(this,"particles");d(this,"clock");d(this,"initialized",!1);d(this,"disabled",!1);this.name=`Prop-${s}`,this.propType=s,this.player=r,this.setScale(o?.35:2).setDepth(V.Items),!o&&!f.debug&&this.setAlpha(0),ai(this,st[s]),s===z.MansionPicture&&this.resetPostPipeline()}lazyInit(){if(this.propType===z.Chest&&!this.initialized&&(Ze(this,this.player),vn(this.player),this.player.inventory.initialized),this.initialized||!Ze(this,this.player)||this.checkDestroyed())return;this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0});const{particles:e,onCreate:s}=st[this.propType];e&&(this.particles=this.scene.add.particles(this.x,this.y,"props",{frame:"warp",...e}).setDepth(V.Items).setName(`Prop-${this.propType}-Particles`)),this.propType===z.MansionPicture&&this.scene.add.image(this.x,this.y,"props","safe").setOrigin(0,0).setScale(.9).setName("Prop-Safe").setPipeline("Light2D"),this.propType===z.ClockTower&&(this.clock=new Mn(this.scene,this.player)),s&&s(this),this.initialized=!0}onInteract(e){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return Ae.None;if(e[C.Continue]){const s=il[this.propType]||[],r=es(s,this.player,this);if(r&&(r==null?void 0:r.messages.length)>0)return this.player.message.setDialog(r,this,st[this.propType].portrait||"player_portrait"),Ae.Prop}return Ae.None}checkDestroyed(){let e=!1;return this.propType===z.LabHatch&&vt(this.player,D.AlchemyLabFound)&&(e=!0),e&&this.destroy(),e}getButtonPrompt(){const e=il[this.propType]||[],s=es(e,this.player,this);let r=st[this.propType].name||z[this.propType];r=bn(r),this.propType===z.MansionPicture&&vt(this.player,D.SafeDiscovered)&&(r="Safe");let n="Inspect";return this.propType===z.Bed&&(n="Rest in"),s&&(s==null?void 0:s.messages.length)>0?[`${n} ${r}`,"Press [CONTINUE]"]:""}update(e){var s;this.lazyInit(),(s=this.clock)==null||s.update(e)}}class et extends E.GameObjects.Text{constructor(e,s,r,n,a,o){super(e,s,r,n,{...ue,fontSize:48,backgroundColor:`#${_.Slate}`,padding:{x:15,y:10},...o});d(this,"onClick");d(this,"disabled");d(this,"selected");this.setOrigin(.5),e.add.existing(this),this.onClick=()=>{this.disabled||(e.sound.playAudioSprite("sfx","button"),this.setSelected(!1),a(this))},this.disabled=!1,this.selected=!1,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",()=>{this.onClick(this)}),this.on("pointerover",()=>{!this.disabled&&!this.selected&&this.setTint(12303291)}),this.on("pointerout",()=>{!this.disabled&&!this.selected&&this.setTint(16777215)})}disable(){this.disabled=!0,this.selected=!1,this.disableInteractive(),this.setTint(6710886)}enable(){this.disabled=!1,this.selected=!1,this.setInteractive(),this.setTint(16777215)}setSelected(e){this.selected=e,this.setTint(e?L(_.ButtonActive):16777215)}}class ft extends et{constructor(i,e,s,r,n,a,o,l){super(i,e,s,r,n,{fontSize:32,align:"center",...a}),this.setOrigin((l==null?void 0:l.x)||0,(l==null?void 0:l.y)||0),o!==null&&this.setFixedSize((o==null?void 0:o.x)||250,(o==null?void 0:o.y)||50)}}class _n extends E.GameObjects.Container{constructor(e,s,r){var n,a,o;super(e,s,r);d(this,"buttons",[]);d(this,"activeIndex",-1);e.add.existing(this).setScrollFactor(0),(n=e.input.keyboard)==null||n.on("keydown-UP",()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))}),(a=e.input.keyboard)==null||a.on("keydown-DOWN",()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))}),(o=e.input.keyboard)==null||o.on("keydown-ENTER",()=>{var l;(l=this.buttons[this.activeIndex])==null||l.onClick()})}addButton(e){this.add(e),this.buttons.push(e),this.buttons.length===1&&this.setActiveButton(0),e.on("pointerover",()=>{this.setActiveButton(-1)})}setActiveButton(e){var s,r;(s=this.buttons[this.activeIndex])==null||s.setSelected(!1),this.activeIndex=e,(r=this.buttons[this.activeIndex])==null||r.setSelected(!0)}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const Ee=20,ci=170,ui=150,zo=40,hn=4,jo=350,Ho=125;class Dn extends E.GameObjects.Container{constructor(e,s){var a,o;super(e);d(this,"textWidth");d(this,"textHeight");d(this,"player");d(this,"target");d(this,"background");d(this,"npcName");d(this,"text");d(this,"portrait");d(this,"arrow");d(this,"arrowTween");d(this,"options");d(this,"optionsContainer");d(this,"dialog");d(this,"messageIndex");d(this,"interactionTimeout");d(this,"initialized",!1);d(this,"animating",!1);d(this,"stopAnimation");d(this,"stopAudio");const{width:r,height:n}=f;this.textWidth=r-135-Ee*4,this.textHeight=ci-Ee*2,this.setScrollFactor(0),this.setPosition(Ee,n-Ee-ci),this.setDepth(V.Overlay),this.setAlpha(0),this.setVisible(!1),s&&(this.player=s),(a=this.scene.input.keyboard)==null||a.on("keydown-ENTER",()=>{this.options||this.updateDialog()}),(o=this.scene.input.keyboard)==null||o.on("keydown-BACKSPACE",()=>{this.options||this.updateDialog()})}createUI(){this.scene.add.existing(this),this.npcName=new E.GameObjects.Text(this.scene,Ee+ui,Ee-5,"",{...ue,color:"#"+_.Tan}),this.text=new Xc(this.scene,Ee+ui,Ee+zo,"",{fontFamily:ue.fontFamily,fontSize:ue.fontSize,color:`#${_.White}`}),this.scene.add.existing(this.text),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(hn).setWrapMode("word"),this.text.parser.setDelimiters("<",">"),this.portrait=this.scene.add.image(Ee,Ee,"characters","").setOrigin(0).setScale(1.5),this.background=this.scene.add.rectangle(0,0,f.width,f.height,0,0).setOrigin(0).setDepth(V.Ui).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.options||this.updateDialog()}).setVisible(!1);const e=this.scene.add.rectangle(0,0,f.width-Ee*2,ci,L(_.Black),.9).setStrokeStyle(2,L(_.Tan),1).setOrigin(0,0).setScrollFactor(0).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.options||this.updateDialog()});this.optionsContainer=new _n(this.scene).setDepth(V.Overlay),this.arrow=this.scene.add.image(f.width-Ee*2-20,ci-22,"icons","chevron-down").setScale(.5),this.arrowTween=this.scene.tweens.add({targets:this.arrow,y:ci-16,duration:700,ease:"Sine.easeIn",yoyo:!0,repeat:-1}),this.add([e,this.npcName,this.text,this.portrait,this.arrow])}setDialog(e,s,r){var a,o,l;if(this.npcName||this.createUI(),this.animating&&((a=this.stopAudio)==null||a.call(this),(o=this.stopAnimation)==null||o.call(this),this.animating=!1,this.resetArrow()),this.setVisible(!0),this.background.setVisible(!0),this.scene.tweens.add({targets:this,alpha:e!==void 0?1:0,duration:Ho,onComplete:()=>this.setVisible(e!==void 0)}),this.target=s,this.messageIndex=0,this.dialog=e,this.interactionTimeout=Date.now()+jo,(l=this.scene.gamepad)==null||l.setAlpha(this.dialog?0:1),!e)return;let n=r;if(s instanceof mi&&(n=Vi[s.npcType].portrait),s instanceof Bn&&(n="player_portrait"),this.npcName.setVisible(!1),!n)this.portrait.setVisible(!1),this.text.setPosition(Ee,Ee).setWordWrapWidth(Ee+ui+this.textWidth).setFixedSize(Ee+ui+this.textWidth,this.textHeight);else{this.portrait.setVisible(!0),this.portrait.setFrame(n);let h;if(n==="player_portrait")h=Sd;else if(s instanceof mi)h=Vi[s.npcType].name;else if(s instanceof Zi)h=st[s.propType].name;else{const u=Object.entries(Vi).find(c=>c[1].portrait===n);u&&(h=u[1].name)}h&&(this.npcName.setVisible(!0),this.npcName.setText(h)),this.text.setPosition(Ee+ui,Ee+(h?zo:0)).setWordWrapWidth(this.textWidth).setFixedSize(this.textWidth,this.textHeight)}this.showMessage()}showMessage(){var r,n,a,o;const e=this.getMessages(),s=e&&e[this.messageIndex];if(this.arrow.setAlpha(0),s){this.text.setText(s);let l;((n=(r=this.portrait)==null?void 0:r.frame)==null?void 0:n.name)==="player_portrait"&&(l=hd),this.target instanceof mi&&(l=cd[this.target.npcType]),this.target instanceof Zi&&(l=ud[this.target.propType]),l||(l=ld);const{promise:h,stop:u}=pd(s,l,this.scene.sound.mute||(o=(a=this.dialog)==null?void 0:a.mute)!=null&&o.includes(this.messageIndex)?0:this.scene.sound.volume,this.scene),{promise:c,stop:p}=dd(this.text);this.animating=!0,this.stopAudio=u,this.stopAnimation=p,Promise.all([h,c]).then(()=>{this.animating=!1,this.stopAudio=void 0,this.stopAnimation=void 0,this.resetArrow()})}this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;this.arrowTween.stop(),this.arrow.setAlpha(0);const e=!f.zoomed;this.options.forEach((s,r)=>{const n=new et(this.scene,f.width/2,f.height/(e?9:14)+r*(30+f.height/(e?16:22)),s,()=>this.onSelectOption(s),{fontSize:24,backgroundColor:"#"+_.Black,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(V.Overlay);this.optionsContainer.addButton(n)})}onSelectOption(e){var s;(s=this.dialog)!=null&&s.onSelected&&(this.dialog.onSelected(e,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){var s,r,n,a;if(Date.now()<this.interactionTimeout)return;const e=this.getMessages();if(!(!this.dialog||!e)){if(this.animating){(s=this.stopAudio)==null||s.call(this),(r=this.stopAnimation)==null||r.call(this),this.animating=!1,this.resetArrow();return}this.scene.sound.playAudioSprite("sfx","button",{volume:.7}),this.messageIndex++,this.text.setText(""),this.messageIndex>=e.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.scene.tweens.add({targets:this,alpha:0,duration:Ho,onComplete:()=>this.setVisible(!1)}),this.background.setVisible(!1),(n=this.scene.gamepad)==null||n.resetButtons()):(this.dialog.onMessageShown&&this.dialog.onMessageShown(this.player,this.messageIndex,this.target),this.scene.time.delayedCall(150,()=>this.showMessage())),(a=this.scene.gamepad)==null||a.setAlpha(this.dialog===void 0?1:0),this.interactionTimeout=Date.now()+jo}}getMessages(){var s;let e=(s=this.dialog)==null?void 0:s.messages;return typeof e=="function"&&(e=e(this.player)),e}getOptions(){var s;let e=(s=this.dialog)==null?void 0:s.options;return typeof e=="function"&&(e=e(this.player)),e}resetArrow(){this.arrowTween.isDestroyed()||this.arrowTween.restart(),this.scene.tweens.add({targets:this.arrow,alpha:1,duration:500})}}const Mt={[I.Wrench]:{x:0,y:0,image:"wrench",name:"Old Wrench"},[I.Gear1]:{x:0,y:0,image:"gear",name:"Shiny Gear"},[I.Key]:{x:0,y:0,image:"key",name:"Rusty Key",skipLighting:!0},[I.HerbRed]:{x:-200,y:1730,image:"herb_red",name:"Crimson Starbloom"},[I.HerbGreen]:{x:5650,y:985,image:"herb_green",name:"Green Writhewood"},[I.HerbBlue]:{x:1535,y:875,image:"herb_blue",name:"Blue Plumed Frond"},[I.Potion]:{x:0,y:0,image:"potion",name:"Strange Potion"},[I.Gear2]:{x:0,y:0,image:"gear2",name:"Old Gear"},[I.Note]:{x:0,y:0,image:"note",name:"Old Note"}};class yd extends E.GameObjects.Container{constructor(e){super(e,0,0);d(this,"inventory",[]);d(this,"text");d(this,"rect");d(this,"initialized");this.setScrollFactor(0).setDepth(V.Ui).setVisible(!1),this.initialized=!1}createUI(){this.initialized||(this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,L(_.Slate)).setStrokeStyle(2,L(_.White)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...ue,fontSize:32}),this.add(this.text),this.initialized=!0)}addItem(e,s){if(this.initialized||this.createUI(),this.inventory.push(e),!e.used){const n=this.scene.add.image(0,0,"items",Mt[e.type].image).setScale(.35);e.type===I.Key&&n.setAngle(45),this.add(n)}this.updateItems();const r=ah(this.scene,e.type);r==null||r.destroy(),s||(new Ne(this.scene,`New item added: ${Mt[e.type].name}`),ls(this.scene))}useItem(e){var r;this.initialized||this.createUI();const s=this.inventory.find(n=>n.type===e);s&&(s.used=!0,(r=this.getAll().find(n=>{var a,o;return(((a=n.frame)==null?void 0:a.name)||((o=n.texture)==null?void 0:o.key))===Mt[e].image}))==null||r.destroy()),this.updateItems()}updateItems(){var r;this.initialized||this.createUI();let e=0;this.getAll().forEach(n=>{if(n instanceof E.GameObjects.Image){const a=32+50*e;n.setPosition(a,68),e++}}),this.setVisible(this.inventory.length>0);const s=Math.max(((r=this.text)==null?void 0:r.displayWidth)+18,50*e+12);this.setPosition(f.width-s-20,20),this.rect.setSize(s,102)}}class md extends E.GameObjects.Image{constructor(e,s){super(e,f.width-50,f.height-55,"items","journal");d(this,"player");d(this,"journal",[]);d(this,"unread");d(this,"initialized");this.player=s,this.initialized=!1}createUI(){var e;this.initialized||(this.setScrollFactor(0).setDepth(V.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(f.width-21,f.height-89,20,20,11141120).setStrokeStyle(2,L(_.Black)).setScrollFactor(0).setDepth(V.Ui2).setVisible(!1),(e=this.scene.input.keyboard)==null||e.on("keydown-J",()=>{this.openJournal()}),this.initialized=!0)}addEntry(e,s){this.initialized||this.createUI(),!this.journal.includes(e)&&(this.journal.length===0&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(e),s||(this.unread.setVisible(!0),new Ne(this.scene,"New journal entry added!")),this.handleSideEffects(e,s||!1))}openJournal(){this.initialized||this.createUI(),this.journal.length!==0&&ze(this.scene,"JournalDialog")}handleSideEffects(e,s){const{warpAdd:r}=mn[e];if(r&&ts(this.scene,r,!1),e===D.ClockFirstGear||e===D.ClockSecondGear){ni(this.scene,Mn).forEach(l=>l.updateHands());const a=e===D.ClockFirstGear&&this.player.gameState.data.day===1,o=e===D.ClockSecondGear&&this.player.gameState.data.day===2;(a||o)&&this.player.gameState.updateData({night:!0},s)}e===D.ExtraPotionInformation&&!Ye(this.player,I.Gear2)&&hs(this.scene,!0,s),e===D.SafeDiscovered&&Yl(this.player,s),s||ls(this.scene)}}const Uo=330;class vd extends E.GameObjects.Container{constructor(e,s){super(e,f.width-Uo-20,120);d(this,"player");d(this,"quests",[]);d(this,"questRectangle");d(this,"initialized");this.player=s,this.initialized=!1}createUI(){if(this.initialized)return;this.scene.add.existing(this),this.setScrollFactor(0).setDepth(V.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,Uo,60,L(_.Slate)).setStrokeStyle(2,L(_.White)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const e=this.scene.add.text(10,4,"Quests",{...ue,fontSize:32});this.add(e),this.initialized=!0}addQuest(e,s){this.initialized||this.createUI(),!this.quests.find(r=>r.id===e.id)&&(this.quests.push(e),this.add(this.scene.add.text(0,0,qt[e.id].description,{...ue,fontSize:20})),this.updateQuests(),s||new Ne(this.scene,`New quest added: ${qt[e.id].description}`),this.handleSideEffects(e.id,e.completed,s))}updateExistingQuest(e,s){this.initialized||this.createUI();const r=this.quests.find(n=>n.id===e);r?(!r.completed&&s&&new Ne(this.scene,`Quest completed: ${qt[r.id].description}`),r.completed=s,this.updateQuests(),this.handleSideEffects(e,s)):console.error(`Quest ${e} not found in player quests`)}updateQuests(){this.initialized||this.createUI();const e=this.quests.filter(a=>!a.completed);let s=1,r=0;this.getAll().forEach(a=>{if(a instanceof E.GameObjects.Text){if(!e.find(o=>a.text===qt[o.id].description)&&a.text!=="Quests")a.destroy();else if(a.text!=="Quests"){const o=14+30*s;a.setPosition(10,o),s++,r=Math.max(r,a.width)}}});const n=r+20;this.setX(f.width-20-n),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(e.length>0),this.questRectangle.setSize(n,50+30*e.length)}handleSideEffects(e,s,r){const{warpAdd:n,warpComplete:a}=qt[e];if(n&&ts(this.scene,n,!1),s&&a&&ts(this.scene,a,!1),e===B.FindPotionIngredients&&!s){const o=this.player.scene;o.interactiveObjects.add(new si(o,I.HerbGreen,this.player)),o.interactiveObjects.add(new si(o,I.HerbBlue,this.player))}e===B.ExploreLab&&!s&&Rn(this.player),r||ls(this.scene)}reset(){this.quests=[],this.updateQuests()}}const eh=1.35,cn=(f.fastMode?350:175)*eh,bd=1e3,Ln="Rosie",wd="Vale",Sd=Ln+" "+wd,Kt=new E.Math.Vector2(920,1500);class Bn extends E.Physics.Arcade.Sprite{constructor(e){super(e,Kt.x,Kt.y,"character",0);d(this,"scene");d(this,"keys");d(this,"shadow");d(this,"light");d(this,"debug");d(this,"buttonPrompt");d(this,"interactive");d(this,"interactionTimeout",0);d(this,"message");d(this,"inventory");d(this,"quests");d(this,"journal");d(this,"gameState");d(this,"previousPosition",new E.Math.Vector2);d(this,"walkingSound");d(this,"lastPlayedSound",0);d(this,"counter",0);d(this,"history",[]);d(this,"rewinding",!1);d(this,"unlockCamera",!1);this.name="Player",this.scene=e,e.add.existing(this),e.physics.add.existing(this),f.debug&&this.setInteractive(),this.setBodySize(48,74).setDepth(V.Player).setScale(eh).setPipeline("Light2D").setPostPipeline("XRayPipeline"),f.debug?(this.light=new at(e,this.x,this.y,200,16768443,1),this.debug=e.add.circle(this.x,this.y,3,16711935).setDepth(V.Debug)):this.light=e.lights.addLight(this.x,this.y,200,16768443,1),this.shadow=this.scene.add.image(this.x,this.y,"props","warp").setPipeline("Light2D").setScale(.7,.15).setTint(0),Nh(this),this.keys=new ns(e),this.message=new Dn(e,this),this.inventory=new yd(e),this.quests=new vd(e,this),this.journal=new md(e,this),this.gameState=new ef(e,this),this.walkingSound=e.sound.addAudioSprite("sfx"),f.perfTest&&e.time.delayedCall(1e3,()=>{this.setVelocityX(cn),e.time.addEvent({delay:1e3,callback:()=>this.setVelocityX(this.body?-this.body.velocity.x:0),loop:!0})})}update(e,s){var a,o,l,h,u;const r=this.interactive&&!this.message.visible&&((o=(a=this.buttonPrompt)==null?void 0:a.text)==null?void 0:o.length)>0||!1;r&&!this.buttonPrompt&&(this.buttonPrompt=new Jn(this.scene)),(l=this.buttonPrompt)==null||l.setVisible(r),f.perfTest||(this.setVelocity(0),this.rewinding?this.counter+s>vl/bl?(this.rewind(),this.counter=0):this.counter+=s:!this.checkInteraction()&&!this.message.visible&&this.updateVelocity()),f.debug&&this.setTint(this.interactive?16755370:16777215),rs(this);const n=Math.abs(((h=this.body)==null?void 0:h.velocity.x)||0)>1||Math.abs(((u=this.body)==null?void 0:u.velocity.y)||0)>1;n&&!this.walkingSound.isPlaying&&Date.now()-this.lastPlayedSound>150?this.walkingSound.play("ladder",{loop:!0,rate:.75,volume:.4}):n||(this.walkingSound.stop(),this.lastPlayedSound=Date.now()),this.previousPosition.set(this.x,this.y),this.shadow.rotation>0&&this.shadow.setRotation(Math.max(0,this.shadow.rotation-.075)),this.shadow.rotation<0&&this.shadow.setRotation(Math.min(0,this.shadow.rotation+.075)),this.shadow.setAlpha(this.rotation!==0?.25:.5)}postUpdate(){var e;this.light.setPosition(this.x,this.y-20),this.shadow.setPosition(this.x,this.y+this.displayHeight/2),f.debug&&((e=this.debug)==null||e.setPosition(this.x,this.y))}checkInteraction(){var s;let e;return this.interactive&&Date.now()>this.interactionTimeout&&(e=this.interactive.onInteract(this.keys.keys),e!==Ae.None&&(this.interactionTimeout=Date.now()+(((s=this.interactive)==null?void 0:s.interactionTimeout)||500),this.keys.resetKeys(),e===Ae.Teleported&&(this.interactive=void 0))),e}updateVelocity(){const e=this.keys.keys;let s=1;!f.prod&&e[C.Shift]&&(s=2),this.anims.timeScale=s;const r=cn*s;e[C.Left]&&this.setVelocityX(-r),e[C.Right]&&this.setVelocityX(r),f.debug&&!this.interactive&&(e[C.Up]&&this.setVelocityY(-r),e[C.Down]&&this.setVelocityY(r)),e[C.Left]&&e[C.Right]&&this.setVelocityX(0)}setY(e){return this.setPosition(this.x,e),this}record(){var e;this.history.length<bd?this.history.push(new E.Math.Vector3(this.x,this.y,((e=this.body)==null?void 0:e.velocity.x)||0)):console.warn("Max history reached")}rewind(){const e=this.history.pop();e&&(this.x=e.x,this.y=e.y,this.setVelocityX(-e.z))}setRewind(e){this.rewinding=e,this.counter=0}reset(){this.quests.reset(),this.setPosition(Kt.x,Kt.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(e){var r,n,a;this.interactive=e,e!=null&&e.onCollided&&e.onCollided();const s=(r=e==null?void 0:e.getButtonPrompt)==null?void 0:r.call(e);s&&!this.buttonPrompt&&(this.buttonPrompt=new Jn(this.scene)),(n=this.buttonPrompt)==null||n.setText(s),(a=this.buttonPrompt)==null||a.setVisible(this.message.visible?!1:(s==null?void 0:s.length)>0)}}class xd extends E.GameObjects.Container{constructor(e,s){var n;super(e,0,0);d(this,"text");d(this,"rect");d(this,"player");d(this,"activeElement");d(this,"outline");d(this,"scene");d(this,"xray",!1);d(this,"dragOffset",new E.Math.Vector2);d(this,"historyStack",[]);d(this,"debugCamera");if(this.scene=e,this.player=s,e.physics.world.drawDebug=f.debug,f.debug?e.physics.world.createDebugGraphic():(n=e.physics.world.debugGraphic)==null||n.clear(),this.createEventListeners(),!f.debug)return;this.setScrollFactor(0).setDepth(V.Debug).setAlpha(.8),this.scene.add.existing(this),this.rect=e.add.rectangle(0,0,0,0,L(_.Black)).setOrigin(0).setDepth(V.Debug),this.add(this.rect),this.text=e.add.bitmapText(20,90,"m6x11-24",""),this.add(this.text),this.outline=e.add.rectangle(0,0,0,0).setStrokeStyle(6,65280).setDepth(V.Debug),this.debugCamera=e.add.rectangle(0,0,f.width,f.height).setStrokeStyle(4,14518272).setDepth(V.Debug);const r=e.cameras.main;r.on("followupdate",()=>{this.debugCamera.setPosition(f.width/2+r.scrollX,f.height/2+r.scrollY)})}createEventListeners(){var e,s,r,n,a,o,l,h,u,c,p,g,v;(e=this.scene.input.keyboard)==null||e.on("keydown-K",()=>{rt(this.scene)}),(s=this.scene.input.keyboard)==null||s.on("keydown-L",()=>{this.scene.scene.restart()}),(r=this.scene.input.keyboard)==null||r.on("keydown-M",()=>{localStorage.removeItem(tt),this.scene.scene.restart()}),(n=this.scene.input.keyboard)==null||n.on("keydown-N",()=>{localStorage.removeItem(tt),this.scene.scene.start("Preloader")}),(a=this.scene.input.keyboard)==null||a.on("keydown-Z",()=>{f.debug=!f.debug,rt(this.scene),this.scene.scene.restart()}),(o=this.scene.input.keyboard)==null||o.on("keydown-X",()=>{if(this.historyStack.length>0){const y=this.historyStack.pop();(y==null?void 0:y.object)instanceof at?y.object.destroy():y.object.setPosition(y.x,y.y)}}),(l=this.scene.input.keyboard)==null||l.on("keydown-FORWARD_SLASH",()=>{this.scene.player.gameState.updateData({night:!this.scene.player.gameState.data.night})}),(h=this.scene.input.keyboard)==null||h.on("keydown-CLOSED_BRACKET",()=>{ze(this.scene,"DebugTool")}),(u=this.scene.input.keyboard)==null||u.on("keydown-QUOTES",()=>{hs(this.scene,!this.xray),this.xray=!this.xray}),(c=this.scene.input.keyboard)==null||c.on("keydown-PLUS",()=>{this.scene.scale.isFullscreen?this.scene.scale.stopFullscreen():this.scene.scale.startFullscreen()}),(p=this.scene.input.keyboard)==null||p.on("keydown-V",()=>{this.player.message.setDialog({messages:["<b><i>[CREAK]</i></b> A <color=red>red</color> test [CREAK]"]})}),f.debug&&((g=this.scene.input.keyboard)==null||g.on("keydown-COMMA",()=>{const y=this.scene.lights.lights;console.table(y,["x","y"])}),(v=this.scene.input.keyboard)==null||v.on("keydown-PERIOD",()=>{const y=this.scene.input.activePointer,m=new at(this.scene,y.worldX,y.worldY,100,L(_.Lights),1);this.historyStack.push({x:m.x,y:m.y,object:m})}),this.scene.input.on("gameobjectdown",(y,m)=>{y.buttons===1&&(m instanceof Bn||(m&&m!==this.activeElement?(this.activeElement=m,this.dragOffset.set(m.x-y.worldX,m.y-y.worldY),this.historyStack.push({x:m.x,y:m.y,object:m})):(this.activeElement=void 0,this.dragOffset.set(0,0))))}),this.scene.input.on("drag",(y,m)=>{this.activeElement===m&&(m.setPosition(this.dragOffset.x+y.worldX,this.dragOffset.y+y.worldY),m instanceof mi&&(m.debugPosition=!0))}),this.scene.input.on("wheel",(y,m,w,k,x)=>{this.scene.cameras.main.zoom=Math.max(.01,this.scene.cameras.main.zoom+k*5e-4)}),this.scene.input.on("pointerup",y=>{y.button===1&&(this.scene.cameras.main.zoom=1)}))}update(){if(!f.debug)return;const e=this.scene.input.activePointer,s=[`FPS (now): ${(1e3/this.scene.game.loop.delta).toFixed(1)}`,`FPS (avg): ${this.scene.game.loop.actualFps.toFixed(1)}`,`Frame Time: ${this.scene.game.loop.delta.toFixed(2)}`,`Camera: ${this.scene.cameras.main.scrollX.toFixed(1)}, ${this.scene.cameras.main.scrollY.toFixed(1)}`,`Zoom: ${this.scene.cameras.main.zoom.toFixed(2)}`,"",`Player x: ${this.player.x.toFixed(1)}`,`Player y: ${this.player.y.toFixed(1)}`,"",`Mouse x: ${e.worldX.toFixed(1)}`,`Mouse y: ${e.worldY.toFixed(1)}`];if(this.activeElement&&(s.push(""),s.push(`Active x: ${this.activeElement.x.toFixed(1)}`),s.push(`Active y: ${this.activeElement.y.toFixed(1)}`)),this.text.setText(s),this.rect.setPosition(this.text.x-10,this.text.y-10).setSize(this.text.displayWidth+20,this.text.displayHeight+20),this.activeElement){this.outline.setPosition(this.activeElement.x,this.activeElement.y),this.outline.setSize(this.activeElement.displayWidth,this.activeElement.displayHeight),this.outline.setOrigin(this.activeElement.originX,this.activeElement.originY),this.outline.setAngle(this.activeElement.angle||0);const r=this.activeElement.body;(r&&r instanceof E.Physics.Arcade.Body||r instanceof E.Physics.Arcade.StaticBody)&&r.updateFromGameObject()}else this.outline.setSize(0,0)}}class kd extends E.Physics.Arcade.Image{constructor(e,s,r){var c;const{x:n,y:a,image:o,scale:l}=s;super(e,n,a,o);d(this,"player");d(this,"initialized",!1);d(this,"info");d(this,"center");d(this,"bounds",new E.Geom.Rectangle);d(this,"debug");d(this,"music");this.name=`Background-${s.image}`,this.info=s,this.player=r,this.setOrigin(0).setDepth(V.Backgrounds),ai(this,s);const h=(c=e.textures.get(o))==null?void 0:c.getSourceImage();this.center=new E.Math.Vector2(n+h.width*(l||1)/2,a+h.height*((l||1)/2));const u=Object.entries(rn).find(([p,g])=>g.locations.includes(this.info.location));this.music=u?u[0]:void 0,f.debug&&(this.debug=e.add.rectangle(this.x,this.y,h.width*(l||1),h.height*(l||1)).setStrokeStyle(6,26214).setOrigin(0).setDepth(V.Debug))}lazyInit(){this.initialized||!Ze(this.center,this.player,2e3)||(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.getBounds(this.bounds),f.debug&&this.setInteractive({draggable:!0}),this.info.onCreate&&this.info.onCreate(this),this.initialized=!0)}update(){var e,s;if(this.lazyInit(),(e=this.bounds)!=null&&e.contains(this.player.x,this.player.y)&&(this.player.active&&this.music&&me.start(this.music),!f.debug&&!this.player.unlockCamera))if(this.bounds.width<f.width){const r=f.width-this.bounds.width;this.scene.cameras.main.setBounds(this.bounds.x-r/2,this.bounds.y,f.width,this.bounds.height)}else if(this.bounds.height<f.height){const r=f.height-this.bounds.height;this.scene.cameras.main.setBounds(this.bounds.x,this.bounds.y-r/2,this.bounds.width,f.height)}else this.scene.cameras.main.setBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);f.debug&&((s=this.debug)==null||s.setPosition(this.x,this.y))}}function Xr(){return Math.random()-.5}const Bi={Forest:[3200,600],Lake:[5125,700]},Yr=[500,200,100,50,10];class qo extends E.GameObjects.GameObject{constructor(e,s,r,n=40,a=[1400,600]){super(e,"fireflies");d(this,"scene");d(this,"center",new E.Math.Vector2(0,0));d(this,"lights",[]);d(this,"count");d(this,"centers",[]);d(this,"bounds",[1e3,400]);d(this,"biases",[]);d(this,"time",0);d(this,"initialized",!1);d(this,"debug");e.add.existing(this),this.scene=e,this.count=n,this.bounds=a,this.setPosition(s,r)}setPosition(e,s){this.center.set(e,s),this.centers=[];for(let r=0;r<this.count;r++)this.centers.push(new E.Math.Vector2(e+Math.random()*this.bounds[0]-this.bounds[0]/2,s+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(e-this.bounds[0]/2,s-this.bounds[1]/2)}lazyInit(){if(!(this.initialized||!Ze(this.center,this.scene.player))){for(let e=0;e<this.count;e++){const s=new E.Display.Color(Math.random()*40+50,Math.random()*60+190,Math.random()*20+10),r=this.scene.lights.addPointLight(0,0,s.color,Math.random()*7+3,.15,.045+Xr()*.02);this.lights.push(r);const n=[];for(let a=0;a<Yr.length*2;a++)n.push(Xr()*Yr[a%Yr.length]);n.push(Xr()*10),this.biases.push(n)}f.debug&&(this.debug=this.scene.add.graphics(),this.updateDebug()),this.setPosition(this.center.x,this.center.y),this.initialized=!0}}updateDebug(e=!1){const s=e?13260:16711680;this.debug.clear(),this.debug.fillStyle(s,.5).lineStyle(4,s,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])}update(e,s){this.lazyInit();const r=Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0];if(this.debug&&this.updateDebug(r),!r){this.lights.forEach(h=>h.visible=!1);return}this.time+=s;const a=this.time/1e3*.025,o=Math.cos(a),l=Math.sin(a);this.lights.forEach((h,u)=>{const c=this.biases[u],p=Math.cos(a*70+c[10]);h.visible=!0,h.intensity=Math.min(.2+Math.abs(c[4]*p+c[3]*o+c[4]*o)/50,.4),h.x=o*c[0]+l*c[1]+o*c[2]+l*c[3]+o*c[4]+this.centers[u].x,h.y=l*c[5]+o*c[6]+l*c[7]+o*c[8]+l*c[9]+this.centers[u].y})}}const Kr={[_t.LabStairs]:{x:-1670,y:1730,size:{x:80,y:80},text:"Press [UP] to go upstairs"},[_t.InnStairs]:{x:2e3,y:-1205,size:{x:80,y:80},text:"Press [UP] to go upstairs"}};class Ed extends E.GameObjects.Image{constructor(e,s,r){const{x:n,y:a}=Kr[s];super(e,n,a,"");d(this,"player");d(this,"disabled",!1);d(this,"initialized",!1);this.name=`HelperText-${s}`,this.player=r}lazyInit(){if(this.initialized||!Ze(this,this.player))return;const{size:e}=Kr[_t.LabStairs];this.setDepth(V.Items),this.setDisplaySize(e.x,e.y),f.debug||this.setAlpha(0),this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0}),this.initialized=!0}getButtonPrompt(){return Kr[_t.LabStairs].text}onInteract(e){return Ae.None}update(){this.lazyInit()}}class Od extends E.GameObjects.Container{constructor(e,s){const{position:r,size:n}=s;super(e,r.x,r.y);d(this,"initialized",!1);d(this,"center");d(this,"player");d(this,"layers",[]);d(this,"info");this.name=`ParallaxBackground-${r.x}-${r.y}`,this.info=s,this.player=e.player,this.setDepth(V.Backgrounds),this.center=new E.Math.Vector2(r.x+.5*n.x,r.y+.5*n.y),f.debug&&this.add(e.add.rectangle(this.center.x,this.center.y,n.x,n.y).setStrokeStyle(10,26214).setOrigin(.5))}lazyInit(){if(this.initialized||!Ze(this.center,this.player,this.info.size.x))return;this.scene.add.existing(this),this.scene.physics.add.existing(this);const{position:e,size:s,scale:r,images:n,skipLighting:a}=this.info;n.forEach(({texture:o,scale:l,speed:h})=>{const u=this.scene.add.tileSprite(e.x,e.y,s.x,s.y,o);u.setOrigin(0).setTileScale((r||1)*(l||1)).setData("speed",h),a||u.setPipeline("Light2D"),u.setPostPipeline("XRayPipeline"),this.add(u),this.layers.push(u)}),f.debug&&this.setInteractive({draggable:!0,hitArea:new E.Geom.Rectangle(e.x,e.y,s.x,s.y),hitAreaCallback:E.Geom.Rectangle.Contains}),this.initialized=!0}update(){if(this.lazyInit(),!this.initialized||!this.getBounds().contains(this.player.x,this.player.y))return;const{size:e}=this.info,s=E.Math.Clamp(this.player.x-this.center.x,-.5*e.x,.5*e.x)/e.x;this.layers.forEach(r=>{r.tilePositionX=s*r.getData("speed")*e.x})}}const Qr={[Qt.Library]:{x:1100,y:-470,text:"Library"},[Qt.Inn]:{x:1350,y:450,text:"Inn"},[Qt.Train]:{x:235,y:555,text:"Train"}};class Id extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a}=Qr[s];super(e,n,a,"props","paper");d(this,"player");d(this,"initialized",!1);d(this,"signType");d(this,"text");d(this,"light");this.name=`Sign-${s}`,this.player=r,this.signType=s,ai(this,{...Qr[s],depth:V.Player,origin:{x:.5,y:.5}}),this.setTint(13417386)}lazyInit(){if(this.initialized||!Ze(this,this.player))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0});const{x:e,y:s,text:r}=Qr[this.signType];this.text=this.scene.add.text(e,s,r.toUpperCase(),{fontFamily:"Germania One",fontStyle:"normal",fontSize:28,color:"#372737",stroke:"#8e6117",strokeThickness:6}).setOrigin(.5).setDepth(V.Player+1).setPipeline("Light2D");const n=5;this.setDisplaySize(this.text.displayWidth+n*5,this.text.displayHeight+n),this.initialized=!0;const a=!oh(this.scene),o=1;f.debug?(this.light=new at(this.scene,this.x,this.y,300*(this.displayWidth/400),16764074,o),this.light.light.setVisible(a)):(this.light=this.scene.lights.addLight(this.x,this.y,300*(this.displayWidth/400),16764074,o),this.light.setVisible(a)),this.scene.lightData.push({light:this.light,intensity:o,random:Math.random()})}update(){var e,s;this.lazyInit(),(e=this.text)==null||e.setPosition(this.x,this.y),(s=this.light)==null||s.setPosition(this.x,this.y)}}class Vo extends E.Physics.Arcade.Image{constructor(e,s,r,n=100,a=100,o=!1,l=!1){super(e,s,r,"");d(this,"scene");d(this,"width");d(this,"height");d(this,"flipped");d(this,"graphics");d(this,"initialized",!1);d(this,"upwards");this.name=`Slope-${s}-${r}`,this.scene=e,this.width=n,this.height=a,this.flipped=o,this.upwards=l}lazyInit(){if(!(this.initialized||!Ze(this,this.scene.player))){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0).setDepth(V.Items).setVisible(f.debug).setSize(this.width,this.height*1.5),f.debug){this.setInteractive({draggable:!0});const e=this.scene.add.graphics().setDepth(V.Debug);this.graphics=e,e.lineStyle(2,65280,1);const s=this.width/2,r=new E.Math.Vector2(0,this.flipped?0:0+this.height),n=new E.Math.Vector2(0+this.width,this.flipped?0+this.height:0);e.lineBetween(r.x,r.y,n.x,n.y),e.lineBetween(r.x-s,r.y,r.x,r.y),e.lineBetween(n.x,n.y,n.x+s,n.y),e.strokeCircle(r.x,r.y,2),e.strokeCircle(n.x,n.y,2)}this.initialized=!0}}update(e,s){var o;if(this.lazyInit(),!this.initialized)return;(o=this.graphics)==null||o.setPosition(this.x,this.y);const r=this.scene.player,n=r.keys.keys,a=.75*cn;if(this.body&&this.scene.physics.world.intersects(this.body,r.body)){if(!r.active||n[C.Shift])return;let l=E.Math.Clamp(1-(this.x+this.width-r.x)/this.width,0,1);this.flipped&&(l=1-l);const h=this.y+this.height,u=(1-r.originY)*r.displayHeight,c=h-this.height*l-u;if(n[C.Right]&&r.setVelocityX(a),n[C.Left]&&r.setVelocityX(-a),l>.1&&l<.9&&r.shadow.setRotation(Math.atan2(this.height,this.width)*(this.flipped?1:-1)),this.upwards&&n[C.Up]&&Math.abs(r.y-c)<70){r.setVelocityX(this.flipped?-a:a),r.setY(c);return}if(this.upwards&&(n[C.Right]||n[C.Left]&&this.flipped)&&r.y<h-70){r.setY(c);return}if(this.upwards&&c<r.y)return;r.setY(c)}}}const Td=6,Pd=100;class Cd extends E.Physics.Arcade.StaticGroup{constructor(e,s){super(e.physics.world,e);d(this,"player");d(this,"initialized",[]);this.player=s}createWall(e,s){var n;const r=this.scene.add.rectangle(e.x,e.y,Td,Pd).setOrigin(0).setVisible(f.debug);r.name=`Wall-${e.id||s}-${e.x}-${e.y}`,e.id!==void 0&&r.setData("WallType",e.id),f.debug&&r.setInteractive({draggable:!0}),this.add(r),this.initialized.push(s),(n=e.onCreate)==null||n.call(e,r)}update(){for(let e=0;e<on.length;e++){if(this.initialized.includes(e))continue;const s=on[e];E.Math.Distance.BetweenPointsSquared(s,this.player)<1e3**2&&this.createWall(s,e)}}}const di=.8,Xo=.45,Fi=.1;class cs extends E.GameObjects.Container{constructor(e,s){super(e,100,f.height-100);d(this,"buttons",[]);d(this,"lastXAxisKey");d(this,"lastYAxisKey");d(this,"minimal");this.minimal=s,this.setScrollFactor(0).setDepth(V.Overlay),e.add.group(this,{runChildUpdate:!0}),e.add.existing(this),this.createControllerListeners()}createUI(){this.createDPad(),this.minimal||this.createButtons()}setVisible(e){return super.setVisible(e),e&&this.buttons.length===0&&this.createUI(),this}update(e,s){var o,l,h,u,c,p,g,v,y,m,w;const r=(o=this.scene.input.gamepad)==null?void 0:o.pad1;if(!r)return;const n=r.axes[0].getValue(),a=r.axes[1].getValue();if(Math.abs(n)<=Fi&&this.lastXAxisKey){(l=this.scene.input.keyboard)==null||l.emit("keyup-"+this.lastXAxisKey),this.lastXAxisKey=void 0;return}if(n>Fi){if(this.lastXAxisKey==="RIGHT")return;this.lastXAxisKey==="LEFT"&&((h=this.scene.input.keyboard)==null||h.emit("keyup-LEFT")),(u=this.scene.input.keyboard)==null||u.emit("keydown-RIGHT"),this.lastXAxisKey="RIGHT"}if(n<-.1){if(this.lastXAxisKey==="LEFT")return;this.lastXAxisKey==="RIGHT"&&((c=this.scene.input.keyboard)==null||c.emit("keyup-RIGHT")),(p=this.scene.input.keyboard)==null||p.emit("keydown-LEFT"),this.lastXAxisKey="LEFT"}if(Math.abs(a)<=Fi&&this.lastYAxisKey){(g=this.scene.input.keyboard)==null||g.emit("keyup-"+this.lastYAxisKey),this.lastYAxisKey=void 0;return}if(a>Fi){if(this.lastYAxisKey==="DOWN")return;this.lastYAxisKey==="UP"&&((v=this.scene.input.keyboard)==null||v.emit("keyup-UP")),(y=this.scene.input.keyboard)==null||y.emit("keydown-DOWN"),this.lastYAxisKey="DOWN"}if(a<-.1){if(this.lastYAxisKey==="UP")return;this.lastYAxisKey==="DOWN"&&((m=this.scene.input.keyboard)==null||m.emit("keyup-DOWN")),(w=this.scene.input.keyboard)==null||w.emit("keydown-UP"),this.lastYAxisKey="UP"}}createDPad(){const e=this.scene.add.container(10,-10);this.add(e);const s=this.scene.add.circle(0,0,60,L(_.Slate),Xo).setStrokeStyle(3,L(_.Black));e.add(s),this.button(-57,0,"LEFT",e),this.button(57,0,"RIGHT",e),this.button(0,-57,"UP",e),this.button(0,57,"DOWN",e)}createButtons(){const e=this.scene.add.container(f.width-300,0);this.add(e);const s=this.scene.add.circle(40,0,65,L(_.Slate),Xo).setStrokeStyle(3,L(_.Black)).setScale(1,.6).setAngle(-30);e.add(s),this.button(80,-20,"ENTER",e),this.button(0,20,"BACKSPACE",e)}createControllerListeners(){var e,s,r,n;(e=this.scene.input.gamepad)==null||e.on("connected",a=>{new Ne(this.scene,"Gamepad connected")}),(s=this.scene.input.gamepad)==null||s.on("disconnected",a=>{new Ne(this.scene,"Gamepad disconnected")}),(r=this.scene.input.gamepad)==null||r.on("down",(a,o)=>{var h;const l=this.getKeyFromButton(o);l&&((h=this.scene.input.keyboard)==null||h.emit(`keydown-${l}`))}),(n=this.scene.input.gamepad)==null||n.on("up",(a,o)=>{var h;const l=this.getKeyFromButton(o);l&&((h=this.scene.input.keyboard)==null||h.emit(`keyup-${l}`))})}getKeyFromButton(e){const s=e.pad.id.toLowerCase().includes("nintendo");let r;switch(e.index){case 0:s?r="BACKSPACE":r="ENTER";break;case 1:s?r="ENTER":r="BACKSPACE";break;case 2:s?r="SHIFT":r="BACK_SLASH";break;case 3:s?r="BACK_SLASH":r="SHIFT";break;case 8:r="J";break;case 9:r="ESC";break;case 12:r="UP";break;case 13:r="DOWN";break;case 14:r="LEFT";break;case 15:r="RIGHT";break}return r}button(e,s,r,n){const a=r==="ENTER"||r==="ESCAPE"?35:38,o=this.scene.add.circle(e,s,a,L(_.White),di).setStrokeStyle(3,L(_.Black));o.setInteractive({useHandCursor:!0}).setScrollFactor(0),n.add(o),o.on("pointerdown",()=>{var l;(l=this.scene.input.keyboard)==null||l.emit(`keydown-${r}`),o.setFillStyle(L(_.Slate),Math.min(1,di+.25))}),o.on("pointerup",()=>{var l;(l=this.scene.input.keyboard)==null||l.emit(`keyup-${r}`),o.setFillStyle(L(_.White),di)}),o.on("pointerout",()=>{var l;(l=this.scene.input.keyboard)==null||l.emit(`keyup-${r}`),o.setFillStyle(L(_.White),di)}),this.buttons.push(o)}resetButtons(){this.buttons.forEach(e=>e.setFillStyle(L(_.White),di))}}class Qe extends E.GameObjects.Container{constructor(e,s,r,n,a){super(e,s,r);d(this,"onClick");d(this,"img");d(this,"rect");d(this,"selected");e.add.existing(this),this.setScrollFactor(0).setDepth(V.Ui),this.rect=e.add.rectangle(0,0,42,42,L(_.Slate)).setScrollFactor(0).setStrokeStyle(2,L(_.Black)),this.img=e.add.image(-1,1,"icons",n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.onClick=()=>{e.sound.playAudioSprite("sfx","button"),a()},this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.onClick()),this.selected=!1,this.rect.on("pointerover",()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)}),this.rect.on("pointerout",()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)})}setTint(e){this.img.setTint(e)}setSelected(e){this.selected=e,this.setTint(e?L(_.ButtonActive):16777215)}setIcon(e){this.img.setTexture("icons",e).setDisplaySize(32,32)}}var Fn=(t=>(t.Horizontal="H",t.Vertical="V",t.Corner="C",t.T="T",t.Cross="X",t.Empty=" ",t))(Fn||{});const th={H:[[0,0,0],[1,1,1],[0,0,0]],V:[[0,1,0],[0,1,0],[0,1,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},Jr=[[" "," "," ","V"," "," ","V"," "," ","V"," "," "," ","V"," "," "],[" "," ","C","C"," "," ","V"," "," ","V"," "," ","C","T","H","H"],["H","H","X","T","T","T","T","T","T","C"," "," ","V"," "," "," "],[" "," ","V","C","X","C"," ","C","X","H","T","H","X","H","C"," "],[" "," ","C","T","X","H","C"," ","V"," ","V"," ","V"," ","T","H"],["H","T","H","T","V"," ","T","H","X","H","T","H","T"," ","V"," "],[" ","V"," ","C","X","H","C"," ","T","C"," "," ","C","C","C","H"],[" ","V"," "," ","V"," "," "," ","V","V"," "," "," ","V"," "," "]].map(t=>t.map(i=>i)),Yo={x:0,y:2};function Ad(t,i,e){const s=[],r=new Set,n=t.length,a=t[0].length;function o(l,h){const u=`${l},${h}`;r.add(u),s.push(t[h][l]),l+1<a&&!r.has(`${l+1},${h}`)&&Ni(t[h][l],t[h][l+1])&&o(l+1,h),l-1>=0&&!r.has(`${l-1},${h}`)&&Ni(t[h][l],t[h][l-1])&&o(l-1,h),h+1<n&&!r.has(`${l},${h+1}`)&&Ni(t[h][l],t[h+1][l])&&o(l,h+1),h-1>=0&&!r.has(`${l},${h-1}`)&&Ni(t[h][l],t[h-1][l])&&o(l,h-1)}return o(i,e),s}function Ni(t,i){if(!t||!i)return!1;const e=Ko(t),s=Ko(i),r=i.x-t.x,n=i.y-t.y;return r===1&&n===0?e.right&&s.left:r===-1&&n===0?e.left&&s.right:r===0&&n===1?e.bottom&&s.top:r===0&&n===-1?e.top&&s.bottom:!1}function Ko(t){const i=Rd(t);return{left:i.some(e=>e[0]===1),right:i.some(e=>e[e.length-1]===1),top:i[0].some(e=>e===1),bottom:i[i.length-1].some(e=>e===1)}}function Rd(t){let i=th[t.type];const e=Math.floor(t.rotation/90);for(let s=0;s<e;s++)i=Md(i);return i}function Md(t){return t[0].map((i,e)=>t.map(s=>s[e]).reverse())}const Qo=Object.keys(I).map(t=>I[t]).filter(t=>typeof t=="number"),Jo=Object.keys(D).map(t=>D[t]).filter(t=>typeof t=="number"),_d=Object.keys(le).map(t=>le[t]).filter(t=>typeof t=="number"),Dd=Object.keys(z).map(t=>z[t]).filter(t=>typeof t=="number"),Zo=Object.keys(B).map(t=>B[t]).filter(t=>typeof t=="number"),ih=Object.keys(R).map(t=>R[t]).filter(t=>typeof t=="number"),Ld=Object.values(G),Bd=Object.keys(_t).map(t=>_t[t]).filter(t=>typeof t=="number"),Fd=Object.values(Fn).filter(t=>typeof t!="number"),el=["MainMenu","MazeDialog","PipesDialog","TumblerDialog","MemoryDialog","SliderDialog","Books"],Nd=Object.keys(Qt).map(t=>Qt[t]).filter(t=>typeof t=="number"),$d=[{x:45,y:0,image:"town",location:G.Town,scale:2},{x:500,y:-1100,image:"clock_outside",location:G.ClockOutside,scale:2},{x:500,y:-2400,image:"clock_inner",location:G.ClockInner,scale:2,skipLighting:!0},{x:2300,y:0,image:"forest",location:G.Forest,scale:2},{x:4400,y:100,image:"lake",location:G.Lake,scale:2},{x:-2200,y:-170,image:"mansion_outside",location:G.MansionOutside,scale:2},{x:-2e3,y:-1320,image:"mansion_inside",location:G.MansionInside,scale:2},{x:-3200,y:1300,image:"alchemy_lab",location:G.AlchemyLab,scale:1.8,skipLighting:!0},{x:1490,y:-860,image:"library",location:G.Library,scale:2,skipLighting:!0},{x:1600,y:-1850,image:"inn",location:G.Inn,scale:2,skipLighting:!0},{x:320,y:1050,image:"station",location:G.Station,scale:3}],Wd=[{x:135,y:462,radius:150,color:L(_.Tan),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:897,y:240,intensity:1.5},{x:1561,y:460},{x:791,y:472,intensity:.75},{x:962,y:469,intensity:.75},{x:400,y:640},{x:485,y:635},{x:1010,y:645},{x:560,y:1353,radius:70,intensity:.75},{x:658,y:1353,radius:70,intensity:.75},{x:763,y:1353,radius:70,intensity:.75},{x:842,y:1353,radius:70,intensity:.75},{x:939,y:1353,radius:70,intensity:.75},{x:1049,y:1353,radius:70,intensity:.75},{x:1148,y:1353,radius:70,intensity:.75},{x:639,y:1174,radius:90},{x:750,y:1174,radius:90},{x:856,y:1174,radius:90},{x:958,y:1174,radius:90},{x:1066,y:1174,radius:90}],Gd=[],zd=[{x:420,y:1390,width:180,height:160,flip:!0},{x:740,y:-1380,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5077,y:953,width:100,height:60,flip:!0},{x:-1300,y:-415,width:90,height:35},{x:-1710,y:1577,width:280,height:190,upwards:!0},{x:-1020,y:1697,width:200,height:70},{x:-2570,y:1728,width:200,height:40,flip:!0},{x:1960,y:-1492,width:420,height:350,upwards:!0}],jd=()=>{const t=document.createElement("div");t.id="stats",t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";const i=localStorage.getItem("chrono-sleuth-stats")!=="false";t.classList.toggle("hidden",!i);const e=document.createElement("img");e.src="bar-chart-2.svg",e.width=24,e.height=24;const s=document.createElement("button");s.style.cssText="background-color:transparent;border:none;padding:0;bottom:8px;right:8px;position:fixed;cursor:pointer",s.appendChild(e),s.onclick=()=>{const o=!t.classList.contains("hidden");t.classList.toggle("hidden",o),localStorage.setItem("chrono-sleuth-stats",(!o).toString())},t.appendChild(s);const r=document.createElement("div");r.style.cssText="position:fixed;top:6px;left:6px;color:white;font-family:Helvetica,Arial,sans-serif;text-shadow:1px 1px 1px black",t.appendChild(r);const n=[];function a(o){return t.appendChild(o.dom),n.push(o),o}return{REVISION:17,dom:t,fps:r,panels:n,addPanel:a}},Vt=(t,i,e)=>{var s=1/0,r=0,n=Math.round;const a=1.25,o=n(window.devicePixelRatio||1)*a,l=100*o,h=65*o,u=3*o,c=2*o,p=3*o,g=23*o,v=Math.floor(l-p*2),y=h-g-2*o,m=document.createElement("canvas");m.width=l,m.height=h;const w=m.getContext("2d");w.font="bold "+9*o+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=e,w.fillRect(0,0,l,h),w.fillStyle=i,w.fillText(t,u,c),w.fillRect(p,g,v,y),w.fillStyle=e,w.globalAlpha=.9,w.fillRect(p,g,v,y);let k=0,x=0,T=new Array(Math.floor(v/o)).fill(0);return{dom:m,update:function(A){if(!(performance.now()-k<100)){T[x]=A,x=(x+1)%T.length,s=Math.min(...T),r=Math.max(...T),w.fillStyle=e,w.globalAlpha=1,w.fillRect(0,0,l,g),w.fillStyle=i,w.fillText(`${t}: ${A.toFixed(1)}`,u,c),w.fillText(`[${s.toFixed(1)} - ${r.toFixed(1)}]`,u,c+10*o),w.fillRect(p,g,v,y),w.fillStyle=e,w.globalAlpha=.8;for(let F=0;F<T.length;F++){const K=(x+F)%T.length,N=T[K]/r;w.fillRect(p+o*F,g,o+(2-a),Math.min(y-o,Math.max(o,n((1-N)*y))))}k=performance.now()}}}};let Xe;function Hd(t){Xe=jd(),document.body.appendChild(Xe.dom);const i=Xe.dom.style;i.display="flex",i.justifyContent="center",i.flexWrap="wrap",i.gap="6px",i.cursor="",i.right="0",i.top="",i.bottom="10px",i.opacity="0.7";const e=Xe.addPanel(Vt("FPS","#9ad8e4","#064b62")),s=Xe.addPanel(Vt("Frame Time","#f3b0c3","#6b1e3d")),r=Xe.addPanel(Vt("Memory (mb)","#ffd59a","#6b3e06")),n=Xe.addPanel(Vt("Render","#e9f3a3","#4c6b1a")),a=Xe.addPanel(Vt("Step","#c3c3f3","#1d1d6b"));let o=0,l=0;t.events.on(Phaser.Core.Events.PRE_STEP,()=>o=performance.now()),t.events.on(Phaser.Core.Events.POST_STEP,()=>a.update(performance.now()-o)),t.events.on(Phaser.Core.Events.PRE_RENDER,()=>l=performance.now()),t.events.on(Phaser.Core.Events.POST_RENDER,()=>{const h=t.loop.deltaHistory.slice(0,10).reduce((u,c)=>u+c,0)/10;n.update(performance.now()-l),e.update(1e3/h),s.update(performance.now()-o),Xe.fps.textContent=`${Math.floor(1e3/h)}`,performance.memory&&r.update(performance.memory.usedJSHeapSize/1048576)})}class sh extends E.Scene{constructor(){super("Game");d(this,"player");d(this,"interactiveObjects");d(this,"clock");d(this,"gamepad");d(this,"saveIcon");d(this,"lightData",[]);d(this,"postUpdated",[]);d(this,"cullingStats");d(this,"shouldInit",!0);d(this,"cameraPadding",150);d(this,"cameraBounds",new E.Geom.Rectangle(0,0,f.width+this.cameraPadding*2,f.height+this.cameraPadding*2));d(this,"objectBounds",new E.Geom.Rectangle(0,0,0,0))}init(){const e=Xu(this);this.shouldInit=!e}create(){if(!this.shouldInit)return;me.setScene(this);const e=performance.now();Je(this,0),this.time.delayedCall(f.bootDialog?0:250,()=>Dt(this,f.bootDialog?150:500)),this.player=new Bn(this),this.postUpdated.push(this.player);const s=this.createBackgrounds(),r=this.createParallaxBackgrounds(),n=new Cd(this,this.player),a=this.createSlopes(),o=this.createHelperText(),l=this.createSigns(),h=this.createWarpers(),u=this.createNpcs(),c=this.createItems(),p=this.createProps(),g=new Mn(this,this.player,!0),v=new qo(this,Bi.Forest[0],Bi.Forest[1]),y=new qo(this,Bi.Lake[0],Bi.Lake[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...h,...u,...c,...p,...o],{runChildUpdate:!0});const m=this.add.group([this.player,v,y,g,n,...a,...l,...s,...r],{runChildUpdate:!0});this.clock&&m.add(this.clock),this.physics.add.collider(this.player,n),this.createEventListeners();const w=this.cameras.main;if(w.startFollow(this.player,!0),w.setFollowOffset(0,f.cameraOffset),ln(this),!f.prod){const x=performance.now()-e,T=`Game.create() took ${x.toFixed(1)}ms to initialize`;f.debug&&x>300?new Ne(this,T,void 0,_.Warning):!f.debug&&x>150&&new Ne(this,T,void 0,_.Warning),window.bootTime>-1&&(console.log("Total game boot time",Date.now()-window.bootTime),window.bootTime=-1)}}update(e){if(this.player&&(this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,(r,n)=>{const a=r;let o=!0;return a.disabled&&(o=!1),a.visible!==void 0&&(o=o&&a.visible),o},this.player)||this.player.setInteractiveObject(void 0)),nt(this))for(let s of this.lightData)Math.random()>.98&&s.light.setIntensity(s.intensity*(.9+Math.random()*.1));this.frustumCull()}frustumCull(){var r,n,a;const e=performance.now();this.cameraBounds.x=this.cameras.main.scrollX-this.cameraPadding,this.cameraBounds.y=this.cameras.main.scrollY-this.cameraPadding;const s=this.children.getAll();for(let o of s)if(o instanceof E.GameObjects.Image||o instanceof E.GameObjects.Sprite||o instanceof E.GameObjects.Particles.ParticleEmitter||o instanceof E.GameObjects.Graphics){if(o.depth!==V.Debug&&(o instanceof Vo||!(o instanceof qi)&&((r=o.name)!=null&&r.startsWith("Warp"))||o.depth>=V.Ui||((n=o.name)==null?void 0:n.length)===0))continue;this.objectBounds.setTo(o.x,o.y,o.displayWidth||o.width||1,o.displayHeight||o.height||1),E.Geom.Intersects.RectangleToRectangle(this.cameraBounds,this.objectBounds)?o instanceof qi?o.updateLocked():o.setVisible(!0):o.setVisible(!1)}Xe&&!this.cullingStats&&(this.cullingStats=Xe.addPanel(Vt("Culling","#9ad8e4","#064b62"))),(a=this.cullingStats)==null||a.update(performance.now()-e)}createBackgrounds(){return $d.map(e=>new kd(this,e,this.player))}createParallaxBackgrounds(){return Gd.map(e=>new Od(this,e))}createWarpers(){return ih.map(e=>new qi(this,e,this.player))}createNpcs(){return _d.map(e=>new mi(this,e,this.player))}createItems(){return[].map(e=>new si(this,e,this.player))}createSlopes(){return zd.map(e=>new Vo(this,e.x,e.y,e.width,e.height,e.flip,e.upwards))}createProps(){return Dd.map(e=>new Zi(this,e,this.player))}createHelperText(){return Bd.map(e=>new Ed(this,e,this.player))}createSigns(){return Nd.map(e=>new Id(this,e,this.player))}createUI(){this.time.delayedCall(50,()=>{let e=30;new Qe(this,e,30,"settings",()=>{this.player.message.visible||(this.scene.pause(),this.scene.launch("Paused",{game:this}))}),f.prod||new Qe(this,e+=50,30,"terminal",()=>{ze(this,"DebugTool")}),this.saveIcon=this.add.image(30,f.height-30,"icons","save").setScale(.4).setDepth(V.Ui).setScrollFactor(0).setAlpha(0),this.saveIcon.postFX.addGlow(0,2)}),this.gamepad=new cs(this),f.prod||(this.time.delayedCall(500,()=>{const e=new xd(this,this.player);this.add.group(e,{runChildUpdate:!0})}),f.bootDialog&&this.time.delayedCall(150,()=>ze(this,f.bootDialog)))}createLights(){this.lights.enable().setAmbientColor(L(_.White)),Wd.forEach(e=>{const s=e.intensity||1;f.debug?this.lightData.push({light:new at(this,e.x,e.y,e.radius||100,e.color||L(_.Lights),s),random:Math.random(),intensity:s}):this.lightData.push({light:this.lights.addLight(e.x,e.y,e.radius||100,e.color||L(_.Lights),s),random:Math.random(),intensity:s})}),lh(this,!1)}createEventListeners(){var e;(e=this.input.keyboard)==null||e.on("keydown-ESC",()=>{this.player.message.visible||(this.scene.pause(),this.scene.launch("Paused",{game:this}))}),this.events.on("resume",()=>{this.player.keys.resetKeys()}),this.events.on("postupdate",()=>{this.postUpdated.forEach(s=>s.postUpdate())})}}const us=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[le.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[le.Stranger]:["The sphinx’s riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","essay","dream","photograph","landscape"],hints:{[le.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[le.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[le.Inventor]:["The sphinx’s riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[le.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, don’t they?","They move, disappear, and seem to fly without wings."]}}];function ds(t){if(t instanceof sh){const i=t.player;if(fs(i,B.FindPotionIngredients))return 1}return 0}const Ud=()=>({messages:t=>qd(t.scene),options:t=>Vd(t.scene),onSelected:Yd});function qd(t){const i=ds(t);return[us[i].question]}function Vd(t){const i=ds(t),s=[...us[i].options].sort(()=>Math.random()-.5);return s.push("I don’t know"),s}function Xd(t){const i=ds(t);return us[i].answer}function tl(t,i){const e=ds(t);return us[e].hints[i]}function Yd(t,i,e){const s=Xd(i.scene);t===s?i.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:r=>{r.quests.updateExistingQuest(B.SphinxRiddle,!0),r.gameState.updateData({sphinxMoved:!0,sphinxFail:!1})}},e):t==="I don’t know"?i.message.setDialog({messages:["Come back when you have an answer for me."]},e):i.message.setDialog({messages:["That is not correct. You will not remember how to get back to me."],onCompleted:r=>{r.gameState.updateData({mazeSolved:!1,mazeSeed:r.gameState.data.mazeSeed+1,sphinxFail:!0});const n={value:0};r.active=!1,r.scene.add.timeline([{at:0,tween:{targets:n,value:{from:1,to:15},duration:1e3,onUpdate:a=>Ji(a.getValue())}},{at:500,run:()=>{Je(r.scene,300),me.stop()},sound:"sphinx_warp"},{at:3500,run:()=>{Ji(1);const{x:a,y:o}=st[z.Bed];r.setPosition(a,o),r.previousPosition.set(r.x+1,r.y),rs(r),Dt(r.scene,2e3)}},{at:6500,run:()=>{r.active=!0,r.message.setDialog({messages:["I just had the oddest dream.","I suppose I should continue investigating the town..."]},r)}}]).play()}},e)}const Kd={[le.Inventor]:[{messages:["There is still one more gear missing.","Something tells me there is a great evil near the lake."],conditions:{journalEntry:D.ClockSecondGear}},{messages:["Ah, the second gear. You should take it to the clock tower."],conditions:{hasItem:I.Gear2}},{messages:["You found a secret safe in the mansion?","Very interesting. There may be a hint about opening it nearby."],conditions:{journalEntry:D.SafeDiscovered}},{messages:["<color=blue>Blue Plumed Frond</color>? I have not heard of such a plant.","The stranger may know. Many secrets lie under this town."],conditions:{activeQuest:B.FindPotionIngredients}},{messages:["There are rumors of an abandoned mansion west of the town.","Some say it is haunted and dark magic lurks within."],conditions:{activeQuest:B.InvestigateTownWest}},{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:I.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(B.ForestGear,!0)}},{messages:t=>tl(t.scene,le.Inventor),conditions:{activeQuest:B.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:I.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench you can borrow, but you’ll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(D.FixTheClock),t.inventory.addItem({type:I.Wrench,used:!1})}}],[le.Stranger]:[{messages:["I am worried about the secrets hidden near the lake.","Long ago I saw a great evil lurking there."],conditions:{journalEntry:D.ClockSecondGear}},{messages:["Another gear? The mayor probably wants that put back in the clock tower."],conditions:{hasItem:I.Gear2}},{messages:["The lock on that safe is no ordinary lock. It requires something special to open it."],conditions:{journalEntry:D.SafeDiscovered,hasUnusedItem:I.Potion}},{messages:["Hmm a potion, I wonder what it does.","The alchemist was no ordinary person and built magical safeguards against intruders."],conditions:{hasUnusedItem:I.Potion}},{messages:["<color=green>Green Writhewood</color>? Hm, there might be some near the forest or lake."],conditions:{activeQuest:B.FindPotionIngredients}},{messages:["You heard of the mansion to the west? It was abandoned many years ago.","There is a rumor of an alchemy lab hidden somewhere nearby, but I have been searching for years and have found not even a single potion."],conditions:{activeQuest:B.InvestigateTownWest}},{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:I.Gear1}},{messages:t=>tl(t.scene,le.Stranger),conditions:{activeQuest:B.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:I.Wrench},onCompleted:t=>{t.quests.addQuest({id:B.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[le.Sphinx]:[{messages:t=>t.gameState.data.sphinxFail?["You have returned. I am surprised you were able to find your way back.","Try again."]:fs(t,B.FindPotionIngredients)?["I see you are back again. You may find what you are looking for ahead, but must first answer my riddle."]:["Ponder this riddle. Answer wisely."],conditions:{activeQuest:B.SphinxRiddle,completedQuest:B.SphinxRiddle,or:!0},onCompleted:(t,i)=>{t.scene.time.delayedCall(50,()=>{t.message.setDialog(Ud(),i)})}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:B.SphinxRiddle,completed:!1})}}],[le.Mayor]:[{messages:["The clock is still missing a gear. It must be somewhere nearby.","I’ve been hearing strange reports from the townsfolk. It’s as if time is slipping. Have you felt it?"],conditions:{journalEntry:D.ClockSecondGear}},{messages:["The second gear has been found? That’s incredible news!"],conditions:{completedQuest:B.InvestigateTownWest}},{messages:["Herbs? I haven’t the faintest idea where to being looking. Start at the source - there are bound to be a few ingredients in the lab you found."],conditions:{activeQuest:B.FindPotionIngredients}},{messages:["The minute hand on the clock is spinning again.","It looks like it’s missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:D.ClockFirstGear},onCompleted:t=>{t.quests.addQuest({id:B.InvestigateTownWest,completed:!1})}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:D.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(D.MetTheMayor)}}],[le.Innkeeper]:[{messages:[`Good evening ${Ln}! Welcome to the inn.`,"Feel free to lie your head here for helping out the town!"],conditions:{custom:t=>nt(t.scene)}},{messages:["Welcome to our humble inn. I hope you find peace here.","We can set you up with a room if you need it."]}],[le.Baker]:[{messages:["I see you found my favorite spot to get away from the bustle of our little town. Getting lost in a far away land is one of my favorite pastimes.","I come here most afternoons after early mornings of baking."],conditions:{custom:t=>t.gameState.data.day===2}},{messages:["Welcome to town! I bake the best bread around. I have a feeling I'll be seeing you again."]}]},Qd={[I.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}],[I.Gear2]:[{messages:["Finally! I found the second gear to the clock tower.","I should take this and put it back."],onCompleted:t=>{t.quests.updateExistingQuest(B.InvestigateTownWest,!0)}}]},il={[z.ClockTower]:[{messages:["With two of the gears in place, the clocks hands are moving again."],conditions:{journalEntry:D.ClockSecondGear}},{messages:["Slowly, you align and tighten the second gear into place.","<b><i>[CLUNKING NOISE]</i></b>","Now two of the hands of the clock are moving again."],conditions:{hasItem:I.Gear2},mute:[1],onMessageShown:(t,i)=>{i===1&&t.scene.sound.playAudioSprite("sfx","clunk")},onCompleted:t=>{t.inventory.useItem(I.Gear2),t.journal.addEntry(D.ClockSecondGear)}},{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:D.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Let’s see what happens when we add the first gear. You tighten the gear into place.","<b><i>[CLUNKING NOISE]</i></b>","The clock tower is starting to partially move again. It looks like it’s missing two more gears."],conditions:{hasItem:I.Gear1},mute:[2],onMessageShown:(t,i)=>{i===2&&t.scene.sound.playAudioSprite("sfx","clunk")},onCompleted:t=>{t.inventory.useItem(I.Gear1),t.journal.addEntry(D.ClockFirstGear)}}],[z.Chest]:[{messages:["The chest seems to be locked.","It appears to have many symbols above the latch."],conditions:{custom:t=>!Ye(t,I.Gear1)&&ah(t.scene,I.Gear1)===void 0},onCompleted:t=>{ze(t.scene,"MemoryDialog")}}],[z.LabHatch]:[{messages:["Let me see if I can open this hatch.","Wow, the rusty key fits!","<b><i>[CREAKING NOISE]</i></b>","Alright, let’s see what is down there!"],conditions:{hasItem:I.Key},mute:[2],onMessageShown:(t,i)=>{i===2&&t.scene.sound.playAudioSprite("sfx","door")},onCompleted:(t,i)=>{i==null||i.destroy(),t.inventory.useItem(I.Key),t.journal.addEntry(D.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[z.LabBook]:[{messages:[],conditions:{journalEntry:D.ClockSecondGear}},{messages:["I should retrace my steps to see if there is anything strange or new in the area."],conditions:{custom:()=>Rt>0}},{messages:['How could I have missed this? The potion is called the "Elixir of Sight".',"This must be related to one of the gears in the clock tower.","Well, bottoms up, I suppose!"],conditions:{hasItem:I.Potion,custom:()=>Rt===0},onCompleted:t=>{t.active=!1,t.journal.addEntry(D.ExtraPotionInformation),t.inventory.useItem(I.Potion),t.scene.time.delayedCall(3500,()=>{t.message.setDialog({messages:["I feel... different.","I should retrace my steps to see if there is anything strange or new in the area."],onCompleted:i=>{i.active=!0}},t)})}},{messages:["With the alchemy set fixed, I should be able to recreate the experiment.","I will need to find three ingredients according to this - <color=red>Crimson Starbloom</color>, <color=green>Green Writhewood</color>, and a <color=blue>Blue Plumed Frond</color>.","Maybe I can find them in the lab or the forest. The villagers should know more."],conditions:{journalEntry:D.AlchemySetFixed},onCompleted:t=>{t.quests.addQuest({id:B.FindPotionIngredients,completed:!1}),t.gameState.updateData({mazeSolved:!1,mazeSeed:t.gameState.data.mazeSeed+1,sphinxMoved:!1})}},{messages:["Maybe I can find more information in the lab."],conditions:{activeQuest:B.ExploreLab}},{messages:["This lab journal contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:t=>{t.quests.addQuest({id:B.ExploreLab,completed:!1})}}],[z.AlchemySet]:[{messages:["There’s nothing more that I can do here."],conditions:{hasItem:I.Potion}},{messages:["Now I have all of the ingredients.","With these, I should be able to recreate the experiment.","According to the book..."],conditions:{hasUsedItem:I.HerbBlue},onCompleted:(t,i)=>{id(t,i)}},{messages:["The Blue Plumed Frond is last."],conditions:{hasItem:I.HerbBlue,hasUsedItem:I.HerbRed},onCompleted:(t,i)=>{qr(t,i,I.HerbBlue),t.quests.updateExistingQuest(B.FindPotionIngredients,!0)}},{messages:["The Crimson Starbloom comes next."],conditions:{hasItem:I.HerbRed,hasUsedItem:I.HerbGreen},onCompleted:(t,i)=>qr(t,i,I.HerbRed)},{messages:["The Green Writhewood goes in first."],conditions:{hasItem:I.HerbGreen},onCompleted:(t,i)=>qr(t,i,I.HerbGreen)},{messages:["Maybe the journal has more information about using this alchemy set."],conditions:{journalEntry:D.AlchemySetFixed}},{messages:["This alchemy set looks like the one in the journal.","If I can figure out how the set connects together, I might be able to recreate the experiment."],conditions:{activeQuest:B.ExploreLab},onCompleted:t=>{ze(t.scene,"PipesDialog")}},{messages:["A series of pipes and tubes. I shouldn’t touch this without knowing what it does."]}],[z.LabBookshelf1]:[{messages:[`<b>[Secrets of the Silver Transmutation]</b>
"Silver, the mirror of the soul, can be yielded from common materials. Begin with a lead base, cleanse it with the tears of a willow,"`,'"and chant thrice under a new moon. Such processes, though fraught with danger, promise immense reward. Meticulous preparation of the material is crucial. Among these pages lie safeguards against volatile spirits"','"and the precise lunar phases essential for success. Here are protective circles and counter-spells to be used should spirits prove malevolent. This knowledge has been passed down and refined for safety."'],conditions:{activeQuest:B.ExploreLab}}],[z.LabBookshelf2]:[{messages:[`<b>[Whispering Woods: A Compendium]</b>
"The sentient trees of Eldergrove are not myths; their trunks groan with ancient wisdom. To engage them, perform the Ritual of Leaves,"`,'"using moonlit water and rare herbs, along with whispered incantations passed down by forest guardians. Notes on the rare Blue Moonflower, whose petals glow ghostly and unlock forest languages, are also included."','"Its bloom is brief, and harvesting must be timed at midnight to retain its properties. The chapter concludes with a discussion on plant symbiosis with Eldertrees."'],conditions:{activeQuest:B.ExploreLab}}],[z.LabBookshelf3]:[{messages:[`<b>[The Essence of Fire: Ignite and Control]</b>
"Mastering fire requires strength of will and profound respect for its power. Here, summoning circles and incantations to call forth fire spirits"`,'"are detailed. Each summoning demands a tribute of phoenix ash. The endeavor is perilous, as spirits may lash out if provoked. The tome also discusses methods to quell flames should they rise against the summoner."','"Included are the chant of suppression and a dousing mixture from elemental waters and frost-bitten herbs. These countermeasures are vital for maintaining control over summoned entities."'],conditions:{activeQuest:B.ExploreLab}}],[z.LabPotionShelf1]:[{messages:["Nightshade, wolfsbane, starvine, frost ferns... No, those are not the right ingedients.","Oh, a <color=red>Crimson Starbloom</color>! Yes, this should work!"],conditions:{activeQuest:B.FindPotionIngredients,custom:t=>!Ye(t,I.HerbRed)},onCompleted(t){t.inventory.addItem({type:I.HerbRed,used:!1})}},{messages:['Hm, this is an interesting collection. What’s this "Elixir of Luminescence"? Could light up some dark corners. And "Brew of Bravery"... might make me bold enough to face a dragon, or foolish enough to try. What about "Draught of the Depths"—sounds like it could show me treasures or drown me in visions. Better not risk it; these might just burn me to a crisp!'],conditions:{activeQuest:B.ExploreLab}}],[z.MansionPicture]:[{messages:[],conditions:{hasItem:I.Gear2}},{messages:["A sturdy looking safe was hidden behind the picture.","There are large rusty rings to the side, as if it they were meant to be moved."],conditions:{journalEntry:D.SafeDiscovered},onCompleted:t=>{ze(t.scene,"TumblerDialog")}},{messages:["An abstract picture of blocks.","Wait a moment, something is behind this picture...","<b><i>[CREAK]</i></b>"],mute:[2],onMessageShown:(t,i)=>{i===2&&t.scene.sound.playAudioSprite("sfx","chest")},onCompleted:t=>{t.journal.addEntry(D.SafeDiscovered)},conditions:{hasUsedItem:I.Potion}},{messages:["An abstract picture of blocks."]}],[z.MansionHole]:[{messages:["Literally a hole in the wall.","Huh, there is something here. It's a key!"],conditions:{hasItem:I.Key,invert:!0},onCompleted:t=>{t.inventory.addItem({type:I.Key,used:!1})}},{messages:["Literally a hole in the wall."]}],[z.Bed]:[{conditions:{custom:t=>nt(t.scene)},messages:["What a long day. Time for some sleep before I continue my journey."],onCompleted:t=>rd(t)},{messages:["A comfortable bed.","I should rest here if I need to."]}],[z.LibraryShelf]:[{conditions:{hasUnusedItem:I.Note},messages:["A library shelf, maybe I can find something interesting here."],onCompleted:t=>ze(t.scene,"Books")}]};function es(t,i,e){for(const s of t){const{conditions:r}=s,n=[];if((r==null?void 0:r.hasItem)!==void 0&&n.push(Ye(i,r.hasItem)),(r==null?void 0:r.hasUnusedItem)!==void 0&&n.push(rh(i,r.hasUnusedItem)),(r==null?void 0:r.hasUsedItem)!==void 0&&n.push(vi(i,r.hasUsedItem)),(r==null?void 0:r.completedQuest)!==void 0&&n.push(nh(i,r.completedQuest)),(r==null?void 0:r.activeQuest)!==void 0&&n.push(fs(i,r.activeQuest)),(r==null?void 0:r.journalEntry)!==void 0&&n.push(vt(i,r.journalEntry)),r!=null&&r.custom&&n.push(r.custom(i,e)),r!=null&&r.invert){if(r!=null&&r.or){if(n.some(a=>!a))return s}else if(n.every(a=>!a))return s;return}if(r!=null&&r.or){if(n.some(a=>a))return s}else if(n.every(a=>a))return s}}class si extends E.Physics.Arcade.Image{constructor(e,s,r){const{x:n,y:a,image:o}=Mt[s];super(e,n,a,"items",o);d(this,"itemType");d(this,"player");d(this,"particles");d(this,"light");d(this,"disabled",!1);d(this,"initialized",!1);this.name=`Item-${s}`,this.itemType=s,this.player=r,this.setScale(.35).setDepth(V.Items),ai(this,Mt[s])}lazyInit(){if(this.initialized||!Ze(this,this.player))return;if(Ye(this.player,this.itemType)){this.destroy();return}this.scene.add.existing(this),this.scene.physics.add.existing(this),f.debug&&this.setInteractive({draggable:!0}),this.particles=this.scene.add.particles(this.x,this.y,"props",{frame:"warp",scale:{start:0,end:.9},alpha:{start:.7,end:0},delay:500,lifespan:1500,maxAliveParticles:1}).setDepth(V.Items).setName(`Item-${this.itemType}-Particles`),f.debug?this.light=new at(this.scene,this.x,this.y,150*(this.displayHeight/150),16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,150*(this.displayHeight/150),16764074,2);const e=Mt[this.itemType].onCreate;e&&e(this),this.initialized=!0}onInteract(e){return e[C.Continue]?(this.scene.time.delayedCall(0,()=>{this.player.inventory.addItem({type:this.itemType,used:!1});const s=Qd[this.itemType]||[],r=es(s,this.player,this);r&&(r==null?void 0:r.messages.length)>0&&this.player.message.setDialog(r,this,"player_portrait")}),this.destroy(),Ae.Item):Ae.None}destroy(e){var s,r,n;(s=this.particles)==null||s.destroy(),this.light instanceof at?this.light.destroy():(n=(r=this.scene)==null?void 0:r.lights)==null||n.removeLight(this.light),super.destroy(e)}getButtonPrompt(){return[`Pick Up ${Mt[this.itemType].name}`,"Press [CONTINUE]"]}update(){var e,s;this.lazyInit(),(e=this.particles)==null||e.setPosition(this.x,this.y),(s=this.light)==null||s.setPosition(this.x,this.y)}}function Ye(t,i){return t.inventory.inventory.find(e=>e.type===i)!==void 0}function rh(t,i){return t.inventory.inventory.find(e=>e.type===i&&!e.used)!==void 0}function vi(t,i){return t.inventory.inventory.find(e=>e.type===i&&e.used)!==void 0}function fs(t,i){return t.quests.quests.some(e=>e.id===i&&!e.completed)}function nh(t,i){return t.quests.quests.some(e=>e.id===i&&e.completed)}function vt(t,i){return t.journal.journal.includes(i)}function ni(t,i){return t.children.getAll().filter(e=>e instanceof i)}function ts(t,i,e){const s=Nn(t,i);s&&s.updateLocked(e)}function Nn(t,i){return ni(t,qi).find(e=>e.warpType===i)}function Jd(t,i){return ni(t,E.GameObjects.Rectangle).find(e=>e.getData("WallType")===i)}function ah(t,i){return ni(t,si).find(e=>e.itemType===i)}function xi(t,i){return ni(t,Zi).find(e=>e.propType===i)}function ai(t,i){const{scale:e,alpha:s,angle:r,depth:n,skipLighting:a,origin:o}=i;e&&(typeof e=="object"?t.setScale(e.x,e.y):t.setScale(e)),s&&t.setAlpha(s),r&&t.setAngle(r),n&&t.setDepth(n),o&&t.setOrigin(o.x,o.y),a||t.setPipeline("Light2D"),t.setPostPipeline("XRayPipeline")}const is=1200;let ss=!1;function oh(t){return gn(t.lights.ambientColor)===L(_.White)}function nt(t){return gn(t.lights.ambientColor)===L(_.Night)}function lh(t,i=!0){if(ss)return;hh(t,_.White,i),i?t.time.delayedCall(is,()=>un(t,.5)):un(t,.5),t.lights.lights.forEach(s=>{const r=s.intensity;i?t.tweens.add({targets:s,duration:is,intensity:0,onComplete:()=>{s.setVisible(!1),s.setIntensity(r)}}):s.setVisible(!1)});const e=Nn(t,R.TownNorth);e==null||e.updateLocked(!1)}function Zd(t,i=!0){if(ss)return;hh(t,_.Night,i),un(t,1),t.lights.lights.forEach(s=>{const r=s.intensity;s.setVisible(!0),i&&(s.setIntensity(0),t.tweens.add({targets:s,duration:is,intensity:r}))});const e=Nn(t,R.TownNorth);f.debug||e==null||e.updateLocked(!0)}function hh(t,i,e){if(!e){t.lights.setAmbientColor(L(i));return}ss=!0;const s=gn(t.lights.ambientColor),r=E.Display.Color.ValueToColor(s),n=E.Display.Color.ValueToColor(i);Xt(t,r,n,a=>t.lights.setAmbientColor(a),{duration:is,onComplete:()=>{ss=!1}})}function un(t,i){t.children.getAll("name","DebugLightGraphics").forEach(s=>s.setAlpha(i))}const oi={mazeSolved:!1,mazeSeed:0,sphinxFail:!1,sphinxMoved:!1,day:1,night:!1};class ef{constructor(i,e){d(this,"scene");d(this,"player");d(this,"initialized");d(this,"data");this.scene=i,this.player=e,this.initialized=!1,this.data={...oi}}updateData(i,e){this.data={...this.data,...i},Object.entries(i).forEach(([s,r])=>{this.handleSideEffects(s,r,e)}),e||ls(this.scene),this.initialized=!0}handleSideEffects(i,e,s){i==="night"&&(e?Zd(this.scene,!s):lh(this.scene,!s))}}const tt="chrono-sleuth-save";var mt=(t=>(t[t.New=0]="New",t[t.Act1=1]="Act1",t[t.Act2=2]="Act2",t[t.LabItems=3]="LabItems",t[t.Act3=4]="Act3",t))(mt||{});const ch={player:{x:Kt.x,y:Kt.y,flip:!1},journal:[],inventory:[],quests:[],gameState:{...oi},settings:{gamepad:Yc(),debug:!1,zoomed:!0,useShader:!0,time:Date.now(),muted:!1}},ps={...ch.settings,gamepad:!1},tf={player:{x:642,y:650,flip:!1},journal:[D.FixTheClock],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!1}],quests:[{id:B.ForestGear,completed:!1},{id:B.SphinxRiddle,completed:!0}],gameState:{...oi,mazeSolved:!0,sphinxMoved:!0},settings:{...ps}},sf={player:{x:-770,y:650,flip:!0},journal:[D.FixTheClock,D.MetTheMayor,D.ClockFirstGear],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!0}],quests:[{id:B.ForestGear,completed:!0},{id:B.SphinxRiddle,completed:!0},{id:B.InvestigateTownWest,completed:!1}],gameState:{...oi,mazeSolved:!0,sphinxMoved:!0},settings:{...ps}},rf={player:{x:-1500,y:1729,flip:!0},journal:[D.FixTheClock,D.MetTheMayor,D.ClockFirstGear,D.AlchemyLabFound,D.AlchemySetFixed],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!0},{type:I.Key,used:!0}],quests:[{id:B.ForestGear,completed:!0},{id:B.SphinxRiddle,completed:!0},{id:B.InvestigateTownWest,completed:!1},{id:B.ExploreLab,completed:!1},{id:B.FindPotionIngredients,completed:!1}],gameState:{...oi},settings:{...ps}},nf={player:{x:5073.875,y:915,flip:!1},journal:[D.FixTheClock,D.MetTheMayor,D.ClockFirstGear,D.AlchemyLabFound,D.AlchemySetFixed,D.SafeDiscovered,D.ExtraPotionInformation,D.ClockSecondGear],inventory:[{type:I.Wrench,used:!1},{type:I.Gear1,used:!0},{type:I.Key,used:!0},{type:I.HerbRed,used:!0},{type:I.HerbGreen,used:!0},{type:I.HerbBlue,used:!0},{type:I.Potion,used:!0},{type:I.Gear2,used:!0}],quests:[{id:B.ForestGear,completed:!0},{id:B.SphinxRiddle,completed:!0},{id:B.InvestigateTownWest,completed:!0},{id:B.ExploreLab,completed:!0},{id:B.FindPotionIngredients,completed:!0}],gameState:{...oi,mazeSolved:!0,sphinxMoved:!0},settings:{...ps}},ti={0:ch,1:tf,2:sf,3:rf,4:nf};class af extends E.Scene{constructor(){super({key:"Boot",pack:{files:[{type:"image",key:"splash",url:"assets/splash.jpg"},{type:"image",key:"logo",url:"assets/logo.jpg"}]}})}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(f.width,f.height),this.add.image(35,f.height-30,"logo").setOrigin(0,1).setScale(.4),Lh(this.sound)}preload(){this.load.setPath("assets"),this.load.font("m6x11","fonts/m6x11.ttf","truetype"),this.load.bitmapFont("m6x11-24","fonts/m6x11-24.png","fonts/m6x11-24.xml"),this.load.font("notepen","fonts/Notepen.ttf","truetype"),this.load.font("Germania One","fonts/GermaniaOne-Regular.ttf","truetype"),this.load.atlas("icons","atlases/icons.png","atlases/icons.json"),this.load.audioSprite("words","sounds/words.json"),this.load.audioSprite("sfx","sounds/sfx.json"),this.load.audio(we.Town,pn[we.Town]),this.load.json("build",`../build.json?cacheBust=${Date.now()}`),f.phaserInspector&&(this.load.scripts("inspector",["https://cdn.jsdelivr.net/npm/tweakpane@3.1.10/dist/tweakpane.js","https://cdn.jsdelivr.net/npm/phaser-plugin-inspector@2.5.0/dist/phaser-plugin-inspector.umd.js"]),this.load.once("complete",()=>{PhaserPluginInspector.Install(this.plugins)}))}create(){var i;try{const e=(i=this.cache.json.get("build"))==null?void 0:i.buildTime;if(e&&e!=="2025-04-05T07:56:28.362Z"){this.add.text(f.width/2,f.height/2,`New version available!
Updating Game...`,{...ue,align:"center",fontSize:48}).setOrigin(.5).postFX.addGlow(0,10),caches.keys().then(r=>{for(const n of r)caches.delete(n)}),setTimeout(()=>window.location.reload(),3e3);return}}catch(e){console.error(e)}!f.prod||!localStorage.getItem(tt)?this.scene.start("Preloader"):this.scene.start("MainMenu")}}function uh(t){t.load.setPath("assets"),t.load.image("train","maps/intro/train.png"),t.load.image("layer2","maps/intro/layer2.png"),t.load.image("layer3","maps/intro/layer3.png"),t.load.image("layer4","maps/intro/layer4.png"),t.load.image("layer5","maps/intro/layer5.png"),f.prod&&t.load.audio(we.Intro,pn[we.Intro])}class of extends E.Scene{constructor(){super("Intro");d(this,"player");d(this,"playerProgess",0);d(this,"direction",1);d(this,"pauseDuration",0)}preload(){uh(this)}init(){var e,s;this.sound.mute=ti[mt.New].settings.muted,f.prod||((e=this.input.keyboard)==null||e.on("keydown-BACK_SLASH",()=>{Je(this,500,()=>{this.textures.exists("props")?this.scene.start("Game"):this.scene.start("Preloader")})}),(s=this.input.keyboard)==null||s.on("keydown-R",()=>{this.scene.restart()}))}create(){var v;me.setScene(this),me.start(we.Intro);const e=this.sound.addAudioSprite("sfx"),s=e.markers.train_rolling;e.addMarker({name:"train_rolling_trimmed",start:(s.start||0)+.5,duration:3.25}),e.play("train_rolling_trimmed",{loop:!0,volume:.15});const r=f.zoomed?.75:1;Dt(this,350),this.add.image(f.width,f.height,"layer5").setScale(5.4*r);const n=this.add.image(0,f.height,"layer4").setScale(5.4*r),a=this.add.image(0,f.height,"layer4").setScale(5.4*r),o=this.add.image(0,350*r,"layer3").setScale(2.16*r),l=this.add.image(0,f.height*.7,"layer2").setScale(5.4*r),h=f.width;let u=15e3;this.tweens.add({targets:[n],x:{from:-h*2.5,to:0},duration:u*8,repeat:-1}),this.tweens.add({targets:[a],x:{from:0,to:h*2.5},duration:u*8,repeat:-1}),this.tweens.add({targets:o,x:{from:-h*2,to:h*2.75},duration:u*4,hold:u*6,repeat:-1}),this.tweens.add({targets:[l],x:{from:-h,to:h*1.5},duration:u,hold:u*3,repeat:-1});const c=this.add.container(0,f.zoomed?-35:0);this.player=this.add.sprite(560*r,f.height-250*r,"character",0).setScale(2.5*r),this.player.anims.create({key:"walk",frames:this.player.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:5,repeat:-1}),this.player.anims.play("walk"),this.player.anims.pause(),c.add(this.player),this.cameras.main.startFollow(this.player,!0,.1,.1,0,120);const p=this.add.image(f.width/2,f.height/2,"train").setScale(2.35*r);c.add(p),this.tweens.add({targets:c,x:c.x+1,y:c.y+5,duration:300,hold:300,ease:"Bounce",repeat:-1}),(v=this.add.rectangle(-f.width/2,f.height-(f.zoomed?60:35),f.width*2,35,4472896).setOrigin(0).postFX)==null||v.addShadow(0,0,.5,1),Zu(this,this.player)}}class dh extends Qe{constructor(i,e,s){super(i,e,s,i.scale.isFullscreen?"minimize":"maximize",()=>{i.scale.isFullscreen?i.scale.stopFullscreen():i.scale.startFullscreen()}),i.scale.on(Phaser.Scale.Events.ENTER_FULLSCREEN,()=>{this.img.scene=i,this.img.setTexture("icons","minimize")}),i.scale.on(Phaser.Scale.Events.LEAVE_FULLSCREEN,()=>{this.img.scene=i,this.img.setTexture("icons","maximize")})}}function fh(t){t.load.setPath("assets"),t.load.image("station","maps/station.png"),t.load.image("town","maps/town.png"),t.load.image("library","maps/library.png"),t.load.image("inn","maps/inn.png"),t.load.image("clock_outside","maps/clock_outside.png"),t.load.image("clock_inner","maps/clock_inner.png"),t.load.image("forest","maps/forest.png"),t.load.image("lake","maps/lake.png"),t.load.image("mansion_outside","maps/mansion_outside.png"),t.load.image("mansion_inside","maps/mansion_inside.png"),t.load.image("alchemy_lab","maps/alchemy_lab.png"),t.load.spritesheet("portal","spritesheets/portal.png",{frameWidth:140,frameHeight:120}),t.load.spritesheet("character","spritesheets/player.png",{frameWidth:40,frameHeight:74}),t.load.atlas("items","atlases/items.png","atlases/items.json"),t.load.atlas("props","atlases/props.png","atlases/props.json"),t.load.atlas("characters","atlases/characters.png","atlases/characters.json"),f.prod&&Object.entries(pn).filter(([i,e])=>i!==we.Town).forEach(([i,e])=>{t.load.audio(i,e)}),t.load.image("train","maps/intro/train.png"),localStorage.getItem(tt)||uh(t)}class lf extends E.Scene{constructor(){super("Preloader");d(this,"container")}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(f.width,f.height),this.add.image(35,f.height-30,"logo").setOrigin(0,1).setScale(.4);const e=f.width*.66,s=f.height*.05,r=3,n=this.add.container(f.width*.24,f.height*.86);this.container=n;const a=this.add.rectangle(0,0,e,s).setStrokeStyle(1,16777215,.85).setOrigin(0);n.add(a);const o=this.add.rectangle(r,r,0,s-r*2,16777215,.85).setOrigin(0);n.add(o),this.load.on("progress",h=>{const u=f.prod?h*.6:h;o.width=(e-r*2)*u}),f.prod&&this.load.on("complete",()=>{this.tweens.add({targets:o,width:e-r*2,duration:2e3})});const l=this.add.image(f.width-50,f.height-60,"icons","settings").setScale(.75);this.tweens.add({targets:l,angle:360,duration:2e3,delay:100,repeat:-1})}preload(){fh(this)}create(){this.start()}start(){localStorage.getItem(tt)?this.scene.start("Game"):this.scene.start("Intro")}}class hf extends E.Scene{constructor(){super("MainMenu")}create(){me.setScene(this),me.start(we.Town),this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(f.width,f.height);const i=this.add.container(0,0);i.setAlpha(0),this.tweens.add({targets:i,alpha:1,duration:150}),i.add(this.add.image(35,f.height-30,"logo").setOrigin(0,1).setScale(.4)),new ns(this),new cs(this,!0).setVisible(!1);const e=new _n(this);i.add(e);const s=new dh(this,f.width-30,30);e.addButton(s),localStorage.getItem(tt)&&e.addButton(new et(this,f.width-120,f.height-145,"Continue",()=>this.scene.start("Preloader"),{align:"center"}).setFixedSize(200,70)),e.addButton(new et(this,f.width-120,f.height-60,"New Game",()=>{localStorage.removeItem(tt),this.scene.start("Preloader")},{align:"center"}).setFixedSize(200,70)),e.setActiveButton(1),this.time.delayedCall(1500,()=>{fh(this),this.load.start()})}}class ph extends E.GameObjects.Container{constructor(e,s,r){var n,a,o,l,h;super(e,s,r);d(this,"buttons",[]);d(this,"activeIndex",new E.Math.Vector2);d(this,"cursor");e.add.existing(this).setScrollFactor(0),this.activeIndex.set(-1,-1),(n=e.input.keyboard)==null||n.on("keydown-UP",()=>{this.setActiveButton({x:0,y:-1})}),(a=e.input.keyboard)==null||a.on("keydown-DOWN",()=>{this.setActiveButton({x:0,y:1})}),(o=e.input.keyboard)==null||o.on("keydown-LEFT",()=>{this.setActiveButton({x:-1,y:0})}),(l=e.input.keyboard)==null||l.on("keydown-RIGHT",()=>{this.setActiveButton({x:1,y:0})}),(h=e.input.keyboard)==null||h.on("keydown-ENTER",()=>{const u=this.getActiveButton();u&&u.onClick()}),e.input.on("pointermove",()=>{this.cursor.setVisible(!1)})}setButtons(e){this.buttons=e,this.activeIndex.set(-1,-1),this.removeAll(!0),this.cursor=this.scene.add.rectangle(0,0,60,80).setStrokeStyle(2,L(_.Tan),.75).setVisible(!1).setDepth(1),this.add(this.cursor);for(const s of e)for(const r of s)r!==void 0&&this.add(r)}getActiveButton(){var e;return(e=this.buttons[this.activeIndex.y])==null?void 0:e[this.activeIndex.x]}setActiveButton(e){var o,l,h,u,c,p,g;let{x:s,y:r}=this.activeIndex;if(this.cursor.visible===!1){const v=(o=this.buttons[r])==null?void 0:o[s];v&&(this.updateButtonSize(v),this.cursor.setPosition(v.x,v.y).setVisible(!0),this.cursor.setVisible(!0));return}const n=this.buttons.length;if(r=E.Math.Clamp(r,0,n-1),s=E.Math.Clamp(s,0,(((l=this.buttons[r])==null?void 0:l.length)||0)-1),e.x===0){let v;if(this.activeIndex.y!==-1){for(;r>=0&&r<n&&v===void 0;)r+=e.y,v=(h=this.buttons[r])==null?void 0:h[s];if(!v)return}s=E.Math.Clamp(s,0,((u=this.buttons[r])==null?void 0:u.length)-1)}if(e.y===0&&this.activeIndex.x!==-1){let v;for(;s>=0&&s<((c=this.buttons[r])==null?void 0:c.length)&&v===void 0;)s+=e.x,v=(p=this.buttons[r])==null?void 0:p[s];if(!v)return}const a=(g=this.buttons[r])==null?void 0:g[s];a&&(this.updateButtonSize(a),this.cursor.setPosition(a.x,a.y).setVisible(!0),this.activeIndex.set(s,r))}updateButtonSize(e){e instanceof et&&this.cursor.setSize(e.displayWidth+8,e.displayHeight+8),e instanceof Qe&&this.cursor.setSize(e.rect.displayWidth+8,e.rect.displayHeight+8)}}const Zr=[[1,1,1,0,1],[1,0,1,0,1],[1,1,1,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],en=[["0","1","2"],["3"," ","4"],["5","6","7"]];class cf extends E.Scene{constructor(){super("UITest");d(this,"selected");d(this,"cursor");d(this,"grid");this.selected=void 0}create(){var s;const e=[];for(let r=0;r<Zr.length;r++){const n=[];for(let a=0;a<Zr[r].length;a++)Zr[r][a]?n.push(this.btn(a,r)):n.push(void 0);e.push(n)}this.grid=new ph(this),this.grid.setButtons(e),(s=this.input.keyboard)==null||s.on("keydown-BACK_SLASH",()=>{e[0][0].text="0",e[0][1].text="1",e[0][2].text="2",e[1][0].text="3",e[1][2].text="4",e[2][0].text="5",e[2][1].text="6",e[0][4].text=" ",e[1][4].text=" ",e[2][4].text=" ",e[3][4].text=" ",e[4][4].text=" ",e[5][4].text=" ",e[6][4].text=" "})}btn(e,s){return new et(this,50+e*60,50+s*85,e<3?" ":s.toString(),r=>this.selectButton(r))}selectButton(e){if(this.selected===void 0)this.selected=e,e.setSelected(!0);else{const s=this.selected.text;this.selected.setSelected(!1),this.selected.text=e.text,e.text=s,this.selected=void 0,this.checkValid()&&console.log("You Won!")}}checkValid(){var s;let e=!0;for(let r=0;r<en.length;r++)for(let n=0;n<en[0].length;n++){const a=(s=this.grid.buttons[r])==null?void 0:s[n];a&&a.text!==en[r][n]&&(e=!1)}return e}}class gs extends E.GameObjects.Rectangle{constructor(e,s,r){super(e,0,0);d(this,"keys");d(this,"cursorData");d(this,"nextUpdate",0);d(this,"position",new E.Math.Vector2(-1,-1));e.add.group(this,{runChildUpdate:!0}),this.setStrokeStyle(3,L(_.Tan),.75),this.setVisible(!1).setDepth(V.Shader),this.cursorData=s,this.keys=r,e.input.on("pointerdown",n=>{this.setVisible(!1)})}update(e,s){var o;if(e<this.nextUpdate)return;let r=!0,n;this.cursorData.regions[this.position.y]&&(n=this.cursorData.regions[this.position.y][this.position.x]);const a=this.keys.keys;if(a[C.Continue]?this.cursorData.onSelect(this.position,n):a[C.Left]?this.position.x--:a[C.Right]?this.position.x++:a[C.Up]?this.position.y--:a[C.Down]?this.position.y++:r=!1,r){const l=(o=this.cursorData.regions[0])==null?void 0:o.length,h=this.cursorData.regions.length;this.position.x=E.Math.Clamp(this.position.x,0,l-1),this.position.y=E.Math.Clamp(this.position.y,0,h-1);const u=this.cursorData.regions[this.position.y][this.position.x];this.cursorData.hidden||this.setVisible(!0),this.setPosition(u.x,u.y),this.setDisplaySize(u.width,u.height),this.cursorData.onChange&&this.cursorData.onChange(this.position,u),this.nextUpdate=e+200}}}class ot extends E.Scene{constructor(e){super(e.key);d(this,"dialogData");d(this,"container");d(this,"keys");d(this,"title");d(this,"helpText");d(this,"closing");d(this,"additionalUI");this.dialogData=e}create(){var h,u,c;this.additionalUI=[],this.closing=!1;const e=.95,s=4,r=f.width*e+s,n=f.height*e+s,o=this.add.rectangle(f.width/2,f.height/2,r,n,16777215).setOrigin(.5).setVisible(!1).createGeometryMask();this.container=this.add.container(f.width/2,f.height/2),this.container.setMask(o);const l=this.dialogData;l.skipUI||(this.container.add(this.add.rectangle(0,0,f.width*e,f.height*e,0,.75).setStrokeStyle(s,L(_.Tan))),this.container.add(new et(this,f.width*.43,f.height*-.39,"X",()=>this.close(!1),{backgroundColor:`#${_.Warning}`})),!f.prod&&!l.hideCloseSuccess&&this.container.add(new Qe(this,f.width*.38,f.height*-.4,"award",()=>this.close(!0))),this.title=this.add.text(0,f.height*-.4,l.title,{...ue,fontSize:48}).setOrigin(.5),this.container.add(this.title),l.helpText&&(this.helpText=this.add.text(-f.width*.45,f.height*.2,l.helpText,ue),this.container.add(this.helpText))),(h=this.input.keyboard)==null||h.on("keydown-ESC",()=>{this.close(!1)}),(u=this.input.keyboard)==null||u.on("keydown-BACKSPACE",()=>{this.close(!1)}),f.prod||(c=this.input.keyboard)==null||c.on("keydown-BACK_SLASH",()=>{this.close(!0)}),this.keys=new ns(this),new cs(this,!0).setVisible(this.dialogData.gamepadVisible),this.container.setAlpha(0),this.dialogData.childScene?(this.scene.launch(this.dialogData.childScene,{parent:this}),this.scene.get(this.dialogData.childScene).events.on("create",()=>this.fadeIn())):this.fadeIn(),me.setScene(this),me.fadeMusic(.15)}fadeIn(){this.tweens.killAll(),this.tweens.add({targets:this.getTargets(),alpha:{start:0,to:1},delay:100,duration:500})}fadeOut(e){this.tweens.killAll(),this.tweens.add({targets:this.getTargets(),alpha:{start:1,to:0},duration:250,hold:250,onComplete:e})}addTarget(e){e.setAlpha(0),this.additionalUI.push(e)}getTargets(){return[this.container,...this.additionalUI]}close(e){if(this.closing)return;this.closing=!0,this.preHandleSuccess(e);const s=this.scene.get("Game");me.fadeMusic(me.volume,500,()=>me.setScene(s)),this.fadeOut(()=>{var r,n;this.scene.stop(),this.dialogData.childScene&&this.scene.stop(this.dialogData.childScene),this.scene.resume(s),(r=s==null?void 0:s.gamepad)==null||r.setAlpha(1),(n=s==null?void 0:s.gamepad)==null||n.resetButtons(),this.handleSuccess(e)})}preHandleSuccess(e){}}const $i=6,gi=["The Forgotten Aeon","Taming the Wild Griffin","Surrender to the Starlit Realm","The Creation of Time","The Eternal End","The Bard’s Forbidden Melody","Bound by Fate and Fire","Secrets of the Fifth Element","The Enchanted Knight’s Oath","A Potion for Yesterday","Chronomancer’s Dilemma","Tome of the Lost Hours","The Midnight Convergence","The Rogue’s Tempting Treasure","Whispers of the Moonlit Grove","The Sorcerer’s Gentle Caress","The Elixir That Binds","Transmutation of the Soul","The Philosopher’s Vice","The Silver Circle’s Curse","A Mage’s Soft Touch","The Alchemist’s Second Life","The Thaumaturge’s Gambit","Through the Alchemist’s Looking Glass","Legends of the Velvet Throne"],Wi=[gi.indexOf("The Creation of Time"),gi.indexOf("Chronomancer’s Dilemma"),gi.indexOf("Transmutation of the Soul"),gi.indexOf("The Eternal End")];class uf extends ot{constructor(){super({key:"Books",title:"Books",gamepadVisible:!1,skipUI:!0});d(this,"player");d(this,"books");d(this,"message");d(this,"answer");d(this,"bookshelf");d(this,"door");d(this,"debug")}preload(){this.load.setPath("assets"),this.load.atlas("bookshelf","atlases/bookshelf.png","atlases/bookshelf.json")}init(e){this.player=e.player}create(){super.create(),this.books=[],this.message=new Dn(this),this.answer=[],this.debug=[],this.container.add(this.add.rectangle(0,0,f.width,f.height,0));const e=Ye(this.player,I.Note);if(this.createBookshelf(e),this.container.add(new et(this,f.width*.47,f.height*-.43,"X",()=>this.close(!1),{...ue,backgroundColor:void 0,fontSize:54})),!f.prod&&!this.dialogData.hideCloseSuccess){const s=new Qe(this,f.width*.467,f.height*-.3,"award",()=>this.close(!0));s.rect.fillColor=0,s.rect.strokeColor=0,this.container.add(s)}if(e){this.time.delayedCall(200,()=>{this.message.setDialog({messages:["This note seems to be a clue of some sort. Maybe it has to do with some sort of ordering for the books on the shelf."]},void 0,"player_portrait")});const s=this.add.image(0,0,"props","paper").setScale(1.6,2.25).setAngle(90);s.setPosition(20+s.displayHeight/2,5+s.displayWidth/2),this.addTarget(s);const r=this.add.text(70,50,["A spiral marks the heart of the sequence.",'Time begins with "Creation" and ends in "Eternity".',"A blue tome, near the center, waits before the final touch."].join(`

`),{...an,fontSize:36}).setWordWrapWidth(260);this.addTarget(r)}this.fadeIn()}createBookshelf(e){var u;const s=this.textures.get("bookshelf"),r=Object.entries(s.frames),n=[],a=4,o=e?150:0;this.bookshelf=this.add.image(o,0,"bookshelf","Bookshelf-0").setScale(a).setTint(6710886),this.container.add(this.bookshelf),this.door=this.add.image(o,0,"bookshelf","Door-0").setScale(a).setTint(6710886),this.container.add(this.door);const l=r.filter(c=>c[1].name.startsWith("Book_")).sort((c,p)=>{const g=Number(c[1].name.replace("Book_","").replace("-0","")),v=Number(p[1].name.replace("Book_","").replace("-0",""));return g-v});for(let c=0;c<l.length;c++){const p=l[c],g=this.add.image(o,0,"bookshelf",p[1].name).setScale(a);g.setData({index:c}),this.container.add(g);const v=2,y=p[1].data.spriteSourceSize,m=new E.Geom.Rectangle(y.x-v,y.y-v,y.w+v*2,y.h+v*2);g.setInteractive({hitArea:m,hitAreaCallback:E.Geom.Rectangle.Contains,cursor:"pointer"});const w=Math.floor(c/4);n[w]===void 0&&n.push([]),n[w].push({x:-1,y:-1,width:-1,height:-1,object:g});const k=(u=g.preFX)==null?void 0:u.addGlow(L(_.Tan),0);if(k&&(this.books.push({image:g,glow:k,strength:0,name:gi[c]}),g.on("pointerover",()=>{this.books[c].strength=$i}),g.on("pointerout",()=>{this.answer.includes(c)||(this.books[c].strength=0)}),g.on("pointerdown",()=>{this.handleClick(c)}),!f.prod&&e&&Wi.includes(c))){const x=this.add.text(m.x*4-o+40,m.y*4-f.height/2+40,(Wi.indexOf(c)+1).toString(),ue).setAlpha(.5);this.container.add(x),this.debug.push(x)}}const h=new gs(this,{regions:n,onSelect:(c,p)=>{if(p!=null&&p.object&&!this.message.visible){const g=p.object.getData("index");this.handleClick(g)}},onChange:(c,p)=>{if(p!=null&&p.object){const g=p.object.getData("index");this.books.forEach((v,y)=>{this.answer.includes(y)||(v.strength=y===g?$i:0)})}},hidden:!0},this.keys);this.container.add(h)}handleClick(e){const s=Ye(this.player,I.Note),r=Wi[this.answer.length]===e&&s,n=[this.books[e].name];r&&n.push("<b><i>[CLUNK]</i></b> The book shifts slightly."),this.message.setDialog({messages:n,mute:r?[1]:void 0,onMessageShown:(a,o,l)=>{o===1&&this.sound.playAudioSprite("sfx","safe_click")},onCompleted:r?()=>{this.answer.push(e),this.books[e].strength=$i,this.books[e].glow.color=L(_.Success),this.answer.length===Wi.length&&this.close(!0)}:()=>{this.answer=[],this.books.forEach(a=>{a.glow.color=L(_.Tan),a.strength=0})}},void 0,"player_portrait")}update(e,s){super.update(e,s),this.updateBooks(e,s)}updateBooks(e,s){if(this.message.visible)return;const r=.001,n=.015;for(let a=0;a<this.books.length;a++){const o=this.books[a],l=o.strength-o.glow.outerStrength;if(Math.abs(l)>r){let h=n*s*Math.sign(l);o.glow.outerStrength=Math.abs(h)>Math.abs(l)?o.strength:o.glow.outerStrength+h,o.glow.outerStrength=Phaser.Math.Clamp(o.glow.outerStrength,0,$i)}}}handleSuccess(e){e&&this.player.inventory.useItem(I.Note)}close(e){if(this.books.forEach(r=>{r.strength=0,r.image.destroy()}),this.debug.forEach(r=>r.destroy()),this.bookshelf.setTint(L(_.White)),this.door.setTint(L(_.White)),!e){super.close(!1);return}const s=400;this.add.timeline([{at:s+0,run:()=>{this.sound.playAudioSprite("sfx","safe_open")}},{at:s+250,run:()=>this.door.setFrame("Door-1")},{at:s+500,run:()=>this.door.setFrame("Door-2")},{at:s+1400,run:()=>this.message.setDialog({messages:["It looks like there is a secret room behind the bookshelf!"],onCompleted:()=>super.close(!0)},void 0,"player_portrait")}]).play()}}const Gi=6,df=200;class gh extends E.GameObjects.Container{constructor(e,s,r,n,a,o){var l,h;super(e,s,r);d(this,"textObject");d(this,"maskGraphics");d(this,"scrollbar");d(this,"scrollTimer");d(this,"scrollY");d(this,"boxHeight");e.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new E.GameObjects.Text(e,0,0,n,{...ue,padding:{x:10,y:10},...a}),this.textObject.setOrigin(0).setScrollFactor(0),this.textObject.setInteractive({cursor:o?"pointer":"ns-resize"}),this.add(this.textObject),e.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),this.textObject.on("pointerdown",(u,c,p)=>{o&&(clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout(()=>{const g=this.textObject.getWrappedText().length,v=p/this.textObject.height,y=Math.floor(v*g);o(y)},df))}),(l=e.input.keyboard)==null||l.on("keydown-UP",()=>{this.scrollY-=30,this.updateTextPosition()}),(h=e.input.keyboard)==null||h.on("keydown-DOWN",()=>{this.scrollY+=30,this.updateTextPosition()}),this.maskGraphics=e.add.graphics().setPosition(s,r).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=e.add.rectangle(0,0,(a==null?void 0:a.scrollbarWidth)||Gi,0,(a==null?void 0:a.scrollbarColor)||L(_.Night)).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(e,s){this.boxHeight=s,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,e,s);const r=this.maskGraphics.createGeometryMask();return this.textObject.setMask(r),this.textObject.setWordWrapWidth(e-Gi*2),this.textObject.setFixedSize(e-Gi*2,0),this.updateTextPosition(),this}setText(e){return this.textObject.setText(e),this.updateTextPosition(),this}handleDrag(e){e.isDown&&(clearTimeout(this.scrollTimer),this.scrollY-=e.velocity.y/2,this.updateTextPosition())}handleScroll(e,s,r,n,a){this.scrollY+=n*.5,this.updateTextPosition()}updateTextPosition(){const e=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=E.Math.Clamp(this.scrollY,0,e),this.textObject.y=-this.scrollY;const s=this.scrollY/e,r=this.boxHeight/this.textObject.height;this.scrollbar.height=r*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+Gi,s*(this.boxHeight-r*this.boxHeight))}}const fi=250,sl="chrono-sleuth-debug-tab",bi=[];Ld.sort().forEach(t=>{const e=28-t.length,s=Math.floor(e/2),r="-".repeat(s-1);let n=`${r} ${t} ${r}`;n=n.padEnd(28,"-"),bi.push({label:n});const a=ih.filter(o=>Fe[o].location===t).sort((o,l)=>R[o].localeCompare(R[l])).map(o=>({label:Fe[o].name||bn(R[o]),warp:o}));bi.push(...a),bi.push({label:""})});class ff extends ot{constructor(){super({key:"DebugTool",title:"Debug Tool",gamepadVisible:!1,hideCloseSuccess:!0});d(this,"player");d(this,"tabs",[]);d(this,"tab",0);d(this,"mainContainer");d(this,"textBox");d(this,"helperText");d(this,"stateContainer");d(this,"saveContainer");d(this,"miscContainer");d(this,"preSave");d(this,"testVoice",{octave:3.5,speed:1,volume:1,type:"sine"});const e=localStorage.getItem(sl);e&&(this.tab=Number(e))}init(e){this.player=e.player;const s=ei(this.player.scene);s.settings.time=0,this.preSave=JSON.stringify(s)}create(){var h;super.create(),this.mainContainer=this.add.container(-f.width/2,-f.height/2),this.container.add(this.mainContainer),this.mainContainer.add(this.add.rectangle(fi+50,100,f.width*.65,f.height*.75,L("#112233")).setOrigin(0));const e=this.makeTab("Items",0),s=this.makeTab("Journal",1),r=this.makeTab("Quests",2),n=this.makeTab("State",3),a=this.makeTab("Warp",4),o=this.makeTab("Saves",5),l=this.makeTab("Misc",6);this.textBox=new gh(this,fi+50,100,"",{fontSize:32},u=>this.handleLineClick(u)).setBoxSize(f.width*.42,f.height*.75),this.mainContainer.add(this.textBox),this.helperText=this.add.text(f.zoomed?f.width*.94:f.width*.87,110,"",{...ue,fontSize:24}).setOrigin(1,0).setDepth(1),this.mainContainer.add(this.helperText),this.tabs=[e,s,r,n,a,o,l],this.container.add(this.tabs),this.createStateContainer(),this.createSaveContainer(),this.createMiscContainer(),this.updateTabs(),(h=this.input.keyboard)==null||h.on("keydown-CLOSED_BRACKET",()=>{this.close()})}createStateContainer(){this.stateContainer=this.add.container(fi+60,100),this.mainContainer.add(this.stateContainer);const e=this.player.gameState.data;Object.entries(e).forEach((s,r)=>{const[n,a]=s,o=this.add.text(0,20+40*r,`${n}: ${a}`,{...ue,fontSize:32}).setOrigin(0);switch(this.stateContainer.add(o),typeof a){case"boolean":o.setText(`${a?"[x]":"[ ]"} ${n}`),o.setInteractive().on("pointerdown",()=>{e[n]=!e[n],o.setText(`${e[n]?"[x]":"[ ]"} ${n}`)});break;case"number":const l=this.smallButton(o.width+20,22+40*r,"-",()=>{e[n]--,o.setText(`${n}: ${e[n]}`)}),h=this.smallButton(o.width+55,22+40*r,"+",()=>{e[n]++,o.setText(`${n}: ${e[n]}`)});this.stateContainer.add([l,h]);break}})}smallButton(e,s,r,n){return new ft(this,e,s,r,n,{fontSize:36,backgroundColor:"#111",padding:{x:6,y:-4}},null)}createSaveContainer(){this.saveContainer=this.add.container(fi+60,100),this.mainContainer.add(this.saveContainer),Object.entries(ti).forEach((s,r)=>{const[n,a]=s,o=new ft(this,0,10+60*r,mt[Number(n)],()=>{Number(n)===mt.New?(localStorage.removeItem(tt),window.location.reload()):(rt(this.player.scene,a),this.player.x+=.1,this.close(!0))},{backgroundColor:"#111"});this.saveContainer.add(o)});const e=new ft(this,350,10,"Dump Save",()=>{const s=ei(this.player.scene),r=Vu(s);navigator.clipboard.writeText(r).catch(n=>console.error(n)),console.warn("save copied to clipboard!"),console.log(r)},{backgroundColor:"#111"});this.saveContainer.add(e)}createMiscContainer(){this.miscContainer=this.add.container(fi+60,100),this.mainContainer.add(this.miscContainer);let e=-50;const s=new ft(this,350,e+=60,"Debug Mode",()=>{f.debug=!f.debug,this.close()},{backgroundColor:"#111"});this.miscContainer.add(s);const r=new ft(this,350,e+=60,"Clear Cache",async()=>{const o=await caches.keys();for(const l of o)await caches.delete(l);window.location.reload()},{backgroundColor:"#111"});this.miscContainer.add(r);const n=new ft(this,350,e+=60,"Toggle Lights",()=>this.player.gameState.updateData({night:!this.player.gameState.data.night}),{backgroundColor:"#111"});this.miscContainer.add(n);const a=new ft(this,350,e+=60,"Toggle Local Prod",()=>{const o="chrono-sleuth-prod";localStorage.getItem(o)?localStorage.removeItem(o):localStorage.setItem(o,"true"),window.location.reload()},{backgroundColor:"#111"});this.miscContainer.add(a)}makeTab(e,s){return new ft(this,-this.container.x+40,-this.container.y+100+60*s,e,()=>{this.tab=s,localStorage.setItem(sl,String(s)),this.updateTabs()})}rangeInput(e,s,r,n,a){const o=this.add.text(e,s,`${a}: ${r().toFixed(1)}`,{...ue}),l=this.smallButton(e+130,s,"-",()=>{n(r()-.1),o.text=`${a}: ${r().toFixed(1)}`}),h=this.smallButton(e+170,s,"+",()=>{n(r()+.1),o.text=`${a}: ${r().toFixed(1)}`});return[o,l,h]}handleLineClick(e){var s,r;switch(this.tab){case 0:const n=Qo[e],a=this.player.inventory.inventory,o=a.find(v=>v.type===n);o?o.used?a.splice(a.indexOf(o),1):o.used=!o.used:this.player.inventory.addItem({type:n,used:!1},!0);break;case 1:const l=Jo[e],h=this.player.journal.journal;vt(this.player,l)?h.splice(h.indexOf(l),1):this.player.journal.addEntry(l,!0);break;case 2:const u=Zo[e],c=this.player.quests.quests,p=c.find(v=>v.id===u);p?p.completed?c.splice(c.indexOf(p),1):p.completed=!p.completed:this.player.quests.addQuest({id:u,completed:!1},!0);break;case 4:const g=bi[e];g.warp&&(as(R.Town,Fe[g.warp].warpTo,this.player,void 0,!0),this.close());break;case 6:if(e>1){const v=el[e-2];v==="MainMenu"?(this.scene.sendToBack("Game"),this.scene.start(v)):(this.scene.stop(this),this.scene.resume("Game"),(r=(s=this.scene.get("Game"))==null?void 0:s.gamepad)==null||r.setAlpha(1),ze(this.player.scene,v))}break}this.updateTabs()}updateTabs(){var n,a,o;this.tabs.forEach((l,h)=>{l.setBackgroundColor(h===this.tab?"#123":"#151515")});const e=this.tab===0||this.tab===1||this.tab===2||this.tab===4||this.tab===6,s=this.tab===0||this.tab===2;(n=this.stateContainer)==null||n.setVisible(this.tab===3),(a=this.saveContainer)==null||a.setVisible(this.tab===5),(o=this.miscContainer)==null||o.setVisible(this.tab===6),this.textBox.setVisible(e),this.helperText.setVisible(s);let r="";switch(this.tab){case 0:r=Qo.map(l=>`[${rh(this.player,l)?"-":vi(this.player,l)?"x":" "}] ${I[l]}`).join(`
`),this.helperText.setText(`[-] item held
[x] item used`);break;case 1:r=Jo.map(l=>`[${vt(this.player,l)?"x":" "}] ${D[l]}`).join(`
`);break;case 2:r=Zo.map(l=>`[${fs(this.player,l)?"-":nh(this.player,l)?"x":" "}] ${B[l]}`).join(`
`),this.helperText.setText(`[-] quest active
[x] quest complete`);break;case 4:r=bi.map(l=>l.label).join(`
`);break;case 6:r=["Scenes","-----------------",...el].join(`
`);break}this.textBox.setText(r)}handleSuccess(e){const s=ei(this.player.scene);s.settings.time=0,this.preSave!==JSON.stringify(s)&&(e||rt(this.player.scene),this.player.scene.scene.restart())}}class pf extends ot{constructor(){super({key:"JournalDialog",title:"Journal",gamepadVisible:!1,hideCloseSuccess:!0,skipUI:!0});d(this,"player")}init(e){this.player=e.player}create(){var r;super.create(),this.container.add(this.add.image(0,0,"props","paper").setScale(2.9,3.3)),this.container.add(new et(this,f.width*.44,f.height*-.36,"X",()=>this.close(!1),{...an,backgroundColor:void 0,fontSize:54})),this.player.journal.unread.setVisible(!1);const e=this.player.journal.journal.map(n=>`${mn[n].description}
`).reverse(),s=new gh(this,f.width*.08,f.height*.2,e,{...an,scrollbarColor:L(_.Brown)});s.setBoxSize(f.width*.84,f.height*.62),this.addTarget(s),this.fadeIn(),(r=this.input.keyboard)==null||r.on("keydown-J",()=>{this.close()}),this.sound.playAudioSprite("sfx","book_open")}preHandleSuccess(){this.sound.playAudioSprite("sfx","book_close")}handleSuccess(){}}const At=20,qe=5,gf=5,Ve=20,zi=70,jt=150,rl=15,nl=15,yf=45,ji=50;class mf extends ot{constructor(){super({key:"LockpickDialog",title:"Pick the lock to open the sewer",helpText:`Use [Left]/[Right]
to select a lock pin

[UP]/[CONTINUE] to pick`,gamepadVisible:!1});d(this,"player");d(this,"order",[]);d(this,"answer",[]);d(this,"offsets",[]);d(this,"target",[]);d(this,"current",[]);d(this,"pins",[]);d(this,"active",!0);d(this,"lockpick");d(this,"closest",0);d(this,"nextUpdate",0)}init(e){this.player=e.player}create(){super.create(),this.order=[],this.answer=[],this.offsets=[],this.target=[],this.current=[],this.pins=[],this.active=!0,this.helpText.setPosition(-this.helpText.x,this.helpText.y+15).setOrigin(1,0),this.helpText.setStyle({...ue,align:"right"}),this.container.add(this.add.rectangle(0,0,zi*(qe+.5),jt*2,4803146)),this.container.add(this.add.rectangle(0,77,zi*(qe+.5),90,3750458)),this.container.add(this.add.rectangle(0,117,zi*(qe+.5),40,2697770));for(let e=0;e<qe;e++)this.order.push(e),this.offsets.push(E.Math.Between(nl,yf)),this.current.push(0),this.target.push(ji);this.order=this.order.sort(()=>Math.random()-.5);for(let e=0;e<qe;e++){const s=-175+e*zi+Ve*1.5,r=48,n=new E.Geom.Rectangle(-48/2,-150,Ve+r,jt*2.5);this.container.add(this.add.rectangle(s+Ve/2,0,Ve+r/3,jt*1.5,2697770));const a=this.add.graphics({x:s});this.container.add(a),f.prod||this.container.add(this.add.text(s+8,jt+20,(this.order.indexOf(e)+1).toString(),{...ue,fontSize:16})),a.setInteractive({draggable:!0,hitArea:n,hitAreaCallback:E.Geom.Rectangle.Contains}),a.on("pointerdown",()=>this.handlePinClick(e)),a.on("pointermove",()=>{this.active&&(this.closest=e)}),this.pins.push(a)}this.lockpick=this.add.graphics(),this.container.add(this.lockpick),this.lockpick.lineStyle(6,10046074),this.lockpick.lineBetween(-200,At+105,200,At+105),this.lockpick.lineBetween(200,At+105,225,At+95),this.lockpick.lineBetween(225,At+95,225,At+85),this.updateLayout(1)}updateLayout(e){let s=!1;for(let n=0;n<qe;n++)Math.abs(this.current[n]-this.target[n])>=1&&(s=!0,this.current[n]<this.target[n]?this.current[n]=Math.min(this.target[n],this.current[n]+.5*e):this.current[n]=Math.max(this.target[n],this.current[n]-.5*e));const r=this.pins[this.closest].x+Ve/2-225;if(Math.abs(this.lockpick.x-r)>=1&&(this.lockpick.x<r?this.lockpick.x=Math.min(r,this.lockpick.x+e):this.lockpick.x=Math.max(r,this.lockpick.x-e)),s)for(let n=0;n<qe;n++)this.updatePin(n)}updatePin(e){const s=this.pins[e];s.clear();const r=this.current[e],n=this.offsets[e],a=0,o=At+nl,l=o-n-20-gf+r,h=o-n+r,u=o+r;s.fillStyle(11173696),s.fillRect(a,h,Ve,n),s.fillTriangle(a,u,a+Ve,u,a+Ve/2,u+7);const c=o-jt+rl,g=l+8-c,v=Math.floor((jt-n-20)/rl),y=g/v;s.lineStyle(3,6908522);for(let m=0;m<v;m++)s.lineBetween(a,c+(m+1)*y,a+Ve,c+m*y),s.lineBetween(a,c+m*y,a+Ve,c+m*y);s.fillStyle(10066586),s.fillRect(a,l,Ve,20)}handlePinClick(e){if(!this.active)return;this.active=!1;let s=!0;this.tweens.add({targets:this.lockpick,angle:-1,y:-14,duration:100,yoyo:!0,onYoyo:()=>{if(s){if(this.order[this.answer.length]===e)this.target[e]===ji?this.target[e]=this.offsets[e]:this.target[e]=ji,this.answer.push(e),this.sound.playAudioSprite("sfx","button");else{this.sound.playAudioSprite("sfx",this.answer.length===0?"button":"safe_click");for(let r=0;r<qe;r++)this.target[r]=ji;this.answer=[]}this.checkPins()}s=!1},onComplete:()=>{this.lockpick.setAngle(0),this.lockpick.y=0,this.active=!0}})}checkPins(){let e=!0;for(let s=0;s<qe;s++)if(this.target[s]!==this.offsets[s]){e=!1;break}e&&this.close(!0)}handleKeys(e){if(e<this.nextUpdate)return;const{keys:s}=this.keys;let r=!1;s[C.Left]&&(this.closest=Math.max(0,this.closest-1),r=!0),s[C.Right]&&(this.closest=Math.min(qe-1,this.closest+1),r=!0),(s[C.Continue]||s[C.Up])&&(this.handlePinClick(this.closest),r=!0),r&&(this.nextUpdate=e+200)}close(e){if(this.active=!1,e){for(let s=0;s<qe;s++)this.target[s]=this.offsets[s];this.sound.playAudioSprite("sfx","unlock"),this.time.delayedCall(1e3,()=>super.close(!0))}else super.close(!1)}handleSuccess(e){ze(this.player.scene,"LockpickDialog")}update(e,s){super.update(e,s),this.handleKeys(e),this.updateLayout(s)}}function al(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),e.push.apply(e,s)}return e}function ol(t){for(var i=1;i<arguments.length;i++){var e=arguments[i]!=null?arguments[i]:{};i%2?al(Object(e),!0).forEach(function(s){vf(t,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):al(Object(e)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s))})}return t}function vf(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function yh(t){return t.slice(0,-1)}function mh(t,i=0){return i?Array.from(Array(i-t).keys()).map(e=>e+t):Array.from(Array(t).keys())}function vh(t){return[...new Set(t)]}function ll(t,i){const e=vh(t.map(a=>a.set)).filter(Boolean),s=(r=mh(1,t.length+1),n=e,[r,n].reduce((a,o)=>a.filter(l=>!o.includes(l)))).sort(()=>.5-i());var r,n;t.filter(a=>!a.set).forEach((a,o)=>a.set=s[o])}function hl(t,i,e=.5){yh(t).forEach((s,r)=>{const n=t[r+1],a=s.set!==n.set,o=i()<=e;a&&o&&(function(l,h,u){l.forEach(c=>{c.set===h&&(c.set=u)})}(t,n.set,s.set),s.right=!1,n.left=!1)})}function bf(t=8,i=t,e=!0,s=1){const r=function(h){return function(){let u=h+=1831565813;return u=Math.imul(u^u>>>15,1|u),u^=u+Math.imul(u^u>>>7,61|u),((u^u>>>14)>>>0)/4294967296}}(s),n=[],a=mh(t);for(let h=0;h<i;h+=1){const u=a.map(c=>({x:c,y:h,top:e||h>0,left:e||c>0,bottom:e||h<i-1,right:e||c<t-1}));n.push(u)}yh(n).forEach((h,u)=>{ll(h,r),hl(h,r),function(c,p,g){const v=Object.values(function(m,w){let k=vh(m.map(x=>x.set)).reduce((x,T)=>ol(ol({},x),{},{[T]:[]}),{});return m.forEach(x=>k[x.set].push(x)),k}(c)),{ceil:y}=Math;v.forEach(m=>{(function(w,k,x){k=k??1;const T=w==null?0:w.length;if(!T||k<1)return[];k=k>T?T:k;let A=-1;const F=T-1,K=[...w];for(;++A<k;){const N=A+Math.floor(x()*(F-A+1)),M=K[N];K[N]=K[A],K[A]=M}return K.slice(0,k)})(m,y(g()*m.length),g).forEach(w=>{if(w){const k=p[w.x];w.bottom=!1,k.top=!1,k.set=w.set}})})}(h,n[u+1],r)});const o=(l=n)[l.length-1];var l;return ll(o,r),hl(o,r,1),n}const Ht=24,Ge=16,cl=140;class wf extends E.Scene{constructor(){super("Maze");d(this,"parent");d(this,"keys");d(this,"maze");d(this,"mazePlayer");d(this,"playerPosition",new E.Math.Vector2(0,0));d(this,"nextUpdate");d(this,"walking");d(this,"audioThrottle",0)}init(e){this.parent=e.parent}preload(){this.load.setPath("assets"),this.load.image("maze_player","puzzles/maze/maze_player.png"),this.load.image("maze_tiles","puzzles/maze/maze_tiles.png")}create(){this.createMaze(),this.playerPosition.set(0,0),this.mazePlayer=this.add.image(this.playerPosition.x,this.playerPosition.y,"maze_player").setDisplaySize(Ge/2,Ge/2).setOrigin(-.5);const e=this.cameras.main;e.startFollow(this.mazePlayer),e.setZoom(5),e.setViewport(50,130,f.width-100,f.height-170),this.keys=this.parent.keys,this.parent.addTarget(this.mazePlayer),f.prod||this.input.on("wheel",(r,n,a,o,l)=>{e.zoom=Math.max(.01,e.zoom+o*5e-4)}),this.walking=this.sound.addAudioSprite("sfx");const s=this.walking.markers.ladder;this.walking.addMarker({name:"step",start:s.start,duration:.3})}getMazeSeed(){return this.parent.player.gameState.data.mazeSeed||0}createMaze(){var c,p,g,v;const e=this.getMazeSeed();this.maze=bf(Ht,Ht,!0,e);const s=this.maze,r=s.length,n=s[0].length,a=Array.from({length:2*r+1},()=>Array(2*n+1).fill(1));for(let y=0;y<r;y++)for(let m=0;m<n;m++)a[2*y+1][2*m+1]=0,s[y][m].top||(a[2*y][2*m+1]=0),s[y][m].bottom||(a[2*y+2][2*m+1]=0),s[y][m].left||(a[2*y+1][2*m]=0),s[y][m].right||(a[2*y+1][2*m+2]=0);a[0][0]=0,a[1][0]=0,a[0][1]=0,a[2*r][2*n]=0,a[2*r-1][2*n]=0,a[2*r][2*n-1]=0;const o=a.length,l=this.make.tilemap({tileWidth:Ge,tileHeight:Ge,width:o,height:o}),h=l.addTilesetImage("maze_tiles"),u=l.createBlankLayer("layer",h);u.setScale(.5),this.parent.addTarget(u);for(let y=0;y<o-1;y++)for(let m=0;m<o-1;m++){const w=(c=a[y])==null?void 0:c[m],k=(p=a[y])==null?void 0:p[m+1],x=(g=a[y+1])==null?void 0:g[m],A=((v=a[y+1])==null?void 0:v[m+1])+x*2+k*4+w*8;u.putTileAt(A,m,y)}}update(e,s){if(e<this.nextUpdate)return;const r=this.keys.keys,n=new E.Math.Vector2(0,0);r[C.Left]?n.x=-16:r[C.Right]?n.x=Ge:r[C.Up]?n.y=-16:r[C.Down]&&(n.y=Ge);const a=new E.Math.Vector2(this.playerPosition.x+n.x,this.playerPosition.y+n.y),o=new E.Math.Vector2((Ht-1)*Ge,(Ht-1)*Ge);(this.playerPosition.x!==a.x||this.playerPosition.y!==a.y)&&this.canMove(a)&&(Date.now()>this.audioThrottle&&(this.walking.play("step",{volume:.5}),this.audioThrottle=Date.now()+350),this.mazePlayer.setPosition(this.playerPosition.x,this.playerPosition.y),this.playerPosition.set(a.x,a.y),this.tweens.killTweensOf(this.mazePlayer),this.tweens.add({targets:this.mazePlayer,x:a.x,y:a.y,duration:cl}),this.parent.setAngle(E.Math.Angle.BetweenPoints(a,o))),this.playerPosition.x===o.x&&this.playerPosition.y===o.y&&this.parent.close(!0),this.nextUpdate=e+cl}canMove(e){const s=e.x,r=e.y,n=Math.floor(s/Ge),a=Math.floor(r/Ge);if(n<0||a<0||n>=Ht||a>=Ht)return!1;const o=Math.floor(this.playerPosition.x/Ge),l=Math.floor(this.playerPosition.y/Ge),h=this.maze[l][o];return!(!h||h.top&&r<this.playerPosition.y||h.bottom&&r>this.playerPosition.y||h.left&&s<this.playerPosition.x||h.right&&s>this.playerPosition.x)}}class Sf extends ot{constructor(){super({key:"MazeDialog",title:"Find your way through the forest",childScene:"Maze",gamepadVisible:!0});d(this,"player");d(this,"arrow")}init(e){var s,r;this.player=e.player,this.dialogData.gamepadVisible=(r=(s=e.player.scene)==null?void 0:s.gamepad)==null?void 0:r.visible}create(){super.create(),this.arrow=this.add.image(-f.width*.4,-f.height*.4,"icons","arrow-up").setScale(.5).setRotation(Math.PI*.75),this.container.add(this.arrow)}setAngle(e){this.arrow.setRotation(e+Math.PI/2)}handleSuccess(e){e&&Je(this.player.scene,500,()=>{as(R.TownEast,R.Forest,this.player),this.player.gameState.updateData({mazeSolved:!0,mazeSeed:this.player.gameState.data.mazeSeed+1},!1)})}}const xf=6,tn=12;class kf extends ot{constructor(){super({key:"MemoryDialog",title:"Figure out the secret code",gamepadVisible:!1});d(this,"sequence");d(this,"pressed");d(this,"buttons");d(this,"player")}init(e){this.player=e.player}preload(){this.load.setPath("assets"),this.load.atlas("runes","atlases/runes.png","atlases/runes.json")}create(){for(super.create(),this.sequence=[],this.pressed=[];this.sequence.length<xf;){const a=E.Math.RND.between(0,tn-1);this.sequence.includes(a)||this.sequence.push(a)}f.prod||this.container.add(this.add.text(0,f.height*.43,`[ ${this.sequence.map(a=>a+1).join(", ")} ]`,{fontSize:24,align:"center"}).setOrigin(.5)),this.buttons=new _n(this),this.container.add(this.buttons);const s=f.width/13*1.2,r=[];for(let a=0;a<tn;a++){const o=-s+a%3*s,l=-s*1.2+Math.floor(a/3)*s,h=Math.floor(a/3);r[h]===void 0&&r.push([]),r[h].push({x:o,y:l,width:s,height:s});const u=this.add.image(o,l,"runes",`Stone${a+1}`).setInteractive({useHandCursor:!0});u.on("pointerdown",()=>this.onButtonPress(u,a)),this.buttons.add(u)}const n=new gs(this,{regions:r,onSelect:a=>{const o=a.y*3+a.x,l=this.buttons.getAt(o);this.onButtonPress(l,o)}},this.keys);this.container.add(n)}onButtonPress(e,s){const r=this.pressed.length;if(this.sequence[r]===s){this.sound.playAudioSprite("sfx","safe_click",{volume:.75}),this.pressed.push(s),e.disableInteractive();const n=new E.Display.Color(255,255,255),a=gt(L(_.Success));Xt(this,n,a,o=>e.setTint(o),{duration:250,onComplete:()=>{const o=gt(L(_.Success)),l=gt(3355443);Xt(this,o,l,h=>e.setTint(h),{duration:250,onComplete:()=>{this.sequence.length===this.pressed.length&&this.close(!0)}})}})}else{this.sound.playAudioSprite("sfx","memory_wrong",{volume:.75}),e.disableInteractive();const n=new E.Display.Color(255,255,255),a=gt(L(_.Warning));Xt(this,n,a,o=>e.setTint(o),{duration:250,yoyo:!0,onComplete:()=>{this.buttons.each(o=>{o.setInteractive(),o.setTint(16777215)})}}),this.pressed=[]}}close(e){e?this.completed(()=>super.close(e)):super.close()}completed(e){this.time.delayedCall(300,()=>{this.sound.playAudioSprite("sfx","unlock",{volume:.75}),this.buttons.getAll().forEach((s,r)=>{const n=r===tn-1,a=s.tint,o=gt(a),l=gt(L(_.Success));s.disableInteractive(),s.setTint(a),Xt(this,o,l,h=>s.setTint(h),{duration:200,delay:r*70,hold:500,onComplete:n?e:void 0})})})}handleSuccess(e){e&&td(this.player)}}class Ef extends E.Scene{constructor(){super("Paused");d(this,"parent");d(this,"debugCount");d(this,"container");d(this,"preSave")}init(e){this.parent=e.game;const s=ei(this.parent.player.scene);s.settings.time=0,this.preSave=JSON.stringify(s)}create(){var v;const{width:e,height:s}=f;me.setScene(this),me.fadeMusic(.15),this.container=this.add.container(0,0),this.container.add(this.add.rectangle(e/2,s/2,e,s,0,.75).setInteractive().on("pointerdown",()=>this.resume())),this.container.add(this.add.text(e/2,f.height/2-100,"Game Paused",{...ue,fontSize:72}).setOrigin(.5)),this.debugCount=0,this.container.add(this.add.text(e-20,s-20,`Build Time: ${new Date("2025-04-05T07:56:28.362Z").toLocaleString()}
${f.prod?"":"Debug Mode"}`,{...ue,fontSize:16,align:"right",padding:{x:20,y:20}}).setOrigin(1,1).setInteractive({useHandCursor:!1}).on("pointerdown",()=>{this.debugCount++,this.debugCount>10&&(localStorage.setItem("chrono-sleuth-prod",f.prod?"false":"true"),window.location.reload())}));const n=!f.zoomed?48:36,a=new ph(this);this.container.add(a);const o=new Qe(this,f.width-210,30,"tv",()=>{An()}),l=new Qe(this,f.width-150,30,"gamepad",()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}),h=new Qe(this,f.width-90,30,this.parent.sound.mute?"volume-mute":"volume",()=>{const y=this.parent.sound.mute;this.parent.sound.mute=!y,h.setIcon(y?"volume":"volume-mute")}),u=new dh(this,f.width-30,30),c=new et(this,e/2,f.height/2,"Resume",()=>this.resume(),{fontSize:n});let p;f.prod||(p=new Qe(this,80,30,"terminal",()=>{this.resume(),this.parent.time.delayedCall(200,()=>{ze(this.parent,"DebugTool")})})),a.setButtons([[p,o,l,h,u],[void 0,c,void 0,void 0,void 0],[void 0,void 0,void 0,void 0,void 0]]),a.activeIndex.set(1,1),(v=this.input.keyboard)==null||v.on("keydown-ESC",()=>this.resume()),new ns(this),new cs(this,!0).setVisible(!1),this.tweens.add({targets:this.container,alpha:{start:0,to:1},duration:250})}resume(){me.fadeMusic(me.volume,500,()=>me.setScene(this.parent)),this.tweens.add({targets:this.container,alpha:{start:1,to:0},duration:250,onComplete:()=>{this.scene.stop(),this.scene.resume("Game")}}),this.parent.time.delayedCall(300,()=>{const e=ei(this.parent);e.settings.time=0,this.preSave!==JSON.stringify(e)&&rt(this.parent)})}}const pi=16,Hi=8;class Of extends E.Scene{constructor(){super("Pipes");d(this,"parent");d(this,"keys");d(this,"pipes",[]);d(this,"totalPipes",0);d(this,"images",[]);d(this,"container");d(this,"blockSize");d(this,"pipeSize");d(this,"initialized",!1);d(this,"enabled",!0)}init(e){this.parent=e.parent,this.blockSize=f.zoomed?13:17,this.pipeSize=this.blockSize*3.75,this.enabled=!0}preload(){this.prerenderPipes()}prerenderPipes(){for(const e of Fd){const s=th[e],r=`pipe_${e}`;this.textures.exists(r)&&this.textures.remove(r);const n=this.textures.createCanvas(r,this.blockSize*3,this.blockSize*3);if(n){const a=n.context;a.fillStyle="#ffffff";for(let o=0;o<s.length;o++)for(let l=0;l<s[o].length;l++)s[o][l]===1&&a.fillRect(l*this.blockSize,o*this.blockSize,this.blockSize,this.blockSize);n.refresh()}}}create(){this.keys=this.parent.keys,this.container=this.add.container(),this.createPipes();const e=[];for(let r=0;r<Hi-2;r++){e.push([]);for(let n=0;n<pi-2;n++)e[r].push({x:(n+1)*this.pipeSize,y:(r+1)*this.pipeSize,width:this.pipeSize,height:this.pipeSize})}const s=new gs(this,{regions:e,onSelect:r=>this.rotatePipe(r.x+1,r.y+1)},this.keys);this.container.add(s)}createPipes(){this.pipes=[],this.container=this.add.container().setPosition(f.width/2-pi*this.pipeSize/2+this.pipeSize/2,f.height/4),this.totalPipes=0;const e=5;for(let s=0;s<Hi;s++){this.pipes[s]||(this.pipes[s]=[]);for(let r=0;r<pi;r++){let n=Jr[s][r];const a=r===0||s===0||r===pi-1||s===Hi-1,o=r===pi-1&&s===Hi-1,l=!a;this.pipes[s][r]={x:r,y:s,type:n,rotation:a?0:E.Math.Between(0,3)*90,interactive:l},n!==Fn.Empty&&this.totalPipes++;const h=r+s*Jr[0].length;this.time.delayedCall(50+h*e,()=>{const u=`pipe_${n}`,c=this.add.image(r*this.pipeSize,s*this.pipeSize,u).on("pointerdown",()=>this.rotatePipe(r,s));c.setAlpha(0).setScale(.5).setAngle(this.pipes[s][r].rotation),this.tweens.add({targets:c,alpha:1,scale:1,duration:300,onComplete:o?()=>{this.initialized=!0,this.updatePipes()}:void 0}),l?c.setInteractive():c.setTint(6710886),this.container.add(c),this.images.push(c)})}}this.parent.addTarget(this.container)}rotatePipe(e,s){this.pipes[s][e].interactive&&this.initialized&&this.enabled&&(this.pipes[s][e].rotation=(this.pipes[s][e].rotation+90)%360,Math.random()>.35&&this.sound.playAudioSprite("sfx","pipes_squeak",{volume:.25,detune:E.Math.Between(-500,500)}),this.updatePipes())}updatePipes(){const e=Ad(this.pipes,Yo.x,Yo.y);this.pipes.forEach(s=>{s.forEach(r=>{this.images[r.x+r.y*Jr[0].length].setAngle(r.rotation)})}),e.length===this.totalPipes&&this.parent.close(!0)}completed(e){this.enabled=!1;const s=this.images.length,r=new E.Display.Color(255,255,255),n=gt(L(_.Teal));this.sound.playAudioSprite("sfx","pipes_complete",{volume:1.2});for(let a=0;a<s;a++){const o=this.images[a],l=a===s-1;Xt(this,r,n,h=>o.setTint(h),{duration:500,delay:a*10,hold:1e3,onComplete:l?()=>{e&&e(),this.tweens.add({targets:this.container.list,alpha:0,duration:100})}:void 0})}}}class If extends ot{constructor(){super({key:"PipesDialog",title:"Attach all of the pipes to fix the alchemy set",helpText:`Use [Left]/[Right]/[UP]/[DOWN]
to select a pipe

[CONTINUE]/[CLICK] to rotate`,gamepadVisible:!1,childScene:"Pipes"});d(this,"player")}init(e){this.player=e.player}create(){super.create(),this.title.setFontSize(36).setAlign("center").setY(this.title.y+10)}close(e){const s=this.scene.get("Pipes");e&&s?s.completed(()=>super.close(e)):super.close(e)}handleSuccess(e){e&&this.player.message.setDialog({messages:["There. It looks like the alchemy set has been properly fit back together."],onCompleted:s=>{s.journal.addEntry(D.AlchemySetFixed)}},xi(this.player.scene,z.AlchemySet),"player_portrait")}}const _e=3,Ut=f.height/(f.zoomed?4:5.5),Tf=30,Ui=_e*_e-1;class Pf extends ot{constructor(){super({key:"SliderDialog",title:"Arrange the tiles to be in order.",gamepadVisible:!1});d(this,"solution",[]);d(this,"layout",[]);d(this,"tiles",[])}preload(){this.load.setPath("assets");const e=Math.floor(512/_e);this.load.spritesheet("slider","puzzles/slider.jpg",{frameWidth:e,frameHeight:e})}create(){super.create();const e=[];this.solution=Array.from({length:_e*_e},(r,n)=>n),this.layout=[...this.solution],this.tiles=[];for(let r=this.layout.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[this.layout[r],this.layout[n]]=[this.layout[n],this.layout[r]]}this.layout.forEach((r,n)=>{const a=n%_e,o=Math.floor(n/_e),l=(a-(_e-1)/2)*Ut,h=(o-(_e-1)/2)*Ut+Tf;e[o]===void 0&&(e[o]=[]),e[o].push({x:l,y:h,width:Ut*1.1,height:Ut*1.1});const u=this.add.image(l,h,"slider",n).setOrigin(.5).setDisplaySize(Ut*.95,Ut*.95);this.container.add(u),u.setInteractive({useHandCursor:!0}),u.on("pointerdown",()=>{this.moveTile(n)}),this.tiles.push(u)});const s=new gs(this,{regions:e,onSelect:r=>{const n=r.y*_e+r.x;this.moveTile(n)}},this.keys);this.container.add(s),this.updateLayout()}moveTile(e){const s=this.layout.indexOf(Ui),r=s%_e,n=Math.floor(s/_e),a=e%_e,o=Math.floor(e/_e);Math.abs(r-a)+Math.abs(n-o)===1&&(this.layout[s]=this.layout[e],this.layout[e]=Ui,this.sound.playAudioSprite("sfx","puzzle_slide",{volume:.5}),this.updateLayout()),this.layout.join("")===this.solution.join("")&&this.handleSuccess(!0)}updateLayout(){this.layout.forEach((e,s)=>{this.tiles[s].setFrame(e),this.tiles[s].setVisible(e!=Ui)})}completed(e){for(let s=0;s<this.layout.length+1;s++)this.time.delayedCall(s*150,()=>{s<this.layout.length&&(this.tiles[s].setFrame(s),this.tiles[s].setVisible(s!=Ui)),s>0&&this.tiles[s-1].setTint(6710886)});this.time.delayedCall(2e3,e)}close(e){e?this.completed(()=>super.close(e)):super.close(e)}handleSuccess(e){e&&this.time.delayedCall(750,()=>{this.close(!0)})}}const ul=[[1,0,1,1,0],[0,1,0,0,0],[0,0,1,0,1],[0,0,1,1,0],[1,1,0,0,1]],dl=36,Cf=16,pt=Math.PI*2/Cf;class Af extends ot{constructor(){super({key:"TumblerDialog",title:"Open the lock by aligning all rings",helpText:`Use [Left]/[Right]
to select a ring

Use [Up]/[Down]
to rotate a ring`,gamepadVisible:!1});d(this,"player");d(this,"angles");d(this,"rings");d(this,"line");d(this,"fx");d(this,"active");d(this,"nextUpdate");d(this,"disabled")}init(e){this.player=e.player}preload(){this.load.setPath("assets"),this.load.atlas("rings","atlases/tumbler.png","atlases/tumbler.json")}create(){super.create(),this.angles=[],this.rings=[],this.fx=[],this.active=0,this.nextUpdate=0,this.disabled=!1,this.line=this.add.line(0,30,dl*.75,0,dl*6,0,L(_.Night)).setOrigin(0,0).setLineWidth(5),this.container.add(this.line);for(let e=0;e<ul.length;e++){let s=Math.floor(Math.random()*Math.PI*2);s=E.Math.Snap.To(s,pt),s=e/5*Math.PI*2,this.angles.push(s),this.circle(e)}this.updateMarkers()}circle(e){const s={x:f.width/2,y:f.height/2},r=this.add.image(0,30,"rings",`ring${e+1}`).setScale(.8).setInteractive({draggable:!0,useHandCursor:!0,pixelPerfect:!0}).on("drag",n=>{if(this.active=-1,n.isDown){this.active=e;const a=E.Math.Angle.Between(s.x,s.y,n.x,n.y);this.handleMove(e,a)}}).on("dragstart",n=>{if(this.active=-1,n.isDown){this.active=e;const a=E.Math.Angle.Between(s.x,s.y,n.x,n.y);this.handleMove(e,a)}}).on("dragend",()=>{this.active=-1,this.updateMarkers(!0)});this.fx.push(r.postFX.addGlow(L(_.Night),2,0)),f.debug&&this.input.enableDebug(r),this.container.add(r),this.rings.push(r)}handleMove(e,s,r){var o;if(this.disabled)return;const n=JSON.stringify(this.angles),a=this.angles[e]-s;this.angles[e]=E.Math.Snap.To(s%(Math.PI*2),pt),(o=ul[e])==null||o.forEach((l,h)=>{h!==e&&(this.angles[h]=E.Math.Snap.To((this.angles[h]+l*a)%(Math.PI*2),pt))}),n!==JSON.stringify(this.angles)&&this.sound.playAudioSprite("sfx","safe_click",{detune:E.Math.Between(-500,500)}),this.updateMarkers(r)}updateMarkers(e){let s=!0;this.angles.forEach((r,n)=>{var o;const a=E.Math.Snap.To(r,pt);Math.abs(a-0)<pt*.6||Math.abs(a-Math.PI*2)<pt*.6||(s=!1),(o=this.rings[n])==null||o.setAngle(E.Math.RadToDeg(a))}),s&&e&&this.close(!0)}completed(e){for(let s=0;s<5;s++)this.sound.playAudioSprite("sfx","safe_click",{delay:s*.1+Math.random()*.05,detune:E.Math.Between(-500,500)});this.sound.playAudioSprite("sfx","chest",{delay:.75}),this.tweens.add({targets:this.rings,rotation:0,duration:500,onComplete:()=>{this.angles=[0,0,0,0,0],this.updateMarkers(),this.disabled=!0,this.active=-1,this.tweens.add({targets:[...this.rings,this.line],rotation:Math.PI*2,delay:500,duration:1500,hold:1e3,onComplete:e})}})}update(e,s){var r;if(!(e<this.nextUpdate)){if(this.nextUpdate=e+100,!this.disabled){const n=this.keys.keys;n[C.Left]?(this.nextUpdate=e+300,this.active=E.Math.Clamp(this.active-1,0,this.angles.length-1)):n[C.Right]?(this.nextUpdate=e+300,this.active=E.Math.Clamp(this.active+1,0,this.angles.length-1)):n[C.Up]?this.handleMove(this.active,this.angles[this.active]-pt,!0):n[C.Down]&&this.handleMove(this.active,this.angles[this.active]+pt,!0)}for(let n=0;n<5;n++)(r=this.rings[n])==null||r.setTint(this.active===n?L("C49B7C"):void 0),this.fx[n].color=L(this.active===n?"C49B7C":_.Night)}}close(e){e?this.completed(()=>super.close(e)):super.close(e)}handleSuccess(e){e&&sd(this.player)}}Rh({immediate:!0});const Rf={type:Phaser.WEBGL,width:f.width,height:f.height,parent:"game-container",backgroundColor:L(_.Background),scale:{mode:Phaser.Scale.FIT,autoCenter:f.prod?Phaser.Scale.CENTER_BOTH:Phaser.Scale.CENTER_HORIZONTALLY},loader:{imageLoadType:"HTMLImageElement"},scene:[af,hf,lf,of,sh,Ef,ff,pf,Sf,wf,If,Of,Af,kf,Pf,uf,mf,cf],pipeline:{CRTPipeline:Vl,XRayPipeline:Ju},input:{gamepad:!0},disableContextMenu:f.prod,physics:{default:"arcade"},fps:{panicMax:165,smoothStep:!0},render:{pixelArt:!0,antialias:!1},maxLights:20,dom:{createContainer:!0},plugins:{scene:[{key:"PipelinePlugin",plugin:Ku,mapping:"pipelinePlugin"}]}};Jc();const sn=document.querySelector("#initial-loader");sn==null||sn.remove();const Mf=new E.Game(Rf);(!f.prod||f.debug)&&Hd(Mf);
