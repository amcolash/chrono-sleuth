var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{p as i}from"./phaser-C2_wa_Fb.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();let s=!1,n=!1;n=!0;const{width:r,height:o}={width:1280,height:720};s=!1,n=!1;const a={debug:!1,width:r,height:o,cameraOffset:o/3,zoomed:!1,dayMinutes:.25,rewindEnabled:!1,fastMode:!1};class h extends i.Scene{constructor(){super("Boot")}preload(){}create(){this.scene.start("Preloader")}}const l={White:"fcfee9",Tan:"e6c99d",Peach:"d07151",Brown:"473946",Teal:"303646",Black:"1c1831",Lights:"ffccaa",Night:"335588"};function c(t){return i.Display.Color.HexStringToColor(t).color}function p(t){return c(i.Display.Color.RGBToString(255*t.r,255*t.g,255*t.b))}const d={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${l.White}`};var u=(t=>(t[t.Backgrounds=0]="Backgrounds",t[t.Warpers=1]="Warpers",t[t.Npcs=2]="Npcs",t[t.Items=3]="Items",t[t.Player=4]="Player",t[t.Shader=5]="Shader",t[t.Ui=6]="Ui",t[t.Ui2=7]="Ui2",t[t.Overlay=8]="Overlay",t[t.Debug=9]="Debug",t))(u||{});class y extends i.GameObjects.Container{constructor(t,i,s){super(t,40,a.height-60),e(this,"currentTime",0),e(this,"rewindCount",0),e(this,"player"),e(this,"rewindable"),e(this,"rewinding",!1),e(this,"counter",0),e(this,"bar"),e(this,"hand"),e(this,"timeText"),e(this,"dayOver"),this.setVisible(a.rewindEnabled).setDepth(u.Ui).setScrollFactor(0),this.scene.add.existing(this),this.rewindable=i,this.player=s,this.add(t.add.sprite(0,0,"watch").setScale(.25)),this.hand=t.add.rectangle(0,10,3,14,c(l.Black)).setOrigin(0,0),this.add(this.hand),this.timeText=t.add.text(15,10,"",d).setScrollFactor(0),this.bar=t.add.rectangle(0,a.height-6,0,6,13412864).setScrollFactor(0)}update(t,e){}}class g extends i.GameObjects.GameObject{constructor(t,i,s,n,r,o){super(t,"Light"),e(this,"x"),e(this,"y"),e(this,"light"),e(this,"debug"),t.add.existing(this),this.light=t.lights.addLight(i,s,n,r,o),this.debug=t.add.graphics({x:i,y:s}).setDepth(u.Debug),this.debug.lineStyle(3,65280),this.x=i,this.y=s,a.debug&&this.debug.strokeCircle(0,0,n)}setPosition(t,e){this.debug.setVisible(this.light.visible),this.light.setPosition(t,e),this.debug.setPosition(t,e),this.x=t,this.y=e}destroy(t){var e,i;super.destroy(t),this.debug.destroy(),null==(i=null==(e=this.scene)?void 0:e.lights)||i.removeLight(this.light)}}function f(){return Math.random()-.5}const m=[3200,600],b=[5350,690],w=[500,200,100,50,10];class x extends i.GameObjects.GameObject{constructor(t,s,n,r=40,o=[1400,600]){super(t,"fireflies"),e(this,"scene"),e(this,"center"),e(this,"lights",[]),e(this,"count"),e(this,"centers",[]),e(this,"bounds",[1e3,400]),e(this,"biases",[]),e(this,"debug"),t.add.existing(this),this.scene=t,this.count=r,this.bounds=o,this.center=new i.Math.Vector2(s,n);for(let e=0;e<this.count;e++){const e=new i.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),s=t.lights.addPointLight(0,0,e.color,7*Math.random()+3,.15,.045+.02*f());this.lights.push(s);const n=[];for(let t=0;t<2*w.length;t++)n.push(f()*w[t%w.length]);n.push(10*f()),this.biases.push(n)}a.debug&&(this.debug=t.add.graphics().fillStyle(16711680,.5).lineStyle(2,16711680,1),this.debug.fillCircle(o[0]/2,o[1]/2,10),this.debug.strokeRect(0,0,o[0],o[1])),this.setPosition(s,n)}setPosition(t,e){this.centers=[];for(let s=0;s<this.count;s++)this.centers.push(new i.Math.Vector2(t+Math.random()*this.bounds[0]-this.bounds[0]/2,e+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(t-this.bounds[0]/2,e-this.bounds[1]/2)}update(t,e){if(!(Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0]))return;const i=t/1e3*.025,s=Math.cos(i),n=Math.sin(i);this.lights.forEach(((t,e)=>{const r=this.biases[e],o=Math.cos(70*i+r[10]);t.intensity=Math.min(.05+Math.abs(r[4]*o+r[3]*s+r[4]*s)/50,.4),t.x=s*r[0]+n*r[1]+s*r[2]+n*r[3]+s*r[4]+this.centers[e].x,t.y=n*r[5]+s*r[6]+n*r[7]+s*r[8]+n*r[9]+this.centers[e].y}))}}var v=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t))(v||{}),S=(t=>(t[t.Underground=0]="Underground",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.LakeEast=6]="LakeEast",t[t.TownNorth=7]="TownNorth",t[t.ClockSquare=8]="ClockSquare",t[t.ClockSquareNorth=9]="ClockSquareNorth",t[t.ClockEntrance=10]="ClockEntrance",t[t.ClockStairs=11]="ClockStairs",t[t.ClockTop=12]="ClockTop",t))(S||{}),k=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t))(k||{}),P=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t))(P||{}),O=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.ClockTower=4]="ClockTower",t))(O||{}),T=(t=>(t[t.Sphinx=0]="Sphinx",t))(T||{}),A=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.ForestMazeSolved=1]="ForestMazeSolved",t[t.SphinxRiddleSolved=2]="SphinxRiddleSolved",t[t.MetTheMayor=3]="MetTheMayor",t[t.ClockFirstGear=4]="ClockFirstGear",t))(A||{});const j=2*Math.PI;class I extends i.GameObjects.Graphics{constructor(t){super(t),e(this,"angle1",0),e(this,"angle2",1),e(this,"angle3",4),e(this,"update1",!1),e(this,"update2",!1),e(this,"update3",!1),t.add.existing(this),this.setPosition(842,-2107),this.setDepth(u.Npcs)}update(t){this.update1&&(this.angle1=j*(t/6e4)*20),this.update2&&(this.angle2=j*(t/36e5)*20),this.update3&&(this.angle3=j*(t/432e5)*20),this.clear(),this.lineStyle(6,c(l.Night)),this.lineBetween(0,0,50*Math.cos(this.angle1),50*Math.sin(this.angle1)),this.lineBetween(0,0,40*Math.cos(this.angle2),40*Math.sin(this.angle2)),this.lineBetween(0,0,25*Math.cos(this.angle3),25*Math.sin(this.angle3)),this.lineStyle(4,c(l.Black));for(let e=0;e<12;e++){const t=j*(e/12),i=50*Math.cos(t),s=50*Math.sin(t);this.lineBetween(i,s,1.5*i,1.5*s)}}}var E=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t))(E||{});class C{constructor(t){e(this,"scene"),e(this,"keys",{0:!1,1:!1,2:!1,3:!1,4:!1,5:!1}),this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W"),this.listener(2,"A"),this.listener(1,"S"),this.listener(3,"D"),this.listener(4,"SPACE"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE")}listener(t,e){var i,s;null==(i=this.scene.input.keyboard)||i.on(`keydown-${e}`,(()=>this.keys[t]=!0)),null==(s=this.scene.input.keyboard)||s.on(`keyup-${e}`,(()=>this.keys[t]=!1))}resetKeys(){this.keys[0]=!1,this.keys[1]=!1,this.keys[2]=!1,this.keys[3]=!1,this.keys[4]=!1,this.keys[5]=!1}}const M={[O.Inventor]:{x:550,y:635,scale:.75,img:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor"},[O.Stranger]:{x:750,y:865,scale:1.35,img:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[O.Sphinx]:{x:3520,y:790,scale:1,img:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",onCreate:t=>L(t.scene,!1),light:1.85},[O.Mayor]:{x:1065,y:-340,scale:.9,img:"mayor",portrait:"mayor_portrait",name:"Mayor of Town"},[O.ClockTower]:{x:880,y:-2090,scale:.5,img:"warp",portrait:"clock_portrait",name:"Clock Tower",particles:{texture:"warp",scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]},onCreate:t=>{t.setOffset(150,-40)}}};class F extends Phaser.Physics.Arcade.Sprite{constructor(t,s,n){const{x:r,y:o,img:h,scale:l,onCreate:c,light:p,particles:d}=M[s];super(t,r,o,h),e(this,"npcType"),e(this,"player"),e(this,"light"),e(this,"particles"),e(this,"lastPos",new i.Math.Vector2),e(this,"clock"),this.setScale(l).setDepth(u.Npcs).setPipeline("Light2D"),"warp"===h&&this.setAlpha(0),t.add.existing(this),t.physics.add.existing(this),a.debug&&this.setInteractive({draggable:!0}),a.debug?this.light=new g(t,this.x,this.y,this.displayHeight/150*150,16764074,p||1):this.light=t.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,p||1),this.npcType=s,this.player=n,d&&(this.particles=t.add.particles(r,o,"",d)),s===O.ClockTower&&(this.clock=new I(t)),c&&c(this)}update(t,e){this.x===this.lastPos.x&&this.y===this.lastPos.y||this.light.setPosition(this.x,this.y),this.lastPos.set(this.x,this.y),this.clock&&this.clock.update(t)}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return v.None;if(t[E.Continue]){const t=function(t,e){const i=Q[t]||[];for(const r of i){const{conditions:t}=r,i=[];if(void 0!==(null==t?void 0:t.hasItem)&&i.push((s=e.inventory.inventory,n=t.hasItem,s.includes(n))),void 0!==(null==t?void 0:t.completedQuest)&&i.push(W(e.quests.quests,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&i.push(U(e.quests.quests,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&i.push(z(e.journal.journal,t.journalEntry)),null==t?void 0:t.invert)if(null==t?void 0:t.or){if(i.every((t=>!t)))return r}else if(i.every((t=>!t)))return r;if(null==t?void 0:t.or){if(i.some((t=>t)))return r}else if(i.every((t=>t)))return r}var s,n}(this.npcType,this.player);if(!t)return v.None;const e=M[this.npcType].portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),v.Talked}return v.None}getButtonPrompt(){return this.npcType===O.ClockTower?["Inspect Clock Tower","Press [CONTINUE]"]:[`Talk to ${M[this.npcType].name}`,"Press [CONTINUE]"]}}const B=[{x:40,y:600},{x:1750,y:600},{x:90,y:820},{x:1650,y:820},{x:550,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3630,y:760,id:T.Sphinx},{x:4575,y:850},{x:6160,y:690}];class D extends i.Physics.Arcade.StaticGroup{constructor(t){super(t.physics.world,t),B.forEach((e=>{const i=t.add.rectangle(e.x,e.y,6,100).setOrigin(0).setVisible(a.debug);i.setData("WallType",e.id),a.debug&&i.setInteractive({draggable:!0}),this.add(i)}))}}const G={[S.Town]:{x:300,y:650,key:E.Down,warpTo:S.Underground,visual:0},[S.Underground]:{x:301,y:875,key:E.Up,warpTo:S.Town,visual:0},[S.TownEast]:{x:1720,y:650,key:E.Right,warpTo:S.Forest,visual:2},[S.Forest]:{x:2650,y:815,key:E.Left,warpTo:S.TownEast,visual:1},[S.TownNorth]:{x:775,y:650,key:E.Up,warpTo:S.ClockSquare,visual:2},[S.ClockSquare]:{x:610,y:-330,key:E.Left,warpTo:S.TownNorth,visual:1},[S.ClockSquareNorth]:{x:915,y:-330,key:E.Up,warpTo:S.ClockEntrance,visual:2},[S.ClockEntrance]:{x:690,y:-1320,range:15,key:E.Left,warpTo:S.ClockSquareNorth,visual:1},[S.ClockStairs]:{x:910,y:-1400,range:20,key:E.Right,warpTo:S.ClockTop,visual:3},[S.ClockTop]:{x:780,y:-1970,range:10,key:E.Left,warpTo:S.ClockStairs,visual:3},[S.ForestEast]:{x:3590,y:815,key:E.Right,warpTo:S.Lake,visual:2},[S.Lake]:{x:4625,y:915,key:E.Left,warpTo:S.ForestEast,visual:1},[S.LakeEast]:{x:6121,y:760,key:E.Right,warpTo:S.Lake,visual:1}};class R extends i.Physics.Arcade.Sprite{constructor(t,s,n){const{x:r,y:o,visual:h,range:p}=G[s];if(super(t,r,o,0===h?"ladder":"warp"),e(this,"warpType"),e(this,"player"),e(this,"particles1"),e(this,"particles2"),e(this,"range"),this.warpType=s,this.player=n,this.setScale(.6).setPipeline("Light2D"),this.range=p||30,t.add.existing(this),t.physics.add.existing(this),1!==h&&2!==h||(this.setScale(.6,1),this.setPosition(r,o-12),this.particles1=t.add.particles(r,o-12,"warp",{x:{min:-3,max:3},y:{min:-3,max:3},speed:{random:[-40,40]},scale:{min:.35,max:.5},alpha:{start:.2,end:0},angle:{min:0,max:360},color:[c(l.Teal),c(l.White),c(l.Tan)],colorEase:"Linear",radial:!0,blendMode:i.BlendModes.OVERLAY}).setScale(1,2).setPipeline("Light2D"),this.particles1.viewBounds=this.particles1.getBounds(30,500),this.particles2=t.add.particles(r,o-12,"warp",{x:{min:-30,max:30},y:{min:-50,max:50},speed:{random:[-5,5]},scale:{min:.05,max:.15},alpha:{values:[0,.2,0]},angle:{min:0,max:360},lifespan:{min:1e3,max:1400},color:[c(l.Peach),c(l.White),c(l.Tan)],colorEase:"Linear",radial:!0,maxAliveParticles:20}).setPipeline("Light2D"),this.particles2.viewBounds=this.particles2.getBounds(30,500)),s===S.Underground&&(t.add.sprite(r,o-60,"ladder").setScale(.6).setPipeline("Light2D"),t.add.sprite(r,o-105,"ladder").setScale(.6).setPipeline("Light2D")),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),3===h&&this.setAlpha(0),this.setVisible(2!==h),a.debug){this.setInteractive({draggable:!0});const e=t.add.graphics();if(this.hasExtendedBounds()){e.lineStyle(2,16711935);const t=this.body;e.lineBetween(r-this.range,o-t.halfHeight,r-this.range,o+t.halfHeight),e.lineBetween(r+this.range,o-t.halfHeight,r+this.range,o+t.halfHeight),e.strokeCircle(r,o,5)}}}hasExtendedBounds(){const{visual:t,key:e}=G[this.warpType];return!(1!==t&&2!==t&&3!==t||e!==E.Left&&e!==E.Right)}onInteract(t){const e=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,i=t[G[this.warpType].key]&&e;return!i||this.warpType!==S.TownEast||z(this.player.journal.journal,A.ForestMazeSolved)||a.debug?i?(N(G[this.warpType].warpTo,this.player),v.Teleported):v.None:(this.scene.scene.pause(),this.scene.scene.launch("MazeDialog",{player:this.player}),v.None)}getButtonPrompt(){const t=G[this.warpType].key;let e;return t===E.Continue&&(e="[CONTINUE]"),t===E.Up&&(e="[Up]"),t===E.Down&&(e="[Down]"),t===E.Left&&(e="[Left]"),t===E.Right&&(e="[Right]"),[`Travel to ${S[G[this.warpType].warpTo]}`,"Press "+e]}setPosition(t,e,i,s){return super.setPosition(t,e,i,s),this.particles1&&this.particles2&&(this.particles1.setPosition(t,(e||0)-12),this.particles2.setPosition(t,(e||0)-12)),this}setVisible(t){return super.setVisible(t),this.particles1&&this.particles2&&(t?(this.particles1.start(),this.particles2.start()):(this.particles1.stop(),this.particles1.killAll(),this.particles2.stop(),this.particles2.killAll())),this}destroy(t){this.particles1&&this.particles2&&(this.particles1.destroy(),this.particles2.destroy()),super.destroy(t)}}function N(t,e){const{x:s,y:n,onWarp:r}=G[t],o=e.scene,h=s-o.cameras.main.width/2,l=n-o.cameras.main.height/2;r&&r(e),o.cameras.main.fadeOut(200,0,0,0,((t,e)=>{e>=1&&o.cameras.main.fadeIn(1e3,0,0,0)})),o.cameras.main.stopFollow(),o.tweens.add({targets:o.cameras.main,scrollX:h,scrollY:l-a.cameraOffset,duration:600,delay:100,ease:"Power1",onComplete:()=>{o.cameras.main.startFollow(e),o.cameras.main.setFollowOffset(0,a.cameraOffset)}}),e.setActive(!1),o.tweens.add({targets:e,alpha:0,duration:500,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{e.setPosition(s,n)},onComplete:()=>{e.alpha=1,e.setActive(!0)}});const c=e.light instanceof i.GameObjects.Light?e.light:e.light.light;o.tweens.add({targets:c,x:s,y:n,duration:400,ease:"Power1"})}function L(t,e,s){var n,r;const o=$(t,O.Sphinx);_(t,S.ForestEast,!0===e);const a=function(t,e){return V(t,i.GameObjects.Rectangle).find((t=>t.getData("WallType")===e))}(t,T.Sphinx);if(a&&(e?a.setX((null==(n=B.find((t=>t.id===T.Sphinx)))?void 0:n.x)||0):a.setX(a.x-150),null==(r=a.body)||r.updateFromGameObject()),!o)return;const{x:h,y:l}=M[O.Sphinx],c=e?h+200:h,p=e?l-90:l;t.tweens.add({targets:o,alpha:0,duration:!e||s?0:300,ease:"Power1",yoyo:!0,repeat:0,onYoyo:()=>{o.setPosition(c,p)},onComplete:()=>{o.alpha=1}}),t.tweens.add({targets:o.light,x:c,y:p,duration:!e||s?0:450,ease:"Power1"})}function U(t,e){return t.some((t=>t.id===e&&!t.completed))}function W(t,e){return t.some((t=>t.id===e&&t.completed))}function z(t,e){return t.includes(e)}function V(t,e){return t.children.getAll().filter((t=>t instanceof e))}function _(t,e,i){const s=function(t,e){return V(t,R).find((t=>t.warpType===e))}(t,e);s&&s.setVisible(i)}function $(t,e){return V(t,F).find((t=>t.npcType===e))}function q(t){return t.scene.get("Game").clock.rewindCount||0}const H=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[O.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[O.Stranger]:["The sphinx’s riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","globe","dream","photograph","landscape"],hints:{[O.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[O.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[O.Inventor]:["The sphinx’s riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[O.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, don’t they?","They move, disappear, and seem to fly without wings."]}}];function K(t){return t instanceof As?q(t)%H.length:0}function Y(t,e){const i=K(t);return H[i].hints[e]}const Q={[O.Inventor]:[{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:k.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(P.ForestGear,!0),_(t.scene,S.TownNorth,!0)}},{messages:t=>Y(t.scene,O.Inventor),conditions:{activeQuest:P.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. You’ll need three gears to do it."],conditions:{hasItem:k.Wrench}},{messages:["The clock tower is the heart of our town, but it’s been broken for ages. I’ve got a wrench, but you’ll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(A.FixTheClock),t.inventory.addItem(k.Wrench)}}],[O.Stranger]:[{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:k.Gear1}},{messages:t=>Y(t.scene,O.Stranger),conditions:{activeQuest:P.SphinxRiddle}},{messages:["I’ve heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forest’s creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:k.Wrench},onCompleted:t=>{t.quests.addQuest({id:P.ForestGear,completed:!1}),_(t.scene,S.TownEast,!0)}},{messages:["Who am I?","Eventually, you will learn."]}],[O.Sphinx]:[{messages:t=>function(t){const e=K(t);return[H[e].question]}(t.scene),options:t=>function(t){const e=K(t),i=[...H[e].options].sort((()=>Math.random()-.5));return i.push("I don’t know"),i}(t.scene),conditions:{activeQuest:P.SphinxRiddle},onSelected:(t,e,i)=>{t===function(t){const e=K(t);return H[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(P.SphinxRiddle,!0),t.journal.addEntry(A.SphinxRiddleSolved)}},i):"I don’t know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},i):e.message.setDialog({messages:["That is not correct. Do not return."]},i)}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:P.SphinxRiddle,completed:!1})}}],[O.Mayor]:[{messages:["The minute hand on the clock is spinning again.","It looks like it’s missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:A.ClockFirstGear}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:A.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(A.MetTheMayor),_(t.scene,S.ClockSquareNorth,!0)}}],[O.ClockTower]:[{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:A.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Let’s see what happens when we add the first gear.","[CREAKING NOISE]","The clock tower is starting to partially move again. It looks like it’s missing two more gears."],conditions:{hasItem:k.Gear1},onCompleted:t=>{t.inventory.removeItem(k.Gear1),t.journal.addEntry(A.ClockFirstGear)}}]},J={[k.Gear1]:{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}},X={[k.Wrench]:{x:150,y:650,image:"wrench",name:"Wrench"},[k.Gear1]:{x:5120,y:915,image:"gear",name:"Gear"}};class Z extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s){const{x:n,y:r,image:o}=X[i];super(t,n,r,o),e(this,"itemType"),e(this,"player"),e(this,"particles"),e(this,"light"),t.add.existing(this),t.physics.add.existing(this),a.debug&&this.setInteractive({draggable:!0}),this.setScale(.35).setDepth(u.Items).setPipeline("Light2D"),this.itemType=i,this.player=s,this.particles=t.add.particles(n,r,"warp",{scale:{start:0,end:.9},alpha:{start:.8,end:0},delay:500,lifespan:1500,maxAliveParticles:1}),a.debug?this.light=new g(t,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=t.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2)}onInteract(t){return t[E.Continue]?(this.player.inventory.addItem(this.itemType),this.handleSideEffects(),this.destroy(),v.Item):v.None}destroy(t){var e,i;this.particles.destroy(),this.light instanceof g?this.light.destroy():null==(i=null==(e=this.scene)?void 0:e.lights)||i.removeLight(this.light),super.destroy(t)}getButtonPrompt(){return[`Pick Up ${k[this.itemType]}`,"Press [CONTINUE]"]}handleSideEffects(){const t=J[this.itemType];t&&this.player.message.setDialog(t,void 0,"player_portrait")}}class tt extends i.GameObjects.Text{constructor(t,e,i=3500){const s=V(t,tt).reduce(((t,e)=>Math.max(t,e.y-20)),0)+65;super(t,20,s,e,{...d,backgroundColor:"#"+l.Teal,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(u.Ui2).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:s+10,duration:350,hold:i,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}class et extends i.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),this.setScrollFactor(0).setDepth(u.Ui).setVisible(!1),t.add.existing(this),this.rect=t.add.rectangle(0,0,0,0,c(l.Teal)).setStrokeStyle(2,c(l.White)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=t.add.text(10,4,"Inventory",{...d,fontSize:32}),this.add(this.text)}addItem(t,e){this.inventory.push(t),this.add(this.scene.add.sprite(0,0,X[t].image).setScale(.35)),this.updateItems();const i=function(t,e){return V(t,Z).find((t=>t.itemType===e))}(this.scene,t);i&&i.destroy(),e||new tt(this.scene,`New item added: ${X[t].name}`)}removeItem(t){var e;const i=this.inventory.indexOf(t);i>-1&&(this.inventory.splice(i,1),null==(e=this.getAll().find((e=>{var i;return(null==(i=e.texture)?void 0:i.key)===X[t].image})))||e.destroy()),this.updateItems()}updateItems(){let t=0;this.getAll().forEach((e=>{if(e instanceof i.GameObjects.Sprite){const i=32+50*t;e.setPosition(i,68),t++}})),this.setVisible(this.inventory.length>0);const e=Math.max(this.text.displayWidth+18,50*t+12);this.setPosition(a.width-e-20,20),this.rect.setSize(e,102)}}class it extends i.GameObjects.Sprite{constructor(t,i){super(t,a.width-50,a.height-55,"journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),this.setScrollFactor(0).setDepth(u.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),t.add.existing(this),this.player=i,this.unread=t.add.ellipse(a.width-21,a.height-89,20,20,11141120).setStrokeStyle(2,c(l.Black)).setScrollFactor(0).setDepth(u.Ui2).setVisible(!1)}addEntry(t,e){this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new tt(this.scene,"New journal entry added!")),this.handleSideEffects(t,e||!1))}openJournal(){0!==this.journal.length&&(this.unread.setVisible(!1),this.scene.scene.pause(),this.scene.scene.launch("JournalDialog",{player:this.player}))}handleSideEffects(t,e){if(t===A.SphinxRiddleSolved&&L(this.scene,!0,e),t===A.ClockFirstGear){const t=$(this.scene,O.ClockTower);(null==t?void 0:t.clock)&&(t.clock.update1=!0)}}}const st={[P.ForestGear]:"Find the gear in the forest",[P.SphinxRiddle]:"Solve the Sphinx riddle"};class nt extends i.GameObjects.Container{constructor(t){super(t,a.width-330-20,120),e(this,"quests",[]),e(this,"questRectangle"),t.add.existing(this),this.setScrollFactor(0).setDepth(u.Ui).setVisible(!1),this.questRectangle=t.add.rectangle(0,0,330,60,c(l.Teal)).setStrokeStyle(2,c(l.White)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle),this.add(t.add.text(10,4,"Quests",{...d,fontSize:32}))}addQuest(t,e){this.quests.find((e=>e.id===t.id))||(this.quests.push(t),this.add(this.scene.add.text(0,0,st[t.id],{...d,fontSize:20})),this.updateQuests(),e||new tt(this.scene,`New quest added: ${st[t.id]}`))}updateExistingQuest(t,e){const i=this.quests.find((e=>e.id===t));i&&(!i.completed&&e&&new tt(this.scene,`Quest completed: ${st[i.id]}`),i.completed=e),this.updateQuests()}updateQuests(){const t=this.quests.filter((t=>!t.completed));let e=1,s=0;this.getAll().forEach((n=>{if(n instanceof i.GameObjects.Text)if(t.find((t=>n.text===st[t.id]))||"Quests"===n.text){if("Quests"!==n.text){const t=14+30*e;n.setPosition(10,t),e++,s=Math.max(s,n.width)}}else n.destroy()}));const n=s+20;this.setX(a.width-20-n),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(n,50+30*t.length)}reset(){this.quests=[],this.updateQuests()}}class rt extends i.GameObjects.Text{constructor(t){super(t,a.width/2,a.height-50,"",d),this.setOrigin(.5).setBackgroundColor("#"+l.Black).setPadding(10,5).setAlign("center").setAlpha(.9).setScrollFactor(0).setDepth(u.Overlay).setVisible(!1),t.add.existing(this)}}class ot extends i.GameObjects.Text{constructor(t,i,s,n,r,o){super(t,i,s,n,{...d,fontSize:48,backgroundColor:`#${l.Teal}`,padding:{x:15,y:10},...o}),e(this,"onClick"),this.setOrigin(.5),t.add.existing(this),this.onClick=r,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>r())),this.on("pointerover",(()=>this.setTint(12303291))),this.on("pointerout",(()=>this.setTint(16777215)))}}class at extends i.GameObjects.Container{constructor(t){var i,s,n;super(t),e(this,"buttons",[]),e(this,"activeIndex",-1),t.add.existing(this).setScrollFactor(0),null==(i=t.input.keyboard)||i.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(s=t.input.keyboard)||s.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(n=t.input.keyboard)||n.on("keydown-ENTER",(()=>{var t;null==(t=this.buttons[this.activeIndex])||t.onClick()}))}addButton(t){this.add(t),this.buttons.push(t),1===this.buttons.length&&this.setActiveButton(0),t.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(t){var e,i;null==(e=this.buttons[this.activeIndex])||e.setTint(16777215),this.activeIndex=t,null==(i=this.buttons[this.activeIndex])||i.setTint(c(l.Tan))}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const ht=20;class lt extends i.GameObjects.Container{constructor(t,s){var n,r;super(t),e(this,"textWidth"),e(this,"textHeight"),e(this,"player"),e(this,"npc"),e(this,"npcName"),e(this,"text"),e(this,"box"),e(this,"image"),e(this,"options"),e(this,"optionsContainer"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),t.add.existing(this);const{width:o,height:h}=a;this.textWidth=o-130-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(ht,h-ht-170),this.setDepth(u.Overlay),this.setVisible(!1),this.player=s,this.npcName=new i.GameObjects.Text(t,170,15,"",{...d,color:"#"+l.Tan}),this.text=new i.GameObjects.Text(t,170,60,"",d),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(3),this.image=new i.GameObjects.Image(t,ht,ht,"").setOrigin(0).setScale(1.5),this.box=new i.GameObjects.Rectangle(t,0,0,o-40,170,c(l.Black),.8),this.box.setStrokeStyle(2,c(l.Tan),1),this.box.setOrigin(0,0),this.optionsContainer=new at(t).setDepth(u.Overlay),this.add([this.box,this.npcName,this.text,this.image]),null==(n=this.scene.input.keyboard)||n.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(r=this.scene.input.keyboard)||r.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}setDialog(t,e,i){this.setVisible(void 0!==t),this.npc=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,this.scene.gamepad.offsetButtons(void 0!==this.dialog),t&&(this.npcName.setVisible(!1),e||i?(e&&(this.npcName.setVisible(!0),this.npcName.setText(M[e.npcType].name)),this.image.setVisible(!0),e?this.image.setTexture(M[e.npcType].portrait):i&&this.image.setTexture(i),this.text.setPosition(170,ht+(e?40:0)).setWordWrapWidth(this.textWidth,!0).setFixedSize(this.textWidth,this.textHeight)):(this.image.setVisible(!1),this.text.setPosition(ht,ht).setWordWrapWidth(170+this.textWidth,!0).setFixedSize(170+this.textWidth,this.textHeight)),this.showMessage())}showMessage(){const t=this.getMessages(),e=t&&t[this.messageIndex];e&&(this.text.setText(e),this.text.getWrappedText().length>3&&console.error("Message too long!",e)),this.updateOptions()}updateOptions(){this.optionsContainer.clearButtons(),this.options=this.getOptions(),this.options&&this.options.forEach(((t,e)=>{const i=new ot(this.scene,a.width/2,a.height/9+e*(30+a.height/16),t,(()=>this.onSelectOption(t)),{fontSize:24,backgroundColor:"#"+l.Black,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(u.Overlay);this.optionsContainer.addButton(i)}))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.npc),this.optionsContainer.removeAll(!0))}updateDialog(){if(Date.now()<this.interactionTimeout)return;const t=this.getMessages();this.dialog&&t&&(this.messageIndex++,this.messageIndex>=t.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.npc),this.dialog=void 0,this.setVisible(!1)):this.showMessage(),this.scene.gamepad.offsetButtons(void 0!==this.dialog),this.interactionTimeout=Date.now()+350)}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}}const ct=1.35*(a.fastMode?350:120),pt=new i.Math.Vector2(400,650);class dt extends Phaser.Physics.Arcade.Sprite{constructor(t){var i;super(t,pt.x,pt.y,"character",0),e(this,"scene"),e(this,"keys"),e(this,"light"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),this.scene=t,t.add.existing(this),t.physics.add.existing(this),a.debug&&this.setInteractive(),this.setBodySize(48,70).setOffset(40,10).setOrigin(.5,.65).setDepth(u.Player).setScale(1.35).setPipeline("Light2D"),a.debug?this.light=new g(t,this.x,this.y,200,16768443,1.2):this.light=t.lights.addLight(this.x,this.y,200,16768443,1.2),(i=this).anims.create({key:"walk",frames:i.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:4,repeat:-1}),i.anims.play("walk"),this.keys=new C(t),this.buttonPrompt=new rt(t),this.message=new lt(t,this),this.inventory=new et(t),this.quests=new nt(t),this.journal=new it(t,this)}update(t,e){a.debug&&this.setTint(this.interactive?16755370:16777215),this.buttonPrompt.setVisible(this.interactive&&!this.message.visible&&this.buttonPrompt.text.length>0||!1),this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity(),this.light.setPosition(this.x,this.y),function(t){var e;const i=(null==(e=t.body)?void 0:e.velocity.x)||0,s=i<0;Math.abs(i)>0?(t.anims.resume(),t.flipX=t.rewinding?!s:s):t.anims.pause(),t.setAngle(t.flipX?-5:5)}(this)}checkInteraction(){let t;return this.interactive&&Date.now()>this.interactionTimeout&&(t=this.interactive.onInteract(this.keys.keys),t!==v.None&&(this.interactionTimeout=Date.now()+(this.interactive.interactionTimeout||500),this.keys.resetKeys(),t===v.Teleported&&(this.interactive=void 0))),t}updateVelocity(){let t=ct;const e=this.keys.keys;e[E.Left]&&this.setVelocityX(-t),e[E.Right]&&this.setVelocityX(t),a.debug&&!this.interactive&&(e[E.Up]&&this.setVelocityY(-t),e[E.Down]&&this.setVelocityY(t)),e[E.Left]&&e[E.Right]&&this.setVelocityX(0)}record(){var t;this.history.length<1e3?this.history.push(new Phaser.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(pt.x,pt.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e;this.interactive=t,this.buttonPrompt.setText((null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t))||"")}}class ut extends i.Physics.Arcade.Image{constructor(t,s,n,r=100,o=100,h=!1){if(super(t,s,n,""),e(this,"width"),e(this,"height"),e(this,"flipped"),e(this,"graphics"),t.add.existing(this),t.physics.add.existing(this),this.scene=t,this.width=r,this.height=o,this.flipped=h,this.setOrigin(0),this.setVisible(!1),this.setSize(r,1.5*o),a.debug){const e=t.add.graphics();this.graphics=e,e.lineStyle(2,65280,1);const a=r/2,l=new i.Math.Vector2(s,h?n:n+o),c=new i.Math.Vector2(s+r,h?n+o:n);e.lineBetween(l.x,l.y,c.x,c.y),e.lineBetween(l.x-a,l.y,l.x,l.y),e.lineBetween(c.x,c.y,c.x+a,c.y),e.strokeCircle(l.x,l.y,2),e.strokeCircle(c.x,c.y,2)}}update(t,e){const s=this.scene.player;if(this.body&&this.scene.physics.world.intersects(this.body,s.body)){let t=i.Math.Clamp(1-(this.x+this.width-s.x)/this.width,0,1);this.flipped&&(t=1-t);const e=this.y+this.height,n=(1-s.originY)*s.displayHeight,r=e-this.height*t-n;s.setY(r)}}}const yt=1200;let gt=!1;function ft(t){return p(t.lights.ambientColor)===c(l.White)}function mt(t,e=!0){gt||(bt(t,l.White,e),t.lights.lights.forEach((i=>{const s=i.intensity;e?t.tweens.add({targets:i,duration:yt,intensity:0,onComplete:()=>{i.setVisible(!1),i.setIntensity(s)}}):i.setVisible(!1)})))}function bt(t,e,s){if(!s)return void t.lights.setAmbientColor(c(e));gt=!0;const n=p(t.lights.ambientColor),r=i.Display.Color.ValueToColor(n),o=i.Display.Color.ValueToColor(e);t.tweens.addCounter({from:0,to:100,duration:yt,onUpdate:e=>{const s=i.Display.Color.Interpolate.ColorWithColor(r,o,100,e.getValue());var n;t.lights.setAmbientColor((n=s,c(i.Display.Color.RGBToString(n.r,n.g,n.b))))},onComplete:()=>{gt=!1}})}var wt,xt,vt=Object.prototype.toString,St=function(t){var e=vt.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===vt.call(t.callee)),i},kt=Array.prototype.slice,Pt=St,Ot=Object.keys,Tt=Ot?function(t){return Ot(t)}:function(){if(xt)return wt;var t;if(xt=1,!Object.keys){var e=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=St,n=Object.prototype.propertyIsEnumerable,r=!n.call({toString:null},"toString"),o=n.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(t){var e=t.constructor;return e&&e.prototype===t},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!l["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{h(window[t])}catch(i){return!0}}catch(i){return!0}return!1}();t=function(t){var n=null!==t&&"object"==typeof t,l="[object Function]"===i.call(t),p=s(t),d=n&&"[object String]"===i.call(t),u=[];if(!n&&!l&&!p)throw new TypeError("Object.keys called on a non-object");var y=o&&l;if(d&&t.length>0&&!e.call(t,0))for(var g=0;g<t.length;++g)u.push(String(g));if(p&&t.length>0)for(var f=0;f<t.length;++f)u.push(String(f));else for(var m in t)y&&"prototype"===m||!e.call(t,m)||u.push(String(m));if(r)for(var b=function(t){if("undefined"==typeof window||!c)return h(t);try{return h(t)}catch(e){return!1}}(t),w=0;w<a.length;++w)b&&"constructor"===a[w]||!e.call(t,a[w])||u.push(a[w]);return u}}return wt=t}(),At=Object.keys;Tt.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return Pt(t)?At(kt.call(t)):At(t)})}else Object.keys=Tt;return Object.keys||Tt};var jt,It=Tt,Et=Error,Ct=EvalError,Mt=RangeError,Ft=ReferenceError,Bt=SyntaxError,Dt=TypeError,Gt=URIError,Rt=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var s=Object.getOwnPropertySymbols(t);if(1!==s.length||s[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0},Nt="undefined"!=typeof Symbol&&Symbol,Lt=Rt,Ut=function(){return"function"==typeof Nt&&"function"==typeof Symbol&&"symbol"==typeof Nt("foo")&&"symbol"==typeof Symbol("bar")&&Lt()},Wt={__proto__:null,foo:{}},zt=Object,Vt=Object.prototype.toString,_t=Math.max,$t=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i},qt=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||"[object Function]"!==Vt.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var i,s=function(t,e){for(var i=[],s=1,n=0;s<t.length;s+=1,n+=1)i[n]=t[s];return i}(arguments),n=_t(0,e.length-s.length),r=[],o=0;o<n;o++)r[o]="$"+o;if(i=Function("binder","return function ("+function(t,e){for(var i="",s=0;s<t.length;s+=1)i+=t[s],s+1<t.length&&(i+=",");return i}(r)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=e.apply(this,$t(s,arguments));return Object(n)===n?n:this}return e.apply(t,$t(s,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,i.prototype=new a,a.prototype=null}return i},Ht=Function.prototype.call,Kt=Object.prototype.hasOwnProperty,Yt=qt.call(Ht,Kt),Qt=Et,Jt=Ct,Xt=Mt,Zt=Ft,te=Bt,ee=Dt,ie=Gt,se=Function,ne=function(t){try{return se('"use strict"; return ('+t+").constructor;")()}catch(e){}},re=Object.getOwnPropertyDescriptor;if(re)try{re({},"")}catch(Xs){re=null}var oe=function(){throw new ee},ae=re?function(){try{return oe}catch(t){try{return re(arguments,"callee").get}catch(e){return oe}}}():oe,he=Ut(),le={__proto__:Wt}.foo===Wt.foo&&!(Wt instanceof zt),ce=Object.getPrototypeOf||(le?function(t){return t.__proto__}:null),pe={},de="undefined"!=typeof Uint8Array&&ce?ce(Uint8Array):jt,ue={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?jt:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?jt:ArrayBuffer,"%ArrayIteratorPrototype%":he&&ce?ce([][Symbol.iterator]()):jt,"%AsyncFromSyncIteratorPrototype%":jt,"%AsyncFunction%":pe,"%AsyncGenerator%":pe,"%AsyncGeneratorFunction%":pe,"%AsyncIteratorPrototype%":pe,"%Atomics%":"undefined"==typeof Atomics?jt:Atomics,"%BigInt%":"undefined"==typeof BigInt?jt:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?jt:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?jt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?jt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Qt,"%eval%":eval,"%EvalError%":Jt,"%Float32Array%":"undefined"==typeof Float32Array?jt:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?jt:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?jt:FinalizationRegistry,"%Function%":se,"%GeneratorFunction%":pe,"%Int8Array%":"undefined"==typeof Int8Array?jt:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?jt:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?jt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":he&&ce?ce(ce([][Symbol.iterator]())):jt,"%JSON%":"object"==typeof JSON?JSON:jt,"%Map%":"undefined"==typeof Map?jt:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&he&&ce?ce((new Map)[Symbol.iterator]()):jt,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?jt:Promise,"%Proxy%":"undefined"==typeof Proxy?jt:Proxy,"%RangeError%":Xt,"%ReferenceError%":Zt,"%Reflect%":"undefined"==typeof Reflect?jt:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?jt:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&he&&ce?ce((new Set)[Symbol.iterator]()):jt,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?jt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":he&&ce?ce(""[Symbol.iterator]()):jt,"%Symbol%":he?Symbol:jt,"%SyntaxError%":te,"%ThrowTypeError%":ae,"%TypedArray%":de,"%TypeError%":ee,"%Uint8Array%":"undefined"==typeof Uint8Array?jt:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?jt:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?jt:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?jt:Uint32Array,"%URIError%":ie,"%WeakMap%":"undefined"==typeof WeakMap?jt:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?jt:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?jt:WeakSet};if(ce)try{null.error}catch(Xs){var ye=ce(ce(Xs));ue["%Error.prototype%"]=ye}var ge=function t(e){var i;if("%AsyncFunction%"===e)i=ne("async function () {}");else if("%GeneratorFunction%"===e)i=ne("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=ne("async function* () {}");else if("%AsyncGenerator%"===e){var s=t("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&ce&&(i=ce(n.prototype))}return ue[e]=i,i},fe={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},me=qt,be=Yt,we=me.call(Function.call,Array.prototype.concat),xe=me.call(Function.apply,Array.prototype.splice),ve=me.call(Function.call,String.prototype.replace),Se=me.call(Function.call,String.prototype.slice),ke=me.call(Function.call,RegExp.prototype.exec),Pe=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Oe=/\\(\\)?/g,Te=function(t,e){var i,s=t;if(be(fe,s)&&(s="%"+(i=fe[s])[0]+"%"),be(ue,s)){var n=ue[s];if(n===pe&&(n=ge(s)),void 0===n&&!e)throw new ee("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:n}}throw new te("intrinsic "+t+" does not exist!")},Ae=function(t,e){if("string"!=typeof t||0===t.length)throw new ee("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new ee('"allowMissing" argument must be a boolean');if(null===ke(/^%?[^%]*%?$/,t))throw new te("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=Se(t,0,1),i=Se(t,-1);if("%"===e&&"%"!==i)throw new te("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new te("invalid intrinsic syntax, expected opening `%`");var s=[];return ve(t,Pe,(function(t,e,i,n){s[s.length]=i?ve(n,Oe,"$1"):e||t})),s}(t),s=i.length>0?i[0]:"",n=Te("%"+s+"%",e),r=n.name,o=n.value,a=!1,h=n.alias;h&&(s=h[0],xe(i,we([0,1],h)));for(var l=1,c=!0;l<i.length;l+=1){var p=i[l],d=Se(p,0,1),u=Se(p,-1);if(('"'===d||"'"===d||"`"===d||'"'===u||"'"===u||"`"===u)&&d!==u)throw new te("property names with quotes must have matching quotes");if("constructor"!==p&&c||(a=!0),be(ue,r="%"+(s+="."+p)+"%"))o=ue[r];else if(null!=o){if(!(p in o)){if(!e)throw new ee("base intrinsic for "+t+" exists, but the property is not available.");return}if(re&&l+1>=i.length){var y=re(o,p);o=(c=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:o[p]}else c=be(o,p),o=o[p];c&&!a&&(ue[r]=o)}}return o},je=Ae("%Object.defineProperty%",!0)||!1;if(je)try{je({},"a",{value:1})}catch(Xs){je=!1}var Ie=je,Ee=Ae("%Object.getOwnPropertyDescriptor%",!0);if(Ee)try{Ee([],"length")}catch(Xs){Ee=null}var Ce=Ee,Me=Ie,Fe=Bt,Be=Dt,De=Ce,Ge=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Be("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new Be("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Be("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Be("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Be("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Be("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,r=arguments.length>5?arguments[5]:null,o=arguments.length>6&&arguments[6],a=!!De&&De(t,e);if(Me)Me(t,e,{configurable:null===r&&a?a.configurable:!r,enumerable:null===s&&a?a.enumerable:!s,value:i,writable:null===n&&a?a.writable:!n});else{if(!o&&(s||n||r))throw new Fe("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}},Re=Ie,Ne=function(){return!!Re};Ne.hasArrayLengthDefineBug=function(){if(!Re)return null;try{return 1!==Re([],"length",{value:1}).length}catch(Xs){return!0}};var Le=Ne,Ue=It,We="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),ze=Object.prototype.toString,Ve=Array.prototype.concat,_e=Ge,$e=Le(),qe=function(t,e,i,s){if(e in t)if(!0===s){if(t[e]===i)return}else if("function"!=typeof(n=s)||"[object Function]"!==ze.call(n)||!s())return;var n;$e?_e(t,e,i,!0):_e(t,e,i)},He=function(t,e){var i=arguments.length>2?arguments[2]:{},s=Ue(e);We&&(s=Ve.call(s,Object.getOwnPropertySymbols(e)));for(var n=0;n<s.length;n+=1)qe(t,s[n],e[s[n]],i[s[n]])};He.supportsDescriptors=!!$e;var Ke=He,Ye={exports:{}},Qe=Ae,Je=Ge,Xe=Le(),Ze=Ce,ti=Dt,ei=Qe("%Math.floor%"),ii=function(t,e){if("function"!=typeof t)throw new ti("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||ei(e)!==e)throw new ti("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in t&&Ze){var r=Ze(t,"length");r&&!r.configurable&&(s=!1),r&&!r.writable&&(n=!1)}return(s||n||!i)&&(Xe?Je(t,"length",e,!0,!0):Je(t,"length",e)),t};!function(t){var e=qt,i=Ae,s=ii,n=Dt,r=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||e.call(o,r),h=Ie,l=i("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new n("a function is required");var i=a(e,o,arguments);return s(i,1+l(0,t.length-(arguments.length-1)),!0)};var c=function(){return a(e,r,arguments)};h?h(t.exports,"apply",{value:c}):t.exports.apply=c}(Ye);var si=Ye.exports,ni=Ae,ri=si,oi=ri(ni("String.prototype.indexOf")),ai=function(t,e){var i=ni(t,!!e);return"function"==typeof i&&oi(t,".prototype.")>-1?ri(i):i},hi=It,li=Rt(),ci=ai,pi=Object,di=ci("Array.prototype.push"),ui=ci("Object.prototype.propertyIsEnumerable"),yi=li?Object.getOwnPropertySymbols:null,gi=function(t,e){if(null==t)throw new TypeError("target must be an object");var i=pi(t);if(1===arguments.length)return i;for(var s=1;s<arguments.length;++s){var n=pi(arguments[s]),r=hi(n),o=li&&(Object.getOwnPropertySymbols||yi);if(o)for(var a=o(n),h=0;h<a.length;++h){var l=a[h];ui(n,l)&&di(r,l)}for(var c=0;c<r.length;++c){var p=r[c];if(ui(n,p)){var d=n[p];i[p]=d}}}return i},fi=gi,mi=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},s=0;s<e.length;++s)i[e[s]]=e[s];var n=Object.assign({},i),r="";for(var o in n)r+=o;return t!==r}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(Xs){return"y"===t[1]}return!1}()?fi:Object.assign:fi},bi=Ke,wi=mi,xi=Ke,vi=gi,Si=mi,ki=si.apply(Si());xi((function(t,e){return ki(Object,arguments)}),{getPolyfill:Si,implementation:vi,shim:function(){var t=wi();return bi(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var Pi=function(){return"string"==typeof function(){}.name},Oi=Object.getOwnPropertyDescriptor;if(Oi)try{Oi([],"length")}catch(Xs){Oi=null}Pi.functionsHaveConfigurableNames=function(){if(!Pi()||!Oi)return!1;var t=Oi((function(){}),"name");return!!t&&!!t.configurable};var Ti=Function.prototype.bind;Pi.boundFunctionsHaveNames=function(){return Pi()&&"function"==typeof Ti&&""!==function(){}.bind().name};var Ai=Pi,ji=Ge,Ii=Le(),Ei=Ai.functionsHaveConfigurableNames(),Ci=Dt,Mi=Dt,Fi=Object,Bi=function(t,e){if("function"!=typeof t)throw new Ci("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!Ei||(Ii?ji(t,"name",e,!0,!0):ji(t,"name",e)),t}((function(){if(null==this||this!==Fi(this))throw new Mi("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0),Di=Bi,Gi=Ke.supportsDescriptors,Ri=Object.getOwnPropertyDescriptor,Ni=function(){if(Gi&&"gim"===/a/gim.flags){var t=Ri(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return Di},Li=Ke.supportsDescriptors,Ui=Ni,Wi=Object.getOwnPropertyDescriptor,zi=Object.defineProperty,Vi=TypeError,_i=Object.getPrototypeOf,$i=/a/,qi=Bi,Hi=Ni;Ke(si(Hi()),{getPolyfill:Hi,implementation:qi,shim:function(){if(!Li||!_i)throw new Vi("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Ui(),e=_i($i),i=Wi(e,"flags");return i&&i.get===t||zi(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var Ki=Rt,Yi=function(){return Ki()&&!!Symbol.toStringTag},Qi=Yi(),Ji=ai("Object.prototype.toString"),Xi=function(t){return!(Qi&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===Ji(t)};!function(){Xi(arguments)}(),Xi.isLegacyArguments=function(t){return!!Xi(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==Ji(t)&&"[object Function]"===Ji(t.callee)};var Zi=Ae,ts=ai;if(Zi("%WeakMap%",!0),Zi("%Map%",!0),ts("WeakMap.prototype.get",!0),ts("WeakMap.prototype.set",!0),ts("WeakMap.prototype.has",!0),ts("Map.prototype.get",!0),ts("Map.prototype.set",!0),ts("Map.prototype.has",!0),"object"==typeof StopIteration&&StopIteration,Yi(),Ut()||Rt());else{var es=Ae,is=es("%Map%",!0),ss=es("%Set%",!0),ns=ai;ns("Array.prototype.push"),ns("String.prototype.charCodeAt"),ns("String.prototype.slice"),(is||ss)&&(ns("Map.prototype.forEach",!0),ns("Set.prototype.forEach",!0),"undefined"!=typeof process&&process.versions&&process.versions.node||(ns("Map.prototype.iterator",!0),ns("Set.prototype.iterator",!0)),ns("Map.prototype.@@iterator",!0)||ns("Map.prototype._es6-shim iterator_",!0),ns("Set.prototype.@@iterator",!0)||ns("Set.prototype._es6-shim iterator_",!0))}var rs=function(t){return t!=t},os=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!rs(t)||!rs(e))},as=os,hs=function(){return"function"==typeof Object.is?Object.is:as},ls=hs,cs=Ke,ps=os,ds=hs;Ke(si(ds(),Object),{getPolyfill:ds,implementation:ps,shim:function(){var t=ls();return cs(Object,{is:t},{is:function(){return Object.is!==t}}),t}}),Yi();var us,ys,gs=ai;if(Yi()){gs("Object.prototype.hasOwnProperty"),gs("RegExp.prototype.exec"),us={};var fs=function(){throw us};ys={toString:fs,valueOf:fs},"symbol"==typeof Symbol.toPrimitive&&(ys[Symbol.toPrimitive]=fs)}gs("Object.prototype.toString"),Yi();var ms=ai;ms("Boolean.prototype.toString"),ms("Object.prototype.toString"),Yi(),Ut();var bs="undefined"!=typeof BigInt&&BigInt;"function"==typeof bs&&"function"==typeof BigInt&&"bigint"==typeof bs(42)&&BigInt(42);var ws=ai,xs=Ae;function vs(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t)))}function Ss(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal,inventory:t.player.inventory.inventory,quests:t.player.quests.quests,warpers:Ps(t),settings:{gamepad:t.gamepad.visible,debug:a.debug,zoomed:a.zoomed}}}function ks(t,e){const i=Ss(t);localStorage.setItem("chrono-sleuth-save",JSON.stringify(e||i)),new tt(t,"Game Saved")}function Ps(t){return V(t,R).map((t=>({warpType:t.warpType,state:t.visible})))}ws("SharedArrayBuffer.prototype.byteLength",!0),ws("Date.prototype.getTime"),ws("Object.prototype.toString"),xs("%Set%",!0),ws("Map.prototype.has",!0),ws("Map.prototype.get",!0),ws("Map.prototype.size",!0),ws("Set.prototype.add",!0),ws("Set.prototype.delete",!0),ws("Set.prototype.has",!0),ws("Set.prototype.size",!0),pt.x,pt.y,vs(),vs(),pt.x,pt.y,A.FixTheClock,A.SphinxRiddleSolved,A.MetTheMayor,k.Wrench,k.Gear1,P.SphinxRiddle,S.TownEast,S.TownNorth,S.ClockSquareNorth,i.GameObjects.Container;class Os extends i.GameObjects.Container{constructor(t,i){super(t,100,a.height-100),e(this,"buttons",[]),e(this,"lastAxisKey"),this.setScrollFactor(0).setDepth(u.Overlay),t.add.existing(this),this.createDPad(),i||this.createButtons(),this.createControllerListeners()}update(t,e){var i,s,n,r,o,a;const h=null==(i=this.scene.input.gamepad)?void 0:i.pad1;if(!h)return;const l=h.axes[0].getValue();if(Math.abs(l)<=.1&&this.lastAxisKey)return null==(s=this.scene.input.keyboard)||s.emit("keyup-"+this.lastAxisKey),void(this.lastAxisKey=void 0);if(l>.1){if("RIGHT"===this.lastAxisKey)return;"LEFT"===this.lastAxisKey&&(null==(n=this.scene.input.keyboard)||n.emit("keyup-LEFT")),null==(r=this.scene.input.keyboard)||r.emit("keydown-RIGHT"),this.lastAxisKey="RIGHT"}if(l<-.1){if("LEFT"===this.lastAxisKey)return;"RIGHT"===this.lastAxisKey&&(null==(o=this.scene.input.keyboard)||o.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastAxisKey="LEFT"}}createDPad(){const t=this.scene.add.container(10,-10);this.add(t);const e=this.scene.add.circle(0,0,60,c(l.Teal),.45).setStrokeStyle(3,c(l.Black));t.add(e),this.button(-57,0,"LEFT",t),this.button(57,0,"RIGHT",t),this.button(0,-57,"UP",t),this.button(0,57,"DOWN",t)}createButtons(){const t=this.scene.add.container(a.width-300,0);this.add(t);const e=this.scene.add.circle(40,0,65,c(l.Teal),.45).setStrokeStyle(3,c(l.Black)).setScale(1,.6).setAngle(-30);t.add(e),this.button(80,-20,"ENTER",t),this.button(0,20,"BACKSPACE",t)}createControllerListeners(){var t,e,i,s;null==(t=this.scene.input.gamepad)||t.on("connected",(t=>{new tt(this.scene,"Gamepad connected")})),null==(e=this.scene.input.gamepad)||e.on("disconnected",(t=>{new tt(this.scene,"Gamepad disconnected")})),null==(i=this.scene.input.gamepad)||i.on("down",((t,e)=>{var i;const s=this.getKeyFromButton(e);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keydown-${s}`)),console.log("down",e)})),null==(s=this.scene.input.gamepad)||s.on("up",((t,e)=>{var i;const s=this.getKeyFromButton(e);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keyup-${s}`)),console.log("up",e)}))}getKeyFromButton(t){let e;switch(t.index){case 0:e=t.pad.id.toLowerCase().includes("nintendo")?"BACKSPACE":"ENTER";break;case 1:e=t.pad.id.toLowerCase().includes("nintendo")?"ENTER":"BACKSPACE";break;case 9:e="ESC";break;case 12:e="UP";break;case 13:e="DOWN";break;case 14:e="LEFT";break;case 15:e="RIGHT"}return e}button(t,e,i,s){const n="ENTER"===i||"ESCAPE"===i?35:38,r=this.scene.add.circle(t,e,n,c(l.White),.8).setStrokeStyle(3,c(l.Black));r.setInteractive({useHandCursor:!0}).setScrollFactor(0),s.add(r),r.on("pointerdown",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keydown-${i}`),r.setFillStyle(c(l.Teal),Math.min(1,1.05))})),r.on("pointerup",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),r.setFillStyle(c(l.White),.8)})),r.on("pointerout",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),r.setFillStyle(c(l.White),.8)})),this.buttons.push(r)}offsetButtons(t){t?this.setPosition(100,a.height-300):this.setPosition(100,a.height-100)}}class Ts extends i.GameObjects.Container{constructor(t,i,s,n,r){super(t,i,s),e(this,"img"),e(this,"rect"),t.add.existing(this),this.setScrollFactor(0).setDepth(u.Ui),this.rect=t.add.rectangle(0,0,42,42,c(l.Teal)).setScrollFactor(0).setStrokeStyle(2,c(l.Black)),this.img=t.add.image(-1,1,n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>r(this))),this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}}class As extends i.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock"),e(this,"gamepad")}create(){this.createBackgrounds(),this.player=new dt(this);const t=new D(this),e=this.createWarpers(),i=this.createNpcs(),s=this.createItems(),n=this.createSlopes(),r=new x(this,m[0],m[1]),o=new x(this,b[0],b[1]);this.createLights();const{debugUI:h}=this.createUI(),l=[this.player];this.clock=new y(this,l,this.player),this.interactiveObjects=this.add.group([...e,...i,...s],{runChildUpdate:!0});const c=this.add.group([this.player,this.clock,this.gamepad,r,o,...n],{runChildUpdate:!0});h&&c.add(h),this.physics.add.collider(this.player,t),this.createEventListeners();const p=this.cameras.main;p.startFollow(this.player,!0),p.setFollowOffset(0,a.cameraOffset),this.gamepad.setVisible(!1),this.scene.pause(),this.scene.launch("PipesDialog",{player:this.player})}update(){this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>void 0===t.visible||t.visible),this.player)||this.player.setInteractiveObject(void 0)}createBackgrounds(){const t=[this.physics.add.sprite(0,0,"town").setOrigin(0),this.physics.add.sprite(500,-1100,"clock_outside").setOrigin(0),this.physics.add.sprite(500,-2400,"clock_inner").setOrigin(0),this.physics.add.sprite(2300,0,"forest").setOrigin(0),this.physics.add.sprite(4400,100,"lake").setOrigin(0)];return t.forEach((t=>{"clock_inner"!==t.texture.key&&t.setPipeline("Light2D"),a.debug&&t.setInteractive({draggable:!0})})),t}createWarpers(){const t=[];for(const e in S)isNaN(Number(e))&&t.push(new R(this,S[e],this.player));return t}createNpcs(){return[new F(this,O.Inventor,this.player),new F(this,O.Stranger,this.player),new F(this,O.Sphinx,this.player),new F(this,O.Mayor,this.player),new F(this,O.ClockTower,this.player)]}createItems(){return[new Z(this,k.Gear1,this.player)]}createSlopes(){return[new ut(this,740,-1370,170,95),new ut(this,815,-2010,90,70),new ut(this,5150,953,100,60,!0),new ut(this,5820,795,220,220)]}createUI(){return new Ts(this,31,30,"settings",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),new Ts(this,81,30,ft(this)?"moon":"sun",(t=>{const e=ft(this);var i;ft(i=this)?function(t,e=!0){gt||(bt(t,l.Night,e),t.lights.lights.forEach((i=>{const s=i.intensity;i.setVisible(!0),e&&(i.setIntensity(0),t.tweens.add({targets:i,duration:yt,intensity:s}))})))}(i):mt(i),t.img.setTexture(e?"sun":"moon")})),new Ts(this,131,30,"zoom-in",(()=>{const t=Ss(this);ks(this,{...t,settings:{...t.settings,zoomed:!a.zoomed}}),this.scene.restart()})),this.gamepad=new Os(this),{debugUI:void 0}}createLights(){this.lights.enable().setAmbientColor(c(l.White)),[{x:135,y:462,radius:150,color:c(l.Tan),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:887,y:200,radius:150},{x:1561,y:460},{x:791,y:472,intensity:.5},{x:962,y:469,intensity:.5},{x:162,y:814,intensity:2},{x:635,y:772},{x:1638,y:788,intensity:2},{x:5300,y:530,intensity:2},{x:5315,y:730,intensity:.75,radius:75}].forEach((t=>{a.debug?new g(this,t.x,t.y,t.radius||100,t.color||c(l.Lights),t.intensity||1):this.lights.addLight(t.x,t.y,t.radius||100,t.color||c(l.Lights),t.intensity||1)})),mt(this,!1)}createEventListeners(){var t,e;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.scene.pause(),this.scene.launch("Paused",{game:this})})),null==(e=this.input.keyboard)||e.on("keydown-J",(()=>{this.player.journal.openJournal()})),this.events.on("resume",(()=>{this.player.keys.resetKeys()}))}}class js extends i.GameObjects.Container{constructor(t,s,n,r,o){var a,h;super(t,s,n),e(this,"textObject"),e(this,"maskGraphics"),e(this,"scrollbar"),e(this,"scrollY"),e(this,"boxHeight"),t.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new i.GameObjects.Text(t,0,0,r,{...d,padding:{x:10,y:10},...o}),this.textObject.setOrigin(0).setScrollFactor(0).setInteractive(),this.add(this.textObject),t.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),null==(a=t.input.keyboard)||a.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(h=t.input.keyboard)||h.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=t.add.graphics().setPosition(s,n).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=t.add.rectangle(0,0,4,0,5592405).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(t,e){this.boxHeight=e,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,t,e);const i=this.maskGraphics.createGeometryMask();this.textObject.setMask(i),this.textObject.setWordWrapWidth(t-8),this.textObject.setFixedSize(t-8,0),this.updateTextPosition()}handleDrag(t){t.isDown&&(this.scrollY-=t.velocity.y,this.updateTextPosition())}handleScroll(t,e,i,s,n){this.scrollY+=.5*s,this.updateTextPosition()}updateTextPosition(){const t=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=Phaser.Math.Clamp(this.scrollY,0,t),this.textObject.y=-this.scrollY;const e=this.scrollY/t,i=this.boxHeight/this.textObject.height;this.scrollbar.height=i*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+4,e*(this.boxHeight-i*this.boxHeight))}}const Is={[A.FixTheClock]:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it.",[A.ForestMazeSolved]:"I finally got through the forest maze. Next time should be much easier.",[A.SphinxRiddleSolved]:"I solved the sphinx’s riddle. Now I can pass through the forest.",[A.MetTheMayor]:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",[A.ClockFirstGear]:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."};class Es extends i.Scene{constructor(){super("JournalDialog"),e(this,"player")}init(t){this.player=t.player}create(){var t,e,i;const s=this.add.container(a.width/2,a.height/2);s.add(this.add.rectangle(0,0,.8*a.width,.8*a.height,0,.75).setStrokeStyle(4,c(l.Tan))),s.add(new ot(this,.35*a.width,-.33*a.height,"X",(()=>this.close()))),s.add(this.add.text(0,-.33*a.height,"Journal",{...d,fontSize:48}).setOrigin(.5));const n=this.player.journal.journal.map((t=>`- ${Is[t]}\n`)).reverse();new js(this,.13*a.width,.25*a.height,n,{fontSize:32}).setBoxSize(.74*a.width,.62*a.height),new Os(this).setVisible(!1),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()})),null==(e=this.input.keyboard)||e.on("keydown-ESC",(()=>{this.close()})),null==(i=this.input.keyboard)||i.on("keydown-BACKSPACE",(()=>{this.close()}))}close(){this.scene.stop(),this.scene.resume("Game")}}function Cs(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Ms(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Cs(Object(i),!0).forEach((function(e){Fs(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Cs(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Fs(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Bs(t){return t.slice(0,-1)}function Ds(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function Gs(t){return[...new Set(t)]}function Rs(t,e){const i=Gs(t.map((t=>t.set))).filter(Boolean),s=(n=Ds(1,t.length+1),r=i,[n,r].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var n,r;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=s[e]))}function Ns(t,e,i=.5){Bs(t).forEach(((s,n)=>{const r=t[n+1],o=s.set!==r.set,a=e()<=i;var h,l,c;o&&a&&(h=t,l=r.set,c=s.set,h.forEach((t=>{t.set===l&&(t.set=c)})),s.right=!1,r.left=!1)}))}const Ls=48;class Us extends i.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"nextUpdate")}init(t){this.parent=t.parent}create(){this.createMaze(),this.mazePlayer=this.add.ellipse(0,0,.8*Ls,.8*Ls,5601177).setSmoothness(32).setOrigin(-.13),this.cameras.main.startFollow(this.mazePlayer),this.keys=this.parent.keys}createMaze(){const t=q(this.parent.player.scene);this.maze=function(t=8,e=t,i=!0,s=1){const n=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(s),r=[],o=Ds(t);for(let l=0;l<e;l+=1){const s=o.map((s=>({x:s,y:l,top:i||l>0,left:i||s>0,bottom:i||l<e-1,right:i||s<t-1})));r.push(s)}Bs(r).forEach(((t,e)=>{Rs(t,n),Ns(t,n),function(t,e,i){const s=Object.values(function(t,e){let i=Gs(t.map((t=>t.set))).reduce(((t,e)=>Ms(Ms({},t),{},{[e]:[]})),{});return t.forEach((t=>i[t.set].push(t))),i}(t)),{ceil:n}=Math;s.forEach((t=>{(function(t,e,i){e=null==e?1:e;const s=null==t?0:t.length;if(!s||e<1)return[];e=e>s?s:e;let n=-1;const r=s-1,o=[...t];for(;++n<e;){const t=n+Math.floor(i()*(r-n+1)),e=o[t];o[t]=o[n],o[n]=e}return o.slice(0,e)})(t,n(i()*t.length),i).forEach((t=>{if(t){const i=e[t.x];t.bottom=!1,i.top=!1,i.set=t.set}}))}))}(t,r[e+1],n)}));const a=(h=r)[h.length-1];var h;return Rs(a,n),Ns(a,n,1),r}(24,24,!0,t),this.graphics=this.add.graphics(),this.graphics.fillStyle(10040098,.5),this.graphics.fillRect(1104,1104,Ls,Ls),this.graphics.lineStyle(3,3385907),this.maze.forEach((t=>{t.forEach((t=>{if(t.top){const e=new Phaser.Geom.Line(t.x*Ls,t.y*Ls,t.x*Ls+Ls,t.y*Ls);this.graphics.strokeLineShape(e)}if(t.bottom){const e=new Phaser.Geom.Line(t.x*Ls,t.y*Ls+Ls,t.x*Ls+Ls,t.y*Ls+Ls);this.graphics.strokeLineShape(e)}if(t.left){const e=new Phaser.Geom.Line(t.x*Ls,t.y*Ls,t.x*Ls,t.y*Ls+Ls);this.graphics.strokeLineShape(e)}if(t.right){const e=new Phaser.Geom.Line(t.x*Ls+Ls,t.y*Ls,t.x*Ls+Ls,t.y*Ls+Ls);this.graphics.strokeLineShape(e)}}))})),this.cameras.main.setViewport(50,130,a.width-100,a.height-170)}update(t,e){if(t<this.nextUpdate)return;const s=this.keys.keys;s[E.Continue];const n=new i.Math.Vector2(0,0);s[E.Left]?n.x=-48:s[E.Right]?n.x=Ls:s[E.Up]?n.y=-48:s[E.Down]&&(n.y=Ls);const r=new i.Math.Vector2(this.mazePlayer.x+n.x,this.mazePlayer.y+n.y);if((this.mazePlayer.x!==r.x||this.mazePlayer.y!==r.y)&&this.canMove(r)){this.mazePlayer.setPosition(r.x,r.y);const t=new i.Math.Vector2(1104,1104);this.parent.setAngle(i.Math.Angle.BetweenPoints(r,t)),this.mazePlayer.x===t.x&&this.mazePlayer.y===t.y&&this.parent.close(!0)}this.nextUpdate=t+140}canMove(t){const e=t.x,s=t.y,n=i.Math.FloorTo(e/Ls),r=i.Math.FloorTo(s/Ls);if(n<0||r<0||n>=24||r>=24)return!1;const o=i.Math.FloorTo(this.mazePlayer.x/Ls),a=i.Math.FloorTo(this.mazePlayer.y/Ls),h=this.maze[a][o];return!(h.top&&s<this.mazePlayer.y||h.bottom&&s>this.mazePlayer.y||h.left&&e<this.mazePlayer.x||h.right&&e>this.mazePlayer.x)}}class Ws extends i.Scene{constructor(){super("MazeDialog"),e(this,"player"),e(this,"container"),e(this,"arrow"),e(this,"keys")}init(t){this.player=t.player}create(){var t,e;this.container=this.add.container(a.width/2,a.height/2),this.container.add(this.add.rectangle(0,0,.95*a.width,.95*a.height,0,.9).setStrokeStyle(4,c(l.Tan))),this.container.add(new ot(this,.44*a.width,-.4*a.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*a.height,"Find your way through the forest",{...d,fontSize:48}).setOrigin(.5)),this.arrow=this.add.sprite(.4*-a.width,.4*-a.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new Os(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new C(this),this.scene.launch("Maze",{parent:this})}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}close(t){this.scene.stop(),this.scene.stop("Maze"),this.scene.resume("Game"),t?(N(S.Forest,this.player),this.player.journal.addEntry(A.ForestMazeSolved)):this.player.setPosition(G[S.TownEast].x-40,G[S.TownEast].y)}}class zs extends i.Scene{constructor(){super("Paused"),e(this,"parent")}init(t){this.parent=t.game}create(){var t;const{width:e,height:i}=a;this.add.rectangle(e/2,i/2,e,i,0,.75).setInteractive().on("pointerdown",(()=>this.resume())),this.add.text(e/2,100,"Game Paused",{...d,fontSize:72}).setOrigin(.5),this.add.text(e-20,20,`Build Time: ${new Date("2024-07-31T00:37:59.854Z").toLocaleString()}`,{...d,fontSize:16}).setOrigin(1,0);const s=i/2-100,n=new at(this);n.addButton(new ot(this,e/2,s,"Resume",(()=>this.resume()))),n.addButton(new ot(this,e/2,s+100,"Save",(()=>{this.resume(),ks(this.parent)}))),n.addButton(new ot(this,e/2,s+200,"Load",(()=>{this.resume(),this.parent.scene.restart()}))),n.addButton(new ot(this,e/2,s+300,"Toggle Gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)}))),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume())),new Os(this).setVisible(!1)}resume(){this.scene.stop(),this.scene.resume("Game")}}var Vs=(t=>(t[t.Straight=0]="Straight",t[t.Corner=1]="Corner",t[t.T=2]="T",t[t.Cross=3]="Cross",t[t.Empty=4]="Empty",t))(Vs||{});const _s={0:[[0,0,0],[1,1,1],[0,0,0]],1:[[0,0,0],[1,1,0],[0,1,0]],2:[[0,0,0],[1,1,1],[0,1,0]],3:[[0,1,0],[1,1,1],[0,1,0]],4:[[0,0,0],[0,0,0],[0,0,0]]};function $s(t,e){if(!t||!e)return!1;const i=qs(t),s=qs(e),n=e.x-t.x,r=e.y-t.y;return 1===n&&0===r?i.right&&s.left:-1===n&&0===r?i.left&&s.right:0===n&&1===r?i.bottom&&s.top:0===n&&-1===r&&i.top&&s.bottom}function qs(t){const e=function(t){let e=_s[t.type];const i=Math.floor(t.rotation/90);for(let s=0;s<i;s++)e=Hs(e);return e}(t);return{left:e.some((t=>1===t[0])),right:e.some((t=>1===t[t.length-1])),top:e[0].some((t=>1===t)),bottom:e[e.length-1].some((t=>1===t))}}function Hs(t){return t[0].map(((e,i)=>t.map((t=>t[i])).reverse()))}class Ks extends i.Scene{constructor(){super("Pipes"),e(this,"parent"),e(this,"graphics"),e(this,"keys"),e(this,"pipes",[]),e(this,"sprites"),e(this,"nextUpdate")}init(t){this.parent=t.parent}preload(){this.prerenderPipes()}prerenderPipes(){Object.keys(_s).forEach((t=>{const e=_s[t],i=`pipe_${t}`,s=this.textures.createCanvas(i,48,48);if(s){const t=s.context;t.fillStyle="#ffffff";for(let i=0;i<e.length;i++)for(let s=0;s<e[i].length;s++)1===e[i][s]&&t.fillRect(16*s,16*i,16,16);s.refresh()}}))}create(){this.graphics=this.add.graphics(),this.keys=this.parent.keys,this.createPipes(),this.updatePipes()}createPipes(){this.pipes=function(t,e){let i=Array.from({length:e},(()=>Array(t).fill(null)));return function(t,e,i){let s=0,n=0;const r={x:s,y:n,type:0,rotation:90};t[n][s]=r;const o=[[s,n]];for(;o.length>0;){[s,n]=o.pop();const r=t[n][s],a=[[1,0],[0,1],[-1,0],[0,-1]];a.sort((()=>Math.random()-.5));let h=!1;for(const[l,c]of a){const a=s+l,p=n+c;if(a>=0&&a<e&&p>=0&&p<i){Object.values(Vs).filter((t=>4!==t&&Number.isNaN(t)));const e={x:a,y:p,type:Math.floor(4*Math.random()),rotation:[0,90,180,270][Math.floor(4*Math.random())]};if(r&&$s(r,e)&&!t[p][a]){t[p][a]=e,o.push([a,p]),h=!0;break}}}if(!h&&(t[n][s]=void 0,0===o.length))return console.log("Path generation failed. Trying a new start."),!1}}(i,t,e),function(t,e,i){for(let s=0;s<i;s++)for(let i=0;i<e;i++)if(!t[s][i])if(Math.random()<-.2){const e=Math.floor(4*Math.random())+1;t[s][i]={x:i,y:s,type:e,rotation:[0,90,180,270][Math.floor(4*Math.random())]}}else t[s][i]={x:i,y:s,type:4,rotation:0}}(i,t,e),i}(8,8),this.sprites=this.add.container().setPosition(a.width/2-240,200);for(let t=0;t<8;t++)for(let e=0;e<8;e++){const i=`pipe_${this.pipes[t][e].type}`,s=this.add.sprite(60*e,60*t,i).on("pointerdown",(()=>{this.pipes[t][e].rotation=(this.pipes[t][e].rotation+90)%360,this.updatePipes()}));s.setInteractive(),this.sprites.add(s)}}updatePipes(){const t=function(t,e,i){const s=[],n=new Set,r=t.length,o=t[0].length;return function e(i,a){const h=`${i},${a}`;n.add(h),s.push(t[a][i]),i+1<o&&!n.has(`${i+1},${a}`)&&$s(t[a][i],t[a][i+1])&&e(i+1,a),i-1>=0&&!n.has(`${i-1},${a}`)&&$s(t[a][i],t[a][i-1])&&e(i-1,a),a+1<r&&!n.has(`${i},${a+1}`)&&$s(t[a][i],t[a+1][i])&&e(i,a+1),a-1>=0&&!n.has(`${i},${a-1}`)&&$s(t[a][i],t[a-1][i])&&e(i,a-1)}(0,0),s}(this.pipes);this.pipes.forEach((e=>{e.forEach((e=>{const i=this.sprites.getAt(e.x+e.y*this.pipes[0].length);i&&(i.setAngle(e.rotation),t.includes(e)?(i.setTint(3364249),e.x===this.pipes[0].length-1&&e.y===this.pipes.length-1&&this.parent.close(!0)):i.setTint(16777215))}))}))}}class Ys extends i.Scene{constructor(){super("PipesDialog"),e(this,"player"),e(this,"container"),e(this,"arrow"),e(this,"keys")}init(t){this.player=t.player}create(){var t,e;this.container=this.add.container(a.width/2,a.height/2),this.container.add(this.add.rectangle(0,0,.95*a.width,.95*a.height,0,.9).setStrokeStyle(4,c(l.Tan))),this.container.add(new ot(this,.44*a.width,-.4*a.height,"X",(()=>this.close(!1)))),this.container.add(this.add.text(0,-.4*a.height,"Rotate the pipes to fix the alchemy equipment",{...d,fontSize:48}).setOrigin(.5)),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.close(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.close(!1)})),new Os(this,!0).setVisible(this.player.scene.gamepad.visible),this.keys=new C(this),this.scene.launch("Pipes",{parent:this})}close(t){this.scene.stop(),this.scene.stop("Pipes"),this.scene.resume("Game"),t?(N(S.Forest,this.player),this.player.journal.addEntry(A.ForestMazeSolved)):this.player.setPosition(G[S.TownEast].x-40,G[S.TownEast].y)}}class Qs extends i.Scene{constructor(){super("Preloader")}init(){const t=this.add.rectangle(a.width/2,a.height/2,.75*a.width,32).setStrokeStyle(1,16777215),e=this.add.rectangle(4+t.x-t.width/2,a.height/2,4,27,16777215);this.load.on("progress",(t=>{e.width=.75*a.width*t-5}))}preload(){this.load.setPath("assets"),this.load.svg("sun","icons/sun.svg",{width:64,height:64}),this.load.svg("moon","icons/moon.svg",{width:64,height:64}),this.load.svg("settings","icons/settings.svg",{width:64,height:64}),this.load.svg("zoom-in","icons/zoom-in.svg",{width:64,height:64}),this.load.svg("zoom-out","icons/zoom-out.svg",{width:64,height:64}),this.load.image("town","maps/town.jpg"),this.load.image("clock_outside","maps/clock_outside.jpg"),this.load.image("clock_inner","maps/clock_inner.jpg"),this.load.image("forest","maps/forest.jpg"),this.load.image("lake","maps/lake.jpg"),this.load.image("ladder","ladder.png"),this.load.image("warp","warp.png"),this.load.image("watch","watch.png"),this.load.image("arrow","arrow.png"),this.load.image("gear","items/gear.png"),this.load.image("journal","items/journal.png"),this.load.image("wrench","items/wrench.png"),this.load.spritesheet("character","characters/player.png",{frameWidth:128,frameHeight:80}),this.load.image("player_portrait","characters/player_portrait.png"),this.load.image("inventor","characters/inventor.png"),this.load.image("inventor_portrait","characters/inventor_portrait.png"),this.load.image("stranger","characters/stranger.png"),this.load.image("stranger_portrait","characters/stranger_portrait.png"),this.load.image("sphinx","characters/sphinx.png"),this.load.image("sphinx_portrait","characters/sphinx_portrait.png"),this.load.image("mayor","characters/mayor.png"),this.load.image("mayor_portrait","characters/mayor_portrait.png"),this.load.image("clock_portrait","characters/clock_portrait.png")}create(){this.scene.start("Game")}}const Js={type:Phaser.AUTO,width:a.width,height:a.height,parent:"game-container",backgroundColor:1118481,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[h,Qs,As,zs,Es,Ws,Us,Ys,Ks],input:{gamepad:!0},physics:{default:"arcade"},render:{pixelArt:!0,antialias:!1}};("m6x11","assets/m6x11.ttf",new FontFace("m6x11","url(assets/m6x11.ttf)").load().then((function(t){document.fonts.add(t)})).catch((function(t){return t}))).then((()=>{new i.Game(Js)}));
