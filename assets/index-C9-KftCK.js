var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);import{r as i,g as s,c as n,a as r}from"./phaser-Bn4WE32K.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const o={};var a=i();const l={width:1280,height:720},h={width:960,height:540};let c=!1,u=!1,d=!1;d=!0;let p=!0;const g=localStorage.getItem("chrono-sleuth-prod");let y;null!==g&&(p="true"===g);let f=p;f=!0;let m=!1;p&&(m=!1);const{width:b,height:v}=h;p&&(c=!1,d=!1,p=!0,y=void 0,u=!1);const w={debug:c,phaserInspector:u,prod:p,bootDialog:y,useShader:!0,width:b,height:v,cameraOffset:v/4,zoomed:!0,dayMinutes:.25,rewindEnabled:!1,fastMode:d,perfTest:m};var x=(t=>(t[t.None=0]="None",t[t.Teleported=1]="Teleported",t[t.Talked=2]="Talked",t[t.Item=3]="Item",t[t.Prop=4]="Prop",t))(x||{}),S=(t=>(t[t.Station=0]="Station",t[t.Town=1]="Town",t[t.TownEast=2]="TownEast",t[t.Forest=3]="Forest",t[t.ForestEast=4]="ForestEast",t[t.Lake=5]="Lake",t[t.TownNorth=6]="TownNorth",t[t.ClockSquare=7]="ClockSquare",t[t.ClockSquareNorth=8]="ClockSquareNorth",t[t.ClockEntrance=9]="ClockEntrance",t[t.ClockStairs=10]="ClockStairs",t[t.ClockTop=11]="ClockTop",t[t.TownWest=12]="TownWest",t[t.MansionGrounds=13]="MansionGrounds",t[t.MansionEntrance=14]="MansionEntrance",t[t.Mansion=15]="Mansion",t[t.LabHatch=16]="LabHatch",t[t.Lab=17]="Lab",t[t.LibraryEntrance=18]="LibraryEntrance",t[t.Library=19]="Library",t[t.InnEntrance=20]="InnEntrance",t[t.Inn=21]="Inn",t))(S||{}),k=(t=>(t[t.Wrench=0]="Wrench",t[t.Gear1=1]="Gear1",t[t.Key=2]="Key",t[t.HerbRed=3]="HerbRed",t[t.HerbGreen=4]="HerbGreen",t[t.HerbBlue=5]="HerbBlue",t[t.Potion=6]="Potion",t[t.Gear2=7]="Gear2",t))(k||{}),T=(t=>(t[t.ForestGear=0]="ForestGear",t[t.SphinxRiddle=1]="SphinxRiddle",t[t.InvestigateTownWest=2]="InvestigateTownWest",t[t.ExploreLab=3]="ExploreLab",t[t.FindPotionIngredients=4]="FindPotionIngredients",t))(T||{}),P=(t=>(t[t.Inventor=0]="Inventor",t[t.Stranger=1]="Stranger",t[t.Sphinx=2]="Sphinx",t[t.Mayor=3]="Mayor",t[t.Innkeeper=4]="Innkeeper",t[t.Baker=5]="Baker",t))(P||{}),O=(t=>(t[t.Sphinx=0]="Sphinx",t))(O||{}),C=(t=>(t[t.FixTheClock=0]="FixTheClock",t[t.MetTheMayor=1]="MetTheMayor",t[t.ClockFirstGear=2]="ClockFirstGear",t[t.AlchemyLabFound=3]="AlchemyLabFound",t[t.AlchemySetFixed=4]="AlchemySetFixed",t[t.ExtraPotionInformation=5]="ExtraPotionInformation",t[t.SafeDiscovered=6]="SafeDiscovered",t[t.ClockSecondGear=7]="ClockSecondGear",t))(C||{}),E=(t=>(t[t.ClockTower=0]="ClockTower",t[t.Chest=1]="Chest",t[t.LabHatch=2]="LabHatch",t[t.LabBook=3]="LabBook",t[t.AlchemySet=4]="AlchemySet",t[t.LabBookshelf1=5]="LabBookshelf1",t[t.LabBookshelf2=6]="LabBookshelf2",t[t.LabBookshelf3=7]="LabBookshelf3",t[t.LabPotionShelf1=8]="LabPotionShelf1",t[t.MansionPicture=9]="MansionPicture",t[t.MansionHole=10]="MansionHole",t[t.Bed=11]="Bed",t))(E||{}),I=(t=>(t[t.LabStairs=0]="LabStairs",t[t.InnStairs=1]="InnStairs",t))(I||{}),A=(t=>(t.Town="Town",t.Station="Train Station",t.ClockOutside="Clock Tower Square",t.ClockInner="Clock Tower",t.Forest="Strange Woods",t.Lake="Lake Epoch",t.MansionOutside="Mansion Grounds",t.MansionInside="Mansion",t.AlchemyLab="Secret Alchemy Lab",t.Library="Library",t.Inn="Inn",t))(A||{}),M=(t=>(t.Intro="music-intro",t.Station="music-station",t.Town="music-town",t.Mansion="music-mansion",t.Forest="music-forest",t.Clock="music-clock",t))(M||{}),R=(t=>(t[t.Library=0]="Library",t[t.Inn=1]="Inn",t[t.Train=2]="Train",t))(R||{});const j={[M.Intro]:{locations:[],volume:.4},[M.Station]:{locations:[A.Station],volume:.5},[M.Town]:{locations:[A.Town,A.Library,A.Inn],volume:.5},[M.Clock]:{locations:[A.ClockInner,A.ClockOutside],volume:.5},[M.Forest]:{locations:[A.Forest,A.Lake],volume:.5},[M.Mansion]:{locations:[A.MansionInside,A.MansionOutside,A.AlchemyLab],volume:.5}},L={[M.Station]:"sounds/music/Unknown.mp3",[M.Clock]:"sounds/music/Night Time Scavenge II.mp3",[M.Mansion]:"sounds/music/Reflective District.mp3",[M.Forest]:"sounds/music/Serene.mp3",[M.Intro]:"sounds/music/A New Day's Hurry.mp3",[M.Town]:"sounds/music/A Different Kind Of Journey.mp3"};let _;class F{constructor(t){e(this,"sound"),e(this,"music"),e(this,"volume",.5),e(this,"scene"),this.sound=t,t.on("mute",((t,e)=>{this.music&&(e?z(this.scene,this.music):D(this.scene,this.music,this.volume))})),t.once("unlocked",(()=>{this.music&&!this.music.isPlaying&&D(this.scene,this.music,this.volume)}))}start(t,e){var i,s;this.sound.mute||this.sound.locked||(null==(i=this.music)?void 0:i.key)===t&&(null==(s=this.music)?void 0:s.isPlaying)||this.scene.load.isLoading()||(this.stop(),this.volume=e||j[t].volume||.5,this.scene.cache.audio.exists(t)&&(this.music=this.sound.get(t)||this.sound.add(t,{loop:!0,volume:this.volume}),D(this.scene,this.music,this.volume)))}stop(){this.music&&z(this.scene,this.music),this.music=void 0}setScene(t){this.scene=t,this.scene.load.setPath("assets")}getLocationMusic(t){const e=Object.entries(j).find((([e,i])=>i.locations.includes(t)));if(e)return e[0]}fadeMusic(t,e=500,i){this.music&&this.scene.tweens.add({targets:this.music,volume:t,duration:e,onComplete:i})}}function D(t,e,i=.5,s=500){t&&e&&!e.pendingRemove&&(e.play({volume:0,loop:!0}),t.tweens.getTweensOf(e).forEach((t=>t.stop())),t.tweens.add({targets:e,volume:i,duration:s}))}function z(t,e,i=500){t&&e.isPlaying?(t.tweens.getTweensOf(e).forEach((t=>t.stop())),t.tweens.add({targets:e,volume:0,duration:i,onComplete:()=>e.stop()})):e.stop()}const B="fcfee9",W="e6c99d",N="303646",G="1c1831",H="993333",U="339933",$="ffccaa",V="335588",X="111111",q="ddaaee";function Y(t){return a.Display.Color.HexStringToColor(t).color}function K(t){return Y(a.Display.Color.RGBToString(255*t.r,255*t.g,255*t.b))}function Q(t){const e=a.Display.Color.ColorToRGBA(t);return new a.Display.Color(e.r,e.g,e.b,e.a)}function J(t,e,i,s,n){const r=.3*(n.duration||100);return t.tweens.addCounter({from:0,to:r,onUpdate:t=>{const n=a.Display.Color.Interpolate.ColorWithColor(e,i,r,t.getValue());var o;s((o=n,Y(a.Display.Color.RGBToString(o.r,o.g,o.b))))},...n})}const Z=1200;let tt=!1;function et(t){return K(t.lights.ambientColor)===Y(V)}function it(t,e=!0){tt||(st(t,B,e),e?t.time.delayedCall(Z,(()=>nt(t,.5))):nt(t,.5),t.lights.lights.forEach((i=>{const s=i.intensity;e?t.tweens.add({targets:i,duration:Z,intensity:0,onComplete:()=>{i.setVisible(!1),i.setIntensity(s)}}):i.setVisible(!1)})))}function st(t,e,i){if(!i)return void t.lights.setAmbientColor(Y(e));tt=!0;const s=K(t.lights.ambientColor),n=a.Display.Color.ValueToColor(s),r=a.Display.Color.ValueToColor(e);J(t,n,r,(e=>t.lights.setAmbientColor(e)),{duration:Z,onComplete:()=>{tt=!1}})}function nt(t,e){t.children.getAll("name","DebugLightGraphics").forEach((t=>t.setAlpha(e)))}var rt,ot,at,lt,ht,ct,ut,dt,pt,gt,yt,ft,mt,bt,vt,wt,xt,St,kt,Tt,Pt,Ot,Ct,Et,It,At,Mt,Rt,jt,Lt,_t,Ft,Dt,zt,Bt,Wt,Nt,Gt,Ht,Ut,$t,Vt,Xt,qt;function Yt(){if(ot)return rt;ot=1;var t=Object.prototype.toString;return rt=function(e){var i=t.call(e),s="[object Arguments]"===i;return s||(s="[object Array]"!==i&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),s}}function Kt(){if(ct)return ht;ct=1;var t=Array.prototype.slice,e=Yt(),i=Object.keys,s=i?function(t){return i(t)}:function(){if(lt)return at;var t;if(lt=1,!Object.keys){var e=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=Yt(),n=Object.prototype.propertyIsEnumerable,r=!n.call({toString:null},"toString"),o=n.call((function(){}),"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var e=t.constructor;return e&&e.prototype===t},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!h["$"+t]&&e.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(i){return!0}}catch(i){return!0}return!1}();t=function(t){var n=null!==t&&"object"==typeof t,h="[object Function]"===i.call(t),u=s(t),d=n&&"[object String]"===i.call(t),p=[];if(!n&&!h&&!u)throw new TypeError("Object.keys called on a non-object");var g=o&&h;if(d&&t.length>0&&!e.call(t,0))for(var y=0;y<t.length;++y)p.push(String(y));if(u&&t.length>0)for(var f=0;f<t.length;++f)p.push(String(f));else for(var m in t)g&&"prototype"===m||!e.call(t,m)||p.push(String(m));if(r)for(var b=function(t){if("undefined"==typeof window||!c)return l(t);try{return l(t)}catch(e){return!1}}(t),v=0;v<a.length;++v)b&&"constructor"===a[v]||!e.call(t,a[v])||p.push(a[v]);return p}}return at=t}(),n=Object.keys;return s.shim=function(){if(Object.keys){var i=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);i||(Object.keys=function(i){return e(i)?n(t.call(i)):n(i)})}else Object.keys=s;return Object.keys||s},ht=s}function Qt(){return dt?ut:(dt=1,ut=Error)}function Jt(){return gt?pt:(gt=1,pt=EvalError)}function Zt(){return ft?yt:(ft=1,yt=RangeError)}function te(){return bt?mt:(bt=1,mt=ReferenceError)}function ee(){return wt?vt:(wt=1,vt=SyntaxError)}function ie(){return St?xt:(St=1,xt=TypeError)}function se(){return Tt?kt:(Tt=1,kt=URIError)}function ne(){return Ot?Pt:(Ot=1,Pt=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var s=Object.getOwnPropertySymbols(t);if(1!==s.length||s[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0})}function re(){if(Et)return Ct;Et=1;var t="undefined"!=typeof Symbol&&Symbol,e=ne();return Ct=function(){return"function"==typeof t&&"function"==typeof Symbol&&"symbol"==typeof t("foo")&&"symbol"==typeof Symbol("bar")&&e()}}function oe(){if(At)return It;At=1;var t={__proto__:null,foo:{}},e=Object;return It=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof e)}}function ae(){if(Lt)return jt;Lt=1;var t=function(){if(Rt)return Mt;Rt=1;var t=Object.prototype.toString,e=Math.max,i=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i};return Mt=function(s){var n=this;if("function"!=typeof n||"[object Function]"!==t.apply(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var r,o=function(t){for(var e=[],i=1,s=0;i<t.length;i+=1,s+=1)e[s]=t[i];return e}(arguments),a=e(0,n.length-o.length),l=[],h=0;h<a;h++)l[h]="$"+h;if(r=Function("binder","return function ("+function(t){for(var e="",i=0;i<t.length;i+=1)e+=t[i],i+1<t.length&&(e+=",");return e}(l)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof r){var t=n.apply(this,i(o,arguments));return Object(t)===t?t:this}return n.apply(s,i(o,arguments))})),n.prototype){var c=function(){};c.prototype=n.prototype,r.prototype=new c,c.prototype=null}return r},Mt}();return jt=Function.prototype.bind||t}function le(){if(Ft)return _t;Ft=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,i=ae();return _t=i.call(t,e)}function he(){if(zt)return Dt;var t;zt=1;var e=Qt(),i=Jt(),s=Zt(),n=te(),r=ee(),o=ie(),a=se(),l=Function,h=function(t){try{return l('"use strict"; return ('+t+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(R){c=null}var u=function(){throw new o},d=c?function(){try{return u}catch(t){try{return c(arguments,"callee").get}catch(e){return u}}}():u,p=re()(),g=oe()(),y=Object.getPrototypeOf||(g?function(t){return t.__proto__}:null),f={},m="undefined"!=typeof Uint8Array&&y?y(Uint8Array):t,b={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?t:ArrayBuffer,"%ArrayIteratorPrototype%":p&&y?y([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?t:Atomics,"%BigInt%":"undefined"==typeof BigInt?t:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?t:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":i,"%Float32Array%":"undefined"==typeof Float32Array?t:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?t:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?t:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?t:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?t:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":p&&y?y(y([][Symbol.iterator]())):t,"%JSON%":"object"==typeof JSON?JSON:t,"%Map%":"undefined"==typeof Map?t:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&p&&y?y((new Map)[Symbol.iterator]()):t,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?t:Promise,"%Proxy%":"undefined"==typeof Proxy?t:Proxy,"%RangeError%":s,"%ReferenceError%":n,"%Reflect%":"undefined"==typeof Reflect?t:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?t:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&p&&y?y((new Set)[Symbol.iterator]()):t,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":p&&y?y(""[Symbol.iterator]()):t,"%Symbol%":p?Symbol:t,"%SyntaxError%":r,"%ThrowTypeError%":d,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?t:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?t:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?t:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?t:Uint32Array,"%URIError%":a,"%WeakMap%":"undefined"==typeof WeakMap?t:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?t:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?t:WeakSet};if(y)try{null.error}catch(R){var v=y(y(R));b["%Error.prototype%"]=v}var w=function t(e){var i;if("%AsyncFunction%"===e)i=h("async function () {}");else if("%GeneratorFunction%"===e)i=h("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=h("async function* () {}");else if("%AsyncGenerator%"===e){var s=t("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&y&&(i=y(n.prototype))}return b[e]=i,i},x={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=ae(),k=le(),T=S.call(Function.call,Array.prototype.concat),P=S.call(Function.apply,Array.prototype.splice),O=S.call(Function.call,String.prototype.replace),C=S.call(Function.call,String.prototype.slice),E=S.call(Function.call,RegExp.prototype.exec),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,M=function(t,e){var i,s=t;if(k(x,s)&&(s="%"+(i=x[s])[0]+"%"),k(b,s)){var n=b[s];if(n===f&&(n=w(s)),void 0===n&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:n}}throw new r("intrinsic "+t+" does not exist!")};return Dt=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===E(/^%?[^%]*%?$/,t))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=C(t,0,1),i=C(t,-1);if("%"===e&&"%"!==i)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new r("invalid intrinsic syntax, expected opening `%`");var s=[];return O(t,I,(function(t,e,i,n){s[s.length]=i?O(n,A,"$1"):e||t})),s}(t),s=i.length>0?i[0]:"",n=M("%"+s+"%",e),a=n.name,l=n.value,h=!1,u=n.alias;u&&(s=u[0],P(i,T([0,1],u)));for(var d=1,p=!0;d<i.length;d+=1){var g=i[d],y=C(g,0,1),f=C(g,-1);if(('"'===y||"'"===y||"`"===y||'"'===f||"'"===f||"`"===f)&&y!==f)throw new r("property names with quotes must have matching quotes");if("constructor"!==g&&p||(h=!0),k(b,a="%"+(s+="."+g)+"%"))l=b[a];else if(null!=l){if(!(g in l)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(c&&d+1>=i.length){var m=c(l,g);l=(p=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:l[g]}else p=k(l,g),l=l[g];p&&!h&&(b[a]=l)}}return l},Dt}function ce(){if(Wt)return Bt;Wt=1;var t=he()("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}return Bt=t}function ue(){if(Gt)return Nt;Gt=1;var t=he()("%Object.getOwnPropertyDescriptor%",!0);if(t)try{t([],"length")}catch(e){t=null}return Nt=t}function de(){if(Ut)return Ht;Ut=1;var t=ce(),e=ee(),i=ie(),s=ue();return Ht=function(n,r,o){if(!n||"object"!=typeof n&&"function"!=typeof n)throw new i("`obj` must be an object or a function`");if("string"!=typeof r&&"symbol"!=typeof r)throw new i("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new i("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new i("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new i("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new i("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,c=arguments.length>6&&arguments[6],u=!!s&&s(n,r);if(t)t(n,r,{configurable:null===h&&u?u.configurable:!h,enumerable:null===a&&u?u.enumerable:!a,value:o,writable:null===l&&u?u.writable:!l});else{if(!c&&(a||l||h))throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");n[r]=o}},Ht}function pe(){if(Vt)return $t;Vt=1;var t=ce(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return 1!==t([],"length",{value:1}).length}catch(e){return!0}},$t=e}function ge(){if(qt)return Xt;qt=1;var t=Kt(),e="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),i=Object.prototype.toString,s=Array.prototype.concat,n=de(),r=pe()(),o=function(t,e,s,o){if(e in t)if(!0===o){if(t[e]===s)return}else if("function"!=typeof(a=o)||"[object Function]"!==i.call(a)||!o())return;var a;r?n(t,e,s,!0):n(t,e,s)},a=function(i,n){var r=arguments.length>2?arguments[2]:{},a=t(n);e&&(a=s.call(a,Object.getOwnPropertySymbols(n)));for(var l=0;l<a.length;l+=1)o(i,a[l],n[a[l]],r[a[l]])};return a.supportsDescriptors=!!r,Xt=a}var ye,fe,me,be,ve,we,xe,Se,ke,Te,Pe,Oe,Ce,Ee,Ie,Ae,Me,Re,je,Le,_e,Fe,De,ze,Be,We={exports:{}};function Ne(){if(fe)return ye;fe=1;var t=he(),e=de(),i=pe()(),s=ue(),n=ie(),r=t("%Math.floor%");return ye=function(t,o){if("function"!=typeof t)throw new n("`fn` is not a function");if("number"!=typeof o||o<0||o>4294967295||r(o)!==o)throw new n("`length` must be a positive 32-bit integer");var a=arguments.length>2&&!!arguments[2],l=!0,h=!0;if("length"in t&&s){var c=s(t,"length");c&&!c.configurable&&(l=!1),c&&!c.writable&&(h=!1)}return(l||h||!a)&&(i?e(t,"length",o,!0,!0):e(t,"length",o)),t},ye}function Ge(){return me||(me=1,function(t){var e=ae(),i=he(),s=Ne(),n=ie(),r=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||e.call(o,r),l=ce(),h=i("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new n("a function is required");var i=a(e,o,arguments);return s(i,1+h(0,t.length-(arguments.length-1)),!0)};var c=function(){return a(e,r,arguments)};l?l(t.exports,"apply",{value:c}):t.exports.apply=c}(We)),We.exports}function He(){if(ve)return be;ve=1;var t=he(),e=Ge(),i=e(t("String.prototype.indexOf"));return be=function(s,n){var r=t(s,!!n);return"function"==typeof r&&i(s,".prototype.")>-1?e(r):r}}function Ue(){if(xe)return we;xe=1;var t=Kt(),e=ne()(),i=He(),s=Object,n=i("Array.prototype.push"),r=i("Object.prototype.propertyIsEnumerable"),o=e?Object.getOwnPropertySymbols:null;return we=function(i,a){if(null==i)throw new TypeError("target must be an object");var l=s(i);if(1===arguments.length)return l;for(var h=1;h<arguments.length;++h){var c=s(arguments[h]),u=t(c),d=e&&(Object.getOwnPropertySymbols||o);if(d)for(var p=d(c),g=0;g<p.length;++g){var y=p[g];r(c,y)&&n(u,y)}for(var f=0;f<u.length;++f){var m=u[f];if(r(c,m)){var b=c[m];l[m]=b}}}return l},we}function $e(){if(ke)return Se;ke=1;var t=Ue();return Se=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},s=0;s<e.length;++s)i[e[s]]=e[s];var n=Object.assign({},i),r="";for(var o in n)r+=o;return t!==r}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}return!1}()?t:Object.assign:t}}function Ve(){if(je)return Re;je=1;var t=function(){if(Me)return Ae;Me=1;var t=de(),e=pe()(),i=function(){if(Ie)return Ee;Ie=1;var t=function(){return"string"==typeof function(){}.name},e=Object.getOwnPropertyDescriptor;if(e)try{e([],"length")}catch(s){e=null}t.functionsHaveConfigurableNames=function(){if(!t()||!e)return!1;var i=e((function(){}),"name");return!!i&&!!i.configurable};var i=Function.prototype.bind;return t.boundFunctionsHaveNames=function(){return t()&&"function"==typeof i&&""!==function(){}.bind().name},Ee=t}().functionsHaveConfigurableNames(),s=ie();return Ae=function(n,r){if("function"!=typeof n)throw new s("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!i||(e?t(n,"name",r,!0,!0):t(n,"name",r)),n},Ae}(),e=ie(),i=Object;return Re=t((function(){if(null==this||this!==i(this))throw new e("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0)}function Xe(){if(_e)return Le;_e=1;var t=Ve(),e=ge().supportsDescriptors,i=Object.getOwnPropertyDescriptor;return Le=function(){if(e&&"gim"===/a/gim.flags){var s=i(RegExp.prototype,"flags");if(s&&"function"==typeof s.get&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var n="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(r,"sticky",{get:function(){n+="y"}}),s.get.call(r),"dy"===n)return s.get}}return t}}var qe,Ye,Ke,Qe,Je={exports:{}};function Ze(){if(Ye)return qe;Ye=1;var t=ne();return qe=function(){return t()&&!!Symbol.toStringTag}}function ti(){if(Qe)return Ke;Qe=1;var t=Ze()(),e=He()("Object.prototype.toString"),i=function(i){return!(t&&i&&"object"==typeof i&&Symbol.toStringTag in i)&&"[object Arguments]"===e(i)},s=function(t){return!!i(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==e(t)&&"[object Function]"===e(t.callee)},n=function(){return i(arguments)}();return i.isLegacyArguments=s,Ke=n?i:s}const ei=s(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var ii,si,ni,ri,oi,ai,li,hi,ci,ui,di,pi,gi,yi,fi,mi,bi,vi,wi,xi,Si,ki,Ti,Pi,Oi,Ci,Ei,Ii,Ai,Mi,Ri,ji,Li,_i,Fi,Di,zi;function Bi(){if(si)return ii;si=1;var t="function"==typeof Map&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=t&&e&&"function"==typeof e.get?e.get:null,s=t&&Map.prototype.forEach,r="function"==typeof Set&&Set.prototype,o=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=r&&o&&"function"==typeof o.get?o.get:null,l=r&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,c="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,u="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,d=Boolean.prototype.valueOf,p=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,f=String.prototype.slice,m=String.prototype.replace,b=String.prototype.toUpperCase,v=String.prototype.toLowerCase,w=RegExp.prototype.test,x=Array.prototype.concat,S=Array.prototype.join,k=Array.prototype.slice,T=Math.floor,P="function"==typeof BigInt?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,E="function"==typeof Symbol&&"object"==typeof Symbol.iterator,I="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,A=Object.prototype.propertyIsEnumerable,M=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function R(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||w.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var s=t<0?-T(-t):T(t);if(s!==t){var n=String(s),r=f.call(e,n.length+1);return m.call(n,i,"$&_")+"."+m.call(m.call(r,/([0-9]{3})/g,"$&_"),/_$/,"")}}return m.call(e,i,"$&_")}var j=ei,L=j.custom,_=G(L)?L:null,F={__proto__:null,double:'"',single:"'"},D={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function z(t,e,i){var s=i.quoteStyle||e,n=F[s];return n+t+n}function B(t){return m.call(String(t),/"/g,"&quot;")}function W(t){return!("[object Array]"!==$(t)||I&&"object"==typeof t&&I in t)}function N(t){return!("[object RegExp]"!==$(t)||I&&"object"==typeof t&&I in t)}function G(t){if(E)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(e){}return!1}ii=function t(e,r,o,p){var b=r||{};if(U(b,"quoteStyle")&&!U(F,b.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(U(b,"maxStringLength")&&("number"==typeof b.maxStringLength?b.maxStringLength<0&&b.maxStringLength!==1/0:null!==b.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var w=!U(b,"customInspect")||b.customInspect;if("boolean"!=typeof w&&"symbol"!==w)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(U(b,"indent")&&null!==b.indent&&"\t"!==b.indent&&!(parseInt(b.indent,10)===b.indent&&b.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(U(b,"numericSeparator")&&"boolean"!=typeof b.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var T=b.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return X(e,b);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var O=String(e);return T?R(e,O):O}if("bigint"==typeof e){var L=String(e)+"n";return T?R(e,L):L}var D=void 0===b.depth?5:b.depth;if(void 0===o&&(o=0),o>=D&&D>0&&"object"==typeof e)return W(e)?"[Array]":"[Object]";var H,q=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=S.call(Array(t.indent+1)," ")}return{base:i,prev:S.call(Array(e+1),i)}}(b,o);if(void 0===p)p=[];else if(V(p,e)>=0)return"[Circular]";function tt(e,i,s){if(i&&(p=k.call(p)).push(i),s){var n={depth:b.depth};return U(b,"quoteStyle")&&(n.quoteStyle=b.quoteStyle),t(e,n,o+1,p)}return t(e,b,o+1,p)}if("function"==typeof e&&!N(e)){var et=function(t){if(t.name)return t.name;var e=y.call(g.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),it=Z(e,tt);return"[Function"+(et?": "+et:" (anonymous)")+"]"+(it.length>0?" { "+S.call(it,", ")+" }":"")}if(G(e)){var st=E?m.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):C.call(e);return"object"!=typeof e||E?st:Y(st)}if((H=e)&&"object"==typeof H&&("undefined"!=typeof HTMLElement&&H instanceof HTMLElement||"string"==typeof H.nodeName&&"function"==typeof H.getAttribute)){for(var nt="<"+v.call(String(e.nodeName)),rt=e.attributes||[],ot=0;ot<rt.length;ot++)nt+=" "+rt[ot].name+"="+z(B(rt[ot].value),"double",b);return nt+=">",e.childNodes&&e.childNodes.length&&(nt+="..."),nt+"</"+v.call(String(e.nodeName))+">"}if(W(e)){if(0===e.length)return"[]";var at=Z(e,tt);return q&&!function(t){for(var e=0;e<t.length;e++)if(V(t[e],"\n")>=0)return!1;return!0}(at)?"["+J(at,q)+"]":"[ "+S.call(at,", ")+" ]"}if(function(t){return!("[object Error]"!==$(t)||I&&"object"==typeof t&&I in t)}(e)){var lt=Z(e,tt);return"cause"in Error.prototype||!("cause"in e)||A.call(e,"cause")?0===lt.length?"["+String(e)+"]":"{ ["+String(e)+"] "+S.call(lt,", ")+" }":"{ ["+String(e)+"] "+S.call(x.call("[cause]: "+tt(e.cause),lt),", ")+" }"}if("object"==typeof e&&w){if(_&&"function"==typeof e[_]&&j)return j(e,{depth:D-o});if("symbol"!==w&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!i||!t||"object"!=typeof t)return!1;try{i.call(t);try{a.call(t)}catch(nt){return!0}return t instanceof Map}catch(e){}return!1}(e)){var ht=[];return s&&s.call(e,(function(t,i){ht.push(tt(i,e,!0)+" => "+tt(t,e))})),Q("Map",i.call(e),ht,q)}if(function(t){if(!a||!t||"object"!=typeof t)return!1;try{a.call(t);try{i.call(t)}catch(e){return!0}return t instanceof Set}catch(s){}return!1}(e)){var ct=[];return l&&l.call(e,(function(t){ct.push(tt(t,e))})),Q("Set",a.call(e),ct,q)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t,h);try{c.call(t,c)}catch(nt){return!0}return t instanceof WeakMap}catch(e){}return!1}(e))return K("WeakMap");if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t,c);try{h.call(t,h)}catch(nt){return!0}return t instanceof WeakSet}catch(e){}return!1}(e))return K("WeakSet");if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{return u.call(t),!0}catch(e){}return!1}(e))return K("WeakRef");if(function(t){return!("[object Number]"!==$(t)||I&&"object"==typeof t&&I in t)}(e))return Y(tt(Number(e)));if(function(t){if(!t||"object"!=typeof t||!P)return!1;try{return P.call(t),!0}catch(e){}return!1}(e))return Y(tt(P.call(e)));if(function(t){return!("[object Boolean]"!==$(t)||I&&"object"==typeof t&&I in t)}(e))return Y(d.call(e));if(function(t){return!("[object String]"!==$(t)||I&&"object"==typeof t&&I in t)}(e))return Y(tt(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==n&&e===n)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==$(t)||I&&"object"==typeof t&&I in t)}(e)&&!N(e)){var ut=Z(e,tt),dt=M?M(e)===Object.prototype:e instanceof Object||e.constructor===Object,pt=e instanceof Object?"":"null prototype",gt=!dt&&I&&Object(e)===e&&I in e?f.call($(e),8,-1):pt?"Object":"",yt=(dt||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(gt||pt?"["+S.call(x.call([],gt||[],pt||[]),": ")+"] ":"");return 0===ut.length?yt+"{}":q?yt+"{"+J(ut,q)+"}":yt+"{ "+S.call(ut,", ")+" }"}return String(e)};var H=Object.prototype.hasOwnProperty||function(t){return t in this};function U(t,e){return H.call(t,e)}function $(t){return p.call(t)}function V(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,s=t.length;i<s;i++)if(t[i]===e)return i;return-1}function X(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,s="... "+i+" more character"+(i>1?"s":"");return X(f.call(t,0,e.maxStringLength),e)+s}var n=D[e.quoteStyle||"single"];return n.lastIndex=0,z(m.call(m.call(t,n,"\\$1"),/[\x00-\x1f]/g,q),"single",e)}function q(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+b.call(e.toString(16))}function Y(t){return"Object("+t+")"}function K(t){return t+" { ? }"}function Q(t,e,i,s){return t+" ("+e+") {"+(s?J(i,s):S.call(i,", "))+"}"}function J(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+S.call(t,","+i)+"\n"+e.prev}function Z(t,e){var i=W(t),s=[];if(i){s.length=t.length;for(var n=0;n<t.length;n++)s[n]=U(t,n)?e(t[n],t):""}var r,o="function"==typeof O?O(t):[];if(E){r={};for(var a=0;a<o.length;a++)r["$"+o[a]]=o[a]}for(var l in t)U(t,l)&&(i&&String(Number(l))===l&&l<t.length||E&&r["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?s.push(e(l,t)+": "+e(t[l],t)):s.push(l+": "+e(t[l],t))));if("function"==typeof O)for(var h=0;h<o.length;h++)A.call(t,o[h])&&s.push("["+e(o[h])+"]: "+e(t[o[h]],t));return s}return ii}function Wi(){if(ri)return ni;ri=1;var t=he(),e=He(),i=Bi(),s=ie(),n=t("%WeakMap%",!0),r=t("%Map%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),l=e("WeakMap.prototype.has",!0),h=e("Map.prototype.get",!0),c=e("Map.prototype.set",!0),u=e("Map.prototype.has",!0),d=function(t,e){for(var i,s=t;null!==(i=s.next);s=i)if(i.key===e)return s.next=i.next,i.next=t.next,t.next=i,i};return ni=function(){var t,e,p,g={assert:function(t){if(!g.has(t))throw new s("Side channel does not contain "+i(t))},get:function(i){if(n&&i&&("object"==typeof i||"function"==typeof i)){if(t)return o(t,i)}else if(r){if(e)return h(e,i)}else if(p)return function(t,e){var i=d(t,e);return i&&i.value}(p,i)},has:function(i){if(n&&i&&("object"==typeof i||"function"==typeof i)){if(t)return l(t,i)}else if(r){if(e)return u(e,i)}else if(p)return function(t,e){return!!d(t,e)}(p,i);return!1},set:function(i,s){n&&i&&("object"==typeof i||"function"==typeof i)?(t||(t=new n),a(t,i,s)):r?(e||(e=new r),c(e,i,s)):(p||(p={key:{},next:null}),function(t,e,i){var s=d(t,e);s?s.value=i:t.next={key:e,next:t.next,value:i}}(p,i,s))}};return g}}function Ni(){if(ui)return ci;ui=1;var t={}.toString;return ci=Array.isArray||function(e){return"[object Array]"==t.call(e)}}function Gi(){if(pi)return di;pi=1;var t=String.prototype.valueOf,e=Object.prototype.toString,i=Ze()();return di=function(s){return"string"==typeof s||"object"==typeof s&&(i?function(e){try{return t.call(e),!0}catch(i){return!1}}(s):"[object String]"===e.call(s))}}function Hi(){if(yi)return gi;yi=1;var t,e="function"==typeof Map&&Map.prototype?Map:null,i="function"==typeof Set&&Set.prototype?Set:null;e||(t=function(t){return!1});var s=e?Map.prototype.has:null,n=i?Set.prototype.has:null;return t||s||(t=function(t){return!1}),gi=t||function(t){if(!t||"object"!=typeof t)return!1;try{if(s.call(t),n)try{n.call(t)}catch(i){return!0}return t instanceof e}catch(i){}return!1}}function Ui(){if(mi)return fi;mi=1;var t,e="function"==typeof Map&&Map.prototype?Map:null,i="function"==typeof Set&&Set.prototype?Set:null;i||(t=function(t){return!1});var s=e?Map.prototype.has:null,n=i?Set.prototype.has:null;return t||n||(t=function(t){return!1}),fi=t||function(t){if(!t||"object"!=typeof t)return!1;try{if(n.call(t),s)try{s.call(t)}catch(e){return!0}return t instanceof i}catch(e){}return!1}}function $i(){if(bi)return Je.exports;bi=1;var t=ti(),e=function(){if(hi)return li;hi=1;var t=function(){if(ai)return oi;ai=1;var t=le(),e=Wi()(),i=ie(),s={assert:function(t,n){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new i("`O` is not an object");if("string"!=typeof n)throw new i("`slot` must be a string");if(e.assert(t),!s.has(t,n))throw new i("`"+n+"` is not present on `O`")},get:function(t,s){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new i("`O` is not an object");if("string"!=typeof s)throw new i("`slot` must be a string");var n=e.get(t);return n&&n["$"+s]},has:function(s,n){if(!s||"object"!=typeof s&&"function"!=typeof s)throw new i("`O` is not an object");if("string"!=typeof n)throw new i("`slot` must be a string");var r=e.get(s);return!!r&&t(r,"$"+n)},set:function(t,s,n){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new i("`O` is not an object");if("string"!=typeof s)throw new i("`slot` must be a string");var r=e.get(t);r||(r={},e.set(t,r)),r["$"+s]=n}};return Object.freeze&&Object.freeze(s),oi=s}(),e=SyntaxError,i="object"==typeof StopIteration?StopIteration:null;return li=function(s){if(!i)throw new e("this environment lacks StopIteration");t.set(s,"[[Done]]",!1);var n={next:function(){var e=t.get(this,"[[Iterator]]"),s=t.get(e,"[[Done]]");try{return{done:s,value:s?void 0:e.next()}}catch(n){if(t.set(e,"[[Done]]",!0),n!==i)throw n;return{done:!0,value:void 0}}}};return t.set(n,"[[Iterator]]",s),n}}();if(re()()||ne()()){var i=Symbol.iterator;Je.exports=function(e){return null!=e&&void 0!==e[i]?e[i]():t(e)?Array.prototype[i].call(e):void 0}}else{var s=Ni(),n=Gi(),r=he(),o=r("%Map%",!0),a=r("%Set%",!0),l=He(),h=l("Array.prototype.push"),c=l("String.prototype.charCodeAt"),u=l("String.prototype.slice"),d=function(t){var e=0;return{next:function(){var i,s=e>=t.length;return s||(i=t[e],e+=1),{done:s,value:i}}}},p=function(e,i){if(s(e)||t(e))return d(e);if(n(e)){var r=0;return{next:function(){var t=function(t,e){if(e+1>=t.length)return e+1;var i=c(t,e);if(i<55296||i>56319)return e+1;var s=c(t,e+1);return s<56320||s>57343?e+1:e+2}(e,r),i=u(e,r,t);return r=t,{done:t>e.length,value:i}}}}return i&&void 0!==e["_es6-shim iterator_"]?e["_es6-shim iterator_"]():void 0};if(o||a){var g=Hi(),y=Ui(),f=l("Map.prototype.forEach",!0),m=l("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var b=l("Map.prototype.iterator",!0),v=l("Set.prototype.iterator",!0);var w=l("Map.prototype.@@iterator",!0)||l("Map.prototype._es6-shim iterator_",!0),x=l("Set.prototype.@@iterator",!0)||l("Set.prototype._es6-shim iterator_",!0);Je.exports=function(t){return function(t){if(g(t)){if(b)return e(b(t));if(w)return w(t);if(f){var i=[];return f(t,(function(t,e){h(i,[e,t])})),d(i)}}if(y(t)){if(v)return e(v(t));if(x)return x(t);if(m){var s=[];return m(t,(function(t){h(s,t)})),d(s)}}}(t)||p(t)}}else Je.exports=function(t){if(null!=t)return p(t,!0)}}return Je.exports}function Vi(){if(wi)return vi;wi=1;var t=function(t){return t!=t};return vi=function(e,i){return 0===e&&0===i?1/e==1/i:e===i||!(!t(e)||!t(i))}}function Xi(){if(Si)return xi;Si=1;var t=Vi();return xi=function(){return"function"==typeof Object.is?Object.is:t}}function qi(){if(Ei)return Ci;Ei=1;var t=Ge(),e=He(),i=he()("%ArrayBuffer%",!0),s=e("ArrayBuffer.prototype.byteLength",!0),n=e("Object.prototype.toString"),r=!!i&&!s&&new i(0).slice,o=!!r&&t(r);return Ci=s||o?function(t){if(!t||"object"!=typeof t)return!1;try{return s?s(t):o(t,0),!0}catch(e){return!1}}:i?function(t){return"[object ArrayBuffer]"===n(t)}:function(t){return!1}}function Yi(){if(Li)return ji;Li=1;var t=He()("SharedArrayBuffer.prototype.byteLength",!0);return ji=t?function(e){if(!e||"object"!=typeof e)return!1;try{return t(e),!0}catch(i){return!1}}:function(t){return!1}}var Ki,Qi={exports:{}};var Ji,Zi,ts,es,is,ss,ns,rs={exports:{}};var os,as,ls,hs,cs,us,ds,ps,gs,ys,fs,ms,bs,vs,ws,xs,Ss,ks={exports:{}};function Ts(){if(os)return ks.exports;os=1;var t=he(),e=He(),i=t("%WeakSet%",!0),s=e("WeakSet.prototype.has",!0);if(s){var n=e("WeakMap.prototype.has",!0);ks.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(s(t,s),n)try{n(t,n)}catch(e){return!0}return t instanceof i}catch(e){}return!1}}else ks.exports=function(t){return!1};return ks.exports}function Ps(){if(ls)return as;ls=1;var t=Hi(),e=Ui(),i=function(){if(ns)return ss;ns=1;var t,e="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,i="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;e||(t=function(t){return!1});var s=e?e.prototype.has:null,n=i?i.prototype.has:null;return t||s||(t=function(t){return!1}),ss=t||function(t){if(!t||"object"!=typeof t)return!1;try{if(s.call(t,s),n)try{n.call(t,n)}catch(i){return!0}return t instanceof e}catch(i){}return!1}}(),s=Ts();return as=function(n){if(n&&"object"==typeof n){if(t(n))return"Map";if(e(n))return"Set";if(i(n))return"WeakMap";if(s(n))return"WeakSet"}return!1}}function Os(){return gs?ps:(gs=1,ps=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"])}function Cs(){if(fs)return ys;fs=1;var t=Os(),e="undefined"==typeof globalThis?n:globalThis;return ys=function(){for(var i=[],s=0;s<t.length;s++)"function"==typeof e[t[s]]&&(i[i.length]=t[s]);return i}}function Es(){if(bs)return ms;bs=1;var t=function(){if(ds)return us;ds=1;var t=function(){if(cs)return hs;cs=1;var t,e,i=Function.prototype.toString,s="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof s&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw e}}),e={},s((function(){throw 42}),null,t)}catch(d){d!==e&&(s=null)}else s=null;var n=/^\s*class\b/,r=function(t){try{var e=i.call(t);return n.test(e)}catch(s){return!1}},o=function(t){try{return!r(t)&&(i.call(t),!0)}catch(e){return!1}},a=Object.prototype.toString,l="function"==typeof Symbol&&!!Symbol.toStringTag,h=!(0 in[,]),c=function(){return!1};if("object"==typeof document){var u=document.all;a.call(u)===a.call(document.all)&&(c=function(t){if((h||!t)&&(void 0===t||"object"==typeof t))try{var e=a.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(i){}return!1})}return hs=s?function(i){if(c(i))return!0;if(!i)return!1;if("function"!=typeof i&&"object"!=typeof i)return!1;try{s(i,null,t)}catch(n){if(n!==e)return!1}return!r(i)&&o(i)}:function(t){if(c(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(l)return o(t);if(r(t))return!1;var e=a.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&o(t)}}(),e=Object.prototype.toString,i=Object.prototype.hasOwnProperty;return us=function(s,n,r){if(!t(n))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=r),"[object Array]"===e.call(s)?function(t,e,s){for(var n=0,r=t.length;n<r;n++)i.call(t,n)&&(null==s?e(t[n],n,t):e.call(s,t[n],n,t))}(s,n,o):"string"==typeof s?function(t,e,i){for(var s=0,n=t.length;s<n;s++)null==i?e(t.charAt(s),s,t):e.call(i,t.charAt(s),s,t)}(s,n,o):function(t,e,s){for(var n in t)i.call(t,n)&&(null==s?e(t[n],n,t):e.call(s,t[n],n,t))}(s,n,o)},us}(),e=Cs(),i=Ge(),s=He(),r=ue(),o=s("Object.prototype.toString"),a=Ze()(),l="undefined"==typeof globalThis?n:globalThis,h=e(),c=s("String.prototype.slice"),u=Object.getPrototypeOf,d=s("Array.prototype.indexOf",!0)||function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return i;return-1},p={__proto__:null};return t(h,a&&r&&u?function(t){var e=new l[t];if(Symbol.toStringTag in e){var s=u(e),n=r(s,Symbol.toStringTag);if(!n){var o=u(s);n=r(o,Symbol.toStringTag)}p["$"+t]=i(n.get)}}:function(t){var e=new l[t],s=e.slice||e.set;s&&(p["$"+t]=i(s))}),ms=function(e){if(!e||"object"!=typeof e)return!1;if(!a){var i=c(o(e),8,-1);return d(h,i)>-1?i:"Object"===i&&function(e){var i=!1;return t(p,(function(t,s){if(!i)try{t(e),i=c(s,1)}catch(n){}})),i}(e)}return r?function(e){var i=!1;return t(p,(function(t,s){if(!i)try{"$"+t(e)===s&&(i=c(s,1))}catch(n){}})),i}(e):null}}function Is(){if(ws)return vs;ws=1;var t=He()("ArrayBuffer.prototype.byteLength",!0),e=qi();return vs=function(i){return e(i)?t?t(i):i.byteLength:NaN}}const As=r(function(){if(Ss)return xs;Ss=1;var t=function(){if(Ce)return Oe;Ce=1;var t=ge(),e=Ge(),i=Ue(),s=$e(),n=function(){if(Pe)return Te;Pe=1;var t=ge(),e=$e();return Te=function(){var i=e();return t(Object,{assign:i},{assign:function(){return Object.assign!==i}}),i}}(),r=e.apply(s()),o=function(t,e){return r(Object,arguments)};return t(o,{getPolyfill:s,implementation:i,shim:n}),Oe=o}(),e=He(),i=function(){if(Be)return ze;Be=1;var t=ge(),e=Ge(),i=Ve(),s=Xe(),n=function(){if(De)return Fe;De=1;var t=ge().supportsDescriptors,e=Xe(),i=Object.getOwnPropertyDescriptor,s=Object.defineProperty,n=TypeError,r=Object.getPrototypeOf,o=/a/;return Fe=function(){if(!t||!r)throw new n("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var a=e(),l=r(o),h=i(l,"flags");return h&&h.get===a||s(l,"flags",{configurable:!0,enumerable:!1,get:a}),a}}(),r=e(s());return t(r,{getPolyfill:s,implementation:i,shim:n}),ze=r}(),s=he(),n=$i(),r=Wi(),o=function(){if(Oi)return Pi;Oi=1;var t=ge(),e=Ge(),i=Vi(),s=Xi(),n=function(){if(Ti)return ki;Ti=1;var t=Xi(),e=ge();return ki=function(){var i=t();return e(Object,{is:i},{is:function(){return Object.is!==i}}),i}}(),r=e(s(),Object);return t(r,{getPolyfill:s,implementation:i,shim:n}),Pi=r}(),a=ti(),l=Ni(),h=qi(),c=function(){if(Ai)return Ii;Ai=1;var t=Date.prototype.getDay,e=Object.prototype.toString,i=Ze()();return Ii=function(s){return"object"==typeof s&&null!==s&&(i?function(e){try{return t.call(e),!0}catch(i){return!1}}(s):"[object Date]"===e.call(s))}}(),u=function(){if(Ri)return Mi;Ri=1;var t,e,i,s,n=He(),r=Ze()();if(r){t=n("Object.prototype.hasOwnProperty"),e=n("RegExp.prototype.exec"),i={};var o=function(){throw i};s={toString:o,valueOf:o},"symbol"==typeof Symbol.toPrimitive&&(s[Symbol.toPrimitive]=o)}var a=n("Object.prototype.toString"),l=Object.getOwnPropertyDescriptor;return Mi=r?function(n){if(!n||"object"!=typeof n)return!1;var r=l(n,"lastIndex");if(!r||!t(r,"value"))return!1;try{e(n,s)}catch(o){return o===i}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===a(t)}}(),d=Yi(),p=Kt(),g=function(){if(is)return es;is=1;var t=Gi(),e=function(){if(Fi)return _i;Fi=1;var t=Number.prototype.toString,e=Object.prototype.toString,i=Ze()();return _i=function(s){return"number"==typeof s||"object"==typeof s&&(i?function(e){try{return t.call(e),!0}catch(i){return!1}}(s):"[object Number]"===e.call(s))}}(),i=function(){if(zi)return Di;zi=1;var t=He(),e=t("Boolean.prototype.toString"),i=t("Object.prototype.toString"),s=Ze()();return Di=function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(s&&Symbol.toStringTag in t?function(t){try{return e(t),!0}catch(i){return!1}}(t):"[object Boolean]"===i(t))}}(),s=function(){if(Ki)return Qi.exports;Ki=1;var t=Object.prototype.toString;if(re()()){var e=Symbol.prototype.toString,i=/^Symbol\(.*\)$/;Qi.exports=function(s){if("symbol"==typeof s)return!0;if("[object Symbol]"!==t.call(s))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&i.test(e.call(t))}(s)}catch(n){return!1}}}else Qi.exports=function(t){return!1};return Qi.exports}(),n=function(){if(ts)return rs.exports;if(ts=1,function(){if(Zi)return Ji;Zi=1;var t="undefined"!=typeof BigInt&&BigInt;return Ji=function(){return"function"==typeof t&&"function"==typeof BigInt&&"bigint"==typeof t(42)&&"bigint"==typeof BigInt(42)}}()()){var t=BigInt.prototype.valueOf;rs.exports=function(e){return null!=e&&"boolean"!=typeof e&&"string"!=typeof e&&"number"!=typeof e&&"symbol"!=typeof e&&"function"!=typeof e&&("bigint"==typeof e||function(e){try{return t.call(e),!0}catch(i){}return!1}(e))}}else rs.exports=function(t){return!1};return rs.exports}();return es=function(r){return null==r||"object"!=typeof r&&"function"!=typeof r?null:t(r)?"String":e(r)?"Number":i(r)?"Boolean":s(r)?"Symbol":n(r)?"BigInt":void 0}}(),y=Ps(),f=Es(),m=Is(),b=e("SharedArrayBuffer.prototype.byteLength",!0),v=e("Date.prototype.getTime"),w=Object.getPrototypeOf,x=e("Object.prototype.toString"),S=s("%Set%",!0),k=e("Map.prototype.has",!0),T=e("Map.prototype.get",!0),P=e("Map.prototype.size",!0),O=e("Set.prototype.add",!0),C=e("Set.prototype.delete",!0),E=e("Set.prototype.has",!0),I=e("Set.prototype.size",!0);function A(t,e,i,s){for(var r,o=n(t);(r=o.next())&&!r.done;)if(_(e,r.value,i,s))return C(t,r.value),!0;return!1}function M(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function R(e,i,s,n,r,o){var a=M(s);if(null!=a)return a;var l=T(i,a),h=t({},r,{strict:!1});return!(void 0===l&&!k(i,a)||!_(n,l,h,o))&&!k(e,a)&&_(n,l,h,o)}function j(t,e,i){var s=M(i);return null!=s?s:E(e,s)&&!E(t,s)}function L(t,e,i,s,r,o){for(var a,l,h=n(t);(a=h.next())&&!a.done;)if(_(i,l=a.value,r,o)&&_(s,T(e,l),r,o))return C(t,l),!0;return!1}function _(e,s,r,C){var M=r||{};if(M.strict?o(e,s):e===s)return!0;if(g(e)!==g(s))return!1;if(!e||!s||"object"!=typeof e&&"object"!=typeof s)return M.strict?o(e,s):e==s;var D,z=C.has(e),B=C.has(s);if(z&&B){if(C.get(e)===C.get(s))return!0}else D={};return z||C.set(e,D),B||C.set(s,D),function(e,s,r,o){var g,C;if(typeof e!=typeof s)return!1;if(null==e||null==s)return!1;if(x(e)!==x(s))return!1;if(a(e)!==a(s))return!1;if(l(e)!==l(s))return!1;var M=e instanceof Error,D=s instanceof Error;if(M!==D)return!1;if((M||D)&&(e.name!==s.name||e.message!==s.message))return!1;var z=u(e),B=u(s);if(z!==B)return!1;if((z||B)&&(e.source!==s.source||i(e)!==i(s)))return!1;var W=c(e),N=c(s);if(W!==N)return!1;if((W||N)&&v(e)!==v(s))return!1;if(r.strict&&w&&w(e)!==w(s))return!1;var G=f(e),H=f(s);if(G!==H)return!1;if(G||H){if(e.length!==s.length)return!1;for(g=0;g<e.length;g++)if(e[g]!==s[g])return!1;return!0}var U=F(e),$=F(s);if(U!==$)return!1;if(U||$){if(e.length!==s.length)return!1;for(g=0;g<e.length;g++)if(e[g]!==s[g])return!1;return!0}var V=h(e),X=h(s);if(V!==X)return!1;if(V||X)return m(e)===m(s)&&"function"==typeof Uint8Array&&_(new Uint8Array(e),new Uint8Array(s),r,o);var q=d(e),Y=d(s);if(q!==Y)return!1;if(q||Y)return b(e)===b(s)&&"function"==typeof Uint8Array&&_(new Uint8Array(e),new Uint8Array(s),r,o);if(typeof e!=typeof s)return!1;var K=p(e),Q=p(s);if(K.length!==Q.length)return!1;for(K.sort(),Q.sort(),g=K.length-1;g>=0;g--)if(K[g]!=Q[g])return!1;for(g=K.length-1;g>=0;g--)if(!_(e[C=K[g]],s[C],r,o))return!1;var J=y(e),Z=y(s);return J===Z&&("Set"===J||"Set"===Z?function(t,e,i,s){if(I(t)!==I(e))return!1;for(var r,o,a,l=n(t),h=n(e);(r=l.next())&&!r.done;)if(r.value&&"object"==typeof r.value)a||(a=new S),O(a,r.value);else if(!E(e,r.value)){if(i.strict)return!1;if(!j(t,e,r.value))return!1;a||(a=new S),O(a,r.value)}if(a){for(;(o=h.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!A(a,o.value,i.strict,s))return!1}else if(!i.strict&&!E(t,o.value)&&!A(a,o.value,i.strict,s))return!1;return 0===I(a)}return!0}(e,s,r,o):"Map"!==J||function(e,i,s,r){if(P(e)!==P(i))return!1;for(var o,a,l,h,c,u,d=n(e),p=n(i);(o=d.next())&&!o.done;)if(h=o.value[0],c=o.value[1],h&&"object"==typeof h)l||(l=new S),O(l,h);else if(void 0===(u=T(i,h))&&!k(i,h)||!_(c,u,s,r)){if(s.strict)return!1;if(!R(e,i,h,c,s,r))return!1;l||(l=new S),O(l,h)}if(l){for(;(a=p.next())&&!a.done;)if(h=a.value[0],u=a.value[1],h&&"object"==typeof h){if(!L(l,e,h,u,s,r))return!1}else if(!(s.strict||e.has(h)&&_(T(e,h),u,s,r)||L(l,e,h,u,t({},s,{strict:!1}),r)))return!1;return 0===I(l)}return!0}(e,s,r,o))}(e,s,M,C)}function F(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0]||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))}return xs=function(t,e,i){return _(t,e,i,r())}}());var Ms=(t=>(t[t.Backgrounds=-1]="Backgrounds",t[t.Warpers=0]="Warpers",t[t.Npcs=1]="Npcs",t[t.Items=2]="Items",t[t.Player=3]="Player",t[t.Shader=4]="Shader",t[t.Ui=5]="Ui",t[t.Ui2=6]="Ui2",t[t.Debug=7]="Debug",t[t.Overlay=8]="Overlay",t))(Ms||{});const Rs={fontFamily:"m6x11, sans-serif",fontSize:24,color:`#${B}`},js={fontFamily:"notepen, sans-serif",color:"#222222",fontSize:42,fontStyle:"bold"};var Ls=Phaser.Renderer.WebGL.Utils;const _s={renderWebGL:function(t,e,i,s){if(0!==e.width&&0!==e.height){i.addToRenderList(e);var n=e.frame,r=n.width,o=n.height,a=Ls.getTintAppendFloatAlpha,l=t.pipelines.set(e.pipeline,e),h=l.setTexture2D(n.glTexture,e);t.pipelines.preBatch(e),l.batchTexture(e,n.glTexture,r,o,e.x,e.y,r/e.style.resolution,o/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,r,o,a(e.tintTopLeft,i.alpha*e._alphaTL),a(e.tintTopRight,i.alpha*e._alphaTR),a(e.tintBottomLeft,i.alpha*e._alphaBL),a(e.tintBottomRight,i.alpha*e._alphaBR),e.tintFill,0,0,i,s,!1,h),t.pipelines.postBatch(e)}},renderCanvas:function(t,e,i,s){0!==e.width&&0!==e.height&&(i.addToRenderList(e),t.batchSprite(e,e.frame,i,s))}},Fs=Phaser.Display.Canvas.CanvasPool;var Ds=!1;!function(t){if(!Ds){void 0===t&&(t=60);var e=Phaser.VERSION.split("."),i=parseInt(e[0]);if(3===i){var s=parseInt(e[1]);s<t&&console.error(`Minimum supported version : ${i}.${s}`)}else console.error(`Can't supported version : ${i}`);Ds=!0}}();const zs=Phaser.GameObjects.GameObject;class Bs extends zs{setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setTestString(t){return this.style.setTestString(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t,e,i){return this.style.setBackgroundColor(t,e,i)}setBackgroundStrokeColor(t,e){return this.style.setBackgroundStrokeColor(t,e)}setBackgroundCornerRadius(t,e){return this.style.setBackgroundCornerRadius(t,e)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,s,n,r){return this.style.setShadow(t,e,i,s,n,r)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setUnderline(t,e,i){return this.style.setUnderline(t,e,i)}setUnderlineColor(t){return this.style.setUnderlineColor(t)}setUnderlineThickness(t){return this.style.setUnderlineThickness(t)}setUnderlineOffset(t){return this.style.setUnderlineOffset(t)}setStrikethrough(t,e,i){return this.style.setStrikethrough(t,e,i)}setStrikethroughColor(t){return this.style.setStrikethroughColor(t)}setStrikethroughThickness(t){return this.style.setStrikethroughThickness(t)}setStrikethroughOffset(t){return this.style.setStrikethroughOffset(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setWordWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setHAlign(t){return this.style.setHAlign(t)}setVAlign(t){return this.style.setVAlign(t)}get lineSpacing(){return this.style.lineSpacing}set lineSpacing(t){this.style.lineSpacing=t}setLineSpacing(t){return this.style.lineSpacing=t,this.updateText(!0),this}setXOffset(t){return this.style.setXOffset(t)}setMaxLines(t){return this.style.setMaxLines(t)}setResolution(t){return this.style.setResolution(t)}getTextMetrics(){return this.style.getTextMetrics()}setTextMetrics(t,e){return this.style.setTextMetrics(t,e)}measureTextMargins(t,e){return function(t,e,i){void 0===i&&(i={});var s=Fs.create(this),n=s.getContext("2d",{willReadFrequently:!0});t.syncFont(s,n);var r=n.measureText(e),o=Math.ceil(r.width*t.baselineX),a=o,l=2*a;if(a=a*t.baselineY|0,s.width=o,s.height=l,n.fillStyle="#f00",n.fillRect(0,0,o,l),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,a),i.left=0,0===o||0===l||!n.getImageData(0,0,o,l))return Fs.remove(s),i;for(var h=n.getImageData(0,0,o,l).data,c=!1,u=0;u<o;u++){for(var d=0;d<l;d++)if(255!==h[4*(d*o+u)]){i.left=u,c=!0;break}if(c)break}return Fs.remove(s),i}(this.style,t,e)}}const Ws=Phaser.GameObjects.Components;Phaser.Class.mixin(Bs,[Ws.Alpha,Ws.BlendMode,Ws.ComputedSize,Ws.Crop,Ws.Depth,Ws.Flip,Ws.GetBounds,Ws.Mask,Ws.Origin,Ws.Pipeline,Ws.PostPipeline,Ws.ScrollFactor,Ws.Tint,Ws.Transform,Ws.Visible,_s]);const Ns=Phaser.Utils.String.Pad;var Gs=function(t,e,i){if(null==t)return t;switch(typeof t){case"string":default:return t;case"number":return`#${Ns(Math.floor(t).toString(16),6,"0",1)}`;case"function":return t(e,i);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?`rgba(${t.r},${t.g},${t.b},${t.a})`:`rgb(${t.r},${t.g},${t.b})`:t.hasOwnProperty("h")?t.hasOwnProperty("a")?`hsla(${t.h},${t.s},${t.l},${t.a})`:`hsl(${t.h},${t.s},${t.l})`:t}},Hs={backgroundColor:["backgroundColor",null,Gs],backgroundColor2:["backgroundColor2",null,Gs],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,Gs],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",Gs],stroke:["stroke","#fff",Gs],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",Gs],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",Gs],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],strikethroughColor:["strikethrough.color","#000",Gs],strikethroughThickness:["strikethrough.thickness",0,null],strikethroughOffset:["strikethrough.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|Mqgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]};const Us=Phaser.Display.Canvas.CanvasPool;var $s=function(t){var e=Us.create(this),i=e.getContext("2d",{willReadFrequently:!0});t.syncFont(e,i);var s=i.measureText(t.testString);if("actualBoundingBoxAscent"in s){var n=s.actualBoundingBoxAscent,r=s.actualBoundingBoxDescent,o={ascent:n,descent:r,fontSize:n+r};return Us.remove(e),o}var a=Math.ceil(s.width*t.baselineX),l=a,h=2*l;if(l=l*t.baselineY|0,e.width=a,e.height=h,i.fillStyle="#f00",i.fillRect(0,0,a,h),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,l),o={ascent:0,descent:0,fontSize:0},!i.getImageData(0,0,a,h))return o.ascent=l,o.descent=l+6,o.fontSize=o.ascent+o.descent,Us.remove(e),o;var c,u,d=i.getImageData(0,0,a,h).data,p=d.length,g=4*a,y=0,f=!1;for(c=0;c<l;c++){for(u=0;u<g;u+=4)if(255!==d[y+u]){f=!0;break}if(f)break;y+=g}for(o.ascent=l-c,y=p-g,f=!1,c=h;c>l;c--){for(u=0;u<g;u+=4)if(255!==d[y+u]){f=!0;break}if(f)break;y-=g}return o.descent=c-l,o.fontSize=o.ascent+o.descent,Us.remove(e),o},Vs=/(?:\r\n|\r|\n)/;const Xs={none:0,word:1,char:2,character:2,mix:3},qs=Phaser.Utils.Objects.GetAdvancedValue,Ys=Phaser.Utils.Objects.GetValue;class Ks{constructor(t,e,i){this.parent=t,void 0===i&&(i=Hs),this.propertyMap=i,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.strikethroughColor,this.strikethroughThickness,this.strikethroughOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}get isWrapFitMode(){return this.fixedWidth>0&&0!==this.wrapMode&&0===this.wrapWidth}setStyle(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),t&&t.hasOwnProperty("wordWrap")){var s=t.wordWrap;s.hasOwnProperty("width")&&(t.wrap={mode:"word",width:s.width})}if(t&&t.hasOwnProperty("wrap")){var n=t.wrap;if(n.hasOwnProperty("mode")){var r=n.mode;"string"==typeof r&&(n.mode=Xs[r])}else n.hasOwnProperty("width")&&(n.mode=1)}t&&t.rtl&&i&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px");var o=this.propertyMap;for(var a in o){var l=o[a],h=l[0],c=i?l[1]:this[a],u=l[2];if("wrapCallback"===a||"wrapCallbackScope"===a)this[a]=Ys(t,h,c);else{var d=qs(t,h,c);u&&(d=u(d)),this[a]=d}}var p=Ys(t,"font",null);this._font=null===p?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:p;var g=Ys(t,"fill",null);null!==g&&(this.color=Gs(g));var y=Ys(t,"metrics",!1);return y?this.metrics={ascent:Ys(y,"ascent",0),descent:Ys(y,"descent",0),fontSize:Ys(y,"fontSize",0)}:!e&&this.metrics||(this.metrics=$s(this)),e?this.parent.updateText():this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim(),this.metrics=$s(this)),this.parent.updateText(t)}buildFont(){var t=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim();return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=Ys(t,"fontFamily","Courier"),this.fontSize=Ys(t,"fontSize","16px"),this.fontStyle=Ys(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}setResolution(t){return this.resolution=t,this.update(!1)}setXOffset(t){return this.xOffset=t,this.update(!1)}setBackgroundColor(t,e,i){return void 0===i&&(i=!0),this.backgroundColor=Gs(t,this.parent.canvas,this.parent.context),this.backgroundColor2=Gs(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=i,this.update(!1)}setBackgroundStrokeColor(t,e){return this.backgroundStrokeColor=Gs(t,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}setBackgroundCornerRadius(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}setFill(t){return this.color=Gs(t,this.parent.canvas,this.parent.context),this.update(!1)}setColor(t){return this.color=Gs(t,this.parent.canvas,this.parent.context),this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=Gs(t,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,s,n,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===n&&(n=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=Gs(i,this.parent.canvas,this.parent.context),this.shadowBlur=s,this.shadowStroke=n,this.shadowFill=r,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=Gs(t,this.parent.canvas,this.parent.context),this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=Gs(t,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=Gs(t,this.parent.canvas,this.parent.context),this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setStrikethrough(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.strikethroughColor=Gs(t,this.parent.canvas,this.parent.context),this.strikethroughThickness=e,this.strikethroughOffset=i,this.update(!1)}setStrikethroughColor(t){return void 0===t&&(t="#000"),this.strikethroughColor=Gs(t,this.parent.canvas,this.parent.context),this.update(!1)}setStrikethroughThickness(t){return void 0===t&&(t=0),this.strikethroughThickness=t,this.update(!1)}setStrikethroughOffset(t){return void 0===t&&(t=0),this.strikethroughOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=Xs[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}setTextMetrics(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=Ys(e,"fontFamily",this.fontFamily),this.fontSize=Ys(e,"fontSize",this.fontSize),this.fontStyle=Ys(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}get lineHeight(){return this.metrics.fontSize+this.parent.lineSpacing}toJSON(){var t={},e=this.propertyMap;for(var i in e)t[i]=this[i];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}const Qs=Phaser.Utils.Objects.GetValue;class Js{constructor(t,e,i,s,n){void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,i,s,n)}setTo(t,e,i,s,n){return this.setPosition(t,e),this.setRadius(n),this.setSize(i,s),this}setPosition(t,e){return this.x=t,this.y=e,this}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}set radius(t){var e,i;"number"==typeof t?(e=t,i=t):(e=Qs(t,"x",0),i=Qs(t,"y",0));var s=this.cornerRadius;s.tl=Zs(Qs(t,"tl",void 0),e,i),s.tr=Zs(Qs(t,"tr",void 0),e,i),s.bl=Zs(Qs(t,"bl",void 0),e,i),s.br=Zs(Qs(t,"br",void 0),e,i)}get radiusTL(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)}set radiusTL(t){tn(this.cornerRadius.tl,t)}get radiusTR(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)}set radiusTR(t){tn(this.cornerRadius.tr,t)}get radiusBL(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)}set radiusBL(t){tn(this.cornerRadius.bl,t)}get radiusBR(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)}set radiusBR(t){tn(this.cornerRadius.br,t)}}var Zs=function(t,e,i){return void 0===t?t={x:e,y:i}:"number"==typeof t&&(t={x:t,y:t}),en(t),t},tn=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=Qs(e,"x",0),t.y=Qs(e,"y",0)),en(t)},en=function(t){t.convex=t.x>=0||t.y>=0,t.x=Math.abs(t.x),t.y=Math.abs(t.y)};const sn=Phaser.Math.DegToRad;var nn=function(t){return!t.hasOwnProperty("convex")||t.convex},rn=function(t){return t.x>0&&t.y>0},on=function(t,e,i,s,n,r,o,a,l){if(a&&o>r?o-=360:!a&&o<r&&(o+=360),r=sn(r),o=sn(o),null==l)t.ellipse(e,i,s,n,0,r,o,a);else for(var h,c,u,d=(o-r)/(l+=1),p=0;p<=l;p++)u=r+d*p,h=e+s*Math.cos(u),c=i+n*Math.sin(u),t.lineTo(h,c)};const an={draw(t,e,i,s){var n=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save();var o=this.defaultStyle;this.clear(),function(t,e,i,s,n,r,o,a){if(null!=e||null!=i){var l=t.canvas.width,h=t.canvas.height;null==i&&(s=0);var c=s/2;l=Math.max(1,l-s),h=Math.max(1,h-s),function(t,e,i,s,n,r,o,a,l,h,c,u,d){var p;(function(t,e,i,s,n,r,o){var a,l,h,c,u,d=new Js(e,i,s,n,r),p=d.minWidth,g=d.minHeight,y=s>=p?1:s/p,f=n>=g?1:n/g,m=d.cornerRadius;t.save(),t.beginPath(),t.translate(e,i),a=m.tl,rn(a)?(l=a.x*y,h=a.y*f,nn(a)?on(t,l,h,l,h,180,270,!1,o):on(t,0,0,l,h,90,0,!0,o),c=0,u=h):(t.lineTo(0,0),c=0,u=0),a=m.tr,rn(a)?(l=a.x*y,h=a.y*f,nn(a)?on(t,s-l,h,l,h,270,360,!1,o):on(t,s,0,l,h,180,90,!0,o)):t.lineTo(s,0),a=m.br,rn(a)?(l=a.x*y,h=a.y*f,nn(a)?on(t,s-l,n-h,l,h,0,90,!1,o):on(t,s,n,l,h,270,180,!0,o)):t.lineTo(s,n),a=m.bl,rn(a)?(l=a.x*y,h=a.y*f,nn(a)?on(t,l,n-h,l,h,90,180,!1,o):on(t,0,n,l,h,360,270,!0,o)):t.lineTo(0,n),t.lineTo(c,u),t.closePath(),t.restore()})(e,i,s,n,r,o,d),null!=a&&(null!=c&&((p=u?e.createLinearGradient(0,0,n,0):e.createLinearGradient(0,0,0,r)).addColorStop(0,a),p.addColorStop(1,c),a=p),e.fillStyle=a,e.fill()),null!=l&&h>0&&(e.strokeStyle=l,e.lineWidth=h,e.stroke())}(t.canvas,t.context,c,c,l,h,n,e,i,s,r,o,a)}}(this,o.backgroundColor,o.backgroundStrokeColor,o.backgroundStrokeLineWidth,o.backgroundCornerRadius,o.backgroundColor2,o.backgroundHorizontalGradient,o.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var a,l,h,c,u,d,p=o.halign,g=o.valign,y=o.lineHeight,f=n.lines,m=f.length,b=o.maxLines;b>0&&m>b?(l=b,h="center"===g?Math.floor((m-l)/2):"bottom"===g?m-l:0):(l=m,h=0),c=h+l;var v=this.rtl,w=v?this.parent.width:void 0;d="center"===g?Math.max((s-l*y)/2,0):"bottom"===g?Math.max(s-l*y-2,0):0,d+=e;for(var x=h;x<c;x++)if(0!==(a=n.getLineWidth(x))){for(var S=f[x],k=S.length,T=p,P=0;P<k;P++){var O=S[P].prop.align;if(void 0!==O){T=O;break}}for(u="center"===T?(i-a)/2:"right"===T?v?0:i-a:v?i-a:0,u+=t,P=0;P<k;P++)this.drawPen(S[P],u,d,w)}r.restore()},drawPen(t,e,i,s){e+=t.x,i+=t.y+(t.prop.y||0),void 0!==s&&(e=s-e);var n=this.canvas,r=this.context;r.save();var o=this.parser.propToContextStyle(this.defaultStyle,t.prop);if(null!==o.bgcolor&&t.width>0){var a=this.defaultStyle.metrics,l=i-a.ascent,h=a.fontSize;this.drawRectangle(e,l,t.width,h,o.bgcolor,o)}if(o.underlineThickness>0&&t.width>0){var c=i+o.underlineOffset-o.underlineThickness/2;this.drawLine(e,c,t.width,o.underlineThickness,o.underlineColor,o)}if(t.isTextPen&&(o.buildFont(),o.syncFont(n,r),o.syncStyle(n,r),this.drawText(e,i,t.text,o)),t.isImagePen&&this.drawImage(e,i,t.prop.img,t.prop.color,o),o.strikethroughThickness>0&&t.width>0&&(c=i+o.strikethroughOffset-o.strikethroughThickness/2,this.drawLine(e,c,t.width,o.strikethroughThickness,o.strikethroughColor,o)),r.restore(),t.hasAreaMarker&&t.width>0){var u,d=t.prop.area;if(d)u={key:d};else{var p=t.prop.url;u={key:`url:${p}`,url:p}}this.hitAreaManager.add(e,i-this.startYOffset,t.width,this.defaultStyle.lineHeight,u)}},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawRectangle(t,e,i,s,n,r){this.autoRound&&(t=Math.round(t),e=Math.round(e));var o=this.context;o.fillStyle=n,o.fillRect(t,e,i,s)},drawLine(t,e,i,s,n,r){this.autoRound&&(t=Math.round(t),e=Math.round(e));var o=this.context;r.syncShadow(o,r.shadowStroke);var a=o.lineCap;o.lineCap="butt",o.strokeStyle=n,o.lineWidth=s,o.beginPath(),o.moveTo(t,e),o.lineTo(t+i,e),o.stroke(),o.lineCap=a},drawText(t,e,i,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context;s.stroke&&"none"!==s.stroke&&s.strokeThickness>0&&(s.syncShadow(n,s.shadowStroke),n.strokeText(i,t,e)),s.color&&"none"!==s.color&&(s.syncShadow(n,s.shadowFill),n.fillText(i,t,e))},drawImage(t,e,i,s,n){e-=this.startYOffset,this.parent.imageManager.draw(i,this.context,t,e,s,this.autoRound)}},ln=Phaser.Utils.Objects.GetValue;class hn{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=ln(t,"text",""),this.x=ln(t,"x",0),this.y=ln(t,"y",0),this.width=ln(t,"width",0);var e=ln(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=ln(t,"newLineMode",0),this.startIndex=ln(t,"startIndex",0)}get plainText(){var t=this.text;return 1===this.newLineMode&&(t+="\n"),t}get wrapText(){var t=this.text;return 0!==this.newLineMode&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return 1===this.newLineMode&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area||!!this.prop.url}}var cn=function(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:function(t){if("object"!=typeof t||null===t)return t;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}(e),i){e.length=t.length;for(var s=0,n=t.length;s<n;s++)e[s]=t[s]}else for(var r in t)e[r]=t[r];return e},un=function(){};const dn=Phaser.Utils.Objects.GetFastValue;class pn{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.tagToText=dn(t,"tagToText",un),this.tagToTextScope=dn(t,"tagToTextScope",void 0)}destroy(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}clear(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,s,n,r){var o=this.pensPool.pop();return null==o&&(o=new hn),gn.text=t,gn.x=e,gn.y=i,gn.width=s,gn.prop=n,gn.newLineMode=r,o.resetFromJSON(gn),this.addPen(o),this}addImagePen(t,e,i,s){return this.addTextPen("",t,e,i,s,0),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,s=t?cn(t.prop):null;return this.addTextPen("",e,i,0,s,2),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.linesPool.pop()||[],this.lines.push(i)),i.push(t),0!==t.newLineMode&&(i=this.linesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new pn),t.clear();for(var e=0,i=this.lines.length;e<i;e++)for(var s=this.lines[e],n=0,r=s.length;n<r;n++){var o=s[n];t.addPen(o.text,o.x,o.y,o.width,cn(o.prop),o.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,s=!1;for(e=t;e>=0&&!(s=null!=(i=this.lines[e])&&i.length>0);e--);return s?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,s=this.lines.length;i<s;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,s=e.length;i<s;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,s=this.pens.length;i<s;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){var s=this.lastPen;if(null==s)return"";var n=s.endIndex;void 0!==t&&0!==t||(t=-1),void 0!==e&&e!==n||(e=n+1),void 0===i&&(i=!1);for(var r,o,a,l,h,c,u="",d=0,p=this.pens.length;d<p&&((l=(r=this.pens[d]).endIndex)<=t||(r=this.pens[d],o=i?r.wrapText:r.plainText,h=r.prop,(a=r.startIndex)>=t&&l<=e||(o=o.substring(t-a,e-a)),this.tagToTextScope?u+=this.tagToText.call(this.tagToTextScope,o,h,c):u+=this.tagToText(o,h,c),c=h,!(l>=e)));d++);return u}get length(){return this.lines.length}set length(t){this.clear()}}var gn={};class yn{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}}const fn=Phaser.Geom.Rectangle;var mn=new yn;class bn{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){for(var t=0,e=this.hitAreas.length;t<e;t++)this.hitAreas[t].data=null;return mn.pushMultiple(this.hitAreas),this}add(t,e,i,s,n){void 0===n&&(n={});var r=mn.pop();return null===r?r=new fn(t,e,i,s):r.setTo(t,e,i,s),r.data=n,this.hitAreas.push(r),this}getFirst(t,e){for(var i=0,s=this.hitAreas.length;i<s;i++){var n=this.hitAreas[i];if(n.contains(t,e))return n}return null}getByKey(t){for(var e=0,i=this.hitAreas.length;e<i;e++){var s=this.hitAreas[e];if(s.data.key===t)return s}return null}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s=0,n=this.hitAreas.length;s<n;s++){var r=this.hitAreas[s];t.lineStyle(1,e).strokeRect(r.x,r.y,r.width,r.height)}return i&&t.restore(),this}}var vn=function(t,e,i,s){var n=this.hitAreaManager.getFirst(e,i);if(null!==n){var r=n.data.key;Sn.call(this,"areadown",r,t,e,i,s),n.data&&(n.data.isDown=!0)}},wn=function(t,e,i,s){var n=this.hitAreaManager.getFirst(e,i);if(null!==n){var r=n.data.key;if(Sn.call(this,"areaup",r,t,e,i,s),n.data){if(n.data.isDown){if(Sn.call(this,"areaclick",r,t,e,i,s),!n.data)return;var o=n.data.url;o&&window.open(o,"_blank")}n.data.isDown=!1}}},xn=function(t,e,i,s){if(null!==e){var n=(o=this.hitAreaManager.getFirst(e,i))?o.data.key:null;if(this.lastHitAreaKey!==n){if(null!==this.lastHitAreaKey){Sn.call(this,"areaout",this.lastHitAreaKey,t,e,i,s);var r=this.hitAreaManager.getByKey(this.lastHitAreaKey);r&&(this.urlTagCursorStyle&&kn(this.scene,r,""),r.data.isDown=!1)}null!==n&&(Sn.call(this,"areaover",n,t,e,i,s),o.data&&this.urlTagCursorStyle&&kn(this.scene,o,this.urlTagCursorStyle)),this.lastHitAreaKey=n}}else{var o;null!==this.lastHitAreaKey&&(Sn.call(this,"areaout",this.lastHitAreaKey,t,e,i,s),(o=this.hitAreaManager.getByKey(this.lastHitAreaKey))&&o.data&&(o.data.isDown=!1),this.lastHitAreaKey=null)}},Sn=function(t,e,i,s,n,r){this.parent.emit(`${t}-${e}`,i,s,n,r),this.parent.emit(t,e,i,s,n,r)},kn=function(t,e,i){e&&e.data&&e.data.url&&(t.input.manager.canvas.style.cursor=i)},Tn=/^[\x00-\x7F]+$/,Pn=function(t){return Tn.test(t)};const On=Vs;var Cn=function(t,e,i,s,n,r){s<=0&&(i=0);var o=[];if(!t||!t.length)return o;for(var a,l,h,c=0===i,u=t.split(On),d=0,p=u.length;d<p;d++)if(a=u[d],h=d===p-1?0:1,c){var g=e.measureText(a).width;o.push(r.getLine(a,g,h))}else{if(l=0===d?s-n:s,a.length<=100&&(g=e.measureText(a).width)<=l){o.push(r.getLine(a,g,h));continue}for(var y,f,m,b=En(a,i),v="",w=0,x=0,S=b.length;x<S;x++)if(y=b[x],(f=e.measureText(y).width)>s&&In(y)){""!==v?o.push(r.getLine(v,w,2)):0===x&&n>0&&o.push(r.getLine("",0,2)),o.push(...Cn(y,e,2,s,0,r));var k=o.pop();v=k.text,w=k.width,r.freeLine(k)," "===v&&(v="",w=0)}else(m=w+f)>l?(o.push(r.getLine(v,w,2)),v=y,w=f,l=s):(v+=y,w=m),x===S-1&&o.push(r.getLine(v,w,h))}return o},En=function(t,e){var i;switch(e){case 1:i=[];for(var s=0,n=(t=t.split(" ")).length;s<n;s++){var r=t[s];s<n-1?i.push(r+" "):""!==r&&i.push(r)}break;case 2:i=t.split("");break;default:for(i=[],s=0,n=(t=t.split(" ")).length;s<n;s++)r=t[s],s<n-1?Pn(r)?i.push(r+" "):(i.push(...r.split("")),i.push(" ")):""!==r&&(Pn(r)?i.push(r):i.push(...r.split("")))}return i},In=function(t){switch(t.length){case 1:return!1;case 2:return" "!==t.charAt(1);default:return!0}};const An=Phaser.Utils.Objects.GetValue;class Mn{constructor(t){this.parent=t.parent,this.scene=this.parent.scene,this.context=An(t,"context",null),this.canvas=this.context.canvas,this.parser=An(t,"parser",null),this.defaultStyle=An(t,"style",null),this.autoRound=!0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.wrapTextLinesPool=t.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new bn,this.lastHitAreaKey=null,this.urlTagCursorStyle=null}destroy(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0}updatePenManager(t,e,i,s,n){if(void 0===n&&(n=this.penManager),n.clear(),""===t)return n;var r=this.parent.style;if(r.isWrapFitMode){var o=this.parent.padding;i=r.fixedWidth-o.left-o.right}for(var a,l,h,c,u,d=this.canvas,p=this.context,g=0,y=0,f=r.wrapCallback,m=r.wrapCallbackScope,b=!0,v=this.parser.splitText(t),w=this.wrapTextLinesPool,x=0,S=v.length;x<S;x++)if(a=(c=this.parser.tagTextToProp(v[x],l)).plainText,(l=c.prop).img){var k=this.imageManager.getOuterWidth(l.img);i>0&&0!==e&&i<g+k&&(n.addNewLinePen(),y+=s,g=0),n.addImagePen(g,y,k,cn(l)),g+=k}else if(""!==a){if(p.save(),(h=this.parser.propToContextStyle(this.defaultStyle,l)).buildFont(),h.syncFont(d,p),h.syncStyle(d,p),f){"string"==typeof(u=f.call(m,a,p,i,g))&&(u=u.split("\n"));for(var T=0,P=u.length;T<P;T++)"string"==typeof(O=u[T])?u[T]=w.getLine(O,p.measureText(O).width,T<P-1?2:0):b=!1}else u=Cn(a,p,e,i,g,w);var O;for(T=0,P=u.length;T<P;T++)O=u[T],n.addTextPen(O.text,g,y,O.width,cn(l),O.newLineMode),0!==O.newLineMode?(g=0,y+=s):g+=O.width;b&&w.freeLines(u),u=null,p.restore()}for(x=0,S=this.lines.length;x<S;x++){var C=this.lines[x],E=C[C.length-1];E&&(E.width+=this.parser.getStrokeThinkness(this.defaultStyle,E.prop))}return n}get startXOffset(){return this.defaultStyle.xOffset}get startYOffset(){return this.defaultStyle.metrics.ascent}get lines(){return this.penManager.lines}get displayLinesCount(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return Math.ceil(this.penManager.getMaxLineWidth())}get linesHeight(){var t=this.displayLinesCount,e=this.defaultStyle.lineHeight*t;return t>0&&(e-=this.defaultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}get rtl(){return this.parent.style.rtl}newPenManager(){return new pn({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var s;if(null==t)s=this.penManager.plainText;else{var n=this.parser.splitText(t,1);s="";for(var r=0,o=n.length;r<o;r++)s+=n[r]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=s.length),s=s.substring(e,i)),s}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defaultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,s){if(null==t)return this.penManager.getSliceTagText(e,i,s);var n=this.tmpPenManager,r=this.defaultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,n),n.getSliceTagText(e,i,s)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var Rn={setInteractive:function(){this.parent.on("pointerdown",vn,this).on("pointerup",wn,this).on("pointermove",xn,this).on("pointerover",xn,this).on("pointerout",(function(t,e){xn.call(this,t,null,null,e)}),this)}};Object.assign(Mn.prototype,an,Rn);class jn extends yn{freeLine(t){if(t)return this.push(t),this}freeLines(t){if(t)return this.pushMultiple(t),this}getLine(t,e,i){var s=this.pop();return null===s&&(s={}),s.text=t,s.width=e,s.newLineMode=i,s}}const Ln=Phaser.Utils.Objects.IsPlainObject,_n=Phaser.Utils.Objects.GetValue;var Fn=function(t,e){Ln(t)?t=(e=t).key:void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var i=e.key,s=e.frame,n=e.width,r=e.height;if(void 0===n||void 0===r){var o=this.textureManager.getFrame(i,s),a=o?o.cutWidth:0,l=o?o.cutHeight:0;void 0===n&&void 0===r?(n=a,r=l):void 0===n?n=a*(r/l):void 0===r&&(r=l*(n/a))}this.images[t]={key:i,frame:s,width:n,height:r,y:_n(e,"y",0),left:_n(e,"left",0),right:_n(e,"right",0),originX:_n(e,"originX",0),originY:_n(e,"originY",0),tintFill:_n(e,"tintFill",!1)}};const Dn=Phaser.Display.Canvas.CanvasPool;class zn{constructor(t){this.textureManager=t.sys.textures,this.images={}}destroy(){this.textureManager=void 0,this.images=void 0}add(t,e){if("string"==typeof t)Fn.call(this,t,e);else if(Array.isArray(t))for(var i=0,s=(n=t).length;i<s;i++)Fn.call(this,n[i]);else{var n=t;for(var t in n)Fn.call(this,t,n[t])}return this}has(t){return this.images.hasOwnProperty(t)}remove(t){return this.has(t)&&delete this.images[t],this}get(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}}var Bn={draw:function(t,e,i,s,n,r){var o=this.get(t);if(o){var a=this.textureManager.getFrame(o.key,o.frame),l=o.width,h=o.height;i+=o.left-o.originX*l,s+=o.y-o.originY*h,o.tintFill||(n=void 0),function(t,e,i,s,n,r,o,a){void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=t.cutWidth),void 0===r&&(r=t.cutHeight),void 0===a&&(a=!1),a&&(i=Math.round(i),s=Math.round(s));var l=e.getContext("2d",{willReadFrequently:!0});if(o){var h=Dn.create(null,n,r,Phaser.CANVAS,!0),c=h.getContext("2d",{willReadFrequently:!0});c.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,0,0,n,r),c.globalCompositeOperation="source-in",c.fillStyle=o,c.fillRect(0,0,n,r),l.drawImage(h,0,0,n,r,i,s,n,r),Dn.remove(h)}else l.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,i,s,n,r)}(a,e.canvas,i,s,l,h,n,r)}}};Object.assign(zn.prototype,Bn);const Wn=Phaser.Utils.Objects.IsPlainObject,Nn=Phaser.DOM.AddToDOM,Gn=Phaser.Display.Canvas.CanvasPool,Hn=Phaser.GameObjects.GameObject,Un=Phaser.Utils.Objects.GetValue,$n=Phaser.DOM.RemoveFromDOM,Vn=Vs,Xn=Phaser.Utils.String.UUID;var qn=null,Yn=null,Kn=null;class Qn extends Bs{constructor(t,e,i,s,n,r,o){if(Wn(e)){var a=e;e=Un(a,"x",0),i=Un(a,"y",0),s=Un(a,"text",""),n=Un(a,"style")}if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,r),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.initPostPipeline(!0),this.canvas=Gn.create(this),this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this._imageManager=void 0,n){if(n.hasOwnProperty("align")){var l=n.align;delete n.align,n.halign=l}n.hasOwnProperty("stroke")&&!n.hasOwnProperty("strokeThickness")&&(n.strokeThickness=1)}this.style=new Ks(this,n);var h,c,u,d=Un(n,"images",void 0);d&&this.addImage(d),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=1),this._crop=this.resetCropObject(),this._textureKey=Xn(),this.texture=t.sys.textures.addCanvas(this._textureKey,this.canvas),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),Un(n,"sharedPool",!0)?(qn||(qn={},Yn=new yn,Kn=new jn,this.scene.game.events.once("destroy",(function(){qn=null,Yn=null,Kn=null}))),qn.hasOwnProperty(r)||(qn[r]=new yn),h=qn[r],c=Yn,u=Kn):(h=new yn,c=new yn,u=new jn),this.canvasText=new Mn({parent:this,context:this.context,parser:o,style:this.style,pensPool:h,linesPool:c,wrapTextLinesPool:u}),this.parser=o,this.initRTL(),n&&n.padding&&this.setPadding(n.padding),this.setText(s),this.setUrlTagCursorStyle(Un(n,"urlTagCursorStyle","pointer")),Un(n,"interactive",!1)&&this.setInteractive()}preDestroy(){$n(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Gn.remove(this.canvas);var t=this.texture;t&&t.destroy()}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Nn(this.canvas,this.scene.sys.canvas),this.originX=1)}setRTL(t){void 0===t&&(t=!0);var e=this.style;if(e.rtl===t)return this;if(e.rtl=t,t?(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Nn(this.canvas,this.scene.sys.canvas)):(this.canvas.dir="ltr",this.context.direction="ltr"),"left"===e.halign?e.halign="right":"right"===e.halign&&(e.halign="left"),this._imageManager){var i=this._imageManager.images;for(var s in i)i[s].originX=1-i[s].originX}return this}setText(t){return(t=function(t){return null==t?t="":Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t}(t))===this._text||(this._text=t,this.updateText()),this}setPadding(t,e,i,s){if("object"==typeof t){var n=t,r=Un(n,"x",null);null!==r?(t=r,i=r):(t=Un(n,"left",0),i=Un(n,"right",t));var o=Un(n,"y",null);null!==o?(e=o,s=o):(e=Un(n,"top",0),s=Un(n,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===s&&(s=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,n,r=this.padding,o=Math.ceil(e.linesWidth);0===i.fixedWidth?(this.width=o+r.left+r.right,s=o):(this.width=i.fixedWidth,(s=this.width-r.left-r.right)<o&&(s=o)),0===i.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,n=e.linesHeight):(this.height=i.fixedHeight,(n=this.height-r.top-r.bottom)<e.linesHeight&&(n=e.linesHeight));var a=this.width,l=this.height;this.updateDisplayOrigin();var h=i.resolution;a*=h,l*=h,a=Math.max(Math.ceil(a),1),l=Math.max(Math.ceil(l),1);var c=this.canvas,u=this.context;c.width!==a||c.height!==l?(c.width=a,c.height=l,this.frame.setSize(a,l)):u.clearRect(0,0,a,l),u.save(),u.scale(h,h);var d=this.style.rtl?r.right:r.left,p=r.top;e.draw(d,p,s,n),u.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(c,this.frame.source.glTexture,!0),this.frame.glTexture.spectorMetadata={textureKey:"BBCodeText Game Object"}),this.dirty=!0;var g=this.input;return g&&!g.customHitArea&&(g.hitArea.width=this.width,g.hitArea.height=this.height),this}toJSON(){var t=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}setInteractive(t,e,i){var s=!!this.input;return Hn.prototype.setInteractive.call(this,t,e,i),s||this.canvasText.setInteractive(),this}setUrlTagCursorStyle(t){return this.urlTagCursorStyle=t,this}get urlTagCursorStyle(){return this.canvasText.urlTagCursorStyle}set urlTagCursorStyle(t){this.canvasText.urlTagCursorStyle=t}getWrappedText(t,e,i){return"number"==typeof t&&(i=e,e=t,t=void 0),(t=this.canvasText.getText(t,e,i,!0)).split(Vn)}getPlainText(t,e,i){return"number"==typeof t&&(i=e,e=t,t=void 0),this.canvasText.getPlainText(t,e,i)}getText(t,e,i,s){return"number"==typeof t&&(s=i,i=e,e=t,t=void 0),void 0===s&&(s=!1),this.canvasText.getText(t,e,i,s)}getSubString(t,e,i){return"number"==typeof t&&(i=e,e=t,t=void 0),this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}get imageManager(){return this._imageManager||(this._imageManager=new zn(this.scene)),this._imageManager}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}generateTexture(t,e,i,s,n){var r=this.canvas;return void 0===s?s=r.width:s*=this.resolution,void 0===n?n=r.height:n*=this.resolution,function(t,e,i,s,n,r,o){var a,l=t.sys.textures,h=t.renderer;void 0===s&&(s=0),void 0===n&&(n=0),void 0===r&&(r=e.width),void 0===o&&(o=e.height);var c=(a=l.exists(i)?l.get(i):l.createCanvas(i,r,o)).getSourceImage();c.width!==r&&(c.width=r),c.height!==o&&(c.height=o);var u=c.getContext("2d",{willReadFrequently:!0});u.clearRect(0,0,r,o),u.drawImage(e,s,n,r,o),h.gl&&a&&h.canvasToTexture(c,a.source[0].glTexture,!0,0)}(this.scene,r,t,e,i,s,n),this}}var Jn={appendText:function(t,e){var i;return t||0===t||(t=""),void 0===e&&(e=!0),Array.isArray(t)&&(t=t.join("\n")),(i=e?`${this.text}\n${t}`:`${this.text}${t}`)!=this.text&&this.setText(i),this}};Object.assign(Qn.prototype,Jn);const Zn=!1,tr=!0;var er,ir,sr={plainText:null,prevProp:null},nr=function(t,e,i,s){return e===tr?t[i]=s:t.hasOwnProperty(i)&&delete t[i],t},rr=new Ks,or={},ar=function(t){return t.replace(lr,"\\$&").replace(hr,"\\x2d")},lr=/[|\\{}()[\]^$+*?.]/g,hr=/-/g,cr={},ur=function(t,e,i,s){return void 0===s?`${t}${i}${e}`:`${t}${i}=(${s})${e}`},dr=function(t,e,i){return`${t}/${i}${e}`},pr="[-.0-9]+",gr=["[a-zA-Z]+","#[0-9abcdef]+","rgba?\\(s*[.0-9]+s*(,s*[.0-9]+s*){2,3}\\)"].join("|"),yr=function(t,e){if(void 0===e){var i=t;t=i[0],e=i[1]}if(er===t&&ir===e)return!1;er=t,ir=e,t=ar(t);var s=function(t){return`[^${t}]+`}(e=ar(e)),n=ur(t,e,"esc"),r=dr(t,e,"esc"),o=ur(t,e,"raw"),a=dr(t,e,"raw"),l=ur(t,e,"b"),h=dr(t,e,"b"),c=ur(t,e,"i"),u=dr(t,e,"i"),d="weight",p=ur(t,e,d,pr),g=dr(t,e,d),y="size",f=ur(t,e,y,pr),m=dr(t,e,y),b="family",v=ur(t,e,b,s),w=dr(t,e,b),x="color",S=ur(t,e,x,gr),k=dr(t,e,x),T=ur(t,e,"u"),P=ur(t,e,"u",gr),O=dr(t,e,"u"),C=ur(t,e,"s"),E=ur(t,e,"s",gr),I=dr(t,e,"s"),A="shadow",M=ur(t,e,A),R=ur(t,e,A,gr),j=dr(t,e,A),L="stroke",_=ur(t,e,L),F=ur(t,e,L,gr),D=dr(t,e,L),z="bgcolor",B=ur(t,e,z,gr),W=dr(t,e,z),N=ur(t,e,"y",pr),G=dr(t,e,"y"),H=ur(t,e,"img",s),U=dr(t,e,"img"),$="area",V=ur(t,e,$,s),X=dr(t,e,$),q=ur(t,e,"url",s),Y=dr(t,e,"url"),K="align",Q=ur(t,e,K,s),J=dr(t,e,K),Z=ur(t,e,"id",s),tt=dr(t,e,"id");return cr.RE_ESC_OPEN=new RegExp(n,"i"),cr.RE_ESC_CLOSE=new RegExp(r,"i"),cr.RE_RAW_OPEN=new RegExp(o,"i"),cr.RE_RAW_CLOSE=new RegExp(a,"i"),cr.RE_BLOD_OPEN=new RegExp(l,"i"),cr.RE_BLOD_CLOSE=new RegExp(h,"i"),cr.RE_ITALICS_OPEN=new RegExp(c,"i"),cr.RE_ITALICS_CLOSE=new RegExp(u,"i"),cr.RE_WEIGHT_OPEN=new RegExp(p,"i"),cr.RE_WEIGHT_CLOSE=new RegExp(g,"i"),cr.RE_SIZE_OPEN=new RegExp(f,"i"),cr.RE_SIZE_CLOSE=new RegExp(m,"i"),cr.RE_FAMILY_OPEN=new RegExp(v,"i"),cr.RE_FAMILY_CLOSE=new RegExp(w,"i"),cr.RE_COLOR_OPEN=new RegExp(S,"i"),cr.RE_COLOR_CLOSE=new RegExp(k,"i"),cr.RE_UNDERLINE_OPEN=new RegExp(T,"i"),cr.RE_UNDERLINE_OPENC=new RegExp(P,"i"),cr.RE_UNDERLINE_CLOSE=new RegExp(O,"i"),cr.RE_STRIKETHROUGH_OPEN=new RegExp(C,"i"),cr.RE_STRIKETHROUGH_OPENC=new RegExp(E,"i"),cr.RE_STRIKETHROUGH_CLOSE=new RegExp(I,"i"),cr.RE_SHADOW_OPEN=new RegExp(M,"i"),cr.RE_SHADOW_OPENC=new RegExp(R,"i"),cr.RE_SHADOW_CLOSE=new RegExp(j,"i"),cr.RE_STROKE_OPEN=new RegExp(_,"i"),cr.RE_STROKE_OPENC=new RegExp(F,"i"),cr.RE_STROKE_CLOSE=new RegExp(D,"i"),cr.RE_BGCOLOR_OPEN=new RegExp(B,"i"),cr.RE_BGCOLOR_CLOSE=new RegExp(W,"i"),cr.RE_OFFSETY_OPEN=new RegExp(N,"i"),cr.RE_OFFSETY_CLOSE=new RegExp(G,"i"),cr.RE_IMAGE_OPEN=new RegExp(H,"i"),cr.RE_IMAGE_CLOSE=new RegExp(U,"i"),cr.RE_AREA_OPEN=new RegExp(V,"i"),cr.RE_AREA_CLOSE=new RegExp(X,"i"),cr.RE_URL_OPEN=new RegExp(q,"i"),cr.RE_URL_CLOSE=new RegExp(Y,"i"),cr.RE_ALIGN_OPEN=new RegExp(Q,"i"),cr.RE_ALIGN_CLOSE=new RegExp(J,"i"),cr.RE_ID_OPEN=new RegExp(Z,"i"),cr.RE_ID_CLOSE=new RegExp(tt,"i"),cr.RE_SPLITTEXT=new RegExp([o,a,n,r,l,h,c,u,p,g,f,m,v,w,S,k,T,P,O,C,E,I,M,R,j,_,F,D,B,W,N,G,H,U,V,X,q,Y,Q,J,Z,tt].join("|"),"ig"),!0},fr=function(t,e){return void 0!==t&&yr(t,e),Object.assign({},cr)};const mr=Phaser.Utils.Objects.GetValue;class br{constructor(t){var e=mr(t,"delimiters","[]");this.tagRegex=fr(e),this.delimiters=e}getStrokeThinkness(t,e){return e.hasOwnProperty("stroke")?t.strokeThickness:0}setDelimiters(t,e){return yr(t,e)&&(this.tagRegex=fr()),this}}var vr={splitText:function(t,e){for(var i=this.tagRegex,s=[],n=0,r=!1,o=!1;;){var a=i.RE_SPLITTEXT.exec(t);if(!a)break;var l=a[0];if(o){if(!i.RE_ESC_CLOSE.test(l))continue;o=!1}else if(r){if(!i.RE_RAW_CLOSE.test(l))continue;r=!1}else i.RE_ESC_OPEN.test(l)?o=!0:i.RE_RAW_OPEN.test(l)&&(r=!0);var h=i.RE_SPLITTEXT.lastIndex,c=h-l.length;if(n<c){var u=t.substring(n,c);s.push(u)}void 0===e&&s.push(l),n=h}var d=t.length;return n<d&&s.push(t.substring(n,d)),s},tagTextToProp:function(t,e){var i=this.tagRegex;null==e&&(e={});var s="";if(e.img&&nr(e,Zn,"img"),e.esc)i.RE_ESC_CLOSE.test(t)?nr(e,Zn,"esc"):s=t;else if(e.raw)i.RE_RAW_CLOSE.test(t)?nr(e,Zn,"raw"):s=t;else if(i.RE_ESC_OPEN.test(t))nr(e,tr,"esc",!0);else if(i.RE_ESC_CLOSE.test(t))nr(e,Zn,"esc");else if(i.RE_RAW_OPEN.test(t))nr(e,tr,"raw",!0);else if(i.RE_RAW_CLOSE.test(t))nr(e,Zn,"raw");else if(i.RE_BLOD_OPEN.test(t))nr(e,tr,"b",!0);else if(i.RE_BLOD_CLOSE.test(t))nr(e,Zn,"b");else if(i.RE_ITALICS_OPEN.test(t))nr(e,tr,"i",!0);else if(i.RE_ITALICS_CLOSE.test(t))nr(e,Zn,"i");else if(i.RE_WEIGHT_OPEN.test(t)){var n=t.match(i.RE_WEIGHT_OPEN);nr(e,tr,"weight",n[1])}else i.RE_WEIGHT_CLOSE.test(t)?nr(e,Zn,"weight"):i.RE_SIZE_OPEN.test(t)?(n=t.match(i.RE_SIZE_OPEN),nr(e,tr,"size",`${n[1]}px`)):i.RE_SIZE_CLOSE.test(t)?nr(e,Zn,"size"):i.RE_FAMILY_OPEN.test(t)?(n=t.match(i.RE_FAMILY_OPEN),nr(e,tr,"family",n[1])):i.RE_FAMILY_CLOSE.test(t)?nr(e,Zn,"family"):i.RE_COLOR_OPEN.test(t)?(n=t.match(i.RE_COLOR_OPEN),nr(e,tr,"color",n[1])):i.RE_COLOR_CLOSE.test(t)?nr(e,Zn,"color"):i.RE_UNDERLINE_OPEN.test(t)?nr(e,tr,"u",!0):i.RE_UNDERLINE_OPENC.test(t)?(n=t.match(i.RE_UNDERLINE_OPENC),nr(e,tr,"u",n[1])):i.RE_UNDERLINE_CLOSE.test(t)?nr(e,Zn,"u"):i.RE_STRIKETHROUGH_OPEN.test(t)?nr(e,tr,"s",!0):i.RE_STRIKETHROUGH_OPENC.test(t)?(n=t.match(i.RE_STRIKETHROUGH_OPENC),nr(e,tr,"s",n[1])):i.RE_STRIKETHROUGH_CLOSE.test(t)?nr(e,Zn,"s"):i.RE_SHADOW_OPEN.test(t)?nr(e,tr,"shadow",!0):i.RE_SHADOW_OPENC.test(t)?(n=t.match(i.RE_SHADOW_OPENC),nr(e,tr,"shadow",n[1])):i.RE_SHADOW_CLOSE.test(t)?nr(e,Zn,"shadow"):i.RE_STROKE_OPEN.test(t)?nr(e,tr,"stroke",!0):i.RE_STROKE_OPENC.test(t)?(n=t.match(i.RE_STROKE_OPENC),nr(e,tr,"stroke",n[1])):i.RE_STROKE_CLOSE.test(t)?nr(e,Zn,"stroke"):i.RE_BGCOLOR_OPEN.test(t)?(n=t.match(i.RE_BGCOLOR_OPEN),nr(e,tr,"bgcolor",n[1])):i.RE_BGCOLOR_CLOSE.test(t)?nr(e,Zn,"bgcolor"):i.RE_OFFSETY_OPEN.test(t)?(n=t.match(i.RE_OFFSETY_OPEN),nr(e,tr,"y",parseFloat(n[1]))):i.RE_OFFSETY_CLOSE.test(t)?nr(e,Zn,"y"):i.RE_IMAGE_OPEN.test(t)?(n=t.match(i.RE_IMAGE_OPEN),nr(e,tr,"img",n[1])):i.RE_IMAGE_CLOSE.test(t)?nr(e,Zn,"img"):i.RE_AREA_OPEN.test(t)?(n=t.match(i.RE_AREA_OPEN),nr(e,tr,"area",n[1])):i.RE_AREA_CLOSE.test(t)?nr(e,Zn,"area"):i.RE_URL_OPEN.test(t)?(n=t.match(i.RE_URL_OPEN),nr(e,tr,"url",n[1])):i.RE_URL_CLOSE.test(t)?nr(e,Zn,"url"):i.RE_ALIGN_OPEN.test(t)?(n=t.match(i.RE_ALIGN_OPEN),nr(e,tr,"align",n[1])):i.RE_ALIGN_CLOSE.test(t)?nr(e,Zn,"align"):i.RE_ID_OPEN.test(t)?(n=t.match(i.RE_ID_OPEN),nr(e,tr,"id",n[1])):i.RE_ID_CLOSE.test(t)?nr(e,Zn,"id"):s=t;var r=sr;return r.plainText=s,r.prop=e,r},propToContextStyle:function(t,e){var i=rr;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var s=e.size;"number"==typeof s&&(s=`${s}px`),i.fontSize=s}else i.fontSize=t.fontSize;i.fontStyle=function(t){var e=t.b,i=t.weight,s=t.i;return e||i||s?s?e?"bold italic":i?`${i} italic`:"italic":e?"bold":i.toString():""}(e),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),e.hasOwnProperty("s")?!0===e.s?(i.strikethroughColor=t.strikethroughColor,i.strikethroughThickness=t.strikethroughThickness,i.strikethroughOffset=t.strikethroughOffset):(i.strikethroughColor=e.s,i.strikethroughThickness=t.strikethroughThickness,i.strikethroughOffset=t.strikethroughOffset):(i.strikethroughColor="#000",i.strikethroughThickness=0,i.strikethroughOffset=0),e.hasOwnProperty("bgcolor")?i.bgcolor=e.bgcolor:i.bgcolor=null,i},propToTagText:function(t,e,i){null==i&&(i=or);var s=this.delimiters[0],n=this.delimiters[1],r=[];for(var o in i)e.hasOwnProperty(o)||r.push(`${s}/${o}${n}`);for(var o in e){var a=e[o];if("img"===o);else if(i[o]===a)continue;switch(o){case"size":r.push(`${s}size=${a.replace("px","")}${n}`);break;case"color":case"weight":case"family":case"stroke":case"bgcolor":case"y":case"img":case"area":case"url":case"align":case"id":r.push(`${s}${o}=${a}${n}`);break;case"u":case"s":!0===a?r.push(`${s}${o}${n}`):r.push(`${s}${o}=${a}${n}`);break;default:r.push(`${s}${o}${n}`)}}return r.push(t),r.join("")}};Object.assign(br.prototype,vr);class wr extends Qn{constructor(t,e,i,s,n){super(t,e,i,s,n,"rexBBCodeText",new br(n))}setDelimiters(t,e){return this.parse.setDelimiters(t,e),this}}const xr={x:0,y:0,condition:t=>et(t.scene)},Sr={[P.Inventor]:{x:550,y:635,scale:.75,image:"inventor",portrait:"inventor_portrait",name:"Johan the Inventor",positionData:[xr]},[P.Stranger]:{x:1340,y:1500,scale:1.35,image:"stranger",portrait:"stranger_portrait",name:"Mysterious Stranger"},[P.Sphinx]:{x:3520,y:790,scale:1,image:"sphinx",portrait:"sphinx_portrait",name:"Mystical Sphinx",light:1.85,positionData:[{x:3720,y:700,condition:t=>t.scene.player.gameState.data.sphinxMoved,onMove:t=>bo(t.scene,!0)},{x:3520,y:790,condition:()=>!0,onMove:t=>bo(t.scene,!1)}]},[P.Mayor]:{x:790,y:-340,scale:.9,image:"mayor",portrait:"mayor_portrait",name:"Joleen the Mayor",positionData:[xr]},[P.Innkeeper]:{x:2300,y:-1240,scale:1.1,image:"innkeeper",portrait:"innkeeper_portrait",name:"Bart the Innkeeper",skipLighting:!0},[P.Baker]:{x:1836,y:-1205,scale:.85,image:"baker",portrait:"baker_portrait",name:"Amanda the Baker",skipLighting:!0,positionData:[xr]}},kr={[E.ClockTower]:{x:880,y:-2090,scale:.5,name:"Clock Tower",portrait:"clock_portrait",particles:{scale:{start:0,end:1.1},alpha:{start:1,end:0},lifespan:2e3,delay:1e3,maxAliveParticles:1,tint:[13067088]}},[E.Chest]:{x:4955,y:915,image:"chest",scale:{x:4.5,y:3}},[E.LabHatch]:{x:-1910,y:640,name:"Trap Door"},[E.LabBook]:{x:-700,y:1630,scale:.7,name:"Journal",image:"book",skipLighting:!0},[E.AlchemySet]:{x:-2650,y:1600,scale:.7,image:"alchemy_empty",initializeOnStart:!0,skipLighting:!0,particles:{scale:{min:.05,max:.15},speed:{min:30,max:120},alpha:{values:[0,.5,0]},gravityY:100,lifespan:{min:250,max:500},emitting:!1,stopAfter:60}},[E.LabBookshelf1]:{x:-2025,y:1700,name:"Bookshelf"},[E.LabBookshelf2]:{x:-1290,y:1700,name:"Bookshelf"},[E.LabBookshelf3]:{x:-1115,y:1700,name:"Bookshelf"},[E.LabPotionShelf1]:{x:-1790,y:1700,name:"Potion Shelf"},[E.MansionPicture]:{x:-1233,y:-580,scale:1.2,angle:5,name:"Picture",image:"picture",origin:{x:0,y:0},initializeOnStart:!0},[E.MansionHole]:{x:-1870,y:-490,name:"Hole in the Wall"},[E.Bed]:{x:2670,y:-1530,scale:{x:7,y:2}}},Tr={octave:3.5,speed:1,volume:1,type:"sine"},Pr={octave:3.7,speed:.75,volume:.9},Or={[P.Inventor]:{octave:3.3,speed:1,volume:1.8},[P.Stranger]:{octave:2.8,speed:1.1,volume:2.6},[P.Sphinx]:{octave:2.5,speed:2,volume:2,type:"triangle"},[P.Mayor]:{octave:3.9,speed:.8,volume:.8}},Cr={[E.ClockTower]:{octave:2.1,speed:1.5,volume:1.5,type:"sawtooth"}},Er=Q(Y(X));function Ir(t,e,i){const s=t.cameras.main;s.fadeEffect&&1===s.fadeEffect.progress&&!1===s.fadeEffect.direction?i&&t.time.delayedCall(e,(()=>i())):s.fadeIn(e,Er.red,Er.green,Er.blue,((t,e)=>{e>=1&&i&&i()}))}function Ar(t,e,i){const s=t.cameras.main;s.fadeEffect&&1===s.fadeEffect.progress&&!0===s.fadeEffect.direction?i&&t.time.delayedCall(e,(()=>i())):s.fadeOut(e,Er.red,Er.green,Er.blue,((t,e)=>{e>=1&&i&&i()}))}function Mr(t,e,i){return a.Math.Distance.BetweenPointsSquared(t,e)<i*i}function Rr(t,e,i){return!!(e.inventory.initialized&&e.quests.initialized&&e.journal.initialized)&&Mr(t,e,i||1e3)}function jr(t,e,i){var s,n;t.player.message.setDialog(),t.player.message.setVisible(!1),null==(s=t.gamepad)||s.setAlpha(0),null==(n=t.gamepad)||n.resetButtons(),t.scene.pause(),t.scene.launch(e,{player:t.player,...i})}function Lr(t,e,i){return e&&Object.values(e).includes(t)?`${i}.${Object.keys(e).find((i=>e[i]===t))}`:t}function _r(t){return t.replace(/([A-Z]+|[0-9]+)/g," $1").replace(/\s*([\(\[\{])\s*/g," $1").replace(/\s*([\)\]\}])\s*/g,"$1 ").replace(/\s+/g," ").trim()}let Fr;const Dr=document.documentElement;class zr extends a.GameObjects.GameObject{constructor(t,i,s,n,r,o){super(t,"DebugLight"),e(this,"x"),e(this,"y"),e(this,"light"),e(this,"debug"),t.add.existing(this),this.light=t.lights.addLight(i,s,n,r,o),this.debug=t.add.graphics({x:i,y:s}).setDepth(Ms.Debug),this.debug.lineStyle(3,r),this.debug.name="DebugLightGraphics",this.x=i,this.y=s,w.debug&&this.debug.strokeCircle(0,0,n)}setPosition(t,e){this.light.setPosition(t,e),this.debug.setPosition(t,e),this.x=t,this.y=e}setIntensity(t){this.light.setIntensity(t)}setVisible(t){this.light.setVisible(t)}destroy(t){var e,i;super.destroy(t),this.debug.destroy(),null==(i=null==(e=this.scene)?void 0:e.lights)||i.removeLight(this.light)}}var Br=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Continue=4]="Continue",t[t.Back=5]="Back",t[t.Shift=6]="Shift",t))(Br||{});class Wr{constructor(t){e(this,"scene"),e(this,"keys",Object.keys(Br).map(Number).reduce(((t,e)=>({...t,[e]:!1})),{})),this.scene=t,this.listener(2,"LEFT"),this.listener(3,"RIGHT"),this.listener(0,"UP"),this.listener(1,"DOWN"),this.listener(0,"W","UP"),this.listener(2,"A","LEFT"),this.listener(1,"S","DOWN"),this.listener(3,"D","RIGHT"),this.listener(4,"SPACE","ENTER"),this.listener(4,"ENTER"),this.listener(5,"BACKSPACE"),this.listener(6,"SHIFT")}listener(t,e,i){var s,n;null==(s=this.scene.input.keyboard)||s.on(`keydown-${e}`,(()=>{var e;i&&(null==(e=this.scene.input.keyboard)||e.emit(`keydown-${i}`)),this.keys[t]=!0})),null==(n=this.scene.input.keyboard)||n.on(`keyup-${e}`,(()=>{var e;i&&(null==(e=this.scene.input.keyboard)||e.emit(`keyup-${i}`)),this.keys[t]=!1}))}resetKeys(){Object.entries(this.keys).forEach((([t,e])=>this.keys[Number(t)]=!1))}}class Nr extends a.Physics.Arcade.Image{constructor(t,i,s){const n=Sr[i],{x:r,y:o,image:a}=n;super(t,r,o,"characters",a),e(this,"npcType"),e(this,"npcData"),e(this,"player"),e(this,"light"),e(this,"particles"),e(this,"moveTimeline"),e(this,"disabled",!1),e(this,"initialized",!1),this.name=`NPC-${i}`,this.npcData=n,this.npcType=i,this.player=s,this.setDepth(Ms.Npcs),_a(this,n)}lazyInit(t){if(!t&&(this.initialized||!Rr(this,this.player)))return;this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0});const{x:e,y:i,light:s,particles:n,onCreate:r}=this.npcData,o=s||1,a=!(K(this.scene.lights.ambientColor)===Y(B));w.debug?(this.light=new zr(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,o),this.light.light.setVisible(a)):(this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,o),this.light.setVisible(a)),n&&(this.particles=this.scene.add.particles(e,i,"props",{frame:"warp",...n}).setName(`NPC-${this.npcType}-Particles`)),r&&r(this),this.initialized=!0,this.handleMovement(!0)}update(t,e){this.lazyInit(),this.handleMovement()}handleMovement(t=!1){var e,i,s,n;if(!this.initialized)return;const r=this.npcData.positionData;if(r&&!this.moveTimeline){const n={x:this.npcData.x,y:this.npcData.y};let o;for(let t=0;t<r.length;t++){const{x:e,y:i,condition:s}=r[t];if(s(this)){n.x=e,n.y=i,o=r[t].onMove;break}}if(Math.abs(this.x-n.x)>1||Math.abs(this.y-n.y)>1)if(o&&o(this),t)this.setPosition(n.x,n.y);else{const t=this.light instanceof zr?null==(i=null==(e=this.light)?void 0:e.light)?void 0:i.intensity:null==(s=this.light)?void 0:s.intensity,r=200;this.moveTimeline=this.scene.add.timeline([{at:0,tween:{targets:this,alpha:0,duration:r,onUpdate:(e,i,s,n)=>{var r;return null==(r=this.light)?void 0:r.setIntensity(n*t)},onComplete:()=>{var e,i;null==(e=this.light)||e.setVisible(!1),null==(i=this.light)||i.setIntensity(t)}}},{at:r+100,tween:{targets:this,alpha:1,duration:r,delay:r,onStart:()=>{var t,e;null==(t=this.light)||t.setIntensity(0),et(this.scene)&&(null==(e=this.light)||e.setVisible(!0))},onUpdate:(e,i,s,n)=>{var r;return null==(r=this.light)?void 0:r.setIntensity(n*t)}},run:()=>this.setPosition(n.x,n.y)}]).play().once("complete",(()=>this.moveTimeline=void 0))}}null==(n=this.light)||n.setPosition(this.x,this.y)}setPosition(t,e,i,s){return super.setPosition(t,e,i,s),this.light&&t&&e&&this.light.setPosition(t,e),this}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return x.None;if(t[Br.Continue]){const t=ka(wa[this.npcType],this.player,this);if(t&&(null==t?void 0:t.messages.length)>0){const e=this.npcData.portrait.length>0;return this.player.message.setDialog(t,e?this:void 0),x.Talked}}return x.None}getButtonPrompt(){return[`Talk to ${this.npcData.name}`,"Press [CONTINUE]"]}}const Gr=2*Math.PI;class Hr extends a.GameObjects.Graphics{constructor(t,i,s=!1){super(t),e(this,"player"),e(this,"small"),e(this,"angle1",0),e(this,"angle2",1),e(this,"angle3",4),e(this,"update1",!1),e(this,"update2",!1),e(this,"update3",!1),this.name="ClockHands",t.add.existing(this),this.player=i;const n=s?897:842,r=s?247:-2107;this.setPosition(n,r),this.setDepth(Ms.Npcs),this.updateHands(),this.small=s}update(t){if(!Mr(this,this.player,w.width/1.5))return;this.update1&&(this.angle1=Gr*(t/6e4)*45),this.update2&&(this.angle2=Gr*(t/36e5)*45),this.update3&&(this.angle3=Gr*(t/432e5)*45),this.clear(),this.fillStyle(Y("#224477")),this.fillCircle(0,0,5);const e=this.small?.4:1,i=this.small?1.35:1,s=this.small?.7:1,n=this.small?4:6,r=this.small?1:2;[n,r].forEach((t=>{this.lineStyle(t,Y(t===r?"#4477aa":G)),this.lineBetween(0,0,50*Math.cos(this.angle1)*e,50*Math.sin(this.angle1)*e),this.lineBetween(0,0,40*Math.cos(this.angle2)*e,40*Math.sin(this.angle2)*e),this.lineBetween(0,0,25*Math.cos(this.angle3)*e*i,25*Math.sin(this.angle3)*e*i)})),this.lineStyle(this.small?3:5,Y(G));for(let o=0;o<12;o++){const t=Gr*(o/12),i=50*Math.cos(t)*e*s,n=50*Math.sin(t)*e*s;this.lineBetween(i,n,1.5*i,1.5*n)}}updateHands(){Aa(this.player,C.ClockFirstGear)&&(this.update1=!0),Aa(this.player,C.ClockSecondGear)&&(this.update2=!0)}}class Ur extends a.Physics.Arcade.Image{constructor(t,i,s){const{x:n,y:r,image:o}=kr[i];super(t,n,r,o?"props":"",o||""),e(this,"propType"),e(this,"player"),e(this,"particles"),e(this,"clock"),e(this,"initialized",!1),e(this,"disabled",!1),this.name=`Prop-${i}`,this.propType=i,this.player=s,this.setScale(o?.35:2).setDepth(Ms.Items),o||w.debug||this.setAlpha(0),_a(this,kr[i]),i===E.MansionPicture&&this.resetPostPipeline()}lazyInit(t){if(!t&&(this.initialized||!Rr(this,this.player)))return;if(this.checkDestroyed())return;this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0});const{particles:e,onCreate:i}=kr[this.propType];e&&(this.particles=this.scene.add.particles(this.x,this.y,"props",{frame:"warp",...e}).setDepth(Ms.Items).setName(`Prop-${this.propType}-Particles`)),this.propType===E.MansionPicture&&this.scene.add.image(this.x,this.y,"props","safe").setOrigin(0,0).setScale(.9).setName("Prop-Safe").setPipeline("Light2D"),this.propType===E.ClockTower&&(this.clock=new Hr(this.scene,this.player)),i&&i(this),this.initialized=!0}onInteract(t){if(this.player.message.visible||Date.now()<this.player.message.interactionTimeout)return x.None;if(t[Br.Continue]){const t=ka(Sa[this.propType]||[],this.player,this);if(t&&(null==t?void 0:t.messages.length)>0)return this.player.message.setDialog(t,this,kr[this.propType].portrait||"player_portrait"),x.Prop}return x.None}checkDestroyed(){let t=!1;return this.propType===E.LabHatch&&Aa(this.player,C.AlchemyLabFound)&&(t=!0),this.propType===E.Chest&&Pa(this.player,k.Gear1)&&(t=!0),t&&this.destroy(),t}getButtonPrompt(){const t=ka(Sa[this.propType]||[],this.player,this);let e=kr[this.propType].name||E[this.propType];e=_r(e),this.propType===E.MansionPicture&&Aa(this.player,C.SafeDiscovered)&&(e="Safe");let i="Inspect";return this.propType===E.Bed&&(i="Rest in"),t&&(null==t?void 0:t.messages.length)>0?[`${i} ${e}`,"Press [CONTINUE]"]:""}update(t){var e;this.lazyInit(),null==(e=this.clock)||e.update(t)}}function $r(t){var e,i;const s=t.x-t.previousPosition.x;Math.abs((null==(e=t.body)?void 0:e.velocity.x)||0)>1||Math.abs((null==(i=t.body)?void 0:i.velocity.y)||0)>1||Math.abs(s)>1?t.anims.resume():t.anims.pause();const n=s<0;Math.abs(s)>0&&(t.flipX=t.rewinding?!n:n),t.setAngle(t.flipX?-5:5)}w.dayMinutes,a.GameObjects.Container;class Vr extends a.GameObjects.Text{constructor(t){super(t,w.width/2,w.height-50,"",Rs),this.setOrigin(.5).setBackgroundColor("#"+G).setPadding(10,5).setAlign("center").setAlpha(.8).setScrollFactor(0).setDepth(Ms.Overlay).setVisible(!1),t.add.existing(this)}}const Xr={[k.Wrench]:{x:0,y:0,image:"wrench",name:"Old Wrench"},[k.Gear1]:{x:0,y:0,image:"gear",name:"Shiny Gear"},[k.Key]:{x:0,y:0,image:"key",name:"Rusty Key",skipLighting:!0},[k.HerbRed]:{x:-200,y:1730,image:"herb_red",name:"Crimson Starbloom"},[k.HerbGreen]:{x:5650,y:985,image:"herb_green",name:"Green Writhewood"},[k.HerbBlue]:{x:1535,y:875,image:"herb_blue",name:"Blue Plumed Frond"},[k.Potion]:{x:0,y:0,image:"potion",name:"Strange Potion"},[k.Gear2]:{x:0,y:0,image:"gear2",name:"Old Gear"}};class qr extends a.GameObjects.Container{constructor(t){super(t,0,0),e(this,"inventory",[]),e(this,"text"),e(this,"rect"),e(this,"initialized",!1),this.setScrollFactor(0).setDepth(Ms.Ui).setVisible(!1)}createUI(){this.initialized||(this.scene.add.existing(this),this.rect=this.scene.add.rectangle(0,0,0,0,Y(N)).setStrokeStyle(2,Y(B)).setAlpha(.75).setOrigin(0),this.add(this.rect),this.text=this.scene.add.text(10,4,"Inventory",{...Rs,fontSize:32}),this.add(this.text),this.initialized=!0)}addItem(t,e){if(this.initialized||this.createUI(),this.inventory.push(t),!t.used){const e=this.scene.add.image(0,0,"items",Xr[t.type].image).setScale(.35);t.type===k.Key&&e.setAngle(45),this.add(e)}this.updateItems();const i=ja(this.scene,t.type);null==i||i.destroy(),e||(new Fa(this.scene,`New item added: ${Xr[t.type].name}`),Ha(this.scene))}useItem(t){var e;this.initialized||this.createUI();const i=this.inventory.find((e=>e.type===t));i&&(i.used=!0,null==(e=this.getAll().find((e=>{var i,s;return((null==(i=e.frame)?void 0:i.name)||(null==(s=e.texture)?void 0:s.key))===Xr[t].image})))||e.destroy()),this.updateItems()}updateItems(){var t;this.initialized||this.createUI();let e=0;this.getAll().forEach((t=>{if(t instanceof a.GameObjects.Image){const i=32+50*e;t.setPosition(i,68),e++}})),this.setVisible(this.inventory.length>0);const i=Math.max((null==(t=this.text)?void 0:t.displayWidth)+18,50*e+12);this.setPosition(w.width-i-20,20),this.rect.setSize(i,102)}}const Yr={[C.FixTheClock]:{description:"The inventor gave me a wrench to help fix the clock tower. I will also need three gears to repair it."},[C.MetTheMayor]:{description:"I have met the mayor of the town. She told me about the old clock tower. I should see if I can use the gear I found to try and fix it.",warpAdd:S.ClockSquareNorth},[C.ClockFirstGear]:{description:"I found the first gear for the clock tower and placed it into the clock face. I still need two more gears to fix it."},[C.AlchemyLabFound]:{description:"I found a secret alchemy lab. I wonder what the previous alchemist was brewing up.",warpAdd:S.LabHatch},[C.AlchemySetFixed]:{description:"With the alchemy set fixed, I can now attempt to create the brew mentioned in the old journal."},[C.ExtraPotionInformation]:{description:'I found an extra journal entry with more information on the potion. It stated the name of the potion was the "Exlixir of Sight". This potion must be the key to finding a gear.'},[C.SafeDiscovered]:{description:"I discovered a safe in the abandonded mansion. I wonder what secrets it holds."},[C.ClockSecondGear]:{description:"I found the second gear for the clock tower inside a safe, which was located within the abandoned mansion. I still need one more gear to fix it."}};let Kr=1,Qr=1;class Jr extends a.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,renderTarget:!0,fragShader:"precision mediump float;\n\nuniform float     uAlpha;\nuniform float     uChromaticAberration;\n\nuniform sampler2D uMainSampler;\n\nvarying vec2 outTexCoord;\n\n// slight modifications made to original shader\n// use alpha channel for fragColor + changed uniform names\n\n// original shader from: https://www.shadertoy.com/view/WsVSzV\n// tips for chromatic aberration: https://lettier.github.io/3d-game-shaders-for-beginners/chromatic-aberration.html\n\nconst float warp = 0.35;     // simulate curvature of CRT monitor (larger number = more curvature)\nconst float scan = 0.75;    // simulate darkness between scanlines\nconst float scanSize = 0.85; // size of scanlines [0.0 - 2.0] (smaller number = taller scanlines)\n\n// TODO: Remove hardcoded screen size\nvec2 pixels = vec2(floor(960. / uChromaticAberration / 2.), floor(540. / uChromaticAberration / 2.));\n\nfloat chromaticAberration = 0.15 * uAlpha * uChromaticAberration;\nfloat redOffset   =  0.006 * chromaticAberration;\nfloat greenOffset =  0.003 * chromaticAberration;\nfloat blueOffset  = -0.003 * chromaticAberration;\n\nvec4 mainImage(in vec2 fragCoord, in vec2 uv) {\n  if (uAlpha <= 0.0) {\n    return texture2D(uMainSampler, uv);\n  }\n\n  // squared distance from center\n  vec2 dc = abs(0.5-uv);\n  dc *= dc;\n\n  // warp the fragment coordinates\n  uv.x -= 0.5; uv.x *= 1.0+(dc.y*(0.3*warp)); uv.x += 0.5;\n  uv.y -= 0.5; uv.y *= 1.0+(dc.x*(0.4*warp)); uv.y += 0.5;\n\n  vec2 chromaticOffset = vec2((abs(0.5-uv) + 0.5) * 2.);\n\n  if (uChromaticAberration > 1.) {\n    uv.x -= mod(uv.x, 1.0/pixels.x);\n    uv.y -= mod(uv.y, 1.0/pixels.y);\n  }\n\n  vec4 color;\n  color.r = texture2D(uMainSampler,uv + vec2(redOffset * chromaticOffset)).r;\n  color.g = texture2D(uMainSampler,uv + vec2(greenOffset * chromaticOffset)).g;\n  color.b = texture2D(uMainSampler,uv + vec2(blueOffset * chromaticOffset)).b;\n  color.a = texture2D(uMainSampler,uv).a;\n\n  // sample inside boundaries, otherwise set to black\n  if (uv.y > 1.0 || uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0) {\n      return vec4(0.0);\n  } else {\n    // determine if we are drawing in a scanline\n    float apply = abs(sin(fragCoord.y * scanSize)*0.5*scan);\n\n    apply = uAlpha * apply;\n\n    // sample the texture\n    return vec4(mix(color.rgb,vec3(0.0), apply), color.a);\n  }\n}\n\nvoid main(void) {\n  gl_FragColor = mainImage(gl_FragCoord.xy, outTexCoord);\n}"})}onPreRender(){this.set1f("uAlpha",Kr),this.set1f("uChromaticAberration",Qr)}}class Zr extends a.Plugins.ScenePlugin{boot(){var t;Kr=1,Qr=1,null==(t=this.systems)||t.events.on("start",this.applyPipeline,this);const{save:e}=za();to(e.settings.useShader)}applyPipeline(){var t,e;null==(t=this.scene)||t.cameras.main.setPostPipeline("CRTPipeline");const i=null==(e=this.scene)?void 0:e.cameras.main.getPostPipeline(Jr);null==i||i.bootFX()}}function to(t){w.useShader=void 0!==t?t:!w.useShader,Kr=w.useShader?1:0}function eo(t){Qr=t}let io=0;class so extends a.Renderer.WebGL.Pipelines.PostFXPipeline{constructor(t){super({game:t,fragShader:"precision mediump float;\n\nuniform float     uAlpha;\nuniform sampler2D uMainSampler;\n\nvarying vec2 outTexCoord;\n\nvoid main(void)\n{\n  vec4 baseColor = vec4(texture2D(uMainSampler, outTexCoord).rgba);\n  vec4 newColor = baseColor;\n  newColor.g *= 1.25;\n  newColor.r *= 2.5;\n  newColor.b *= 3.;\n\n  gl_FragColor = mix(baseColor, newColor, uAlpha);\n}"})}onPreRender(){this.set1f("uAlpha",io)}}function no(t,e,i=!1){const s=e?.85:0;if(eo(1),io===s)return;if(i)return void(io=s);const n=e?0:1750;t.sound.playAudioSprite("sfx","xray",{rate:.85,delay:n/1e3}),t.tweens.addCounter({from:io,to:e?.85:0,onUpdate:t=>io=t.getValue(),duration:e?2500:1500,delay:n,ease:e?"Bounce":void 0}),t.tweens.addCounter({from:1,to:15,onUpdate:t=>eo(t.getValue()),ease:"Bounce",duration:1e3,delay:n,yoyo:!0})}class ro extends a.GameObjects.Image{constructor(t,i){super(t,w.width-50,w.height-55,"items","journal"),e(this,"player"),e(this,"journal",[]),e(this,"unread"),e(this,"initialized",!1),this.player=i}createUI(){var t;this.initialized||(this.setScrollFactor(0).setDepth(Ms.Ui).setScale(.5).setAlpha(0).setInteractive({useHandCursor:!0}).setActive(!1),this.on("pointerdown",this.openJournal),this.scene.add.existing(this),this.unread=this.scene.add.ellipse(w.width-21,w.height-89,20,20,11141120).setStrokeStyle(2,Y(G)).setScrollFactor(0).setDepth(Ms.Ui2).setVisible(!1),null==(t=this.scene.input.keyboard)||t.on("keydown-J",(()=>{this.openJournal()})),this.initialized=!0)}addEntry(t,e){this.initialized||this.createUI(),this.journal.includes(t)||(0===this.journal.length&&(this.scene.tweens.add({targets:this,alpha:1,duration:300}),this.setActive(!0)),this.journal.push(t),e||(this.unread.setVisible(!0),new Fa(this.scene,"New journal entry added!")),this.handleSideEffects(t,e||!1))}openJournal(){this.initialized||this.createUI(),0!==this.journal.length&&jr(this.scene,"JournalDialog")}handleSideEffects(t,e){const{warpAdd:i}=Yr[t];if(i&&Ra(this.scene,i,!1),t===C.ClockFirstGear||t===C.ClockSecondGear){Ma(this.scene,Hr).forEach((t=>t.updateHands()));const i=t===C.ClockFirstGear&&1===this.player.gameState.data.day,s=t===C.ClockSecondGear&&2===this.player.gameState.data.day;(i||s)&&this.player.gameState.updateData({night:!0},e)}t!==C.ExtraPotionInformation||Pa(this.player,k.Gear2)||no(this.scene,!0,e),t===C.SafeDiscovered&&function(t,e){const i=La(t.scene,E.MansionPicture);e?null==i||i.setAngle(97):(t.setActive(!1),null==i||i.scene.tweens.add({targets:i,angle:97,duration:1500,onComplete:()=>{t.setActive(!0),t.message.setDialog({messages:["A sturdy looking safe was hidden behind the picture.","It looks like it requires a special key to open."]},t)}}))}(this.player,e),e||Ha(this.scene)}}const oo={[T.ForestGear]:{description:"Search the forest for clues",warpAdd:S.TownEast,warpComplete:S.TownNorth},[T.SphinxRiddle]:{description:"Solve the Sphinx riddle"},[T.InvestigateTownWest]:{description:"Investigate the western mansion",warpAdd:S.TownWest},[T.ExploreLab]:{description:"Explore the hidden alchemy lab"},[T.FindPotionIngredients]:{description:"Find the 3 potion ingredients"}};class ao extends a.GameObjects.Container{constructor(t,i){super(t,w.width-330-20,120),e(this,"player"),e(this,"quests",[]),e(this,"questRectangle"),e(this,"initialized",!1),this.player=i}createUI(){if(this.initialized)return;this.scene.add.existing(this),this.setScrollFactor(0).setDepth(Ms.Ui).setVisible(!1),this.questRectangle=this.scene.add.rectangle(0,0,330,60,Y(N)).setStrokeStyle(2,Y(B)).setAlpha(.75).setOrigin(0),this.add(this.questRectangle);const t=this.scene.add.text(10,4,"Quests",{...Rs,fontSize:32});this.add(t),this.initialized=!0}addQuest(t,e){this.initialized||this.createUI(),this.quests.find((e=>e.id===t.id))||(this.quests.push(t),this.add(this.scene.add.text(0,0,oo[t.id].description,{...Rs,fontSize:20})),this.updateQuests(),e||new Fa(this.scene,`New quest added: ${oo[t.id].description}`),this.handleSideEffects(t.id,t.completed,e))}updateExistingQuest(t,e){this.initialized||this.createUI();const i=this.quests.find((e=>e.id===t));i?(!i.completed&&e&&new Fa(this.scene,`Quest completed: ${oo[i.id].description}`),i.completed=e,this.updateQuests(),this.handleSideEffects(t,e)):console.error(`Quest ${t} not found in player quests`)}updateQuests(){this.initialized||this.createUI();const t=this.quests.filter((t=>!t.completed));let e=1,i=0;this.getAll().forEach((s=>{if(s instanceof a.GameObjects.Text)if(t.find((t=>s.text===oo[t.id].description))||"Quests"===s.text){if("Quests"!==s.text){const t=14+30*e;s.setPosition(10,t),e++,i=Math.max(i,s.width)}}else s.destroy()}));const s=i+20;this.setX(w.width-20-s),this.setY(this.scene.player.inventory.inventory.length>0?140:20),this.setVisible(t.length>0),this.questRectangle.setSize(s,50+30*t.length)}handleSideEffects(t,e,i){const{warpAdd:s,warpComplete:n}=oo[t];if(s&&Ra(this.scene,s,!1),e&&n&&Ra(this.scene,n,!1),t===T.FindPotionIngredients&&!e){const t=this.player.scene;t.interactiveObjects.add(new Ta(t,k.HerbGreen,this.player)),t.interactiveObjects.add(new Ta(t,k.HerbBlue,this.player))}t!==T.ExploreLab||e||xo(this.player),i||Ha(this.scene)}reset(){this.quests=[],this.updateQuests()}}const lo=1.35*(w.fastMode?350:175),ho=new a.Math.Vector2(920,1500);class co extends a.Physics.Arcade.Sprite{constructor(t){super(t,ho.x,ho.y,"character",0),e(this,"scene"),e(this,"keys"),e(this,"light"),e(this,"debug"),e(this,"buttonPrompt"),e(this,"interactive"),e(this,"interactionTimeout",0),e(this,"message"),e(this,"inventory"),e(this,"quests"),e(this,"journal"),e(this,"gameState"),e(this,"previousPosition",new a.Math.Vector2),e(this,"walkingSound"),e(this,"lastPlayedSound",0),e(this,"counter",0),e(this,"history",[]),e(this,"rewinding",!1),e(this,"unlockCamera",!1),this.name="Player",this.scene=t,t.add.existing(this),t.physics.add.existing(this),w.debug&&this.setInteractive(),this.setBodySize(48,74).setDepth(Ms.Player).setScale(1.35).setPipeline("Light2D").setPostPipeline("XRayPipeline"),w.debug?(this.light=new zr(t,this.x,this.y,200,16768443,1),this.debug=t.add.circle(this.x,this.y,3,16711935).setDepth(Ms.Debug)):this.light=t.lights.addLight(this.x,this.y,200,16768443,1),function(t){const e=1e3/(w.prod?6:9),i=t.anims.generateFrameNumbers("character",{start:0,end:5});i.forEach((t=>t.duration=e)),t.anims.create({key:"walk",frames:i,repeat:-1}),t.anims.play("walk")}(this),this.keys=new Wr(t),this.message=new fo(t,this),this.inventory=new qr(t),this.quests=new ao(t,this),this.journal=new ro(t,this),this.gameState=new $a(t,this),this.walkingSound=t.sound.addAudioSprite("sfx"),w.perfTest&&t.time.delayedCall(1e3,(()=>{this.setVelocityX(lo),t.time.addEvent({delay:1e3,callback:()=>this.setVelocityX(this.body?-this.body.velocity.x:0),loop:!0})}))}update(t,e){var i,s,n,r,o;const a=this.interactive&&!this.message.visible&&(null==(s=null==(i=this.buttonPrompt)?void 0:i.text)?void 0:s.length)>0||!1;a&&!this.buttonPrompt&&(this.buttonPrompt=new Vr(this.scene)),null==(n=this.buttonPrompt)||n.setVisible(a),w.perfTest||(this.setVelocity(0),this.rewinding?this.counter+e>31.25?(this.rewind(),this.counter=0):this.counter+=e:this.checkInteraction()||this.message.visible||this.updateVelocity()),w.debug&&this.setTint(this.interactive?16755370:16777215),$r(this);const l=Math.abs((null==(r=this.body)?void 0:r.velocity.x)||0)>1||Math.abs((null==(o=this.body)?void 0:o.velocity.y)||0)>1;l&&!this.walkingSound.isPlaying&&Date.now()-this.lastPlayedSound>150?this.walkingSound.play("ladder",{loop:!0,rate:.75,volume:.4}):l||(this.walkingSound.stop(),this.lastPlayedSound=Date.now()),this.previousPosition.set(this.x,this.y)}postUpdate(){var t;this.light.setPosition(this.x,this.y-20),w.debug&&(null==(t=this.debug)||t.setPosition(this.x,this.y))}checkInteraction(){var t;let e;return this.interactive&&Date.now()>this.interactionTimeout&&(e=this.interactive.onInteract(this.keys.keys),e!==x.None&&(this.interactionTimeout=Date.now()+((null==(t=this.interactive)?void 0:t.interactionTimeout)||500),this.keys.resetKeys(),e===x.Teleported&&(this.interactive=void 0))),e}updateVelocity(){const t=this.keys.keys;let e=1;!w.prod&&t[Br.Shift]&&(e=2),this.anims.timeScale=e;const i=lo*e;t[Br.Left]&&this.setVelocityX(-i),t[Br.Right]&&this.setVelocityX(i),w.debug&&!this.interactive&&(t[Br.Up]&&this.setVelocityY(-i),t[Br.Down]&&this.setVelocityY(i)),t[Br.Left]&&t[Br.Right]&&this.setVelocityX(0)}setY(t){return this.setPosition(this.x,t),this}setPosition(t,e,i,s){return super.setPosition(t,e,i,s),void 0!==t&&void 0!==e&&this.light&&this.light.setPosition(t,e-20),this}record(){var t;this.history.length<1e3?this.history.push(new a.Math.Vector3(this.x,this.y,(null==(t=this.body)?void 0:t.velocity.x)||0)):console.warn("Max history reached")}rewind(){const t=this.history.pop();t&&(this.x=t.x,this.y=t.y,this.setVelocityX(-t.z))}setRewind(t){this.rewinding=t,this.counter=0}reset(){this.quests.reset(),this.setPosition(ho.x,ho.y),this.flipX=!1,this.setVelocity(0)}setInteractiveObject(t){var e,i,s;this.interactive=t,(null==t?void 0:t.onCollided)&&t.onCollided();const n=null==(e=null==t?void 0:t.getButtonPrompt)?void 0:e.call(t);n&&!this.buttonPrompt&&(this.buttonPrompt=new Vr(this.scene)),null==(i=this.buttonPrompt)||i.setText(n),null==(s=this.buttonPrompt)||s.setVisible(!this.message.visible&&(null==n?void 0:n.length)>0)}}class uo extends a.GameObjects.Text{constructor(t,i,s,n,r,o){super(t,i,s,n,{...Rs,fontSize:48,backgroundColor:`#${N}`,padding:{x:15,y:10},...o}),e(this,"onClick"),e(this,"disabled"),e(this,"selected"),this.setOrigin(.5),t.add.existing(this),this.onClick=()=>{this.disabled||(t.sound.playAudioSprite("sfx","button"),this.setSelected(!1),r(this))},this.disabled=!1,this.selected=!1,this.setInteractive({useHandCursor:!0}).setScrollFactor(0),this.on("pointerdown",(()=>{this.onClick(this)})),this.on("pointerover",(()=>{this.disabled||this.selected||this.setTint(12303291)})),this.on("pointerout",(()=>{this.disabled||this.selected||this.setTint(16777215)}))}disable(){this.disabled=!0,this.selected=!1,this.disableInteractive(),this.setTint(6710886)}enable(){this.disabled=!1,this.selected=!1,this.setInteractive(),this.setTint(16777215)}setSelected(t){this.selected=t,this.setTint(t?Y(q):16777215)}}class po extends uo{constructor(t,e,i,s,n,r,o,a){super(t,e,i,s,n,{fontSize:32,align:"center",...r}),this.setOrigin((null==a?void 0:a.x)||0,(null==a?void 0:a.y)||0),null!==o&&this.setFixedSize((null==o?void 0:o.x)||250,(null==o?void 0:o.y)||50)}}class go extends a.GameObjects.Container{constructor(t,i,s){var n,r,o;super(t,i,s),e(this,"buttons",[]),e(this,"activeIndex",-1),t.add.existing(this).setScrollFactor(0),null==(n=t.input.keyboard)||n.on("keydown-UP",(()=>{this.setActiveButton(Math.max(0,this.activeIndex-1))})),null==(r=t.input.keyboard)||r.on("keydown-DOWN",(()=>{this.setActiveButton(Math.min(this.activeIndex+1,this.buttons.length-1))})),null==(o=t.input.keyboard)||o.on("keydown-ENTER",(()=>{var t;null==(t=this.buttons[this.activeIndex])||t.onClick()}))}addButton(t){this.add(t),this.buttons.push(t),1===this.buttons.length&&this.setActiveButton(0),t.on("pointerover",(()=>{this.setActiveButton(-1)}))}setActiveButton(t){var e,i;null==(e=this.buttons[this.activeIndex])||e.setSelected(!1),this.activeIndex=t,null==(i=this.buttons[this.activeIndex])||i.setSelected(!0)}clearButtons(){this.buttons=[],this.activeIndex=-1,this.removeAll(!0)}}const yo=20;class fo extends a.GameObjects.Container{constructor(t,i){var s,n;super(t),e(this,"textWidth"),e(this,"textHeight"),e(this,"player"),e(this,"target"),e(this,"background"),e(this,"npcName"),e(this,"text"),e(this,"portrait"),e(this,"arrow"),e(this,"arrowTween"),e(this,"options"),e(this,"optionsContainer"),e(this,"dialog"),e(this,"messageIndex"),e(this,"interactionTimeout"),e(this,"initialized",!1),e(this,"animating",!1),e(this,"stopAnimation"),e(this,"stopAudio");const{width:r,height:o}=w;this.textWidth=r-135-80,this.textHeight=130,this.setScrollFactor(0),this.setPosition(yo,o-yo-170),this.setDepth(Ms.Overlay),this.setAlpha(0),this.setVisible(!1),i&&(this.player=i),null==(s=this.scene.input.keyboard)||s.on("keydown-ENTER",(()=>{this.options||this.updateDialog()})),null==(n=this.scene.input.keyboard)||n.on("keydown-BACKSPACE",(()=>{this.options||this.updateDialog()}))}createUI(){this.scene.add.existing(this),this.npcName=new a.GameObjects.Text(this.scene,170,15,"",{...Rs,color:"#"+W}),this.text=new wr(this.scene,170,60,"",{fontFamily:Rs.fontFamily,fontSize:Rs.fontSize,color:`#${B}`}),this.scene.add.existing(this.text),this.text.width=this.textWidth,this.text.height=this.textHeight,this.text.setOrigin(0).setMaxLines(4).setWrapMode("word"),this.text.parser.setDelimiters("<",">"),this.portrait=this.scene.add.image(yo,yo,"characters","").setOrigin(0).setScale(1.5),this.background=this.scene.add.rectangle(0,0,w.width,w.height,0,0).setOrigin(0).setDepth(Ms.Ui).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.options||this.updateDialog()})).setVisible(!1);const t=this.scene.add.rectangle(0,0,w.width-40,170,Y(G),.9).setStrokeStyle(2,Y(W),1).setOrigin(0,0).setScrollFactor(0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.options||this.updateDialog()}));this.optionsContainer=new go(this.scene).setDepth(Ms.Overlay),this.arrow=this.scene.add.image(w.width-40-20,148,"icons","chevron-down").setScale(.5),this.arrowTween=this.scene.tweens.add({targets:this.arrow,y:154,duration:700,ease:"Sine.easeIn",yoyo:!0,repeat:-1}),this.add([t,this.npcName,this.text,this.portrait,this.arrow])}setDialog(t,e,i){var s,n,r;if(this.npcName||this.createUI(),this.animating&&(null==(s=this.stopAudio)||s.call(this),null==(n=this.stopAnimation)||n.call(this),this.animating=!1,this.resetArrow()),this.setVisible(!0),this.background.setVisible(!0),this.scene.tweens.add({targets:this,alpha:void 0!==t?1:0,duration:125,onComplete:()=>this.setVisible(void 0!==t)}),this.target=e,this.messageIndex=0,this.dialog=t,this.interactionTimeout=Date.now()+350,null==(r=this.scene.gamepad)||r.setAlpha(this.dialog?0:1),!t)return;let o=i;if(e instanceof Nr&&(o=Sr[e.npcType].portrait),e instanceof co&&(o="player_portrait"),this.npcName.setVisible(!1),o){let t;this.portrait.setVisible(!0),this.portrait.setFrame(o),"player_portrait"===o?t="Rosie Vale":e instanceof Nr?t=Sr[e.npcType].name:e instanceof Ur&&(t=kr[e.propType].name),t&&(this.npcName.setVisible(!0),this.npcName.setText(t)),this.text.setPosition(170,yo+(t?40:0)).setWordWrapWidth(this.textWidth).setFixedSize(this.textWidth,this.textHeight)}else this.portrait.setVisible(!1),this.text.setPosition(yo,yo).setWordWrapWidth(170+this.textWidth).setFixedSize(170+this.textWidth,this.textHeight);this.showMessage()}showMessage(){var t,e,i,s;const n=this.getMessages(),r=n&&n[this.messageIndex];if(this.arrow.setAlpha(0),r){let n;this.text.setText(r),"player_portrait"===(null==(e=null==(t=this.portrait)?void 0:t.frame)?void 0:e.name)&&(n=Pr),this.target instanceof Nr&&(n=Or[this.target.npcType]),this.target instanceof Ur&&(n=Cr[this.target.propType]),n||(n=Tr);const{promise:o,stop:a}=function(t,e,i,s){return 0===i?{promise:Promise.resolve()}:(s.sound.unlock(),((t,i)=>{let s=!1;const n=t=>new Promise((s=>{const n=i.sound.addAudioSprite("words");n.on("complete",(()=>{n.destroy(),s()})),n.play(t,{rate:3,detune:300*(e.octave-4)})}));return{promise:new Promise((async e=>{const i=t.toLowerCase().split(" ");for(let t=0;t<i.length&&!s;t+=3){const e=i[t][0];e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122&&await n(e)}e()})),stop:()=>{s=!0}}})(t,s))}(r,n,this.scene.sound.mute||(null==(s=null==(i=this.dialog)?void 0:i.mute)?void 0:s.includes(this.messageIndex))?0:this.scene.sound.volume,this.scene),{promise:l,stop:h}=function(t,e=15){const i=t.text,s=i.replace(/[^ ]/g,"");t.text="";let n="",r=0;const o=t.scene.time.addEvent({delay:e,loop:!0});return{promise:new Promise((e=>{o.callback=()=>{if(r>=i.length)return t.text=i,o.destroy(),t.getWrappedText().length>4&&console.error("Message too long!",i),e();n=function(t,e){let i="",s=[],n=0,r=0;for(;n<e&&r<t.length;){if("<"===t[r]){let e=t.indexOf(">",r);if(-1!==e){let n=t.substring(r,e+1);i+=n,n.startsWith("</")?s.pop():n.endsWith("/>")||s.push(n),r=e+1;continue}}i+=t[r],n++,r++}for(let o=s.length-1;o>=0;o--){let t=s[o].match(/\<([^\>=]*)/);t&&(i+=`</${t[1]}>`)}return i}(i,r+1),r++;const a=s.substring(n.replace(/\<[^\>]+\>/g,"").length);t.text=n+a}})),stop:()=>{o.destroy(),t.text=i,t.getWrappedText().length>4&&console.error("Message too long!",i)}}}(this.text);this.animating=!0,this.stopAudio=a,this.stopAnimation=h,Promise.all([o,l]).then((()=>{this.animating=!1,this.stopAudio=void 0,this.stopAnimation=void 0,this.resetArrow()}))}this.updateOptions()}updateOptions(){if(this.optionsContainer.clearButtons(),this.options=this.getOptions(),!this.options)return;this.arrowTween.stop(),this.arrow.setAlpha(0);const t=!w.zoomed;this.options.forEach(((e,i)=>{const s=new uo(this.scene,w.width/2,w.height/(t?9:14)+i*(30+w.height/(t?16:22)),e,(()=>this.onSelectOption(e)),{fontSize:24,backgroundColor:"#"+G,padding:{y:10},align:"center",fixedWidth:350}).setOrigin(.5).setDepth(Ms.Overlay);this.optionsContainer.addButton(s)}))}onSelectOption(t){var e;(null==(e=this.dialog)?void 0:e.onSelected)&&(this.dialog.onSelected(t,this.player,this.target),this.optionsContainer.removeAll(!0))}updateDialog(){var t,e,i,s;if(Date.now()<this.interactionTimeout)return;const n=this.getMessages();if(this.dialog&&n){if(this.animating)return null==(t=this.stopAudio)||t.call(this),null==(e=this.stopAnimation)||e.call(this),this.animating=!1,void this.resetArrow();this.scene.sound.playAudioSprite("sfx","button",{volume:.7}),this.messageIndex++,this.text.setText(""),this.messageIndex>=n.length?(this.dialog.onCompleted&&this.dialog.onCompleted(this.player,this.target),this.dialog=void 0,this.scene.tweens.add({targets:this,alpha:0,duration:125,onComplete:()=>this.setVisible(!1)}),this.background.setVisible(!1),null==(i=this.scene.gamepad)||i.resetButtons()):(this.dialog.onMessageShown&&this.dialog.onMessageShown(this.player,this.messageIndex,this.target),this.scene.time.delayedCall(150,(()=>this.showMessage()))),null==(s=this.scene.gamepad)||s.setAlpha(void 0===this.dialog?1:0),this.interactionTimeout=Date.now()+350}}getMessages(){var t;let e=null==(t=this.dialog)?void 0:t.messages;return"function"==typeof e&&(e=e(this.player)),e}getOptions(){var t;let e=null==(t=this.dialog)?void 0:t.options;return"function"==typeof e&&(e=e(this.player)),e}resetArrow(){this.arrowTween.isDestroyed()||this.arrowTween.restart(),this.scene.tweens.add({targets:this.arrow,alpha:1,duration:500})}}const mo=[{x:40,y:600},{x:1750,y:600},{x:320,y:1300},{x:1410,y:1450},{x:510,y:-400},{x:1150,y:-400},{x:640,y:-1380},{x:930,y:-1470},{x:740,y:-2050},{x:930,y:-2115},{x:2600,y:760},{x:3610,y:760,id:O.Sphinx},{x:4455,y:850},{x:5690,y:900},{x:-565,y:575},{x:-2075,y:575},{x:-1930,y:-480},{x:-1050,y:-510},{x:-3075,y:1630},{x:-1350,y:1510},{x:-730,y:1560},{x:1620,y:-350},{x:3095,y:-350},{x:1790,y:-1245},{x:2790,y:-1245},{x:2765,y:-1580}];function bo(t,e){var i,s;const n=function(t,e){return Ma(t,a.GameObjects.Rectangle).find((t=>t.getData("WallType")===e))}(t,O.Sphinx);if(n){const t=(null==(i=mo.find((t=>t.id===O.Sphinx)))?void 0:i.x)||0;e?n.setX(t):n.setX(t-150),null==(s=n.body)||s.updateFromGameObject()}Ra(t,S.ForestEast,!e)}const vo={[k.HerbRed]:{frame:"alchemy_red",tint:11141120,x:-20},[k.HerbGreen]:{frame:"alchemy_green",tint:43520,x:-35},[k.HerbBlue]:{frame:"alchemy_blue",tint:170,x:-5}};function wo(t,e,i){t.inventory.useItem(i),t.setActive(!1),e&&e.particles&&(t.scene.sound.playAudioSprite("sfx","ingredient"),xo(t),e.disabled=!0,e.particles.setConfig({...kr[E.AlchemySet].particles,tint:vo[i].tint,x:vo[i].x}).start().on("complete",(()=>{e.disabled=!1,t.setActive(!0)})))}function xo(t){const e=La(t.scene,E.AlchemySet);e&&(e.setFrame("alchemy_empty"),Ca(t,k.HerbBlue)?e.setFrame(vo[k.HerbBlue].frame):Ca(t,k.HerbRed)?e.setFrame(vo[k.HerbRed].frame):Ca(t,k.HerbGreen)&&e.setFrame(vo[k.HerbGreen].frame))}class So extends a.GameObjects.Container{constructor(t,i){var s;if(super(t,0,0),e(this,"text"),e(this,"rect"),e(this,"player"),e(this,"activeElement"),e(this,"outline"),e(this,"scene"),e(this,"xray",!1),e(this,"dragOffset",new a.Math.Vector2),e(this,"debugCamera"),this.scene=t,this.player=i,t.physics.world.drawDebug=w.debug,w.debug?t.physics.world.createDebugGraphic():null==(s=t.physics.world.debugGraphic)||s.clear(),this.createEventListeners(),!w.debug)return;this.setScrollFactor(0).setDepth(Ms.Debug).setAlpha(.8),this.scene.add.existing(this),this.rect=t.add.rectangle(0,0,0,0,Y(G)).setOrigin(0).setDepth(Ms.Debug),this.add(this.rect),this.text=t.add.bitmapText(20,90,"m6x11-24",""),this.add(this.text),this.outline=t.add.rectangle(0,0,0,0).setStrokeStyle(6,65280).setDepth(Ms.Debug),this.debugCamera=t.add.rectangle(0,0,w.width,w.height).setStrokeStyle(4,14518272).setDepth(Ms.Debug);const n=t.cameras.main;n.on("followupdate",(()=>{this.debugCamera.setPosition(w.width/2+n.scrollX,w.height/2+n.scrollY)}))}createEventListeners(){var t,e,i,s,n,r,o,a,l,h,c,u;null==(t=this.scene.input.keyboard)||t.on("keydown-K",(()=>{Ga(this.scene)})),null==(e=this.scene.input.keyboard)||e.on("keydown-L",(()=>{this.scene.scene.restart()})),null==(i=this.scene.input.keyboard)||i.on("keydown-M",(()=>{localStorage.removeItem(Va),this.scene.scene.restart()})),null==(s=this.scene.input.keyboard)||s.on("keydown-N",(()=>{localStorage.removeItem(Va),this.scene.scene.start("Preloader")})),null==(n=this.scene.input.keyboard)||n.on("keydown-Z",(()=>{w.debug=!w.debug,Ga(this.scene),this.scene.scene.restart()})),null==(r=this.scene.input.keyboard)||r.on("keydown-FORWARD_SLASH",(()=>{this.scene.player.gameState.updateData({night:!this.scene.player.gameState.data.night})})),null==(o=this.scene.input.keyboard)||o.on("keydown-CLOSED_BRACKET",(()=>{jr(this.scene,"DebugTool")})),null==(a=this.scene.input.keyboard)||a.on("keydown-QUOTES",(()=>{no(this.scene,!this.xray),this.xray=!this.xray})),null==(l=this.scene.input.keyboard)||l.on("keydown-PLUS",(()=>{this.scene.scale.isFullscreen?this.scene.scale.stopFullscreen():this.scene.scale.startFullscreen()})),null==(h=this.scene.input.keyboard)||h.on("keydown-V",(()=>{this.player.message.setDialog({messages:["<b><i>[CREAK]</i></b> A <color=red>red</color> test [CREAK]"]})})),w.debug&&(null==(c=this.scene.input.keyboard)||c.on("keydown-COMMA",(()=>{const t=this.scene.lights.lights;console.table(t,["x","y"])})),null==(u=this.scene.input.keyboard)||u.on("keydown-PERIOD",(()=>{const t=this.scene.input.activePointer;new zr(this.scene,t.worldX,t.worldY,100,Y($),1)})),this.scene.input.on("gameobjectdown",((t,e)=>{1===t.buttons&&(e instanceof co||(e&&e!==this.activeElement?(this.activeElement=e,this.dragOffset.set(e.x-t.worldX,e.y-t.worldY)):(this.activeElement=void 0,this.dragOffset.set(0,0))))})),this.scene.input.on("drag",((t,e)=>{this.activeElement===e&&e.setPosition(this.dragOffset.x+t.worldX,this.dragOffset.y+t.worldY)})),this.scene.input.on("wheel",((t,e,i,s,n)=>{this.scene.cameras.main.zoom=Math.max(.01,this.scene.cameras.main.zoom+5e-4*s)})),this.scene.input.on("pointerup",(t=>{1===t.button&&(this.scene.cameras.main.zoom=1)})))}update(){if(!w.debug)return;const t=this.scene.input.activePointer,e=[`FPS (now): ${(1e3/this.scene.game.loop.delta).toFixed(1)}`,`FPS (avg): ${this.scene.game.loop.actualFps.toFixed(1)}`,`Frame Time: ${this.scene.game.loop.delta.toFixed(2)}`,`Camera: ${this.scene.cameras.main.scrollX.toFixed(1)}, ${this.scene.cameras.main.scrollY.toFixed(1)}`,`Zoom: ${this.scene.cameras.main.zoom.toFixed(2)}`,"",`Player x: ${this.player.x.toFixed(1)}`,`Player y: ${this.player.y.toFixed(1)}`,"",`Mouse x: ${t.worldX.toFixed(1)}`,`Mouse y: ${t.worldY.toFixed(1)}`];if(this.activeElement&&(e.push(""),e.push(`Active x: ${this.activeElement.x.toFixed(1)}`),e.push(`Active y: ${this.activeElement.y.toFixed(1)}`)),this.text.setText(e),this.rect.setPosition(this.text.x-10,this.text.y-10).setSize(this.text.displayWidth+20,this.text.displayHeight+20),this.activeElement){this.outline.setPosition(this.activeElement.x,this.activeElement.y),this.outline.setSize(this.activeElement.displayWidth,this.activeElement.displayHeight),this.outline.setOrigin(this.activeElement.originX,this.activeElement.originY);const t=this.activeElement.body;(t&&t instanceof a.Physics.Arcade.Body||t instanceof a.Physics.Arcade.StaticBody)&&t.updateFromGameObject()}else this.outline.setSize(0,0)}}class ko extends a.Physics.Arcade.Image{constructor(t,i,s){var n;const{x:r,y:o,image:l,scale:h}=i;super(t,r,o,l),e(this,"player"),e(this,"initialized",!1),e(this,"info"),e(this,"center"),e(this,"bounds",new a.Geom.Rectangle),e(this,"debug"),e(this,"music"),this.name=`Background-${i.image}`,this.info=i,this.player=s,this.setOrigin(0).setDepth(Ms.Backgrounds),_a(this,i);const c=null==(n=t.textures.get(l))?void 0:n.getSourceImage();this.center=new a.Math.Vector2(r+c.width*(h||1)/2,o+c.height*((h||1)/2));const u=Object.entries(j).find((([t,e])=>e.locations.includes(this.info.location)));this.music=u?u[0]:void 0,w.debug&&(this.debug=t.add.rectangle(this.x,this.y,c.width*(h||1),c.height*(h||1)).setStrokeStyle(6,26214).setOrigin(0).setDepth(Ms.Debug))}lazyInit(t){(t||!this.initialized&&Rr(this.center,this.player,2e3))&&(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.getBounds(this.bounds),w.debug&&this.setInteractive({draggable:!0}),this.info.onCreate&&this.info.onCreate(this),this.initialized=!0)}update(){var t,e;if(this.lazyInit(),(null==(t=this.bounds)?void 0:t.contains(this.player.x,this.player.y))&&(this.player.active&&this.music&&_.start(this.music),!w.debug&&!this.player.unlockCamera))if(this.bounds.width<w.width){const t=w.width-this.bounds.width;this.scene.cameras.main.setBounds(this.bounds.x-t/2,this.bounds.y,w.width,this.bounds.height)}else if(this.bounds.height<w.height){const t=w.height-this.bounds.height;this.scene.cameras.main.setBounds(this.bounds.x,this.bounds.y-t/2,this.bounds.width,w.height)}else this.scene.cameras.main.setBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);w.debug&&(null==(e=this.debug)||e.setPosition(this.x,this.y))}}function To(){return Math.random()-.5}const Po=[3200,600],Oo=[5125,700],Co=[500,200,100,50,10];class Eo extends a.GameObjects.GameObject{constructor(t,i,s,n=40,r=[1400,600]){super(t,"fireflies"),e(this,"scene"),e(this,"center",new a.Math.Vector2(0,0)),e(this,"lights",[]),e(this,"count"),e(this,"centers",[]),e(this,"bounds",[1e3,400]),e(this,"biases",[]),e(this,"time",0),e(this,"initialized",!1),e(this,"debug"),t.add.existing(this),this.scene=t,this.count=n,this.bounds=r,this.setPosition(i,s)}setPosition(t,e){this.center.set(t,e),this.centers=[];for(let i=0;i<this.count;i++)this.centers.push(new a.Math.Vector2(t+Math.random()*this.bounds[0]-this.bounds[0]/2,e+Math.random()*this.bounds[1]-this.bounds[1]/2));this.debug&&this.debug.setPosition(t-this.bounds[0]/2,e-this.bounds[1]/2)}lazyInit(t){if(t||!this.initialized&&Rr(this.center,this.scene.player)){for(let t=0;t<this.count;t++){const t=new a.Display.Color(40*Math.random()+50,60*Math.random()+190,20*Math.random()+10),e=this.scene.lights.addPointLight(0,0,t.color,7*Math.random()+3,.15,.045+.02*To());this.lights.push(e);const i=[];for(let s=0;s<2*Co.length;s++)i.push(To()*Co[s%Co.length]);i.push(10*To()),this.biases.push(i)}w.debug&&(this.debug=this.scene.add.graphics(),this.updateDebug()),this.setPosition(this.center.x,this.center.y),this.initialized=!0}}updateDebug(t=!1){const e=t?13260:16711680;this.debug.clear(),this.debug.fillStyle(e,.5).lineStyle(4,e,1),this.debug.fillCircle(this.bounds[0]/2,this.bounds[1]/2,10),this.debug.strokeRect(0,0,this.bounds[0],this.bounds[1])}update(t,e){this.lazyInit();const i=Math.abs(this.scene.player.x-this.center.x)<=this.bounds[0];if(this.debug&&this.updateDebug(i),!i)return void this.lights.forEach((t=>t.visible=!1));this.time+=e;const s=this.time/1e3*.025,n=Math.cos(s),r=Math.sin(s);this.lights.forEach(((t,e)=>{const i=this.biases[e],o=Math.cos(70*s+i[10]);t.visible=!0,t.intensity=Math.min(.2+Math.abs(i[4]*o+i[3]*n+i[4]*n)/50,.4),t.x=n*i[0]+r*i[1]+n*i[2]+r*i[3]+n*i[4]+this.centers[e].x,t.y=r*i[5]+n*i[6]+r*i[7]+n*i[8]+r*i[9]+this.centers[e].y}))}}const Io={[I.LabStairs]:{x:-1670,y:1730,size:{x:80,y:80},text:"Press [UP] to go upstairs"},[I.InnStairs]:{x:2e3,y:-1205,size:{x:80,y:80},text:"Press [UP] to go upstairs"}};class Ao extends a.GameObjects.Image{constructor(t,i,s){const{x:n,y:r}=Io[i];super(t,n,r,""),e(this,"player"),e(this,"disabled",!1),e(this,"initialized",!1),this.name=`HelperText-${i}`,this.player=s}lazyInit(t){if(!t&&(this.initialized||!Rr(this,this.player)))return;const{size:e}=Io[I.LabStairs];this.setDepth(Ms.Items),this.setDisplaySize(e.x,e.y),w.debug||this.setAlpha(0),this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0}),this.initialized=!0}getButtonPrompt(){return Io[I.LabStairs].text}onInteract(t){return x.None}update(){this.lazyInit()}}class Mo extends a.GameObjects.Container{constructor(t,i){const{position:s,size:n}=i;super(t,s.x,s.y),e(this,"initialized",!1),e(this,"center"),e(this,"player"),e(this,"layers",[]),e(this,"info"),this.name=`ParallaxBackground-${s.x}-${s.y}`,this.info=i,this.player=t.player,this.setDepth(Ms.Backgrounds),this.center=new a.Math.Vector2(s.x+.5*n.x,s.y+.5*n.y),w.debug&&this.add(t.add.rectangle(this.center.x,this.center.y,n.x,n.y).setStrokeStyle(10,26214).setOrigin(.5))}lazyInit(t){if(!t&&(this.initialized||!Rr(this.center,this.player,this.info.size.x)))return;this.scene.add.existing(this),this.scene.physics.add.existing(this);const{position:e,size:i,scale:s,images:n,skipLighting:r}=this.info;n.forEach((({texture:t,scale:n,speed:o})=>{const a=this.scene.add.tileSprite(e.x,e.y,i.x,i.y,t);a.setOrigin(0).setTileScale((s||1)*(n||1)).setData("speed",o),r||a.setPipeline("Light2D"),a.setPostPipeline("XRayPipeline"),this.add(a),this.layers.push(a)})),w.debug&&this.setInteractive({draggable:!0,hitArea:new a.Geom.Rectangle(e.x,e.y,i.x,i.y),hitAreaCallback:a.Geom.Rectangle.Contains}),this.initialized=!0}update(){if(this.lazyInit(),!this.initialized||!this.getBounds().contains(this.player.x,this.player.y))return;const{size:t}=this.info,e=a.Math.Clamp(this.player.x-this.center.x,-.5*t.x,.5*t.x)/t.x;this.layers.forEach((i=>{i.tilePositionX=e*i.getData("speed")*t.x}))}}const Ro={[R.Library]:{x:1100,y:-470,text:"Library"},[R.Inn]:{x:1350,y:450,text:"Inn"},[R.Train]:{x:235,y:555,text:"Train"}};class jo extends a.GameObjects.Image{constructor(t,i,s){var n;const{x:r,y:o}=Ro[i];super(t,r,o,"props","paper"),e(this,"player"),e(this,"initialized",!1),e(this,"signType"),e(this,"text"),this.setDepth(Ms.Player).setAngle(90).setTint(13417386).setOrigin(.5),null==(n=this.preFX)||n.addGlow(4796939,1,0,!1),this.name=`Sign-${i}`,this.player=s,this.signType=i}lazyInit(t){if(!t&&(this.initialized||!Rr(this,this.player)))return;this.scene.add.existing(this),w.debug&&this.setInteractive({draggable:!0});const{x:e,y:i,text:s}=Ro[this.signType];this.text=this.scene.add.text(e,i,s.toUpperCase(),{fontFamily:"Germania One",fontStyle:"normal",fontSize:28,color:"#372737",stroke:"#8e6117",strokeThickness:6}).setOrigin(.5).setDepth(Ms.Player+1),this.setDisplaySize(this.text.displayHeight+5,this.text.displayWidth+40),this.initialized=!0}update(){this.lazyInit()}}class Lo extends a.Physics.Arcade.Image{constructor(t,i,s,n=100,r=100,o=!1,a=!1){super(t,i,s,""),e(this,"scene"),e(this,"width"),e(this,"height"),e(this,"flipped"),e(this,"graphics"),e(this,"initialized",!1),e(this,"upwards"),this.name=`Slope-${i}-${s}`,this.scene=t,this.width=n,this.height=r,this.flipped=o,this.upwards=a}lazyInit(t){if(t||!this.initialized&&Rr(this,this.scene.player)){if(this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0).setDepth(Ms.Items).setVisible(w.debug).setSize(this.width,1.5*this.height),w.debug){this.setInteractive({draggable:!0});const t=this.scene.add.graphics().setDepth(Ms.Debug);this.graphics=t,t.lineStyle(2,65280,1);const e=this.width/2,i=new a.Math.Vector2(0,this.flipped?0:0+this.height),s=new a.Math.Vector2(0+this.width,this.flipped?0+this.height:0);t.lineBetween(i.x,i.y,s.x,s.y),t.lineBetween(i.x-e,i.y,i.x,i.y),t.lineBetween(s.x,s.y,s.x+e,s.y),t.strokeCircle(i.x,i.y,2),t.strokeCircle(s.x,s.y,2)}this.initialized=!0}}update(t,e){var i;if(this.lazyInit(),!this.initialized)return;null==(i=this.graphics)||i.setPosition(this.x,this.y);const s=this.scene.player,n=s.keys.keys,r=.75*lo;if(this.body&&this.scene.physics.world.intersects(this.body,s.body)){if(!s.active||n[Br.Shift])return;let t=a.Math.Clamp(1-(this.x+this.width-s.x)/this.width,0,1);this.flipped&&(t=1-t);const e=this.y+this.height,i=(1-s.originY)*s.displayHeight,o=e-this.height*t-i;if(n[Br.Right]&&s.setVelocityX(r),n[Br.Left]&&s.setVelocityX(-r),this.upwards&&n[Br.Up]&&Math.abs(s.y-o)<70)return s.setVelocityX(this.flipped?-r:r),void s.setY(o);if(this.upwards&&(n[Br.Right]||n[Br.Left]&&this.flipped)&&s.y<e-70)return void s.setY(o);if(this.upwards&&o<s.y)return;s.setY(o)}}}class _o extends a.Physics.Arcade.StaticGroup{constructor(t,i){super(t.physics.world,t),e(this,"player"),e(this,"initialized",[]),this.player=i,mo.forEach(((t,e)=>{void 0!==t.id&&this.createWall(t,e)}))}createWall(t,e){const i=this.scene.add.rectangle(t.x,t.y,6,100).setOrigin(0).setVisible(w.debug);i.name=`Wall-${t.id||e}-${t.x}-${t.y}`,void 0!==t.id&&i.setData("WallType",t.id),w.debug&&i.setInteractive({draggable:!0}),this.add(i),this.initialized.push(e)}update(){for(let t=0;t<mo.length;t++){if(this.initialized.includes(t))continue;const e=mo[t];a.Math.Distance.BetweenPointsSquared(e,this.player)<1e6&&this.createWall(e,t)}}}var Fo=(t=>(t[t.Ladder=0]="Ladder",t[t.Warp=1]="Warp",t[t.Invisible=2]="Invisible",t[t.WarpLocked=3]="WarpLocked",t[t.InvisibleLocked=4]="InvisibleLocked",t))(Fo||{});const Do={[S.Town]:{x:280,y:650,key:Br.Down,warpTo:S.Station,location:A.Station,visual:2,sound:"ladder"},[S.Station]:{x:365,y:1355,key:Br.Left,direction:Br.Up,warpTo:S.Town,location:A.Town,visual:2,sound:"ladder"},[S.TownEast]:{x:1720,y:650,key:Br.Right,warpTo:S.Forest,location:A.Forest,visual:3},[S.Forest]:{x:2650,y:815,key:Br.Left,warpTo:S.TownEast,location:A.Town,visual:1},[S.TownNorth]:{x:775,y:650,key:Br.Up,warpTo:S.ClockSquare,location:A.ClockOutside,visual:3},[S.ClockSquare]:{x:560,y:-330,key:Br.Down,warpTo:S.TownNorth,location:A.Town,visual:1},[S.ClockSquareNorth]:{x:930,y:-330,key:Br.Up,warpTo:S.ClockEntrance,location:A.ClockInner,visual:3},[S.ClockEntrance]:{x:690,y:-1320,range:15,key:Br.Left,direction:Br.Down,warpTo:S.ClockSquareNorth,location:A.ClockOutside,visual:1,skipLighting:!0},[S.ClockStairs]:{x:910,y:-1418,range:20,key:Br.Right,direction:Br.Up,warpTo:S.ClockTop,location:A.ClockInner,name:"Clock Tower (Upstairs)",visual:2,sound:"ladder"},[S.ClockTop]:{x:780,y:-1980,range:10,key:Br.Left,direction:Br.Down,warpTo:S.ClockStairs,location:A.ClockInner,name:"Clock Tower (Downstairs)",visual:2,sound:"ladder"},[S.ForestEast]:{x:3570,y:815,key:Br.Right,warpTo:S.Lake,location:A.Lake,visual:3,initializeOnStart:!0},[S.Lake]:{x:4510,y:915,key:Br.Left,warpTo:S.ForestEast,location:A.Forest,visual:1},[S.TownWest]:{x:90,y:650,key:Br.Left,warpTo:S.MansionGrounds,location:A.MansionOutside,visual:3},[S.MansionGrounds]:{x:-620,y:640,key:Br.Right,warpTo:S.TownWest,location:A.Town,visual:1},[S.MansionEntrance]:{x:-1290,y:640,key:Br.Up,warpTo:S.Mansion,location:A.MansionInside,visual:2},[S.Mansion]:{x:-1405,y:-420,key:Br.Down,warpTo:S.MansionEntrance,location:A.MansionOutside,visual:2},[S.LabHatch]:{x:-1920,y:640,key:Br.Down,warpTo:S.Lab,location:A.AlchemyLab,visual:4},[S.Lab]:{x:-1380,y:1545,key:Br.Right,direction:Br.Up,warpTo:S.LabHatch,location:A.MansionOutside,visual:2,range:15,skipLighting:!0},[S.LibraryEntrance]:{x:1130,y:-330,key:Br.Right,warpTo:S.Library,location:A.Library,visual:2},[S.Library]:{x:1670,y:-290,key:Br.Left,warpTo:S.LibraryEntrance,location:A.ClockOutside,visual:1},[S.InnEntrance]:{x:1300,y:650,key:Br.Up,warpTo:S.Inn,location:A.Inn,visual:2},[S.Inn]:{x:2555,y:-1180,key:Br.Down,warpTo:S.InnEntrance,location:A.Town,visual:2}},zo=[];Object.values(oo).forEach((t=>{t.warpAdd&&zo.push(t.warpAdd),t.warpComplete&&zo.push(t.warpComplete)})),Object.values(Yr).forEach((t=>{t.warpAdd&&zo.push(t.warpAdd)}));class Bo extends a.Physics.Arcade.Image{constructor(t,i,s){const{x:n,y:r,visual:o,range:a}=Do[i];super(t,n,r,"props","warp"),e(this,"warpType"),e(this,"player"),e(this,"locked"),e(this,"graphics"),e(this,"light"),e(this,"portal1"),e(this,"portal2"),e(this,"range"),e(this,"initialized",!1),this.name=`Warp-${i}`,this.warpType=i,this.player=s,this.range=a||30,this.setScale(.6).setDepth(Ms.Warpers),o!==Fo.Warp&&o!==Fo.WarpLocked||(this.setScale(.6,1),this.setPosition(n,r-12)),w.debug||(this.updateLocked(o===Fo.WarpLocked||o===Fo.InvisibleLocked),o!==Fo.Invisible&&o!==Fo.InvisibleLocked||this.setAlpha(0)),_a(this,Do[i]),zo.includes(i)&&t.add.existing(this)}lazyInit(t){if(!t&&(this.initialized||!Rr(this,this.player)))return;zo.includes(this.warpType)||this.scene.add.existing(this),this.scene.physics.add.existing(this),this.createAnimations(),this.createDebug();const{onCreate:e,visual:i}=Do[this.warpType];i!==Fo.Warp&&i!==Fo.WarpLocked||(this.light=this.scene.lights.addPointLight(this.x,this.y,5132207,125,0)),this.hasExtendedBounds()&&this.body&&this.setBodySize(this.body.width*(this.range/30*4),this.body.height),this.updateLocked(),e&&e(this),this.initialized=!0}createAnimations(){const{visual:t,skipLighting:e}=Do[this.warpType];t!==Fo.Warp&&t!==Fo.WarpLocked||(this.setAlpha(.1),this.scene.anims.exists("portal")||this.scene.anims.create({key:"portal",frames:this.scene.anims.generateFrameNumbers("portal",{start:0,end:63}),frameRate:10,repeat:-1,randomFrame:!0}),this.portal1=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.45,1).setAlpha(.9).setName(`${this.name}-1`).play("portal"),this.portal1.postFX.addPixelate(1),this.portal1.postFX.addShadow(0,0,.1,2,3355562,3,.5),this.portal2=this.scene.add.sprite(this.x,this.y,"portal_0").setScale(.35,1).setAlpha(.65).setFlipX(!0).setName(`${this.name}-2`).play("portal"),this.portal2.postFX.addPixelate(1),this.portal2.setFrame(Math.floor(30*Math.random())),e||(this.portal1.setPipeline("Light2D"),this.portal2.setPipeline("Light2D")),this.portal1.setPostPipeline("XRayPipeline"),this.portal2.setPostPipeline("XRayPipeline"))}createDebug(){if(w.debug&&(this.setInteractive({draggable:!0}),this.graphics=this.scene.add.graphics(),this.hasExtendedBounds())){this.graphics.lineStyle(2,16711935).setPosition(this.x,this.y);const t=this.body;this.graphics.lineBetween(-this.range,-t.halfHeight,-this.range,t.halfHeight),this.graphics.lineBetween(this.range,-t.halfHeight,this.range,t.halfHeight),this.graphics.strokeCircle(0,0,5)}}hasExtendedBounds(){const{visual:t,key:e}=Do[this.warpType];return!(t!==Fo.Warp&&t!==Fo.WarpLocked&&t!==Fo.Invisible||e!==Br.Left&&e!==Br.Right)}onInteract(t){const e=!this.hasExtendedBounds()||Math.abs(this.player.x-this.x)<this.range,i=t[Do[this.warpType].key]&&e;if(i&&this.warpType===S.TownEast&&!this.player.gameState.data.mazeSolved&&!w.debug)return jr(this.scene,"MazeDialog"),x.None;if(i){const t=Do[this.warpType];return No(this.warpType,t.warpTo,this.player,{x:0,y:-12}),x.Teleported}return x.None}getButtonPrompt(){const{key:t,location:e,name:i}=Do[this.warpType];let s;t===Br.Up&&(s="[Up]"),t===Br.Down&&(s="[Down]"),t===Br.Left&&(s="[Left]"),t===Br.Right&&(s="[Right]");let n=i||e;return n=_r(n),[`Travel to ${n}`,"Press "+s]}setPosition(t,e,i,s){var n,r,o;return super.setPosition(t,e,i,s),null==(n=this.portal1)||n.setPosition(t,e),null==(r=this.portal2)||r.setPosition(t,e),null==(o=this.graphics)||o.setPosition(t,e),this}setVisible(t){var e,i,s;return super.setVisible(t),null==(e=this.portal1)||e.setVisible(t),null==(i=this.portal2)||i.setVisible(t),null==(s=this.light)||s.setVisible(t),this}updateLocked(t){void 0!==t&&(this.locked=t),this.setVisible(!this.locked)}update(t,e){this.lazyInit(),this.initialized&&this.light&&Mr(this,this.player,w.width/1.8)&&(this.light.setPosition(this.x,this.y),this.light.intensity=a.Math.Clamp(this.light.intensity+.025*Math.random()-.0125,.1,.2))}destroy(t){var e,i;null==(e=this.portal1)||e.destroy(t),null==(i=this.portal2)||i.destroy(t),super.destroy(t)}}const Wo={[Br.Up]:{x:0,y:-1},[Br.Down]:{x:0,y:1},[Br.Left]:{x:-1,y:0},[Br.Right]:{x:1,y:0}};function No(t,e,i,s,n){const{direction:r,key:o,sound:a,visual:l,location:h}=Do[t];let{x:c,y:u}=Do[e],d=!0;if(!et(i.scene)||t!==S.TownEast&&t!==S.TownWest&&t!==S.Town||(d=!1),(!w.prod&&n||w.debug)&&(d=!0),!d)return void i.message.setDialog({messages:["It is too late to leave town now.","I should rest at the inn until tomorrow."]},i);const p=Wo[void 0!==r?r:o],g=i.scene,y=g.cameras.main;s&&(c+=s.x,u+=s.y);const f=c-g.cameras.main.width/2,m=u-g.cameras.main.height/2-w.cameraOffset;let b="warp";l!==Fo.Invisible&&l!==Fo.InvisibleLocked||(b="door"),a&&(b=a),y.stopFollow(),y.removeBounds(),i.unlockCamera=!0,i.setActive(!1);const v=_.getLocationMusic(h);v&&_.start(v),g.add.timeline([{at:0,run:()=>{Ar(g,200),g.sound.playAudioSprite("sfx",b)},tween:{delay:0,targets:y,scrollX:y.scrollX+75*p.x,scrollY:y.scrollY+75*p.y,duration:200}},{at:0,tween:{targets:i,alpha:0,duration:200}},{at:450,run:()=>{i.unlockCamera=!1,i.setPosition(c,u),i.previousPosition.set(c,u),y.scrollX=f,y.scrollY=m}},{at:600,tween:{targets:i,alpha:1,duration:200},run:()=>Ir(g,400,(()=>{y.startFollow(i,!0),y.setFollowOffset(0,w.cameraOffset),i.setActive(!0)}))}]).play()}const Go=.8,Ho=.1;class Uo extends a.GameObjects.Container{constructor(t,i){super(t,100,w.height-100),e(this,"buttons",[]),e(this,"lastXAxisKey"),e(this,"lastYAxisKey"),e(this,"minimal"),this.minimal=i,this.setScrollFactor(0).setDepth(Ms.Overlay),t.add.group(this,{runChildUpdate:!0}),t.add.existing(this),this.createControllerListeners()}createUI(){this.createDPad(),this.minimal||this.createButtons()}setVisible(t){return super.setVisible(t),t&&0===this.buttons.length&&this.createUI(),this}update(t,e){var i,s,n,r,o,a,l,h,c,u,d;const p=null==(i=this.scene.input.gamepad)?void 0:i.pad1;if(!p)return;const g=p.axes[0].getValue(),y=p.axes[1].getValue();if(Math.abs(g)<=Ho&&this.lastXAxisKey)return null==(s=this.scene.input.keyboard)||s.emit("keyup-"+this.lastXAxisKey),void(this.lastXAxisKey=void 0);if(g>Ho){if("RIGHT"===this.lastXAxisKey)return;"LEFT"===this.lastXAxisKey&&(null==(n=this.scene.input.keyboard)||n.emit("keyup-LEFT")),null==(r=this.scene.input.keyboard)||r.emit("keydown-RIGHT"),this.lastXAxisKey="RIGHT"}if(g<-.1){if("LEFT"===this.lastXAxisKey)return;"RIGHT"===this.lastXAxisKey&&(null==(o=this.scene.input.keyboard)||o.emit("keyup-RIGHT")),null==(a=this.scene.input.keyboard)||a.emit("keydown-LEFT"),this.lastXAxisKey="LEFT"}if(Math.abs(y)<=Ho&&this.lastYAxisKey)return null==(l=this.scene.input.keyboard)||l.emit("keyup-"+this.lastYAxisKey),void(this.lastYAxisKey=void 0);if(y>Ho){if("DOWN"===this.lastYAxisKey)return;"UP"===this.lastYAxisKey&&(null==(h=this.scene.input.keyboard)||h.emit("keyup-UP")),null==(c=this.scene.input.keyboard)||c.emit("keydown-DOWN"),this.lastYAxisKey="DOWN"}if(y<-.1){if("UP"===this.lastYAxisKey)return;"DOWN"===this.lastYAxisKey&&(null==(u=this.scene.input.keyboard)||u.emit("keyup-DOWN")),null==(d=this.scene.input.keyboard)||d.emit("keydown-UP"),this.lastYAxisKey="UP"}}createDPad(){const t=this.scene.add.container(10,-10);this.add(t);const e=this.scene.add.circle(0,0,60,Y(N),.45).setStrokeStyle(3,Y(G));t.add(e),this.button(-57,0,"LEFT",t),this.button(57,0,"RIGHT",t),this.button(0,-57,"UP",t),this.button(0,57,"DOWN",t)}createButtons(){const t=this.scene.add.container(w.width-300,0);this.add(t);const e=this.scene.add.circle(40,0,65,Y(N),.45).setStrokeStyle(3,Y(G)).setScale(1,.6).setAngle(-30);t.add(e),this.button(80,-20,"ENTER",t),this.button(0,20,"BACKSPACE",t)}createControllerListeners(){var t,e,i,s;null==(t=this.scene.input.gamepad)||t.on("connected",(t=>{new Fa(this.scene,"Gamepad connected")})),null==(e=this.scene.input.gamepad)||e.on("disconnected",(t=>{new Fa(this.scene,"Gamepad disconnected")})),null==(i=this.scene.input.gamepad)||i.on("down",((t,e)=>{var i;const s=this.getKeyFromButton(e);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keydown-${s}`))})),null==(s=this.scene.input.gamepad)||s.on("up",((t,e)=>{var i;const s=this.getKeyFromButton(e);s&&(null==(i=this.scene.input.keyboard)||i.emit(`keyup-${s}`))}))}getKeyFromButton(t){const e=t.pad.id.toLowerCase().includes("nintendo");let i;switch(t.index){case 0:i=e?"BACKSPACE":"ENTER";break;case 1:i=e?"ENTER":"BACKSPACE";break;case 2:i=e?"SHIFT":"BACK_SLASH";break;case 3:i=e?"BACK_SLASH":"SHIFT";break;case 8:i="J";break;case 9:i="ESC";break;case 12:i="UP";break;case 13:i="DOWN";break;case 14:i="LEFT";break;case 15:i="RIGHT"}return i}button(t,e,i,s){const n="ENTER"===i||"ESCAPE"===i?35:38,r=this.scene.add.circle(t,e,n,Y(B),Go).setStrokeStyle(3,Y(G));r.setInteractive({useHandCursor:!0}).setScrollFactor(0),s.add(r),r.on("pointerdown",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keydown-${i}`),r.setFillStyle(Y(N),Math.min(1,1.05))})),r.on("pointerup",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),r.setFillStyle(Y(B),Go)})),r.on("pointerout",(()=>{var t;null==(t=this.scene.input.keyboard)||t.emit(`keyup-${i}`),r.setFillStyle(Y(B),Go)})),this.buttons.push(r)}resetButtons(){this.buttons.forEach((t=>t.setFillStyle(Y(B),Go)))}}class $o extends a.GameObjects.Container{constructor(t,i,s,n,r){super(t,i,s),e(this,"onClick"),e(this,"img"),e(this,"rect"),e(this,"selected"),t.add.existing(this),this.setScrollFactor(0).setDepth(Ms.Ui),this.rect=t.add.rectangle(0,0,42,42,Y(N)).setScrollFactor(0).setStrokeStyle(2,Y(G)),this.img=t.add.image(-1,1,"icons",n).setDisplaySize(32,32),this.add(this.rect),this.add(this.img),this.onClick=()=>{t.sound.playAudioSprite("sfx","button"),r()},this.rect.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.onClick())),this.selected=!1,this.rect.on("pointerover",(()=>{this.rect.setScale(1.1),this.img.setDisplaySize(36,36)})),this.rect.on("pointerout",(()=>{this.rect.setScale(1),this.img.setDisplaySize(32,32)}))}setTint(t){this.img.setTint(t)}setSelected(t){this.selected=t,this.setTint(t?Y(q):16777215)}setIcon(t){this.img.setTexture("icons",t).setDisplaySize(32,32)}}var Vo=(t=>(t.Horizontal="H",t.Vertical="V",t.Corner="C",t.T="T",t.Cross="X",t.Empty=" ",t))(Vo||{});const Xo={H:[[0,0,0],[1,1,1],[0,0,0]],V:[[0,1,0],[0,1,0],[0,1,0]],C:[[0,0,0],[1,1,0],[0,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],X:[[0,1,0],[1,1,1],[0,1,0]]," ":[[0,0,0],[0,0,0],[0,0,0]]},qo=[[" "," "," ","V"," "," ","V"," "," ","V"," "," "," ","V"," "," "],[" "," ","C","C"," "," ","V"," "," ","V"," "," ","C","T","H","H"],["H","H","X","T","T","T","T","T","T","C"," "," ","V"," "," "," "],[" "," ","V","C","X","C"," ","C","X","H","T","H","X","H","C"," "],[" "," ","C","T","X","H","C"," ","V"," ","V"," ","V"," ","T","H"],["H","T","H","T","V"," ","T","H","X","H","T","H","T"," ","V"," "],[" ","V"," ","C","X","H","C"," ","T","C"," "," ","C","C","C","H"],[" ","V"," "," ","V"," "," "," ","V","V"," "," "," ","V"," "," "]].map((t=>t.map((t=>t))));function Yo(t,e){if(!t||!e)return!1;const i=Ko(t),s=Ko(e),n=e.x-t.x,r=e.y-t.y;return 1===n&&0===r?i.right&&s.left:-1===n&&0===r?i.left&&s.right:0===n&&1===r?i.bottom&&s.top:0===n&&-1===r&&i.top&&s.bottom}function Ko(t){const e=function(t){let e=Xo[t.type];const i=Math.floor(t.rotation/90);for(let s=0;s<i;s++)e=Qo(e);return e}(t);return{left:e.some((t=>1===t[0])),right:e.some((t=>1===t[t.length-1])),top:e[0].some((t=>1===t)),bottom:e[e.length-1].some((t=>1===t))}}function Qo(t){return t[0].map(((e,i)=>t.map((t=>t[i])).reverse()))}const Jo=Object.keys(k).map((t=>k[t])).filter((t=>"number"==typeof t)),Zo=Object.keys(C).map((t=>C[t])).filter((t=>"number"==typeof t)),ta=Object.keys(P).map((t=>P[t])).filter((t=>"number"==typeof t)),ea=Object.keys(E).map((t=>E[t])).filter((t=>"number"==typeof t)),ia=Object.keys(T).map((t=>T[t])).filter((t=>"number"==typeof t)),sa=Object.keys(S).map((t=>S[t])).filter((t=>"number"==typeof t)),na=Object.values(A),ra=Object.keys(I).map((t=>I[t])).filter((t=>"number"==typeof t)),oa=Object.values(Vo).filter((t=>"number"!=typeof t)),aa=["MainMenu","MazeDialog","PipesDialog","TumblerDialog","MemoryDialog","SliderDialog"],la=Object.keys(R).map((t=>R[t])).filter((t=>"number"==typeof t)),ha=[{x:45,y:0,image:"town",location:A.Town,scale:2},{x:500,y:-1100,image:"clock_outside",location:A.ClockOutside,scale:2},{x:500,y:-2400,image:"clock_inner",location:A.ClockInner,scale:2,skipLighting:!0},{x:2300,y:0,image:"forest",location:A.Forest,scale:2},{x:4400,y:100,image:"lake",location:A.Lake,scale:2},{x:-2200,y:-170,image:"mansion_outside",location:A.MansionOutside,scale:2},{x:-2e3,y:-1320,image:"mansion_inside",location:A.MansionInside,scale:2},{x:-3200,y:1300,image:"alchemy_lab",location:A.AlchemyLab,scale:1.8,skipLighting:!0},{x:1490,y:-860,image:"library",location:A.Library,scale:2,skipLighting:!0},{x:1600,y:-1850,image:"inn",location:A.Inn,scale:2,skipLighting:!0},{x:320,y:1050,image:"station",location:A.Station,scale:3}],ca=[{x:135,y:462,radius:150,color:Y(W),intensity:2.5},{x:697,y:441},{x:1018,y:435},{x:897,y:240,intensity:1.5},{x:1561,y:460},{x:791,y:472,intensity:.75},{x:962,y:469,intensity:.75},{x:560,y:1353,radius:70,intensity:.75},{x:658,y:1353,radius:70,intensity:.75},{x:763,y:1353,radius:70,intensity:.75},{x:842,y:1353,radius:70,intensity:.75},{x:939,y:1353,radius:70,intensity:.75},{x:1049,y:1353,radius:70,intensity:.75},{x:1148,y:1353,radius:70,intensity:.75},{x:639,y:1174,radius:90},{x:750,y:1174,radius:90},{x:856,y:1174,radius:90},{x:958,y:1174,radius:90},{x:1066,y:1174,radius:90}],ua=[],da=[{x:430,y:1390,width:180,height:160,flip:!0},{x:740,y:-1380,width:170,height:95},{x:815,y:-2010,width:90,height:70},{x:5077,y:953,width:100,height:60,flip:!0},{x:-1300,y:-415,width:90,height:35},{x:-1710,y:1577,width:280,height:190,upwards:!0},{x:-1020,y:1697,width:200,height:70},{x:-2570,y:1728,width:200,height:40,flip:!0},{x:1960,y:-1492,width:420,height:350,upwards:!0}],pa=(t,e,i)=>{var s=1/0,n=0,r=Math.round;const o=1.25*r(window.devicePixelRatio||1),a=100*o,l=65*o,h=3*o,c=2*o,u=3*o,d=23*o,p=Math.floor(a-2*u),g=l-d-2*o,y=document.createElement("canvas");y.width=a,y.height=l;const f=y.getContext("2d");f.font="bold "+9*o+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,a,l),f.fillStyle=e,f.fillText(t,h,c),f.fillRect(u,d,p,g),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(u,d,p,g);let m=0,b=0,v=new Array(Math.floor(p/o)).fill(0);return{dom:y,update:function(l){if(!(performance.now()-m<100)){v[b]=l,b=(b+1)%v.length,s=Math.min(...v),n=Math.max(...v),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,a,d),f.fillStyle=e,f.fillText(`${t}: ${l.toFixed(1)}`,h,c),f.fillText(`[${s.toFixed(1)} - ${n.toFixed(1)}]`,h,c+10*o),f.fillRect(u,d,p,g),f.fillStyle=i,f.globalAlpha=.8;for(let t=0;t<v.length;t++){const e=(b+t)%v.length,i=v[e]/n;f.fillRect(u+o*t,d,o+.75,Math.min(g-o,Math.max(o,r((1-i)*g))))}m=performance.now()}}}};let ga;class ya extends a.Scene{constructor(){super("Game"),e(this,"player"),e(this,"interactiveObjects"),e(this,"clock"),e(this,"gamepad"),e(this,"saveIcon"),e(this,"lightData",[]),e(this,"postUpdated",[]),e(this,"cullingStats"),e(this,"shouldInit",!0),e(this,"cameraPadding",150),e(this,"cameraBounds",new a.Geom.Rectangle(0,0,w.width+2*this.cameraPadding,w.height+2*this.cameraPadding)),e(this,"objectBounds",new a.Geom.Rectangle(0,0,0,0))}init(){const t=function(t){const{save:e}=za();try{return Wa(e,t)}catch(i){console.error(i)}return!1}(this);this.shouldInit=!t}create(){if(!this.shouldInit)return;_.setScene(this);const t=performance.now();Ar(this,0),this.time.delayedCall(w.bootDialog?0:250,(()=>Ir(this,w.bootDialog?150:500))),this.player=new co(this),this.postUpdated.push(this.player);const e=this.createBackgrounds(),i=this.createParallaxBackgrounds(),s=new _o(this,this.player),n=this.createSlopes(),r=this.createHelperText(),o=this.createSigns(),a=this.createWarpers(),l=this.createNpcs(),h=this.createItems(),c=this.createProps(),u=new Hr(this,this.player,!0),d=new Eo(this,Po[0],Po[1]),p=new Eo(this,Oo[0],Oo[1]);this.createLights(),this.createUI(),this.player,this.interactiveObjects=this.add.group([...a,...l,...h,...c,...r],{runChildUpdate:!0});const g=this.add.group([this.player,d,p,u,s,...n,...o,...e,...i],{runChildUpdate:!0});this.clock&&g.add(this.clock),this.physics.add.collider(this.player,s),this.createEventListeners();const y=this.cameras.main;if(y.startFollow(this.player,!0),y.setFollowOffset(0,w.cameraOffset),Na(this),!w.prod){const e=performance.now()-t,i=`Game.create() took ${e.toFixed(1)}ms to initialize`;(w.debug&&e>300||!w.debug&&e>150)&&new Fa(this,i,void 0,H),window.bootTime>-1&&(console.log("Total game boot time",Date.now()-window.bootTime),window.bootTime=-1)}}update(t){if(this.player&&(this.physics.overlap(this.interactiveObjects,this.player,this.player.setInteractiveObject,((t,e)=>{const i=t;let s=!0;return i.disabled&&(s=!1),void 0!==i.visible&&(s=s&&i.visible),s}),this.player)||this.player.setInteractiveObject(void 0)),et(this))for(let e of this.lightData)Math.random()>.98&&e.light.setIntensity(e.intensity*(.9+.1*Math.random()));this.frustumCull()}frustumCull(){var t,e,i;const s=performance.now();this.cameraBounds.x=this.cameras.main.scrollX-this.cameraPadding,this.cameraBounds.y=this.cameras.main.scrollY-this.cameraPadding;const n=this.children.getAll();for(let r of n)if(r instanceof a.GameObjects.Image||r instanceof a.GameObjects.Sprite||r instanceof a.GameObjects.Particles.ParticleEmitter||r instanceof a.GameObjects.Graphics){if(r.depth!==Ms.Debug&&(r instanceof Lo||!(r instanceof Bo)&&(null==(t=r.name)?void 0:t.startsWith("Warp"))||r.depth>=Ms.Ui||0===(null==(e=r.name)?void 0:e.length)))continue;this.objectBounds.setTo(r.x,r.y,r.displayWidth||r.width||1,r.displayHeight||r.height||1),a.Geom.Intersects.RectangleToRectangle(this.cameraBounds,this.objectBounds)?r instanceof Bo?r.updateLocked():r.setVisible(!0):r.setVisible(!1)}ga&&!this.cullingStats&&(this.cullingStats=ga.addPanel(pa("Culling","#9ad8e4","#064b62"))),null==(i=this.cullingStats)||i.update(performance.now()-s)}createBackgrounds(){return ha.map((t=>new ko(this,t,this.player)))}createParallaxBackgrounds(){return ua.map((t=>new Mo(this,t)))}createWarpers(){return sa.map((t=>new Bo(this,t,this.player)))}createNpcs(){return ta.map((t=>new Nr(this,t,this.player)))}createItems(){return[].map((t=>new Ta(this,t,this.player)))}createSlopes(){return da.map((t=>new Lo(this,t.x,t.y,t.width,t.height,t.flip,t.upwards)))}createProps(){return ea.map((t=>new Ur(this,t,this.player)))}createHelperText(){return ra.map((t=>new Ao(this,t,this.player)))}createSigns(){return la.map((t=>new jo(this,t,this.player)))}createUI(){this.time.delayedCall(50,(()=>{let t=30;new $o(this,t,30,"settings",(()=>{this.player.message.visible||(this.scene.pause(),this.scene.launch("Paused",{game:this}))})),w.prod||new $o(this,t+=50,30,"terminal",(()=>{jr(this,"DebugTool")})),this.saveIcon=this.add.image(30,w.height-30,"icons","save").setScale(.4).setDepth(Ms.Ui).setScrollFactor(0).setAlpha(0),this.saveIcon.postFX.addGlow(0,2)})),this.gamepad=new Uo(this),w.prod||(this.time.delayedCall(500,(()=>{const t=new So(this,this.player);this.add.group(t,{runChildUpdate:!0})})),w.bootDialog&&this.time.delayedCall(150,(()=>jr(this,w.bootDialog))))}createLights(){this.lights.enable().setAmbientColor(Y(B)),ca.forEach((t=>{const e=t.intensity||1;w.debug?this.lightData.push({light:new zr(this,t.x,t.y,t.radius||100,t.color||Y($),e),random:Math.random(),intensity:e}):this.lightData.push({light:this.lights.addLight(t.x,t.y,t.radius||100,t.color||Y($),e),random:Math.random(),intensity:e})})),it(this,!1)}createEventListeners(){var t;null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.player.message.visible||(this.scene.pause(),this.scene.launch("Paused",{game:this}))})),this.events.on("resume",(()=>{this.player.keys.resetKeys()})),this.events.on("postupdate",(()=>{this.postUpdated.forEach((t=>t.postUpdate()))}))}}const fa=[{question:"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind.",answer:"echo",options:["echo","whisper","ghost","silence","shadow"],hints:{[P.Inventor]:["The sphinx is known for asking about things we take for granted.","Think about what we hear in canyons."],[P.Stranger]:["The sphinxs riddles are always a bit tricky.","I think this one is about something that bounces off walls."]}},{question:"I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?",answer:"map",options:["map","essay","dream","photograph","landscape"],hints:{[P.Inventor]:["Think of something that represents the world, showing cities and mountains but not in a literal way."],[P.Stranger]:["Imagine something that can fit in your hand or hang on a wall, showing vast landscapes and bodies of water, but not in their true form."]}},{question:"I fly without wings. I cry without eyes. Whenever I go, darkness flies. What am I?",answer:"cloud",options:["cloud","bat","wind","shadow","storm"],hints:{[P.Inventor]:["The sphinxs riddles can be twisted. Think about things that move or change without the usual parts, like wings or eyes."],[P.Stranger]:["Look at your surroundings. Shadows often behave in strange ways, dont they?","They move, disappear, and seem to fly without wings."]}}];function ma(t){return t instanceof ya&&Ea(t.player,T.FindPotionIngredients)?1:0}function ba(t,e){const i=ma(t);return fa[i].hints[e]}function va(t,e,i){t===function(t){const e=ma(t);return fa[e].answer}(e.scene)?e.message.setDialog({messages:["That is correct. Well done, you may pass."],onCompleted:t=>{t.quests.updateExistingQuest(T.SphinxRiddle,!0),t.gameState.updateData({sphinxMoved:!0,sphinxFail:!1})}},i):"I dont know"===t?e.message.setDialog({messages:["Come back when you have an answer for me."]},i):e.message.setDialog({messages:["That is not correct. You will not remember how to get back to me."],onCompleted:t=>{t.gameState.updateData({mazeSolved:!1,mazeSeed:t.gameState.data.mazeSeed+1,sphinxFail:!0}),t.active=!1,t.scene.add.timeline([{at:0,tween:{targets:{value:0},value:{from:1,to:15},duration:1e3,onUpdate:t=>eo(t.getValue())}},{at:500,run:()=>{Ar(t.scene,300),_.stop()},sound:"sphinx_warp"},{at:3500,run:()=>{eo(1);const{x:e,y:i}=kr[E.Bed];t.setPosition(e,i),t.previousPosition.set(t.x+1,t.y),$r(t),Ir(t.scene,2e3)}},{at:6500,run:()=>{t.active=!0,t.message.setDialog({messages:["I just had the oddest dream.","I suppose I should continue investigating the town..."]},t)}}]).play()}},i)}const wa={[P.Inventor]:[{messages:["There is still one more gear missing.","Something tells me there is a great evil near the lake."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["Ah, the second gear. You should take it to the clock tower."],conditions:{hasItem:k.Gear2}},{messages:["You found a secret safe in the mansion?","Very interesting. There may be a hint about opening it nearby."],conditions:{journalEntry:C.SafeDiscovered}},{messages:["<color=blue>Blue Plumed Frond</color>? I have not heard of such a plant.","The stranger may know. Many secrets lie under this town."],conditions:{activeQuest:T.FindPotionIngredients}},{messages:["There are rumors of an abandoned mansion west of the town.","Some say it is haunted and dark magic lurks within."],conditions:{activeQuest:T.InvestigateTownWest}},{messages:["I see you found the first gear. You should talk to the mayor to learn more about the old clock."],conditions:{hasItem:k.Gear1},onCompleted:t=>{t.quests.updateExistingQuest(T.ForestGear,!0)}},{messages:t=>ba(t.scene,P.Inventor),conditions:{activeQuest:T.SphinxRiddle}},{messages:["Now that you have the wrench, you can fix the clock tower. Youll need three gears to do it."],conditions:{hasItem:k.Wrench}},{messages:["The clock tower is the heart of our town, but its been broken for ages. Ive got a wrench you can borrow, but youll need three special gears to fix it.","You might find the others by helping the townsfolk."],onCompleted:t=>{t.journal.addEntry(C.FixTheClock),t.inventory.addItem({type:k.Wrench,used:!1})}}],[P.Stranger]:[{messages:["I am worried about the secrets hidden near the lake.","Long ago I saw a great evil lurking there."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["Another gear? The mayor probably wants that put back in the clock tower."],conditions:{hasItem:k.Gear2}},{messages:["The lock on that safe is no ordinary lock. It requires something special to open it."],conditions:{journalEntry:C.SafeDiscovered,hasUnusedItem:k.Potion}},{messages:["Hmm a potion, I wonder what it does.","The alchemist was no ordinary person and built magical safeguards against intruders."],conditions:{hasUnusedItem:k.Potion}},{messages:["<color=green>Green Writhewood</color>? Hm, there might be some near the forest or lake."],conditions:{activeQuest:T.FindPotionIngredients}},{messages:["You heard of the mansion to the west? It was abandoned many years ago.","There is a rumor of an alchemy lab hidden somewhere nearby, but I have been searching for years and have found not even a single potion."],conditions:{activeQuest:T.InvestigateTownWest}},{messages:["Now that you have the first gear, I would talk to the inventor."],conditions:{hasItem:k.Gear1}},{messages:t=>ba(t.scene,P.Stranger),conditions:{activeQuest:T.SphinxRiddle}},{messages:["Ive heard rumors of a gear hidden deep in the Enchanted Forest. Beware of the forests creatures and traps.","One time I thought I saw an ancient being, but it ran away."],conditions:{hasItem:k.Wrench},onCompleted:t=>{t.quests.addQuest({id:T.ForestGear,completed:!1})}},{messages:["Who am I?","Eventually, you will learn."]}],[P.Sphinx]:[{messages:t=>t.gameState.data.sphinxFail?["You have returned. I am surprised you were able to find your way back.","Try again."]:Ea(t,T.FindPotionIngredients)?["I see you are back again. You may find what you are looking for ahead, but must first answer my riddle."]:["Ponder this riddle. Answer wisely."],conditions:{activeQuest:T.SphinxRiddle,completedQuest:T.SphinxRiddle,or:!0},onCompleted:(t,e)=>{t.scene.time.delayedCall(50,(()=>{t.message.setDialog({messages:t=>function(t){const e=ma(t);return[fa[e].question]}(t.scene),options:t=>function(t){const e=ma(t),i=[...fa[e].options].sort((()=>Math.random()-.5));return i.push("I dont know"),i}(t.scene),onSelected:va},e)}))}},{messages:["Welcome, brave soul. To pass, you must answer my riddle. You may only answer once. If you are unsure, you may speak to the townsfolk. Choose wisely."],onCompleted:t=>{t.quests.addQuest({id:T.SphinxRiddle,completed:!1})}}],[P.Mayor]:[{messages:["The clock is still missing a gear. It must be somewhere nearby.","Ive been hearing strange reports from the townsfolk. Its as if time is slipping. Have you felt it?"],conditions:{journalEntry:C.ClockSecondGear}},{messages:["The second gear has been found? Thats incredible news!"],conditions:{completedQuest:T.InvestigateTownWest}},{messages:["Herbs? I havent the faintest idea where to being looking. Start at the source - there are bound to be a few ingredients in the lab you found."],conditions:{activeQuest:T.FindPotionIngredients}},{messages:["The minute hand on the clock is spinning again.","It looks like its missing two more gears.","The abandoned mansion west of the town might be a good place to look."],conditions:{journalEntry:C.ClockFirstGear},onCompleted:t=>{t.quests.addQuest({id:T.InvestigateTownWest,completed:!1})}},{messages:["Did you go into the clock tower yet?"],conditions:{journalEntry:C.MetTheMayor}},{messages:["Hello, traveler. I am the mayor of this town. The clock tower has been broken for years.","Ah, I see you have found an old gear. Maybe it could be used to help fix the clock tower."],onCompleted:t=>{t.journal.addEntry(C.MetTheMayor)}}],[P.Innkeeper]:[{messages:["Welcome to our humble inn. I hope you find peace here.","We can set you up with a room if you need it."]}],[P.Baker]:[{messages:["Welcome! I bake the best bread in town."]}]},xa={[k.Gear1]:[{messages:["Hmm, this gear looks like it belongs in the clock tower. I should ask the inventor about it."]}],[k.Gear2]:[{messages:["Finally! I found the second gear to the clock tower.","I should take this and put it back."],onCompleted:t=>{t.quests.updateExistingQuest(T.InvestigateTownWest,!0)}}]},Sa={[E.ClockTower]:[{messages:["With two of the gears in place, the clocks hands are moving again."],conditions:{journalEntry:C.ClockSecondGear}},{messages:["Slowly, you align and tighten the second gear into place.","<b><i>[CLUNKING NOISE]</i></b>","Now two of the hands of the clock are moving again."],conditions:{hasItem:k.Gear2},mute:[1],onMessageShown:(t,e)=>{1===e&&t.scene.sound.playAudioSprite("sfx","clunk")},onCompleted:t=>{t.inventory.useItem(k.Gear2),t.journal.addEntry(C.ClockSecondGear)}},{messages:["The clock is partially moving again, but it is still missing two gears."],conditions:{journalEntry:C.ClockFirstGear}},{messages:["This dusty clock tower hasn't told the correct time in many years. It appears to be missing some gears.","Lets see what happens when we add the first gear. You tighten the gear into place.","<b><i>[CLUNKING NOISE]</i></b>","The clock tower is starting to partially move again. It looks like its missing two more gears."],conditions:{hasItem:k.Gear1},mute:[2],onMessageShown:(t,e)=>{2===e&&t.scene.sound.playAudioSprite("sfx","clunk")},onCompleted:t=>{t.inventory.useItem(k.Gear1),t.journal.addEntry(C.ClockFirstGear)}}],[E.Chest]:[{messages:["The chest seems to be locked.","It appears to have many symbols above the latch."],conditions:{custom:t=>!Pa(t,k.Gear1)&&void 0===ja(t.scene,k.Gear1)},onCompleted:t=>{jr(t.scene,"MemoryDialog")}}],[E.LabHatch]:[{messages:["Let me see if I can open this hatch.","Wow, the rusty key fits!","<b><i>[CREAKING NOISE]</i></b>","Alright, lets see what is down there!"],conditions:{hasItem:k.Key},mute:[2],onMessageShown:(t,e)=>{2===e&&t.scene.sound.playAudioSprite("sfx","door")},onCompleted:(t,e)=>{null==e||e.destroy(),t.inventory.useItem(k.Key),t.journal.addEntry(C.AlchemyLabFound)}},{messages:["The hatch is locked. I wonder if there is a key somewhere."]}],[E.LabBook]:[{messages:[],conditions:{journalEntry:C.ClockSecondGear}},{messages:["I should retrace my steps to see if there is anything strange or new in the area."],conditions:{custom:()=>io>0}},{messages:['How could I have missed this? The potion is called the "Elixir of Sight".',"This must be related to one of the gears in the clock tower.","Well, bottoms up, I suppose!"],conditions:{hasItem:k.Potion,custom:()=>0===io},onCompleted:t=>{t.active=!1,t.journal.addEntry(C.ExtraPotionInformation),t.inventory.useItem(k.Potion),t.scene.time.delayedCall(3500,(()=>{t.message.setDialog({messages:["I feel... different.","I should retrace my steps to see if there is anything strange or new in the area."],onCompleted:t=>{t.active=!0}},t)}))}},{messages:["With the alchemy set fixed, I should be able to recreate the experiment.","I will need to find three ingredients according to this - <color=red>Crimson Starbloom</color>, <color=green>Green Writhewood</color>, and a <color=blue>Blue Plumed Frond</color>.","Maybe I can find them in the lab or the forest. The villagers should know more."],conditions:{journalEntry:C.AlchemySetFixed},onCompleted:t=>{t.quests.addQuest({id:T.FindPotionIngredients,completed:!1}),t.gameState.updateData({mazeSolved:!1,mazeSeed:t.gameState.data.mazeSeed+1,sphinxMoved:!1})}},{messages:["Maybe I can find more information in the lab."],conditions:{activeQuest:T.ExploreLab}},{messages:["This lab journal contains notes about an ancient alchemy experiement.","According to the notes, the experiment was a failure, and the alchemist disappeared.","It does say that there might have been a problem with one of the ingredients.","Maybe I can find more information in the lab."],onCompleted:t=>{t.quests.addQuest({id:T.ExploreLab,completed:!1})}}],[E.AlchemySet]:[{messages:["Theres nothing more that I can do here."],conditions:{hasItem:k.Potion}},{messages:["Now I have all of the ingredients.","With these, I should be able to recreate the experiment.","According to the book..."],conditions:{hasUsedItem:k.HerbBlue},onCompleted:(t,e)=>{!function(t,e){const i=t.scene;t.inventory.useItem(k.HerbBlue),t.setActive(!1),Ar(i,500,(()=>{i.time.delayedCall(700,(()=>{var s;null==e||e.setFrame("alchemy_full"),null==(s=null==e?void 0:e.particles)||s.setConfig({...kr[E.AlchemySet].particles,tint:[6684791],x:30,delay:350,stopAfter:120}).start(),i.sound.playAudioSprite("sfx","potion"),Ir(i,1500,(()=>{t.message.setDialog({messages:["I have created the potion mentioned in the old journal.","I should bring it to the mysterious stranger to see if they know how to use it."],onCompleted:(t,e)=>{t.inventory.addItem({type:k.Potion,used:!1}),t.quests.updateExistingQuest(T.ExploreLab,!0),null==e||e.setFrame("alchemy_empty"),t.setActive(!0)}},e,"player_portrait")}))}))}))}(t,e)}},{messages:["The Blue Plumed Frond is last."],conditions:{hasItem:k.HerbBlue,hasUsedItem:k.HerbRed},onCompleted:(t,e)=>{wo(t,e,k.HerbBlue),t.quests.updateExistingQuest(T.FindPotionIngredients,!0)}},{messages:["The Crimson Starbloom comes next."],conditions:{hasItem:k.HerbRed,hasUsedItem:k.HerbGreen},onCompleted:(t,e)=>wo(t,e,k.HerbRed)},{messages:["The Green Writhewood goes in first."],conditions:{hasItem:k.HerbGreen},onCompleted:(t,e)=>wo(t,e,k.HerbGreen)},{messages:["Maybe the journal has more information about using this alchemy set."],conditions:{journalEntry:C.AlchemySetFixed}},{messages:["This alchemy set looks like the one in the journal.","If I can figure out how the set connects together, I might be able to recreate the experiment."],conditions:{activeQuest:T.ExploreLab},onCompleted:t=>{jr(t.scene,"PipesDialog")}},{messages:["A series of pipes and tubes. I shouldnt touch this without knowing what it does."]}],[E.LabBookshelf1]:[{messages:['<b>[Secrets of the Silver Transmutation]</b>\n"Silver, the mirror of the soul, can be yielded from common materials. Begin with a lead base, cleanse it with the tears of a willow,"','"and chant thrice under a new moon. Such processes, though fraught with danger, promise immense reward. Meticulous preparation of the material is crucial. Among these pages lie safeguards against volatile spirits"','"and the precise lunar phases essential for success. Here are protective circles and counter-spells to be used should spirits prove malevolent. This knowledge has been passed down and refined for safety."'],conditions:{activeQuest:T.ExploreLab}}],[E.LabBookshelf2]:[{messages:['<b>[Whispering Woods: A Compendium]</b>\n"The sentient trees of Eldergrove are not myths; their trunks groan with ancient wisdom. To engage them, perform the Ritual of Leaves,"','"using moonlit water and rare herbs, along with whispered incantations passed down by forest guardians. Notes on the rare Blue Moonflower, whose petals glow ghostly and unlock forest languages, are also included."','"Its bloom is brief, and harvesting must be timed at midnight to retain its properties. The chapter concludes with a discussion on plant symbiosis with Eldertrees."'],conditions:{activeQuest:T.ExploreLab}}],[E.LabBookshelf3]:[{messages:['<b>[The Essence of Fire: Ignite and Control]</b>\n"Mastering fire requires strength of will and profound respect for its power. Here, summoning circles and incantations to call forth fire spirits"','"are detailed. Each summoning demands a tribute of phoenix ash. The endeavor is perilous, as spirits may lash out if provoked. The tome also discusses methods to quell flames should they rise against the summoner."','"Included are the chant of suppression and a dousing mixture from elemental waters and frost-bitten herbs. These countermeasures are vital for maintaining control over summoned entities."'],conditions:{activeQuest:T.ExploreLab}}],[E.LabPotionShelf1]:[{messages:["Nightshade, wolfsbane, starvine, frost ferns... No, those are not the right ingedients.","Oh, a <color=red>Crimson Starbloom</color>! Yes, this should work!"],conditions:{activeQuest:T.FindPotionIngredients,custom:t=>!Pa(t,k.HerbRed)},onCompleted(t){t.inventory.addItem({type:k.HerbRed,used:!1})}},{messages:['Hm, this is an interesting collection. Whats this "Elixir of Luminescence"? Could light up some dark corners. And "Brew of Bravery"... might make me bold enough to face a dragon, or foolish enough to try. What about "Draught of the Depths"sounds like it could show me treasures or drown me in visions. Better not risk it; these might just burn me to a crisp!'],conditions:{activeQuest:T.ExploreLab}}],[E.MansionPicture]:[{messages:[],conditions:{hasItem:k.Gear2}},{messages:["A sturdy looking safe was hidden behind the picture.","There are large rusty rings to the side, as if it they were meant to be moved."],conditions:{journalEntry:C.SafeDiscovered},onCompleted:t=>{jr(t.scene,"TumblerDialog")}},{messages:["An abstract picture of blocks.","Wait a moment, something is behind this picture...","<b><i>[CREAK]</i></b>"],mute:[2],onMessageShown:(t,e)=>{2===e&&t.scene.sound.playAudioSprite("sfx","chest")},onCompleted:t=>{t.journal.addEntry(C.SafeDiscovered)},conditions:{hasUsedItem:k.Potion}},{messages:["An abstract picture of blocks."]}],[E.MansionHole]:[{messages:["Literally a hole in the wall.","Huh, there is something here. It's a key!"],conditions:{hasItem:k.Key,invert:!0},onCompleted:t=>{t.inventory.addItem({type:k.Key,used:!1})}},{messages:["Literally a hole in the wall."]}],[E.Bed]:[{conditions:{custom:t=>et(t.scene)},messages:["What a long day. Time for some sleep before I continue my journey."],onCompleted:t=>function(t){_.stop(),t.setActive(!1),t.gameState.updateData({day:t.gameState.data.day+1,night:!1}),t.scene.add.timeline([{at:0,run:()=>Ar(t.scene,500,(()=>{t.setPosition(2660,t.y),t.previousPosition.set(t.x+1,t.y),$r(t)}))},{at:1e3,run:()=>t.scene.sound.playAudioSprite("sfx","lullaby",{rate:.85,volume:.4})},{at:4e3,run:()=>{Ir(t.scene,1e3,(()=>{t.message.setDialog({messages:["Ah, what a lovely rest. Time to get back to work!"],onCompleted:t=>t.setActive(!0)},t)}))}}]).play()}(t)},{messages:["A comfortable bed.","I should rest here if I need to."]}]};function ka(t,e,i){for(const s of t){const{conditions:t}=s,n=[];if(void 0!==(null==t?void 0:t.hasItem)&&n.push(Pa(e,t.hasItem)),void 0!==(null==t?void 0:t.hasUnusedItem)&&n.push(Oa(e,t.hasUnusedItem)),void 0!==(null==t?void 0:t.hasUsedItem)&&n.push(Ca(e,t.hasUsedItem)),void 0!==(null==t?void 0:t.completedQuest)&&n.push(Ia(e,t.completedQuest)),void 0!==(null==t?void 0:t.activeQuest)&&n.push(Ea(e,t.activeQuest)),void 0!==(null==t?void 0:t.journalEntry)&&n.push(Aa(e,t.journalEntry)),(null==t?void 0:t.custom)&&n.push(t.custom(e,i)),null==t?void 0:t.invert){if(null==t?void 0:t.or){if(n.some((t=>!t)))return s}else if(n.every((t=>!t)))return s;return}if(null==t?void 0:t.or){if(n.some((t=>t)))return s}else if(n.every((t=>t)))return s}}class Ta extends a.Physics.Arcade.Image{constructor(t,i,s){const{x:n,y:r,image:o}=Xr[i];super(t,n,r,"items",o),e(this,"itemType"),e(this,"player"),e(this,"particles"),e(this,"light"),e(this,"disabled",!1),e(this,"initialized",!1),this.name=`Item-${i}`,this.itemType=i,this.player=s,this.setScale(.35).setDepth(Ms.Items),_a(this,Xr[i])}lazyInit(t){if(!t&&(this.initialized||!Rr(this,this.player)))return;if(Pa(this.player,this.itemType))return void this.destroy();this.scene.add.existing(this),this.scene.physics.add.existing(this),w.debug&&this.setInteractive({draggable:!0}),this.particles=this.scene.add.particles(this.x,this.y,"props",{frame:"warp",scale:{start:0,end:.9},alpha:{start:.7,end:0},delay:500,lifespan:1500,maxAliveParticles:1}).setDepth(Ms.Items).setName(`Item-${this.itemType}-Particles`),w.debug?this.light=new zr(this.scene,this.x,this.y,this.displayHeight/150*150,16764074,2):this.light=this.scene.lights.addLight(this.x,this.y,this.displayHeight/150*150,16764074,2);const e=Xr[this.itemType].onCreate;e&&e(this),this.initialized=!0}onInteract(t){return t[Br.Continue]?(this.scene.time.delayedCall(0,(()=>{this.player.inventory.addItem({type:this.itemType,used:!1});const t=ka(xa[this.itemType]||[],this.player,this);t&&(null==t?void 0:t.messages.length)>0&&this.player.message.setDialog(t,this,"player_portrait")})),this.destroy(),x.Item):x.None}destroy(t){var e,i,s;null==(e=this.particles)||e.destroy(),this.light instanceof zr?this.light.destroy():null==(s=null==(i=this.scene)?void 0:i.lights)||s.removeLight(this.light),super.destroy(t)}getButtonPrompt(){return[`Pick Up ${Xr[this.itemType].name}`,"Press [CONTINUE]"]}update(){var t,e;this.lazyInit(),null==(t=this.particles)||t.setPosition(this.x,this.y),null==(e=this.light)||e.setPosition(this.x,this.y)}}function Pa(t,e){return void 0!==t.inventory.inventory.find((t=>t.type===e))}function Oa(t,e){return void 0!==t.inventory.inventory.find((t=>t.type===e&&!t.used))}function Ca(t,e){return void 0!==t.inventory.inventory.find((t=>t.type===e&&t.used))}function Ea(t,e){return t.quests.quests.some((t=>t.id===e&&!t.completed))}function Ia(t,e){return t.quests.quests.some((t=>t.id===e&&t.completed))}function Aa(t,e){return t.journal.journal.includes(e)}function Ma(t,e){return t.children.getAll().filter((t=>t instanceof e))}function Ra(t,e,i){const s=function(t,e){return Ma(t,Bo).find((t=>t.warpType===e))}(t,e);s&&s.updateLocked(i)}function ja(t,e){return Ma(t,Ta).find((t=>t.itemType===e))}function La(t,e){return Ma(t,Ur).find((t=>t.propType===e))}function _a(t,e){const{scale:i,alpha:s,angle:n,depth:r,skipLighting:o,origin:a,initializeOnStart:l}=e;i&&("object"==typeof i?t.setScale(i.x,i.y):t.setScale(i)),s&&t.setAlpha(s),n&&t.setAngle(n),r&&t.setDepth(r),a&&t.setOrigin(a.x,a.y),o||t.setPipeline("Light2D"),t.setPostPipeline("XRayPipeline"),l&&t.lazyInit(!0)}class Fa extends a.GameObjects.Text{constructor(t,e,i=3500,s=N){const n=Ma(t,Fa).reduce(((t,e)=>Math.max(t,e.y-20)),0)+65;super(t,20,n,e,{...Rs,backgroundColor:"#"+s,padding:{x:10,y:5}}),this.setAlpha(0).setDepth(Ms.Overlay).setScrollFactor(0),t.add.existing(this),t.add.tween({targets:this,alpha:1,scale:1.05,y:n+10,duration:350,hold:i,yoyo:!0,repeat:0,onComplete:()=>this.destroy()})}}function Da(t){return{player:{x:t.player.x,y:t.player.y,flip:t.player.flipX},journal:t.player.journal.journal.sort(),inventory:t.player.inventory.inventory.sort(((t,e)=>t.type-e.type)),quests:t.player.quests.quests.sort(((t,e)=>t.id-e.id)),gameState:t.player.gameState.data,settings:{gamepad:t.gamepad.visible,debug:w.debug,zoomed:w.zoomed,useShader:w.useShader,time:Date.now(),muted:t.sound.mute}}}function za(){const t=localStorage.getItem(Va);let e,i;try{t&&(e=JSON.parse(t))}catch(s){console.error(s),i=s}return{save:e||Ka[Xa.New],error:i,newGame:!e}}const Ba={journal:{enumObj:C,enumName:"JournalEntry"},inventory:{enumObj:k,enumName:"ItemType"},type:{enumObj:k,enumName:"ItemType"},quests:{enumObj:T,enumName:"QuestType"},id:{enumObj:T,enumName:"QuestType"}};function Wa(t,e){const i={...w};return w.debug=t.settings.debug,w.zoomed=t.settings.zoomed,w.useShader=t.settings.useShader,to(w.useShader),no(e,!1,!0),w.zoomed!==i.zoomed?(function(t,e){const i=e?h:l;w.zoomed=e,w.width=i.width,w.height=i.height,w.cameraOffset=i.height/3,t.scale.setGameSize(i.width,i.height),t.scene.restart()}(e,w.zoomed),!0):w.debug!==i.debug&&(e.scene.restart(),!0)}function Na(t){const{save:e,error:i,newGame:s}=za();i&&new Fa(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4);try{Wa(e,t),t.sound.stopAll(),t.sound.mute=e.settings.muted,t.player.setX(e.player.x),t.player.setY(e.player.y),t.player.previousPosition.set(e.player.x+(e.player.flip?1:-1),e.player.y),t.time.delayedCall(50,(()=>{try{t.player.inventory.createUI(),t.player.quests.createUI(),t.player.journal.createUI(),s&&function(t){_.start(M.Station);const e=t.add.image(800,1460,"train").setScale(1.35).setDepth(Ms.Shader),i=t.player;i.previousPosition.set(i.x+1,i.y),$r(i),i.active=!1,t.add.timeline([{at:200,run:()=>t.sound.playAudioSprite("sfx","train_whistle",{rate:.9,volume:.6})},{at:2500,tween:{targets:e,x:-500,duration:5e3},run:()=>t.sound.playAudioSprite("sfx","train_rolling",{volume:.6})},{at:2500,tween:{targets:e,y:e.y-4,loop:-1,yoyo:!0,duration:100}},{at:7800,run:()=>{e.destroy(),i.message.setDialog({messages:["Now that I have arrived in town, I should talk to the townsfolk about the strange occurrences.","Maybe someone has seen something that could help me start my investigation."],onCompleted:t=>{t.active=!0}},i)}}]).play()}(t),e.inventory.sort(((t,e)=>t.type-e.type)).forEach((e=>t.player.inventory.addItem(e,!0))),e.journal.sort().reverse().forEach((e=>t.player.journal.addEntry(e,!0))),e.quests.sort(((t,e)=>t.id-e.id)).forEach((e=>t.player.quests.addQuest(e,!0))),t.player.gameState.updateData(e.gameState,!0)}catch(i){console.error(i),new Fa(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4,H),Ga(t,Ka[Xa.New]),Na(t)}})),t.gamepad.setVisible(e.settings.gamepad),As(e,Ka[Xa.New])&&Ga(t,void 0,!0)}catch(n){console.error(n),new Fa(t,"Unfortunately, it looks like this save is corrupted.\nFailed to Load Game",1e4,H),Ga(t,Ka[Xa.New]),Na(t)}}function Ga(t,e,i){const s=Da(t);localStorage.setItem(Va,JSON.stringify(e||s)),i||t.tweens.add({targets:t.saveIcon,alpha:.7,scale:.6,duration:500,hold:250,yoyo:!0,onComplete:()=>t.saveIcon.setAlpha(0)})}function Ha(t){w.prod&&Ga(t)}const Ua={mazeSolved:!1,mazeSeed:0,sphinxFail:!1,sphinxMoved:!1,day:1,night:!1};class $a{constructor(t,i){e(this,"scene"),e(this,"player"),e(this,"data"),this.scene=t,this.player=i,this.data={...Ua}}updateData(t,e){this.data={...this.data,...t},Object.entries(t).forEach((([t,i])=>{this.handleSideEffects(t,i,e)})),e||Ha(this.scene)}handleSideEffects(t,e,i){"night"===t&&(e?function(t,e=!0){tt||(st(t,V,e),nt(t,1),t.lights.lights.forEach((i=>{const s=i.intensity;i.setVisible(!0),e&&(i.setIntensity(0),t.tweens.add({targets:i,duration:Z,intensity:s}))})))}(this.scene,!i):it(this.scene,!i))}}const Va="chrono-sleuth-save";var Xa=(t=>(t[t.New=0]="New",t[t.Act1=1]="Act1",t[t.Act2=2]="Act2",t[t.LabItems=3]="LabItems",t[t.Act3=4]="Act3",t))(Xa||{});const qa={player:{x:ho.x,y:ho.y,flip:!1},journal:[],inventory:[],quests:[],gameState:{...Ua},settings:{gamepad:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t))),debug:!1,zoomed:!0,useShader:!0,time:Date.now(),muted:!1}},Ya={...qa.settings,gamepad:!1},Ka={0:qa,1:{player:{x:642,y:650,flip:!1},journal:[C.FixTheClock],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!1}],quests:[{id:T.ForestGear,completed:!1},{id:T.SphinxRiddle,completed:!0}],gameState:{...Ua,mazeSolved:!0,sphinxMoved:!0},settings:{...Ya}},2:{player:{x:-770,y:650,flip:!0},journal:[C.FixTheClock,C.MetTheMayor,C.ClockFirstGear],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!0}],quests:[{id:T.ForestGear,completed:!0},{id:T.SphinxRiddle,completed:!0},{id:T.InvestigateTownWest,completed:!1}],gameState:{...Ua,mazeSolved:!0,sphinxMoved:!0},settings:{...Ya}},3:{player:{x:-1500,y:1729,flip:!0},journal:[C.FixTheClock,C.MetTheMayor,C.ClockFirstGear,C.AlchemyLabFound,C.AlchemySetFixed],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!0},{type:k.Key,used:!0}],quests:[{id:T.ForestGear,completed:!0},{id:T.SphinxRiddle,completed:!0},{id:T.InvestigateTownWest,completed:!1},{id:T.ExploreLab,completed:!1},{id:T.FindPotionIngredients,completed:!1}],gameState:{...Ua},settings:{...Ya}},4:{player:{x:5073.875,y:915,flip:!1},journal:[C.FixTheClock,C.MetTheMayor,C.ClockFirstGear,C.AlchemyLabFound,C.AlchemySetFixed,C.SafeDiscovered,C.ExtraPotionInformation,C.ClockSecondGear],inventory:[{type:k.Wrench,used:!1},{type:k.Gear1,used:!0},{type:k.Key,used:!0},{type:k.HerbRed,used:!0},{type:k.HerbGreen,used:!0},{type:k.HerbBlue,used:!0},{type:k.Potion,used:!0},{type:k.Gear2,used:!0}],quests:[{id:T.ForestGear,completed:!0},{id:T.SphinxRiddle,completed:!0},{id:T.InvestigateTownWest,completed:!0},{id:T.ExploreLab,completed:!0},{id:T.FindPotionIngredients,completed:!0}],gameState:{...Ua,mazeSolved:!0,sphinxMoved:!0},settings:{...Ya}}};class Qa extends a.Scene{constructor(){super({key:"Boot",pack:{files:[{type:"image",key:"splash",url:"assets/splash.jpg"},{type:"image",key:"logo",url:"assets/logo.jpg"}]}})}init(){var t;this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(w.width,w.height),this.add.image(35,w.height-30,"logo").setOrigin(0,1).setScale(.4),t=this.sound,_=new F(t)}preload(){this.load.setPath("assets"),this.load.font("m6x11","fonts/m6x11.ttf","truetype"),this.load.bitmapFont("m6x11-24","fonts/m6x11-24.png","fonts/m6x11-24.xml"),this.load.font("notepen","fonts/Notepen.ttf","truetype"),this.load.font("Germania One","fonts/GermaniaOne-Regular.ttf","truetype"),this.load.atlas("icons","atlases/icons.png","atlases/icons.json"),this.load.audioSprite("words","sounds/words.json"),this.load.audioSprite("sfx","sounds/sfx.json"),this.load.audio(M.Town,L[M.Town]),this.load.json("build",`../build.json?cacheBust=${Date.now()}`),w.phaserInspector&&(this.load.scripts("inspector",["https://cdn.jsdelivr.net/npm/tweakpane@3.1.10/dist/tweakpane.js","https://cdn.jsdelivr.net/npm/phaser-plugin-inspector@2.5.0/dist/phaser-plugin-inspector.umd.js"]),this.load.once("complete",(()=>{PhaserPluginInspector.Install(this.plugins)})))}create(){var t;try{const e=null==(t=this.cache.json.get("build"))?void 0:t.buildTime;if(e&&"2025-02-18T18:41:10.063Z"!==e)return this.add.text(w.width/2,w.height/2,"New version available!\nUpdating Game...",{...Rs,align:"center",fontSize:48}).setOrigin(.5).postFX.addGlow(0,10),caches.keys().then((t=>{for(const e of t)caches.delete(e)})),void setTimeout((()=>window.location.reload()),3e3)}catch(e){console.error(e)}w.prod&&localStorage.getItem(Va)?this.scene.start("MainMenu"):this.scene.start("Preloader")}}function Ja(t){t.load.setPath("assets"),t.load.image("train","maps/intro/train.png"),t.load.image("layer2","maps/intro/layer2.png"),t.load.image("layer3","maps/intro/layer3.png"),t.load.image("layer4","maps/intro/layer4.png"),t.load.image("layer5","maps/intro/layer5.png"),w.prod&&t.load.audio(M.Intro,L[M.Intro])}class Za extends a.Scene{constructor(){super("Intro"),e(this,"player"),e(this,"playerProgess",0),e(this,"direction",1),e(this,"pauseDuration",0)}preload(){Ja(this)}init(){var t,e;this.sound.mute=Ka[Xa.New].settings.muted,w.prod||(null==(t=this.input.keyboard)||t.on("keydown-BACK_SLASH",(()=>{Ar(this,500,(()=>{this.textures.exists("props")?this.scene.start("Game"):this.scene.start("Preloader")}))})),null==(e=this.input.keyboard)||e.on("keydown-R",(()=>{this.scene.restart()})))}create(){var t;_.setScene(this),_.start(M.Intro);const e=this.sound.addAudioSprite("sfx"),i=e.markers.train_rolling;e.addMarker({name:"train_rolling_trimmed",start:(i.start||0)+.5,duration:3.25}),e.play("train_rolling_trimmed",{loop:!0,volume:.15});const s=w.zoomed?.75:1;Ir(this,350),this.add.image(w.width,w.height,"layer5").setScale(5.4*s);const n=this.add.image(0,w.height,"layer4").setScale(5.4*s),r=this.add.image(0,w.height,"layer4").setScale(5.4*s),o=this.add.image(0,350*s,"layer3").setScale(2.16*s),a=this.add.image(0,.7*w.height,"layer2").setScale(5.4*s),l=w.width;this.tweens.add({targets:[n],x:{from:2.5*-l,to:0},duration:12e4,repeat:-1}),this.tweens.add({targets:[r],x:{from:0,to:2.5*l},duration:12e4,repeat:-1}),this.tweens.add({targets:o,x:{from:2*-l,to:2.75*l},duration:6e4,hold:9e4,repeat:-1}),this.tweens.add({targets:[a],x:{from:-l,to:1.5*l},duration:15e3,hold:45e3,repeat:-1});const h=this.add.container(0,w.zoomed?-35:0);this.player=this.add.sprite(560*s,w.height-250*s,"character",0).setScale(2.5*s),this.player.anims.create({key:"walk",frames:this.player.anims.generateFrameNumbers("character",{start:0,end:5}),frameRate:5,repeat:-1}),this.player.anims.play("walk"),this.player.anims.pause(),h.add(this.player),this.cameras.main.startFollow(this.player,!0,.1,.1,0,120);const c=this.add.image(w.width/2,w.height/2,"train").setScale(2.35*s);h.add(c),this.tweens.add({targets:h,x:h.x+1,y:h.y+5,duration:300,hold:300,ease:"Bounce",repeat:-1}),null==(t=this.add.rectangle(-w.width/2,w.height-(w.zoomed?60:35),2*w.width,35,4472896).setOrigin(0).postFX)||t.addShadow(0,0,.5,1),function(t,e){const i=w.zoomed?.75:1,s=new fo(t),n=t.add.text(w.width/2,w.height/2,"Later that day...",{...Rs,fontSize:"42px"}).setOrigin(.5).setScrollFactor(0).setAlpha(0);e.setAngle(5);const r=t.add.timeline([{at:1500,tween:{targets:e,x:850*i,duration:2500,onComplete:()=>e.anims.pause()},run:()=>{e.anims.resume(),t.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:3100,run:()=>t.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:6e3,run:()=>Ar(t,500)},{at:7500,run:()=>{const e=t.cameras.main;e.stopFollow(),e.centerOn(1e4,1e4),n.setAlpha(1),Ir(t,500)}},{at:1e4,run:()=>Ar(t,500)},{at:12e3,run:()=>{t.textures.exists("warp")?t.scene.start("Game"):t.scene.start("Preloader")}}]),o=t.add.timeline([{at:1500,tween:{targets:e,x:1200*i,duration:2500,onComplete:()=>e.anims.pause()},run:()=>{e.anims.resume(),t.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:3100,run:()=>t.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:5500,run:()=>{e.setFlipX(!0),e.setAngle(-5)}},{at:6500,run:()=>{s.setDialog({messages:["No doubt about it, this will be a strange journey.","Whatever awaits me in this town, its certain that nothing will ever be the same again."],onCompleted:()=>r.play()},void 0,"player_portrait")}}]);t.add.timeline([{at:2500,tween:{targets:e,x:850*i,duration:3e3,onComplete:()=>e.anims.pause()},run:()=>{e.anims.resume(),t.sound.playAudioSprite("sfx","ladder",{rate:.6})}},{at:4100,run:()=>t.sound.playAudioSprite("sfx","ladder",{rate:.6})},{at:7e3,run:()=>{e.setFlipX(!0),e.setAngle(-5)}},{at:8e3,run:()=>{e.setFlipX(!1),e.setAngle(5)}},{at:9e3,run:()=>{s.setDialog({messages:["What a beautiful mountain-scape. I almost forgot where I am headed.","Its been three days since the letter arrived... It has been many years since I last visited that sleepy old town.","Rumors swirl of strange occurrences. People disappearing, clocks that never strike the hour, and a darkness that lingers beneath the surface."],onCompleted:()=>o.play()},void 0,"player_portrait")}}]).play()}(this,this.player)}}class tl extends $o{constructor(t,e,i){super(t,e,i,t.scale.isFullscreen?"minimize":"maximize",(()=>{t.scale.isFullscreen?t.scale.stopFullscreen():t.scale.startFullscreen()})),t.scale.on(Phaser.Scale.Events.ENTER_FULLSCREEN,(()=>{this.img.scene=t,this.img.setTexture("icons","minimize")})),t.scale.on(Phaser.Scale.Events.LEAVE_FULLSCREEN,(()=>{this.img.scene=t,this.img.setTexture("icons","maximize")}))}}class el extends a.Scene{constructor(){super("MainMenu")}create(){_.setScene(this),_.start(M.Town),this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(w.width,w.height);const t=this.add.container(0,0);t.setAlpha(0),this.tweens.add({targets:t,alpha:1,duration:150}),t.add(this.add.image(35,w.height-30,"logo").setOrigin(0,1).setScale(.4)),new Wr(this),new Uo(this,!0).setVisible(!1);const e=new go(this);t.add(e);const i=new tl(this,w.width-30,30);e.addButton(i),localStorage.getItem(Va)&&e.addButton(new uo(this,w.width-120,w.height-145,"Continue",(()=>this.scene.start("Preloader")),{align:"center"}).setFixedSize(200,70)),e.addButton(new uo(this,w.width-120,w.height-60,"New Game",(()=>{localStorage.removeItem(Va),this.scene.start("Preloader")}),{align:"center"}).setFixedSize(200,70)),e.setActiveButton(1)}}class il extends a.Scene{constructor(){super("Preloader"),e(this,"container")}init(){this.add.image(0,0,"splash").setOrigin(0).setDisplaySize(w.width,w.height),this.add.image(35,w.height-30,"logo").setOrigin(0,1).setScale(.4);const t=.66*w.width,e=.05*w.height,i=this.add.container(.24*w.width,.86*w.height);this.container=i;const s=this.add.rectangle(0,0,t,e).setStrokeStyle(1,16777215,.85).setOrigin(0);i.add(s);const n=this.add.rectangle(3,3,0,e-6,16777215,.85).setOrigin(0);i.add(n),this.load.on("progress",(e=>{const i=w.prod?.6*e:e;n.width=(t-6)*i})),w.prod&&this.load.on("complete",(()=>{this.tweens.add({targets:n,width:t-6,duration:2e3})}));const r=this.add.image(w.width-50,w.height-60,"icons","settings").setScale(.75);this.tweens.add({targets:r,angle:360,duration:2e3,delay:100,repeat:-1})}preload(){this.load.setPath("assets"),this.load.image("station","maps/station.png"),this.load.image("town","maps/town.png"),this.load.image("library","maps/library.png"),this.load.image("inn","maps/inn.png"),this.load.image("clock_outside","maps/clock_outside.png"),this.load.image("clock_inner","maps/clock_inner.png"),this.load.image("forest","maps/forest.png"),this.load.image("lake","maps/lake.png"),this.load.image("mansion_outside","maps/mansion_outside.png"),this.load.image("mansion_inside","maps/mansion_inside.png"),this.load.image("alchemy_lab","maps/alchemy_lab.png"),this.load.spritesheet("portal","spritesheets/portal.png",{frameWidth:140,frameHeight:120}),this.load.spritesheet("character","spritesheets/player.png",{frameWidth:40,frameHeight:74}),this.load.atlas("items","atlases/items.png","atlases/items.json"),this.load.atlas("props","atlases/props.png","atlases/props.json"),this.load.atlas("characters","atlases/characters.png","atlases/characters.json"),w.prod&&Object.entries(L).filter((([t,e])=>t!==M.Town)).forEach((([t,e])=>{this.load.audio(t,e)})),this.load.image("train","maps/intro/train.png"),localStorage.getItem(Va)||Ja(this)}create(){w.prod?this.time.delayedCall(2500,(()=>Ar(this,300,(()=>this.start())))):this.start()}start(){localStorage.getItem(Va)?this.scene.start("Game"):this.scene.start("Intro")}}class sl extends a.GameObjects.Container{constructor(t,i,s){var n,r,o,l,h;super(t,i,s),e(this,"buttons",[]),e(this,"activeIndex",new a.Math.Vector2),e(this,"cursor"),t.add.existing(this).setScrollFactor(0),this.activeIndex.set(-1,-1),null==(n=t.input.keyboard)||n.on("keydown-UP",(()=>{this.setActiveButton({x:0,y:-1})})),null==(r=t.input.keyboard)||r.on("keydown-DOWN",(()=>{this.setActiveButton({x:0,y:1})})),null==(o=t.input.keyboard)||o.on("keydown-LEFT",(()=>{this.setActiveButton({x:-1,y:0})})),null==(l=t.input.keyboard)||l.on("keydown-RIGHT",(()=>{this.setActiveButton({x:1,y:0})})),null==(h=t.input.keyboard)||h.on("keydown-ENTER",(()=>{const t=this.getActiveButton();t&&t.onClick()})),t.input.on("pointermove",(()=>{this.cursor.setVisible(!1)}))}setButtons(t){this.buttons=t,this.activeIndex.set(-1,-1),this.removeAll(!0),this.cursor=this.scene.add.rectangle(0,0,60,80).setStrokeStyle(2,Y(W),.75).setVisible(!1).setDepth(1),this.add(this.cursor);for(const e of t)for(const t of e)void 0!==t&&this.add(t)}getActiveButton(){var t;return null==(t=this.buttons[this.activeIndex.y])?void 0:t[this.activeIndex.x]}setActiveButton(t){var e,i,s,n,r,o,l;let{x:h,y:c}=this.activeIndex;if(!1===this.cursor.visible){const t=null==(e=this.buttons[c])?void 0:e[h];return void(t&&(this.updateButtonSize(t),this.cursor.setPosition(t.x,t.y).setVisible(!0),this.cursor.setVisible(!0)))}const u=this.buttons.length;if(c=a.Math.Clamp(c,0,u-1),h=a.Math.Clamp(h,0,((null==(i=this.buttons[c])?void 0:i.length)||0)-1),0===t.x){let e;if(-1!==this.activeIndex.y){for(;c>=0&&c<u&&void 0===e;)c+=t.y,e=null==(s=this.buttons[c])?void 0:s[h];if(!e)return}h=a.Math.Clamp(h,0,(null==(n=this.buttons[c])?void 0:n.length)-1)}if(0===t.y&&-1!==this.activeIndex.x){let e;for(;h>=0&&h<(null==(r=this.buttons[c])?void 0:r.length)&&void 0===e;)h+=t.x,e=null==(o=this.buttons[c])?void 0:o[h];if(!e)return}const d=null==(l=this.buttons[c])?void 0:l[h];d&&(this.updateButtonSize(d),this.cursor.setPosition(d.x,d.y).setVisible(!0),this.activeIndex.set(h,c))}updateButtonSize(t){const e=1.2;t instanceof uo&&this.cursor.setSize(t.displayWidth*e,t.displayHeight*e),t instanceof $o&&this.cursor.setSize(t.rect.displayWidth*e,t.rect.displayHeight*e)}}const nl=[[1,1,1,0,1],[1,0,1,0,1],[1,1,1,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],rl=[["0","1","2"],["3"," ","4"],["5","6","7"]];class ol extends a.Scene{constructor(){super("UITest"),e(this,"selected"),e(this,"cursor"),e(this,"grid"),this.selected=void 0}create(){var t;const e=[];for(let i=0;i<nl.length;i++){const t=[];for(let e=0;e<nl[i].length;e++)nl[i][e]?t.push(this.btn(e,i)):t.push(void 0);e.push(t)}this.grid=new sl(this),this.grid.setButtons(e),null==(t=this.input.keyboard)||t.on("keydown-BACK_SLASH",(()=>{e[0][0].text="0",e[0][1].text="1",e[0][2].text="2",e[1][0].text="3",e[1][2].text="4",e[2][0].text="5",e[2][1].text="6",e[0][4].text=" ",e[1][4].text=" ",e[2][4].text=" ",e[3][4].text=" ",e[4][4].text=" ",e[5][4].text=" ",e[6][4].text=" "}))}btn(t,e){return new uo(this,50+60*t,50+85*e,t<3?" ":e.toString(),(t=>this.selectButton(t)))}selectButton(t){if(void 0===this.selected)this.selected=t,t.setSelected(!0);else{const e=this.selected.text;this.selected.setSelected(!1),this.selected.text=t.text,t.text=e,this.selected=void 0,this.checkValid()&&console.log("You Won!")}}checkValid(){var t;let e=!0;for(let i=0;i<rl.length;i++)for(let s=0;s<rl[0].length;s++){const n=null==(t=this.grid.buttons[i])?void 0:t[s];n&&n.text!==rl[i][s]&&(e=!1)}return e}}class al extends a.Scene{constructor(t){super(t.key),e(this,"dialogData"),e(this,"container"),e(this,"keys"),e(this,"title"),e(this,"closing"),e(this,"additionalUI"),this.dialogData=t}create(){var t,e,i;this.additionalUI=[],this.closing=!1,this.container=this.add.container(w.width/2,w.height/2),this.dialogData.skipUI||(this.container.add(this.add.rectangle(0,0,.95*w.width,.95*w.height,0,.75).setStrokeStyle(4,Y(W))),this.container.add(new uo(this,.43*w.width,-.39*w.height,"X",(()=>this.close(!1)),{backgroundColor:`#${H}`})),w.prod||this.dialogData.hideCloseSuccess||this.container.add(new $o(this,.38*w.width,-.4*w.height,"award",(()=>this.startClose(!0)))),this.title=this.add.text(0,-.4*w.height,this.dialogData.title,{...Rs,fontSize:48}).setOrigin(.5),this.container.add(this.title)),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>{this.startClose(!1)})),null==(e=this.input.keyboard)||e.on("keydown-BACKSPACE",(()=>{this.startClose(!1)})),w.prod||null==(i=this.input.keyboard)||i.on("keydown-BACK_SLASH",(()=>{this.startClose(!0)})),this.keys=new Wr(this),new Uo(this,!0).setVisible(this.dialogData.gamepadVisible),this.container.setAlpha(0),this.dialogData.childScene?(this.scene.launch(this.dialogData.childScene,{parent:this}),this.scene.get(this.dialogData.childScene).events.on("create",(()=>this.fadeIn()))):this.fadeIn(),_.setScene(this),_.fadeMusic(.15)}fadeIn(){this.tweens.killAll(),this.tweens.add({targets:this.getTargets(),alpha:{start:0,to:1},delay:100,duration:500})}fadeOut(t){this.tweens.killAll(),this.tweens.add({targets:this.getTargets(),alpha:{start:1,to:0},duration:250,hold:250,onComplete:t})}addTarget(t){t.setAlpha(0),this.additionalUI.push(t)}getTargets(){return[this.container,...this.additionalUI]}startClose(t){this.closing||(this.closing=!0,this.close(t))}close(t){this.preHandleSuccess(t);const e=this.scene.get("Game");_.fadeMusic(_.volume,500,(()=>_.setScene(e))),this.fadeOut((()=>{var i,s;this.scene.stop(),this.dialogData.childScene&&this.scene.stop(this.dialogData.childScene),this.scene.resume(e),null==(i=null==e?void 0:e.gamepad)||i.setAlpha(1),null==(s=null==e?void 0:e.gamepad)||s.resetButtons(),this.handleSuccess(t)}))}preHandleSuccess(t){}}const ll=["Chronomancers Dilemma","The Forgotten Aeon","Taming the Wild Griffin","Transmutation of the Soul","Surrender to the Starlit Realm","The Bards Forbidden Melody","Bound by Fate and Fire","The Creation of Time","Secrets of the Fifth Element","The Enchanted Knights Oath","A Potion for Yesterday","Tome of the Lost Hours","The Midnight Convergence","The Rogues Tempting Treasure","The Eternal End","Whispers of the Moonlit Grove","The Sorcerers Gentle Caress","The Elixir That Binds","The Philosophers Vice","The Silver Circles Curse","A Mages Soft Touch","The Alchemists Second Life","The Thaumaturges Gambit","Through the Alchemists Looking Glass","Legends of the Velvet Throne"],hl=[ll.indexOf("The Creation of Time"),ll.indexOf("Chronomancers Dilemma"),ll.indexOf("Transmutation of the Soul"),ll.indexOf("The Eternal End")];class cl extends a.GameObjects.Container{constructor(t,i,s,n,r,o){var l,h;super(t,i,s),e(this,"textObject"),e(this,"maskGraphics"),e(this,"scrollbar"),e(this,"scrollTimer"),e(this,"scrollY"),e(this,"boxHeight"),t.add.existing(this),this.scrollY=0,this.boxHeight=0,this.textObject=new a.GameObjects.Text(t,0,0,n,{...Rs,padding:{x:10,y:10},...r}),this.textObject.setOrigin(0).setScrollFactor(0),this.textObject.setInteractive({cursor:"ns-resize"}),this.add(this.textObject),t.input.on("wheel",this.handleScroll,this),this.textObject.on("pointermove",this.handleDrag,this),this.textObject.on("pointerdown",((t,e,i)=>{o&&(clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout((()=>{const t=this.textObject.getWrappedText().length,e=i/this.textObject.height,s=Math.floor(e*t);o(s)}),200))})),null==(l=t.input.keyboard)||l.on("keydown-UP",(()=>{this.scrollY-=30,this.updateTextPosition()})),null==(h=t.input.keyboard)||h.on("keydown-DOWN",(()=>{this.scrollY+=30,this.updateTextPosition()})),this.maskGraphics=t.add.graphics().setPosition(i,s).setScrollFactor(0).setVisible(!1),this.add(this.maskGraphics),this.scrollbar=t.add.rectangle(0,0,(null==r?void 0:r.scrollbarWidth)||6,0,(null==r?void 0:r.scrollbarColor)||Y(V)).setScrollFactor(0),this.add(this.scrollbar)}setBoxSize(t,e){this.boxHeight=e,this.maskGraphics.clear(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(0,0,t,e);const i=this.maskGraphics.createGeometryMask();return this.textObject.setMask(i),this.textObject.setWordWrapWidth(t-12),this.textObject.setFixedSize(t-12,0),this.updateTextPosition(),this}setText(t){return this.textObject.setText(t),this.updateTextPosition(),this}handleDrag(t){t.isDown&&(clearTimeout(this.scrollTimer),this.scrollY-=t.velocity.y/2,this.updateTextPosition())}handleScroll(t,e,i,s,n){this.scrollY+=.5*s,this.updateTextPosition()}updateTextPosition(){const t=Math.max(0,this.textObject.height-this.boxHeight);this.scrollY=a.Math.Clamp(this.scrollY,0,t),this.textObject.y=-this.scrollY;const e=this.scrollY/t,i=this.boxHeight/this.textObject.height;this.scrollbar.height=i*this.boxHeight,this.scrollbar.setPosition(this.textObject.width+6,e*(this.boxHeight-i*this.boxHeight))}}const ul="chrono-sleuth-debug-tab",dl=[];function pl(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function gl(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?pl(Object(i),!0).forEach((function(e){yl(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):pl(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function yl(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function fl(t){return t.slice(0,-1)}function ml(t,e=0){return e?Array.from(Array(e-t).keys()).map((e=>e+t)):Array.from(Array(t).keys())}function bl(t){return[...new Set(t)]}function vl(t,e){const i=bl(t.map((t=>t.set))).filter(Boolean),s=(n=ml(1,t.length+1),r=i,[n,r].reduce(((t,e)=>t.filter((t=>!e.includes(t)))))).sort((()=>.5-e()));var n,r;t.filter((t=>!t.set)).forEach(((t,e)=>t.set=s[e]))}function wl(t,e,i=.5){fl(t).forEach(((s,n)=>{const r=t[n+1],o=s.set!==r.set,a=e()<=i;var l,h,c;o&&a&&(l=t,h=r.set,c=s.set,l.forEach((t=>{t.set===h&&(t.set=c)})),s.right=!1,r.left=!1)}))}na.sort().forEach((t=>{const e=28-t.length,i=Math.floor(e/2),s="-".repeat(i-1);let n=`${s} ${t} ${s}`;n=n.padEnd(28,"-"),dl.push({label:n});const r=sa.filter((e=>Do[e].location===t)).sort(((t,e)=>S[t].localeCompare(S[e]))).map((t=>({label:Do[t].name||_r(S[t]),warp:t})));dl.push(...r),dl.push({label:""})}));const xl=16;class Sl extends a.Scene{constructor(){super("Maze"),e(this,"parent"),e(this,"keys"),e(this,"maze"),e(this,"mazePlayer"),e(this,"playerPosition",new a.Math.Vector2(0,0)),e(this,"nextUpdate"),e(this,"walking"),e(this,"audioThrottle",0)}init(t){this.parent=t.parent}preload(){this.load.setPath("assets"),this.load.image("maze_player","puzzles/maze/maze_player.png"),this.load.image("maze_tiles","puzzles/maze/maze_tiles.png")}create(){this.createMaze(),this.playerPosition.set(0,0),this.mazePlayer=this.add.image(this.playerPosition.x,this.playerPosition.y,"maze_player").setDisplaySize(8,8).setOrigin(-.5);const t=this.cameras.main;t.startFollow(this.mazePlayer),t.setZoom(5),t.setViewport(50,130,w.width-100,w.height-170),this.keys=this.parent.keys,this.parent.addTarget(this.mazePlayer),w.prod||this.input.on("wheel",((e,i,s,n,r)=>{t.zoom=Math.max(.01,t.zoom+5e-4*n)})),this.walking=this.sound.addAudioSprite("sfx");const e=this.walking.markers.ladder;this.walking.addMarker({name:"step",start:e.start,duration:.3})}getMazeSeed(){return this.parent.player.gameState.data.mazeSeed||0}createMaze(){var t,e,i,s;const n=this.getMazeSeed();this.maze=function(t=8,e=t,i=!0,s=1){const n=function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(s),r=[],o=ml(t);for(let h=0;h<e;h+=1){const s=o.map((s=>({x:s,y:h,top:i||h>0,left:i||s>0,bottom:i||h<e-1,right:i||s<t-1})));r.push(s)}fl(r).forEach(((t,e)=>{vl(t,n),wl(t,n),function(t,e,i){const s=Object.values(function(t){let e=bl(t.map((t=>t.set))).reduce(((t,e)=>gl(gl({},t),{},{[e]:[]})),{});return t.forEach((t=>e[t.set].push(t))),e}(t)),{ceil:n}=Math;s.forEach((t=>{(function(t,e,i){e=null==e?1:e;const s=null==t?0:t.length;if(!s||e<1)return[];e=e>s?s:e;let n=-1;const r=s-1,o=[...t];for(;++n<e;){const t=n+Math.floor(i()*(r-n+1)),e=o[t];o[t]=o[n],o[n]=e}return o.slice(0,e)})(t,n(i()*t.length),i).forEach((t=>{if(t){const i=e[t.x];t.bottom=!1,i.top=!1,i.set=t.set}}))}))}(t,r[e+1],n)}));const a=(l=r)[l.length-1];var l;return vl(a,n),wl(a,n,1),r}(24,24,!0,n);const r=this.maze,o=r.length,a=r[0].length,l=Array.from({length:2*o+1},(()=>Array(2*a+1).fill(1)));for(let p=0;p<o;p++)for(let t=0;t<a;t++)l[2*p+1][2*t+1]=0,r[p][t].top||(l[2*p][2*t+1]=0),r[p][t].bottom||(l[2*p+2][2*t+1]=0),r[p][t].left||(l[2*p+1][2*t]=0),r[p][t].right||(l[2*p+1][2*t+2]=0);l[0][0]=0,l[1][0]=0,l[0][1]=0,l[2*o][2*a]=0,l[2*o-1][2*a]=0,l[2*o][2*a-1]=0;const h=l.length,c=this.make.tilemap({tileWidth:xl,tileHeight:xl,width:h,height:h}),u=c.addTilesetImage("maze_tiles"),d=c.createBlankLayer("layer",u);d.setScale(.5),this.parent.addTarget(d);for(let p=0;p<h-1;p++)for(let n=0;n<h-1;n++){const r=null==(t=l[p])?void 0:t[n],o=null==(e=l[p])?void 0:e[n+1],a=null==(i=l[p+1])?void 0:i[n],h=(null==(s=l[p+1])?void 0:s[n+1])+2*a+4*o+8*r;d.putTileAt(h,n,p)}}update(t,e){if(t<this.nextUpdate)return;const i=this.keys.keys,s=new a.Math.Vector2(0,0);i[Br.Left]?s.x=-16:i[Br.Right]?s.x=xl:i[Br.Up]?s.y=-16:i[Br.Down]&&(s.y=xl);const n=new a.Math.Vector2(this.playerPosition.x+s.x,this.playerPosition.y+s.y),r=new a.Math.Vector2(368,368);this.playerPosition.x===n.x&&this.playerPosition.y===n.y||!this.canMove(n)||(Date.now()>this.audioThrottle&&(this.walking.play("step",{volume:.5}),this.audioThrottle=Date.now()+350),this.mazePlayer.setPosition(this.playerPosition.x,this.playerPosition.y),this.playerPosition.set(n.x,n.y),this.tweens.killTweensOf(this.mazePlayer),this.tweens.add({targets:this.mazePlayer,x:n.x,y:n.y,duration:140}),this.parent.setAngle(a.Math.Angle.BetweenPoints(n,r))),this.playerPosition.x===r.x&&this.playerPosition.y===r.y&&this.parent.close(!0),this.nextUpdate=t+140}canMove(t){const e=t.x,i=t.y,s=Math.floor(e/xl),n=Math.floor(i/xl);if(s<0||n<0||s>=24||n>=24)return!1;const r=Math.floor(this.playerPosition.x/xl),o=Math.floor(this.playerPosition.y/xl),a=this.maze[o][r];return!(!a||a.top&&i<this.playerPosition.y||a.bottom&&i>this.playerPosition.y||a.left&&e<this.playerPosition.x||a.right&&e>this.playerPosition.x)}}class kl extends a.GameObjects.Rectangle{constructor(t,i,s){super(t,0,0,i.size,i.size),e(this,"keys"),e(this,"cursorData"),e(this,"nextUpdate",0),e(this,"position",new a.Math.Vector2(-1,-1)),t.add.group(this,{runChildUpdate:!0}),this.setStrokeStyle(2,Y(W),.75),this.setVisible(!1),this.cursorData=i,this.keys=s,t.input.on("pointerdown",(t=>{this.setVisible(!1)}))}update(t,e){var i;if(t<this.nextUpdate)return;let s=!0;const n=this.keys.keys;if(n[Br.Continue]?this.cursorData.keyHandler(this.position):n[Br.Left]?this.position.x--:n[Br.Right]?this.position.x++:n[Br.Up]?this.position.y--:n[Br.Down]?this.position.y++:s=!1,s){const e=null==(i=this.cursorData.regions[0])?void 0:i.length,s=this.cursorData.regions.length;this.position.x=a.Math.Clamp(this.position.x,0,e-1),this.position.y=a.Math.Clamp(this.position.y,0,s-1),this.nextUpdate=t+170,this.setVisible(!0),this.setPosition(this.cursorData.regions[this.position.y][this.position.x].x,this.cursorData.regions[this.position.y][this.position.x].y)}}}"function"==typeof SuppressedError&&SuppressedError;class Tl extends a.Scene{constructor(){super("Paused"),e(this,"parent"),e(this,"debugCount"),e(this,"container"),e(this,"preSave")}init(t){this.parent=t.game;const e=Da(this.parent.player.scene);e.settings.time=0,this.preSave=JSON.stringify(e)}create(){var t;const{width:e,height:i}=w;_.setScene(this),_.fadeMusic(.15),this.container=this.add.container(0,0),this.container.add(this.add.rectangle(e/2,i/2,e,i,0,.75).setInteractive().on("pointerdown",(()=>this.resume()))),this.container.add(this.add.text(e/2,w.height/2-100,"Game Paused",{...Rs,fontSize:72}).setOrigin(.5)),this.debugCount=0,this.container.add(this.add.text(e-20,i-20,`Build Time: ${new Date("2025-02-18T18:41:10.063Z").toLocaleString()}\n${w.prod?"":"Debug Mode"}`,{...Rs,fontSize:16,align:"right",padding:{x:20,y:20}}).setOrigin(1,1).setInteractive({useHandCursor:!1}).on("pointerdown",(()=>{this.debugCount++,this.debugCount>10&&(localStorage.setItem("chrono-sleuth-prod",w.prod?"false":"true"),window.location.reload())})));const s=w.zoomed?36:48,n=new sl(this);this.container.add(n);const r=new $o(this,w.width-210,30,"tv",(()=>{to()})),o=new $o(this,w.width-150,30,"gamepad",(()=>{this.parent.gamepad.setVisible(!this.parent.gamepad.visible)})),a=new $o(this,w.width-90,30,this.parent.sound.mute?"volume-mute":"volume",(()=>{const t=this.parent.sound.mute;this.parent.sound.mute=!t,a.setIcon(t?"volume":"volume-mute")})),l=new tl(this,w.width-30,30),h=new uo(this,e/2,w.height/2,"Resume",(()=>this.resume()),{fontSize:s});let c;w.prod||(c=new $o(this,80,30,"terminal",(()=>{this.resume(),this.parent.time.delayedCall(200,(()=>{jr(this.parent,"DebugTool")}))}))),n.setButtons([[c,r,o,a,l],[void 0,h,void 0,void 0,void 0],[void 0,void 0,void 0,void 0,void 0]]),n.activeIndex.set(1,1),null==(t=this.input.keyboard)||t.on("keydown-ESC",(()=>this.resume())),new Wr(this),new Uo(this,!0).setVisible(!1),this.tweens.add({targets:this.container,alpha:{start:0,to:1},duration:250})}resume(){_.fadeMusic(_.volume,500,(()=>_.setScene(this.parent))),this.tweens.add({targets:this.container,alpha:{start:1,to:0},duration:250,onComplete:()=>{this.scene.stop(),this.scene.resume("Game")}}),this.parent.time.delayedCall(300,(()=>{const t=Da(this.parent);t.settings.time=0,this.preSave!==JSON.stringify(t)&&Ga(this.parent)}))}}class Pl extends a.Scene{constructor(){super("Pipes"),e(this,"parent"),e(this,"keys"),e(this,"pipes",[]),e(this,"totalPipes",0),e(this,"images",[]),e(this,"container"),e(this,"blockSize"),e(this,"pipeSize"),e(this,"initialized",!1),e(this,"enabled",!0)}init(t){this.parent=t.parent,this.blockSize=w.zoomed?13:17,this.pipeSize=3.75*this.blockSize,this.enabled=!0}preload(){this.prerenderPipes()}prerenderPipes(){for(const t of oa){const e=Xo[t],i=`pipe_${t}`;this.textures.exists(i)&&this.textures.remove(i);const s=this.textures.createCanvas(i,3*this.blockSize,3*this.blockSize);if(s){const t=s.context;t.fillStyle="#ffffff";for(let i=0;i<e.length;i++)for(let s=0;s<e[i].length;s++)1===e[i][s]&&t.fillRect(s*this.blockSize,i*this.blockSize,this.blockSize,this.blockSize);s.refresh()}}}create(){this.keys=this.parent.keys,this.container=this.add.container(),this.createPipes();const t=[];for(let i=0;i<6;i++){t.push([]);for(let e=0;e<14;e++)t[i].push({x:(e+1)*this.pipeSize,y:(i+1)*this.pipeSize})}const e=new kl(this,{regions:t,size:this.pipeSize,keyHandler:t=>this.rotatePipe(t.x+1,t.y+1)},this.keys);this.container.add(e)}createPipes(){this.pipes=[],this.container=this.add.container().setPosition(w.width/2-16*this.pipeSize/2+this.pipeSize/2,w.height/4),this.totalPipes=0;for(let t=0;t<8;t++){this.pipes[t]||(this.pipes[t]=[]);for(let e=0;e<16;e++){let i=qo[t][e];const s=0===e||0===t||15===e||7===t,n=15===e&&7===t,r=!s;this.pipes[t][e]={x:e,y:t,type:i,rotation:s?0:90*a.Math.Between(0,3),interactive:r},i!==Vo.Empty&&this.totalPipes++;const o=e+t*qo[0].length;this.time.delayedCall(50+5*o,(()=>{const s=`pipe_${i}`,o=this.add.image(e*this.pipeSize,t*this.pipeSize,s).on("pointerdown",(()=>this.rotatePipe(e,t)));o.setAlpha(0).setScale(.5).setAngle(this.pipes[t][e].rotation),this.tweens.add({targets:o,alpha:1,scale:1,duration:300,onComplete:n?()=>{this.initialized=!0,this.updatePipes()}:void 0}),r?o.setInteractive():o.setTint(6710886),this.container.add(o),this.images.push(o)}))}}this.parent.addTarget(this.container)}rotatePipe(t,e){this.pipes[e][t].interactive&&this.initialized&&this.enabled&&(this.pipes[e][t].rotation=(this.pipes[e][t].rotation+90)%360,Math.random()>.35&&this.sound.playAudioSprite("sfx","pipes_squeak",{volume:.25,detune:a.Math.Between(-500,500)}),this.updatePipes())}updatePipes(){const t=function(t){const e=[],i=new Set,s=t.length,n=t[0].length;return function r(o,a){const l=`${o},${a}`;i.add(l),e.push(t[a][o]),o+1<n&&!i.has(`${o+1},${a}`)&&Yo(t[a][o],t[a][o+1])&&r(o+1,a),o-1>=0&&!i.has(`${o-1},${a}`)&&Yo(t[a][o],t[a][o-1])&&r(o-1,a),a+1<s&&!i.has(`${o},${a+1}`)&&Yo(t[a][o],t[a+1][o])&&r(o,a+1),a-1>=0&&!i.has(`${o},${a-1}`)&&Yo(t[a][o],t[a-1][o])&&r(o,a-1)}(0,2),e}(this.pipes);this.pipes.forEach((t=>{t.forEach((t=>{this.images[t.x+t.y*qo[0].length].setAngle(t.rotation)}))})),t.length===this.totalPipes&&this.parent.close(!0)}completed(t){this.enabled=!1;const e=this.images.length,i=new a.Display.Color(255,255,255),s=Q(Y("008080"));this.sound.playAudioSprite("sfx","pipes_complete",{volume:1.2});for(let n=0;n<e;n++){const r=this.images[n];J(this,i,s,(t=>r.setTint(t)),{duration:500,delay:10*n,hold:1e3,onComplete:n===e-1?()=>{t&&t(),this.tweens.add({targets:this.container.list,alpha:0,duration:100})}:void 0})}}}const Ol=w.height/(w.zoomed?4:5.5),Cl=[[1,0,1,1,0],[0,1,0,0,0],[0,0,1,0,1],[0,0,1,1,0],[1,1,0,0,1]],El=2*Math.PI/16;!function(t={}){const{immediate:e=!1,onNeedRefresh:i,onOfflineReady:s,onRegistered:n,onRegisteredSW:r,onRegisterError:a}=t;let l,h;h=async function(){if("serviceWorker"in navigator){if(l=await function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){const t=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),r=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=Promise.allSettled(e.map((e=>{if(e=function(t,e){return new URL(t,e).href}(e,i),e in o)return;o[e]=!0;const s=e.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(i)for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.href===e&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=s?"stylesheet":"modulepreload",s||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),s?new Promise(((t,i)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function n(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return s.then((e=>{for(const t of e||[])"rejected"===t.status&&n(t.reason);return t().catch(n)}))}((async()=>{const{Workbox:t}=await import("./workbox-window.prod.es5-BXNXHyjv.js");return{Workbox:t}}),[],import.meta.url).then((({Workbox:t})=>new t("./sw.js",{scope:"./",type:"classic"}))).catch((t=>{null==a||a(t)})),!l)return;l.addEventListener("activated",(t=>{(t.isUpdate||t.isExternal)&&window.location.reload()})),l.addEventListener("installed",(t=>{t.isUpdate||null==s||s()})),l.register({immediate:e}).then((t=>{r?r("./sw.js",t):null==n||n(t)})).catch((t=>{null==a||a(t)}))}}()}({immediate:!0});const Il={type:Phaser.WEBGL,width:w.width,height:w.height,parent:"game-container",backgroundColor:Y(X),scale:{mode:Phaser.Scale.FIT,autoCenter:w.prod?Phaser.Scale.CENTER_BOTH:Phaser.Scale.CENTER_HORIZONTALLY},loader:{imageLoadType:"HTMLImageElement"},scene:[Qa,el,il,Za,ya,Tl,class extends al{constructor(){super({key:"DebugTool",title:"Debug Tool",gamepadVisible:!1,hideCloseSuccess:!0}),e(this,"player"),e(this,"tabs",[]),e(this,"tab",0),e(this,"mainContainer"),e(this,"textBox"),e(this,"helperText"),e(this,"stateContainer"),e(this,"saveContainer"),e(this,"miscContainer"),e(this,"preSave"),e(this,"testVoice",{octave:3.5,speed:1,volume:1,type:"sine"});const t=localStorage.getItem(ul);t&&(this.tab=Number(t))}init(t){this.player=t.player;const e=Da(this.player.scene);e.settings.time=0,this.preSave=JSON.stringify(e)}create(){var t;super.create(),this.mainContainer=this.add.container(-w.width/2,-w.height/2),this.container.add(this.mainContainer),this.mainContainer.add(this.add.rectangle(300,100,.65*w.width,.75*w.height,Y("#112233")).setOrigin(0));const e=this.makeTab("Items",0),i=this.makeTab("Journal",1),s=this.makeTab("Quests",2),n=this.makeTab("State",3),r=this.makeTab("Warp",4),o=this.makeTab("Saves",5),a=this.makeTab("Misc",6);this.textBox=new cl(this,300,100,"",{fontSize:32},(t=>this.handleLineClick(t))).setBoxSize(.42*w.width,.75*w.height),this.mainContainer.add(this.textBox),this.helperText=this.add.text(w.zoomed?.94*w.width:.87*w.width,110,"",{...Rs,fontSize:24}).setOrigin(1,0).setDepth(1),this.mainContainer.add(this.helperText),this.tabs=[e,i,s,n,r,o,a],this.container.add(this.tabs),this.createStateContainer(),this.createSaveContainer(),this.createMiscContainer(),this.updateTabs(),null==(t=this.input.keyboard)||t.on("keydown-CLOSED_BRACKET",(()=>{this.close()}))}createStateContainer(){this.stateContainer=this.add.container(310,100),this.mainContainer.add(this.stateContainer);const t=this.player.gameState.data;Object.entries(t).forEach(((e,i)=>{const[s,n]=e,r=this.add.text(0,20+40*i,`${s}: ${n}`,{...Rs,fontSize:32}).setOrigin(0);switch(this.stateContainer.add(r),typeof n){case"boolean":r.setText(`${n?"[x]":"[ ]"} ${s}`),r.setInteractive().on("pointerdown",(()=>{t[s]=!t[s],r.setText(`${t[s]?"[x]":"[ ]"} ${s}`)}));break;case"number":const e=this.smallButton(r.width+20,22+40*i,"-",(()=>{t[s]--,r.setText(`${s}: ${t[s]}`)})),o=this.smallButton(r.width+55,22+40*i,"+",(()=>{t[s]++,r.setText(`${s}: ${t[s]}`)}));this.stateContainer.add([e,o])}}))}smallButton(t,e,i,s){return new po(this,t,e,i,s,{fontSize:36,backgroundColor:"#111",padding:{x:6,y:-4}},null)}createSaveContainer(){this.saveContainer=this.add.container(310,100),this.mainContainer.add(this.saveContainer),Object.entries(Ka).forEach(((t,e)=>{const[i,s]=t,n=new po(this,0,10+60*e,Xa[Number(i)],(()=>{Number(i)===Xa.New?(localStorage.removeItem(Va),window.location.reload()):(Ga(this.player.scene,s),this.player.x+=.1,this.close(!0))}),{backgroundColor:"#111"});this.saveContainer.add(n)}));const t=new po(this,350,10,"Dump Save",(()=>{const t=(e=Da(this.player.scene),JSON.stringify(e,((t,e)=>{const i=Ba[t];return Array.isArray(e)&&i?e.map((t=>Lr(t,i.enumObj,i.enumName))):i?Lr(e,i.enumObj,i.enumName):e}),2).replace(/"(\w+\.\w+)"/g,"$1"));var e;navigator.clipboard.writeText(t).catch((t=>console.error(t))),console.warn("save copied to clipboard!"),console.log(t)}),{backgroundColor:"#111"});this.saveContainer.add(t)}createMiscContainer(){this.miscContainer=this.add.container(310,100),this.mainContainer.add(this.miscContainer);let t=-50;const e=new po(this,350,t+=60,"Debug Mode",(()=>{w.debug=!w.debug,this.close()}),{backgroundColor:"#111"});this.miscContainer.add(e);const i=new po(this,350,t+=60,"Clear Cache",(async()=>{const t=await caches.keys();for(const e of t)await caches.delete(e);window.location.reload()}),{backgroundColor:"#111"});this.miscContainer.add(i);const s=new po(this,350,t+=60,"Toggle Lights",(()=>this.player.gameState.updateData({night:!this.player.gameState.data.night})),{backgroundColor:"#111"});this.miscContainer.add(s)}makeTab(t,e){return new po(this,40-this.container.x,100-this.container.y+60*e,t,(()=>{this.tab=e,localStorage.setItem(ul,String(e)),this.updateTabs()}))}rangeInput(t,e,i,s,n){const r=this.add.text(t,e,`${n}: ${i().toFixed(1)}`,{...Rs}),o=this.smallButton(t+130,e,"-",(()=>{s(i()-.1),r.text=`${n}: ${i().toFixed(1)}`})),a=this.smallButton(t+170,e,"+",(()=>{s(i()+.1),r.text=`${n}: ${i().toFixed(1)}`}));return[r,o,a]}handleLineClick(t){var e,i;switch(this.tab){case 0:const s=Jo[t],n=this.player.inventory.inventory,r=n.find((t=>t.type===s));r?r.used?n.splice(n.indexOf(r),1):r.used=!r.used:this.player.inventory.addItem({type:s,used:!1},!0);break;case 1:const o=Zo[t],a=this.player.journal.journal;Aa(this.player,o)?a.splice(a.indexOf(o),1):this.player.journal.addEntry(o,!0);break;case 2:const l=ia[t],h=this.player.quests.quests,c=h.find((t=>t.id===l));c?c.completed?h.splice(h.indexOf(c),1):c.completed=!c.completed:this.player.quests.addQuest({id:l,completed:!1},!0);break;case 4:const u=dl[t];u.warp&&(No(S.Town,Do[u.warp].warpTo,this.player,void 0,!0),this.close());break;case 6:if(t>1){const s=aa[t-2];"MainMenu"===s?(this.scene.sendToBack("Game"),this.scene.start(s)):(this.scene.stop(this),this.scene.resume("Game"),null==(i=null==(e=this.scene.get("Game"))?void 0:e.gamepad)||i.setAlpha(1),jr(this.player.scene,s))}}this.updateTabs()}updateTabs(){var t,e,i;this.tabs.forEach(((t,e)=>{t.setBackgroundColor(e===this.tab?"#123":"#151515")}));const s=0===this.tab||1===this.tab||2===this.tab||4===this.tab||6===this.tab,n=0===this.tab||2===this.tab;null==(t=this.stateContainer)||t.setVisible(3===this.tab),null==(e=this.saveContainer)||e.setVisible(5===this.tab),null==(i=this.miscContainer)||i.setVisible(6===this.tab),this.textBox.setVisible(s),this.helperText.setVisible(n);let r="";switch(this.tab){case 0:r=Jo.map((t=>`[${Oa(this.player,t)?"-":Ca(this.player,t)?"x":" "}] ${k[t]}`)).join("\n"),this.helperText.setText("[-] item held\n[x] item used");break;case 1:r=Zo.map((t=>`[${Aa(this.player,t)?"x":" "}] ${C[t]}`)).join("\n");break;case 2:r=ia.map((t=>`[${Ea(this.player,t)?"-":Ia(this.player,t)?"x":" "}] ${T[t]}`)).join("\n"),this.helperText.setText("[-] quest active\n[x] quest complete");break;case 4:r=dl.map((t=>t.label)).join("\n");break;case 6:r=["Scenes","-----------------",...aa].join("\n")}this.textBox.setText(r)}handleSuccess(t){const e=Da(this.player.scene);e.settings.time=0,this.preSave!==JSON.stringify(e)&&(t||Ga(this.player.scene),this.player.scene.scene.restart())}},class extends al{constructor(){super({key:"JournalDialog",title:"Journal",gamepadVisible:!1,hideCloseSuccess:!0,skipUI:!0}),e(this,"player")}init(t){this.player=t.player}create(){var t;super.create(),this.container.add(this.add.image(0,0,"props","paper").setScale(3.3,3).setAngle(90)),this.container.add(new uo(this,.46*w.width,-.37*w.height,"X",(()=>this.close(!1)),{...js,backgroundColor:void 0,fontSize:54})),this.player.journal.unread.setVisible(!1);const e=this.player.journal.journal.map((t=>`${Yr[t].description}\n`)).reverse(),i=new cl(this,.08*w.width,.2*w.height,e,{...js,scrollbarColor:Y("473946")});i.setBoxSize(.84*w.width,.62*w.height),this.addTarget(i),this.fadeIn(),null==(t=this.input.keyboard)||t.on("keydown-J",(()=>{this.close()})),this.sound.playAudioSprite("sfx","book_open")}preHandleSuccess(){this.sound.playAudioSprite("sfx","book_close")}handleSuccess(){}},class extends al{constructor(){super({key:"MazeDialog",title:"Find your way through the forest",childScene:"Maze",gamepadVisible:!0}),e(this,"player"),e(this,"arrow")}init(t){var e,i;this.player=t.player,this.dialogData.gamepadVisible=null==(i=null==(e=t.player.scene)?void 0:e.gamepad)?void 0:i.visible}preload(){this.load.setPath("assets"),this.load.image("arrow","puzzles/arrow.png")}create(){super.create(),this.arrow=this.add.image(.4*-w.width,.4*-w.height,"arrow").setScale(.5).setRotation(.75*Math.PI),this.container.add(this.arrow)}setAngle(t){this.arrow.setRotation(t+Math.PI/2)}handleSuccess(t){t&&Ar(this.player.scene,500,(()=>{No(S.TownEast,S.Forest,this.player),this.player.gameState.updateData({mazeSolved:!0,mazeSeed:this.player.gameState.data.mazeSeed+1},!1)}))}},Sl,class extends al{constructor(){super({key:"PipesDialog",title:"Attach all of the pipes to fix the alchemy set.\n[CONTINUE/CLICK] to rotate",gamepadVisible:!1,childScene:"Pipes"}),e(this,"player")}init(t){this.player=t.player}create(){super.create(),this.title.setFontSize(36).setAlign("center").setY(this.title.y+10)}close(t){const e=this.scene.get("Pipes");t&&e?e.completed((()=>super.close(t))):super.close(t)}handleSuccess(t){t&&this.player.message.setDialog({messages:["There. It looks like the alchemy set has been properly fit back together."],onCompleted:t=>{t.journal.addEntry(C.AlchemySetFixed)}},La(this.player.scene,E.AlchemySet),"player_portrait")}},Pl,class extends al{constructor(){super({key:"TumblerDialog",title:"Open the lock by aligning all rings",gamepadVisible:!1}),e(this,"player"),e(this,"angles"),e(this,"rings"),e(this,"line"),e(this,"fx"),e(this,"active"),e(this,"nextUpdate"),e(this,"disabled")}init(t){this.player=t.player}preload(){this.load.setPath("assets");for(let t=1;t<=5;t++)this.load.image(`ring_${t}`,`puzzles/tumbler/ring${t}.png`)}create(){super.create(),this.angles=[],this.rings=[],this.fx=[],this.active=0,this.nextUpdate=0,this.disabled=!1,this.line=this.add.line(0,30,27,0,216,0,Y(V)).setOrigin(0,0).setLineWidth(5),this.container.add(this.line),this.container.add(this.add.text(.45*-w.width,.2*w.height,"Use [Left]/[Right]\nto select a ring\n\nUse [Up]/[Down]\nto rotate a ring",{...Rs}));for(let t=0;t<Cl.length;t++){let e=Math.floor(Math.random()*Math.PI*2);e=a.Math.Snap.To(e,El),e=t/5*Math.PI*2,this.angles.push(e),this.circle(t)}this.updateMarkers()}circle(t){const e={x:w.width/2,y:w.height/2},i=this.add.image(0,30,`ring_${t+1}`).setScale(.8).setInteractive({draggable:!0,useHandCursor:!0,pixelPerfect:!0}).on("drag",(i=>{if(this.active=-1,i.isDown){this.active=t;const s=a.Math.Angle.Between(e.x,e.y,i.x,i.y);this.handleMove(t,s)}})).on("dragstart",(i=>{if(this.active=-1,i.isDown){this.active=t;const s=a.Math.Angle.Between(e.x,e.y,i.x,i.y);this.handleMove(t,s)}})).on("dragend",(()=>{this.active=-1,this.updateMarkers(!0)}));this.fx.push(i.postFX.addGlow(Y(V),2,0)),w.debug&&this.input.enableDebug(i),this.container.add(i),this.rings.push(i)}handleMove(t,e,i){var s;if(this.disabled)return;const n=JSON.stringify(this.angles),r=this.angles[t]-e;this.angles[t]=a.Math.Snap.To(e%(2*Math.PI),El),null==(s=Cl[t])||s.forEach(((e,i)=>{i!==t&&(this.angles[i]=a.Math.Snap.To((this.angles[i]+e*r)%(2*Math.PI),El))})),console.log(this.angles,Cl),n!==JSON.stringify(this.angles)&&this.sound.playAudioSprite("sfx","safe_click",{detune:a.Math.Between(-500,500)}),this.updateMarkers(i)}updateMarkers(t){let e=!0;this.angles.forEach(((t,i)=>{var s;const n=a.Math.Snap.To(t,El);Math.abs(n-0)<.6*El||Math.abs(n-2*Math.PI)<.6*El||(e=!1),null==(s=this.rings[i])||s.setAngle(a.Math.RadToDeg(n))})),e&&t&&this.close(!0)}completed(t){for(let e=0;e<5;e++)this.sound.playAudioSprite("sfx","safe_click",{delay:.1*e+.05*Math.random(),detune:a.Math.Between(-500,500)});this.sound.playAudioSprite("sfx","chest",{delay:.75}),this.tweens.add({targets:this.rings,rotation:0,duration:500,onComplete:()=>{this.angles=[0,0,0,0,0],this.updateMarkers(),this.disabled=!0,this.active=-1,this.tweens.add({targets:[...this.rings,this.line],rotation:2*Math.PI,delay:500,duration:1500,hold:1e3,onComplete:t})}})}update(t,e){var i;if(!(t<this.nextUpdate)){if(this.nextUpdate=t+100,!this.disabled){const e=this.keys.keys;e[Br.Left]?(this.nextUpdate=t+300,this.active=a.Math.Clamp(this.active-1,0,this.angles.length-1)):e[Br.Right]?(this.nextUpdate=t+300,this.active=a.Math.Clamp(this.active+1,0,this.angles.length-1)):e[Br.Up]?this.handleMove(this.active,this.angles[this.active]-El,!0):e[Br.Down]&&this.handleMove(this.active,this.angles[this.active]+El,!0)}for(let t=0;t<5;t++)null==(i=this.rings[t])||i.setTint(this.active===t?Y("C49B7C"):void 0),this.fx[t].color=Y(this.active===t?"C49B7C":V)}}close(t){t?this.completed((()=>super.close(t))):super.close(t)}handleSuccess(t){t&&function(t){t.inventory.useItem(k.Potion),t.active=!1;const e=t.scene,i=new Ta(t.scene,k.Gear2,t);e.interactiveObjects.add(i);const s=La(e,E.MansionPicture);s&&(no(e,!1),e.sound.playAudioSprite("sfx","safe_open"),i.setPosition(s.x,s.y+20),e.tweens.add({targets:i,x:s.x-10,y:s.y+120,duration:1e3,hold:3750,onComplete:()=>{t.message.setDialog({messages:["Wow, that was wild.","I should be more careful next time before I drink random potions.","At least I found the gear!"],onCompleted:()=>e.time.delayedCall(500,(()=>t.active=!0))},s,"player_portrait")},ease:"Bounce.easeOut"}))}(this.player)}},class extends al{constructor(){super({key:"MemoryDialog",title:"Figure out the secret code",gamepadVisible:!1}),e(this,"sequence"),e(this,"pressed"),e(this,"buttons"),e(this,"player")}init(t){this.player=t.player}preload(){this.load.setPath("assets");for(let t=1;t<=12;t++)this.load.image(`rune_${t}`,`puzzles/runes/Stone${t}.png`)}create(){for(super.create(),this.sequence=[],this.pressed=[];this.sequence.length<6;){const t=a.Math.RND.between(0,11);this.sequence.includes(t)||this.sequence.push(t)}w.prod||this.container.add(this.add.text(0,.43*w.height,`[ ${this.sequence.map((t=>t+1)).join(", ")} ]`,{fontSize:18,align:"center"}).setOrigin(.5)),this.buttons=new go(this),this.container.add(this.buttons);const t=w.width/13*1.2,e=[];for(let s=0;s<12;s++){const i=s%3*t-t,n=1.2*-t+Math.floor(s/3)*t,r=Math.floor(s/3);void 0===e[r]&&e.push([]),e[r].push({x:i,y:n});const o=this.add.image(i,n,`rune_${s+1}`).setInteractive({useHandCursor:!0});o.on("pointerdown",(()=>this.onButtonPress(o,s))),this.buttons.add(o)}const i=new kl(this,{regions:e,size:t,keyHandler:t=>{const e=3*t.y+t.x,i=this.buttons.getAt(e);this.onButtonPress(i,e)}},this.keys);this.container.add(i)}onButtonPress(t,e){const i=this.pressed.length;this.sequence[i]===e?(this.sound.playAudioSprite("sfx","safe_click",{volume:.75}),this.pressed.push(e),t.disableInteractive(),J(this,new a.Display.Color(255,255,255),Q(Y(U)),(e=>t.setTint(e)),{duration:250,onComplete:()=>{J(this,Q(Y(U)),Q(3355443),(e=>t.setTint(e)),{duration:250,onComplete:()=>{this.sequence.length===this.pressed.length&&this.close(!0)}})}})):(this.sound.playAudioSprite("sfx","memory_wrong",{volume:.75}),t.disableInteractive(),J(this,new a.Display.Color(255,255,255),Q(Y(H)),(e=>t.setTint(e)),{duration:250,yoyo:!0,onComplete:()=>{this.buttons.each((t=>{t.setInteractive(),t.setTint(16777215)}))}}),this.pressed=[])}close(t){t?this.completed((()=>super.close(t))):super.close()}completed(t){this.time.delayedCall(300,(()=>{this.sound.playAudioSprite("sfx","unlock",{volume:.75}),this.buttons.getAll().forEach(((e,i)=>{const s=11===i,n=e.tint,r=Q(n),o=Q(Y(U));e.disableInteractive(),e.setTint(n),J(this,r,o,(t=>e.setTint(t)),{duration:200,delay:70*i,hold:500,onComplete:s?t:void 0})}))}))}handleSuccess(t){t&&function(t){const e=t.scene,i=new Ta(e,k.Gear1,t);e.interactiveObjects.add(i);const s=La(e,E.Chest);s&&(t.active=!1,t.setX(s.x-75),t.previousPosition.set(t.x-1,t.y),e.sound.playAudioSprite("sfx","chest"),s.setFrame("chest_open"),i.setPosition(s.x,s.y-20),i.setScale(.15),e.tweens.add({targets:i,scale:.35,y:s.y+20,duration:700,onComplete:()=>t.active=!0,ease:"Bounce.easeOut"}))}(this.player)}},class extends al{constructor(){super({key:"SliderDialog",title:"Arrange the tiles to be in order.",gamepadVisible:!1}),e(this,"solution",[]),e(this,"layout",[]),e(this,"tiles",[])}preload(){this.load.setPath("assets");const t=Math.floor(1024/3);this.load.spritesheet("slider","puzzles/slider.png",{frameWidth:t,frameHeight:t})}create(){super.create();const t=[];this.solution=Array.from({length:9},((t,e)=>e)),this.layout=[...this.solution],this.tiles=[];for(let i=this.layout.length-1;i>0;i--){const t=Math.floor(Math.random()*(i+1));[this.layout[i],this.layout[t]]=[this.layout[t],this.layout[i]]}this.layout.forEach(((e,i)=>{const s=i%3,n=Math.floor(i/3),r=(s-1)*Ol,o=(n-1)*Ol+30;void 0===t[n]&&(t[n]=[]),t[n].push({x:r,y:o});const a=this.add.image(r,o,"slider",i).setOrigin(.5).setDisplaySize(.95*Ol,.95*Ol);this.container.add(a),a.setInteractive({useHandCursor:!0}),a.on("pointerdown",(()=>{this.moveTile(i)})),this.tiles.push(a)}));const e=new kl(this,{regions:t,size:1.1*Ol,keyHandler:t=>{const e=3*t.y+t.x;this.moveTile(e)}},this.keys);this.container.add(e),this.updateLayout()}moveTile(t){const e=this.layout.indexOf(8),i=e%3,s=Math.floor(e/3),n=t%3,r=Math.floor(t/3);Math.abs(i-n)+Math.abs(s-r)===1&&(this.layout[e]=this.layout[t],this.layout[t]=8,this.sound.playAudioSprite("sfx","puzzle_slide",{volume:.5}),this.updateLayout()),this.layout.join("")===this.solution.join("")&&this.handleSuccess(!0)}updateLayout(){this.layout.forEach(((t,e)=>{this.tiles[e].setFrame(t),this.tiles[e].setVisible(8!=t)}))}completed(t){for(let e=0;e<this.layout.length+1;e++)this.time.delayedCall(150*e,(()=>{e<this.layout.length&&(this.tiles[e].setFrame(e),this.tiles[e].setVisible(8!=e)),e>0&&this.tiles[e-1].setTint(6710886)}));this.time.delayedCall(2e3,t)}close(t){t?this.completed((()=>super.close(t))):super.close(t)}handleSuccess(t){t&&this.time.delayedCall(750,(()=>{this.close(!0)}))}},class extends al{constructor(){super({key:"Books",title:"Books",gamepadVisible:!1,hideCloseSuccess:!0,skipUI:!0}),e(this,"player"),e(this,"books"),e(this,"message"),e(this,"answer"),e(this,"hasNote"),e(this,"bookshelf"),e(this,"door"),e(this,"debug")}preload(){this.load.setPath("assets"),this.load.atlas("bookshelf","atlases/bookshelf.png","atlases/bookshelf.json")}init(t){this.player=t.player,this.hasNote=!0}create(){super.create(),this.books=[],this.message=new fo(this),this.answer=[],this.debug=[],this.container.add(this.add.rectangle(0,0,w.width,w.height,0)),this.createBookshelf(),this.addTarget(this.add.image(20,20,"props","paper").setOrigin(0).setScale(2.25,1.6));const t=this.add.text(70,50,"I am not quite sure where to start. Maybe something in the library will help me find the answers I seek.",{...js,fontSize:36}).setWordWrapWidth(260);this.addTarget(t),this.hasNote&&(t.setText(["A spiral marks the heart of the sequence.",'Time begins with "Creation" and ends in "Eternity".',"A blue tome, near the center, waits before the final touch."].join("\n\n")),this.time.delayedCall(200,(()=>{this.message.setDialog({messages:["This note seems to be a clue of some sort. Maybe it has to do with some sort of ordering for the books on the shelf."]},void 0,"player_portrait")}))),this.fadeIn()}createBookshelf(){var t;const e=this.textures.get("bookshelf"),i=Object.entries(e.frames),s=150;this.bookshelf=this.add.image(s,0,"bookshelf","Bookshelf-0").setScale(4).setTint(6710886),this.container.add(this.bookshelf),this.door=this.add.image(s,0,"bookshelf","Door-0").setScale(4).setTint(6710886),this.container.add(this.door);const n=i.filter((t=>t[1].name.startsWith("Book_")));for(let r=0;r<n.length;r++){const e=n[r],i=this.add.image(s,0,"bookshelf",e[1].name).setScale(4);this.container.add(i);const o=2,l=e[1].data.spriteSourceSize,h=new a.Geom.Rectangle(l.x-o,l.y-o,l.w+2*o,l.h+2*o);i.setInteractive({hitArea:h,hitAreaCallback:a.Geom.Rectangle.Contains,cursor:"pointer"});const c=null==(t=i.preFX)?void 0:t.addGlow(Y(W),0);if(c&&(this.books.push({image:i,glow:c,strength:0,name:ll[r]}),i.on("pointerover",(()=>{this.books[r].strength=6})),i.on("pointerout",(()=>{this.answer.includes(r)||(this.books[r].strength=0)})),i.on("pointerdown",(()=>{const t=hl[this.answer.length]===r,e=[this.books[r].name];t&&e.push("<b><i>[CLUNK]</i></b> The bookshelf shifts slightly."),this.message.setDialog({messages:e,mute:t?[1]:void 0,onMessageShown:(t,e,i)=>{1===e&&this.sound.playAudioSprite("sfx","safe_click")},onCompleted:t?()=>{this.answer.push(r),this.books[r].strength=6,this.books[r].glow.color=Y(U),this.answer.length===hl.length&&this.close(!0)}:()=>{this.answer=[],this.books.forEach((t=>{t.glow.color=Y(W),t.strength=0}))}},void 0,"player_portrait")})),!w.prod&&hl.includes(r))){const t=this.add.text(4*h.x-s+40,4*h.y-w.height/2+40,(hl.indexOf(r)+1).toString(),Rs).setAlpha(.5);this.container.add(t),this.debug.push(t)}}}update(t,e){super.update(t,e),this.updateBooks(t,e)}updateBooks(t,e){if(!this.message.visible)for(let i=0;i<this.books.length;i++){const t=this.books[i],s=t.strength-t.glow.outerStrength;if(Math.abs(s)>.001){let i=.015*e*Math.sign(s);t.glow.outerStrength=Math.abs(i)>Math.abs(s)?t.strength:t.glow.outerStrength+i,t.glow.outerStrength=Phaser.Math.Clamp(t.glow.outerStrength,0,6)}}}handleSuccess(){}close(t){this.books.forEach((t=>{t.strength=0,t.image.destroy()})),this.debug.forEach((t=>t.destroy())),this.bookshelf.setTint(Y(B)),this.door.setTint(Y(B)),t?this.add.timeline([{at:400,run:()=>{this.sound.playAudioSprite("sfx","safe_open")}},{at:650,run:()=>this.door.setFrame("Door-1")},{at:900,run:()=>this.door.setFrame("Door-2")},{at:1800,run:()=>this.message.setDialog({messages:["It looks like there is a secret room behind the bookshelf!"],onCompleted:()=>super.close(!0)},void 0,"player_portrait")}]).play():super.close(t)}},ol],pipeline:{CRTPipeline:Jr,XRayPipeline:so},input:{gamepad:!0},disableContextMenu:w.prod,physics:{default:"arcade"},fps:{panicMax:165,smoothStep:!0},render:{pixelArt:!0,antialias:!1},maxLights:20,dom:{createContainer:!0},plugins:{scene:[{key:"PipelinePlugin",plugin:Zr,mapping:"pipelinePlugin"}]}};Dr.style.cursor="none",Dr.addEventListener("mousemove",(function(){Dr.style.cursor="default",clearTimeout(Fr),Fr=setTimeout((()=>{Dr.style.cursor="none"}),2500)}));const Al=document.querySelector("#initial-loader");null==Al||Al.remove();const Ml=new a.Game(Il);w.prod&&!w.debug||function(t){ga=(()=>{const t=document.createElement("div");t.id="stats",t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";const e=!("false"===localStorage.getItem("chrono-sleuth-stats"));t.classList.toggle("hidden",!e);const i=document.createElement("img");i.src="bar-chart-2.svg",i.width=24,i.height=24;const s=document.createElement("button");s.style.cssText="background-color:transparent;border:none;padding:0;bottom:8px;right:8px;position:fixed;cursor:pointer",s.appendChild(i),s.onclick=()=>{const e=!t.classList.contains("hidden");t.classList.toggle("hidden",e),localStorage.setItem("chrono-sleuth-stats",(!e).toString())},t.appendChild(s);const n=document.createElement("div");n.style.cssText="position:fixed;top:6px;left:6px;color:white;font-family:Helvetica,Arial,sans-serif;text-shadow:1px 1px 1px black",t.appendChild(n);const r=[];return{REVISION:17,dom:t,fps:n,panels:r,addPanel:function(e){return t.appendChild(e.dom),r.push(e),e}}})(),document.body.appendChild(ga.dom);const e=ga.dom.style;e.display="flex",e.justifyContent="center",e.flexWrap="wrap",e.gap="6px",e.cursor="",e.right="0",e.top="",e.bottom="10px",e.opacity="0.7";const i=ga.addPanel(pa("FPS","#9ad8e4","#064b62")),s=ga.addPanel(pa("Frame Time","#f3b0c3","#6b1e3d")),n=ga.addPanel(pa("Memory (mb)","#ffd59a","#6b3e06")),r=ga.addPanel(pa("Render","#e9f3a3","#4c6b1a")),o=ga.addPanel(pa("Step","#c3c3f3","#1d1d6b"));let a=0,l=0;t.events.on(Phaser.Core.Events.PRE_STEP,(()=>a=performance.now())),t.events.on(Phaser.Core.Events.POST_STEP,(()=>o.update(performance.now()-a))),t.events.on(Phaser.Core.Events.PRE_RENDER,(()=>l=performance.now())),t.events.on(Phaser.Core.Events.POST_RENDER,(()=>{const e=t.loop.deltaHistory.slice(0,10).reduce(((t,e)=>t+e),0)/10;r.update(performance.now()-l),i.update(1e3/e),s.update(performance.now()-a),ga.fps.textContent=`${Math.floor(1e3/e)}`,performance.memory&&n.update(performance.memory.usedJSHeapSize/1048576)}))}(Ml);
